{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/shop/add.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/shop/add.vue","mtime":1600926556237},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { UserService } from '@/services/user.service';\nimport { AddService } from \"./add.service\";\nimport { cloneDeep } from 'lodash-es';\nimport { PatternService } from '@/services/pattern.service';\nimport { MessageService } from '@/services/message.service';\nimport CheckboxFacilityGroup from '@/views/biz-components/checkbox-facility/checkbox-facility-group';\nimport CheckboxFacilityItem from '@/views/biz-components/checkbox-facility/checkbox-facility-item';\nimport MapButton from '@/views/components/map-button#/map-button';\nimport ShopHourPicker from '@/views/components/hour-picker#/hour-picker';\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue';\nimport MoreInput from '@/views/components/more-input#/more-input.vue';\nexport default {\n  components: {\n    CheckboxFacilityGroup: CheckboxFacilityGroup,\n    CheckboxFacilityItem: CheckboxFacilityItem,\n    MapButton: MapButton,\n    ShopHourPicker: ShopHourPicker,\n    StImageUpload: StImageUpload,\n    MoreInput: MoreInput\n  },\n  serviceInject: function serviceInject() {\n    return {\n      pattern: PatternService,\n      addService: AddService,\n      userService: UserService,\n      messageService: MessageService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      serviceList: this.addService.serviceList$,\n      addLoading: this.addService.loading$,\n      shop_status_add: this.userService.getOptions$('shop.shop_status_add'),\n      unusedShops: this.addService.unusedShops$\n    };\n  },\n  data: function data() {\n    return {\n      shopData: {\n        shop_name: '',\n        province_id: null,\n        city_id: null,\n        district_id: null,\n        address: '',\n        shop_phones: [],\n        shop_status: 2,\n        lat: '',\n        lng: '',\n        service_ids: [],\n        business_time: [],\n        email: '',\n        shop_cover_image: '',\n        buy_shop_id: -1\n      },\n      addMap: {\n        lat: '',\n        lng: '',\n        address: '',\n        province: {},\n        city: {},\n        district: {}\n      },\n      shopMapValidateText: '',\n      // 服务\n      serviceIcon_icon_list: {\n        1: 'WIFI',\n        2: 'park',\n        3: 'shower',\n        4: 'medical',\n        5: 'heating',\n        6: 'snow',\n        7: 'nosmoking',\n        8: 'energy'\n      },\n      fileList: [],\n      shopCoverImageValidateText: '',\n      shopPhoneValidateText: ''\n    };\n  },\n  beforeCreate: function beforeCreate() {\n    this.form = this.$form.createForm(this);\n  },\n  computed: {\n    shopCoverImageIsOk: function shopCoverImageIsOk() {\n      return this.shopCoverImageValidateText === '';\n    },\n    shopMapIsOk: function shopMapIsOk() {\n      return this.shopMapValidateText === '';\n    }\n  },\n  methods: {\n    fileChange: function fileChange(data) {\n      if (data.length) {\n        this.shopData.shop_cover_image = data[0].image_key;\n      } else {\n        this.shopData.shop_cover_image = '';\n      }\n\n      this.shopCoverImageValidator();\n    },\n    addMapChange: function addMapChange(data) {\n      this.addMap = cloneDeep(data);\n      this.shopData.province_id = data.province.id;\n      this.shopData.province_name = data.province.name;\n      this.shopData.city_id = data.city.id;\n      this.shopData.city_name = data.city.name;\n      this.shopData.district_id = data.district.id;\n      this.shopData.district_name = data.district.name;\n      this.shopData.address = data.address;\n      this.shopData.lat = data.lat;\n      this.shopData.lng = data.lng;\n      this.shopMapValidator();\n    },\n    onShopPhoneChange: function onShopPhoneChange(list) {\n      this.shopData.shop_phones = list;\n      this.shopPhoneValidator();\n    },\n    // 校验门店电话是否输入\n    shopPhoneValidator: function shopPhoneValidator() {\n      var length = this.shopData.shop_phones.filter(function (i) {\n        return i;\n      }).length;\n      this.shopPhoneValidateText = length ? '' : '请输入门店电话';\n      return this.shopPhoneValidateText;\n    },\n    // 表单提交\n    onHandleSubmit: function onHandleSubmit(e) {\n      var _this = this;\n\n      // 确认为提交表单校验\n      e.preventDefault();\n      this.shopCoverImageValidator();\n      this.shopMapValidator();\n      this.form.validateFieldsAndScroll(function (err, values) {\n        if (_this.shopPhoneValidator()) {\n          return;\n        }\n\n        if (!err && _this.shopCoverImageIsOk && _this.shopMapIsOk) {\n          // 过滤空数据\n          _this.shopData.shop_phones = _this.shopData.shop_phones.filter(function (i) {\n            return i;\n          });\n          _this.shopData.shop_name = values.shop_name;\n          _this.shopData.email = values.email;\n          _this.shopData.buy_shop_id = values.buy_shop_id;\n\n          _this.addService.save(_this.shopData).subscribe(_this.onSubmitSuccess);\n        }\n      });\n    },\n    onSubmitSuccess: function onSubmitSuccess() {\n      this.messageService.success({\n        content: '新增成功'\n      });\n      this.$router.push({\n        name: 'brand-setting-shop-list'\n      });\n    },\n    // shop_name validatorFn\n    shop_name_validator: function shop_name_validator(rule, value, callback) {\n      if (value === undefined || !value) {\n        // eslint-disable-next-line\n        callback('请填写门店名称');\n      } else if (value && !this.pattern.CN_EN_NUM_SPACE('1-20').test(value)) {\n        // eslint-disable-next-line\n        callback('支持中英文、数字,不超过20个字');\n      } else {\n        // eslint-disable-next-line\n        callback();\n      }\n    },\n    // 校验店招是否已上传\n    shopCoverImageValidator: function shopCoverImageValidator() {\n      this.shopCoverImageValidateText = this.shopData.shop_cover_image ? '' : '请上传店招';\n    },\n    // 校验地址\n    shopMapValidator: function shopMapValidator() {\n      this.shopMapValidateText = this.shopData.lat ? '' : '请选择门店地址';\n    }\n  }\n};",{"version":3,"sources":["add.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-panel app class=\"page-brand-shop-add\">\n    <st-form :form=\"form\">\n      <a-row :gutter=\"8\" class=\"page-add-shop-name-row\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"门店名称\" required>\n            <a-input\n              v-decorator=\"[\n                'shop_name',\n                { rules: [{ validator: shop_name_validator }] }\n              ]\"\n              maxlength=\"20\"\n              placeholder=\"支持中英文、数字,不超过20个字\"\n            ></a-input>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item\n            label=\"门店电话\"\n            required\n            :help=\"shopPhoneValidateText\"\n            :validateStatus=\"shopPhoneValidateText ? 'error' : ''\"\n          >\n            <more-input\n              :length=\"3\"\n              :list=\"shopData.shop_phones\"\n              @change=\"onShopPhoneChange\"\n              placeholder=\"请输入门店电话\"\n            ></more-input>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item\n            validateStatus=\"error\"\n            :help=\"shopMapValidateText\"\n            label=\"门店地址\"\n            required\n          >\n            <map-button\n              :lat=\"addMap.lat\"\n              :lng=\"addMap.lng\"\n              :address=\"addMap.address\"\n              :province=\"addMap.province\"\n              :city=\"addMap.city\"\n              :district=\"addMap.district\"\n              @select=\"addMapChange\"\n            ></map-button>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"邮箱\">\n            <a-input\n              v-decorator=\"[\n                'email',\n                {\n                  rules: [\n                    {\n                      type: 'email',\n                      message: '输入的邮箱格式错误，请重新输入!'\n                    }\n                  ]\n                }\n              ]\"\n              placeholder=\"请输入门店邮箱\"\n            ></a-input>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"23\">\n          <st-form-item label=\"服务设施\">\n            <checkbox-facility-group v-model=\"shopData.service_ids\">\n              <checkbox-facility-item\n                style=\"margin-right:24px\"\n                v-for=\"item in serviceList\"\n                :label=\"item.service_name\"\n                :icon=\"serviceIcon_icon_list[item.service_id]\"\n                :key=\"item.service_id\"\n                :value=\"item.service_id\"\n              ></checkbox-facility-item>\n            </checkbox-facility-group>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"23\">\n          <st-form-item\n            label=\"店招\"\n            required\n            validateStatus=\"error\"\n            :help=\"shopCoverImageValidateText\"\n          >\n            <st-image-upload\n              :sizeLimit=\"5\"\n              :list=\"fileList\"\n              @change=\"fileChange\"\n              width=\"240px\"\n              height=\"135px\"\n              placeholder=\"上传门店照片\"\n              description=\"大小不超过5M，建议尺寸16:9\"\n              :cropperModal=\"{\n                title: '门店图片裁切',\n                cropper: { aspectRatio: 16 / 9 }\n              }\"\n            ></st-image-upload>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"23\">\n          <st-form-item>\n            <template slot=\"label\">\n              营业状态\n              <st-help-tooltip id=\"TBCS001\" />\n            </template>\n            <a-radio-group v-model=\"shopData.shop_status\">\n              <a-radio\n                v-for=\"item in shop_status_add\"\n                :key=\"+item.value\"\n                :value=\"+item.value\"\n              >\n                {{ item.label }}\n              </a-radio>\n            </a-radio-group>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"22\">\n          <st-form-item label=\"营业时间\">\n            <shop-hour-picker\n              v-model=\"shopData.business_time\"\n            ></shop-hour-picker>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"到期时间\" required>\n            <a-select\n              placeholder=\"请选择到期时间\"\n              v-decorator=\"[\n                'buy_shop_id',\n                { rules: [{ required: true, message: '请选择到期时间' }] }\n              ]\"\n            >\n              <a-select-option\n                v-for=\"(item, index) in unusedShops\"\n                :key=\"index\"\n                :value=\"item.buy_shop_id\"\n              >\n                {{ item.expire_time }}\n              </a-select-option>\n            </a-select>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\" \">\n            <st-button\n              type=\"primary\"\n              @click=\"onHandleSubmit\"\n              :loading=\"addLoading.save\"\n            >\n              提交\n            </st-button>\n          </st-form-item>\n        </a-col>\n      </a-row>\n    </st-form>\n  </st-panel>\n</template>\n<script>\nimport { UserService } from '@/services/user.service'\nimport { AddService } from './add.service'\nimport { cloneDeep } from 'lodash-es'\nimport { PatternService } from '@/services/pattern.service'\nimport { MessageService } from '@/services/message.service'\nimport CheckboxFacilityGroup from '@/views/biz-components/checkbox-facility/checkbox-facility-group'\nimport CheckboxFacilityItem from '@/views/biz-components/checkbox-facility/checkbox-facility-item'\nimport MapButton from '@/views/components/map-button#/map-button'\nimport ShopHourPicker from '@/views/components/hour-picker#/hour-picker'\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue'\nimport MoreInput from '@/views/components/more-input#/more-input.vue'\n\nexport default {\n  components: {\n    CheckboxFacilityGroup,\n    CheckboxFacilityItem,\n    MapButton,\n    ShopHourPicker,\n    StImageUpload,\n    MoreInput\n  },\n  serviceInject() {\n    return {\n      pattern: PatternService,\n      addService: AddService,\n      userService: UserService,\n      messageService: MessageService\n    }\n  },\n  rxState() {\n    return {\n      serviceList: this.addService.serviceList$,\n      addLoading: this.addService.loading$,\n      shop_status_add: this.userService.getOptions$('shop.shop_status_add'),\n      unusedShops: this.addService.unusedShops$\n    }\n  },\n  data() {\n    return {\n      shopData: {\n        shop_name: '',\n        province_id: null,\n        city_id: null,\n        district_id: null,\n        address: '',\n        shop_phones: [],\n        shop_status: 2,\n        lat: '',\n        lng: '',\n        service_ids: [],\n        business_time: [],\n        email: '',\n        shop_cover_image: '',\n        buy_shop_id: -1\n      },\n      addMap: {\n        lat: '',\n        lng: '',\n        address: '',\n        province: {},\n        city: {},\n        district: {}\n      },\n      shopMapValidateText: '',\n      // 服务\n      serviceIcon_icon_list: {\n        1: 'WIFI',\n        2: 'park',\n        3: 'shower',\n        4: 'medical',\n        5: 'heating',\n        6: 'snow',\n        7: 'nosmoking',\n        8: 'energy'\n      },\n      fileList: [],\n      shopCoverImageValidateText: '',\n      shopPhoneValidateText: ''\n    }\n  },\n  beforeCreate() {\n    this.form = this.$form.createForm(this)\n  },\n  computed: {\n    shopCoverImageIsOk() {\n      return this.shopCoverImageValidateText === ''\n    },\n    shopMapIsOk() {\n      return this.shopMapValidateText === ''\n    }\n  },\n  methods: {\n    fileChange(data) {\n      if (data.length) {\n        this.shopData.shop_cover_image = data[0].image_key\n      } else {\n        this.shopData.shop_cover_image = ''\n      }\n      this.shopCoverImageValidator()\n    },\n    addMapChange(data) {\n      this.addMap = cloneDeep(data)\n      this.shopData.province_id = data.province.id\n      this.shopData.province_name = data.province.name\n      this.shopData.city_id = data.city.id\n      this.shopData.city_name = data.city.name\n      this.shopData.district_id = data.district.id\n      this.shopData.district_name = data.district.name\n      this.shopData.address = data.address\n      this.shopData.lat = data.lat\n      this.shopData.lng = data.lng\n      this.shopMapValidator()\n    },\n    onShopPhoneChange(list) {\n      this.shopData.shop_phones = list\n      this.shopPhoneValidator()\n    },\n    // 校验门店电话是否输入\n    shopPhoneValidator() {\n      const length = this.shopData.shop_phones.filter(i => i).length\n      this.shopPhoneValidateText = length ? '' : '请输入门店电话'\n      return this.shopPhoneValidateText\n    },\n    // 表单提交\n    onHandleSubmit(e) {\n      // 确认为提交表单校验\n      e.preventDefault()\n      this.shopCoverImageValidator()\n      this.shopMapValidator()\n      this.form.validateFieldsAndScroll((err, values) => {\n        if (this.shopPhoneValidator()) {\n          return\n        }\n        if (!err && this.shopCoverImageIsOk && this.shopMapIsOk) {\n          // 过滤空数据\n          this.shopData.shop_phones = this.shopData.shop_phones.filter(i => i)\n          this.shopData.shop_name = values.shop_name\n          this.shopData.email = values.email\n          this.shopData.buy_shop_id = values.buy_shop_id\n          this.addService.save(this.shopData).subscribe(this.onSubmitSuccess)\n        }\n      })\n    },\n    onSubmitSuccess() {\n      this.messageService.success({\n        content: '新增成功'\n      })\n      this.$router.push({\n        name: 'brand-setting-shop-list'\n      })\n    },\n    // shop_name validatorFn\n    shop_name_validator(rule, value, callback) {\n      if (value === undefined || !value) {\n        // eslint-disable-next-line\n        callback('请填写门店名称')\n      } else if (value && !this.pattern.CN_EN_NUM_SPACE('1-20').test(value)) {\n        // eslint-disable-next-line\n        callback('支持中英文、数字,不超过20个字')\n      } else {\n        // eslint-disable-next-line\n        callback()\n      }\n    },\n    // 校验店招是否已上传\n    shopCoverImageValidator() {\n      this.shopCoverImageValidateText = this.shopData.shop_cover_image\n        ? ''\n        : '请上传店招'\n    },\n    // 校验地址\n    shopMapValidator() {\n      this.shopMapValidateText = this.shopData.lat ? '' : '请选择门店地址'\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/brand/setting/shop"}]}