{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/course/package/upgrade.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/course/package/upgrade.vue","mtime":1600926555953},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.number.constructor\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport { UpgradeService } from \"./upgrade.service.ts\";\nimport { cloneDeep, get } from 'lodash-es';\nimport { timer } from 'rxjs';\nimport BizSoldCourseInfo from '@/views/biz-components/sold/cource-info.vue';\nimport { ruleOptions } from \"./upgrade.config\";\nimport { PatternService } from '@/services/pattern.service';\nimport EditableContractNumber from '@/views/biz-components/contract/editable-contract-number.vue';\nimport MemberSearch from '@/views/biz-components/member/member-search/member-search';\nimport SelectScroll from '@/views/components/select-scroll#/select-scroll';\nexport default {\n  name: 'ModalSoldDealSaleMemberCard',\n  bem: {\n    sale: 'modal-sold-deal-sale'\n  },\n  components: {\n    EditableContractNumber: EditableContractNumber,\n    BizSoldCourseInfo: BizSoldCourseInfo,\n    SelectScroll: SelectScroll\n  },\n  serviceProviders: function serviceProviders() {\n    return [UpgradeService];\n  },\n  serviceInject: function serviceInject() {\n    return {\n      upgradeService: UpgradeService,\n      pattern: PatternService\n    };\n  },\n  rxState: function rxState() {\n    var _this$upgradeService = this.upgradeService,\n        info$ = _this$upgradeService.info$,\n        packageOptions$ = _this$upgradeService.packageOptions$,\n        loading$ = _this$upgradeService.loading$,\n        newPackageInfo$ = _this$upgradeService.newPackageInfo$,\n        effectiveWayOptions$ = _this$upgradeService.effectiveWayOptions$,\n        couponList$ = _this$upgradeService.couponList$,\n        advanceList$ = _this$upgradeService.advanceList$,\n        currentPrice$ = _this$upgradeService.currentPrice$,\n        saleList$ = _this$upgradeService.saleList$;\n    return {\n      loading$: loading$,\n      info$: info$,\n      newPackageInfo$: newPackageInfo$,\n      advanceList$: advanceList$,\n      couponList$: couponList$,\n      effectiveWayOptions$: effectiveWayOptions$,\n      saleList$: saleList$,\n      currentPrice$: currentPrice$,\n      packageOptions$: packageOptions$\n    };\n  },\n  props: {\n    id: {\n      type: Number\n    },\n    memberInfo: {\n      type: Object\n    }\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    return {\n      form: form,\n      show: false,\n      isTeamDisable: true,\n      isPersonalDisabled: true,\n      isTotalDisabled: true,\n      isValidDaysDisable: true,\n      // 定金\n      advanceDropdownVisible: false,\n      advanceList: [],\n      advanceText: '未选择定金',\n      advanceAmount: '',\n      selectAdvance: '',\n      deductionAmount: '',\n      description: '',\n      // 优惠券\n      selectCoupon: '',\n      couponText: '未选择优惠券',\n      couponAmount: '',\n      couponDropdownVisible: false,\n      isExpire: 1,\n      product_id: '',\n      couponList: []\n    };\n  },\n  computed: {\n    decorators: function decorators() {\n      return this.form.decorators(ruleOptions);\n    },\n    validDate: function validDate() {\n      return \"\".concat(moment().format('YYYY-MM-DD'), \"~\").concat(moment().add(this.newPackageInfo$.valid_time, 'days').format('YYYY-MM-DD'));\n    },\n    canChoseCoupon: function canChoseCoupon() {\n      var len = this.couponList$.length;\n      return !!len;\n    },\n    canChoseAdvance: function canChoseAdvance() {\n      var len = this.advanceList$.length;\n      return (this.id || this.product_id) && len;\n    },\n    orderAmountText: function orderAmountText() {\n      return this.currentPrice < 0 ? '小计不能为负' : '';\n    },\n    saleRangeType: function saleRangeType() {\n      return get(this.info.sale_range, 'type', 1);\n    },\n    hasProductInfo: function hasProductInfo() {\n      return JSON.stringify(this.info) !== '{}';\n    }\n  },\n  watch: {\n    selectCoupon: {\n      deep: true,\n      handler: function handler(newVal, oldVal) {\n        this.getPrice(newVal, this.selectAdvance, +this.deductionAmount);\n      }\n    },\n    selectAdvance: {\n      deep: true,\n      handler: function handler(newVal, oldVal) {\n        this.getPrice(this.selectCoupon, newVal, +this.deductionAmount);\n      }\n    },\n    deductionAmount: function deductionAmount(newVal, oldVal) {\n      this.getPrice(this.selectCoupon, this.selectAdvance, +newVal);\n    }\n  },\n  mounted: function mounted() {\n    this.upgradeService.init(this.id).subscribe(function (res) {\n      console.log('初始化页面完成');\n    });\n  },\n  methods: {\n    moment: moment,\n    getDeductionAmount: function getDeductionAmount(value) {\n      console.log(event);\n      this.deductionAmount = value;\n    },\n    // 选择课,筛选\n    handleSelect: function handleSelect(val) {\n      this.product_id = val;\n      this.onResetDiscounts();\n      this.handleGetCourseInfo(val);\n    },\n    // 选择课,搜索\n    handleSearch: function handleSearch(keywords) {\n      this.handleGetList(keywords);\n    },\n    onChangeEffectiveWay: function onChangeEffectiveWay(e) {\n      console.log(e.target.value);\n      this.isExpire = e.target.value;\n    },\n    onClickTeamConfirm: function onClickTeamConfirm() {\n      this.isTeamDisable = !this.isTeamDisable;\n    },\n    onClickPersonalConfirm: function onClickPersonalConfirm() {\n      this.isPersonalDisabled = !this.isPersonalDisabled;\n    },\n    onClickTotalConfirm: function onClickTotalConfirm() {\n      this.isTotalDisabled = !this.isTotalDisabled;\n    },\n    onClickValidDaysConfirm: function onClickValidDaysConfirm() {\n      this.isValidDaysDisable = !this.isValidDaysDisable;\n    },\n    onResetDiscounts: function onResetDiscounts() {\n      console.log('onResetDiscounts'); // 重置优惠券及定金选择\n\n      this.resetCoupon();\n      this.resetAdvance();\n    },\n    // 重新获取优惠券及定金\n    onReGetDiscounts: function onReGetDiscounts(data) {\n      console.log('onReGetDiscounts'); // 如果存在会员id则请求重新拉取优惠券及定金列表\n\n      this.fetchAdvanceList(data);\n      this.fetchCouponList(data);\n    },\n    onMemberChange: function onMemberChange(data) {\n      // 重置优惠券及定金选择\n      this.onResetDiscounts(); // 如果存在会员id则请求重新拉取优惠券及定金列表\n\n      if (data) this.onReGetDiscounts(data);\n    },\n    onSelectAdvance: function onSelectAdvance() {\n      var _this = this;\n\n      timer(200).subscribe(function () {\n        _this.advanceDropdownVisible = false;\n      });\n    },\n    onSelectCoupon: function onSelectCoupon() {\n      var _this2 = this;\n\n      timer(200).subscribe(function () {\n        _this2.couponDropdownVisible = false;\n      });\n    },\n    // 重置定金选择\n    resetAdvance: function resetAdvance() {\n      this.advanceList = [];\n      this.advanceText = '未选择定金';\n      this.selectAdvance = '';\n      this.advanceAmount = '';\n    },\n    // 重置优惠券选择\n    resetCoupon: function resetCoupon() {\n      this.upgradeService.REST_COUPONLIST();\n      this.couponText = '未选择优惠券';\n      this.selectCoupon = '';\n      this.couponAmount = '';\n    },\n    onCancel: function onCancel() {\n      this.resetAdvance();\n    },\n    onSelectAdvanceChange: function onSelectAdvanceChange(data) {\n      if (!data.target.value) {\n        this.advanceAmount = 0;\n        this.advanceText = \"\\u672A\\u9009\\u62E9\\u5B9A\\u91D1\";\n        return;\n      }\n\n      var price = this.advanceList$.filter(function (o) {\n        return o.id === data.target.value;\n      })[0].price;\n      this.advanceAmount = price;\n      this.advanceText = \"\".concat(price, \"\\u5143\");\n    },\n    onSelectCouponChange: function onSelectCouponChange(event) {\n      var id = get(event.target.value, 'id', '');\n\n      if (id) {\n        var price = this.couponList$.filter(function (o) {\n          return o.id === id;\n        })[0].price;\n        this.couponAmount = price;\n        this.couponText = \"\".concat(price, \"\\u5143\");\n      } else {\n        this.resetCoupon();\n      }\n    },\n    // 计算实付金额\n    getPrice: function getPrice(coupon, advance, reduce) {\n      var memberId = this.info$.member_id;\n      var product_id = this.newPackageInfo$.product_id || undefined; // 1会员卡 2 私教课程 3 课程包 4储值卡 5 储物柜租赁\n\n      this.upgradeService.getPrice({\n        product_id: product_id,\n        product_type: 3,\n        coupon_id: coupon ? coupon.id : undefined,\n        member_id: memberId || undefined,\n        advance_id: advance || undefined,\n        reduce_amount: reduce || undefined\n      }).subscribe(function (res) {\n        console.log(res);\n      });\n    },\n    onCreateOrder: function onCreateOrder() {\n      var _this3 = this;\n\n      this.form.validate().then(function (values) {\n        var form = cloneDeep(values);\n        form.package_id = form.productId;\n        form.personal_times = +form.personal_times;\n        form.team_times = +form.team_times;\n        form.contract_number = _this3.info$.contract_number;\n        delete form.productId; // TODO 添加对POS机支付的需求\n\n        _this3.upgradeService.upgrade(_objectSpread({\n          id: _this3.info$.id\n        }, form, {\n          member_id: _this3.info$.member_id\n        })).subscribe(function (result) {\n          _this3.$emit('success', {\n            type: 'create',\n            orderId: result.info.order_id\n          });\n\n          _this3.show = false;\n        });\n      });\n    },\n    onPay: function onPay() {\n      var _this4 = this;\n\n      this.form.validate().then(function (values) {\n        var form = cloneDeep(values);\n        form.package_id = form.productId;\n        form.personal_times = +form.personal_times;\n        form.team_times = +form.team_times;\n        form.contract_number = _this4.info$.contract_number;\n        delete form.productId;\n        console.log(form, _this4.info$.member_id);\n\n        _this4.upgradeService.upgrade(_objectSpread({\n          id: _this4.info$.id\n        }, form, {\n          member_id: _this4.info$.member_id\n        })).subscribe(function (result) {\n          _this4.$emit('success', {\n            type: 'createPay',\n            orderId: result.info.order_id\n          });\n\n          _this4.show = false;\n        });\n      });\n    },\n    // 获取课程列表\n    handleGetList: function handleGetList(keyword) {\n      // if (this.finished) return false\n      this.upgradeService.getUpgradePackageList({\n        keyword: keyword\n      }).subscribe();\n    },\n    // 获取课程详情\n    handleGetCourseInfo: function handleGetCourseInfo(productId) {\n      var _this5 = this;\n\n      this.upgradeService.getNewUpgradePackageInfo(productId).subscribe(function (res) {\n        _this5.$nextTick().then(function () {\n          _this5.form.setFieldsValue({\n            productId: productId,\n            team_times: res.info.team_times,\n            personal_times: res.info.personal_times,\n            valid_days: res.info.valid_time\n          });\n        });\n      });\n    },\n    // 获取优惠券列表\n    fetchCouponList: function fetchCouponList(id) {\n      var package_id = this.form.getFieldValue('productId') || undefined;\n      var member_id = this.form.getFieldValue('member_id') || id;\n\n      if (package_id && member_id) {\n        var params = {\n          member_id: member_id,\n          package_id: package_id\n        };\n        this.upgradeService.getCouponList(params).subscribe();\n      }\n    },\n    // 获取定金列表\n    fetchAdvanceList: function fetchAdvanceList(id) {\n      var _this6 = this;\n\n      var member_id = this.form.getFieldValue('member_id') || id;\n\n      if (member_id) {\n        this.upgradeService.getAdvanceList(member_id).subscribe(function (res) {\n          _this6.advanceList$ = cloneDeep(res.list);\n        });\n      }\n    }\n  }\n};",{"version":3,"sources":["upgrade.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal\n    title=\"课程包升级\"\n    v-model=\"show\"\n    @cancel=\"onCancel\"\n    wrapClassName=\"modal-sold-deal-sale\"\n  >\n    <div :class=\"sale('content')\">\n      <biz-sold-course-info :info=\"info$\" />\n      <st-form :form=\"form\" labelWidth=\"120px\">\n        <div :class=\"sale('sale')\">\n          <st-form-item label=\"课程包名称\" required>\n            <select-scroll\n              v-decorator=\"decorators.productId\"\n              placeholder=\"请选择课\"\n              notFoundContent=\"无搜索结果\"\n              :list=\"packageOptions$\"\n              :loading=\"loading$.getUpgradePackageList\"\n              @select=\"handleSelect\"\n              @search=\"handleSearch\"\n            ></select-scroll>\n            <a-row\n              :class=\"sale('info')\"\n              v-if=\"hasProductInfo\"\n              type=\"flex\"\n              justify=\"space-between\"\n            >\n              <a-col v-if=\"newPackageInfo$.id\" :span=\"22\">\n                <st-info>\n                  <st-info-item label=\"支持转让\">\n                    {{ newPackageInfo$.transfer_status }}\n                  </st-info-item>\n                  <st-info-item label=\"上课范围\">\n                    {{ newPackageInfo$.courseInfo }}\n                  </st-info-item>\n                  <st-info-item label=\"上课门店\">\n                    {{ newPackageInfo$.shopList }}\n                  </st-info-item>\n                </st-info>\n              </a-col>\n            </a-row>\n          </st-form-item>\n          <st-form-item\n            label=\"初始额度\"\n            v-if=\"newPackageInfo$.is_limit === 0\"\n            required\n          >\n            <div :class=\"sale('contract')\">\n              <st-input-number\n                class=\"input-number\"\n                :min=\"1\"\n                :max=\"9999\"\n                v-decorator=\"decorators.valid_days\"\n                placeholder=\"请输入初始额度\"\n                :disabled=\"isValidDaysDisable\"\n              >\n                <div slot=\"addonAfter\">\n                  天\n                </div>\n              </st-input-number>\n              <st-button\n                class=\"create-button\"\n                @click=\"onClickValidDaysConfirm\"\n                v-if=\"!isValidDaysDisable\"\n              >\n                确定\n              </st-button>\n              <st-button\n                class=\"create-button\"\n                @click=\"onClickValidDaysConfirm\"\n                v-else\n              >\n                编辑\n              </st-button>\n            </div>\n          </st-form-item>\n          <st-form-item\n            label=\"团课初始额度\"\n            v-if=\"\n              newPackageInfo$.is_limit === 1 && newPackageInfo$.is_team === 1\n            \"\n            required\n          >\n            <div :class=\"sale('contract')\">\n              <st-input-number\n                class=\"input-number\"\n                :min=\"1\"\n                :max=\"9999\"\n                v-decorator=\"decorators.team_times\"\n                placeholder=\"请输入初始额度\"\n                :disabled=\"isTeamDisable\"\n              >\n                <div slot=\"addonAfter\">\n                  节\n                </div>\n              </st-input-number>\n              <st-button\n                class=\"create-button\"\n                @click=\"onClickTeamConfirm\"\n                v-if=\"!isTeamDisable\"\n              >\n                确定\n              </st-button>\n              <st-button\n                class=\"create-button\"\n                @click=\"onClickTeamConfirm\"\n                v-else\n              >\n                编辑\n              </st-button>\n            </div>\n          </st-form-item>\n          <st-form-item\n            label=\"私教课初始额度\"\n            v-if=\"\n              newPackageInfo$.is_limit === 1 &&\n                newPackageInfo$.is_personal === 1\n            \"\n            required\n          >\n            <div :class=\"sale('contract')\">\n              <st-input-number\n                class=\"input-number\"\n                :min=\"1\"\n                :max=\"9999\"\n                v-decorator=\"decorators.personal_times\"\n                placeholder=\"请输入初始额度\"\n                :disabled=\"isPersonalDisabled\"\n              >\n                <div slot=\"addonAfter\">\n                  节\n                </div>\n              </st-input-number>\n              <st-button\n                class=\"create-button\"\n                @click=\"onClickPersonalConfirm\"\n                v-if=\"!isPersonalDisabled\"\n              >\n                确定\n              </st-button>\n              <st-button\n                class=\"create-button\"\n                @click=\"onClickPersonalConfirm\"\n                v-else\n              >\n                编辑\n              </st-button>\n            </div>\n          </st-form-item>\n          <st-form-item\n            label=\"团课&私教课共\"\n            v-if=\"\n              newPackageInfo$.is_limit === 1 && newPackageInfo$.is_total === 1\n            \"\n            required\n          >\n            <div :class=\"sale('contract')\">\n              <st-input-number\n                class=\"input-number\"\n                :min=\"1\"\n                :max=\"9999\"\n                v-decorator=\"decorators.total_times\"\n                placeholder=\"请输入初始额度\"\n                :disabled=\"isTotalDisabled\"\n              >\n                <div slot=\"addonAfter\">\n                  节\n                </div>\n              </st-input-number>\n              <st-button\n                class=\"create-button\"\n                @click=\"onClickTotalConfirm\"\n                v-if=\"!isTotalDisabled\"\n              >\n                确定\n              </st-button>\n              <st-button\n                class=\"create-button\"\n                @click=\"onClickTotalConfirm\"\n                v-else\n              >\n                编辑\n              </st-button>\n            </div>\n          </st-form-item>\n          <st-form-item label=\"生效方式\" required>\n            <a-radio-group\n              v-decorator=\"decorators.effective_way\"\n              :options=\"effectiveWayOptions$\"\n              @change=\"onChangeEffectiveWay\"\n            />\n          </st-form-item>\n          <st-form-item label=\"有效期\" v-if=\"isExpire === 1\" required>\n            {{ validDate }}\n          </st-form-item>\n          <editable-contract-number\n            v-model=\"info$.contract_number\"\n            :form=\"form\"\n          />\n          <st-form-item label=\"商品价格\" required>\n            <div>{{ newPackageInfo$.sell_price }}元</div>\n          </st-form-item>\n          <st-form-item label=\"升级抵扣\" required>\n            <st-input-number\n              class=\"input-number\"\n              :min=\"0\"\n              :max=\"+newPackageInfo$.sell_price\"\n              v-decorator=\"decorators.deduction_amount\"\n              @change=\"getDeductionAmount\"\n              placeholder=\"请输入初始额度\"\n            >\n              <div slot=\"addonAfter\">\n                元\n              </div>\n            </st-input-number>\n          </st-form-item>\n          <st-form-item :class=\"sale('discounts')\" label=\"优惠券\">\n            <div>\n              <div :class=\"sale('discounts-total')\">\n                <span>{{ couponText }}</span>\n                <a-dropdown\n                  v-model=\"couponDropdownVisible\"\n                  :disabled=\"!canChoseCoupon\"\n                  :class=\"sale({ disabled: !canChoseCoupon })\"\n                  placement=\"bottomRight\"\n                  :getPopupContainer=\"trigger => trigger.parentNode\"\n                  :trigger=\"['click']\"\n                >\n                  <div :class=\"sale('discounts-promotion')\">\n                    <span>{{ couponList$.length }}张可用优惠券</span>\n                    <a-icon type=\"right\" />\n                  </div>\n                  <a-radio-group\n                    v-model=\"selectCoupon\"\n                    @change=\"onSelectCouponChange\"\n                    :class=\"sale('dropdown')\"\n                    slot=\"overlay\"\n                  >\n                    <a-menu>\n                      <a-menu-item @click=\"onSelectCoupon\">\n                        <a-radio :value=\"undefined\">不使用</a-radio>\n                      </a-menu-item>\n                      <a-menu-item\n                        @click=\"onSelectCoupon\"\n                        :key=\"index\"\n                        v-for=\"(item, index) in couponList$\"\n                      >\n                        <a-radio :value=\"item\">\n                          {{ item.name }}{{ item.price }}\n                        </a-radio>\n                      </a-menu-item>\n                    </a-menu>\n                  </a-radio-group>\n                </a-dropdown>\n              </div>\n            </div>\n          </st-form-item>\n          <st-form-item :class=\"sale('discounts')\" label=\"定金抵扣\">\n            <div>\n              <div :class=\"sale('discounts-total')\">\n                <span>{{ advanceText }}</span>\n                <a-dropdown\n                  v-model=\"advanceDropdownVisible\"\n                  :disabled=\"!canChoseAdvance\"\n                  :class=\"\n                    sale({\n                      disabled: !canChoseAdvance\n                    })\n                  \"\n                  placement=\"bottomRight\"\n                  :getPopupContainer=\"trigger => trigger.parentNode\"\n                  :trigger=\"['click']\"\n                >\n                  <div :class=\"sale('discounts-promotion')\">\n                    <span>定金选择</span>\n                    <a-icon type=\"right\" />\n                  </div>\n                  <a-radio-group\n                    v-model=\"selectAdvance\"\n                    @change=\"onSelectAdvanceChange\"\n                    :class=\"sale('dropdown')\"\n                    slot=\"overlay\"\n                  >\n                    <a-menu>\n                      <a-menu-item @click=\"onSelectAdvance\">\n                        <a-radio :value=\"undefined\">不使用</a-radio>\n                      </a-menu-item>\n                      <a-menu-item\n                        @click=\"onSelectAdvance\"\n                        :key=\"index\"\n                        v-for=\"(item, index) in advanceList$\"\n                      >\n                        <a-radio :value=\"item.id\">\n                          定金 {{ item.price || 0 }}\n                        </a-radio>\n                      </a-menu-item>\n                    </a-menu>\n                  </a-radio-group>\n                </a-dropdown>\n              </div>\n            </div>\n          </st-form-item>\n          <div :class=\"sale('remarks')\">\n            <st-form-item label=\"销售人员\" required>\n              <a-select\n                v-decorator=\"decorators.sale_id\"\n                placeholder=\"选择签单的工作人员\"\n                :options=\"saleList$\"\n              />\n            </st-form-item>\n            <st-form-item label=\"备注\" class=\"mg-b0\">\n              <st-textarea\n                v-model=\"description\"\n                :autosize=\"{ minRows: 4, maxRows: 6 }\"\n                :maxlength=\"200\"\n              />\n            </st-form-item>\n          </div>\n        </div>\n      </st-form>\n    </div>\n    <template slot=\"footer\">\n      <div :class=\"sale('footer')\">\n        <div class=\"price\">\n          <span>{{ currentPrice$ }}元</span>\n          <span>订单总额：{{ newPackageInfo$.sell_price }}元</span>\n        </div>\n        <div class=\"button\">\n          <st-button\n            @click=\"onCreateOrder\"\n            :loading=\"loading$.setTransactionOrder\"\n          >\n            创建订单\n          </st-button>\n          <st-button\n            @click=\"onPay\"\n            :loading=\"loading$.setTransactionPay\"\n            type=\"primary\"\n          >\n            立即支付\n          </st-button>\n        </div>\n      </div>\n    </template>\n  </st-modal>\n</template>\n\n<script>\nimport moment from 'moment'\nimport { UpgradeService } from './upgrade.service.ts'\nimport { cloneDeep, get } from 'lodash-es'\nimport { timer } from 'rxjs'\nimport BizSoldCourseInfo from '@/views/biz-components/sold/cource-info.vue'\nimport { ruleOptions } from './upgrade.config'\nimport { PatternService } from '@/services/pattern.service'\nimport EditableContractNumber from '@/views/biz-components/contract/editable-contract-number.vue'\nimport MemberSearch from '@/views/biz-components/member/member-search/member-search'\nimport SelectScroll from '@/views/components/select-scroll#/select-scroll'\n\nexport default {\n  name: 'ModalSoldDealSaleMemberCard',\n  bem: {\n    sale: 'modal-sold-deal-sale'\n  },\n  components: {\n    EditableContractNumber,\n    BizSoldCourseInfo,\n    SelectScroll\n  },\n  serviceProviders() {\n    return [UpgradeService]\n  },\n  serviceInject() {\n    return {\n      upgradeService: UpgradeService,\n      pattern: PatternService\n    }\n  },\n  rxState() {\n    const {\n      info$,\n      packageOptions$,\n      loading$,\n      newPackageInfo$,\n      effectiveWayOptions$,\n      couponList$,\n      advanceList$,\n      currentPrice$,\n      saleList$\n    } = this.upgradeService\n    return {\n      loading$,\n      info$,\n      newPackageInfo$,\n      advanceList$,\n      couponList$,\n      effectiveWayOptions$,\n      saleList$,\n      currentPrice$,\n      packageOptions$\n    }\n  },\n  props: {\n    id: {\n      type: Number\n    },\n    memberInfo: {\n      type: Object\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n\n    return {\n      form,\n      show: false,\n      isTeamDisable: true,\n      isPersonalDisabled: true,\n      isTotalDisabled: true,\n      isValidDaysDisable: true,\n      // 定金\n      advanceDropdownVisible: false,\n      advanceList: [],\n      advanceText: '未选择定金',\n      advanceAmount: '',\n      selectAdvance: '',\n      deductionAmount: '',\n      description: '',\n      // 优惠券\n      selectCoupon: '',\n      couponText: '未选择优惠券',\n      couponAmount: '',\n      couponDropdownVisible: false,\n      isExpire: 1,\n      product_id: '',\n      couponList: []\n    }\n  },\n  computed: {\n    decorators() {\n      return this.form.decorators(ruleOptions)\n    },\n    validDate() {\n      return `${moment().format('YYYY-MM-DD')}~${moment()\n        .add(this.newPackageInfo$.valid_time, 'days')\n        .format('YYYY-MM-DD')}`\n    },\n    canChoseCoupon() {\n      let len = this.couponList$.length\n      return !!len\n    },\n    canChoseAdvance() {\n      let len = this.advanceList$.length\n      return (this.id || this.product_id) && len\n    },\n    orderAmountText() {\n      return this.currentPrice < 0 ? '小计不能为负' : ''\n    },\n    saleRangeType() {\n      return get(this.info.sale_range, 'type', 1)\n    },\n    hasProductInfo() {\n      return JSON.stringify(this.info) !== '{}'\n    }\n  },\n  watch: {\n    selectCoupon: {\n      deep: true,\n      handler(newVal, oldVal) {\n        this.getPrice(newVal, this.selectAdvance, +this.deductionAmount)\n      }\n    },\n    selectAdvance: {\n      deep: true,\n      handler(newVal, oldVal) {\n        this.getPrice(this.selectCoupon, newVal, +this.deductionAmount)\n      }\n    },\n    deductionAmount(newVal, oldVal) {\n      this.getPrice(this.selectCoupon, this.selectAdvance, +newVal)\n    }\n  },\n  mounted() {\n    this.upgradeService.init(this.id).subscribe(res => {\n      console.log('初始化页面完成')\n    })\n  },\n  methods: {\n    moment,\n    getDeductionAmount(value) {\n      console.log(event)\n      this.deductionAmount = value\n    },\n    // 选择课,筛选\n    handleSelect(val) {\n      this.product_id = val\n      this.onResetDiscounts()\n      this.handleGetCourseInfo(val)\n    },\n    // 选择课,搜索\n    handleSearch(keywords) {\n      this.handleGetList(keywords)\n    },\n    onChangeEffectiveWay(e) {\n      console.log(e.target.value)\n      this.isExpire = e.target.value\n    },\n    onClickTeamConfirm() {\n      this.isTeamDisable = !this.isTeamDisable\n    },\n    onClickPersonalConfirm() {\n      this.isPersonalDisabled = !this.isPersonalDisabled\n    },\n    onClickTotalConfirm() {\n      this.isTotalDisabled = !this.isTotalDisabled\n    },\n    onClickValidDaysConfirm() {\n      this.isValidDaysDisable = !this.isValidDaysDisable\n    },\n    onResetDiscounts() {\n      console.log('onResetDiscounts')\n      // 重置优惠券及定金选择\n      this.resetCoupon()\n      this.resetAdvance()\n    },\n    // 重新获取优惠券及定金\n    onReGetDiscounts(data) {\n      console.log('onReGetDiscounts')\n      // 如果存在会员id则请求重新拉取优惠券及定金列表\n      this.fetchAdvanceList(data)\n      this.fetchCouponList(data)\n    },\n    onMemberChange(data) {\n      // 重置优惠券及定金选择\n      this.onResetDiscounts()\n      // 如果存在会员id则请求重新拉取优惠券及定金列表\n      if (data) this.onReGetDiscounts(data)\n    },\n    onSelectAdvance() {\n      timer(200).subscribe(() => {\n        this.advanceDropdownVisible = false\n      })\n    },\n    onSelectCoupon() {\n      timer(200).subscribe(() => {\n        this.couponDropdownVisible = false\n      })\n    },\n    // 重置定金选择\n    resetAdvance() {\n      this.advanceList = []\n      this.advanceText = '未选择定金'\n      this.selectAdvance = ''\n      this.advanceAmount = ''\n    },\n    // 重置优惠券选择\n    resetCoupon() {\n      this.upgradeService.REST_COUPONLIST()\n      this.couponText = '未选择优惠券'\n      this.selectCoupon = ''\n      this.couponAmount = ''\n    },\n    onCancel() {\n      this.resetAdvance()\n    },\n    onSelectAdvanceChange(data) {\n      if (!data.target.value) {\n        this.advanceAmount = 0\n        this.advanceText = `未选择定金`\n        return\n      }\n      let price = this.advanceList$.filter(o => o.id === data.target.value)[0]\n        .price\n      this.advanceAmount = price\n      this.advanceText = `${price}元`\n    },\n    onSelectCouponChange(event) {\n      let id = get(event.target.value, 'id', '')\n      if (id) {\n        let price = this.couponList$.filter(o => o.id === id)[0].price\n        this.couponAmount = price\n        this.couponText = `${price}元`\n      } else {\n        this.resetCoupon()\n      }\n    },\n    // 计算实付金额\n    getPrice(coupon, advance, reduce) {\n      const memberId = this.info$.member_id\n      const product_id = this.newPackageInfo$.product_id || undefined\n      // 1会员卡 2 私教课程 3 课程包 4储值卡 5 储物柜租赁\n      this.upgradeService\n        .getPrice({\n          product_id,\n          product_type: 3,\n          coupon_id: coupon ? coupon.id : undefined,\n          member_id: memberId || undefined,\n          advance_id: advance || undefined,\n          reduce_amount: reduce || undefined\n        })\n        .subscribe(res => {\n          console.log(res)\n        })\n    },\n    onCreateOrder() {\n      this.form.validate().then(values => {\n        const form = cloneDeep(values)\n        form.package_id = form.productId\n        form.personal_times = +form.personal_times\n        form.team_times = +form.team_times\n        form.contract_number = this.info$.contract_number\n        delete form.productId\n        // TODO 添加对POS机支付的需求\n        this.upgradeService\n          .upgrade({\n            id: this.info$.id,\n            ...form,\n            member_id: this.info$.member_id\n          })\n          .subscribe(result => {\n            this.$emit('success', {\n              type: 'create',\n              orderId: result.info.order_id\n            })\n            this.show = false\n          })\n      })\n    },\n    onPay() {\n      this.form.validate().then(values => {\n        const form = cloneDeep(values)\n        form.package_id = form.productId\n        form.personal_times = +form.personal_times\n        form.team_times = +form.team_times\n        form.contract_number = this.info$.contract_number\n        delete form.productId\n        console.log(form, this.info$.member_id)\n        this.upgradeService\n          .upgrade({\n            id: this.info$.id,\n            ...form,\n            member_id: this.info$.member_id\n          })\n          .subscribe(result => {\n            this.$emit('success', {\n              type: 'createPay',\n              orderId: result.info.order_id\n            })\n            this.show = false\n          })\n      })\n    },\n    // 获取课程列表\n    handleGetList(keyword) {\n      // if (this.finished) return false\n      this.upgradeService\n        .getUpgradePackageList({\n          keyword\n        })\n        .subscribe()\n    },\n    // 获取课程详情\n    handleGetCourseInfo(productId) {\n      this.upgradeService.getNewUpgradePackageInfo(productId).subscribe(res => {\n        this.$nextTick().then(() => {\n          this.form.setFieldsValue({\n            productId,\n            team_times: res.info.team_times,\n            personal_times: res.info.personal_times,\n            valid_days: res.info.valid_time\n          })\n        })\n      })\n    },\n    // 获取优惠券列表\n    fetchCouponList(id) {\n      const package_id = this.form.getFieldValue('productId') || undefined\n      const member_id = this.form.getFieldValue('member_id') || id\n      if (package_id && member_id) {\n        const params = {\n          member_id,\n          package_id\n        }\n        this.upgradeService.getCouponList(params).subscribe()\n      }\n    },\n    // 获取定金列表\n    fetchAdvanceList(id) {\n      let member_id = this.form.getFieldValue('member_id') || id\n      if (member_id) {\n        this.upgradeService.getAdvanceList(member_id).subscribe(res => {\n          this.advanceList$ = cloneDeep(res.list)\n        })\n      }\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/sold/course/package"}]}