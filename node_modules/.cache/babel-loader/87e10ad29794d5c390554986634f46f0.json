{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/fragments/course/set-price.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/fragments/course/set-price.vue","mtime":1598250255820},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { remove } from 'lodash-es';\nimport SelectCoachLevel from '@/views/fragments/coach/select-coach-level';\nimport { UserService } from '@/services/user.service';\nexport default {\n  name: 'SetPrice',\n  serviceInject: function serviceInject() {\n    return {\n      userService: UserService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      personalCourseTransferUnitOptions: this.userService.getOptions$('personal_course.transfer_unit'),\n      brand: this.userService.brand$\n    };\n  },\n  computed: {\n    /**\n     *私教课程定价模式 1、教练谈单 2、统一标价\n     */\n    saleModel: function saleModel() {\n      return this.brand.saleModel;\n    },\n\n    /**\n     *定价模式 1、教练统一定价 2、教练分级定价\n     */\n    priceModel: function priceModel() {\n      return this.brand.priceModel;\n    }\n  },\n  watch: {\n    priceGradient: {\n      handler: function handler(val) {\n        this.$emit('change', this.priceGradientFilter(val));\n      },\n      deep: true\n    },\n    value: {\n      handler: function handler(val) {\n        this.priceGradient = val;\n      },\n      deep: true\n    }\n  },\n  props: {\n    value: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    }\n  },\n  data: function data() {\n    return {\n      priceGradient: []\n    };\n  },\n  created: function created() {\n    // 获取定价模式\n    this.initPriceGradient();\n  },\n  methods: {\n    initPriceGradient: function initPriceGradient() {\n      this.priceGradient = this.value.length ? this.value : [{\n        level_id: 0,\n        prices: []\n      }];\n    },\n    onChange: function onChange(e) {\n      this.priceSetting = e.target.value;\n    },\n    del: function del(key, rowIndex) {\n      this.priceGradient[key].prices.splice(rowIndex, 1);\n      this.priceGradient = _toConsumableArray(this.priceGradient);\n    },\n    addRecord: function addRecord() {\n      var newRecord = {\n        level_id: 0,\n        single_sell: 0,\n        single_price: '',\n        prices: []\n      };\n      this.priceGradient.push(newRecord);\n    },\n    delRecord: function delRecord(key) {\n      var priceGradient = this.priceGradient;\n      remove(priceGradient, function (item, index) {\n        return index === key;\n      });\n      this.priceGradient = _toConsumableArray(priceGradient);\n    },\n    addPriceRecord: function addPriceRecord(key) {\n      var newRecord = {\n        id: 0,\n        priceGradient: '',\n        price: '',\n        serviceFee: '',\n        transfer_unit: 1\n      };\n\n      if (!this.priceGradient[key].prices) {\n        this.priceGradient[key].prices = [];\n      }\n\n      this.priceGradient = _toConsumableArray(this.priceGradient);\n      this.priceGradient[key].prices.push(newRecord);\n    },\n    onLevelChange: function onLevelChange(val, key) {\n      this.priceGradient[key].level_id = val;\n    },\n    priceGradientFilter: function priceGradientFilter(priceGradient) {\n      var _this = this;\n\n      var DEFAULT_MAX_NUM = 10000;\n      priceGradient.map(function (item, index) {\n        var prices = item.prices || [];\n        var pricesLen = prices.length;\n        prices.map(function (price, i) {\n          delete price.serviceFee;\n          delete price.priceGradient;\n          delete price.price;\n\n          if (_this.saleModel === 1) {\n            // 教练谈单模式，没有固定价格\n            price.sell_price = 0;\n          }\n\n          if (_this.saleModel === 2) {\n            // 统一标价模式下，没有价格梯度，传0\n            price.min_sell_price = 0;\n            price.max_sell_price = 0;\n          }\n\n          if (pricesLen === 1) {\n            prices[0].max_sale = DEFAULT_MAX_NUM;\n          }\n\n          if (i > 0) {\n            prices[i - 1].max_sale = price.min_sale - 1;\n\n            if (i === pricesLen - 1) {\n              price.max_sale = DEFAULT_MAX_NUM;\n            }\n          }\n\n          return price;\n        });\n        return item;\n      });\n      return priceGradient;\n    }\n  },\n  components: {\n    SelectCoachLevel: SelectCoachLevel\n  }\n};",null]}