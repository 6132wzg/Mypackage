{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"shop-sold-course-info-package\"],{\"577b\":function(e,o,t){\"use strict\";t.r(o),t.d(o,\"InfoService\",(function(){return d}));var a,n,s=t(\"d225\"),r=t(\"b0b4\"),c=t(\"9ab4\"),i=t(\"0cd5\"),u=t(\"df29\"),p=t(\"287e\"),l=t(\"c4cc\"),_=t(\"2cbb\"),d=function(){function e(o,t){Object(s[\"a\"])(this,e),this.courseApi=o,this.authService=t,this.packageInfo$=new u[\"d\"]({}),this.loading$=new u[\"d\"]({}),this.auth$=new u[\"d\"]({}),this.id=\"\",this.authTabs$=this.authService.getAuthTabs$(\"shop-sold-course-info-package-info\",{withQuery:[\"id\"]})}return Object(r[\"a\"])(e,[{key:\"getPackageInfo\",value:function(e,o){var t=this;return this.courseApi.getCourseInfo(e,o).pipe(Object(l[\"a\"])((function(e){t.packageInfo$.commit((function(){return e.info})),t.auth$.commit((function(){return e.auth}))})))}},{key:\"unFreeze\",value:function(e){return this.courseApi.unFreezeCourse(e,\"package\")}},{key:\"beforeEach\",value:function(e,o){return this.id=e.meta.query.id,this.getPackageInfo(e.meta.query.id,\"package\")}}]),e}();d=Object(c[\"b\"])([Object(i[\"b\"])(),Object(c[\"d\"])(\"design:paramtypes\",[\"function\"===typeof(a=\"undefined\"!==typeof p[\"a\"]&&p[\"a\"])?a:Object,\"function\"===typeof(n=\"undefined\"!==typeof _[\"a\"]&&_[\"a\"])?n:Object])],d)},\"808d\":function(e,o,t){\"use strict\";t.d(o,\"a\",(function(){return i}));var a=t(\"e9b9\"),n=t(\"4f50\"),s=t(\"8ac6\");function r(e){return!Object(s[\"a\"])(e)&&e-parseFloat(e)+1>=0}var c=t(\"9e46\");function i(e,o,t){void 0===e&&(e=0);var s=-1;return r(o)?s=Number(o)<1?1:Number(o):Object(c[\"a\"])(o)&&(t=o),Object(c[\"a\"])(t)||(t=n[\"a\"]),new a[\"a\"]((function(o){var a=r(e)?e:+e-t.now();return t.schedule(u,a,{index:0,period:s,subscriber:o})}))}function u(e){var o=e.index,t=e.period,a=e.subscriber;if(a.next(o),!a.closed){if(-1===t)return a.complete();e.index=o+1,this.schedule(e,t)}}},aae5:function(e,o,t){\"use strict\";t.r(o);var a=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t(\"st-panel-layout\",{class:e.basic()},[t(\"st-panel\",{attrs:{title:\"课程包详情(\"+(e.packageInfo.effective_state?\"已生效\":\"未生效\")+\")\"}},[t(\"div\",{attrs:{slot:\"actions\"},slot:\"actions\"},[t(\"st-btn-actions\",{attrs:{options:e.btnOptions}})],1),t(\"a-row\",{attrs:{gutter:24}},[t(\"a-col\",{attrs:{span:9}},[t(\"st-info\",[t(\"st-info-item\",{attrs:{label:\"课程名称\"}},[e._v(\"\\n            \"+e._s(e.packageInfo.course_name)+\"\\n          \")]),t(\"st-info-item\",{attrs:{label:\"类型\"}},[e._v(e._s(e.packageInfo.type))]),t(\"st-info-item\",{attrs:{label:\"剩余课时\"}},[e.packageInfo.is_limit===e.IS_LIMIT.NO_LIMIT&&e.packageInfo.package_type===e.PACKAGE_TYPE.RANGE_COURSE?t(\"span\",[e._v(\"\\n              不限次\\n            \")]):t(\"span\",[e._v(\"\\n              \"+e._s(e.packageInfo.personal_course_remain)+\"节私教课,\"+e._s(e.packageInfo.team_course_remain)+\"节团体课\\n            \")])]),e.packageInfo.effective_state?t(\"st-info-item\",{attrs:{label:\"有效期\"}},[e._v(\"\\n            \"+e._s(e.moment(1e3*e.packageInfo.course_buy_time).format(\"YYYY-MM-DD HH:mm\"))+\"\\n            至\\n            \"+e._s(e.moment(1e3*e.packageInfo.course_end_time).format(\"YYYY-MM-DD HH:mm\"))+\"\\n          \")]):e._e(),t(\"st-info-item\",{staticClass:\"mg-b16\",attrs:{label:\"合同编号\"}},[e._v(\"\\n            \"+e._s(e.packageInfo.contract_number)+\"\\n          \")]),t(\"st-info-item\",{attrs:{label:\"约课限制\"}},[e._v(\"\\n            \"+e._s(e.packageInfo.reserve_limit)+\"\\n          \")])],1)],1),t(\"a-col\",{attrs:{span:9}},[t(\"st-info\",[t(\"st-info-item\",{attrs:{label:\"所属会员\"}},[e._v(\"\\n            \"+e._s(e.packageInfo.member_name)+\"\\n          \")]),t(\"st-info-item\",{attrs:{label:e.packageInfo.is_minors?\"家长手机号\":\"手机号\"}},[e.packageInfo.is_minors?t(\"span\",[e._v(\"\\n              \"+e._s(e.packageInfo.parent_mobile)+\"(\"+e._s(e.packageInfo.parent_user_role)+\")\\n            \")]):t(\"span\",[e._v(e._s(e.packageInfo.mobile))])]),t(\"st-info-item\",{attrs:{label:\"订单号\"}},[e._v(\"\\n            \"+e._s(e.packageInfo.order_id)+\"\\n          \")]),t(\"st-info-item\",{attrs:{label:\"订单状态\"}},[e._v(\"\\n            \"+e._s(e._f(\"enumFilter\")(e.packageInfo.order_status,\"sold_common.order_status\"))+\"\\n          \")]),t(\"st-info-item\",{attrs:{label:\"成员\"}},[t(\"st-overflow-text\",{attrs:{value:e.packageInfo.members,\"max-width\":\"120px\"}})],1)],1)],1),t(\"a-col\",{attrs:{span:6}},[t(\"st-info\",[t(\"st-info-item\",{attrs:{label:\"允许转让\"}},[e._v(\"\\n            \"+e._s(e._f(\"enumFilter\")(e.packageInfo.is_transferable,\"sold_common.is_transferable\"))+\"\\n          \")]),0!==e.packageInfo.is_transferable?t(\"st-info-item\",{attrs:{label:\"转让手续费\"}},[e._v(\"\\n            \"+e._s(e.packageInfo.transfer_num)+e._s(e._f(\"enumFilter\")(e.packageInfo.transfer_unit,\"package_course.transfer_unit\"))+\"\\n          \")]):e._e(),t(\"st-info-item\",{attrs:{label:\"当前状态\"}},[e._v(\"\\n            \"+e._s(e._f(\"enumFilter\")(e.packageInfo.course_status,\"sold_common.course_status\"))+\"\\n          \")]),t(\"st-info-item\",{attrs:{label:\"上课范围\"}},[t(\"a-popover\",{attrs:{title:e.packageInfo.course_range.range_name}},[t(\"template\",{slot:\"content\"},[1===e.rangeType?t(\"st-table\",{class:e.basic(\"popover-content\"),attrs:{columns:e.courseColumns,dataSource:e.courseTabData,pagination:!1},scopedSlots:e._u([{key:\"support_shop\",fn:function(e){return[t(\"st-overflow-text\",{attrs:{value:e,\"max-width\":\"100px\"}})]}}],null,!1,350509505)}):e._e(),2===e.rangeType?t(\"st-table\",{class:e.basic(\"popover-content\"),attrs:{columns:e.courseColumns,dataSource:e.courseTabData,pagination:!1},scopedSlots:e._u([{key:\"expandedRowRender\",fn:function(o,a){return t(\"st-table\",{attrs:{columns:1===a?e.innerColumnsPersonal:e.innerColumnsTeam,dataSource:1===a?e.innerDataPersonal:e.innerDataTeam,pagination:!1},scopedSlots:e._u([{key:\"course_name\",fn:function(e){return[t(\"st-overflow-text\",{attrs:{value:e,needMaxContainerWidth:\"\",\"max-width\":\"100px\"}})]}},{key:\"support_shop\",fn:function(e){return[t(\"st-overflow-text\",{attrs:{value:e,needMaxContainerWidth:\"\",\"max-width\":\"100px\"}})]}},{key:\"levels\",fn:function(e){return[t(\"st-overflow-text\",{attrs:{value:e,needMaxContainerWidth:\"\",\"max-width\":\"100px\"}})]}}],null,!1,1507660584)})}}],null,!1,4036993156)}):e._e(),3===e.rangeType?t(\"st-table\",{class:e.basic(\"popover-content\"),attrs:{columns:e.courseColumns,dataSource:e.courseTabData,pagination:!1},scopedSlots:e._u([{key:\"expandedRowRender\",fn:function(o,a){return t(\"st-table\",{attrs:{columns:e.innerColumnsFix,dataSource:1===a?e.innerDataFixPersonal:e.innerDataFixTeam,pagination:!1}})}}],null,!1,2678008469)}):e._e()],1),t(\"a\",{attrs:{type:\"primary\"}},[e._v(e._s(e.packageInfo.course_range.range_name))])],2)],1)],1)],1),t(\"a-col\",{attrs:{span:24}},[t(\"st-info\",[t(\"st-info-item\",{staticClass:\"mg-b0\",attrs:{label:\"备注\"}},[e._v(\"\\n            \"+e._s(e.packageInfo.description||\"无\")+\"\\n          \")])],1)],1)],1)],1),t(\"st-panel\",{staticClass:\"mg-t12\",attrs:{app:\"\",tabs:e.authTabs}},[t(\"router-view\")],1)],1)},n=[],s=t(\"577b\"),r=function(e){return[{if:e.auth[\"shop:sold:sold_package_course|export_contract\"],text:\"查看合同\",click:e.toContract},{if:e.auth[\"shop:sold:sold_package_course|frozen\"],text:\"冻结\",click:e.onFreeze},{if:e.auth[\"shop:sold:sold_package_course|upgrade\"],text:\"升级\",click:e.onUpgrade},{if:e.auth[\"shop:sold:sold_package_course|transfer\"],text:\"转让\",click:e.onTransfer},{if:e.auth[\"shop:sold:sold_package_course|valid\"],text:\"立即生效\",click:e.onValid},{if:e.auth[\"shop:sold:sold_package_course|member_change\"],text:\"成员变更\",click:e.onMemberChange},{if:e.auth[\"shop:sold:sold_package_course|edit_date\"],text:\"有效期修改\",click:e.onEditDate},{if:e.auth[\"shop:sold:sold_package_course|reduce_times\"],text:\"扣次\",click:e.onReduceTimes},{if:e.auth[\"brand_shop:order:order|refund\"],text:\"退款\",click:e.onRefund},{if:e.auth[\"shop:sold:sold_package_course|unfrozen\"],text:\"取消冻结\",click:e.onUnfreeze},{if:e.auth[\"shop:sold:sold_package_course|course_num\"],text:\"修改剩余课时\",click:e.onSurplus},{text:\"修改合同备注\",click:e.onEditContractDescription,if:e.auth[\"shop:sold:sold_package_course|edit_contract_remark\"]},{text:\"对内备注\",click:e.onInternalNote,if:e.auth[\"shop:sold:sold_package_course|internal_description\"]}]},c=t(\"c32d\"),i=t.n(c),u=t(\"5820\"),p=t(\"1ed9\"),l=t(\"ac94\"),_=t(\"50d1\"),d=t(\"cf81\"),f=t(\"acd0\"),m=t(\"d46a\"),h=t(\"8ad0\"),g=t(\"feaa\"),k=t(\"f555\"),I=t(\"1945\"),v=t(\"c262\"),b=t(\"1687\"),x={name:\"PageShopSoldCoursePackageInfo\",bem:{basic:\"page-shop-sold-info\"},modals:{SoldCourseFreeze:p[\"a\"],SoldCourseRefund:l[\"a\"],SoldCourseSurplus:_[\"a\"],SoldCourseValid:f[\"a\"],DealGathering:k[\"a\"],SoldCoursePackageDeduction:h[\"a\"],SoldCoursePackageUpdateExpirationDate:m[\"a\"],SoldCoursePackageMembeChange:g[\"a\"],SoldCoursePackageUpgrade:u[\"a\"],SoldCourseTransfer:d[\"a\"]},data:function(){return{PACKAGE_TYPE:I[\"b\"],IS_LIMIT:I[\"a\"]}},serviceInject:function(){return{infoService:s[\"InfoService\"]}},hooks:function(){return{internalNoteActions:Object(v[\"a\"])(),contractActions:Object(b[\"a\"])(this)}},rxState:function(){return{packageInfo:this.infoService.packageInfo$,authTabs:this.infoService.authTabs$,auth:this.infoService.auth$}},computed:{btnOptions:r,rangeType:function(){return this.packageInfo.course_range?this.packageInfo.course_range.range_type:1},courseColumns:function(){var e=[{title:\"课程类型\",dataIndex:\"course_name\",key:\"course_name\"},{title:\"上课门店\",dataIndex:\"support_shop\",key:\"support_shop\",width:\"120px\",scopedSlots:{customRender:\"support_shop\"}},{title:\"节数\",dataIndex:\"course_num\",key:\"course_num\"},{title:\"课时费\",dataIndex:\"course_price\",key:\"course_price\"},{title:\"小计\",dataIndex:\"pay_amount\",key:\"pay_amount\"}];return 3===this.rangeType&&e.splice(3,1),this.packageInfo.package_type!==I[\"b\"].ALL_COURSE&&(this.packageInfo.is_limit===I[\"a\"].NO_LIMIT&&(e.splice(2,1),e.splice(3,1)),e.splice(1,1)),e},courseTabData:function(){var e=[],o=this.packageInfo.course_range?this.packageInfo.course_range.team:{},t=this.packageInfo.course_range?this.packageInfo.course_range.personal:{},a=\"\";return o.support_shop&&(a=o.support_shop),t.support_shop&&(a=t.support_shop),e.push({key:0,support_shop:a,course_name:o.course_name,course_num:o.course_num,course_price:o.course_price,pay_amount:o.pay_amount}),t.course_name&&e.push({key:1,support_shop:a,course_name:t.course_name,course_num:t.course_num,course_price:t.course_price,pay_amount:t.pay_amount}),e},innerColumnsTeam:function(){var e=[{title:\"课程名称\",dataIndex:\"course_name\",key:\"course_name\",scopedSlots:{customRender:\"course_name\"},width:\"120px\"},{title:\"上课门店\",dataIndex:\"support_shop\",key:\"support_shop\",width:\"120px\",scopedSlots:{customRender:\"support_shop\"}}];return e},innerDataTeam:function(){return this.packageInfo.course_range.team.courses},innerColumnsPersonal:function(){var e=[{title:\"课程名称\",dataIndex:\"course_name\",key:\"course_name\",width:\"120px\",scopedSlots:{customRender:\"course_name\"}},{title:\"上课门店\",dataIndex:\"support_shop\",key:\"support_shop\",width:\"120px\",scopedSlots:{customRender:\"support_shop\"}},{title:\"\".concat(this.$c(\"coach\"),\"等级\"),dataIndex:\"levels\",key:\"levels\",scopedSlots:{customRender:\"levels\"}}];return e},innerDataPersonal:function(){for(var e=[],o=0;o<this.packageInfo.course_range.personal.courses.length;o++)e.push({key:o,support_shop:this.packageInfo.course_range.personal.courses[o].support_shop,course_name:this.packageInfo.course_range.personal.courses[o].course_name,levels:this.packageInfo.course_range.personal.courses[o].levels.join(\",\")});return e},innerColumnsFix:function(){var e=[{title:\"课程名称\",dataIndex:\"course_name\",key:\"course_name\"},{title:\"上课门店\",dataIndex:\"support_shop\",key:\"support_shop\",scopedSlots:{customRender:\"support_shop\"}},{title:\"节数\",dataIndex:\"course_num_init\",key:\"course_num_init\"},{title:\"课时费\",dataIndex:\"course_price\",key:\"course_price\"},{title:\"总价\",dataIndex:\"course_amount\",key:\"course_amount\"}];return e},innerDataFixPersonal:function(){for(var e=[],o=0;o<this.packageInfo.course_range.personal.courses.length;o++)e.push({key:o,course_name:this.packageInfo.course_range.personal.courses[o].course_name,support_shop:this.packageInfo.course_range.personal.courses[o].support_shop,course_num_init:this.packageInfo.course_range.personal.courses[o].course_num_init,course_price:this.packageInfo.course_range.personal.courses[o].course_price,course_amount:this.packageInfo.course_range.personal.courses[o].course_amount,levels:this.packageInfo.course_range.personal.courses[o].levels.join(\",\")});return this.packageInfo.course_range.personal.courses},innerDataFixTeam:function(){for(var e=[],o=0;o<this.packageInfo.course_range.team.courses.length;o++)e.push({key:o,course_name:this.packageInfo.course_range.team.courses[o].course_name,support_shop:this.packageInfo.course_range.team.courses[o].support_shop,course_num_init:this.packageInfo.course_range.team.courses[o].course_num_init,course_price:this.packageInfo.course_range.team.courses[o].course_price,course_amount:this.packageInfo.course_range.team.courses[o].course_amount});return e}},methods:{moment:i.a,onEditDate:function(){var e=this.packageInfo.id;this.$modalRouter.push({name:\"sold-course-package-update-expiration-date\",props:{id:e},on:{success:function(){}}})},onMemberChange:function(){var e=this.packageInfo.id;this.$modalRouter.push({name:\"sold-course-package-membe-change\",props:{id:e},on:{success:function(){}}})},onReduceTimes:function(){var e=this,o=this.packageInfo.id;this.$modalRouter.push({name:\"sold-course-package-deduction\",props:{id:o},on:{success:function(){e.successTip()}}})},onSurplus:function(){var e=this,o=this.packageInfo.effective_state?\"\".concat(i()(1e3*this.packageInfo.course_buy_time).format(\"YYYY-MM-DD HH:mm\"),\" 至 \").concat(i()(1e3*this.packageInfo.course_end_time).format(\"YYYY-MM-DD HH:mm\")):\"--\",t={id:this.infoService.id,courseName:this.packageInfo.course_name,time:o};this.$modalRouter.push({name:\"sold-course-surplus\",props:{courseType:\"coursePackage\",courseData:t},on:{success:function(){e.$router.reload()}}})},toContract:function(){var e=this.packageInfo,o=\"\".concat(window.location.origin,\"/common/contract-preview?id=\").concat(e.order_id);window.open(o)},onUpgrade:function(){var e=this,o=this.packageInfo.id;this.$modalRouter.push({name:\"sold-course-package-upgrade\",props:{id:o},on:{success:function(o){\"create\"===o.type?(e.$router.reload(),e.onClear()):\"createPay\"===o.type&&e.$modalRouter.push({name:\"deal-gathering\",props:{order_id:o.orderId,type:\"package\"},on:{success:function(){e.$router.reload(),e.onClear()}}})}}})},onFreeze:function(){var e=this;this.$modalRouter.push({name:\"sold-course-freeze\",props:{type:\"package\",id:this.infoService.id,courseName:this.packageInfo.course_name,courseNum:this.packageInfo.remain_course_num,courseEndTime:i()(1e3*this.packageInfo.course_end_time),time:\"\".concat(i()(1e3*this.packageInfo.course_buy_time).format(\"YYYY-MM-DD HH:mm\"),\" 至 \").concat(i()(1e3*this.packageInfo.course_end_time).format(\"YYYY-MM-DD HH:mm\"))},on:{success:function(){e.$router.reload()}}})},onUnfreeze:function(){var e=this;this.$confirm({title:\"提示\",content:\"是否取消冻结？\",maskClosable:!0,onOk:function(){return e.infoService.unFreeze(e.infoService.id).toPromise().then((function(){e.$router.reload()}))}})},onTransfer:function(){var e=this;this.$modalRouter.push({name:\"sold-course-transfer\",props:{type:\"package\",id:this.infoService.id},on:{success:function(){e.$router.reload()}}})},onValid:function(){var e=this;this.$modalRouter.push({name:\"sold-course-valid\",props:{info:this.packageInfo},on:{success:function(){e.$router.reload()}}})},onRefund:function(){var e=this;this.$modalRouter.push({name:\"sold-course-refund\",props:{id:this.infoService.id,type:\"package\"},on:{success:function(){e.$router.reload()}}})},onInternalNote:function(){this.internalNoteActions.onOpenModal({id:this.infoService.id})},onEditContractDescription:function(){var e=this.packageInfo,o=e.order_id,t=e.description;this.contractActions.editDescription({order_id:o,description:t})}}},y=x,S=t(\"2877\"),C=Object(S[\"a\"])(y,a,n,!1,null,null,null);o[\"default\"]=C.exports}}]);","extractedComments":[]}