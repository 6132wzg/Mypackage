{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/components#/event.component.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/components#/event.component.vue","mtime":1597396799952},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue';\nimport { H5WrapperService } from '@/views/pages/brand/setting/mina/components#/h5/h5-wrapper.service';\nimport { cloneDeep } from 'lodash-es';\nimport { ActivityService } from \"../activity.service\";\nimport { Tree } from '@/utils/tree';\nexport default {\n  bem: {\n    event: 'activity-event-component'\n  },\n  components: {\n    StImageUpload: StImageUpload\n  },\n  serviceInject: function serviceInject() {\n    return {\n      h5WrapperService: H5WrapperService,\n      activityService: ActivityService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      eventInfo: this.h5WrapperService.eventInfo$,\n      activityList: this.activityService.actList$\n    };\n  },\n  data: function data() {\n    return {\n      info: {},\n      list: {\n        1: [],\n        2: [],\n        3: [],\n        4: []\n      },\n      actList: [],\n      selected: [],\n      filelist: [],\n      link: '',\n      number: 0,\n      span: 24\n    };\n  },\n  created: function created() {\n    this.initList();\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    var actList = cloneDeep(this.activityList.list);\n\n    if (this.eventInfo && this.eventInfo.length) {\n      var number = this.eventInfo.length;\n      this.number = number;\n      this.list[number] = cloneDeep(this.eventInfo);\n      this.list[number].forEach(function (item) {\n        item.activity_id = [item.activity_type, item.activity_id];\n        var tree = new Tree(actList, {\n          name: 'activity_name'\n        });\n\n        if (_this.number && !tree.findNodeById(item.activity_id[1])) {\n          // 找到对应的父节点\n          var node = actList.filter(function (act) {\n            return act.id === item.activity_type;\n          })[0] || {};\n          console.log(node, 'event====node');\n\n          if (item.activity_type === 5 && node.children) {\n            node.children.push({\n              activity_name: item.activity_name,\n              activity_type: item.activity_type,\n              id: item.activity_id[1],\n              isover: true,\n              product_type: item.product_type,\n              product_template_id: item.product_template_id\n            });\n          } else if (node.children) {\n            node.children.push({\n              activity_name: item.activity_name,\n              activity_type: item.activity_type,\n              id: item.activity_id[1],\n              isover: true\n            });\n          }\n        }\n      });\n    } else {\n      this.number = 0;\n      actList = cloneDeep(this.activityList.list);\n    }\n\n    actList.forEach(function (item) {\n      if (!item.children.length) {\n        item.disabled = true;\n      }\n    });\n    this.actList = cloneDeep(actList);\n    console.log(this.actList, actList, 'eventList');\n  },\n  watch: {\n    list: {\n      deep: true,\n      handler: function handler(newVal) {\n        var number = this.number;\n        this.h5WrapperService.SET_H5INFO(newVal[number], 3);\n      }\n    },\n    number: function number(newValue) {\n      this.h5WrapperService.SET_H5INFO(this.list[newValue], 3);\n    }\n  },\n  methods: {\n    initList: function initList() {\n      var list = {\n        1: [],\n        2: [],\n        3: [],\n        4: []\n      };\n      list[1].push({\n        image_url: '',\n        title: '',\n        link: '',\n        span: 24\n      });\n\n      for (var i = 0; i < 2; i++) {\n        list[2].push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 12\n        });\n      }\n\n      for (var _i = 0; _i < 3; _i++) {\n        if (_i === 2) {\n          list[3].push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 24\n          });\n        } else {\n          list[3].push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 12\n          });\n        }\n      }\n\n      for (var _i2 = 0; _i2 < 4; _i2++) {\n        list[4].push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 12\n        });\n      }\n\n      this.list = list;\n    },\n    onActChange: function onActChange(item, value) {\n      console.log('vlaue', value);\n      item.activity_type = value[1][1].activity_type;\n      item.activity_name = value[1][1].activity_name;\n\n      if (value[1][0].id === 5) {\n        item.product_type = value[1][1].product_type;\n        item.product_template_id = value[1][1].product_template_id;\n      } // const selecttedParent = this.actList.filter(ite => ite.id === value[0])[0]\n      // const selected = selecttedParent.children.filter(\n      //   it => it.id === value[1]\n      // )[0]\n      // item.activity_type = selected.activity_type\n      // item.activity_name = selected.activity_name\n      // if (selected.activity_type === 5) {\n      //   item.product_type = selected.product_type\n      //   item.product_template_id = selected.product_template_id\n      // }\n\n    },\n    imageUploadChange: function imageUploadChange(e, index) {\n      if (e.length) {\n        var number = this.number;\n        this.list[number][index].image_url = e[0].image_url;\n        this.list[number][index].image_key = e[0].image_key;\n      }\n    },\n    numberChange: function numberChange(e) {\n      var num = e.target.value;\n      var list = [];\n\n      if (num === 1) {\n        list.push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 24\n        });\n      } else if (num === 2 || num === 4) {\n        for (var i = 0; i < num; i++) {\n          list.push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 12\n          });\n        }\n      } else if (num === 3) {\n        for (var _i3 = 0; _i3 < num; _i3++) {\n          if (_i3 === 2) {\n            list.push({\n              image_url: '',\n              title: '',\n              link: '',\n              span: 24\n            });\n          } else {\n            list.push({\n              image_url: '',\n              title: '',\n              link: '',\n              span: 12\n            });\n          }\n        }\n      }\n\n      this.list = list;\n    },\n    calImgSize: function calImgSize(li) {\n      var w = li.span === 24 ? 670 : 327;\n      var h = 120;\n      return {\n        w: w,\n        h: h\n      };\n    },\n    generateFilteroptions: function generateFilteroptions(li) {\n      return this.calImgSize(li);\n    },\n    generateCropperOptions: function generateCropperOptions(li) {\n      var _this$calImgSize = this.calImgSize(li),\n          w = _this$calImgSize.w,\n          h = _this$calImgSize.h;\n\n      return {\n        title: '活动图片裁剪',\n        cropper: {\n          aspectRatio: w / h\n        }\n      };\n    }\n  }\n};",null]}