{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"shop-setting-task\"],{\"3ddf\":function(t,e,n){\"use strict\";n.r(e),n.d(e,\"ListService\",(function(){return f}));var s,i,a=n(\"d225\"),c=n(\"b0b4\"),o=n(\"9ab4\"),r=n(\"2cbb\"),u=n(\"0cd5\"),l=n(\"df29\"),d=n(\"7181\"),p=n(\"c4cc\"),f=function(){function t(e,n){Object(a[\"a\"])(this,t),this.taskApi=e,this.authService=n,this.loading$=new l[\"d\"]({}),this.list$=new l[\"d\"]([]),this.page$=new l[\"d\"]({}),this.last_updated_time$=new l[\"d\"](\"\")}return Object(c[\"a\"])(t,[{key:\"getList\",value:function(t){var e=this;return this.taskApi.getList(t).pipe(Object(p[\"a\"])((function(t){e.last_updated_time$.commit((function(){return t.last_updated_time})),e.list$.commit((function(){return t.list})),e.page$.commit((function(){return t.page}))})))}},{key:\"stopTask\",value:function(t){return this.taskApi.stopTask(t)}},{key:\"beforeEach\",value:function(t){return this.getList(t.meta.query)}}]),t}();Object(o[\"b\"])([Object(l[\"c\"])(),Object(o[\"d\"])(\"design:type\",Function),Object(o[\"d\"])(\"design:paramtypes\",[Object]),Object(o[\"d\"])(\"design:returntype\",void 0)],f.prototype,\"getList\",null),f=Object(o[\"b\"])([Object(u[\"b\"])(),Object(o[\"d\"])(\"design:paramtypes\",[\"function\"===typeof(s=\"undefined\"!==typeof d[\"a\"]&&d[\"a\"])?s:Object,\"function\"===typeof(i=\"undefined\"!==typeof r[\"a\"]&&r[\"a\"])?i:Object])],f)},\"56ff\":function(t,e,n){\"use strict\";n.r(e);var s,i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"st-panel\",{attrs:{app:\"\"}},[n(\"st-refresh-btn\",{staticClass:\"mg-b16\",attrs:{date:t.last_updated_time,action:t.refresh,rangeTime:120}}),n(\"st-table\",{attrs:{page:t.page,loading:t.loading.getList,columns:t.columns,dataSource:t.list,rowKey:\"id\"},on:{change:t.onTableChange},scopedSlots:t._u([{key:\"task_type\",fn:function(e){return[t._v(\"\\n      \"+t._s(e.name)+\"\\n    \")]}},{key:\"task_status\",fn:function(e,s){return[n(\"st-text\",{attrs:{status:{default:s.task_status.code===t.TASK_STATUS.PENDING,info:s.task_status.code===t.TASK_STATUS.IN_HAND,warning:s.task_status.code===t.TASK_STATUS.PAUSE,success:s.task_status.code===t.TASK_STATUS.SUCCESS}}},[t._v(\"\\n        \"+t._s(s.task_status.status)+\"\\n      \")])]}},{key:\"total_num\",fn:function(e,s){return[n(\"a\",{on:{click:function(e){return t.onClickModal(s,\"total\")}}},[t._v(\"\\n        \"+t._s(e)+\"\\n      \")])]}},{key:\"success_num\",fn:function(e,s){return[n(\"a\",{on:{click:function(e){return t.onClickModal(s,\"success\")}}},[t._v(\"\\n        \"+t._s(e)+\"\\n      \")])]}},{key:\"fail_num\",fn:function(e,s){return[n(\"a\",{on:{click:function(e){return t.onClickModal(s,\"fail\")}}},[t._v(\"\\n        \"+t._s(e)+\"\\n      \")])]}},{key:\"action\",fn:function(e,s){return n(\"div\",{},[n(\"st-table-actions\",[s.auth[\"shop:task:task_center|end\"]?n(\"st-popconfirm\",{attrs:{title:\"确认要终止该任务么？\"},on:{confirm:function(e){return t.stopTask(s)}}},[n(\"a\",[t._v(\"\\n            终止任务\\n          \")])]):t._e()],1)],1)}}])})],1)},a=[],c=n(\"3ddf\"),o=function(){return[{title:\"时间\",dataIndex:\"task_time\"},{title:\"任务来源\",dataIndex:\"task_source\",scopedSlots:{customRender:\"task_source\"}},{title:\"所属模块\",dataIndex:\"task_type\",scopedSlots:{customRender:\"task_type\"}},{title:\"任务状态\",dataIndex:\"task_status\",scopedSlots:{customRender:\"task_status\"}},{title:\"任务名称\",dataIndex:\"task_name\"},{title:\"总数\",dataIndex:\"total_num\",scopedSlots:{customRender:\"total_num\"}},{title:\"成功数\",dataIndex:\"success_num\",scopedSlots:{customRender:\"success_num\"}},{title:\"失败数\",dataIndex:\"fail_num\",scopedSlots:{customRender:\"fail_num\"}},{title:\"操作人\",dataIndex:\"operator_name\"},{title:\"操作\",dataIndex:\"action\",width:100,scopedSlots:{customRender:\"action\"}}]},r=n(\"ea3e\"),u=n(\"fb96\"),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"st-modal\",{attrs:{title:\"任务明细\",footer:null,wrapClassName:\"scroll-modal\"},model:{value:t.show,callback:function(e){t.show=e},expression:\"show\"}},[n(\"st-table\",{class:t.list.length>0?\"st-scroll-data\":\"\",attrs:{rowKey:\"id\",loading:t.loading.getDetailList,dataSource:t.list,columns:t.columns,scroll:{x:700,y:230},page:t.page,simplePage:!0},on:{change:t.onPageChange}},[n(\"span\",{attrs:{slot:\"customTitle\"},slot:\"customTitle\"},[t._v(\"\\n      \"+t._s(6===t.task_type?\"场馆\":\"合同编号\")+\"\\n    \")]),n(\"span\",{attrs:{slot:\"customName\"},slot:\"customName\"},[t._v(t._s(6===t.task_type?\"场地\":\"会员名称\"))])])],1)},d=[],p=(n(\"c5f6\"),n(\"d225\")),f=n(\"b0b4\"),_=n(\"9ab4\"),m=n(\"0cd5\"),h=n(\"df29\"),g=n(\"7181\"),b=n(\"c4cc\"),k=function(){function t(e){Object(p[\"a\"])(this,t),this.taskApi=e,this.loading$=new h[\"d\"]({}),this.list$=new h[\"d\"]([]),this.page$=new h[\"d\"]({current_page:1,size:10,total_counts:1,total_pages:1})}return Object(f[\"a\"])(t,[{key:\"getDetailList\",value:function(t){var e=this;return this.taskApi.getDetailList(t).pipe(Object(b[\"a\"])((function(t){e.list$.commit((function(){return t.list})),e.page$.commit((function(){return t.page}))})))}}]),t}();Object(_[\"b\"])([Object(h[\"c\"])(),Object(_[\"d\"])(\"design:type\",Function),Object(_[\"d\"])(\"design:paramtypes\",[Object]),Object(_[\"d\"])(\"design:returntype\",void 0)],k.prototype,\"getDetailList\",null),k=Object(_[\"b\"])([Object(m[\"b\"])(),Object(_[\"d\"])(\"design:paramtypes\",[\"function\"===typeof(s=\"undefined\"!==typeof g[\"a\"]&&g[\"a\"])?s:Object])],k);var S=function(){return[{dataIndex:\"contract_number\",slots:{title:\"customTitle\"},width:\"240px\"},{dataIndex:\"member_name\",slots:{title:\"customName\"}},{title:\"类型\",dataIndex:\"task_type\",width:\"60px\"},{title:\"执行时间\",dataIndex:\"task_time\",width:\"200px\"}]},y={name:\"ModalSettingTaskDetail\",serviceInject:function(){return{detailService:k}},rxState:function(){return{loading:this.detailService.loading$,list:this.detailService.list$,page:this.detailService.page$}},computed:{columns:S},props:{task_id:{type:[String,Number]},task_type:{type:[String,Number]},popup_type:{type:String}},data:function(){return{show:!1}},created:function(){this.getDetailList({task_id:this.task_id,popup_type:this.popup_type,size:10,current_page:1})},methods:{getDetailList:function(t){return this.detailService.getDetailList(t).subscribe()},onPageChange:function(t){this.getDetailList({task_id:this.task_id,popup_type:this.popup_type,size:t.pageSize,current_page:t.current})}}},v=y,j=n(\"2877\"),O=Object(j[\"a\"])(v,l,d,!1,null,null,null),T=O.exports,x=n(\"e69b\"),w={mixins:[r[\"a\"]],name:\"PageBrandSettingShopList\",serviceInject:function(){return{messageService:x[\"a\"],listService:c[\"ListService\"]}},rxState:function(){return{loading:this.listService.loading$,last_updated_time:this.listService.last_updated_time$,list:this.listService.list$,page:this.listService.page$}},computed:{columns:o},modals:{TaskDetail:T},data:function(){return{TASK_STATUS:u[\"a\"]}},methods:{refresh:function(){return this.listService.getList(this.$searchQuery)},onClickModal:function(t,e){this.$modalRouter.push({name:\"task-detail\",props:{task_id:t.id,task_type:t.task_type.id,popup_type:e},on:{}})},stopTask:function(t){var e=this;this.listService.stopTask(t.id).subscribe((function(t){e.messageService.success({content:\"终止任务成功!\"}),e.$router.reload()}))}}},$=w,I=Object(j[\"a\"])($,i,a,!1,null,null,null);e[\"default\"]=I.exports},7181:function(t,e,n){\"use strict\";n.d(e,\"a\",(function(){return d}));n(\"6b54\"),n(\"2397\");var s=n(\"d225\"),i=n(\"b0b4\"),a=n(\"308d\"),c=n(\"6bb5\"),o=n(\"4e2b\"),r=n(\"de46\");function u(t){return function(){var e,n=Object(c[\"a\"])(t);if(l()){var s=Object(c[\"a\"])(this).constructor;e=Reflect.construct(n,arguments,s)}else e=n.apply(this,arguments);return Object(a[\"a\"])(this,e)}}function l(){if(\"undefined\"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var d=function(t){Object(o[\"a\"])(n,t);var e=u(n);function n(){return Object(s[\"a\"])(this,n),e.apply(this,arguments)}return Object(i[\"a\"])(n,[{key:\"getList\",value:function(t){return this.http.get(\"/v1/setting/shop/task\",{query:t})}},{key:\"getDetailList\",value:function(t){return this.http.get(\"/v1/setting/shop/task/\".concat(t.task_id),{query:t})}},{key:\"stopTask\",value:function(t){return this.http.delete(\"/v1/setting/shop/task/\".concat(t))}}]),n}(r[\"a\"])},fb96:function(t,e,n){\"use strict\";var s;n.d(e,\"a\",(function(){return s})),function(t){t[t[\"PENDING\"]=1]=\"PENDING\",t[t[\"IN_HAND\"]=2]=\"IN_HAND\",t[t[\"PAUSE\"]=3]=\"PAUSE\",t[t[\"SUCCESS\"]=4]=\"SUCCESS\"}(s||(s={}))}}]);","extractedComments":[]}