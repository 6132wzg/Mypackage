{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/staff/list.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/staff/list.vue","mtime":1600926556521},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { UserService } from '@/services/user.service'\nimport { ListService } from './list.service'\nimport ChangeStaffPostion from './list#/change-staff-postion'\nimport { columns } from './list.config'\nimport tableMixin from '@/mixins/table.mixin'\nimport ShopStaffBatchImport from '@/views/biz-modals/shop-staff/batch-import'\nimport ShopStaffBindCard from '@/views/biz-modals/shop-staff/bind-card'\nimport ShopStaffLeaveCurrentShop from '@/views/biz-modals/shop-staff/leave-current-shop'\nimport ShopStaffRePassword from '@/views/biz-modals/shop-staff/re-password'\nimport ShopStaffSalaryAccountSetting from '@/views/biz-modals/shop-staff/salary-account-setting'\nimport ShopStaffUpdateStaffPosition from '@/views/biz-modals/shop-staff/update-staff-position'\nimport StaffUpdateStaffPosition from '@/views/biz-modals/staff/update-staff-position'\nexport default {\n  mixins: [tableMixin],\n  modals: {\n    ShopStaffBatchImport,\n    ShopStaffBindCard,\n    ShopStaffLeaveCurrentShop,\n    ShopStaffRePassword,\n    ShopStaffSalaryAccountSetting,\n    ShopStaffUpdateStaffPosition,\n    StaffUpdateStaffPosition\n  },\n  components: {\n    ChangeStaffPostion\n  },\n  serviceInject() {\n    return {\n      userService: UserService,\n      service: ListService\n    }\n  },\n  rxState() {\n    return {\n      staffList: this.service.staffList$,\n      page: this.service.page$,\n      roleOptions: this.service.roleOptions$,\n      loading: this.service.loading$,\n      department: this.service.department$,\n      identityList: this.service.identityList$,\n      workStatusList: this.service.workStatusList$,\n      auth: this.service.auth$\n    }\n  },\n  data() {\n    return {\n      visible: false,\n      value: '',\n      enums: {},\n      modaldata: {}\n    }\n  },\n  computed: {\n    columns\n  },\n  methods: {\n    getShopName(record) {\n      console.log('get shop name', record)\n      if (record.is_super_admin) {\n        return '全部'\n      }\n      return record.shop\n        .filter(Boolean)\n        .map(item => item.name)\n        .join(',')\n    },\n    changeStaffPosition(id) {\n      this.userService.getEnums().subscribe(res => {\n        this.enums = res.staff\n        this.visible = true\n        this.modaldata = {\n          nature_work: 1,\n          identity: [1, 2]\n        }\n      })\n    },\n    selectDepartment(e) {\n      console.log(e)\n      this.value = e + ''\n    },\n    joinok() {\n      this.onSearchReset()\n    },\n    onJoinDepartment(e) {\n      console.log('批量加入部门')\n      this.$modalRouter.push({\n        name: 'shop-staff-batch-import',\n        props: {\n          ids: this.selectedRowKeys\n        },\n        on: {\n          change: this.joinok\n        }\n      })\n    },\n    onAddStaff() {\n      this.$router.push({\n        name: 'shop-staff-add'\n      })\n    },\n    onExportStaff() {\n      console.log('导入员工')\n    },\n    // 详情\n    onSearchDetail(e) {\n      let identity = e.identity.map(ele => {\n        return ele.id\n      })\n      this.$router.push({\n        name: 'shop-staff-info-basic',\n        query: {\n          id: e.id\n        }\n      })\n    },\n    onEdit(e) {\n      this.$router.push({\n        name: 'shop-staff-edit',\n        query: {\n          id: e.id\n        }\n      })\n    },\n    onChooseDepartment(e) {\n      console.log('选择部门', e)\n      this.$router.push({\n        query: {\n          shop_id: e\n        }\n      })\n    },\n    onChooseStaffFn(e) {\n      console.log('选择员工职能', e)\n    },\n    onChooseStaffStatus(e) {\n      console.log('选择在职状态', e)\n      this.$router.push({\n        query: {\n          work_status: e\n        }\n      })\n    },\n    onSearch(e) {\n      console.log('搜索员工', e)\n    },\n    // 清空指纹信息\n    onClearFingerprintInfo(record) {\n      this.$confirm({\n        title: '提示信息',\n        content: '确认清空指纹信息？',\n        onOk: () => {\n          this.service.deleteStaffFinger(record.id).subscribe()\n        }\n      })\n    },\n    // 清空硬件密码\n    onClearHardwarePassword(record) {\n      this.$confirm({\n        title: '提示信息',\n        content: '确认清空硬件密码吗？',\n        onOk: () => {\n          this.service.deleteStaffCabinetPassword(record.id).subscribe()\n        }\n      })\n    }\n  }\n}\n",{"version":3,"sources":["list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8QA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"list.vue","sourceRoot":"src/views/pages/shop/staff","sourcesContent":["<template>\n  <st-panel class=\"page-shop-staff-list\" app>\n    <a-row type=\"flex\" justify=\"space-between\">\n      <a-col :span=\"10\">\n        <div class=\"page-shop-staff-list__selectRow\">\n          <st-button\n            v-if=\"auth.add\"\n            type=\"primary\"\n            class=\"mg-r8\"\n            icon=\"add\"\n            @click=\"onAddStaff\"\n          >\n            新增员工\n          </st-button>\n          <st-button\n            v-if=\"auth.export\"\n            type=\"primary\"\n            class=\"mg-r8\"\n            v-export-excel=\"{\n              type: 'staff',\n              query: { conditions: $searchQuery }\n            }\"\n          >\n            全部导出\n          </st-button>\n          <!-- NOTE: 导入 -->\n          <!-- <st-button v-if=\"auth.import\" class=\"mg-r8\" @click=\"onExportStaff\">导入员工</st-button> -->\n          <st-button\n            :disabled=\"!selectedRowKeys.length\"\n            @click=\"onJoinDepartment\"\n            v-if=\"auth.join\"\n            icon=\"add\"\n          >\n            批量加入部门\n          </st-button>\n        </div>\n      </a-col>\n      <a-col :span=\"14\">\n        <div class=\"filter-staff \">\n          <a-select\n            placeholder=\"全部角色\"\n            :dropdownMatchSelectWidth=\"false\"\n            v-model=\"$searchQuery.role_id\"\n            @change=\"onSingleSearch('role_id', $event)\"\n            class=\"mg-r8\"\n          >\n            <a-select-option\n              v-for=\"role in roleOptions\"\n              :value=\"role.id\"\n              :key=\"role.id\"\n            >\n              {{ role.name }}\n            </a-select-option>\n          </a-select>\n          <a-tree-select\n            showSearch\n            class=\"mg-r8\"\n            :dropdownMatchSelectWidth=\"false\"\n            v-model=\"$searchQuery.department_id\"\n            :dropdownStyle=\"{ maxHeight: '400px', overflow: 'auto' }\"\n            placeholder=\"请选择部门\"\n            treeDefaultExpandAll\n            @change=\"onSingleSearch('department_id', $event)\"\n          >\n            <a-tree-select-node\n              v-for=\"item in department\"\n              :value=\"item.id\"\n              :title=\"item.name\"\n              :key=\"item.id\"\n            >\n              <a-tree-select-node\n                v-for=\"item1 in item.children\"\n                :value=\"item1.id\"\n                :title=\"item1.name\"\n                :key=\"item1.id\"\n              >\n                <a-tree-select-node\n                  v-for=\"item2 in item1.children\"\n                  :value=\"item2.id\"\n                  :title=\"item2.name\"\n                  :key=\"item2.id\"\n                >\n                  <a-tree-select-node\n                    v-for=\"item3 in item2.children\"\n                    :value=\"item3.id\"\n                    :title=\"item3.name\"\n                    :key=\"item3.id\"\n                  >\n                    <a-tree-select-node\n                      v-for=\"item4 in item3.children\"\n                      :value=\"item4.id\"\n                      :title=\"item4.name\"\n                      :key=\"item4.id\"\n                    />\n                  </a-tree-select-node>\n                </a-tree-select-node>\n              </a-tree-select-node>\n            </a-tree-select-node>\n          </a-tree-select>\n          <a-select\n            class=\"mg-r8\"\n            placeholder=\"请选择员工职能\"\n            v-model=\"$searchQuery.identity\"\n            @change=\"onSingleSearch('identity', $event)\"\n            :options=\"identityList\"\n          ></a-select>\n          <a-select\n            class=\"mg-r8\"\n            placeholder=\"请选择在职状态\"\n            v-model=\"$searchQuery.work_status\"\n            @change=\"onSingleSearch('work_status', $event)\"\n            :options=\"workStatusList\"\n          ></a-select>\n          <st-input-search\n            placeholder=\"搜索员工\"\n            v-model=\"$searchQuery.keyword\"\n            @search=\"onKeywordsSearch('keyword', $event)\"\n          />\n        </div>\n      </a-col>\n    </a-row>\n    <a-row class=\"mg-t16\">\n      <st-table\n        :rowSelection=\"{\n          selectedRowKeys: selectedRowKeys,\n          onChange: onSelectionChange\n        }\"\n        :loading=\"loading.getStaffList\"\n        :columns=\"columns\"\n        :dataSource=\"staffList\"\n        class=\"page-shop-staff-table\"\n        rowKey=\"id\"\n        :page=\"page\"\n        @change=\"onTableChange\"\n      >\n        <template slot=\"staff_name\" slot-scope=\"text, record\">\n          {{ text }}\n          <img\n            v-if=\"record.is_super_admin === 1\"\n            class=\"page-shop-staff-list__staff-role\"\n            src=\"~@/assets/img/icon_superadmin.png\"\n            alt=\"超级管理员\"\n          />\n        </template>\n        <st-overflow-text\n          title=\"所在门店\"\n          max-width=\"150px\"\n          slot=\"shop\"\n          slot-scope=\"text, record\"\n          :value=\"getShopName(record)\"\n        />\n        <template slot=\"identity\" slot-scope=\"text, record\">\n          <template v-for=\"item in record.identity\">\n            <span :key=\"item.id\" class=\"mg-r8\">{{ item.name }}</span>\n          </template>\n        </template>\n        <template slot=\"sex\" slot-scope=\"text\">\n          <span>{{ text.name }}</span>\n        </template>\n        <template slot=\"work_status\" slot-scope=\"text\">\n          <st-text\n            :status=\"{\n              success: text.id === 1,\n              error: text.id === 2\n            }\"\n          >\n            {{ text.name }}\n          </st-text>\n        </template>\n        <template slot=\"action\" slot-scope=\"text, record\">\n          <st-table-actions>\n            <a\n              href=\"javascript: void(0)\"\n              v-if=\"record.auth['shop:staff:staff|get']\"\n              @click=\"onSearchDetail(record)\"\n            >\n              详情\n            </a>\n            <template v-if=\"record.work_status.name === '在职'\">\n              <a\n                href=\"javascript: void(0)\"\n                v-if=\"record.auth['shop:staff:staff|edit']\"\n                @click=\"onEdit(record)\"\n              >\n                编辑\n              </a>\n              <a\n                href=\"javascript: void(0)\"\n                v-if=\"record.auth['shop:staff:staff|bind_card']\"\n                v-modal-link=\"{\n                  name: 'shop-staff-bind-card',\n                  props: { staff: record }\n                }\"\n              >\n                绑定实体卡\n              </a>\n              <a\n                href=\"javascript: void(0)\"\n                v-if=\"record.auth['shop:staff:staff|rebind_card']\"\n                v-modal-link=\"{\n                  name: 'shop-staff-bind-card',\n                  props: { staff: record }\n                }\"\n              >\n                重绑实体卡\n              </a>\n              <a\n                href=\"javascript: void(0)\"\n                v-if=\"record.auth['shop:staff:account|save']\"\n                v-modal-link=\"{\n                  name: 'shop-staff-re-password',\n                  props: { staff: record }\n                }\"\n              >\n                管理登录账号\n              </a>\n              <a\n                href=\"javascript: void(0)\"\n                v-if=\"record.auth['shop:staff:staff|position']\"\n                v-modal-link=\"{\n                  name: 'shop-staff-update-staff-position',\n                  props: { staff: record }\n                }\"\n              >\n                职位和薪资变更\n              </a>\n              <a\n                href=\"javascript: void(0)\"\n                v-if=\"record.auth['shop:staff:staff|salary']\"\n                v-modal-link=\"{\n                  name: 'shop-staff-salary-account-setting',\n                  props: { staff: record }\n                }\"\n              >\n                设置提现账户\n              </a>\n              <a\n                href=\"javascript: void(0)\"\n                v-if=\"record.auth['shop:staff:staff|shop_leave']\"\n                v-modal-link=\"{\n                  name: 'shop-staff-leave-current-shop',\n                  props: { staff: record }\n                }\"\n              >\n                解除门店关系\n              </a>\n              <a\n                href=\"javascript: void(0)\"\n                v-if=\"record.auth['shop:staff:staff|finger_del']\"\n                @click=\"onClearFingerprintInfo(record)\"\n              >\n                清空指纹信息\n              </a>\n              <a\n                href=\"javascript: void(0)\"\n                v-if=\"record.auth['shop:staff:staff|cabinet_pwd_del']\"\n                @click=\"onClearHardwarePassword(record)\"\n              >\n                清空硬件密码\n              </a>\n            </template>\n          </st-table-actions>\n        </template>\n      </st-table>\n    </a-row>\n    <change-staff-postion :show=\"visible\" :enums=\"enums\" :data=\"modaldata\" />\n  </st-panel>\n</template>\n\n<script>\nimport { UserService } from '@/services/user.service'\nimport { ListService } from './list.service'\nimport ChangeStaffPostion from './list#/change-staff-postion'\nimport { columns } from './list.config'\nimport tableMixin from '@/mixins/table.mixin'\nimport ShopStaffBatchImport from '@/views/biz-modals/shop-staff/batch-import'\nimport ShopStaffBindCard from '@/views/biz-modals/shop-staff/bind-card'\nimport ShopStaffLeaveCurrentShop from '@/views/biz-modals/shop-staff/leave-current-shop'\nimport ShopStaffRePassword from '@/views/biz-modals/shop-staff/re-password'\nimport ShopStaffSalaryAccountSetting from '@/views/biz-modals/shop-staff/salary-account-setting'\nimport ShopStaffUpdateStaffPosition from '@/views/biz-modals/shop-staff/update-staff-position'\nimport StaffUpdateStaffPosition from '@/views/biz-modals/staff/update-staff-position'\nexport default {\n  mixins: [tableMixin],\n  modals: {\n    ShopStaffBatchImport,\n    ShopStaffBindCard,\n    ShopStaffLeaveCurrentShop,\n    ShopStaffRePassword,\n    ShopStaffSalaryAccountSetting,\n    ShopStaffUpdateStaffPosition,\n    StaffUpdateStaffPosition\n  },\n  components: {\n    ChangeStaffPostion\n  },\n  serviceInject() {\n    return {\n      userService: UserService,\n      service: ListService\n    }\n  },\n  rxState() {\n    return {\n      staffList: this.service.staffList$,\n      page: this.service.page$,\n      roleOptions: this.service.roleOptions$,\n      loading: this.service.loading$,\n      department: this.service.department$,\n      identityList: this.service.identityList$,\n      workStatusList: this.service.workStatusList$,\n      auth: this.service.auth$\n    }\n  },\n  data() {\n    return {\n      visible: false,\n      value: '',\n      enums: {},\n      modaldata: {}\n    }\n  },\n  computed: {\n    columns\n  },\n  methods: {\n    getShopName(record) {\n      console.log('get shop name', record)\n      if (record.is_super_admin) {\n        return '全部'\n      }\n      return record.shop\n        .filter(Boolean)\n        .map(item => item.name)\n        .join(',')\n    },\n    changeStaffPosition(id) {\n      this.userService.getEnums().subscribe(res => {\n        this.enums = res.staff\n        this.visible = true\n        this.modaldata = {\n          nature_work: 1,\n          identity: [1, 2]\n        }\n      })\n    },\n    selectDepartment(e) {\n      console.log(e)\n      this.value = e + ''\n    },\n    joinok() {\n      this.onSearchReset()\n    },\n    onJoinDepartment(e) {\n      console.log('批量加入部门')\n      this.$modalRouter.push({\n        name: 'shop-staff-batch-import',\n        props: {\n          ids: this.selectedRowKeys\n        },\n        on: {\n          change: this.joinok\n        }\n      })\n    },\n    onAddStaff() {\n      this.$router.push({\n        name: 'shop-staff-add'\n      })\n    },\n    onExportStaff() {\n      console.log('导入员工')\n    },\n    // 详情\n    onSearchDetail(e) {\n      let identity = e.identity.map(ele => {\n        return ele.id\n      })\n      this.$router.push({\n        name: 'shop-staff-info-basic',\n        query: {\n          id: e.id\n        }\n      })\n    },\n    onEdit(e) {\n      this.$router.push({\n        name: 'shop-staff-edit',\n        query: {\n          id: e.id\n        }\n      })\n    },\n    onChooseDepartment(e) {\n      console.log('选择部门', e)\n      this.$router.push({\n        query: {\n          shop_id: e\n        }\n      })\n    },\n    onChooseStaffFn(e) {\n      console.log('选择员工职能', e)\n    },\n    onChooseStaffStatus(e) {\n      console.log('选择在职状态', e)\n      this.$router.push({\n        query: {\n          work_status: e\n        }\n      })\n    },\n    onSearch(e) {\n      console.log('搜索员工', e)\n    },\n    // 清空指纹信息\n    onClearFingerprintInfo(record) {\n      this.$confirm({\n        title: '提示信息',\n        content: '确认清空指纹信息？',\n        onOk: () => {\n          this.service.deleteStaffFinger(record.id).subscribe()\n        }\n      })\n    },\n    // 清空硬件密码\n    onClearHardwarePassword(record) {\n      this.$confirm({\n        title: '提示信息',\n        content: '确认清空硬件密码吗？',\n        onOk: () => {\n          this.service.deleteStaffCabinetPassword(record.id).subscribe()\n        }\n      })\n    }\n  }\n}\n</script>\n"]}]}