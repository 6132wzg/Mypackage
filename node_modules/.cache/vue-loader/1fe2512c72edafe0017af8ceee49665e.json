{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/setting/shop/edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/setting/shop/edit.vue","mtime":1600926556444},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { PatternService } from '@/services/pattern.service'\nimport { EditService } from './edit.service'\nimport { cloneDeep } from 'lodash-es'\nimport ShopMapLocation from '@/views/biz-modals/shop/map-location'\nimport CheckboxFacilityGroup from '@/views/biz-components/checkbox-facility/checkbox-facility-group'\nimport CheckboxFacilityItem from '@/views/biz-components/checkbox-facility/checkbox-facility-item'\nimport ShopHourPicker from '@/views/components/hour-picker#/hour-picker'\nimport StImageUpload from '@/views/components/image-upload#/image-upload'\nimport MoreInput from '@/views/components/more-input#/more-input.vue'\nimport { ruleOptions } from './edit.config'\n\nexport default {\n  name: 'PageShopSettingShopEdit',\n  components: {\n    CheckboxFacilityGroup,\n    CheckboxFacilityItem,\n    ShopHourPicker,\n    StImageUpload,\n    MoreInput\n  },\n  bem: {\n    edit: 'page-shop-setting-shop-edit'\n  },\n  modals: {\n    ShopMapLocation\n  },\n  serviceInject() {\n    return {\n      pattern: PatternService,\n      editService: EditService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.editService.loading$,\n      serviceList: this.editService.serviceList$,\n      info: this.editService.info$\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      flagList: [\n        '',\n        'shop-trial',\n        'shop-opening',\n        'shop-stop',\n        'shop-close',\n        'shop-holiday'\n      ],\n      shopPhones: [],\n      // 服务设施\n      serviceIds: [],\n      serviceIconIconList: {\n        1: 'WIFI',\n        2: 'park',\n        3: 'shower',\n        4: 'medical',\n        5: 'heating',\n        6: 'snow',\n        7: 'nosmoking',\n        8: 'energy'\n      },\n      // 图片\n      fileList: [],\n      imgList: [],\n      cropperModal: {},\n      weekTime: [],\n      shopPhoneValidateText: ''\n    }\n  },\n  computed: {},\n  mounted() {\n    this.init()\n  },\n  methods: {\n    init() {\n      this.form.setFieldsValue({\n        email: this.info.email\n      })\n      // 电话\n      this.shopPhones = cloneDeep(this.info.shop_phones)\n      // 服务设施\n      this.info.shop_services.forEach(i => {\n        this.serviceIds.push(i.service_id)\n      })\n      // 图片\n      this.imgList = cloneDeep(this.info.shop_images)\n      // 营业时间\n      this.weekTime = cloneDeep(this.info.business_time)\n    },\n    // 查看定位\n    location() {\n      this.$modalRouter.push({\n        name: 'shop-map-location',\n        props: {\n          lat: this.info.lat,\n          lng: this.info.lng\n        }\n      })\n    },\n    // 校验门店电话是否输入\n    shopPhoneValidator() {\n      const length = this.shopPhones.filter(i => i).length\n      this.shopPhoneValidateText = length ? '' : '请输入门店电话'\n      return this.shopPhoneValidateText\n    },\n    onShopPhoneChange(list) {\n      this.shopPhones = list\n      this.shopPhoneValidator()\n    },\n    // 图片\n    fileChange(data) {\n      this.imgList.push({\n        image_id: data[0].image_id,\n        image_key: data[0].image_key,\n        image_url: data[0].image_url,\n        is_cover: 0\n      })\n      this.fileList = []\n    },\n    // 设为店招\n    onSetCover(index) {\n      this.imgList.forEach(i => {\n        i.is_cover = 0\n      })\n      this.imgList[index].is_cover = 1\n      this.imgList.unshift(...this.imgList.splice(index, 1))\n    },\n    // 删除图片\n    onDelete(index) {\n      this.imgList.splice(index, 1)\n    },\n    // 提交\n    onSubmit() {\n      // 确认为提交表单校验\n      this.form.resetFields(['shopPhone'])\n      this.form.validate().then(values => {\n        if (this.shopPhoneValidator()) {\n          return\n        }\n        // 过滤空数据\n        this.shopPhones = this.shopPhones.filter(i => i)\n        this.editService\n          .edit({\n            shop_phones: this.shopPhones,\n            service_ids: this.serviceIds,\n            business_time: this.weekTime,\n            email: values.email,\n            shop_images: this.imgList\n          })\n          .subscribe(() => {\n            this.$router.push({ path: '/shop/setting/shop/info' })\n          })\n      })\n    }\n  }\n}\n",{"version":3,"sources":["edit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"edit.vue","sourceRoot":"src/views/pages/shop/setting/shop","sourcesContent":["<template>\n  <st-panel app initial :class=\"edit()\">\n    <div :class=\"edit('head')\">\n      <p>\n        <st-tag class=\"mg-r8\" :type=\"flagList[info.shop_status]\" />\n        <st-t2>{{ info.shop_name }}</st-t2>\n      </p>\n      <p>\n        {{ info.shop_position.address_detail }}\n        <a class=\"mg-l12\" @click=\"location\">查看定位</a>\n      </p>\n    </div>\n    <st-form labelWidth=\"117px\" :form=\"form\" :class=\"edit('body')\">\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item\n            label=\"门店电话\"\n            required\n            :help=\"shopPhoneValidateText\"\n            :validateStatus=\"shopPhoneValidateText ? 'error' : ''\"\n          >\n            <more-input\n              :length=\"3\"\n              :list=\"shopPhones\"\n              @change=\"onShopPhoneChange\"\n              placeholder=\"请输入门店电话\"\n            ></more-input>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"邮箱\">\n            <a-input\n              v-decorator=\"decorators.email\"\n              placeholder=\"请输入门店邮箱\"\n            />\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"23\">\n          <st-form-item label=\"服务设施\" class=\"mg-b0\">\n            <checkbox-facility-group v-model=\"serviceIds\">\n              <checkbox-facility-item\n                style=\"margin-right:24px\"\n                v-for=\"item in serviceList\"\n                :label=\"item.service_name\"\n                :icon=\"serviceIconIconList[item.service_id]\"\n                :key=\"item.service_id\"\n                :value=\"item.service_id\"\n              ></checkbox-facility-item>\n            </checkbox-facility-group>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"23\">\n          <st-form-item\n            label=\"门店图片\"\n            class=\"st-preview-item\"\n            v-viewer=\"{ url: 'data-src', toolbar: false }\"\n            required\n          >\n            <ul :class=\"edit('img-box')\">\n              <li\n                :class=\"edit('img')\"\n                class=\"mg-r12 mg-t12\"\n                v-for=\"(item, index) in imgList\"\n                :key=\"index\"\n              >\n                <img\n                  :data-src=\"item.image_url | imgFilter({ w: 1000 })\"\n                  :src=\"item.image_url | imgFilter({ w: 240, h: 135 })\"\n                  width=\"240\"\n                  height=\"135\"\n                  alt=\"门店图片\"\n                />\n                <st-tag\n                  v-if=\"item.is_cover\"\n                  class=\"shop-edit-img-tag\"\n                  type=\"shop-sign\"\n                />\n                <p class=\"shop-edit-img-button mg-b0\" v-else>\n                  <span class=\"cursor-pointer\" @click=\"onSetCover(index)\">\n                    设为店招\n                  </span>\n                  <span class=\"cursor-pointer\" @click=\"onDelete(index)\">\n                    删除\n                  </span>\n                </p>\n              </li>\n              <li class=\"mg-t12\" v-if=\"imgList.length < 20\">\n                <st-image-upload\n                  :sizeLimit=\"5\"\n                  :list=\"fileList\"\n                  @change=\"fileChange\"\n                  width=\"240px\"\n                  height=\"135px\"\n                  placeholder=\"上传门店照片\"\n                  description=\"大小不超过5M，建议尺寸16:9\"\n                  :cropperModal=\"{\n                    title: '门店图片裁切',\n                    cropper: { aspectRatio: 16 / 9 }\n                  }\"\n                ></st-image-upload>\n                <p class=\"st-des ta-c\">可新增20张门店图片</p>\n              </li>\n            </ul>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"22\">\n          <st-form-item label=\"营业时间\">\n            <shop-hour-picker v-model=\"weekTime\"></shop-hour-picker>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"22\">\n          <st-form-item label=\" \">\n            <st-button type=\"primary\" :loading=\"loading.edit\" @click=\"onSubmit\">\n              提交\n            </st-button>\n          </st-form-item>\n        </a-col>\n      </a-row>\n    </st-form>\n  </st-panel>\n</template>\n<script>\nimport { PatternService } from '@/services/pattern.service'\nimport { EditService } from './edit.service'\nimport { cloneDeep } from 'lodash-es'\nimport ShopMapLocation from '@/views/biz-modals/shop/map-location'\nimport CheckboxFacilityGroup from '@/views/biz-components/checkbox-facility/checkbox-facility-group'\nimport CheckboxFacilityItem from '@/views/biz-components/checkbox-facility/checkbox-facility-item'\nimport ShopHourPicker from '@/views/components/hour-picker#/hour-picker'\nimport StImageUpload from '@/views/components/image-upload#/image-upload'\nimport MoreInput from '@/views/components/more-input#/more-input.vue'\nimport { ruleOptions } from './edit.config'\n\nexport default {\n  name: 'PageShopSettingShopEdit',\n  components: {\n    CheckboxFacilityGroup,\n    CheckboxFacilityItem,\n    ShopHourPicker,\n    StImageUpload,\n    MoreInput\n  },\n  bem: {\n    edit: 'page-shop-setting-shop-edit'\n  },\n  modals: {\n    ShopMapLocation\n  },\n  serviceInject() {\n    return {\n      pattern: PatternService,\n      editService: EditService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.editService.loading$,\n      serviceList: this.editService.serviceList$,\n      info: this.editService.info$\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      flagList: [\n        '',\n        'shop-trial',\n        'shop-opening',\n        'shop-stop',\n        'shop-close',\n        'shop-holiday'\n      ],\n      shopPhones: [],\n      // 服务设施\n      serviceIds: [],\n      serviceIconIconList: {\n        1: 'WIFI',\n        2: 'park',\n        3: 'shower',\n        4: 'medical',\n        5: 'heating',\n        6: 'snow',\n        7: 'nosmoking',\n        8: 'energy'\n      },\n      // 图片\n      fileList: [],\n      imgList: [],\n      cropperModal: {},\n      weekTime: [],\n      shopPhoneValidateText: ''\n    }\n  },\n  computed: {},\n  mounted() {\n    this.init()\n  },\n  methods: {\n    init() {\n      this.form.setFieldsValue({\n        email: this.info.email\n      })\n      // 电话\n      this.shopPhones = cloneDeep(this.info.shop_phones)\n      // 服务设施\n      this.info.shop_services.forEach(i => {\n        this.serviceIds.push(i.service_id)\n      })\n      // 图片\n      this.imgList = cloneDeep(this.info.shop_images)\n      // 营业时间\n      this.weekTime = cloneDeep(this.info.business_time)\n    },\n    // 查看定位\n    location() {\n      this.$modalRouter.push({\n        name: 'shop-map-location',\n        props: {\n          lat: this.info.lat,\n          lng: this.info.lng\n        }\n      })\n    },\n    // 校验门店电话是否输入\n    shopPhoneValidator() {\n      const length = this.shopPhones.filter(i => i).length\n      this.shopPhoneValidateText = length ? '' : '请输入门店电话'\n      return this.shopPhoneValidateText\n    },\n    onShopPhoneChange(list) {\n      this.shopPhones = list\n      this.shopPhoneValidator()\n    },\n    // 图片\n    fileChange(data) {\n      this.imgList.push({\n        image_id: data[0].image_id,\n        image_key: data[0].image_key,\n        image_url: data[0].image_url,\n        is_cover: 0\n      })\n      this.fileList = []\n    },\n    // 设为店招\n    onSetCover(index) {\n      this.imgList.forEach(i => {\n        i.is_cover = 0\n      })\n      this.imgList[index].is_cover = 1\n      this.imgList.unshift(...this.imgList.splice(index, 1))\n    },\n    // 删除图片\n    onDelete(index) {\n      this.imgList.splice(index, 1)\n    },\n    // 提交\n    onSubmit() {\n      // 确认为提交表单校验\n      this.form.resetFields(['shopPhone'])\n      this.form.validate().then(values => {\n        if (this.shopPhoneValidator()) {\n          return\n        }\n        // 过滤空数据\n        this.shopPhones = this.shopPhones.filter(i => i)\n        this.editService\n          .edit({\n            shop_phones: this.shopPhones,\n            service_ids: this.serviceIds,\n            business_time: this.weekTime,\n            email: values.email,\n            shop_images: this.imgList\n          })\n          .subscribe(() => {\n            this.$router.push({ path: '/shop/setting/shop/info' })\n          })\n      })\n    }\n  }\n}\n</script>\n"]}]}