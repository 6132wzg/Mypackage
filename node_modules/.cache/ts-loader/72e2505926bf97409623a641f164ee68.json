{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/role/edit.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/role/edit.service.ts","mtime":1591147717370},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b, _c, _d;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { UserService } from '@/services/user.service';\nimport { Injectable } from 'vue-service-app';\nimport { State, Effect } from 'rx-state';\nimport { map, tap } from 'rxjs/operators';\nimport { GetInitInfoPut } from '@/api/v1/staff/role';\nimport { RoleService } from \"../role.service\";\nimport { MessageService } from '@/services/message.service';\nimport { cloneDeep } from 'lodash-es';\nimport { forkJoin } from 'rxjs';\n\nvar EditService = /*#__PURE__*/function () {\n  function EditService(roleService, msg, userService) {\n    _classCallCheck(this, EditService);\n\n    this.roleService = roleService;\n    this.msg = msg;\n    this.userService = userService;\n    this.loading$ = new State({});\n    this.info$ = new State({});\n    this.departmentInfo$ = new State({});\n    this.shopList$ = new State({});\n    this.brandList$ = new State({});\n    this.dataGrant$ = this.userService.getOptions$('data_grant.data_grant').pipe(map(function (list) {\n      var arr = cloneDeep(list);\n      var index2Value = arr[2];\n      arr[2] = arr[3];\n      arr[3] = index2Value;\n      return arr;\n    }));\n  }\n\n  _createClass(EditService, [{\n    key: \"update\",\n    value: function update(params) {\n      var _this = this;\n\n      return this.roleService.update(params).pipe(tap(function (res) {\n        _this.msg.success({\n          content: '更新成功'\n        });\n      }));\n    }\n  }, {\n    key: \"gitInitInfo\",\n    value: function gitInitInfo(query) {\n      var _this2 = this;\n\n      return this.roleService.getInitInfo(query).pipe(tap(function (res) {\n        _this2.brandList$.commit(function () {\n          return res.brand_list;\n        });\n\n        _this2.shopList$.commit(function () {\n          return res.shop_list;\n        });\n      }));\n    }\n    /**\n     * 获取所有角色详情\n     */\n\n  }, {\n    key: \"getInfo\",\n    value: function getInfo(query) {\n      var _this3 = this;\n\n      return this.roleService.getInfo(query).pipe(tap(function (res) {\n        _this3.info$.commit(function () {\n          return res.role;\n        });\n\n        _this3.departmentInfo$.commit(function () {\n          var departmentInfo = '';\n\n          if (res.role.data_grant === 3) {\n            res.role.departments.forEach(function (element) {\n              if (departmentInfo) {\n                departmentInfo = departmentInfo + ',' + element.department_name;\n              } else {\n                departmentInfo += element.department_name;\n              }\n            });\n          }\n\n          return departmentInfo;\n        });\n      }));\n    }\n  }, {\n    key: \"getInit\",\n    value: function getInit(query) {\n      return forkJoin(this.getInfo(query), this.gitInitInfo(query));\n    }\n  }, {\n    key: \"beforeEach\",\n    value: function beforeEach(to, from) {\n      var roleId = to.query.roleId;\n      return this.getInit({\n        role_id: roleId\n      });\n    }\n  }]);\n\n  return EditService;\n}();\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_a = typeof GetInitInfoPut !== \"undefined\" && GetInitInfoPut) === \"function\" ? _a : Object]), __metadata(\"design:returntype\", void 0)], EditService.prototype, \"getInfo\", null);\n\nEditService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_b = typeof RoleService !== \"undefined\" && RoleService) === \"function\" ? _b : Object, typeof (_c = typeof MessageService !== \"undefined\" && MessageService) === \"function\" ? _c : Object, typeof (_d = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _d : Object])], EditService);\nexport { EditService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/role/edit.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { UserService } from '@/services/user.service'\nimport { Injectable, ServiceRoute } from 'vue-service-app'\nimport { State, Effect } from 'rx-state'\nimport { map, tap } from 'rxjs/operators'\nimport { GetInitInfoPut, RoleInfo } from '@/api/v1/staff/role'\nimport { RoleService } from '../role.service'\nimport { MessageService } from '@/services/message.service'\nimport { cloneDeep } from 'lodash-es'\nimport { forkJoin } from 'rxjs'\n@Injectable()\nexport class EditService {\n  loading$ = new State({})\n  info$ = new State({})\n  departmentInfo$ = new State({})\n  shopList$ = new State({})\n  brandList$ = new State({})\n  dataGrant$ = this.userService.getOptions$('data_grant.data_grant').pipe(\n    map(list => {\n      let arr = cloneDeep(list)\n      const index2Value = arr[2]\n      arr[2] = arr[3]\n      arr[3] = index2Value\n      return arr\n    })\n  )\n  constructor(\n    private roleService: RoleService,\n    private msg: MessageService,\n    private userService: UserService\n  ) {}\n  update(params: RoleInfo) {\n    return this.roleService.update(params).pipe(\n      tap(res => {\n        this.msg.success({ content: '更新成功' })\n      })\n    )\n  }\n  gitInitInfo(query: GetInitInfoPut) {\n    return this.roleService.getInitInfo(query).pipe(\n      tap(res => {\n        this.brandList$.commit(() => res.brand_list)\n        this.shopList$.commit(() => res.shop_list)\n      })\n    )\n  }\n  /**\n   * 获取所有角色详情\n   */\n  @Effect()\n  getInfo(query: GetInitInfoPut) {\n    return this.roleService.getInfo(query).pipe(\n      tap(res => {\n        this.info$.commit(() => res.role)\n        this.departmentInfo$.commit(() => {\n          let departmentInfo = ''\n          if (res.role.data_grant === 3) {\n            res.role.departments.forEach((element: any) => {\n              if (departmentInfo) {\n                departmentInfo = departmentInfo + ',' + element.department_name\n              } else {\n                departmentInfo += element.department_name\n              }\n            })\n          }\n          return departmentInfo\n        })\n      })\n    )\n  }\n  getInit(query: GetInitInfoPut) {\n    return forkJoin(this.getInfo(query), this.gitInitInfo(query))\n  }\n\n  beforeEach(to: ServiceRoute, from: ServiceRoute) {\n    let { roleId } = to.query as any\n    return this.getInit({ role_id: roleId })\n  }\n}\n"],"sourceRoot":""}]}