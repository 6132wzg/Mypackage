{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/sold/transaction.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/sold/transaction.vue","mtime":1600926555722},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\nimport SoldDealGathering from '@/views/biz-modals/sold/deal/gathering';\nimport SoldDealSaleCabinet from '@/views/biz-modals/sold/deal/sale-cabinet';\nimport SoldDealSaleCourse from '@/views/biz-modals/sold/deal/sale-course';\nimport SoldDealSaleDepositCard from '@/views/biz-modals/sold/deal/sale-deposit-card';\nimport SoldDealSaleMemberCard from '@/views/biz-modals/sold/deal/sale-member-card';\nimport SoldDealSalePersonalCourse from '@/views/biz-modals/sold/deal/sale-personal-course';\nimport SoldDealSaleSmallCourse from '@/views/biz-modals/sold/deal/sale-small-course';\nimport SoldDealGatheringTip from '@/views/biz-modals/sold/deal/gathering-tip';\nimport SoldDealWaitPay from '@/views/biz-modals/brand/app/pos/wait-pay-result';\nimport { PRODUCT_TYPE } from '@/constants/sold/transaction';\nimport { OssService } from '@/services/oss.service';\nexport default {\n  name: 'SoldTransaction',\n  props: {},\n  modals: {\n    SoldDealWaitPay: SoldDealWaitPay,\n    SoldDealGathering: SoldDealGathering,\n    SoldDealSaleCabinet: SoldDealSaleCabinet,\n    SoldDealSaleCourse: SoldDealSaleCourse,\n    SoldDealSaleDepositCard: SoldDealSaleDepositCard,\n    SoldDealSaleMemberCard: SoldDealSaleMemberCard,\n    SoldDealSalePersonalCourse: SoldDealSalePersonalCourse,\n    SoldDealGatheringTip: SoldDealGatheringTip,\n    SoldDealSaleSmallCourse: SoldDealSaleSmallCourse\n  },\n  serviceInject: function serviceInject() {\n    return {\n      ossService: OssService\n    };\n  },\n  data: function data() {\n    return {\n      PRODUCT_TYPE: PRODUCT_TYPE\n    };\n  },\n  methods: {\n    // 订单收款modal\n    createdOrderPay: function createdOrderPay(props) {\n      var _this = this;\n\n      return new Promise(function (resolve, reject) {\n        _this.$modalRouter.push({\n          name: 'sold-deal-gathering',\n          props: props,\n          on: {\n            success: resolve\n          }\n        });\n      });\n    },\n    // 创建成功，提示框modal\n    createdGatheringTip: function createdGatheringTip(props) {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this2.$modalRouter.push({\n          name: 'sold-deal-gathering-tip',\n          props: props,\n          on: {\n            success: resolve\n          }\n        });\n      });\n    },\n    // 等待支付回调modal\n    createdWaitPay: function createdWaitPay(props) {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this3.$modalRouter.push({\n          name: 'sold-deal-wait-pay',\n          props: props,\n          on: {\n            success: resolve\n          }\n        });\n      });\n    },\n    // 订单收款回调\n    // modelType 业务类型 如储值卡签单 会员卡签单等\n    payCallBack: function () {\n      var _payCallBack = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(orderId, modalType, callBackType, callBackData) {\n        var _this4 = this;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.t0 = callBackType;\n                _context.next = _context.t0 === 'cancel' ? 3 : _context.t0 === 'pay' ? 5 : _context.t0 === 'pos' ? 7 : 9;\n                break;\n\n              case 3:\n                this.onSearch();\n                return _context.abrupt(\"break\", 9);\n\n              case 5:\n                this.createdGatheringTip({\n                  message: '收款成功',\n                  order_id: orderId\n                }).then(function (res) {\n                  _this4.tipCallBack(orderId, modalType, res.type);\n                });\n                return _context.abrupt(\"break\", 9);\n\n              case 7:\n                this.createdWaitPay(callBackData).then(function () {\n                  _this4.createdGatheringTip({\n                    message: '收款成功',\n                    order_id: orderId\n                  }).then(function (res) {\n                    _this4.tipCallBack(orderId, modalType, res.type);\n                  });\n                });\n                return _context.abrupt(\"break\", 9);\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function payCallBack(_x, _x2, _x3, _x4) {\n        return _payCallBack.apply(this, arguments);\n      }\n\n      return payCallBack;\n    }(),\n    // 提示框回调，gathering-tip\n    tipCallBack: function () {\n      var _tipCallBack = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(orderId, modalType, callBackType) {\n        var _this5 = this;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.t0 = callBackType;\n                _context2.next = _context2.t0 === 'cancel' ? 3 : _context2.t0 === 'Print' ? 5 : _context2.t0 === 'ViewOrder' ? 7 : _context2.t0 === 'ViewOrder' ? 9 : _context2.t0 === 'PrintOrder' ? 11 : _context2.t0 === 'Pay' ? 13 : 15;\n                break;\n\n              case 3:\n                this.$router.reload();\n                return _context2.abrupt(\"break\", 15);\n\n              case 5:\n                this.createdOrderPrint(orderId);\n                return _context2.abrupt(\"break\", 15);\n\n              case 7:\n                this.createdOrderViewOrder(orderId);\n                return _context2.abrupt(\"break\", 15);\n\n              case 9:\n                this.createdOrderViewOrder(orderId);\n                return _context2.abrupt(\"break\", 15);\n\n              case 11:\n                this.printOrder(orderId);\n                return _context2.abrupt(\"break\", 15);\n\n              case 13:\n                this.createdOrderPay({\n                  order_id: orderId,\n                  type: modalType\n                }).then(function (res) {\n                  _this5.payCallBack(orderId, modalType, res.type, res);\n                });\n                return _context2.abrupt(\"break\", 15);\n\n              case 15:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function tipCallBack(_x5, _x6, _x7) {\n        return _tipCallBack.apply(this, arguments);\n      }\n\n      return tipCallBack;\n    }(),\n\n    /**\n     * 交易签单，签单操作\n     * @params order_id 订单id\n     * @params product_type 签单类型\n     * @params member_id 会员id\n     * @params member_name 会员姓名\n     * @params member_mobile 会员手机号\n     * @params id_card 证件号\n     * @params id_card_type 证件类型\n     * @params card_num 实体卡号\n     * @params physical_id 物理ID\n     */\n    onTransaction: function onTransaction(order_id, product_type, member_id, member_name, member_mobile, id_card, id_card_type, card_num, physical_id) {\n      var props = {};\n\n      if (order_id) {\n        props = {\n          id: order_id,\n          memberInfo: {\n            member_id: member_id,\n            member_name: member_name,\n            member_mobile: member_mobile,\n            id_card: id_card,\n            id_card_type: id_card_type,\n            card_num: card_num,\n            physical_id: physical_id\n          }\n        };\n      }\n\n      switch (product_type) {\n        case this.PRODUCT_TYPE.MEMBER_CARD:\n          this.onMember(props);\n          break;\n\n        case this.PRODUCT_TYPE.DEPOSIT_CARD:\n          this.onDeposit(props);\n          break;\n\n        case this.PRODUCT_TYPE.PERSONAL_COURSE:\n          this.onPersonalCourse(props);\n          break;\n\n        case this.PRODUCT_TYPE.PACKAGE:\n          this.onPackage(props);\n          break;\n\n        case this.PRODUCT_TYPE.CABINET:\n          this.onCabinet(props);\n          break;\n\n        case this.PRODUCT_TYPE.SMALL_COURSE:\n          this.onSmallCourse(props);\n          break;\n      }\n    },\n    // 签单成功回调\n    saleCallBack: function () {\n      var _saleCallBack = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(result, type) {\n        var props, orderSuccessRes, _props, payOrderRes;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(result.type === 'create')) {\n                  _context3.next = 8;\n                  break;\n                }\n\n                // 创建订单成功\n                props = {\n                  order_id: result.orderId,\n                  type: type,\n                  message: '订单创建成功',\n                  needPay: true\n                };\n                _context3.next = 4;\n                return this.createdGatheringTip(props);\n\n              case 4:\n                orderSuccessRes = _context3.sent;\n                this.tipCallBack(result.orderId, type, orderSuccessRes.type);\n                _context3.next = 14;\n                break;\n\n              case 8:\n                if (!(result.type === 'createPay')) {\n                  _context3.next = 14;\n                  break;\n                }\n\n                // 创建订单成功 并且到支付页面\n                _props = {\n                  order_id: result.orderId,\n                  type: type\n                };\n                _context3.next = 12;\n                return this.createdOrderPay(_props);\n\n              case 12:\n                payOrderRes = _context3.sent;\n                this.payCallBack(result.orderId, type, payOrderRes.type, payOrderRes);\n\n              case 14:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function saleCallBack(_x8, _x9) {\n        return _saleCallBack.apply(this, arguments);\n      }\n\n      return saleCallBack;\n    }(),\n    // 打印小票\n    printOrder: function printOrder(order_id) {\n      window.open('/ticket/gathering-print?id=' + order_id, '_blank', 'width=800,height=600');\n    },\n    // 会员卡签单\n    onMember: function onMember(props) {\n      var _this6 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-member-card',\n        props: props,\n        on: {\n          success: function success(result) {\n            _this6.saleCallBack(result, 'member');\n          }\n        }\n      });\n    },\n    // 储值卡签单\n    onDeposit: function onDeposit(props) {\n      var _this7 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-deposit-card',\n        props: props,\n        on: {\n          success: function success(result) {\n            _this7.saleCallBack(result, 'deposit');\n          }\n        }\n      });\n    },\n    // 储物柜签单\n    onCabinet: function onCabinet(props) {\n      var _this8 = this;\n\n      props.id = '0'; // 默认传0，因为没有选择具体的柜子\n\n      props.areaId = props.id;\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-cabinet',\n        props: props,\n        on: {\n          success: function success(result) {\n            _this8.saleCallBack(result, 'cabinet_order');\n          }\n        }\n      });\n    },\n    // 课程包签单\n    onPackage: function onPackage(props) {\n      var _this9 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-course',\n        props: props,\n        on: {\n          success: function success(result) {\n            _this9.saleCallBack(result, 'package');\n          }\n        }\n      });\n    },\n    // 私教课签单\n    onPersonalCourse: function onPersonalCourse(props) {\n      var _this10 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-personal-course',\n        props: props,\n        on: {\n          success: function success(result) {\n            _this10.saleCallBack(result, 'personal');\n          }\n        }\n      });\n    },\n    // 小班课签单\n    onSmallCourse: function onSmallCourse(props) {\n      var _this11 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-small-course',\n        props: props,\n        on: {\n          success: function success(result) {\n            _this11.saleCallBack(result, 'small_course_order/detail');\n          }\n        }\n      });\n    },\n    // 打印合同\n    createdOrderPrint: function createdOrderPrint(order_id) {\n      var url = \"\".concat(window.location.origin, \"/common/contract-preview?id=\").concat(order_id);\n      this.ossService.openNewTab(url);\n    },\n    // 查看订单\n    createdOrderViewOrder: function createdOrderViewOrder(order_id) {\n      this.$router.push({\n        name: 'shop-finance-order-info-collection-details',\n        query: {\n          id: order_id\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["transaction.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div></div>\n</template>\n\n<script>\nimport SoldDealGathering from '@/views/biz-modals/sold/deal/gathering'\nimport SoldDealSaleCabinet from '@/views/biz-modals/sold/deal/sale-cabinet'\nimport SoldDealSaleCourse from '@/views/biz-modals/sold/deal/sale-course'\nimport SoldDealSaleDepositCard from '@/views/biz-modals/sold/deal/sale-deposit-card'\nimport SoldDealSaleMemberCard from '@/views/biz-modals/sold/deal/sale-member-card'\nimport SoldDealSalePersonalCourse from '@/views/biz-modals/sold/deal/sale-personal-course'\nimport SoldDealSaleSmallCourse from '@/views/biz-modals/sold/deal/sale-small-course'\nimport SoldDealGatheringTip from '@/views/biz-modals/sold/deal/gathering-tip'\nimport SoldDealWaitPay from '@/views/biz-modals/brand/app/pos/wait-pay-result'\nimport { PRODUCT_TYPE } from '@/constants/sold/transaction'\nimport { OssService } from '@/services/oss.service'\nexport default {\n  name: 'SoldTransaction',\n  props: {},\n  modals: {\n    SoldDealWaitPay,\n    SoldDealGathering,\n    SoldDealSaleCabinet,\n    SoldDealSaleCourse,\n    SoldDealSaleDepositCard,\n    SoldDealSaleMemberCard,\n    SoldDealSalePersonalCourse,\n    SoldDealGatheringTip,\n    SoldDealSaleSmallCourse\n  },\n  serviceInject() {\n    return {\n      ossService: OssService\n    }\n  },\n  data() {\n    return {\n      PRODUCT_TYPE\n    }\n  },\n  methods: {\n    // 订单收款modal\n    createdOrderPay(props) {\n      return new Promise((resolve, reject) => {\n        this.$modalRouter.push({\n          name: 'sold-deal-gathering',\n          props,\n          on: {\n            success: resolve\n          }\n        })\n      })\n    },\n    // 创建成功，提示框modal\n    createdGatheringTip(props) {\n      return new Promise((resolve, reject) => {\n        this.$modalRouter.push({\n          name: 'sold-deal-gathering-tip',\n          props,\n          on: {\n            success: resolve\n          }\n        })\n      })\n    },\n    // 等待支付回调modal\n    createdWaitPay(props) {\n      return new Promise((resolve, reject) => {\n        this.$modalRouter.push({\n          name: 'sold-deal-wait-pay',\n          props,\n          on: {\n            success: resolve\n          }\n        })\n      })\n    },\n    // 订单收款回调\n    // modelType 业务类型 如储值卡签单 会员卡签单等\n    async payCallBack(orderId, modalType, callBackType, callBackData) {\n      switch (callBackType) {\n        case 'cancel':\n          this.onSearch()\n          break\n        case 'pay':\n          this.createdGatheringTip({\n            message: '收款成功',\n            order_id: orderId\n          }).then(res => {\n            this.tipCallBack(orderId, modalType, res.type)\n          })\n          break\n        case 'pos':\n          this.createdWaitPay(callBackData).then(() => {\n            this.createdGatheringTip({\n              message: '收款成功',\n              order_id: orderId\n            }).then(res => {\n              this.tipCallBack(orderId, modalType, res.type)\n            })\n          })\n          break\n      }\n    },\n    // 提示框回调，gathering-tip\n    async tipCallBack(orderId, modalType, callBackType) {\n      switch (callBackType) {\n        case 'cancel':\n          this.$router.reload()\n          break\n        case 'Print':\n          this.createdOrderPrint(orderId)\n          break\n        case 'ViewOrder':\n          this.createdOrderViewOrder(orderId)\n          break\n        /**\n         * 查看售出详情\n         */\n        case 'ViewOrder':\n          this.createdOrderViewOrder(orderId)\n          break\n        case 'PrintOrder':\n          this.printOrder(orderId)\n          break\n        case 'Pay':\n          this.createdOrderPay({ order_id: orderId, type: modalType }).then(\n            res => {\n              this.payCallBack(orderId, modalType, res.type, res)\n            }\n          )\n          break\n      }\n    },\n    /**\n     * 交易签单，签单操作\n     * @params order_id 订单id\n     * @params product_type 签单类型\n     * @params member_id 会员id\n     * @params member_name 会员姓名\n     * @params member_mobile 会员手机号\n     * @params id_card 证件号\n     * @params id_card_type 证件类型\n     * @params card_num 实体卡号\n     * @params physical_id 物理ID\n     */\n    onTransaction(\n      order_id,\n      product_type,\n      member_id,\n      member_name,\n      member_mobile,\n      id_card,\n      id_card_type,\n      card_num,\n      physical_id\n    ) {\n      let props = {}\n      if (order_id) {\n        props = {\n          id: order_id,\n          memberInfo: {\n            member_id,\n            member_name,\n            member_mobile,\n            id_card,\n            id_card_type,\n            card_num,\n            physical_id\n          }\n        }\n      }\n      switch (product_type) {\n        case this.PRODUCT_TYPE.MEMBER_CARD:\n          this.onMember(props)\n          break\n        case this.PRODUCT_TYPE.DEPOSIT_CARD:\n          this.onDeposit(props)\n          break\n        case this.PRODUCT_TYPE.PERSONAL_COURSE:\n          this.onPersonalCourse(props)\n          break\n        case this.PRODUCT_TYPE.PACKAGE:\n          this.onPackage(props)\n          break\n        case this.PRODUCT_TYPE.CABINET:\n          this.onCabinet(props)\n          break\n        case this.PRODUCT_TYPE.SMALL_COURSE:\n          this.onSmallCourse(props)\n          break\n      }\n    },\n    // 签单成功回调\n    async saleCallBack(result, type) {\n      if (result.type === 'create') {\n        // 创建订单成功\n        let props = {\n          order_id: result.orderId,\n          type,\n          message: '订单创建成功',\n          needPay: true\n        }\n        let orderSuccessRes = await this.createdGatheringTip(props)\n        this.tipCallBack(result.orderId, type, orderSuccessRes.type)\n      } else if (result.type === 'createPay') {\n        // 创建订单成功 并且到支付页面\n        let props = {\n          order_id: result.orderId,\n          type\n        }\n        let payOrderRes = await this.createdOrderPay(props)\n        this.payCallBack(result.orderId, type, payOrderRes.type, payOrderRes)\n      }\n    },\n    // 打印小票\n    printOrder(order_id) {\n      window.open(\n        '/ticket/gathering-print?id=' + order_id,\n        '_blank',\n        'width=800,height=600'\n      )\n    },\n    // 会员卡签单\n    onMember(props) {\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-member-card',\n        props,\n        on: {\n          success: result => {\n            this.saleCallBack(result, 'member')\n          }\n        }\n      })\n    },\n    // 储值卡签单\n    onDeposit(props) {\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-deposit-card',\n        props,\n        on: {\n          success: result => {\n            this.saleCallBack(result, 'deposit')\n          }\n        }\n      })\n    },\n    // 储物柜签单\n    onCabinet(props) {\n      props.id = '0' // 默认传0，因为没有选择具体的柜子\n      props.areaId = props.id\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-cabinet',\n        props,\n        on: {\n          success: result => {\n            this.saleCallBack(result, 'cabinet_order')\n          }\n        }\n      })\n    },\n    // 课程包签单\n    onPackage(props) {\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-course',\n        props,\n        on: {\n          success: result => {\n            this.saleCallBack(result, 'package')\n          }\n        }\n      })\n    },\n    // 私教课签单\n    onPersonalCourse(props) {\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-personal-course',\n        props,\n        on: {\n          success: result => {\n            this.saleCallBack(result, 'personal')\n          }\n        }\n      })\n    },\n    // 小班课签单\n    onSmallCourse(props) {\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-small-course',\n        props,\n        on: {\n          success: result => {\n            this.saleCallBack(result, 'small_course_order/detail')\n          }\n        }\n      })\n    },\n    // 打印合同\n    createdOrderPrint(order_id) {\n      let url = `${window.location.origin}/common/contract-preview?id=${order_id}`\n      this.ossService.openNewTab(url)\n    },\n    // 查看订单\n    createdOrderViewOrder(order_id) {\n      this.$router.push({\n        name: 'shop-finance-order-info-collection-details',\n        query: {\n          id: order_id\n        }\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-components/sold"}]}