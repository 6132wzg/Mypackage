{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/mina/components#/h5/h5-setting-index.component.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/mina/components#/h5/h5-setting-index.component.vue","mtime":1600926556212},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { cloneDeep, omit } from 'lodash-es';\nimport H5ModuleComponent from \"./h5-module.component\";\nimport h5ShopListComponent from \"./h5-shop-list.component\";\nimport h5PhoneComponent from \"./h5-phone.component\";\nimport { H5SettingIndexService } from \"./h5-setting-index.service\";\nimport { swiper, swiperSlide } from 'vue-awesome-swiper';\nimport draggable from 'vuedraggable';\nimport BrandSettingMinaCheckoutShopinfoLayout from '@/views/biz-modals/brand/setting/mina/checkout-shopinfo-layout';\nimport h5FormShopinfoComponent from \"./form-components#/h5-form.shopinfo.component\";\nimport h5FormFnComponent from \"./form-components#/h5-form.fn.component\";\nimport h5FormCoachComponent from \"./form-components#/h5-form.coach.component\";\nimport h5FormCardComponent from \"./form-components#/h5-form.card.component\";\nimport h5FormCourseComponent from \"./form-components#/h5-form.course.component\";\nimport h5FormPackageComponent from \"./form-components#/h5-form.package.component\";\nimport h5FormCouponComponent from \"./form-components#/h5-form.coupon.component\";\nimport h5FormInvitationComponent from \"./form-components#/h5-form.invitation.component\";\nimport h5FormTurntableComponent from \"./form-components#/h5-form.turntable.component\";\nimport h5FormActivityComponent from \"./form-components#/h5-form.activity.component\";\nimport h5FormGroupComponent from \"./form-components#/h5-form.group.component\";\nimport h5FormDiscountComponent from \"./form-components#/h5-form.discount.component\";\nimport h5FormSeckillComponent from \"./form-components#/h5-form.seckill.component\";\nimport { MessageService } from '@/services/message.service';\nexport default {\n  name: 'H5SettingIndexComponent',\n  components: {\n    H5ModuleComponent: H5ModuleComponent,\n    h5PhoneComponent: h5PhoneComponent,\n    h5ShopListComponent: h5ShopListComponent,\n    swiper: swiper,\n    swiperSlide: swiperSlide,\n    h5FormShopinfoComponent: h5FormShopinfoComponent,\n    h5FormFnComponent: h5FormFnComponent,\n    h5FormCoachComponent: h5FormCoachComponent,\n    h5FormCardComponent: h5FormCardComponent,\n    h5FormCourseComponent: h5FormCourseComponent,\n    h5FormPackageComponent: h5FormPackageComponent,\n    h5FormCouponComponent: h5FormCouponComponent,\n    h5FormInvitationComponent: h5FormInvitationComponent,\n    h5FormTurntableComponent: h5FormTurntableComponent,\n    h5FormActivityComponent: h5FormActivityComponent,\n    h5FormGroupComponent: h5FormGroupComponent,\n    h5FormDiscountComponent: h5FormDiscountComponent,\n    h5FormSeckillComponent: h5FormSeckillComponent,\n    draggable: draggable\n  },\n  bem: {\n    h5: 'h5-setting-index-component'\n  },\n  modals: {\n    BrandSettingMinaCheckoutShopinfoLayout: BrandSettingMinaCheckoutShopinfoLayout\n  },\n  serviceInject: function serviceInject() {\n    return {\n      messageService: MessageService,\n      h5SettingIndexService: H5SettingIndexService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      shopList: this.h5SettingIndexService.shopList$,\n      currentShopInfo: this.h5SettingIndexService.currentShopInfo$,\n      fnModules: this.h5SettingIndexService.fnModules$,\n      modulesData: this.h5SettingIndexService.modulesData$,\n      marketingModules: this.h5SettingIndexService.marketingModules$,\n      loading: this.h5SettingIndexService.loading$\n    };\n  },\n  computed: {\n    moduleType: function moduleType() {\n      return this.modulesData[this.sliderIndex] && this.modulesData[this.sliderIndex];\n    }\n  },\n  data: function data() {\n    return {\n      draggableOptions: {},\n      shopId: '',\n      shopActiveIndex: 0,\n      sliderIndex: 0,\n      phoneIndex: 0,\n      componentList: {\n        1: 'h5FormShopinfoComponent',\n        2: 'h5FormFnComponent',\n        3: 'h5FormCoachComponent',\n        4: 'h5FormCardComponent',\n        5: 'h5FormCourseComponent',\n        6: 'h5FormPackageComponent',\n        12: 'h5FormCouponComponent',\n        13: 'h5FormInvitationComponent',\n        14: 'h5FormTurntableComponent',\n        15: 'h5FormActivityComponent',\n        16: 'h5FormGroupComponent',\n        17: 'h5FormDiscountComponent',\n        18: 'h5FormSeckillComponent'\n      },\n      isEditFlag: false,\n      canDrag: true\n    };\n  },\n  created: function created() {\n    this.init();\n  },\n  mounted: function mounted() {},\n  watch: {\n    sliderIndex: function sliderIndex(newVal) {\n      if (this.$refs.leftModules) {\n        this.$refs.leftModules.scrollTop = newVal * 72;\n      }\n    }\n  },\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      this.h5SettingIndexService.getShopList().subscribe(function (res) {\n        if (!!res.list.length) {\n          _this.getModuleDataAndShopInfo(res.list[0].shop_id);\n        }\n      });\n    },\n    // 添加模块\n    selectModule: function selectModule(item) {\n      var _this2 = this;\n\n      var showModuleList = this.modulesData.filter(function (item) {\n        return +!item.module_is_delete;\n      });\n\n      if (showModuleList.length === 15) {\n        return this.messageService.warn({\n          content: '小程序最多可添加15个功能模块，当前已达数量上限，请在删除模块后再行添加'\n        });\n      }\n\n      var moduleItem = cloneDeep(item);\n      this.modulesData.push(moduleItem);\n      this.editEmit();\n      setTimeout(function () {\n        _this2.setIndex(_this2.modulesData.length - 1);\n      });\n    },\n    // 门店信息模块切换样式\n    shopDetailChange: function shopDetailChange() {\n      var _this3 = this;\n\n      this.$modalRouter.push({\n        name: 'brand-setting-mina-checkout-shopinfo-layout',\n        props: {\n          layout: this.modulesData[0].content.show_style\n        },\n        on: {\n          success: function success(e) {\n            _this3.editEmit();\n\n            _this3.modulesData[0].content.show_style = e;\n          }\n        }\n      });\n    },\n    // 操作了模块\n    moduleItemChange: function moduleItemChange(module, index) {\n      this.modulesData.splice(index, 1, cloneDeep(module));\n      this.editEmit();\n    },\n    // 删除模块\n    deleteModuleItem: function deleteModuleItem(module, index) {\n      this.editEmit();\n\n      if (+!this.modulesData[index].module_id) {\n        // 新模块module_id为0\n        this.modulesData.splice(index, 1);\n      } else {\n        this.modulesData.splice(index, 1, cloneDeep(module));\n      }\n\n      console.log(this.modulesData);\n      var remainingModules = this.modulesData.slice(index + 1);\n      var moduleNoDelete = [];\n\n      if (remainingModules.length) {\n        remainingModules.forEach(function (item) {\n          if (+!item.module_is_delete) {\n            moduleNoDelete.push(item);\n          }\n        });\n      }\n\n      if (moduleNoDelete.length > 0) {\n        // 向下查找到没有删除的\n        var i = index + 1;\n        var num = 1;\n\n        while (this.modulesData[i].module_is_delete) {\n          i++;\n          num++;\n        }\n\n        this.sliderIndex = i;\n        this.phoneIndex = i - num;\n      } else {\n        // 向上查找到没有删除的\n        var _i = index - 1;\n\n        while (this.modulesData[_i].module_is_delete) {\n          _i--;\n        }\n\n        this.setIndex(_i);\n      }\n    },\n    // 拖拽模块\n    dragModule: function dragModule(e) {\n      this.setIndex(e.moved.newIndex);\n      this.editEmit();\n    },\n    // 点击模块\n    tapModuleItem: function tapModuleItem(module, index) {\n      this.setIndex(index);\n    },\n    // 切换了门店\n    switchShop: function switchShop(shopId) {\n      var _this4 = this;\n\n      if (shopId != this.currentShopInfo.id) {\n        if (this.isEditFlag) {\n          this.$confirm({\n            title: '确定要离开？',\n            content: '此时离开将丢失已编辑的内容，是否确认离开？',\n            onOk: function onOk() {\n              _this4.getModuleDataAndShopInfo(shopId);\n\n              _this4.editEmit(false);\n            }\n          });\n        } else {\n          this.getModuleDataAndShopInfo(shopId);\n        }\n      }\n    },\n    // 手机中点击\n    tapSlide: function tapSlide(_ref) {\n      var sliderIndex = _ref.sliderIndex;\n      this.setIndex(sliderIndex);\n    },\n    // 获取模块数据和门店详情\n    getModuleDataAndShopInfo: function getModuleDataAndShopInfo(shopId) {\n      var _this5 = this;\n\n      this.shopId = shopId;\n      this.shopActiveIndex = this.shopList.findIndex(function (item) {\n        return item.shop_id === shopId;\n      });\n      this.h5SettingIndexService.getShopModules({\n        shop_id: shopId,\n        tab_type: '1'\n      }).subscribe(function (res) {\n        _this5.setIndex(0);\n      });\n      this.h5SettingIndexService.getShopInfo(shopId).subscribe();\n      this.h5SettingIndexService.getModules(shopId).subscribe();\n    },\n    setIndex: function setIndex(index) {\n      this.sliderIndex = this.phoneIndex = index;\n    },\n    saveData: function saveData() {\n      var _this6 = this;\n\n      var modulesData = cloneDeep(this.modulesData);\n\n      for (var i = 0; i < modulesData.length; i++) {\n        if (!modulesData[i].module_is_delete) {\n          if (modulesData[i].module_type === 2) {\n            var noHasImg = modulesData[i].content.list.find(function (list) {\n              return !Object.keys(list.image).length;\n            });\n\n            if (noHasImg) {\n              this.messageService.warn({\n                content: \"\\u8BF7\\u4E0A\\u4F20\".concat(modulesData[i].module_name, \"\\u56FE\\u7247\")\n              });\n              return false;\n            }\n          }\n\n          if (modulesData[i].module_type === 3) {\n            if (modulesData[i].content.list.length && modulesData[i].content.list.length > modulesData[i].max_num) {\n              this.messageService.warn({\n                content: \"\".concat(modulesData[i].module_name, \"\\u6700\\u591A\\u6DFB\\u52A0\").concat(modulesData[i].max_num, \"\\u9879\")\n              });\n              return false;\n            }\n          }\n        }\n      }\n\n      var saveData = modulesData.map(function (item) {\n        item = omit(item, ['is_can_rename', 'is_can_display', 'is_can_delete']);\n\n        if (item.module_type === 3 && !!item.content.list.length) {\n          // 教练模块\n          var coachList = item.content.list.map(function (coach) {\n            return coach.id;\n          });\n          item.content.list = coachList;\n        }\n\n        return item;\n      });\n      console.log(saveData);\n      this.$confirm({\n        title: '',\n        content: '确认将当前设置内容发布到小程序？',\n        onOk: function onOk() {\n          _this6.h5SettingIndexService.saveIndexConfig({\n            shop_id: _this6.shopId,\n            tab_type: 1,\n            module_list: saveData\n          }).subscribe(function (res) {\n            _this6.messageService.success({\n              content: '保存成功'\n            });\n\n            _this6.editEmit(false);\n\n            _this6.getModuleDataAndShopInfo(_this6.shopId);\n\n            _this6.setIndex(0);\n          });\n        }\n      });\n    },\n    editEmit: function editEmit() {\n      var flag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      this.isEditFlag = flag;\n      this.$emit('change', this.isEditFlag);\n    },\n    mouseEvent: function mouseEvent(e) {\n      this.canDrag = e;\n    }\n  }\n};",{"version":3,"sources":["h5-setting-index.component.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <div :class=\"h5('header')\">\n      <div :class=\"h5('shops')\">\n        <h5ShopListComponent\n          @change=\"switchShop\"\n          :class=\"h5('shops-module')\"\n          :shopList=\"shopList\"\n          :shopActiveIndex=\"shopActiveIndex\"\n        />\n      </div>\n      <st-button\n        type=\"primary\"\n        @click=\"saveData\"\n        :loading=\"loading.saveIndexConfig\"\n      >\n        保存并发布\n      </st-button>\n    </div>\n    <a-spin :spinning=\"loading.getShopModules\">\n      <div :class=\"h5()\">\n        <div :class=\"h5('left')\">\n          <div :class=\"h5('title')\">\n            <div :class=\"h5('title--text')\" class=\"color-title mg-b0\">\n              首页模块\n            </div>\n            <a-dropdown\n              overlayClassName=\"setting-index__dropdown\"\n              :trigger=\"['click']\"\n              :getPopupContainer=\"trigger => trigger.parentNode\"\n            >\n              <st-button\n                icon=\"add\"\n                type=\"primary\"\n                @click=\"e => e.preventDefault()\"\n              >\n                添加模块\n              </st-button>\n              <div slot=\"overlay\" :class=\"h5('overlay')\">\n                <div :class=\"h5('overlay--content')\">\n                  <div\n                    :class=\"h5('overlay--module')\"\n                    v-for=\"(item, index) in fnModules\"\n                    :key=\"index\"\n                    @click=\"selectModule(item)\"\n                  >\n                    {{ item.module_name }}\n                  </div>\n                </div>\n                <div :class=\"h5('overlay--content')\">\n                  <div\n                    :class=\"h5('overlay--module')\"\n                    v-for=\"(item, index) in marketingModules\"\n                    :key=\"index\"\n                    @click=\"selectModule(item)\"\n                  >\n                    {{ item.module_name }}\n                  </div>\n                </div>\n              </div>\n            </a-dropdown>\n          </div>\n          <div :class=\"h5('text')\" class=\"st-des\">\n            点击可对模块进行隐藏、删除操作，支持拖动排序\n          </div>\n          <div\n            :class=\"h5('modules')\"\n            v-if=\"modulesData.length\"\n            ref=\"leftModules\"\n          >\n            <div @click=\"tapModuleItem(modulesData[0], 0)\">\n              <h5ModuleComponent\n                :isActive=\"sliderIndex === 0\"\n                :moduleInfo=\"modulesData[0]\"\n                :hasSlot=\"true\"\n              >\n                <div\n                  :class=\"h5('shop-detail--button')\"\n                  v-if=\"modulesData[0].module_tag === 'shop_detail'\"\n                  @click=\"shopDetailChange\"\n                >\n                  修改样式\n                </div>\n              </h5ModuleComponent>\n            </div>\n            <st-draggable\n              v-model=\"modulesData\"\n              :animation=\"200\"\n              @change=\"dragModule\"\n              handle=\".h5-setting-index-component__slider--canDrag\"\n            >\n              <div\n                :class=\"h5('slider', { canDrag: canDrag })\"\n                v-for=\"(item, index) in modulesData\"\n                :key=\"index\"\n                @click=\"tapModuleItem(item, index)\"\n              >\n                <h5ModuleComponent\n                  v-if=\"!item.module_is_delete && index\"\n                  :isActive=\"sliderIndex === index\"\n                  :moduleInfo=\"item\"\n                  @change=\"moduleItemChange($event, index)\"\n                  @delete=\"deleteModuleItem($event, index)\"\n                  @mouse=\"mouseEvent($event)\"\n                ></h5ModuleComponent>\n              </div>\n            </st-draggable>\n          </div>\n        </div>\n        <div :class=\"h5('right')\">\n          <div :class=\"h5('content')\">\n            <div :class=\"h5('phone')\">\n              <div :class=\"h5('phone-placeholder')\"></div>\n              <h5PhoneComponent\n                :class=\"h5('phone-content')\"\n                :moduleDatas=\"modulesData\"\n                :selectIndex=\"phoneIndex\"\n                :sliderIndex=\"sliderIndex\"\n                :currentShopInfo=\"currentShopInfo\"\n                @tapSlide=\"tapSlide\"\n              />\n            </div>\n            <div :class=\"h5('form')\">\n              <div :class=\"h5('form-container')\" v-if=\"modulesData.length\">\n                <div\n                  :class=\"h5('form-container__no-display')\"\n                  v-if=\"!modulesData[sliderIndex].module_is_display\"\n                >\n                  <div :class=\"h5('form-container__no-display-box')\">\n                    <st-no-data :text=\"'该模块已隐藏'\" />\n                    <p>\n                      请点击左侧模块按钮可解除隐藏状态\n                    </p>\n                  </div>\n                </div>\n                <component\n                  v-else\n                  :is=\"componentList[modulesData[sliderIndex].module_type]\"\n                  :moduleName=\"modulesData[sliderIndex].module_name\"\n                  :maxNum=\"modulesData[sliderIndex].max_num\"\n                  v-model=\"modulesData[sliderIndex].content\"\n                  :moduleType=\"modulesData[sliderIndex].module_type\"\n                  :shopId=\"shopId\"\n                  @change=\"editEmit\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </a-spin>\n  </div>\n</template>\n<script>\nimport { cloneDeep, omit } from 'lodash-es'\nimport H5ModuleComponent from './h5-module.component'\nimport h5ShopListComponent from './h5-shop-list.component'\nimport h5PhoneComponent from './h5-phone.component'\nimport { H5SettingIndexService } from './h5-setting-index.service'\nimport { swiper, swiperSlide } from 'vue-awesome-swiper'\nimport draggable from 'vuedraggable'\nimport BrandSettingMinaCheckoutShopinfoLayout from '@/views/biz-modals/brand/setting/mina/checkout-shopinfo-layout'\n\nimport h5FormShopinfoComponent from './form-components#/h5-form.shopinfo.component'\nimport h5FormFnComponent from './form-components#/h5-form.fn.component'\nimport h5FormCoachComponent from './form-components#/h5-form.coach.component'\nimport h5FormCardComponent from './form-components#/h5-form.card.component'\nimport h5FormCourseComponent from './form-components#/h5-form.course.component'\nimport h5FormPackageComponent from './form-components#/h5-form.package.component'\nimport h5FormCouponComponent from './form-components#/h5-form.coupon.component'\nimport h5FormInvitationComponent from './form-components#/h5-form.invitation.component'\nimport h5FormTurntableComponent from './form-components#/h5-form.turntable.component'\nimport h5FormActivityComponent from './form-components#/h5-form.activity.component'\nimport h5FormGroupComponent from './form-components#/h5-form.group.component'\nimport h5FormDiscountComponent from './form-components#/h5-form.discount.component'\nimport h5FormSeckillComponent from './form-components#/h5-form.seckill.component'\nimport { MessageService } from '@/services/message.service'\n\nexport default {\n  name: 'H5SettingIndexComponent',\n  components: {\n    H5ModuleComponent,\n    h5PhoneComponent,\n    h5ShopListComponent,\n    swiper,\n    swiperSlide,\n    h5FormShopinfoComponent,\n    h5FormFnComponent,\n    h5FormCoachComponent,\n    h5FormCardComponent,\n    h5FormCourseComponent,\n    h5FormPackageComponent,\n    h5FormCouponComponent,\n    h5FormInvitationComponent,\n    h5FormTurntableComponent,\n    h5FormActivityComponent,\n    h5FormGroupComponent,\n    h5FormDiscountComponent,\n    h5FormSeckillComponent,\n    draggable\n  },\n  bem: {\n    h5: 'h5-setting-index-component'\n  },\n  modals: {\n    BrandSettingMinaCheckoutShopinfoLayout\n  },\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      h5SettingIndexService: H5SettingIndexService\n    }\n  },\n  rxState() {\n    return {\n      shopList: this.h5SettingIndexService.shopList$,\n      currentShopInfo: this.h5SettingIndexService.currentShopInfo$,\n      fnModules: this.h5SettingIndexService.fnModules$,\n      modulesData: this.h5SettingIndexService.modulesData$,\n      marketingModules: this.h5SettingIndexService.marketingModules$,\n      loading: this.h5SettingIndexService.loading$\n    }\n  },\n  computed: {\n    moduleType: function() {\n      return (\n        this.modulesData[this.sliderIndex] && this.modulesData[this.sliderIndex]\n      )\n    }\n  },\n  data() {\n    return {\n      draggableOptions: {},\n      shopId: '',\n      shopActiveIndex: 0,\n      sliderIndex: 0,\n      phoneIndex: 0,\n      componentList: {\n        1: 'h5FormShopinfoComponent',\n        2: 'h5FormFnComponent',\n        3: 'h5FormCoachComponent',\n        4: 'h5FormCardComponent',\n        5: 'h5FormCourseComponent',\n        6: 'h5FormPackageComponent',\n        12: 'h5FormCouponComponent',\n        13: 'h5FormInvitationComponent',\n        14: 'h5FormTurntableComponent',\n        15: 'h5FormActivityComponent',\n        16: 'h5FormGroupComponent',\n        17: 'h5FormDiscountComponent',\n        18: 'h5FormSeckillComponent'\n      },\n      isEditFlag: false,\n      canDrag: true\n    }\n  },\n  created() {\n    this.init()\n  },\n  mounted() {},\n  watch: {\n    sliderIndex(newVal) {\n      if (this.$refs.leftModules) {\n        this.$refs.leftModules.scrollTop = newVal * 72\n      }\n    }\n  },\n  methods: {\n    init() {\n      this.h5SettingIndexService.getShopList().subscribe(res => {\n        if (!!res.list.length) {\n          this.getModuleDataAndShopInfo(res.list[0].shop_id)\n        }\n      })\n    },\n\n    // 添加模块\n    selectModule(item) {\n      let showModuleList = this.modulesData.filter(item => {\n        return +!item.module_is_delete\n      })\n      if (showModuleList.length === 15) {\n        return this.messageService.warn({\n          content:\n            '小程序最多可添加15个功能模块，当前已达数量上限，请在删除模块后再行添加'\n        })\n      }\n      let moduleItem = cloneDeep(item)\n      this.modulesData.push(moduleItem)\n      this.editEmit()\n      setTimeout(() => {\n        this.setIndex(this.modulesData.length - 1)\n      })\n    },\n    // 门店信息模块切换样式\n    shopDetailChange() {\n      this.$modalRouter.push({\n        name: 'brand-setting-mina-checkout-shopinfo-layout',\n        props: {\n          layout: this.modulesData[0].content.show_style\n        },\n        on: {\n          success: e => {\n            this.editEmit()\n            this.modulesData[0].content.show_style = e\n          }\n        }\n      })\n    },\n    // 操作了模块\n    moduleItemChange(module, index) {\n      this.modulesData.splice(index, 1, cloneDeep(module))\n      this.editEmit()\n    },\n    // 删除模块\n    deleteModuleItem(module, index) {\n      this.editEmit()\n      if (+!this.modulesData[index].module_id) {\n        // 新模块module_id为0\n        this.modulesData.splice(index, 1)\n      } else {\n        this.modulesData.splice(index, 1, cloneDeep(module))\n      }\n      console.log(this.modulesData)\n      let remainingModules = this.modulesData.slice(index + 1)\n      let moduleNoDelete = []\n      if (remainingModules.length) {\n        remainingModules.forEach(item => {\n          if (+!item.module_is_delete) {\n            moduleNoDelete.push(item)\n          }\n        })\n      }\n      if (moduleNoDelete.length > 0) {\n        // 向下查找到没有删除的\n        let i = index + 1\n        let num = 1\n        while (this.modulesData[i].module_is_delete) {\n          i++\n          num++\n        }\n        this.sliderIndex = i\n        this.phoneIndex = i - num\n      } else {\n        // 向上查找到没有删除的\n        let i = index - 1\n        while (this.modulesData[i].module_is_delete) {\n          i--\n        }\n        this.setIndex(i)\n      }\n    },\n    // 拖拽模块\n    dragModule(e) {\n      this.setIndex(e.moved.newIndex)\n      this.editEmit()\n    },\n    // 点击模块\n    tapModuleItem(module, index) {\n      this.setIndex(index)\n    },\n    // 切换了门店\n    switchShop(shopId) {\n      if (shopId != this.currentShopInfo.id) {\n        if (this.isEditFlag) {\n          this.$confirm({\n            title: '确定要离开？',\n            content: '此时离开将丢失已编辑的内容，是否确认离开？',\n            onOk: () => {\n              this.getModuleDataAndShopInfo(shopId)\n              this.editEmit(false)\n            }\n          })\n        } else {\n          this.getModuleDataAndShopInfo(shopId)\n        }\n      }\n    },\n    // 手机中点击\n    tapSlide({ sliderIndex }) {\n      this.setIndex(sliderIndex)\n    },\n    // 获取模块数据和门店详情\n    getModuleDataAndShopInfo(shopId) {\n      this.shopId = shopId\n      this.shopActiveIndex = this.shopList.findIndex(item => {\n        return item.shop_id === shopId\n      })\n      this.h5SettingIndexService\n        .getShopModules({ shop_id: shopId, tab_type: '1' })\n        .subscribe(res => {\n          this.setIndex(0)\n        })\n      this.h5SettingIndexService.getShopInfo(shopId).subscribe()\n      this.h5SettingIndexService.getModules(shopId).subscribe()\n    },\n    setIndex(index) {\n      this.sliderIndex = this.phoneIndex = index\n    },\n    saveData() {\n      let modulesData = cloneDeep(this.modulesData)\n      for (let i = 0; i < modulesData.length; i++) {\n        if (!modulesData[i].module_is_delete) {\n          if (modulesData[i].module_type === 2) {\n            let noHasImg = modulesData[i].content.list.find(list => {\n              return !Object.keys(list.image).length\n            })\n            if (noHasImg) {\n              this.messageService.warn({\n                content: `请上传${modulesData[i].module_name}图片`\n              })\n              return false\n            }\n          }\n          if (modulesData[i].module_type === 3) {\n            if (\n              modulesData[i].content.list.length &&\n              modulesData[i].content.list.length > modulesData[i].max_num\n            ) {\n              this.messageService.warn({\n                content: `${modulesData[i].module_name}最多添加${modulesData[i].max_num}项`\n              })\n              return false\n            }\n          }\n        }\n      }\n      let saveData = modulesData.map(item => {\n        item = omit(item, ['is_can_rename', 'is_can_display', 'is_can_delete'])\n        if (item.module_type === 3 && !!item.content.list.length) {\n          // 教练模块\n          let coachList = item.content.list.map(coach => {\n            return coach.id\n          })\n          item.content.list = coachList\n        }\n        return item\n      })\n      console.log(saveData)\n      this.$confirm({\n        title: '',\n        content: '确认将当前设置内容发布到小程序？',\n        onOk: () => {\n          this.h5SettingIndexService\n            .saveIndexConfig({\n              shop_id: this.shopId,\n              tab_type: 1,\n              module_list: saveData\n            })\n            .subscribe(res => {\n              this.messageService.success({\n                content: '保存成功'\n              })\n              this.editEmit(false)\n              this.getModuleDataAndShopInfo(this.shopId)\n              this.setIndex(0)\n            })\n        }\n      })\n    },\n    editEmit(flag = true) {\n      this.isEditFlag = flag\n      this.$emit('change', this.isEditFlag)\n    },\n    mouseEvent(e) {\n      this.canDrag = e\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/brand/setting/mina/components#/h5"}]}