{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/activity-registration/add.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/activity-registration/add.vue","mtime":1591147717298},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Step1Form from './components#/step1-form'\nimport Step2Form from './components#/step2-form'\nimport Step3Form from './components#/step3-form'\nimport ActivityH5View from './components#/activity-h5-view'\nimport TicketH5View from './components#/ticket-h5-view'\nimport SignupH5View from './components#/signup-h5-view'\nimport { AddService } from './add.service'\nexport default {\n  name: 'AddActivity',\n  bem: {\n    bPage: 'page-plugin-form-activity'\n  },\n  serviceInject() {\n    return {\n      service: AddService\n    }\n  },\n  components: {\n    ActivityH5View,\n    TicketH5View,\n    SignupH5View,\n    Step1Form,\n    Step3Form,\n    Step2Form\n  },\n  data() {\n    return {\n      step1Info: {},\n      step2Info: [],\n      step3Info: [],\n      stepForm: {},\n      steps: [\n        { title: '活动信息' },\n        { title: '票种信息' },\n        { title: '报名信息' }\n      ],\n      currentStep: 0\n    }\n  },\n  props: {\n    isCopy: {\n      type: Boolean,\n      default: false\n    },\n    isEdit: {\n      type: Boolean,\n      default: false\n    }\n  },\n  methods: {\n    onBack(step) {\n      this.currentStep = step\n    },\n    onChangeStep1Form(formObj) {\n      this.step1Info = formObj\n    },\n    onChangeStep2Form(ticketList) {\n      this.step2Info = [...ticketList]\n    },\n    onChangeStep3Form(signUpList) {\n      this.step3Info = [...signUpList]\n    },\n    onSubmitGetStep1Form(form) {\n      this.currentStep = 1\n      this.stepForm = form\n    },\n    onSubmitGetStep2Form(form) {\n      this.currentStep = 2\n      this.$set(this.stepForm, 'tickets', form)\n    },\n    // 发布活动\n    onReleaseActivity(form) {\n      this.stepForm.is_draft = 0\n      this.$set(this.stepForm, 'rule_settings', JSON.stringify(form))\n      // 发布\n      if (this.isEdit) {\n        this.service.updateActivity(this.stepForm).subscribe(res => {\n          this.$router.push({\n            path: '/brand/marketing/plugin/activity-registration/success',\n            query: {\n              activity_id: this.stepForm.activity_id\n            }\n          })\n        })\n      } else if (this.isCopy) {\n        this.service.copyActivity(this.stepForm).subscribe(res => {\n          this.$router.push({\n            path: '/brand/marketing/plugin/activity-registration/success',\n            query: {\n              activity_id: res.activity_id\n            }\n          })\n        })\n      } else {\n        this.service.addActivity(this.stepForm).subscribe(res => {\n          this.$router.push({\n            path: '/brand/marketing/plugin/activity-registration/success',\n            query: {\n              activity_id: res.activity_id\n            }\n          })\n        })\n      }\n    },\n    // 存草稿\n    onSaveDraftActivity(form) {\n      this.stepForm.is_draft = 1\n      this.$set(this.stepForm, 'rule_settings', JSON.stringify(form))\n      this.service.saveDraftActivity(this.stepForm).subscribe(res => {\n        this.$router.push({\n          path: '/brand/marketing/plugin/activity-registration/list'\n        })\n      })\n    },\n    onClickStep(idx) {\n      this.currentStep = idx\n    }\n  }\n}\n",{"version":3,"sources":["add.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add.vue","sourceRoot":"src/views/pages/brand/marketing/plugin/activity-registration","sourcesContent":["<template>\n  <st-mina-panel>\n    <div slot=\"preview\">\n      <activity-h5-view\n        v-if=\"currentStep === 0\"\n        :stepInfo=\"step1Info\"\n      ></activity-h5-view>\n      <ticket-h5-view\n        v-if=\"currentStep === 1\"\n        :stepInfo=\"step2Info\"\n      ></ticket-h5-view>\n      <signup-h5-view\n        v-if=\"currentStep === 2\"\n        :stepInfo=\"step3Info\"\n      ></signup-h5-view>\n    </div>\n    <div :class=\"bPage()\">\n      <a-steps :class=\"bPage('step')\" :current=\"currentStep\">\n        <a-step v-for=\"(info, idx) in steps\" :key=\"idx\" :title=\"info.title\" />\n      </a-steps>\n      <div :class=\"bPage('form')\">\n        <step1-form\n          v-show=\"currentStep === 0\"\n          :show=\"currentStep === 0\"\n          :isCopy=\"isCopy\"\n          :isEdit=\"isEdit\"\n          @step-submit=\"onSubmitGetStep1Form\"\n          @change=\"onChangeStep1Form\"\n        ></step1-form>\n        <step2-form\n          v-show=\"currentStep === 1\"\n          :show=\"currentStep === 1\"\n          :isCopy=\"isCopy\"\n          :stepForm=\"stepForm\"\n          @back=\"onBack\"\n          :isEdit=\"isEdit\"\n          @step-submit=\"onSubmitGetStep2Form\"\n          @change=\"onChangeStep2Form\"\n        ></step2-form>\n        <step3-form\n          v-show=\"currentStep === 2\"\n          :show=\"currentStep === 2\"\n          :isCopy=\"isCopy\"\n          :isEdit=\"isEdit\"\n          @back=\"onBack\"\n          @release=\"onReleaseActivity\"\n          @save-draft=\"onSaveDraftActivity\"\n          @change=\"onChangeStep3Form\"\n        ></step3-form>\n      </div>\n    </div>\n    <portal-target\n      slot=\"actions\"\n      name=\"BRAND_MARKETING_ACTIVITY_FORM_ACTIONS\"\n    ></portal-target>\n  </st-mina-panel>\n</template>\n<script>\nimport Step1Form from './components#/step1-form'\nimport Step2Form from './components#/step2-form'\nimport Step3Form from './components#/step3-form'\nimport ActivityH5View from './components#/activity-h5-view'\nimport TicketH5View from './components#/ticket-h5-view'\nimport SignupH5View from './components#/signup-h5-view'\nimport { AddService } from './add.service'\nexport default {\n  name: 'AddActivity',\n  bem: {\n    bPage: 'page-plugin-form-activity'\n  },\n  serviceInject() {\n    return {\n      service: AddService\n    }\n  },\n  components: {\n    ActivityH5View,\n    TicketH5View,\n    SignupH5View,\n    Step1Form,\n    Step3Form,\n    Step2Form\n  },\n  data() {\n    return {\n      step1Info: {},\n      step2Info: [],\n      step3Info: [],\n      stepForm: {},\n      steps: [\n        { title: '活动信息' },\n        { title: '票种信息' },\n        { title: '报名信息' }\n      ],\n      currentStep: 0\n    }\n  },\n  props: {\n    isCopy: {\n      type: Boolean,\n      default: false\n    },\n    isEdit: {\n      type: Boolean,\n      default: false\n    }\n  },\n  methods: {\n    onBack(step) {\n      this.currentStep = step\n    },\n    onChangeStep1Form(formObj) {\n      this.step1Info = formObj\n    },\n    onChangeStep2Form(ticketList) {\n      this.step2Info = [...ticketList]\n    },\n    onChangeStep3Form(signUpList) {\n      this.step3Info = [...signUpList]\n    },\n    onSubmitGetStep1Form(form) {\n      this.currentStep = 1\n      this.stepForm = form\n    },\n    onSubmitGetStep2Form(form) {\n      this.currentStep = 2\n      this.$set(this.stepForm, 'tickets', form)\n    },\n    // 发布活动\n    onReleaseActivity(form) {\n      this.stepForm.is_draft = 0\n      this.$set(this.stepForm, 'rule_settings', JSON.stringify(form))\n      // 发布\n      if (this.isEdit) {\n        this.service.updateActivity(this.stepForm).subscribe(res => {\n          this.$router.push({\n            path: '/brand/marketing/plugin/activity-registration/success',\n            query: {\n              activity_id: this.stepForm.activity_id\n            }\n          })\n        })\n      } else if (this.isCopy) {\n        this.service.copyActivity(this.stepForm).subscribe(res => {\n          this.$router.push({\n            path: '/brand/marketing/plugin/activity-registration/success',\n            query: {\n              activity_id: res.activity_id\n            }\n          })\n        })\n      } else {\n        this.service.addActivity(this.stepForm).subscribe(res => {\n          this.$router.push({\n            path: '/brand/marketing/plugin/activity-registration/success',\n            query: {\n              activity_id: res.activity_id\n            }\n          })\n        })\n      }\n    },\n    // 存草稿\n    onSaveDraftActivity(form) {\n      this.stepForm.is_draft = 1\n      this.$set(this.stepForm, 'rule_settings', JSON.stringify(form))\n      this.service.saveDraftActivity(this.stepForm).subscribe(res => {\n        this.$router.push({\n          path: '/brand/marketing/plugin/activity-registration/list'\n        })\n      })\n    },\n    onClickStep(idx) {\n      this.currentStep = idx\n    }\n  }\n}\n</script>\n"]}]}