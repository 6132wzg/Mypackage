{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/activity.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/activity.vue","mtime":1597895242001},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { H5WrapperService } from '@/views/pages/brand/setting/mina/components#/h5/h5-wrapper.service'\nimport RowContainerComponent from '@/views/pages/brand/setting/mina/components#/h5/row-container.component'\nimport H5Component from '@/views/pages/brand/setting/mina/components#/h5/h5.component'\nimport SliderComponent from './components#/slider.component'\nimport EventComponent from './components#/event.component'\nimport { NotificationService } from '@/services/notification.service'\nimport { ActivityService } from './activity.service'\nimport { cloneDeep } from 'lodash-es'\n\nexport default {\n  name: 'H5WrapperComponent',\n  components: {\n    RowContainerComponent,\n    H5Component,\n    SliderComponent,\n    EventComponent\n  },\n\n  props: {},\n  bem: {\n    activity: 'brand-marketing-activity'\n  },\n  serviceInject() {\n    return {\n      h5WrapperService: H5WrapperService,\n      notificationService: NotificationService,\n      activityService: ActivityService\n    }\n  },\n  rxState() {\n    return {\n      sliderInfo: this.h5WrapperService.sliderInfo$,\n      eventInfo: this.h5WrapperService.eventInfo$,\n      loading: this.h5WrapperService.loading$,\n      actList: this.activityService.actList$,\n      info: this.activityService.info$\n    }\n  },\n  data() {\n    return {\n      sliderLoaded: false,\n      openStatus: 0,\n      openMiniFlag: false,\n      isFixed: false,\n      offsetTop: 0\n    }\n  },\n  created() {\n    let that = this\n    let title = ''\n    let content = ''\n    let okText = '确定'\n    if (this.info.is_auth === 0) {\n      title = '提示'\n      content = '请先开通小程序后使用此功能'\n      okText = '去绑定小程序'\n    } else {\n      this.getH5Info()\n      title = '温馨提示'\n      content =\n        '活动广告配置功能已迁移至“小程序配置”菜单，点击下方按钮去配置活动吧！'\n      okText = '去配置'\n    }\n    this.$confirm({\n      title: title,\n      content: content,\n      okText: okText,\n      cancelText: '返回',\n      keyboard: false,\n      onOk() {\n        that.$router.push({ path: '/brand/setting/mina/index' })\n      },\n      onCancel() {\n        that.$router.back()\n      }\n    })\n    // this.getActList()\n  },\n  mounted() {\n    this.offsetTop = document.querySelector('#h5').offsetTop\n    window.addEventListener('scroll', this.handleScroll)\n  },\n  destroyed() {\n    window.removeEventListener('scroll', this.handleScroll)\n  },\n  watch: {\n    openStatus(newVal) {\n      newVal ? (this.openMiniFlag = true) : (this.openMiniFlag = false)\n    }\n  },\n  methods: {\n    handleScroll() {\n      let scrollTop =\n        window.pageYOffset ||\n        document.documentElement.scrollTop ||\n        document.body.scrollTop\n      let offsetTop = this.offsetTop\n      if (scrollTop > offsetTop) {\n        this.isFixed = true\n      } else {\n        this.isFixed = false\n      }\n    },\n    onOpenStatusChange(data) {\n      if (!data) {\n        this.$confirm({\n          title: '提示',\n          content: `一旦关闭，小程序会关闭首页营销位，请谨慎操作。`,\n          onCancel: () => {\n            this.openStatus = 1\n          },\n          onOk: () => {\n            //this.openStatus === 3\n          }\n        })\n      }\n    },\n    saveConfirm(is_status) {\n      let content = ''\n      if (is_status === 1) content = '是否确认将当前配置信息发布到小程序？'\n      if (is_status === 2) content = '是否确认将当前配置信息发布到小程序？'\n      this.$confirm({\n        content: content,\n        onOk: () => {\n          this.save(is_status)\n        }\n      })\n    },\n    save(is_status) {\n      let saveForm = {\n        info: []\n      }\n      for (let i = 0; i < this.sliderInfo.length; i++) {\n        this.sliderInfo[i].activity_id =\n          this.sliderInfo[i].activity_id[1] || this.sliderInfo[i].activity_id\n      }\n      for (let i = 0; i < this.eventInfo.length; i++) {\n        this.eventInfo[i].activity_id =\n          this.eventInfo[i].activity_id[1] || this.eventInfo[i].activity_id\n      }\n      saveForm.info.push({\n        category: 1,\n        content: this.sliderInfo,\n        status: is_status\n      })\n      saveForm.info.push({\n        category: 3,\n        content: this.eventInfo,\n        status: this.openStatus ? 2 : 3\n      })\n      this.h5WrapperService.save(saveForm).subscribe(res => {\n        if (res.is_success === 1) {\n          this.notificationService.success({\n            title: '保存成功',\n            content: '成功'\n          })\n        } else if (res.is_success === 0) {\n          this.notificationService.error({\n            title: '保存失败',\n            content: res.message\n          })\n        }\n      })\n    },\n    setCoashIDs() {\n      let coach = cloneDeep(this.coach)\n      coach.staff_id_list = []\n      this.coachInfo.forEach(item => {\n        coach.staff_id_list.push(item.id)\n      })\n      return coach\n    },\n    getActList() {\n      this.activityService.getInfo().subscribe()\n    },\n    getH5Info() {\n      let that = this\n      this.h5WrapperService.getH5Info({ category: 1 }).subscribe(() => {\n        this.sliderLoaded = true\n      })\n      this.h5WrapperService.getH5Info({ category: 2 }).subscribe()\n      this.h5WrapperService.getH5Info({ category: 3 }).subscribe(res => {\n        this.openStatus = res.status\n      })\n      this.h5WrapperService.getH5Info({ category: 4 }).subscribe(res => {\n        let staff_id = []\n        if (res.content) {\n          staff_id = res.content.staff_id_list\n        }\n        that.h5WrapperService.getCoachInfo({ staff_id: staff_id }).subscribe()\n      })\n      this.h5WrapperService.getH5Info({ category: 5 }).subscribe()\n      this.h5WrapperService.getMenu().subscribe()\n    }\n  }\n}\n",{"version":3,"sources":["activity.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"activity.vue","sourceRoot":"src/views/pages/brand/marketing","sourcesContent":["<template>\n  <st-mina-panel :class=\"activity()\" initial>\n    <h5-component\n      slot=\"preview\"\n      id=\"h5\"\n      :class=\"{ fixed: isFixed }\"\n      :openMiniFlag=\"openMiniFlag\"\n    ></h5-component>\n\n    <st-tabs defaultActiveKey=\"1\">\n      <st-tab-pane tab=\"活动轮播图\" key=\"1\">\n        <row-container-component\n          title=\"头图活动广告\"\n          subTitle=\"拖动图片进行排序，最多新增5张轮播图广告\"\n        >\n          <slider-component v-if=\"sliderLoaded\"></slider-component>\n        </row-container-component>\n      </st-tab-pane>\n      <st-tab-pane tab=\"营销位活动\" key=\"2\" forceRender>\n        <row-container-component\n          title=\"营销活动推广设置\"\n          subTitle=\"推广活动数量会对图片尺寸有不同要求\"\n        >\n          <st-form>\n            <st-form-item label=\"功能开关\" labelWidth=\"71px\" required>\n              <st-switch v-model=\"openStatus\" @change=\"onOpenStatusChange\" />\n              <span class=\"mg-l12 mg-r12\">\n                {{ openMiniFlag ? '已' : '未' }}开启\n              </span>\n              <span v-if=\"!openMiniFlag\">\n                （一旦开启，将会在小程序展示，如需关闭，请谨慎操作。）\n              </span>\n            </st-form-item>\n          </st-form>\n          <event-component v-if=\"openMiniFlag\"></event-component>\n        </row-container-component>\n      </st-tab-pane>\n    </st-tabs>\n    <div slot=\"actions\" v-if=\"info.is_auth === 1\">\n      <st-button type=\"primary\" :loading=\"loading.save\" @click=\"saveConfirm(2)\">\n        保存并提交\n      </st-button>\n    </div>\n  </st-mina-panel>\n</template>\n<script>\nimport { H5WrapperService } from '@/views/pages/brand/setting/mina/components#/h5/h5-wrapper.service'\nimport RowContainerComponent from '@/views/pages/brand/setting/mina/components#/h5/row-container.component'\nimport H5Component from '@/views/pages/brand/setting/mina/components#/h5/h5.component'\nimport SliderComponent from './components#/slider.component'\nimport EventComponent from './components#/event.component'\nimport { NotificationService } from '@/services/notification.service'\nimport { ActivityService } from './activity.service'\nimport { cloneDeep } from 'lodash-es'\n\nexport default {\n  name: 'H5WrapperComponent',\n  components: {\n    RowContainerComponent,\n    H5Component,\n    SliderComponent,\n    EventComponent\n  },\n\n  props: {},\n  bem: {\n    activity: 'brand-marketing-activity'\n  },\n  serviceInject() {\n    return {\n      h5WrapperService: H5WrapperService,\n      notificationService: NotificationService,\n      activityService: ActivityService\n    }\n  },\n  rxState() {\n    return {\n      sliderInfo: this.h5WrapperService.sliderInfo$,\n      eventInfo: this.h5WrapperService.eventInfo$,\n      loading: this.h5WrapperService.loading$,\n      actList: this.activityService.actList$,\n      info: this.activityService.info$\n    }\n  },\n  data() {\n    return {\n      sliderLoaded: false,\n      openStatus: 0,\n      openMiniFlag: false,\n      isFixed: false,\n      offsetTop: 0\n    }\n  },\n  created() {\n    let that = this\n    let title = ''\n    let content = ''\n    let okText = '确定'\n    if (this.info.is_auth === 0) {\n      title = '提示'\n      content = '请先开通小程序后使用此功能'\n      okText = '去绑定小程序'\n    } else {\n      this.getH5Info()\n      title = '温馨提示'\n      content =\n        '活动广告配置功能已迁移至“小程序配置”菜单，点击下方按钮去配置活动吧！'\n      okText = '去配置'\n    }\n    this.$confirm({\n      title: title,\n      content: content,\n      okText: okText,\n      cancelText: '返回',\n      keyboard: false,\n      onOk() {\n        that.$router.push({ path: '/brand/setting/mina/index' })\n      },\n      onCancel() {\n        that.$router.back()\n      }\n    })\n    // this.getActList()\n  },\n  mounted() {\n    this.offsetTop = document.querySelector('#h5').offsetTop\n    window.addEventListener('scroll', this.handleScroll)\n  },\n  destroyed() {\n    window.removeEventListener('scroll', this.handleScroll)\n  },\n  watch: {\n    openStatus(newVal) {\n      newVal ? (this.openMiniFlag = true) : (this.openMiniFlag = false)\n    }\n  },\n  methods: {\n    handleScroll() {\n      let scrollTop =\n        window.pageYOffset ||\n        document.documentElement.scrollTop ||\n        document.body.scrollTop\n      let offsetTop = this.offsetTop\n      if (scrollTop > offsetTop) {\n        this.isFixed = true\n      } else {\n        this.isFixed = false\n      }\n    },\n    onOpenStatusChange(data) {\n      if (!data) {\n        this.$confirm({\n          title: '提示',\n          content: `一旦关闭，小程序会关闭首页营销位，请谨慎操作。`,\n          onCancel: () => {\n            this.openStatus = 1\n          },\n          onOk: () => {\n            //this.openStatus === 3\n          }\n        })\n      }\n    },\n    saveConfirm(is_status) {\n      let content = ''\n      if (is_status === 1) content = '是否确认将当前配置信息发布到小程序？'\n      if (is_status === 2) content = '是否确认将当前配置信息发布到小程序？'\n      this.$confirm({\n        content: content,\n        onOk: () => {\n          this.save(is_status)\n        }\n      })\n    },\n    save(is_status) {\n      let saveForm = {\n        info: []\n      }\n      for (let i = 0; i < this.sliderInfo.length; i++) {\n        this.sliderInfo[i].activity_id =\n          this.sliderInfo[i].activity_id[1] || this.sliderInfo[i].activity_id\n      }\n      for (let i = 0; i < this.eventInfo.length; i++) {\n        this.eventInfo[i].activity_id =\n          this.eventInfo[i].activity_id[1] || this.eventInfo[i].activity_id\n      }\n      saveForm.info.push({\n        category: 1,\n        content: this.sliderInfo,\n        status: is_status\n      })\n      saveForm.info.push({\n        category: 3,\n        content: this.eventInfo,\n        status: this.openStatus ? 2 : 3\n      })\n      this.h5WrapperService.save(saveForm).subscribe(res => {\n        if (res.is_success === 1) {\n          this.notificationService.success({\n            title: '保存成功',\n            content: '成功'\n          })\n        } else if (res.is_success === 0) {\n          this.notificationService.error({\n            title: '保存失败',\n            content: res.message\n          })\n        }\n      })\n    },\n    setCoashIDs() {\n      let coach = cloneDeep(this.coach)\n      coach.staff_id_list = []\n      this.coachInfo.forEach(item => {\n        coach.staff_id_list.push(item.id)\n      })\n      return coach\n    },\n    getActList() {\n      this.activityService.getInfo().subscribe()\n    },\n    getH5Info() {\n      let that = this\n      this.h5WrapperService.getH5Info({ category: 1 }).subscribe(() => {\n        this.sliderLoaded = true\n      })\n      this.h5WrapperService.getH5Info({ category: 2 }).subscribe()\n      this.h5WrapperService.getH5Info({ category: 3 }).subscribe(res => {\n        this.openStatus = res.status\n      })\n      this.h5WrapperService.getH5Info({ category: 4 }).subscribe(res => {\n        let staff_id = []\n        if (res.content) {\n          staff_id = res.content.staff_id_list\n        }\n        that.h5WrapperService.getCoachInfo({ staff_id: staff_id }).subscribe()\n      })\n      this.h5WrapperService.getH5Info({ category: 5 }).subscribe()\n      this.h5WrapperService.getMenu().subscribe()\n    }\n  }\n}\n</script>\n"]}]}