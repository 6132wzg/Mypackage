{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/course/package/update-rights.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/course/package/update-rights.vue","mtime":1601345845238},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { UpdateRightsService } from './update-rights.service.ts'\nimport { ruleOptions } from './update-rights.config'\nimport { MessageService } from '@/services/message.service'\nimport CommonTaskSuccessTip from '@/views/biz-modals/common/task/success-tip'\nexport default {\n  modals: {\n    CommonTaskSuccessTip\n  },\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      updateRightsService: UpdateRightsService\n    }\n  },\n  rxState() {\n    const {\n      info$,\n      loading$,\n      transferUnitOptions$,\n      supportMemberNumOptions$,\n      reserveLimitDayOptions$,\n      reserveIsLimitNewOptions$\n    } = this.updateRightsService\n    return {\n      info: info$,\n      loading: loading$,\n      transferUnitOptions: transferUnitOptions$,\n      supportMemberNumOptions: supportMemberNumOptions$,\n      reserveLimitDayOptions: reserveLimitDayOptions$,\n      reserveIsLimitNewOptions: reserveIsLimitNewOptions$\n    }\n  },\n  props: {\n    id: {\n      type: Number,\n      default: 0\n    },\n    /**\n     * 是否是课程包列表的同步售出权益操作\n     */\n    isSync: {\n      type: Boolean,\n      default: false\n    },\n    isShowLink: {\n      type: Boolean,\n      default: true\n    },\n    isBrandTaskLink: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      show: false,\n      timeList: [],\n      INOUT_TYPE_CUSTOM: 2,\n      switches: {\n        supportNum: 0,\n        frozenTime: 0,\n        transferSetting: 0,\n        reserveSetting: 0\n      }\n    }\n  },\n  computed: {\n    title() {\n      return (\n        '修改售出权益' + (this.isSync ? '-选中权益点信息会同步到已售合同' : '')\n      )\n    }\n  },\n  created() {\n    this.updateRightsService.getInfo(this.id, this.isSync).subscribe(res => {\n      this.$nextTick(() => {\n        this.setFieldsValue(res.info)\n      })\n    })\n  },\n  methods: {\n    setFieldsValue(info) {\n      const { frozen_time_remain, support_num } = info\n      const { transfer_num, transfer_unit } = info.transfer\n      const {\n        reserve_limit_day,\n        reserve_limit_times,\n        reserve_is_limit\n      } = info.reserve\n      this.form.setFieldsValue({\n        support_num,\n        frozen_time_remain,\n        transfer_num,\n        transfer_unit: transfer_unit || 1,\n        reserve_limit_day: reserve_limit_day || 1,\n        reserve_limit_times,\n        reserve_is_limit\n      })\n    },\n    onSwitchChange() {\n      this.form.validateFields(\n        [\n          'transfer_num',\n          'transfer_unit',\n          'frozen_time_remain',\n          'reserve_limit_times'\n        ],\n        { force: true }\n      )\n    },\n    checkIsChanged() {\n      let isChanged = false\n      const { switches } = this\n      for (let i in switches) {\n        if (switches[i]) {\n          isChanged = true\n          return true\n        }\n      }\n      return isChanged\n    },\n    onSubmit() {\n      if (!this.checkIsChanged()) {\n        return this.messageService.error({\n          content: '未进行任何操作，请勿提交'\n        })\n      }\n      this.form.validate().then(values => {\n        this.doSubmit(values)\n      })\n    },\n    doSubmit(values) {\n      const { transfer, support_member_num, reserve } = this.info\n      const { frozen_time_remain, support_num } = values\n      const { switches } = this\n      const params = {\n        id: this.id,\n        support_num,\n        is_change_support_num: switches.supportNum,\n        frozen_time_remain,\n        is_change_frozen_time_remain: switches.frozenTime,\n        transfer: {\n          is_transferable: transfer.is_transferable,\n          transfer_num: values.transfer_num,\n          transfer_unit: values.transfer_unit\n        },\n        is_change_transfer: switches.transferSetting,\n        reserve: {\n          reserve_is_limit: reserve.reserve_is_limit,\n          reserve_limit_day: values.reserve_limit_day,\n          reserve_limit_times: values.reserve_limit_times\n        },\n        is_change_reserve: switches.reserveSetting\n      }\n      this.updateRightsService\n        .updateRights(params, this.isSync)\n        .subscribe(() => {\n          if (this.isSync) {\n            this.onSyncSubmitSuccess()\n          } else {\n            this.onSubmitSuccess()\n          }\n        })\n    },\n    onSubmitSuccess() {\n      this.messageService.success({\n        content: '提交成功'\n      })\n      this.show = false\n      this.$emit('success')\n    },\n    /**\n     * 课程包售出权益同步成功回调\n     */\n    onSyncSubmitSuccess() {\n      this.show = false\n      this.successTip()\n    },\n    successTip() {\n      this.$modalRouter.push({\n        name: 'common-task-success-tip',\n        props: {\n          isShowLink: this.isShowLink,\n          isBrandTaskLink: this.isBrandTaskLink\n        },\n        on: {\n          success: () => {\n            this.$emit('success')\n          }\n        }\n      })\n    }\n  }\n}\n",{"version":3,"sources":["update-rights.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"update-rights.vue","sourceRoot":"src/views/biz-modals/sold/course/package","sourcesContent":["<template>\n  <st-modal :title=\"title\" v-model=\"show\">\n    <st-form :form=\"form\">\n      <st-form-item labelWidth=\"120px\">\n        <template slot=\"label\">\n          <st-checkbox v-model=\"switches.supportNum\">\n            支持入场人数\n          </st-checkbox>\n        </template>\n        <st-input-number\n          v-decorator=\"decorators.support_num\"\n          :disabled=\"!switches.supportNum\"\n          :min=\"1\"\n          :max=\"20\"\n          style=\"width: 120px\"\n        >\n          <template slot=\"addonAfter\">人</template>\n        </st-input-number>\n      </st-form-item>\n      <st-form-item labelWidth=\"120px\">\n        <template slot=\"label\">\n          <st-checkbox v-model=\"switches.frozenTime\" @change=\"onSwitchChange\">\n            剩余冻结时长\n          </st-checkbox>\n        </template>\n        <st-input-number\n          v-decorator=\"decorators.frozen_time_remain\"\n          :disabled=\"!switches.frozenTime\"\n          :max=\"9999\"\n          style=\"width: 120px\"\n        >\n          <template slot=\"addonAfter\">天</template>\n        </st-input-number>\n      </st-form-item>\n      <st-form-item v-if=\"info.transfer\" labelWidth=\"88px\">\n        <template slot=\"label\">\n          <st-checkbox\n            v-model=\"switches.transferSetting\"\n            @change=\"onSwitchChange\"\n          >\n            转让设置\n          </st-checkbox>\n        </template>\n        <st-checkbox\n          :disabled=\"!switches.transferSetting\"\n          v-model=\"info.transfer.is_transferable\"\n        >\n          支持转让\n        </st-checkbox>\n        <st-input-number\n          v-show=\"info.transfer.is_transferable\"\n          v-decorator=\"decorators.transfer_num\"\n          style=\"width: 140px\"\n          :min=\"0\"\n          :max=\"form.getFieldValue('transfer_unit') === 1 ? 100 : 9999999.9\"\n          :disabled=\"!switches.transferSetting\"\n        >\n          <span slot=\"addonAfter\">\n            <a-select\n              v-decorator=\"decorators.transfer_unit\"\n              :options=\"transferUnitOptions\"\n              :disabled=\"!switches.transferSetting\"\n            ></a-select>\n          </span>\n        </st-input-number>\n      </st-form-item>\n      <st-form-item v-if=\"info.reserve\" labelWidth=\"88px\">\n        <template slot=\"label\">\n          <st-checkbox\n            v-model=\"switches.reserveSetting\"\n            @change=\"onSwitchChange\"\n          >\n            约课限制\n          </st-checkbox>\n        </template>\n        <a-select\n          style=\"width: 160px; margin-right: 10px;\"\n          v-model=\"info.reserve.reserve_is_limit\"\n          :options=\"reserveIsLimitNewOptions\"\n          :disabled=\"!switches.reserveSetting\"\n        ></a-select>\n        <st-input-number\n          v-decorator=\"decorators.reserve_limit_times\"\n          v-show=\"info.reserve.reserve_is_limit === 1\"\n          :min=\"1\"\n          :max=\"999\"\n          :disabled=\"!switches.reserveSetting\"\n          style=\"width: 200px\"\n        >\n          <a-select\n            v-decorator=\"decorators.reserve_limit_day\"\n            slot=\"addonBefore\"\n            :disabled=\"!switches.reserveSetting\"\n            :options=\"reserveLimitDayOptions\"\n          ></a-select>\n          <template slot=\"addonAfter\">节</template>\n        </st-input-number>\n        <span class=\"st-des mg-l8\">该限制仅生效于小程序</span>\n      </st-form-item>\n    </st-form>\n    <template slot=\"footer\">\n      <a-popconfirm v-if=\"isSync\" @confirm=\"onSubmit\" placement=\"topRight\">\n        <template slot=\"title\">\n          <p>\n            请再次确认是否同步，同步后会覆盖\n            <br />\n            售出售出会员卡，将会有2-5s无法正常使用\n          </p>\n        </template>\n        <st-button type=\"primary\" :loading=\"loading.updateRights\">\n          确认提交\n        </st-button>\n      </a-popconfirm>\n      <st-button\n        v-else\n        type=\"primary\"\n        @click=\"onSubmit\"\n        :loading=\"loading.updateRights\"\n      >\n        确认提交\n      </st-button>\n    </template>\n  </st-modal>\n</template>\n\n<script>\nimport { UpdateRightsService } from './update-rights.service.ts'\nimport { ruleOptions } from './update-rights.config'\nimport { MessageService } from '@/services/message.service'\nimport CommonTaskSuccessTip from '@/views/biz-modals/common/task/success-tip'\nexport default {\n  modals: {\n    CommonTaskSuccessTip\n  },\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      updateRightsService: UpdateRightsService\n    }\n  },\n  rxState() {\n    const {\n      info$,\n      loading$,\n      transferUnitOptions$,\n      supportMemberNumOptions$,\n      reserveLimitDayOptions$,\n      reserveIsLimitNewOptions$\n    } = this.updateRightsService\n    return {\n      info: info$,\n      loading: loading$,\n      transferUnitOptions: transferUnitOptions$,\n      supportMemberNumOptions: supportMemberNumOptions$,\n      reserveLimitDayOptions: reserveLimitDayOptions$,\n      reserveIsLimitNewOptions: reserveIsLimitNewOptions$\n    }\n  },\n  props: {\n    id: {\n      type: Number,\n      default: 0\n    },\n    /**\n     * 是否是课程包列表的同步售出权益操作\n     */\n    isSync: {\n      type: Boolean,\n      default: false\n    },\n    isShowLink: {\n      type: Boolean,\n      default: true\n    },\n    isBrandTaskLink: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      show: false,\n      timeList: [],\n      INOUT_TYPE_CUSTOM: 2,\n      switches: {\n        supportNum: 0,\n        frozenTime: 0,\n        transferSetting: 0,\n        reserveSetting: 0\n      }\n    }\n  },\n  computed: {\n    title() {\n      return (\n        '修改售出权益' + (this.isSync ? '-选中权益点信息会同步到已售合同' : '')\n      )\n    }\n  },\n  created() {\n    this.updateRightsService.getInfo(this.id, this.isSync).subscribe(res => {\n      this.$nextTick(() => {\n        this.setFieldsValue(res.info)\n      })\n    })\n  },\n  methods: {\n    setFieldsValue(info) {\n      const { frozen_time_remain, support_num } = info\n      const { transfer_num, transfer_unit } = info.transfer\n      const {\n        reserve_limit_day,\n        reserve_limit_times,\n        reserve_is_limit\n      } = info.reserve\n      this.form.setFieldsValue({\n        support_num,\n        frozen_time_remain,\n        transfer_num,\n        transfer_unit: transfer_unit || 1,\n        reserve_limit_day: reserve_limit_day || 1,\n        reserve_limit_times,\n        reserve_is_limit\n      })\n    },\n    onSwitchChange() {\n      this.form.validateFields(\n        [\n          'transfer_num',\n          'transfer_unit',\n          'frozen_time_remain',\n          'reserve_limit_times'\n        ],\n        { force: true }\n      )\n    },\n    checkIsChanged() {\n      let isChanged = false\n      const { switches } = this\n      for (let i in switches) {\n        if (switches[i]) {\n          isChanged = true\n          return true\n        }\n      }\n      return isChanged\n    },\n    onSubmit() {\n      if (!this.checkIsChanged()) {\n        return this.messageService.error({\n          content: '未进行任何操作，请勿提交'\n        })\n      }\n      this.form.validate().then(values => {\n        this.doSubmit(values)\n      })\n    },\n    doSubmit(values) {\n      const { transfer, support_member_num, reserve } = this.info\n      const { frozen_time_remain, support_num } = values\n      const { switches } = this\n      const params = {\n        id: this.id,\n        support_num,\n        is_change_support_num: switches.supportNum,\n        frozen_time_remain,\n        is_change_frozen_time_remain: switches.frozenTime,\n        transfer: {\n          is_transferable: transfer.is_transferable,\n          transfer_num: values.transfer_num,\n          transfer_unit: values.transfer_unit\n        },\n        is_change_transfer: switches.transferSetting,\n        reserve: {\n          reserve_is_limit: reserve.reserve_is_limit,\n          reserve_limit_day: values.reserve_limit_day,\n          reserve_limit_times: values.reserve_limit_times\n        },\n        is_change_reserve: switches.reserveSetting\n      }\n      this.updateRightsService\n        .updateRights(params, this.isSync)\n        .subscribe(() => {\n          if (this.isSync) {\n            this.onSyncSubmitSuccess()\n          } else {\n            this.onSubmitSuccess()\n          }\n        })\n    },\n    onSubmitSuccess() {\n      this.messageService.success({\n        content: '提交成功'\n      })\n      this.show = false\n      this.$emit('success')\n    },\n    /**\n     * 课程包售出权益同步成功回调\n     */\n    onSyncSubmitSuccess() {\n      this.show = false\n      this.successTip()\n    },\n    successTip() {\n      this.$modalRouter.push({\n        name: 'common-task-success-tip',\n        props: {\n          isShowLink: this.isShowLink,\n          isBrandTaskLink: this.isBrandTaskLink\n        },\n        on: {\n          success: () => {\n            this.$emit('success')\n          }\n        }\n      })\n    }\n  }\n}\n</script>\n"]}]}