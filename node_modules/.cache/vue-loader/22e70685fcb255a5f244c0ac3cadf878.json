{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/store/list.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/store/list.vue","mtime":1596792848091},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport tableMixin from '@/mixins/table.mixin'\nimport { columns } from './list.config'\nimport { ListService } from './list.service'\nimport { UserService } from '@/services/user.service'\n\nexport default {\n  mixins: [tableMixin],\n  name: 'PageShopStoreList',\n  bem: {\n    basic: 'page-shop-store-list'\n  },\n  serviceInject() {\n    return {\n      listService: ListService\n    }\n  },\n  rxState() {\n    return {\n      list: this.listService.list$,\n      page: this.listService.page$,\n      loading: this.listService.loading$,\n      goodsList: this.listService.goodsList$,\n      cloudStore: this.listService.shelvesStatus$,\n      auth: this.listService.auth$\n    }\n  },\n  data(vm) {\n    return {\n      goodsName: '', // 商品名称\n      shelvesStatus: -1, // 上架状态\n      categoryId: -1, // 商品分类\n      columns: columns(vm)\n    }\n  },\n  computed: {\n    goods_sort() {\n      let list = []\n      this.goodsList.forEach(item => {\n        list.push({ value: +item.category_id, label: item.category_name })\n      })\n      return [{ value: -1, label: '所有商品分类' }, ...list]\n    }\n  },\n  mounted() {\n    this.setSearchData()\n    console.log(this.auth)\n  },\n  watch: {\n    query(newVal) {\n      this.setSearchData()\n    }\n  },\n  methods: {\n    // 设置状态&名称\n    setSearchData() {\n      let { product_name, shelves_status, category_id } = this.$searchQuery\n      this.goodsName = product_name\n      this.categoryId = category_id || -1\n      this.shelvesStatus = shelves_status || -1\n    },\n    // 新建商品\n    onAddGoods() {\n      this.$router.push({\n        path: './add'\n      })\n    },\n    // 上下架\n    onShelf(record) {\n      let status = record.product_shelves === 1 ? 2 : 1\n      this.$confirm({\n        title: '提示',\n        content: `确定${status === 1 ? '上架' : '下架'}该商品吗？`,\n        onOk: () => {\n          this.listService\n            .onShelf(record.product_id, { shelves_status: status })\n            .subscribe(res => {\n              this.$router.reload()\n            })\n        },\n        onCancel() {}\n      })\n    },\n    onDel(record) {\n      console.log(record)\n      this.$confirm({\n        title: '提示',\n        content: `一旦删除则无法恢复，确定删除${record.product_name}？`,\n        onOk: () => {\n          this.listService.delproduct(record.product_id).subscribe(res => {\n            this.$router.reload()\n          })\n        },\n        onCancel() {}\n      })\n    },\n    onEdit(record) {\n      this.$router.push({\n        path: './edit',\n        query: { id: record.product_id }\n      })\n    }\n  }\n}\n",{"version":3,"sources":["list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqFA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"list.vue","sourceRoot":"src/views/pages/shop/store","sourcesContent":["<template>\n  <st-panel app :class=\"basic()\">\n    <div :class=\"basic('search')\">\n      <div :class=\"basic('add')\">\n        <st-button\n          icon=\"add\"\n          type=\"primary\"\n          @click=\"onAddGoods\"\n          v-if=\"auth.add\"\n        >\n          新增商品\n        </st-button>\n      </div>\n      <a-select\n        :class=\"basic('select')\"\n        v-model=\"categoryId\"\n        placeholder=\"商品分类\"\n        @change=\"onSingleSearch('category_id', $event)\"\n        style=\"width: 130px\"\n      >\n        <a-select-option v-for=\"item in goods_sort\" :key=\"item.value\">\n          {{ item.label }}\n        </a-select-option>\n      </a-select>\n      <a-select\n        :class=\"basic('select')\"\n        v-model=\"shelvesStatus\"\n        placeholder=\"所有上架状态\"\n        @change=\"onSingleSearch('shelves_status', $event)\"\n        style=\"width: 130px;margin: 0 12px;\"\n      >\n        <a-select-option v-for=\"item in cloudStore\" :key=\"item.value\">\n          {{ item.label }}\n        </a-select-option>\n      </a-select>\n      <st-input-search\n        v-model=\"goodsName\"\n        placeholder=\"请输入商品名称\"\n        maxlength=\"50\"\n        @search=\"onSingleSearch('product_name', $event)\"\n      />\n    </div>\n    <div :class=\"basic('content')\">\n      <st-table\n        rowKey=\"product_id\"\n        :page=\"page\"\n        :columns=\"columns\"\n        :dataSource=\"list\"\n        @change=\"onTableChange\"\n      >\n        <template slot=\"action\" slot-scope=\"text, record\">\n          <st-table-actions sytle=\"width: 120px\">\n            <a\n              @click=\"onEdit(record)\"\n              v-if=\"record.auth['shop:cloud_store:goods|edit']\"\n            >\n              编辑\n            </a>\n            <a\n              @click=\"onShelf(record)\"\n              v-if=\"record.auth['shop:cloud_store:goods|up']\"\n            >\n              上架\n            </a>\n\n            <a\n              @click=\"onShelf(record)\"\n              v-if=\"record.auth['shop:cloud_store:goods|down']\"\n            >\n              下架\n            </a>\n            <a\n              v-if=\"record.auth['shop:cloud_store:goods|del']\"\n              @click=\"onDel(record)\"\n            >\n              删除\n            </a>\n          </st-table-actions>\n        </template>\n      </st-table>\n    </div>\n  </st-panel>\n</template>\n\n<script>\nimport tableMixin from '@/mixins/table.mixin'\nimport { columns } from './list.config'\nimport { ListService } from './list.service'\nimport { UserService } from '@/services/user.service'\n\nexport default {\n  mixins: [tableMixin],\n  name: 'PageShopStoreList',\n  bem: {\n    basic: 'page-shop-store-list'\n  },\n  serviceInject() {\n    return {\n      listService: ListService\n    }\n  },\n  rxState() {\n    return {\n      list: this.listService.list$,\n      page: this.listService.page$,\n      loading: this.listService.loading$,\n      goodsList: this.listService.goodsList$,\n      cloudStore: this.listService.shelvesStatus$,\n      auth: this.listService.auth$\n    }\n  },\n  data(vm) {\n    return {\n      goodsName: '', // 商品名称\n      shelvesStatus: -1, // 上架状态\n      categoryId: -1, // 商品分类\n      columns: columns(vm)\n    }\n  },\n  computed: {\n    goods_sort() {\n      let list = []\n      this.goodsList.forEach(item => {\n        list.push({ value: +item.category_id, label: item.category_name })\n      })\n      return [{ value: -1, label: '所有商品分类' }, ...list]\n    }\n  },\n  mounted() {\n    this.setSearchData()\n    console.log(this.auth)\n  },\n  watch: {\n    query(newVal) {\n      this.setSearchData()\n    }\n  },\n  methods: {\n    // 设置状态&名称\n    setSearchData() {\n      let { product_name, shelves_status, category_id } = this.$searchQuery\n      this.goodsName = product_name\n      this.categoryId = category_id || -1\n      this.shelvesStatus = shelves_status || -1\n    },\n    // 新建商品\n    onAddGoods() {\n      this.$router.push({\n        path: './add'\n      })\n    },\n    // 上下架\n    onShelf(record) {\n      let status = record.product_shelves === 1 ? 2 : 1\n      this.$confirm({\n        title: '提示',\n        content: `确定${status === 1 ? '上架' : '下架'}该商品吗？`,\n        onOk: () => {\n          this.listService\n            .onShelf(record.product_id, { shelves_status: status })\n            .subscribe(res => {\n              this.$router.reload()\n            })\n        },\n        onCancel() {}\n      })\n    },\n    onDel(record) {\n      console.log(record)\n      this.$confirm({\n        title: '提示',\n        content: `一旦删除则无法恢复，确定删除${record.product_name}？`,\n        onOk: () => {\n          this.listService.delproduct(record.product_id).subscribe(res => {\n            this.$router.reload()\n          })\n        },\n        onCancel() {}\n      })\n    },\n    onEdit(record) {\n      this.$router.push({\n        path: './edit',\n        query: { id: record.product_id }\n      })\n    }\n  }\n}\n</script>\n"]}]}