{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-3!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/dashboard/club.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/dashboard/club.service.ts","mtime":1591147717381},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { Injectable } from 'vue-service-app';\nimport { State } from 'rx-state/src';\nimport { tap } from 'rxjs/operators';\nimport { OverviewApi } from '@/api/v1/stat/overview/shop';\nimport { anyAll } from '@/operators';\nimport { UserService } from '@/services/user.service';\n\nvar ClubService = /*#__PURE__*/function () {\n  function ClubService(overviewApi, userService) {\n    _classCallCheck(this, ClubService);\n\n    this.overviewApi = overviewApi;\n    this.userService = userService;\n    this.top$ = new State({\n      revenue_amount: {\n        today: '0.0/0.0',\n        yesterday: '0.0/0.0',\n        nearly_seven_days: '0.0/0.0',\n        nearly_thirty_days: '0.0/0.0'\n      },\n      course_checkin_num: {},\n      passenger_flow: {},\n      be_member_num: {}\n    });\n    this.revenueDaily$ = new State([]);\n    this.revenueSummary$ = new State([]);\n    this.revenueSum$ = new State('');\n    this.courseDaily$ = new State([]);\n    this.courseSummary$ = new State([]);\n    this.inoutNum$ = new State([]);\n    this.inoutTime$ = new State([]);\n    this.member$ = new State({\n      member: [],\n      marketing: []\n    });\n    this.newMember$ = new State([]);\n  }\n\n  _createClass(ClubService, [{\n    key: \"getTop\",\n    value: function getTop(query) {\n      var _this = this;\n\n      return this.overviewApi.getTop(query).pipe(tap(function (res) {\n        _this.top$.commit(function () {\n          return res.info;\n        });\n      }));\n    }\n  }, {\n    key: \"getRevenue\",\n    value: function getRevenue(params) {\n      var _this2 = this;\n\n      return this.overviewApi.getRevenue(params).pipe(tap(function (res) {\n        var data = res.info;\n        var lineData = [];\n\n        var member_card = _this2.userService.c('member_card');\n\n        var small_course = _this2.userService.c('small_course');\n\n        _this2.revenueSummary$.commit(function () {\n          return [{\n            name: member_card,\n            value: data.summary.member_card_amount\n          }, {\n            name: '私教课',\n            value: data.summary.personal_course_amount\n          }, {\n            name: '团体课',\n            value: data.summary.team_course_amount\n          }, {\n            name: '课程包',\n            value: data.summary.package_course_amount\n          }, {\n            name: small_course,\n            value: data.summary.small_course_amount\n          }, {\n            name: '云店',\n            value: data.summary.shop_amount\n          }, {\n            name: '其他',\n            value: data.summary.other_amount\n          }];\n        });\n\n        _this2.revenueSum$.commit(function () {\n          return data.summary.total_amount;\n        });\n\n        for (var key in data.daily.member_card_amount) {\n          var chartItem = {\n            date: key,\n            // 会员卡: Number(data.daily.member_card_amount[key]),\n            私教课: Number(data.daily.personal_course_amount[key]),\n            团体课: Number(data.daily.team_course_amount[key]),\n            课程包: Number(data.daily.package_course_amount[key]),\n            云店: Number(data.daily.shop_amount[key]),\n            其他: Number(data.daily.other_amount[key]),\n            总营收: Number(data.daily.total_amount[key])\n          };\n          chartItem[member_card] = Number(data.daily.member_card_amount[key]);\n          chartItem[small_course] = Number(data.daily.small_course_amount[key]);\n          lineData.push(chartItem);\n        }\n\n        console.log('营收趋势', lineData);\n\n        _this2.revenueDaily$.commit(function () {\n          return lineData;\n        });\n      }));\n    }\n  }, {\n    key: \"getCourse\",\n    value: function getCourse(params) {\n      var _this3 = this;\n\n      var small_course = this.userService.c('small_course');\n      return this.overviewApi.getCourse(params).pipe(tap(function (res) {\n        var data = res.info;\n        var lineData = [];\n        var courseSummary = [{\n          group: '未消课',\n          团体课: data.summary.team_uncheckin_num,\n          私教课: data.summary.personal_uncheckin_num\n        }, {\n          group: '总消课',\n          团体课: data.summary.team_checkin_num,\n          私教课: data.summary.personal_checkin_num\n        }, {\n          group: '总售课',\n          团体课: data.summary.sale_team_num,\n          私教课: data.summary.sale_personal_num\n        }];\n        courseSummary = courseSummary.map(function (item) {\n          item[small_course] = data.summary.sale_personal_num;\n          return item;\n        });\n\n        _this3.courseSummary$.commit(function () {\n          return courseSummary;\n        });\n\n        for (var key in data.daily.personal_reserved_num) {\n          var chartItem = {\n            date: key,\n            私教课预约人数: data.daily.personal_reserved_num[key],\n            私教课签到人数: data.daily.personal_checkin_num[key],\n            团体课可预约人数: data.daily.team_can_reserve_num[key],\n            团体课预约人数: data.daily.team_reserved_num[key],\n            团体课签到人数: data.daily.team_sigin_num[key]\n          };\n          chartItem[\"\".concat(small_course, \"\\u9884\\u7EA6\\u4EBA\\u6570\")] = data.daily.small_reserved_num[key];\n          chartItem[\"\".concat(small_course, \"\\u7B7E\\u5230\\u4EBA\\u6570\")] = data.daily.small_sigin_num[key];\n          lineData.push(chartItem);\n        }\n\n        console.log('上课分析', lineData);\n\n        _this3.courseDaily$.commit(function () {\n          return lineData;\n        });\n      }));\n    }\n  }, {\n    key: \"getInout\",\n    value: function getInout(params) {\n      var _this4 = this;\n\n      return this.overviewApi.getInout(params).pipe(tap(function (res) {\n        var data = res;\n        var lineData = [];\n\n        for (var key in data.inout_num) {\n          var chartItem = {\n            date: key,\n            value: data.inout_num[key]\n          };\n          lineData.push(chartItem);\n        }\n\n        console.log('入场', lineData);\n\n        _this4.inoutNum$.commit(function () {\n          return lineData;\n        });\n\n        _this4.inoutTime$.commit(function () {\n          return [{\n            name: '08:00之前',\n            value: data.inout_time.level0_num\n          }, {\n            name: '08:00~12:00',\n            value: data.inout_time.level1_num\n          }, {\n            name: '12:00~16:00',\n            value: data.inout_time.level2_num\n          }, {\n            name: '16:00~20:00',\n            value: data.inout_time.level3_num\n          }, {\n            name: '20:00~24:00',\n            value: data.inout_time.level4_num\n          }];\n        });\n      }));\n    }\n  }, {\n    key: \"getMember\",\n    value: function getMember(query) {\n      var _this5 = this;\n\n      return this.overviewApi.getMember(query).pipe(tap(function (res) {\n        var data = res.info;\n\n        _this5.member$.commit(function () {\n          return {\n            member: [{\n              name: '消费人数',\n              value: data.member.consume_num\n            }, {\n              name: '办理入会人数',\n              value: data.member.member_num\n            }, {\n              name: '购买私教人数',\n              value: data.member.buy_person_course_num\n            }],\n            marketing: [{\n              name: '消费人数',\n              value: data.marketing.consume_num\n            }, {\n              name: '办理入会人数',\n              value: data.marketing.member_num\n            }, {\n              name: '购买私教人数',\n              value: data.marketing.buy_person_course_num\n            }]\n          };\n        });\n      }));\n    }\n  }, {\n    key: \"getNewMember\",\n    value: function getNewMember(params) {\n      var _this6 = this;\n\n      return this.overviewApi.getNewMember(params).pipe(tap(function (res) {\n        var data = res.info.new_member_num;\n        var lineData = [];\n\n        for (var key in data) {\n          var chartItem = {\n            date: key,\n            value: data[key]\n          };\n          lineData.push(chartItem);\n        }\n\n        console.log('newMember', lineData);\n\n        _this6.newMember$.commit(function () {\n          return lineData;\n        });\n      }));\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      return anyAll(this.getTop({\n        version: 'club'\n      }), this.getRevenue({\n        recently_day: 7\n      }), this.getCourse({\n        recently_day: 7\n      }), this.getInout({\n        recently_day: 7\n      }), this.getMember({\n        version: 'club'\n      }), this.getNewMember({\n        recently_day: 7\n      }));\n    }\n  }, {\n    key: \"beforeCreate\",\n    value: function beforeCreate() {\n      return this.init();\n    }\n  }]);\n\n  return ClubService;\n}();\n\nClubService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof OverviewApi !== \"undefined\" && OverviewApi) === \"function\" ? _a : Object, typeof (_b = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _b : Object])], ClubService);\nexport { ClubService };",null]}