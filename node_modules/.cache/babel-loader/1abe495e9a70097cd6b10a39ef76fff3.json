{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/team/add-course-batch.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/team/add-course-batch.vue","mtime":1600926555906},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { cloneDeep } from 'lodash-es';\nimport { TeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/team/service#/common.service';\nimport { TeamScheduleScheduleService } from '@/views/pages/shop/product/course/schedule/team/service#/schedule.service';\nimport { MessageService } from '@/services/message.service';\nimport { columns } from \"./add-course-batch.config\";\nexport default {\n  name: 'AddCourseScheduleBatch',\n  bem: {\n    b: 'modal-schedule-team-add-course-batch'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      teamScheduleCommonService: TeamScheduleCommonService,\n      teamScheduleScheduleService: TeamScheduleScheduleService,\n      msg: MessageService\n    };\n  },\n  rxState: function rxState() {\n    var tss = this.teamScheduleCommonService;\n    return {\n      coachOptions: tss.coachOptions$,\n      courseOptions: tss.courseOptions$,\n      courtOptions: tss.courtOptions$\n    };\n  },\n  data: function data() {\n    var data = [];\n\n    for (var i = 0; i < 100; i++) {\n      if (i === 0) {\n        data.push({\n          key: 0,\n          editable: true,\n          start_time: moment(),\n          course_id: '',\n          coach_id: '',\n          limit_num: 0,\n          court_site_id: []\n        });\n      }\n    }\n\n    this.cacheData = data.map(function (item) {\n      return _objectSpread({}, item);\n    });\n    return {\n      data: data,\n      obj: {\n        key: 0,\n        editable: true,\n        start_time: '',\n        course_id: '',\n        coach_id: '',\n        court_site_id: '',\n        show: {}\n      },\n      show: false\n    };\n  },\n  filters: {\n    formatDate: function formatDate(val) {\n      return val ? moment(val) : undefined;\n    }\n  },\n  computed: {\n    columns: columns\n  },\n  methods: {\n    validateForm: function validateForm(form) {\n      if (!form.start_time) {\n        this.msg.error({\n          content: '排期开始时间不能为空'\n        });\n        return false;\n      }\n\n      if (!form.course_id) {\n        this.msg.error({\n          content: '请选择课程'\n        });\n        return false;\n      }\n\n      if (!form.coach_id) {\n        this.msg.error({\n          content: \"\\u8BF7\\u9009\\u62E9\\u8BFE\\u7A0B\".concat(this.$c('coach'))\n        });\n        return false;\n      }\n\n      if (!form.limit_num) {\n        this.msg.error({\n          content: '请输入上课人数'\n        });\n        return false;\n      }\n\n      if (!form.course_fee) {\n        this.msg.error({\n          content: '请输入课时费'\n        });\n        return false;\n      }\n\n      return true;\n    },\n    onOkSaveForm: function onOkSaveForm() {\n      var _this = this;\n\n      var data = cloneDeep(this.data);\n      data = data.filter(function (item, index) {\n        return index !== 0;\n      }).map(function (item) {\n        delete item.show;\n        delete item.key;\n        delete item.editable;\n        item.start_time = moment(item.start_time).format('YYYY-MM-DD HH:mm');\n        item.court_id = item.court_site_id[0];\n        item.court_site_id = item.court_site_id[1];\n        item.limit_num = +item.limit_num;\n        item.course_fee = +item.course_fee;\n        return item;\n      });\n      this.teamScheduleScheduleService.addScheduleInBatch(data).subscribe(function (res) {\n        _this.show = false;\n\n        _this.$emit('ok');\n      });\n    },\n    handleChange: function handleChange(value, key, column) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (target) {\n        target[column] = value;\n        this.data = newData;\n      }\n    },\n    edit: function edit(key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (target) {\n        target.editable = true;\n        this.data = newData;\n      }\n    },\n    deleteData: function deleteData(key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (target) {\n        target.editable = true;\n        this.data = newData.filter(function (item) {\n          return item.key !== key;\n        });\n      }\n    },\n    getShowTableData: function getShowTableData(data) {\n      data.key = Math.random();\n      data.show = {};\n      data.show.start_time_show = moment(data.start_time).format('YYYY-MM-DD HH:mm');\n      data.show.course_id_show = this.getOptionName(data.course_id, this.courseOptions, 'course_name');\n      data.show.coach_id_show = this.getOptionName(data.coach_id, this.coachOptions, 'staff_name');\n      data.show.court_site_id_show = this.getCourtSiteName(data.court_site_id, this.courtOptions);\n      return data;\n    },\n    getOptionName: function getOptionName(id, options, name) {\n      var option = '';\n      options.forEach(function (ele) {\n        if (ele.id === id) {\n          option = ele[name];\n        }\n      });\n      return option;\n    },\n    getCourtSiteName: function getCourtSiteName(ids, options) {\n      var id = ids[0];\n      var childrenId = ids[1];\n      var name = '';\n      options.forEach(function (item) {\n        if (item.id === id) {\n          name = item.name;\n\n          if (item.children && item.children.length && childrenId) {\n            item.children.forEach(function (ele) {\n              if (ele.id === childrenId) {\n                name = \"\".concat(name, \" - \").concat(ele.name);\n              }\n            });\n          }\n        }\n      });\n      return name;\n    },\n    save: function save(key) {\n      var _this2 = this;\n\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (!this.validateForm(target)) {\n        return '';\n      }\n\n      if (key === 0 && target) {\n        delete target.editable;\n        delete newData[0].editable;\n        newData[0] = this.getShowTableData(newData[0]);\n        newData.unshift({\n          key: 0,\n          editable: true,\n          start_time: moment(),\n          course_id: '',\n          coach_id: '',\n          limit_num: 0,\n          court_site_id: [],\n          show: {}\n        });\n        this.data = newData;\n        this.cacheData = newData.map(function (item) {\n          return _objectSpread({}, item);\n        });\n        return;\n      }\n\n      if (target) {\n        delete target.editable;\n        newData.forEach(function (item) {\n          if (item.key === key && key !== 0) {\n            item = _this2.getShowTableData(item);\n          }\n        });\n        this.data = newData;\n        this.cacheData = newData.map(function (item) {\n          return _objectSpread({}, item);\n        });\n      }\n    },\n    cancel: function cancel(key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (target) {\n        Object.assign(target, this.cacheData.filter(function (item) {\n          return key === item.key;\n        })[0]);\n        delete target.editable;\n        this.data = newData;\n      }\n    }\n  }\n};",{"version":3,"sources":["add-course-batch.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal\n    wrapClassName=\"modal-schedule-team-add-course-batch\"\n    title=\"批量新增课程排期\"\n    @ok=\"onOkSaveForm\"\n    width=\"1150px\"\n    v-model=\"show\"\n  >\n    <st-table :columns=\"columns\" :page=\"false\" :dataSource=\"data\" bordered>\n      <span slot=\"startTimeTitle\" class=\"modal-table-title\">\n        <i class=\"color-danger mg-r8\">*</i>\n        日期\n      </span>\n      <span slot=\"courseIdTitle\" class=\"modal-table-title\">\n        <i class=\"color-danger mg-r8\">*</i>\n        课程\n      </span>\n      <span slot=\"coachIdTitle\" class=\"modal-table-title\">\n        <i class=\"color-danger mg-r8\">*</i>\n        上课{{ $c('coach') }}\n      </span>\n      <span slot=\"limitNumTitle\" class=\"modal-table-title\">\n        <i class=\"color-danger mg-r8\">*</i>\n        人数\n      </span>\n      <span slot=\"courseFeeTitle\" class=\"modal-table-title\">\n        <i class=\"color-danger mg-r8\">*</i>\n        单节预约价格\n      </span>\n      <template slot=\"start_time\" slot-scope=\"text, record\">\n        <a-date-picker\n          v-if=\"record.editable\"\n          :showTime=\"{ format: 'HH:mm' }\"\n          format=\"YYYY-MM-DD HH:mm\"\n          placeholder=\"请选择时间\"\n          :value=\"text | formatDate\"\n          @change=\"e => handleChange(e, record.key, 'start_time')\"\n        />\n        <template v-else>\n          {{ record.show.start_time_show }}\n        </template>\n      </template>\n\n      <template slot=\"course_id\" slot-scope=\"text, record\">\n        <a-select\n          v-if=\"record.editable\"\n          placeholder=\"请选择课程\"\n          style=\"width: 180px\"\n          :value=\"text\"\n          @change=\"e => handleChange(e, record.key, 'course_id')\"\n        >\n          <a-select-option v-for=\"course in courseOptions\" :key=\"course.id\">\n            {{ course.course_name }}\n          </a-select-option>\n        </a-select>\n        <template v-else>\n          {{ record.show.course_id_show }}\n        </template>\n      </template>\n\n      <template slot=\"coach_id\" slot-scope=\"text, record\">\n        <a-select\n          v-if=\"record.editable\"\n          :placeholder=\"`请选择${$c('coach')}`\"\n          :value=\"text\"\n          style=\"width: 120px\"\n          @change=\"e => handleChange(e, record.key, 'coach_id')\"\n        >\n          <a-select-option v-for=\"coach in coachOptions\" :key=\"coach.id\">\n            {{ coach.staff_name }}\n          </a-select-option>\n        </a-select>\n        <template v-else>\n          {{ record.show.coach_id_show }}\n        </template>\n      </template>\n\n      <template slot=\"court_site_id\" slot-scope=\"text, record\">\n        <a-cascader\n          v-if=\"record.editable\"\n          placeholder=\"请选择场地\"\n          :value=\"text\"\n          :options=\"courtOptions\"\n          @change=\"e => handleChange(e, record.key, 'court_site_id')\"\n          :fieldNames=\"{ label: 'name', value: 'id', children: 'children' }\"\n        />\n        <template v-else>\n          {{ record.show.court_site_id_show }}\n        </template>\n      </template>\n\n      <template slot=\"limit_num\" slot-scope=\"text, record\">\n        <div>\n          <a-input\n            v-if=\"record.editable\"\n            style=\"margin: -5px 0;width:80px;\"\n            :value=\"text\"\n            @change=\"e => handleChange(e.target.value, record.key, 'limit_num')\"\n          >\n            <span slot=\"suffix\">人</span>\n          </a-input>\n          <template v-else>{{ text }}人</template>\n        </div>\n      </template>\n      <template slot=\"course_fee\" slot-scope=\"text, record\">\n        <div>\n          <a-input\n            v-if=\"record.editable\"\n            style=\"margin: -5px 0;width:110px;\"\n            :value=\"text\"\n            @change=\"\n              e => handleChange(e.target.value, record.key, 'course_fee')\n            \"\n            maxlength=\"6\"\n          >\n            <span slot=\"suffix\">元/节</span>\n          </a-input>\n          <template v-else>{{ text }}元/节</template>\n        </div>\n      </template>\n      <template slot=\"operation\" slot-scope=\"text, record\">\n        <div class=\"editable-row-operations\">\n          <span v-if=\"record.editable\">\n            <a @click=\"() => save(record.key)\">保存</a>\n          </span>\n          <span v-else>\n            <a @click=\"() => edit(record.key)\">编辑</a>\n            <a @click=\"() => deleteData(record.key)\">删除</a>\n          </span>\n        </div>\n      </template>\n    </st-table>\n  </st-modal>\n</template>\n<script>\nimport { cloneDeep } from 'lodash-es'\nimport { TeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/team/service#/common.service'\nimport { TeamScheduleScheduleService } from '@/views/pages/shop/product/course/schedule/team/service#/schedule.service'\nimport { MessageService } from '@/services/message.service'\nimport { columns } from './add-course-batch.config'\nexport default {\n  name: 'AddCourseScheduleBatch',\n  bem: {\n    b: 'modal-schedule-team-add-course-batch'\n  },\n  serviceInject() {\n    return {\n      teamScheduleCommonService: TeamScheduleCommonService,\n      teamScheduleScheduleService: TeamScheduleScheduleService,\n      msg: MessageService\n    }\n  },\n  rxState() {\n    const tss = this.teamScheduleCommonService\n    return {\n      coachOptions: tss.coachOptions$,\n      courseOptions: tss.courseOptions$,\n      courtOptions: tss.courtOptions$\n    }\n  },\n  data() {\n    const data = []\n    for (let i = 0; i < 100; i++) {\n      if (i === 0) {\n        data.push({\n          key: 0,\n          editable: true,\n          start_time: moment(),\n          course_id: '',\n          coach_id: '',\n          limit_num: 0,\n          court_site_id: []\n        })\n      }\n    }\n    this.cacheData = data.map(item => ({ ...item }))\n    return {\n      data,\n      obj: {\n        key: 0,\n        editable: true,\n        start_time: '',\n        course_id: '',\n        coach_id: '',\n        court_site_id: '',\n        show: {}\n      },\n      show: false\n    }\n  },\n  filters: {\n    formatDate(val) {\n      return val ? moment(val) : undefined\n    }\n  },\n  computed: {\n    columns\n  },\n  methods: {\n    validateForm(form) {\n      if (!form.start_time) {\n        this.msg.error({ content: '排期开始时间不能为空' })\n        return false\n      }\n      if (!form.course_id) {\n        this.msg.error({ content: '请选择课程' })\n        return false\n      }\n      if (!form.coach_id) {\n        this.msg.error({ content: `请选择课程${this.$c('coach')}` })\n        return false\n      }\n      if (!form.limit_num) {\n        this.msg.error({ content: '请输入上课人数' })\n        return false\n      }\n      if (!form.course_fee) {\n        this.msg.error({ content: '请输入课时费' })\n        return false\n      }\n      return true\n    },\n    onOkSaveForm() {\n      let data = cloneDeep(this.data)\n      data = data\n        .filter((item, index) => {\n          return index !== 0\n        })\n        .map(item => {\n          delete item.show\n          delete item.key\n          delete item.editable\n          item.start_time = moment(item.start_time).format('YYYY-MM-DD HH:mm')\n          item.court_id = item.court_site_id[0]\n          item.court_site_id = item.court_site_id[1]\n          item.limit_num = +item.limit_num\n          item.course_fee = +item.course_fee\n          return item\n        })\n      this.teamScheduleScheduleService\n        .addScheduleInBatch(data)\n        .subscribe(res => {\n          this.show = false\n          this.$emit('ok')\n        })\n    },\n    handleChange(value, key, column) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        target[column] = value\n        this.data = newData\n      }\n    },\n    edit(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        target.editable = true\n        this.data = newData\n      }\n    },\n    deleteData(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        target.editable = true\n        this.data = newData.filter(item => {\n          return item.key !== key\n        })\n      }\n    },\n    getShowTableData(data) {\n      data.key = Math.random()\n      data.show = {}\n      data.show.start_time_show = moment(data.start_time).format(\n        'YYYY-MM-DD HH:mm'\n      )\n      data.show.course_id_show = this.getOptionName(\n        data.course_id,\n        this.courseOptions,\n        'course_name'\n      )\n      data.show.coach_id_show = this.getOptionName(\n        data.coach_id,\n        this.coachOptions,\n        'staff_name'\n      )\n      data.show.court_site_id_show = this.getCourtSiteName(\n        data.court_site_id,\n        this.courtOptions\n      )\n      return data\n    },\n    getOptionName(id, options, name) {\n      let option = ''\n      options.forEach(ele => {\n        if (ele.id === id) {\n          option = ele[name]\n        }\n      })\n      return option\n    },\n    getCourtSiteName(ids, options) {\n      const id = ids[0]\n      const childrenId = ids[1]\n      let name = ''\n      options.forEach(item => {\n        if (item.id === id) {\n          name = item.name\n          if (item.children && item.children.length && childrenId) {\n            item.children.forEach(ele => {\n              if (ele.id === childrenId) {\n                name = `${name} - ${ele.name}`\n              }\n            })\n          }\n        }\n      })\n      return name\n    },\n    save(key) {\n      let newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (!this.validateForm(target)) {\n        return ''\n      }\n      if (key === 0 && target) {\n        delete target.editable\n        delete newData[0].editable\n        newData[0] = this.getShowTableData(newData[0])\n        newData.unshift({\n          key: 0,\n          editable: true,\n          start_time: moment(),\n          course_id: '',\n          coach_id: '',\n          limit_num: 0,\n          court_site_id: [],\n          show: {}\n        })\n        this.data = newData\n        this.cacheData = newData.map(item => ({ ...item }))\n        return\n      }\n      if (target) {\n        delete target.editable\n        newData.forEach(item => {\n          if (item.key === key && key !== 0) {\n            item = this.getShowTableData(item)\n          }\n        })\n        this.data = newData\n        this.cacheData = newData.map(item => ({ ...item }))\n      }\n    },\n    cancel(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        Object.assign(\n          target,\n          this.cacheData.filter(item => key === item.key)[0]\n        )\n        delete target.editable\n        this.data = newData\n      }\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/schedule/team"}]}