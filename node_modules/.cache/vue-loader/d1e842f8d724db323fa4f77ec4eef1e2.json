{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/course/manage/package/edit-range-package.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/course/manage/package/edit-range-package.vue","mtime":1597396799991},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport moment from 'moment'\nimport ReserveIsLimit from './components#/reserveIsLimit'\nimport { cloneDeep, remove, every, filter, reduce, forEach } from 'lodash-es'\nimport { EditRangePackageService } from './edit-range-package.service'\nimport CourseSelectCourse from '@/views/biz-modals/course/select-course'\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue'\nexport default {\n  name: 'ShopRangePackageEdit',\n  serviceInject() {\n    return {\n      editPackageService: EditRangePackageService\n    }\n  },\n  rxState() {\n    return {\n      transferUnitList: this.editPackageService.transferUnitList$,\n      sellTypeList: this.editPackageService.sellTypeList$,\n      unitList: this.editPackageService.unitList$,\n      editLoading: this.editPackageService.loading$,\n      coachList: this.editPackageService.coachList$,\n      packageInfo: this.editPackageService.packageInfo$,\n      limitType: this.editPackageService.limitType$\n    }\n  },\n  components: {\n    StImageUpload,\n    ReserveIsLimit\n  },\n  modals: {\n    CourseSelectCourse\n  },\n  bem: {\n    add: 'page-shop-add-range-package',\n    basic: 'page-shop-add-basic-package'\n  },\n  data() {\n    return {\n      packageData: {\n        // 售价\n        price: undefined,\n        // 总节数 0为不限次 1为限次\n        is_limit: 0,\n        // 是否支持团体课 0为不支持 1为支持\n        is_team: 0,\n        // 团体课总节数\n        team_times: undefined,\n        // 团体课单价\n        team_unit_price: undefined,\n        // 团体课上课范围课程id\n        team_range: [],\n        // 是否支持私教课 0为不支持 1为支持\n        is_personal: 0,\n        // 私教课总节数\n        personal_times: undefined,\n        // 私教课单价\n        personal_unit_price: undefined,\n        // 私教课上课范围课程id course_id私教课课程id coach_level私教课支持预约的教练等级\n        personal_range: [],\n        // 售卖开始时间\n        start_time: '',\n        // 售卖截止时间\n        end_time: '',\n        // 有效时间值\n        valid_time: undefined,\n        // 有效时间单位 1:天 2:月 3:年\n        valid_time_unit: 1,\n        // 允许冻结天数\n        frozen_days: undefined,\n        // 售卖方式\n        sale_mode: [2],\n        // 是否可以转让: 0 不可以 1 可以\n        is_allow_transfer: 0,\n        // 转让费率\n        transfer_rate: undefined,\n        // 转让单位 1:百分比 2:元\n        transfer_unit: 1,\n        // 封面对象\n        image: {\n          image_id: null,\n          image_key: ''\n        },\n        // 课程包介绍\n        intro: '',\n        // 备注\n        remarks: ''\n      },\n      // 课程范围是否未输入过\n      courseIsFirstInput: true,\n      // team course\n      teamCourseList: [],\n      teamCourseListIsShow: false,\n      teamIndeterminate: false,\n      teamCheckAll: false,\n      // personal course\n      personalCourseList: [],\n      personalCoachTotalList: {},\n      personalCoachListHistory: [],\n      personalAllOperationCoachList: [],\n      personalAllOperationCoachTotal: 0,\n      personalCourseListIsShow: false,\n      personalIndeterminate: false,\n      personalCheckAll: false,\n      coachAllOperationDropdownIsShow: false,\n      // 课程范围是否未配置\n      courseIsNone: false,\n      courseErrorText: '',\n      form: this.$form.createForm(this),\n      start_time: null,\n      end_time: null,\n      reserveIsLimitInfo: {},\n      endOpen: false,\n      // 是否配置了用户端\n      appConfig: true,\n      // 是否未传了封面\n      imageIsNone: false,\n      imageErrorText: '',\n      fileList: [],\n      cropperModal: {}\n    }\n  },\n  mounted() {\n    this.init()\n  },\n  methods: {\n    limitChange(e) {\n      console.log(e)\n      let value = e.target.value\n      this.packageData.is_limit = +value\n      if (value) {\n        this.packageData.team_times = undefined\n        this.packageData.personal_times = undefined\n        this.form.setFieldsValue({\n          team_times: undefined,\n          personal_times: undefined\n        })\n      } else {\n        this.packageData.team_times = 1\n        this.packageData.personal_times = 1\n        this.form.setFieldsValue({\n          team_times: 1,\n          personal_times: 1\n        })\n      }\n    },\n    init() {\n      if (!this.packageInfo.is_team) {\n        this.packageInfo.team_times = undefined\n        this.packageInfo.team_unit_price = undefined\n        this.packageInfo.team_range = []\n      }\n      if (!this.packageInfo.is_personal) {\n        this.packageInfo.personal_times = undefined\n        this.packageInfo.personal_unit_price = undefined\n        this.packageInfo.personal_range = []\n      }\n      // 初始化约课限制对象 5.22 start\n      const {\n        reserve_is_limit,\n        reserve_limit_day,\n        reserve_limit_times\n      } = this.packageInfo\n      this.reserveIsLimitInfo = {\n        reserve_is_limit,\n        reserve_limit_day,\n        reserve_limit_times\n      }\n      // 初始化约课限制对象 5.22 end\n      if (!this.packageInfo.is_allow_transfer) {\n        this.packageInfo.transfer_rate = undefined\n      }\n      this.form.setFieldsValue({\n        support_num: this.packageInfo.support_num,\n        is_limit: this.packageInfo.is_limit,\n        price: this.packageInfo.price,\n        start_time: moment(this.packageInfo.start_time),\n        end_time: moment(this.packageInfo.end_time),\n        valid_time: this.packageInfo.valid_time,\n        frozen_days: this.packageInfo.frozen_days,\n        transfer_rate: this.packageInfo.transfer_rate\n      })\n      // 课程范围\n      this.packageData.is_limit = this.packageInfo.is_limit\n      this.packageData.is_team = this.packageInfo.is_team\n      this.packageData.team_times = this.packageInfo.team_times\n      this.packageData.team_unit_price = this.packageInfo.team_unit_price\n      forEach(this.packageInfo.team_range, o => {\n        this.teamCourseList.push({\n          courseChecked: false,\n          course_category: o.course_category,\n          course_id: o.course_id,\n          course_name: o.course_name,\n          course_type: o.course_type\n        })\n      })\n      this.packageData.is_personal = this.packageInfo.is_personal\n      this.packageData.personal_times = this.packageInfo.personal_times\n      this.packageData.personal_unit_price = this.packageInfo.personal_unit_price\n      forEach(this.packageInfo.personal_range, o => {\n        let coachGradeList = []\n        o.coach_level.forEach(i => {\n          coachGradeList.push(i.id)\n        })\n        let selectCoach = filter(this.coachList, i =>\n          coachGradeList.includes(i.id)\n        )\n        let total = reduce(selectCoach, (sum, i) => sum + i.coach_number, 0)\n        this.personalCourseList.push({\n          courseChecked: false,\n          course_category: o.course_category,\n          course_id: o.course_id,\n          course_name: o.course_name,\n          course_type: o.course_type,\n          coachGradeList,\n          coach: total\n        })\n        this.personalCoachTotalList[o.course_id] =\n          this.personalCoachTotalList[o.course_id] || {}\n        this.personalCoachTotalList[o.course_id].list = cloneDeep(o.coach_level)\n        this.personalCoachTotalList[o.course_id].total = total\n        this.personalCoachListHistory.push(\n          cloneDeep(o.coach_level.map(item => item.id))\n        )\n      })\n      // 售卖时间\n      this.start_time = this.packageInfo.start_time\n      this.end_time = this.packageInfo.end_time\n      // 有效时间单位\n      this.packageData.valid_time_unit = this.packageInfo.valid_time_unit\n      // 转让设置\n      this.packageData.is_allow_transfer = this.packageInfo.is_allow_transfer\n      this.packageData.transfer_unit = this.packageInfo.transfer_unit\n      // 售卖方式\n      this.packageData.sale_mode = this.packageInfo.sale_mode\n      // 封面\n      this.fileList = [this.packageInfo.image]\n      this.packageData.image.image_id = this.fileList[0].image_id\n      this.packageData.image.image_key = this.fileList[0].image_key\n      this.imageIsNone = false\n      this.imageErrorText = ''\n      // 介绍\n      this.packageData.intro = this.packageInfo.intro\n      // 备注\n      this.packageData.remarks = this.packageInfo.remarks\n    },\n    // 保存\n    save() {\n      this.course_validator()\n      this.image_validator()\n      this.form.validateFieldsAndScroll((err, values) => {\n        if (!err && !this.courseIsNone && !this.imageIsNone) {\n          this.packageData.price = values.price\n          this.packageData.valid_time = values.valid_time\n          this.packageData.frozen_days = values.frozen_days\n          this.packageData.support_num = values.support_num\n          // 约课限制 5.22 start\n          this.packageData.reserve_is_limit = values.reserve_is_limit\n          this.packageData.reserve_limit_day = values.reserve_limit_day\n          this.packageData.reserve_limit_times = +values.reserve_limit_times\n          // 约课限制 5.22 end\n          this.packageData.transfer_rate = this.packageData.is_allow_transfer\n            ? +values.transfer_rate\n            : undefined\n          this.packageData.start_time =\n            typeof this.start_time === 'string'\n              ? this.start_time\n              : `${this.start_time.format('YYYY-MM-DD')}`\n          this.packageData.end_time =\n            typeof this.end_time === 'string'\n              ? this.end_time\n              : `${this.end_time.format('YYYY-MM-DD')}`\n          this.packageData.team_range = []\n          this.teamCourseList.forEach(i => {\n            this.packageData.team_range.push(i.course_id)\n          })\n          this.packageData.personal_range = []\n          this.personalCourseList.forEach(i => {\n            this.packageData.personal_range.push({\n              course_id: i.course_id,\n              coach_level: cloneDeep(i.coachGradeList)\n            })\n          })\n          if (this.packageData.is_team) {\n            this.packageData.team_unit_price = +this.packageData.team_unit_price\n          }\n          if (this.packageData.is_personal) {\n            this.packageData.personal_unit_price = +this.packageData\n              .personal_unit_price\n          }\n          this.packageData.album_id = this.packageInfo.album_id // 这个给后端快捷找到相册使用，前端不需要处理使用\n          this.editPackageService\n            .editPackage(this.packageData)\n            .subscribe(res => {\n              this.$router.push({\n                path: '/shop/product/course/manage/package/list'\n              })\n            })\n        }\n      })\n    },\n    // checkboxChange\n    teamCheckboxChange(e) {\n      this.packageData.is_team = +e.target.checked\n      this.courseIsFirstInput = false\n      this.teamCourseListIsShow = +e.target.checked\n    },\n    personalCheckboxChange(e) {\n      this.packageData.is_personal = +e.target.checked\n      this.courseIsFirstInput = false\n      this.personalCourseListIsShow = +e.target.checked\n    },\n    // team\n    teamCourseListShow() {\n      this.teamCourseListIsShow = !this.teamCourseListIsShow\n    },\n    // personal\n    personalCourseListShow() {\n      this.personalCourseListIsShow = !this.personalCourseListIsShow\n    },\n    // 新增课程\n    addCourse(type) {\n      let that = this\n      if (type === 'team') {\n        this.$modalRouter.push({\n          name: 'course-select-course',\n          props: {\n            type,\n            courses: this.teamCourseList\n          },\n          on: {\n            ok(data) {\n              data.list.forEach(i => {\n                i.courseChecked = false\n              })\n              that.teamCourseList = cloneDeep(data.list)\n            }\n          }\n        })\n      } else if (type === 'personal') {\n        this.$modalRouter.push({\n          name: 'course-select-course',\n          props: {\n            type,\n            courses: this.personalCourseList\n          },\n          on: {\n            ok(data) {\n              let coachGradeList = []\n              forEach(that.coachList, i => {\n                coachGradeList.push(i.id)\n              })\n              let total = reduce(\n                that.coachList,\n                (sum, o) => sum + o.coach_number,\n                0\n              )\n              data.list.forEach(i => {\n                i.courseChecked = false\n                i.coachGradeList = coachGradeList\n                i.coach = total\n              })\n              forEach(that.personalCoachTotalList, (value, key) => {\n                forEach(data.list, innerValue => {\n                  if (+innerValue.course_id === +key) {\n                    innerValue.coachGradeList = cloneDeep(value.list)\n                    innerValue.coach = cloneDeep(value.total)\n                  }\n                })\n                // 删除personalCoachTotalList里不存在的course_id项\n                if (!data.list.some(o => +o.course_id === +key)) {\n                  delete that.personalCoachTotalList[key]\n                }\n              })\n              that.personalCoachListHistory = []\n              // 缓存选择的教练等级\n              data.list.forEach(i => {\n                that.personalCoachListHistory.push(i.coachGradeList)\n              })\n              that.personalCourseList = cloneDeep(data.list)\n              that.personalCourseList.forEach(item => {\n                if (item.coachGradeList && item.coachGradeList.length > 0) {\n                  item.coachGradeList = item.coachGradeList.map(i => {\n                    return i.id || i\n                  })\n                }\n              })\n              console.log(that.personalCourseList)\n            }\n          }\n        })\n      }\n    },\n    // 移除课程\n    removeCourseItem(type, id) {\n      if (type === 'team') {\n        let arr = cloneDeep(this.teamCourseList)\n        remove(arr, o => o.course_id === id)\n        this.teamCourseList = arr\n      } else if (type === 'personal') {\n        let arr = cloneDeep(this.personalCourseList)\n        remove(arr, o => o.course_id === id)\n        this.personalCourseList = arr\n        // 移除备份选择的教练list\n        let coachList = cloneDeep(this.personalCoachTotalList)\n        delete coachList[id]\n        this.personalCoachTotalList = coachList\n      }\n    },\n    // 移除选择的课程\n    removeCourseItems(type) {\n      if (type === 'team') {\n        let arr = cloneDeep(this.teamCourseList)\n        remove(arr, o => o.courseChecked)\n        this.teamCourseList = arr\n      } else if (type === 'personal') {\n        let arr = cloneDeep(this.personalCourseList)\n        let removeList = remove(arr, o => o.courseChecked)\n        this.personalCourseList = arr\n        // 移除备份选择的教练list\n        let coachList = cloneDeep(this.personalCoachTotalList)\n        removeList.forEach(i => {\n          delete coachList[i.course_id]\n        })\n        this.personalCoachTotalList = coachList\n      }\n    },\n    // 选择课程\n    courseItemCheckedChange(e, type, index) {\n      if (type === 'team') {\n        this.teamCourseList[index].courseChecked = e.target.checked\n      } else if (type === 'personal') {\n        this.personalCourseList[index].courseChecked = e.target.checked\n      }\n    },\n    // 全选\n    checkAllChange(type) {\n      if (type === 'team') {\n        this.teamCourseList.forEach(i => {\n          i.courseChecked = !this.teamCheckAll\n        })\n      } else if (type === 'personal') {\n        this.personalCourseList.forEach(i => {\n          i.courseChecked = !this.personalCheckAll\n        })\n      }\n    },\n    // item coach checkboxGroup changeEvent\n    coachItemChange(e, id, index) {\n      if (!e.length) {\n        this.personalCourseList[\n          index\n        ].coachGradeList = this.personalCoachListHistory[index]\n        return\n      } else {\n        this.personalCoachListHistory[index] = cloneDeep(e)\n      }\n      this.personalCoachTotalList[id] = {}\n      this.personalCoachTotalList[id].list = cloneDeep(e)\n      let selectCoach = filter(this.coachList, o => e.includes(o.id))\n      let total = reduce(selectCoach, (sum, o) => sum + o.coach_number, 0)\n      this.personalCoachTotalList[id].total = total\n      // 设置教练总数\n      this.personalCourseList.forEach(i => {\n        if (i.course_id === id) {\n          i.coach = total\n        }\n      })\n    },\n    coachAllChange(e) {\n      let selectCoach = filter(this.coachList, o => e.includes(o.id))\n      this.personalAllOperationCoachTotal = reduce(\n        selectCoach,\n        (sum, o) => sum + o.coach_number,\n        0\n      )\n    },\n    coachAllOperationOk() {\n      // 批量设置\n      forEach(this.personalCourseList, value => {\n        if (value.courseChecked) {\n          value.coachGradeList = cloneDeep(this.personalAllOperationCoachList)\n          value.coach = this.personalAllOperationCoachTotal\n          this.personalCoachTotalList[value.course_id] = {}\n          this.personalCoachTotalList[value.course_id].list = cloneDeep(\n            this.personalAllOperationCoachList\n          )\n          this.personalCoachTotalList[\n            value.course_id\n          ].total = this.personalAllOperationCoachTotal\n        }\n      })\n      // 缓存选择的教练等级\n      this.personalCoachListHistory = []\n      forEach(this.personalCourseList, i => {\n        this.personalCoachListHistory.push(i.coachGradeList)\n      })\n      // 清空\n      this.personalAllOperationCoachList = []\n      this.personalAllOperationCoachTotal = 0\n      // 收起\n      this.coachAllOperationDropdownIsShow = false\n    },\n    // course validatorFn\n    course_validator() {\n      this.courseIsFirstInput = false\n      let teamIsOk = false\n      let personalIsOk = false\n      if (this.packageData.is_team) {\n        teamIsOk = this.team_total && this.teamCourseList.length\n      } else {\n        teamIsOk = true\n      }\n      if (this.packageData.is_personal) {\n        personalIsOk = this.personal_total && this.personalCourseList.length\n      } else {\n        personalIsOk = true\n      }\n\n      if (\n        teamIsOk &&\n        personalIsOk &&\n        !(!this.packageData.is_team && !this.packageData.is_personal)\n      ) {\n        // 校验通过\n        this.courseIsNone = false\n        this.courseErrorText = ''\n      } else {\n        // 校验未通过\n        this.courseIsNone = true\n        this.courseErrorText = '请输入上课范围'\n      }\n    },\n    // image validatorFn\n    image_validator() {\n      if (this.packageData.image.image_key !== '') {\n        // 校验通过\n        this.imageIsNone = false\n        this.imageErrorText = ''\n      } else {\n        // 校验未通过\n        this.imageIsNone = true\n        this.imageErrorText = '请上传封面'\n      }\n    },\n    // 转让\n    transfer(e) {\n      this.packageData.is_allow_transfer = +e.target.checked\n      // 重置转让费用的校验\n      this.packageData.transfer_rate = undefined\n      this.form.resetFields(['transfer_rate'])\n    },\n    fileChange(data) {\n      if (data.length) {\n        // 上传\n        this.packageData.image.image_id = data[0].image_id\n        this.packageData.image.image_key = data[0].image_key\n        this.imageIsNone = false\n        this.imageErrorText = ''\n      } else {\n        // 删除\n        this.packageData.image.image_id = null\n        this.packageData.image.image_key = ''\n        this.imageIsNone = true\n        this.imageErrorText = '请上传封面'\n      }\n    },\n    transferUnitChange() {\n      this.packageData.transfer_rate = undefined\n      this.form.setFieldsValue({\n        transfer_rate: undefined\n      })\n    },\n    // start_time validatorFn\n    start_time_validator(rule, value, callback) {\n      if (!value) {\n        // eslint-disable-next-line\n        callback('请选择开始售卖时间')\n      } else {\n        // eslint-disable-next-line\n        callback()\n      }\n    },\n    // end_time validatorFn\n    end_time_validator(rule, value, callback) {\n      if (!value) {\n        // eslint-disable-next-line\n        callback('请选择结束售卖时间')\n      } else {\n        // eslint-disable-next-line\n        callback()\n      }\n    },\n    // 售卖时间-start\n    start_time_change(data) {\n      this.start_time = cloneDeep(data)\n    },\n    handleStartOpenChange(open) {\n      if (!open) {\n        this.endOpen = true\n      }\n    },\n    disabledStartDate(startValue) {\n      const endValue = this.end_time\n      if (!endValue) {\n        // 结束时间未选择\n        return (\n          startValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n        )\n      }\n      let start =\n        endValue.valueOf() >\n        moment()\n          .add(30, 'y')\n          .valueOf()\n          ? moment(endValue)\n              .subtract(30, 'y')\n              .valueOf()\n          : moment()\n              .startOf('day')\n              .valueOf()\n      return (\n        startValue.valueOf() < start ||\n        startValue.valueOf() > moment(endValue).valueOf()\n      )\n    },\n    // 售卖时间-end\n    end_time_change(data) {\n      this.end_time = cloneDeep(data)\n    },\n    handleEndOpenChange(open) {\n      this.endOpen = open\n    },\n    disabledEndDate(endValue) {\n      const startValue = this.start_time\n      if (!startValue) {\n        // 开始时间未选择\n        return (\n          endValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n        )\n      }\n      return (\n        endValue.valueOf() >=\n          moment(startValue)\n            .add(30, 'y')\n            .valueOf() ||\n        endValue.valueOf() < moment(startValue).valueOf() ||\n        endValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n      )\n    },\n    // moment\n    moment\n  },\n  watch: {\n    teamCourseList: {\n      deep: true,\n      handler(newVal) {\n        let allSelect = false\n        let allNotSelect = false\n        allSelect = every(newVal, o => o.courseChecked)\n        allNotSelect = every(newVal, o => !o.courseChecked)\n        this.teamIndeterminate = !allSelect && !allNotSelect\n        this.teamCheckAll = newVal.length ? allSelect : false\n      }\n    },\n    personalCourseList: {\n      deep: true,\n      handler(newVal) {\n        let allSelect = false\n        let allNotSelect = false\n        allSelect = every(newVal, o => o.courseChecked)\n        allNotSelect = every(newVal, o => !o.courseChecked)\n        this.personalIndeterminate = !allSelect && !allNotSelect\n        this.personalCheckAll = newVal.length ? allSelect : false\n      }\n    }\n  },\n  computed: {\n    // 团课小计\n    team_total() {\n      // 当无限次之后，这个值不需要显示，显示最大值即可100000000\n      if (this.packageData.is_limit === 0) return 100000000\n      if (+this.packageData.team_times && +this.packageData.team_unit_price) {\n        return (\n          (this.packageData.team_times *\n            (this.packageData.team_unit_price * 10)) /\n          10\n        )\n      } else {\n        return 0\n      }\n    },\n    // 私教小计\n    personal_total() {\n      // 当无限次之后，这个值不需要显示，显示最大值即可100000000，这个数字后端给的\n      if (this.packageData.is_limit === 0) return 100000000\n      let a = this.packageData.personal_unit_price\n      console.log(a)\n      if (\n        +this.packageData.personal_times &&\n        +this.packageData.personal_unit_price\n      ) {\n        return (\n          (this.packageData.personal_times *\n            (this.packageData.personal_unit_price * 10)) /\n          10\n        )\n      } else {\n        return 0\n      }\n    },\n    all_total() {\n      let teamTotal = this.packageData.is_team ? this.team_total : 0\n      let personalTotal = this.packageData.is_personal ? this.personal_total : 0\n      return teamTotal + personalTotal\n    }\n  }\n}\n",{"version":3,"sources":["edit-range-package.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAywBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"edit-range-package.vue","sourceRoot":"src/views/pages/shop/product/course/manage/package","sourcesContent":["<template>\n  <st-panel app :class=\"basic()\" class=\"page-shop-add-range-package\">\n    <st-form :form=\"form\" labelWidth=\"96px\">\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"课程包名称\" required>\n            {{ packageInfo.course_name }}\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"8\" :xs=\"11\" :offset=\"1\">\n          <div :class=\"basic('user-num')\">\n            <st-form-item label=\"支持使用人数\" required>\n              <st-input-number\n                :min=\"1\"\n                :max=\"20\"\n                style=\"width: 110px\"\n                v-decorator=\"[\n                  'support_num',\n                  {\n                    rules: [{ required: true, message: '请输入支持使用人数' }]\n                  }\n                ]\"\n                placeholder=\"请输入支持使用人数\"\n              />\n            </st-form-item>\n            <span class=\"mg-l8\">限定20人</span>\n          </div>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"总节数\" required>\n            <a-radio-group\n              v-decorator=\"[\n                'is_limit',\n                {\n                  rules: [{ required: true, message: '请选择总节数' }]\n                }\n              ]\"\n              @change=\"limitChange\"\n            >\n              <a-radio\n                v-for=\"(item, index) in limitType\"\n                :key=\"index\"\n                :value=\"item.value\"\n              >\n                {{ item.label }}\n              </a-radio>\n            </a-radio-group>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"23\" :xs=\"22\" :offset=\"1\">\n          <st-form-item\n            :class=\"{ 'st-has-error': !courseIsFirstInput && courseIsNone }\"\n            :help=\"courseErrorText\"\n            required\n          >\n            <template slot=\"label\">\n              上课范围\n              <st-help-tooltip id=\"TSCPCF002\" />\n            </template>\n            <div :class=\"add('course')\">\n              <st-form-table>\n                <colgroup>\n                  <col style=\"width:5%;\" />\n                  <col style=\"width:10%;\" />\n                  <col style=\"width:21%;\" />\n                  <col style=\"width:27%;\" />\n                  <col style=\"width:20%;\" />\n                  <col style=\"width:17%;\" />\n                </colgroup>\n                <tr class=\"bg-thead table-header\">\n                  <th></th>\n                  <th class=\"rightline\">课程类型</th>\n                  <th v-if=\"packageData.is_limit\" class=\"pl-56\">节数</th>\n                  <th class=\"pd-x16\">课时费</th>\n                  <th v-if=\"packageData.is_limit\" class=\"pd-x16\" colspan=\"2\">\n                    小计\n                  </th>\n                  <th></th>\n                </tr>\n                <tbody>\n                  <tr class=\"bg-row-odd checkbox\">\n                    <td class=\"tg-c\">\n                      <a-checkbox\n                        :defaultChecked=\"!!packageInfo.is_team\"\n                        @change=\"teamCheckboxChange\"\n                      />\n                    </td>\n                    <td class=\"rightline white-nowrap\">团体课程</td>\n                    <td v-if=\"packageData.is_limit\" class=\"pr-32 pl-56\">\n                      <st-input-number\n                        :min=\"1\"\n                        :max=\"99999\"\n                        style=\"min-width:100px\"\n                        v-model=\"packageData.team_times\"\n                        :disabled=\"packageData.is_team === 0\"\n                      >\n                        <template slot=\"addonAfter\">\n                          节\n                        </template>\n                      </st-input-number>\n                    </td>\n                    <td class=\"pr-32\">\n                      <st-input-number\n                        :min=\"0\"\n                        :max=\"999999.9\"\n                        style=\"min-width:100px\"\n                        v-model=\"packageData.team_unit_price\"\n                        :float=\"true\"\n                        :disabled=\"packageData.is_team === 0\"\n                      >\n                        <template slot=\"addonAfter\">\n                          元\n                        </template>\n                      </st-input-number>\n                    </td>\n                    <td v-if=\"packageData.is_limit\">{{ team_total }}</td>\n                    <td class=\"overflow-hidden\">\n                      <a\n                        class=\"set-course-button white-nowrap\"\n                        @click=\"teamCourseListShow\"\n                        :disabled=\"!packageData.is_team\"\n                        :class=\"{\n                          hide: !(teamCourseListIsShow && packageData.is_team)\n                        }\"\n                        href=\"javascript:void(0)\"\n                      >\n                        配置上课范围&nbsp;&nbsp;\n                        <st-icon class=\"icon-12\" type=\"down-small\" />\n                      </a>\n                    </td>\n                  </tr>\n                  <tr\n                    class=\"bg-row-odd team-course-list-content\"\n                    v-if=\"teamCourseListIsShow && packageData.is_team\"\n                  >\n                    <td class=\"rightline\" colspan=\"2\"></td>\n                    <td class=\"team-course-table\" colspan=\"4\">\n                      <div :class=\"add('team-course-table')\">\n                        <table>\n                          <colgroup>\n                            <col style=\"width:5%;\" />\n                            <col style=\"width:81%;\" />\n                            <col style=\"width:14%;\" />\n                          </colgroup>\n                          <tr class=\"bg-thead th\">\n                            <th></th>\n                            <th>课程名称</th>\n                            <th>操作</th>\n                          </tr>\n                          <tbody>\n                            <tr class=\"checkbox border-bottom\">\n                              <td colspan=\"3\" class=\"team-course-add-buton\">\n                                <st-button\n                                  block\n                                  type=\"dashed\"\n                                  icon=\"add\"\n                                  @click=\"addCourse('team')\"\n                                >\n                                  新增团体课程\n                                </st-button>\n                              </td>\n                            </tr>\n                            <tr>\n                              <td colspan=\"3\">\n                                <p\n                                  v-if=\"!teamCourseList.length\"\n                                  class=\"bg-row-even\"\n                                  style=\"margin: 0;text-align:center;padding: 8px 0;\"\n                                >\n                                  无数据\n                                </p>\n                                <!-- 在AForm组件里用自定义指令时，需要加上v-decorator,值不能重复 -->\n                                <ul\n                                  class=\"team-course-content-table\"\n                                  v-if=\"teamCourseList.length\"\n                                  v-scrollBar=\"{ stopPropagation: true }\"\n                                  v-decorator=\"['teamCourseList2']\"\n                                >\n                                  <li\n                                    class=\"checkbox border-bottom\"\n                                    :class=\"{\n                                      'bg-row-odd': index % 2 !== 0,\n                                      'bg-row-even': index % 2 === 0\n                                    }\"\n                                    v-for=\"(i, index) in teamCourseList\"\n                                    :key=\"i.course_id\"\n                                  >\n                                    <div class=\"tg-c\">\n                                      <a-checkbox\n                                        :checked=\"i.courseChecked\"\n                                        @change=\"\n                                          courseItemCheckedChange(\n                                            $event,\n                                            'team',\n                                            index\n                                          )\n                                        \"\n                                      />\n                                    </div>\n                                    <div>{{ i.course_name }}</div>\n                                    <div>\n                                      <a\n                                        @click=\"\n                                          removeCourseItem('team', i.course_id)\n                                        \"\n                                        href=\"javascript:void(0)\"\n                                      >\n                                        删除\n                                      </a>\n                                    </div>\n                                  </li>\n                                </ul>\n                              </td>\n                            </tr>\n                            <tr class=\"bg-thead checkbox topline\">\n                              <td class=\"tg-c\">\n                                <a-checkbox\n                                  :indeterminate=\"teamIndeterminate\"\n                                  @change=\"checkAllChange('team')\"\n                                  :checked=\"teamCheckAll\"\n                                />\n                              </td>\n                              <td>批量操作</td>\n                              <td>\n                                <a\n                                  @click=\"removeCourseItems('team')\"\n                                  href=\"javascript:void(0)\"\n                                >\n                                  删除\n                                </a>\n                              </td>\n                            </tr>\n                          </tbody>\n                        </table>\n                      </div>\n                    </td>\n                  </tr>\n                  <tr class=\"bg-row-even checkbox topline\">\n                    <td class=\"tg-c\">\n                      <a-checkbox\n                        :defaultChecked=\"!!packageInfo.is_personal\"\n                        @change=\"personalCheckboxChange\"\n                      />\n                    </td>\n                    <td class=\"rightline\">私教课程</td>\n                    <td v-if=\"packageData.is_limit\" class=\"pr-32 pl-56\">\n                      <st-input-number\n                        :min=\"1\"\n                        :max=\"99999\"\n                        v-model=\"packageData.personal_times\"\n                        :disabled=\"packageData.is_personal === 0\"\n                      >\n                        <template slot=\"addonAfter\">\n                          节\n                        </template>\n                      </st-input-number>\n                    </td>\n                    <td class=\"pr-32\">\n                      <st-input-number\n                        :min=\"0\"\n                        :max=\"999999.9\"\n                        v-model=\"packageData.personal_unit_price\"\n                        :float=\"true\"\n                        :disabled=\"packageData.is_personal === 0\"\n                      >\n                        <template slot=\"addonAfter\">\n                          元\n                        </template>\n                      </st-input-number>\n                    </td>\n                    <td v-if=\"packageData.is_limit\">{{ personal_total }}</td>\n                    <td class=\"overflow-hidden\">\n                      <a\n                        class=\"set-course-button\"\n                        @click=\"personalCourseListShow\"\n                        :disabled=\"!packageData.is_personal\"\n                        :class=\"{\n                          hide: !(\n                            personalCourseListIsShow && packageData.is_personal\n                          )\n                        }\"\n                        href=\"javascript:void(0)\"\n                      >\n                        配置上课范围&nbsp;&nbsp;\n                        <st-icon class=\"icon-12\" type=\"down-small\" />\n                      </a>\n                    </td>\n                  </tr>\n                  <tr\n                    class=\"bg-row-even personal-course-list-content\"\n                    v-if=\"personalCourseListIsShow && packageData.is_personal\"\n                  >\n                    <td class=\"rightline\" colspan=\"2\"></td>\n                    <td class=\"personal-course-table\" colspan=\"4\">\n                      <div :class=\"add('personal-course-table')\">\n                        <table>\n                          <colgroup>\n                            <col style=\"width:5%;\" />\n                            <col style=\"width:29%;\" />\n                            <col style=\"width:34%;\" />\n                            <col style=\"width:16%;\" />\n                            <col style=\"width:16%;\" />\n                          </colgroup>\n                          <tr class=\"bg-thead th\">\n                            <th></th>\n                            <th>课程名称</th>\n                            <th>支持预约的{{ $c('coach') }}等级</th>\n                            <th>授课{{ $c('coach') }}数</th>\n                            <th>操作</th>\n                          </tr>\n                          <tbody>\n                            <tr class=\"checkbox border-bottom\">\n                              <td colspan=\"5\" class=\"personal-course-add-buton\">\n                                <st-button\n                                  block\n                                  type=\"dashed\"\n                                  icon=\"add\"\n                                  @click=\"addCourse('personal')\"\n                                >\n                                  新增私教课程\n                                </st-button>\n                              </td>\n                            </tr>\n                            <tr>\n                              <td colspan=\"5\">\n                                <p\n                                  v-if=\"!personalCourseList.length\"\n                                  class=\"bg-row-even\"\n                                  style=\"margin: 0;text-align:center;padding: 8px 0;\"\n                                >\n                                  无数据\n                                </p>\n                                <!-- 在AForm组件里用自定义指令时，需要加上v-decorator,值不能重复 -->\n                                <ul\n                                  class=\"personal-course-content-table\"\n                                  v-if=\"personalCourseList.length\"\n                                  v-scrollBar=\"{ stopPropagation: true }\"\n                                  v-decorator=\"['personalCourseList1']\"\n                                >\n                                  <li\n                                    class=\"checkbox border-bottom\"\n                                    :class=\"{\n                                      'bg-row-odd': index % 2 !== 0,\n                                      'bg-row-even': index % 2 === 0\n                                    }\"\n                                    v-for=\"(item, index) in personalCourseList\"\n                                    :key=\"item.course_id\"\n                                  >\n                                    <div class=\"tg-c\">\n                                      <a-checkbox\n                                        :checked=\"item.courseChecked\"\n                                        @change=\"\n                                          courseItemCheckedChange(\n                                            $event,\n                                            'personal',\n                                            index\n                                          )\n                                        \"\n                                      />\n                                    </div>\n                                    <div>{{ item.course_name }}</div>\n                                    <div>\n                                      <a-dropdown\n                                        placement=\"bottomRight\"\n                                        :trigger=\"['click']\"\n                                      >\n                                        <a href=\"javascript:void(0)\">\n                                          {{\n                                            item.coachGradeList.length ===\n                                            coachList.length\n                                              ? '全部'\n                                              : `${item.coachGradeList.length}个`\n                                          }}等级&nbsp;&nbsp;\n                                          <st-icon\n                                            class=\"icon-12\"\n                                            type=\"down-small\"\n                                          />\n                                        </a>\n                                        <a-checkbox-group\n                                          :class=\"basic(`personal-dropdown`)\"\n                                          v-model=\"item.coachGradeList\"\n                                          @change=\"\n                                            coachItemChange(\n                                              $event,\n                                              item.course_id,\n                                              index\n                                            )\n                                          \"\n                                          slot=\"overlay\"\n                                        >\n                                          <!-- 在AForm组件里用自定义指令时，需要加上v-decorator,值不能重复 -->\n                                          <ul\n                                            class=\"personal-course-coach-grade-dropdown\"\n                                            v-scrollBar=\"{\n                                              stopPropagation: true\n                                            }\"\n                                            v-decorator=\"[\n                                              `personalCourseListCoachGrade${index}`\n                                            ]\"\n                                          >\n                                            <li\n                                              v-for=\"(coachItem,\n                                              coachIndex) in coachList\"\n                                              :key=\"coachIndex\"\n                                            >\n                                              <a-checkbox :value=\"coachItem.id\">\n                                                {{ coachItem.setting_name }}\n                                              </a-checkbox>\n                                            </li>\n                                          </ul>\n                                        </a-checkbox-group>\n                                      </a-dropdown>\n                                    </div>\n                                    <div>{{ item.coach }}</div>\n                                    <div>\n                                      <a\n                                        @click=\"\n                                          removeCourseItem(\n                                            'personal',\n                                            item.course_id\n                                          )\n                                        \"\n                                        href=\"javascript:void(0)\"\n                                      >\n                                        删除\n                                      </a>\n                                    </div>\n                                  </li>\n                                </ul>\n                              </td>\n                            </tr>\n                            <tr class=\"bg-thead checkbox topline\">\n                              <td class=\"tg-c\">\n                                <a-checkbox\n                                  :indeterminate=\"personalIndeterminate\"\n                                  @change=\"checkAllChange('personal')\"\n                                  :checked=\"personalCheckAll\"\n                                />\n                              </td>\n                              <td>批量操作</td>\n                              <td>\n                                <a-dropdown\n                                  placement=\"bottomRight\"\n                                  :trigger=\"['click']\"\n                                  v-model=\"coachAllOperationDropdownIsShow\"\n                                >\n                                  <a href=\"javascript:void(0)\">\n                                    批量设置等级&nbsp;&nbsp;\n                                    <st-icon\n                                      class=\"icon-12\"\n                                      type=\"down-small\"\n                                    />\n                                  </a>\n                                  <a-checkbox-group\n                                    :class=\"basic(`personal-dropdown`)\"\n                                    v-model=\"personalAllOperationCoachList\"\n                                    @change=\"coachAllChange\"\n                                    class=\"all\"\n                                    slot=\"overlay\"\n                                  >\n                                    <!-- 在AForm组件里用自定义指令时，需要加上v-decorator,值不能重复 -->\n                                    <ul\n                                      class=\"personal-course-coach-grade-dropdown\"\n                                      v-scrollBar=\"{ stopPropagation: true }\"\n                                      v-decorator=\"[\n                                        'personalCourseListCoachGradeAll'\n                                      ]\"\n                                    >\n                                      <li\n                                        v-for=\"(coachItem,\n                                        coachIndex) in coachList\"\n                                        :key=\"coachIndex\"\n                                      >\n                                        <a-checkbox :value=\"coachItem.id\">\n                                          {{ coachItem.setting_name }}\n                                        </a-checkbox>\n                                      </li>\n                                    </ul>\n                                    <div\n                                      class=\"personal-course-coach-grade-dropdown-button\"\n                                    >\n                                      <a\n                                        href=\"javascript:void(0)\"\n                                        :disabled=\"\n                                          !personalAllOperationCoachList.length\n                                        \"\n                                        @click=\"coachAllOperationOk\"\n                                      >\n                                        确定\n                                      </a>\n                                    </div>\n                                  </a-checkbox-group>\n                                </a-dropdown>\n                              </td>\n                              <td>{{ personalAllOperationCoachTotal }}</td>\n                              <td>\n                                <a\n                                  @click=\"removeCourseItems('personal')\"\n                                  href=\"javascript:void(0)\"\n                                >\n                                  删除\n                                </a>\n                              </td>\n                            </tr>\n                          </tbody>\n                        </table>\n                      </div>\n                    </td>\n                  </tr>\n                </tbody>\n              </st-form-table>\n            </div>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row v-if=\"packageData.is_limit\" :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"总价\">{{ all_total }}元</st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"售卖价格\" required>\n            <st-input-number\n              placeholder=\"请输入售卖价格\"\n              :min=\"0\"\n              :max=\"99999.9\"\n              v-decorator=\"[\n                'price',\n                { rules: [{ required: true, message: '请输入售卖价格' }] }\n              ]\"\n              :float=\"true\"\n            >\n              <template slot=\"addonAfter\">\n                元\n              </template>\n            </st-input-number>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <reserve-is-limit :form=\"form\" :reserveIsLimitInfo=\"reserveIsLimitInfo\" />\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item class=\"mg-b0\" label=\"支持售卖时间\" required>\n            <div :class=\"basic('saletime')\">\n              <a-form-item class=\"page-a-form\">\n                <a-date-picker\n                  style=\"width: 100%;\"\n                  :disabledDate=\"disabledStartDate\"\n                  v-decorator=\"[\n                    'start_time',\n                    { rules: [{ validator: start_time_validator }] }\n                  ]\"\n                  format=\"YYYY-MM-DD\"\n                  placeholder=\"开始时间\"\n                  :showToday=\"false\"\n                  @openChange=\"handleStartOpenChange\"\n                  @change=\"start_time_change\"\n                />\n              </a-form-item>\n              <span>~</span>\n              <a-form-item class=\"page-a-form\">\n                <a-date-picker\n                  :disabledDate=\"disabledEndDate\"\n                  v-decorator=\"[\n                    'end_time',\n                    { rules: [{ validator: end_time_validator }] }\n                  ]\"\n                  format=\"YYYY-MM-DD\"\n                  placeholder=\"结束时间\"\n                  :showToday=\"false\"\n                  :open=\"endOpen\"\n                  @openChange=\"handleEndOpenChange\"\n                  @change=\"end_time_change\"\n                />\n              </a-form-item>\n            </div>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"有效时间\" required>\n            <st-input-number\n              placeholder=\"请输入有效时间\"\n              :min=\"1\"\n              :max=\"99999\"\n              v-decorator=\"[\n                'valid_time',\n                {\n                  initialValue: null,\n                  rules: [{ required: true, message: '请输入有效时间' }]\n                }\n              ]\"\n            >\n              <a-select\n                v-model=\"packageData.valid_time_unit\"\n                slot=\"addonAfter\"\n                style=\"width: 60px\"\n              >\n                <a-select-option\n                  v-for=\"(item, index) in unitList\"\n                  :value=\"item.value\"\n                  :key=\"index\"\n                >\n                  {{ item.label }}\n                </a-select-option>\n              </a-select>\n            </st-input-number>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"允许冻结天数\" required>\n            <st-input-number\n              placeholder=\"请输入允许冻结天数\"\n              :min=\"1\"\n              :max=\"99999\"\n              v-decorator=\"[\n                'frozen_days',\n                {\n                  initialValue: null,\n                  rules: [{ required: true, message: '请输入允许冻结天数' }]\n                }\n              ]\"\n            >\n              <template slot=\"addonAfter\">\n                天\n              </template>\n            </st-input-number>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"转让设置\">\n            <div :class=\"basic('transfer')\">\n              <a-checkbox\n                :class=\"basic('transfer-checkbox')\"\n                :defaultChecked=\"!!packageInfo.is_allow_transfer\"\n                @change=\"transfer\"\n              >\n                支持转让\n              </a-checkbox>\n              <st-input-number\n                :min=\"0\"\n                :max=\"packageData.transfer_unit === 1 ? 100 : 99999.9\"\n                v-decorator=\"[\n                  'transfer_rate',\n                  {\n                    rules: [\n                      {\n                        required: packageData.is_allow_transfer !== 0,\n                        message: '请输入转让值数值'\n                      }\n                    ]\n                  }\n                ]\"\n                :disabled=\"packageData.is_allow_transfer === 0\"\n                :float=\"packageData.transfer_unit === 2\"\n                :class=\"basic('transfer-input')\"\n                style=\"padding-right:0;\"\n              >\n                <a-select\n                  :disabled=\"packageData.is_allow_transfer === 0\"\n                  slot=\"addonAfter\"\n                  @change=\"transferUnitChange\"\n                  v-model=\"packageData.transfer_unit\"\n                  style=\"width: 60px\"\n                >\n                  <a-select-option\n                    v-for=\"item in transferUnitList\"\n                    :key=\"item.value\"\n                    :value=\"+item.value\"\n                  >\n                    {{ item.label }}\n                  </a-select-option>\n                </a-select>\n              </st-input-number>\n            </div>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"售卖方式\" required>\n            <a-checkbox-group v-model=\"packageData.sale_mode\">\n              <a-checkbox\n                v-for=\"item in sellTypeList\"\n                :key=\"item.value\"\n                :disabled=\"item.value === 2\"\n                :value=\"item.value\"\n              >\n                {{ item.label }}\n              </a-checkbox>\n            </a-checkbox-group>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"22\" :xs=\"22\" :offset=\"1\">\n          <st-form-item\n            validate-status=\"error\"\n            :help=\"imageErrorText\"\n            label=\"封面\"\n            required\n          >\n            <div :class=\"basic('upload')\">\n              <st-image-upload\n                :class=\"basic('st-upload')\"\n                :cropperModal=\"cropperModal\"\n                :sizeLimit=\"5\"\n                :list=\"fileList\"\n                @change=\"fileChange\"\n              >\n                <i :class=\"basic('st-upload-icon')\"></i>\n                <div :class=\"basic('st-upload-text')\">上传封面</div>\n              </st-image-upload>\n              <div :class=\"basic('upload-describe')\">\n                <p>\n                  图片格式必须为:png,bmp,jpeg,jpg,gif,建议使用png格式图片,以保存最佳效果\n                </p>\n                <p>建议尺寸为750像素X422像素,不可大于2m</p>\n              </div>\n            </div>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"课程包介绍\">\n            <st-textarea\n              v-model=\"packageData.intro\"\n              :maxlength=\"500\"\n              class=\"page-content-card-textarea\"\n              placeholder=\"请输入课程包介绍\"\n            />\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"备注\">\n            <st-textarea\n              v-model=\"packageData.remarks\"\n              :maxlength=\"500\"\n              class=\"page-content-card-textarea\"\n              placeholder=\"请输入备注\"\n            />\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\" \">\n            <st-button\n              type=\"primary\"\n              class=\"mr-8\"\n              @click=\"save\"\n              :loading=\"editLoading.editPackage\"\n            >\n              保存\n            </st-button>\n          </st-form-item>\n        </a-col>\n      </a-row>\n    </st-form>\n  </st-panel>\n</template>\n<script>\nimport moment from 'moment'\nimport ReserveIsLimit from './components#/reserveIsLimit'\nimport { cloneDeep, remove, every, filter, reduce, forEach } from 'lodash-es'\nimport { EditRangePackageService } from './edit-range-package.service'\nimport CourseSelectCourse from '@/views/biz-modals/course/select-course'\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue'\nexport default {\n  name: 'ShopRangePackageEdit',\n  serviceInject() {\n    return {\n      editPackageService: EditRangePackageService\n    }\n  },\n  rxState() {\n    return {\n      transferUnitList: this.editPackageService.transferUnitList$,\n      sellTypeList: this.editPackageService.sellTypeList$,\n      unitList: this.editPackageService.unitList$,\n      editLoading: this.editPackageService.loading$,\n      coachList: this.editPackageService.coachList$,\n      packageInfo: this.editPackageService.packageInfo$,\n      limitType: this.editPackageService.limitType$\n    }\n  },\n  components: {\n    StImageUpload,\n    ReserveIsLimit\n  },\n  modals: {\n    CourseSelectCourse\n  },\n  bem: {\n    add: 'page-shop-add-range-package',\n    basic: 'page-shop-add-basic-package'\n  },\n  data() {\n    return {\n      packageData: {\n        // 售价\n        price: undefined,\n        // 总节数 0为不限次 1为限次\n        is_limit: 0,\n        // 是否支持团体课 0为不支持 1为支持\n        is_team: 0,\n        // 团体课总节数\n        team_times: undefined,\n        // 团体课单价\n        team_unit_price: undefined,\n        // 团体课上课范围课程id\n        team_range: [],\n        // 是否支持私教课 0为不支持 1为支持\n        is_personal: 0,\n        // 私教课总节数\n        personal_times: undefined,\n        // 私教课单价\n        personal_unit_price: undefined,\n        // 私教课上课范围课程id course_id私教课课程id coach_level私教课支持预约的教练等级\n        personal_range: [],\n        // 售卖开始时间\n        start_time: '',\n        // 售卖截止时间\n        end_time: '',\n        // 有效时间值\n        valid_time: undefined,\n        // 有效时间单位 1:天 2:月 3:年\n        valid_time_unit: 1,\n        // 允许冻结天数\n        frozen_days: undefined,\n        // 售卖方式\n        sale_mode: [2],\n        // 是否可以转让: 0 不可以 1 可以\n        is_allow_transfer: 0,\n        // 转让费率\n        transfer_rate: undefined,\n        // 转让单位 1:百分比 2:元\n        transfer_unit: 1,\n        // 封面对象\n        image: {\n          image_id: null,\n          image_key: ''\n        },\n        // 课程包介绍\n        intro: '',\n        // 备注\n        remarks: ''\n      },\n      // 课程范围是否未输入过\n      courseIsFirstInput: true,\n      // team course\n      teamCourseList: [],\n      teamCourseListIsShow: false,\n      teamIndeterminate: false,\n      teamCheckAll: false,\n      // personal course\n      personalCourseList: [],\n      personalCoachTotalList: {},\n      personalCoachListHistory: [],\n      personalAllOperationCoachList: [],\n      personalAllOperationCoachTotal: 0,\n      personalCourseListIsShow: false,\n      personalIndeterminate: false,\n      personalCheckAll: false,\n      coachAllOperationDropdownIsShow: false,\n      // 课程范围是否未配置\n      courseIsNone: false,\n      courseErrorText: '',\n      form: this.$form.createForm(this),\n      start_time: null,\n      end_time: null,\n      reserveIsLimitInfo: {},\n      endOpen: false,\n      // 是否配置了用户端\n      appConfig: true,\n      // 是否未传了封面\n      imageIsNone: false,\n      imageErrorText: '',\n      fileList: [],\n      cropperModal: {}\n    }\n  },\n  mounted() {\n    this.init()\n  },\n  methods: {\n    limitChange(e) {\n      console.log(e)\n      let value = e.target.value\n      this.packageData.is_limit = +value\n      if (value) {\n        this.packageData.team_times = undefined\n        this.packageData.personal_times = undefined\n        this.form.setFieldsValue({\n          team_times: undefined,\n          personal_times: undefined\n        })\n      } else {\n        this.packageData.team_times = 1\n        this.packageData.personal_times = 1\n        this.form.setFieldsValue({\n          team_times: 1,\n          personal_times: 1\n        })\n      }\n    },\n    init() {\n      if (!this.packageInfo.is_team) {\n        this.packageInfo.team_times = undefined\n        this.packageInfo.team_unit_price = undefined\n        this.packageInfo.team_range = []\n      }\n      if (!this.packageInfo.is_personal) {\n        this.packageInfo.personal_times = undefined\n        this.packageInfo.personal_unit_price = undefined\n        this.packageInfo.personal_range = []\n      }\n      // 初始化约课限制对象 5.22 start\n      const {\n        reserve_is_limit,\n        reserve_limit_day,\n        reserve_limit_times\n      } = this.packageInfo\n      this.reserveIsLimitInfo = {\n        reserve_is_limit,\n        reserve_limit_day,\n        reserve_limit_times\n      }\n      // 初始化约课限制对象 5.22 end\n      if (!this.packageInfo.is_allow_transfer) {\n        this.packageInfo.transfer_rate = undefined\n      }\n      this.form.setFieldsValue({\n        support_num: this.packageInfo.support_num,\n        is_limit: this.packageInfo.is_limit,\n        price: this.packageInfo.price,\n        start_time: moment(this.packageInfo.start_time),\n        end_time: moment(this.packageInfo.end_time),\n        valid_time: this.packageInfo.valid_time,\n        frozen_days: this.packageInfo.frozen_days,\n        transfer_rate: this.packageInfo.transfer_rate\n      })\n      // 课程范围\n      this.packageData.is_limit = this.packageInfo.is_limit\n      this.packageData.is_team = this.packageInfo.is_team\n      this.packageData.team_times = this.packageInfo.team_times\n      this.packageData.team_unit_price = this.packageInfo.team_unit_price\n      forEach(this.packageInfo.team_range, o => {\n        this.teamCourseList.push({\n          courseChecked: false,\n          course_category: o.course_category,\n          course_id: o.course_id,\n          course_name: o.course_name,\n          course_type: o.course_type\n        })\n      })\n      this.packageData.is_personal = this.packageInfo.is_personal\n      this.packageData.personal_times = this.packageInfo.personal_times\n      this.packageData.personal_unit_price = this.packageInfo.personal_unit_price\n      forEach(this.packageInfo.personal_range, o => {\n        let coachGradeList = []\n        o.coach_level.forEach(i => {\n          coachGradeList.push(i.id)\n        })\n        let selectCoach = filter(this.coachList, i =>\n          coachGradeList.includes(i.id)\n        )\n        let total = reduce(selectCoach, (sum, i) => sum + i.coach_number, 0)\n        this.personalCourseList.push({\n          courseChecked: false,\n          course_category: o.course_category,\n          course_id: o.course_id,\n          course_name: o.course_name,\n          course_type: o.course_type,\n          coachGradeList,\n          coach: total\n        })\n        this.personalCoachTotalList[o.course_id] =\n          this.personalCoachTotalList[o.course_id] || {}\n        this.personalCoachTotalList[o.course_id].list = cloneDeep(o.coach_level)\n        this.personalCoachTotalList[o.course_id].total = total\n        this.personalCoachListHistory.push(\n          cloneDeep(o.coach_level.map(item => item.id))\n        )\n      })\n      // 售卖时间\n      this.start_time = this.packageInfo.start_time\n      this.end_time = this.packageInfo.end_time\n      // 有效时间单位\n      this.packageData.valid_time_unit = this.packageInfo.valid_time_unit\n      // 转让设置\n      this.packageData.is_allow_transfer = this.packageInfo.is_allow_transfer\n      this.packageData.transfer_unit = this.packageInfo.transfer_unit\n      // 售卖方式\n      this.packageData.sale_mode = this.packageInfo.sale_mode\n      // 封面\n      this.fileList = [this.packageInfo.image]\n      this.packageData.image.image_id = this.fileList[0].image_id\n      this.packageData.image.image_key = this.fileList[0].image_key\n      this.imageIsNone = false\n      this.imageErrorText = ''\n      // 介绍\n      this.packageData.intro = this.packageInfo.intro\n      // 备注\n      this.packageData.remarks = this.packageInfo.remarks\n    },\n    // 保存\n    save() {\n      this.course_validator()\n      this.image_validator()\n      this.form.validateFieldsAndScroll((err, values) => {\n        if (!err && !this.courseIsNone && !this.imageIsNone) {\n          this.packageData.price = values.price\n          this.packageData.valid_time = values.valid_time\n          this.packageData.frozen_days = values.frozen_days\n          this.packageData.support_num = values.support_num\n          // 约课限制 5.22 start\n          this.packageData.reserve_is_limit = values.reserve_is_limit\n          this.packageData.reserve_limit_day = values.reserve_limit_day\n          this.packageData.reserve_limit_times = +values.reserve_limit_times\n          // 约课限制 5.22 end\n          this.packageData.transfer_rate = this.packageData.is_allow_transfer\n            ? +values.transfer_rate\n            : undefined\n          this.packageData.start_time =\n            typeof this.start_time === 'string'\n              ? this.start_time\n              : `${this.start_time.format('YYYY-MM-DD')}`\n          this.packageData.end_time =\n            typeof this.end_time === 'string'\n              ? this.end_time\n              : `${this.end_time.format('YYYY-MM-DD')}`\n          this.packageData.team_range = []\n          this.teamCourseList.forEach(i => {\n            this.packageData.team_range.push(i.course_id)\n          })\n          this.packageData.personal_range = []\n          this.personalCourseList.forEach(i => {\n            this.packageData.personal_range.push({\n              course_id: i.course_id,\n              coach_level: cloneDeep(i.coachGradeList)\n            })\n          })\n          if (this.packageData.is_team) {\n            this.packageData.team_unit_price = +this.packageData.team_unit_price\n          }\n          if (this.packageData.is_personal) {\n            this.packageData.personal_unit_price = +this.packageData\n              .personal_unit_price\n          }\n          this.packageData.album_id = this.packageInfo.album_id // 这个给后端快捷找到相册使用，前端不需要处理使用\n          this.editPackageService\n            .editPackage(this.packageData)\n            .subscribe(res => {\n              this.$router.push({\n                path: '/shop/product/course/manage/package/list'\n              })\n            })\n        }\n      })\n    },\n    // checkboxChange\n    teamCheckboxChange(e) {\n      this.packageData.is_team = +e.target.checked\n      this.courseIsFirstInput = false\n      this.teamCourseListIsShow = +e.target.checked\n    },\n    personalCheckboxChange(e) {\n      this.packageData.is_personal = +e.target.checked\n      this.courseIsFirstInput = false\n      this.personalCourseListIsShow = +e.target.checked\n    },\n    // team\n    teamCourseListShow() {\n      this.teamCourseListIsShow = !this.teamCourseListIsShow\n    },\n    // personal\n    personalCourseListShow() {\n      this.personalCourseListIsShow = !this.personalCourseListIsShow\n    },\n    // 新增课程\n    addCourse(type) {\n      let that = this\n      if (type === 'team') {\n        this.$modalRouter.push({\n          name: 'course-select-course',\n          props: {\n            type,\n            courses: this.teamCourseList\n          },\n          on: {\n            ok(data) {\n              data.list.forEach(i => {\n                i.courseChecked = false\n              })\n              that.teamCourseList = cloneDeep(data.list)\n            }\n          }\n        })\n      } else if (type === 'personal') {\n        this.$modalRouter.push({\n          name: 'course-select-course',\n          props: {\n            type,\n            courses: this.personalCourseList\n          },\n          on: {\n            ok(data) {\n              let coachGradeList = []\n              forEach(that.coachList, i => {\n                coachGradeList.push(i.id)\n              })\n              let total = reduce(\n                that.coachList,\n                (sum, o) => sum + o.coach_number,\n                0\n              )\n              data.list.forEach(i => {\n                i.courseChecked = false\n                i.coachGradeList = coachGradeList\n                i.coach = total\n              })\n              forEach(that.personalCoachTotalList, (value, key) => {\n                forEach(data.list, innerValue => {\n                  if (+innerValue.course_id === +key) {\n                    innerValue.coachGradeList = cloneDeep(value.list)\n                    innerValue.coach = cloneDeep(value.total)\n                  }\n                })\n                // 删除personalCoachTotalList里不存在的course_id项\n                if (!data.list.some(o => +o.course_id === +key)) {\n                  delete that.personalCoachTotalList[key]\n                }\n              })\n              that.personalCoachListHistory = []\n              // 缓存选择的教练等级\n              data.list.forEach(i => {\n                that.personalCoachListHistory.push(i.coachGradeList)\n              })\n              that.personalCourseList = cloneDeep(data.list)\n              that.personalCourseList.forEach(item => {\n                if (item.coachGradeList && item.coachGradeList.length > 0) {\n                  item.coachGradeList = item.coachGradeList.map(i => {\n                    return i.id || i\n                  })\n                }\n              })\n              console.log(that.personalCourseList)\n            }\n          }\n        })\n      }\n    },\n    // 移除课程\n    removeCourseItem(type, id) {\n      if (type === 'team') {\n        let arr = cloneDeep(this.teamCourseList)\n        remove(arr, o => o.course_id === id)\n        this.teamCourseList = arr\n      } else if (type === 'personal') {\n        let arr = cloneDeep(this.personalCourseList)\n        remove(arr, o => o.course_id === id)\n        this.personalCourseList = arr\n        // 移除备份选择的教练list\n        let coachList = cloneDeep(this.personalCoachTotalList)\n        delete coachList[id]\n        this.personalCoachTotalList = coachList\n      }\n    },\n    // 移除选择的课程\n    removeCourseItems(type) {\n      if (type === 'team') {\n        let arr = cloneDeep(this.teamCourseList)\n        remove(arr, o => o.courseChecked)\n        this.teamCourseList = arr\n      } else if (type === 'personal') {\n        let arr = cloneDeep(this.personalCourseList)\n        let removeList = remove(arr, o => o.courseChecked)\n        this.personalCourseList = arr\n        // 移除备份选择的教练list\n        let coachList = cloneDeep(this.personalCoachTotalList)\n        removeList.forEach(i => {\n          delete coachList[i.course_id]\n        })\n        this.personalCoachTotalList = coachList\n      }\n    },\n    // 选择课程\n    courseItemCheckedChange(e, type, index) {\n      if (type === 'team') {\n        this.teamCourseList[index].courseChecked = e.target.checked\n      } else if (type === 'personal') {\n        this.personalCourseList[index].courseChecked = e.target.checked\n      }\n    },\n    // 全选\n    checkAllChange(type) {\n      if (type === 'team') {\n        this.teamCourseList.forEach(i => {\n          i.courseChecked = !this.teamCheckAll\n        })\n      } else if (type === 'personal') {\n        this.personalCourseList.forEach(i => {\n          i.courseChecked = !this.personalCheckAll\n        })\n      }\n    },\n    // item coach checkboxGroup changeEvent\n    coachItemChange(e, id, index) {\n      if (!e.length) {\n        this.personalCourseList[\n          index\n        ].coachGradeList = this.personalCoachListHistory[index]\n        return\n      } else {\n        this.personalCoachListHistory[index] = cloneDeep(e)\n      }\n      this.personalCoachTotalList[id] = {}\n      this.personalCoachTotalList[id].list = cloneDeep(e)\n      let selectCoach = filter(this.coachList, o => e.includes(o.id))\n      let total = reduce(selectCoach, (sum, o) => sum + o.coach_number, 0)\n      this.personalCoachTotalList[id].total = total\n      // 设置教练总数\n      this.personalCourseList.forEach(i => {\n        if (i.course_id === id) {\n          i.coach = total\n        }\n      })\n    },\n    coachAllChange(e) {\n      let selectCoach = filter(this.coachList, o => e.includes(o.id))\n      this.personalAllOperationCoachTotal = reduce(\n        selectCoach,\n        (sum, o) => sum + o.coach_number,\n        0\n      )\n    },\n    coachAllOperationOk() {\n      // 批量设置\n      forEach(this.personalCourseList, value => {\n        if (value.courseChecked) {\n          value.coachGradeList = cloneDeep(this.personalAllOperationCoachList)\n          value.coach = this.personalAllOperationCoachTotal\n          this.personalCoachTotalList[value.course_id] = {}\n          this.personalCoachTotalList[value.course_id].list = cloneDeep(\n            this.personalAllOperationCoachList\n          )\n          this.personalCoachTotalList[\n            value.course_id\n          ].total = this.personalAllOperationCoachTotal\n        }\n      })\n      // 缓存选择的教练等级\n      this.personalCoachListHistory = []\n      forEach(this.personalCourseList, i => {\n        this.personalCoachListHistory.push(i.coachGradeList)\n      })\n      // 清空\n      this.personalAllOperationCoachList = []\n      this.personalAllOperationCoachTotal = 0\n      // 收起\n      this.coachAllOperationDropdownIsShow = false\n    },\n    // course validatorFn\n    course_validator() {\n      this.courseIsFirstInput = false\n      let teamIsOk = false\n      let personalIsOk = false\n      if (this.packageData.is_team) {\n        teamIsOk = this.team_total && this.teamCourseList.length\n      } else {\n        teamIsOk = true\n      }\n      if (this.packageData.is_personal) {\n        personalIsOk = this.personal_total && this.personalCourseList.length\n      } else {\n        personalIsOk = true\n      }\n\n      if (\n        teamIsOk &&\n        personalIsOk &&\n        !(!this.packageData.is_team && !this.packageData.is_personal)\n      ) {\n        // 校验通过\n        this.courseIsNone = false\n        this.courseErrorText = ''\n      } else {\n        // 校验未通过\n        this.courseIsNone = true\n        this.courseErrorText = '请输入上课范围'\n      }\n    },\n    // image validatorFn\n    image_validator() {\n      if (this.packageData.image.image_key !== '') {\n        // 校验通过\n        this.imageIsNone = false\n        this.imageErrorText = ''\n      } else {\n        // 校验未通过\n        this.imageIsNone = true\n        this.imageErrorText = '请上传封面'\n      }\n    },\n    // 转让\n    transfer(e) {\n      this.packageData.is_allow_transfer = +e.target.checked\n      // 重置转让费用的校验\n      this.packageData.transfer_rate = undefined\n      this.form.resetFields(['transfer_rate'])\n    },\n    fileChange(data) {\n      if (data.length) {\n        // 上传\n        this.packageData.image.image_id = data[0].image_id\n        this.packageData.image.image_key = data[0].image_key\n        this.imageIsNone = false\n        this.imageErrorText = ''\n      } else {\n        // 删除\n        this.packageData.image.image_id = null\n        this.packageData.image.image_key = ''\n        this.imageIsNone = true\n        this.imageErrorText = '请上传封面'\n      }\n    },\n    transferUnitChange() {\n      this.packageData.transfer_rate = undefined\n      this.form.setFieldsValue({\n        transfer_rate: undefined\n      })\n    },\n    // start_time validatorFn\n    start_time_validator(rule, value, callback) {\n      if (!value) {\n        // eslint-disable-next-line\n        callback('请选择开始售卖时间')\n      } else {\n        // eslint-disable-next-line\n        callback()\n      }\n    },\n    // end_time validatorFn\n    end_time_validator(rule, value, callback) {\n      if (!value) {\n        // eslint-disable-next-line\n        callback('请选择结束售卖时间')\n      } else {\n        // eslint-disable-next-line\n        callback()\n      }\n    },\n    // 售卖时间-start\n    start_time_change(data) {\n      this.start_time = cloneDeep(data)\n    },\n    handleStartOpenChange(open) {\n      if (!open) {\n        this.endOpen = true\n      }\n    },\n    disabledStartDate(startValue) {\n      const endValue = this.end_time\n      if (!endValue) {\n        // 结束时间未选择\n        return (\n          startValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n        )\n      }\n      let start =\n        endValue.valueOf() >\n        moment()\n          .add(30, 'y')\n          .valueOf()\n          ? moment(endValue)\n              .subtract(30, 'y')\n              .valueOf()\n          : moment()\n              .startOf('day')\n              .valueOf()\n      return (\n        startValue.valueOf() < start ||\n        startValue.valueOf() > moment(endValue).valueOf()\n      )\n    },\n    // 售卖时间-end\n    end_time_change(data) {\n      this.end_time = cloneDeep(data)\n    },\n    handleEndOpenChange(open) {\n      this.endOpen = open\n    },\n    disabledEndDate(endValue) {\n      const startValue = this.start_time\n      if (!startValue) {\n        // 开始时间未选择\n        return (\n          endValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n        )\n      }\n      return (\n        endValue.valueOf() >=\n          moment(startValue)\n            .add(30, 'y')\n            .valueOf() ||\n        endValue.valueOf() < moment(startValue).valueOf() ||\n        endValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n      )\n    },\n    // moment\n    moment\n  },\n  watch: {\n    teamCourseList: {\n      deep: true,\n      handler(newVal) {\n        let allSelect = false\n        let allNotSelect = false\n        allSelect = every(newVal, o => o.courseChecked)\n        allNotSelect = every(newVal, o => !o.courseChecked)\n        this.teamIndeterminate = !allSelect && !allNotSelect\n        this.teamCheckAll = newVal.length ? allSelect : false\n      }\n    },\n    personalCourseList: {\n      deep: true,\n      handler(newVal) {\n        let allSelect = false\n        let allNotSelect = false\n        allSelect = every(newVal, o => o.courseChecked)\n        allNotSelect = every(newVal, o => !o.courseChecked)\n        this.personalIndeterminate = !allSelect && !allNotSelect\n        this.personalCheckAll = newVal.length ? allSelect : false\n      }\n    }\n  },\n  computed: {\n    // 团课小计\n    team_total() {\n      // 当无限次之后，这个值不需要显示，显示最大值即可100000000\n      if (this.packageData.is_limit === 0) return 100000000\n      if (+this.packageData.team_times && +this.packageData.team_unit_price) {\n        return (\n          (this.packageData.team_times *\n            (this.packageData.team_unit_price * 10)) /\n          10\n        )\n      } else {\n        return 0\n      }\n    },\n    // 私教小计\n    personal_total() {\n      // 当无限次之后，这个值不需要显示，显示最大值即可100000000，这个数字后端给的\n      if (this.packageData.is_limit === 0) return 100000000\n      let a = this.packageData.personal_unit_price\n      console.log(a)\n      if (\n        +this.packageData.personal_times &&\n        +this.packageData.personal_unit_price\n      ) {\n        return (\n          (this.packageData.personal_times *\n            (this.packageData.personal_unit_price * 10)) /\n          10\n        )\n      } else {\n        return 0\n      }\n    },\n    all_total() {\n      let teamTotal = this.packageData.is_team ? this.team_total : 0\n      let personalTotal = this.packageData.is_personal ? this.personal_total : 0\n      return teamTotal + personalTotal\n    }\n  }\n}\n</script>\n"]}]}