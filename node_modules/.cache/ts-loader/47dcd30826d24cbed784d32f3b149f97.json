{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/marketing/add-ticket.config.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/marketing/add-ticket.config.ts","mtime":1600926555863},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.number.is-nan\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport moment from 'moment';\nimport { ACTIVITY_STATUS } from '@/constants/brand/marketing';\nexport var ruleOptions = function ruleOptions(vm) {\n  var pattern = vm.pattern;\n  return {\n    ticket_name: {\n      rules: [{\n        required: true,\n        message: '请输入票种名称'\n      }, {\n        pattern: pattern.CN_EN_NUM('1-10'),\n        message: '请输入1~10个英文，中文字符'\n      }, {\n        validator: function validator(field, value, values) {\n          var ticketNames = vm.dataSource.map(function (item) {\n            return item.ticket_name;\n          }); // 如果编辑时编辑后的票名和之前一样不需要校验\n\n          if (vm.ticket && vm.ticket.ticket_name === value) return;\n\n          if (ticketNames.includes(value)) {\n            return '票种名称重复请重新输入';\n          }\n        }\n      }]\n    },\n    ticket_price: {\n      initialValue: 1,\n      rules: [{\n        required: true,\n        message: '请输入价格'\n      }]\n    },\n    ticket_total_num: {\n      initialValue: 1,\n      rules: [{\n        required: true,\n        message: '请输入票数'\n      }, {\n        validator: function validator(field, value, values) {\n          var ticketTotalNum = 0;\n\n          if (vm.formData && Array.isArray(vm.formData.ticket_list)) {\n            vm.formData.ticket_list.forEach(function (item) {\n              if (vm.ticket && item.ticket_id === vm.ticket.ticket_id) {\n                ticketTotalNum = item.ticket_total_num;\n              }\n            });\n          }\n\n          if (vm.ticket && vm.ticket.ticket_id && vm.formData.activity_status === 1 && value < ticketTotalNum) {\n            return '编辑票种时，票数只能增加不能减少';\n          }\n        }\n      }]\n    },\n    crowd_id: {\n      rules: [{\n        required: true,\n        message: '请选择购买用户'\n      }]\n    },\n    buy_limit_min: {\n      initialValue: 1,\n      rules: [{\n        required: true,\n        message: '请输入最少份数'\n      }, {\n        validator: function validator(field, value, values) {\n          // 票种为免费票团购优惠没有\n          if (+values.ticket_price > 0 && +value > +values.ticket_total_num) {\n            return '单次购买最低张数应小于票的总数';\n          }\n        }\n      }]\n    },\n    buy_limit_max: {\n      initialValue: 1,\n      rules: [{\n        validator: function validator(field, value, values) {\n          if (+value > +values.ticket_total_num) {\n            return '单次购买最高张数应小于票的总数';\n          }\n\n          if (+values.buy_limit_min > 0 && +value < +values.buy_limit_min) {\n            return \"\\u6700\\u5927\\u8D2D\\u4E70\\u5F20\\u6570\\u5E94\\u5927\\u4E8E\\u6700\\u4F4E\\u8D2D\\u4E70\\u5F20\\u6570\".concat(values.buy_limit_min);\n          }\n        }\n      }]\n    },\n    is_group_buy: {\n      initialValue: 1\n    },\n    group_buy_min: {\n      initialValue: 1,\n      rules: [{\n        validator: function validator(field, value, values) {\n          if (Number.isNaN(value) || Number.isNaN(values.ticket_total_num)) {\n            return;\n          } else {\n            if (value > values.ticket_total_num) {\n              return '单次购买超过张数应小于票的总数';\n            }\n          }\n\n          if (+value < +values.buy_limit_min || +value > +values.buy_limit_max) {\n            return \"\\u5355\\u6B21\\u8D2D\\u4E70\\u533A\\u95F4\\u5728\".concat(values.buy_limit_min, \" - \").concat(values.buy_limit_max);\n          }\n        }\n      }]\n    },\n    reduce_price: {\n      initialValue: 1,\n      rules: [{\n        validator: function validator(field, value, values) {\n          if (Number.isNaN(value) || Number.isNaN(values.ticket_price)) return;\n\n          if (+value > +values.ticket_price) {\n            return '每张减的价格应小于票的原价';\n          }\n        }\n      }]\n    },\n    buy_time_limit: {\n      initialValue: 0,\n      rules: [{\n        required: true,\n        message: '请选择时间'\n      }]\n    },\n    buy_time: {\n      rules: [{\n        validator: function validator(field, value, values) {\n          if (vm.formData.activity_status === ACTIVITY_STATUS.PUBLISHED) return;\n          var endTime = moment(vm.stepForm.end_time);\n\n          if (value && value.length && value[0].valueOf() > endTime.valueOf()) {\n            return \"\\u552E\\u5356\\u5F00\\u59CB\\u65F6\\u95F4\\u8981\\u65E9\\u4E8E\\u6D3B\\u52A8\\u7ED3\\u675F\\u65F6\\u95F4\".concat(endTime.format('YYYY-MM-DD  HH:mm'));\n          }\n\n          if (value && value.length && value[1].valueOf() > endTime.valueOf()) {\n            return \"\\u552E\\u5356\\u7ED3\\u675F\\u65F6\\u95F4\\u8981\\u65E9\\u4E8E\\u6D3B\\u52A8\\u7ED3\\u675F\\u65F6\\u95F4\".concat(endTime.format('YYYY-MM-DD  HH:mm'));\n          }\n        }\n      }]\n    },\n    ticket_remark: {}\n  };\n};",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/marketing/add-ticket.config.ts"],"names":[],"mappings":"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","sourcesContent":["import { forEach } from 'lodash-es'\nimport { ID } from '@/api/v1/order/transaction/contract'\nimport moment from 'moment'\nimport { ACTIVITY_STATUS } from '@/constants/brand/marketing'\nexport const ruleOptions = (vm: any) => {\n  const pattern = vm.pattern\n  return {\n    ticket_name: {\n      rules: [\n        {\n          required: true,\n          message: '请输入票种名称'\n        },\n        {\n          pattern: pattern.CN_EN_NUM('1-10'),\n          message: '请输入1~10个英文，中文字符'\n        },\n        {\n          validator: (field: any, value: any, values: any) => {\n            const ticketNames = vm.dataSource.map(\n              (item: any) => item.ticket_name\n            )\n            // 如果编辑时编辑后的票名和之前一样不需要校验\n            if (vm.ticket && vm.ticket.ticket_name === value) return\n            if (ticketNames.includes(value)) {\n              return '票种名称重复请重新输入'\n            }\n          }\n        }\n      ]\n    },\n    ticket_price: {\n      initialValue: 1,\n      rules: [\n        {\n          required: true,\n          message: '请输入价格'\n        }\n      ]\n    },\n    ticket_total_num: {\n      initialValue: 1,\n      rules: [\n        {\n          required: true,\n          message: '请输入票数'\n        },\n        {\n          validator: (field: any, value: any, values: any) => {\n            let ticketTotalNum = 0\n            if (vm.formData && Array.isArray(vm.formData.ticket_list)) {\n              vm.formData.ticket_list.forEach((item: any) => {\n                if (vm.ticket && item.ticket_id === vm.ticket.ticket_id) {\n                  ticketTotalNum = item.ticket_total_num\n                }\n              })\n            }\n            if (\n              vm.ticket &&\n              vm.ticket.ticket_id &&\n              vm.formData.activity_status === 1 &&\n              value < ticketTotalNum\n            ) {\n              return '编辑票种时，票数只能增加不能减少'\n            }\n          }\n        }\n      ]\n    },\n    crowd_id: {\n      rules: [\n        {\n          required: true,\n          message: '请选择购买用户'\n        }\n      ]\n    },\n    buy_limit_min: {\n      initialValue: 1,\n      rules: [\n        {\n          required: true,\n          message: '请输入最少份数'\n        },\n        {\n          validator: (field: any, value: any, values: any) => {\n            // 票种为免费票团购优惠没有\n            if (+values.ticket_price > 0 && +value > +values.ticket_total_num) {\n              return '单次购买最低张数应小于票的总数'\n            }\n          }\n        }\n      ]\n    },\n    buy_limit_max: {\n      initialValue: 1,\n      rules: [\n        {\n          validator: (field: any, value: any, values: any) => {\n            if (+value > +values.ticket_total_num) {\n              return '单次购买最高张数应小于票的总数'\n            }\n            if (+values.buy_limit_min > 0 && +value < +values.buy_limit_min) {\n              return `最大购买张数应大于最低购买张数${values.buy_limit_min}`\n            }\n          }\n        }\n      ]\n    },\n    is_group_buy: {\n      initialValue: 1\n    },\n    group_buy_min: {\n      initialValue: 1,\n      rules: [\n        {\n          validator: (field: any, value: any, values: any) => {\n            if (Number.isNaN(value) || Number.isNaN(values.ticket_total_num)) {\n              return\n            } else {\n              if (value > values.ticket_total_num) {\n                return '单次购买超过张数应小于票的总数'\n              }\n            }\n            if (\n              +value < +values.buy_limit_min ||\n              +value > +values.buy_limit_max\n            ) {\n              return `单次购买区间在${values.buy_limit_min} - ${values.buy_limit_max}`\n            }\n          }\n        }\n      ]\n    },\n    reduce_price: {\n      initialValue: 1,\n      rules: [\n        {\n          validator: (field: any, value: any, values: any) => {\n            if (Number.isNaN(value) || Number.isNaN(values.ticket_price)) return\n            if (+value > +values.ticket_price) {\n              return '每张减的价格应小于票的原价'\n            }\n          }\n        }\n      ]\n    },\n    buy_time_limit: {\n      initialValue: 0,\n      rules: [\n        {\n          required: true,\n          message: '请选择时间'\n        }\n      ]\n    },\n    buy_time: {\n      rules: [\n        {\n          validator: (field: any, value: any, values: any) => {\n            if (vm.formData.activity_status === ACTIVITY_STATUS.PUBLISHED)\n              return\n            const endTime = moment(vm.stepForm.end_time)\n            if (\n              value &&\n              value.length &&\n              value[0].valueOf() > endTime.valueOf()\n            ) {\n              return `售卖开始时间要早于活动结束时间${endTime.format(\n                'YYYY-MM-DD  HH:mm'\n              )}`\n            }\n            if (\n              value &&\n              value.length &&\n              value[1].valueOf() > endTime.valueOf()\n            ) {\n              return `售卖结束时间要早于活动结束时间${endTime.format(\n                'YYYY-MM-DD  HH:mm'\n              )}`\n            }\n          }\n        }\n      ]\n    },\n    ticket_remark: {}\n  }\n}\n"],"sourceRoot":""}]}