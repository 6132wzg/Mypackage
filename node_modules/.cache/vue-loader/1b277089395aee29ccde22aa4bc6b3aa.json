{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/brand/app/attendance/card-replacement.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/brand/app/attendance/card-replacement.vue","mtime":1600926555816},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport StaffSelect from '@/views/biz-components/staff-select/staff-select'\nimport { CardReplacementService } from './card-replacement.service'\nimport moment from 'moment'\nimport { cloneDeep } from 'lodash-es'\nimport tipVue from '@/views/pages/brand/marketing/plugin/coupon/tip.vue'\nimport { MessageService } from '@/services/message.service'\nexport default {\n  bem: {\n    module: 'brand-app-attendance-card-replacement'\n  },\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      cardReplacementService: CardReplacementService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.cardReplacementService.loading$\n    }\n  },\n  components: { StaffSelect },\n  name: 'newLable',\n  props: {\n    // 1-table btn,2-单员工补卡\n    source: {\n      type: String,\n      default: '0'\n    },\n    record: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    }\n  },\n  data() {\n    return {\n      show: false,\n      form: this.$form.createForm(this, { name: 'coordinated' }),\n      shopList: [],\n      in_time: null,\n      out_time: null,\n      in_shop: '',\n      out_shop: '',\n      staff_id: '',\n      remark: '',\n      cardDate: ''\n    }\n  },\n  watch: {\n    source: {\n      handler(val) {\n        this.source = val\n        console.log(88, this.source)\n      },\n      immediate: true\n    },\n    record: {\n      handler(val) {\n        if (JSON.stringify(val) === '{}' || !val) {\n          return\n        }\n        this.shopList = val.shops\n        this.remark = val.remark\n        const dateTime = new Date(val.date)\n        let afterTime = dateTime.setDate(dateTime.getDate() + 1)\n        const finallyTime = new Date(afterTime)\n          .toLocaleDateString()\n          .replace(/\\//g, '-')\n        console.log(123, afterTime, finallyTime, val.in_time, val.out_time)\n        let timeTips = ['in_time', 'out_time']\n        timeTips.forEach(tip => {\n          if (val[tip].includes('次日')) {\n            const time = val[tip].split('次日')[1]\n            this[tip] = moment(`${finallyTime} ${time}`)\n          } else if (val[tip] && val[tip] !== '--') {\n            this[tip] = moment(`${val.date} ${val[tip]}`)\n          } else {\n            this[tip] = null\n          }\n        })\n        let in_shop =\n          val.in_shop_id && val.in_shop_id !== '--' ? val.in_shop_id : null\n        let out_shop =\n          val.out_shop_id && val.out_shop_id !== '--' ? val.out_shop_id : null\n        // 员工换门店处理\n        let isHasInShop = false\n        let isHasOutShop = false\n        for (let i = 0; i < this.shopList.length; i++) {\n          if (this.shopList[i].id === in_shop) {\n            isHasInShop = true\n          }\n          if (this.shopList[i].id === out_shop) {\n            isHasOutShop = true\n          }\n        }\n        if (isHasInShop) {\n          this.in_shop = in_shop\n        }\n        if (isHasOutShop) {\n          this.out_shop = out_shop\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  methods: {\n    moment,\n    handleShopClick() {\n      console.log(this.shopList)\n      if (this.shopList.length === 0) {\n        this.messageService.warn({\n          content: '请先输入员工信息'\n        })\n      }\n    },\n    onSubmit() {\n      const query = {\n        id: this.record.id || '0',\n        staff_id: this.staff_id || this.record.staff_id,\n        date: this.cardDate || this.record.date,\n        in_shop_id: this.in_shop,\n        in_time:\n          (this.in_time &&\n            moment(this.in_time).format('YYYY-MM-DD HH:mm:ss')) ||\n          null,\n        out_shop_id: this.out_shop,\n        out_time:\n          (this.out_time &&\n            moment(this.out_time).format('YYYY-MM-DD HH:mm:ss')) ||\n          null,\n        remark: this.remark\n      }\n      console.log('query---', query)\n      const tips = [\n        {\n          name: 'date',\n          tip: '打卡日期'\n        },\n        {\n          name: 'staff_id',\n          tip: '员工信息'\n        },\n        {\n          name: 'in_shop_id',\n          tip: '上班打卡门店'\n        },\n        {\n          name: 'in_time',\n          tip: '上班打卡时间'\n        },\n        {\n          name: 'out_shop_id',\n          tip: '下班打卡门店'\n        },\n        {\n          name: 'out_time',\n          tip: '下班打卡时间'\n        }\n      ]\n      for (let i = 0; i < tips.length; i++) {\n        if (!query[tips[i].name]) {\n          this.messageService.warn({\n            content: tips[i].tip + '不能为空'\n          })\n          return\n        }\n      }\n      query.in_time = query.in_time.slice(0, -3)\n      query.out_time = query.out_time.slice(0, -3)\n      if (query.range < 100) {\n        this.messageService.warn({\n          content: '范围不能小于100米'\n        })\n        return\n      }\n      this.cardReplacementService\n        .postAttendanceMendHandle(query)\n        .subscribe(res => {\n          this.$emit('success')\n          this.show = false\n          this.messageService.success({\n            content: '保存成功'\n          })\n        })\n    },\n    staffChange(e) {\n      this.staff_id = e\n      if (this.staff_id) {\n        this.cardReplacementService\n          .getAttendanceListHandle({ id: this.staff_id })\n          .subscribe(res => {\n            this.shopList = res.list\n            this.in_shop = ''\n            this.out_shop = ''\n          })\n      }\n    },\n    pickHandle(e) {\n      this.cardDate = moment(e).format('YYYY-MM-DD')\n    },\n    handleChange(value, tag) {\n      this[tag] = value\n    }\n  }\n}\n",{"version":3,"sources":["card-replacement.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"card-replacement.vue","sourceRoot":"src/views/biz-modals/brand/app/attendance","sourcesContent":["<template>\n  <st-modal title=\"补充打卡信息\" v-model=\"show\" width=\"500px\">\n    <st-form :form=\"form\" labelAuto :class=\"module()\">\n      <st-form-item label=\"打卡日期\">\n        <template v-if=\"source === '1'\">\n          <a-date-picker\n            placeholder=\"请选择打卡日期\"\n            style=\"width: 100%\"\n            @change=\"pickHandle\"\n          />\n        </template>\n        <template v-if=\"source === '2'\">\n          {{ record.date }}\n        </template>\n      </st-form-item>\n      <st-form-item label=\"员工信息\">\n        <template v-if=\"source === '1'\">\n          <staff-select\n            style=\"width: 100%\"\n            type=\"brand\"\n            placeholder=\"输入姓名/手机号搜索\"\n            @change=\"staffChange\"\n          ></staff-select>\n        </template>\n        <template v-if=\"source === '2'\">\n          <span class=\"name-space\">{{ record.name }}</span>\n          <span>{{ record.mobile }}</span>\n        </template>\n      </st-form-item>\n      <st-form-item label=\"上班打卡门店\">\n        <a-select\n          style=\"width: 100%\"\n          placeholder=\"请选择上班打卡门店\"\n          :value=\"in_shop\"\n          @focus=\"handleShopClick\"\n          @change=\"handleChange($event, 'in_shop')\"\n        >\n          <a-select-option v-for=\"item in shopList\" :key=\"item.id\">\n            {{ item.shop_name }}\n          </a-select-option>\n        </a-select>\n      </st-form-item>\n      <st-form-item label=\"上班打卡时间\">\n        <a-date-picker\n          v-model=\"in_time\"\n          style=\"width: 100%\"\n          :show-time=\"{ defaultValue: moment('00:00:00', 'HH:mm:ss') }\"\n          format=\"YYYY-MM-DD HH:mm:ss\"\n          placeholder=\"请选择上班打卡时间\"\n        />\n      </st-form-item>\n      <st-form-item label=\"下班打卡门店\">\n        <a-select\n          style=\"width: 100%\"\n          placeholder=\"请选择下班打卡门店\"\n          :value=\"out_shop\"\n          @focus=\"handleShopClick\"\n          @change=\"handleChange($event, 'out_shop')\"\n        >\n          <a-select-option v-for=\"item in shopList\" :key=\"item.id\">\n            {{ item.shop_name }}\n          </a-select-option>\n        </a-select>\n      </st-form-item>\n      <st-form-item label=\"下班打卡时间\">\n        <a-date-picker\n          v-model=\"out_time\"\n          style=\"width: 100%\"\n          :show-time=\"{ defaultValue: moment('00:00:00', 'HH:mm:ss') }\"\n          format=\"YYYY-MM-DD HH:mm:ss\"\n          placeholder=\"请选择下班打卡时间\"\n        />\n      </st-form-item>\n      <st-form-item label=\"备注\">\n        <st-textarea\n          placeholder=\"请输入备注内容\"\n          class=\"remark\"\n          v-model=\"remark\"\n          :maxlength=\"30\"\n        ></st-textarea>\n      </st-form-item>\n    </st-form>\n    <template slot=\"footer\">\n      <st-button @click=\"show = false\">取消</st-button>\n      <st-button\n        @click=\"onSubmit\"\n        type=\"primary\"\n        :loading=\"loading.postAttendanceMendHandle\"\n      >\n        保存\n      </st-button>\n    </template>\n  </st-modal>\n</template>\n<script>\nimport StaffSelect from '@/views/biz-components/staff-select/staff-select'\nimport { CardReplacementService } from './card-replacement.service'\nimport moment from 'moment'\nimport { cloneDeep } from 'lodash-es'\nimport tipVue from '@/views/pages/brand/marketing/plugin/coupon/tip.vue'\nimport { MessageService } from '@/services/message.service'\nexport default {\n  bem: {\n    module: 'brand-app-attendance-card-replacement'\n  },\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      cardReplacementService: CardReplacementService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.cardReplacementService.loading$\n    }\n  },\n  components: { StaffSelect },\n  name: 'newLable',\n  props: {\n    // 1-table btn,2-单员工补卡\n    source: {\n      type: String,\n      default: '0'\n    },\n    record: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    }\n  },\n  data() {\n    return {\n      show: false,\n      form: this.$form.createForm(this, { name: 'coordinated' }),\n      shopList: [],\n      in_time: null,\n      out_time: null,\n      in_shop: '',\n      out_shop: '',\n      staff_id: '',\n      remark: '',\n      cardDate: ''\n    }\n  },\n  watch: {\n    source: {\n      handler(val) {\n        this.source = val\n        console.log(88, this.source)\n      },\n      immediate: true\n    },\n    record: {\n      handler(val) {\n        if (JSON.stringify(val) === '{}' || !val) {\n          return\n        }\n        this.shopList = val.shops\n        this.remark = val.remark\n        const dateTime = new Date(val.date)\n        let afterTime = dateTime.setDate(dateTime.getDate() + 1)\n        const finallyTime = new Date(afterTime)\n          .toLocaleDateString()\n          .replace(/\\//g, '-')\n        console.log(123, afterTime, finallyTime, val.in_time, val.out_time)\n        let timeTips = ['in_time', 'out_time']\n        timeTips.forEach(tip => {\n          if (val[tip].includes('次日')) {\n            const time = val[tip].split('次日')[1]\n            this[tip] = moment(`${finallyTime} ${time}`)\n          } else if (val[tip] && val[tip] !== '--') {\n            this[tip] = moment(`${val.date} ${val[tip]}`)\n          } else {\n            this[tip] = null\n          }\n        })\n        let in_shop =\n          val.in_shop_id && val.in_shop_id !== '--' ? val.in_shop_id : null\n        let out_shop =\n          val.out_shop_id && val.out_shop_id !== '--' ? val.out_shop_id : null\n        // 员工换门店处理\n        let isHasInShop = false\n        let isHasOutShop = false\n        for (let i = 0; i < this.shopList.length; i++) {\n          if (this.shopList[i].id === in_shop) {\n            isHasInShop = true\n          }\n          if (this.shopList[i].id === out_shop) {\n            isHasOutShop = true\n          }\n        }\n        if (isHasInShop) {\n          this.in_shop = in_shop\n        }\n        if (isHasOutShop) {\n          this.out_shop = out_shop\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  methods: {\n    moment,\n    handleShopClick() {\n      console.log(this.shopList)\n      if (this.shopList.length === 0) {\n        this.messageService.warn({\n          content: '请先输入员工信息'\n        })\n      }\n    },\n    onSubmit() {\n      const query = {\n        id: this.record.id || '0',\n        staff_id: this.staff_id || this.record.staff_id,\n        date: this.cardDate || this.record.date,\n        in_shop_id: this.in_shop,\n        in_time:\n          (this.in_time &&\n            moment(this.in_time).format('YYYY-MM-DD HH:mm:ss')) ||\n          null,\n        out_shop_id: this.out_shop,\n        out_time:\n          (this.out_time &&\n            moment(this.out_time).format('YYYY-MM-DD HH:mm:ss')) ||\n          null,\n        remark: this.remark\n      }\n      console.log('query---', query)\n      const tips = [\n        {\n          name: 'date',\n          tip: '打卡日期'\n        },\n        {\n          name: 'staff_id',\n          tip: '员工信息'\n        },\n        {\n          name: 'in_shop_id',\n          tip: '上班打卡门店'\n        },\n        {\n          name: 'in_time',\n          tip: '上班打卡时间'\n        },\n        {\n          name: 'out_shop_id',\n          tip: '下班打卡门店'\n        },\n        {\n          name: 'out_time',\n          tip: '下班打卡时间'\n        }\n      ]\n      for (let i = 0; i < tips.length; i++) {\n        if (!query[tips[i].name]) {\n          this.messageService.warn({\n            content: tips[i].tip + '不能为空'\n          })\n          return\n        }\n      }\n      query.in_time = query.in_time.slice(0, -3)\n      query.out_time = query.out_time.slice(0, -3)\n      if (query.range < 100) {\n        this.messageService.warn({\n          content: '范围不能小于100米'\n        })\n        return\n      }\n      this.cardReplacementService\n        .postAttendanceMendHandle(query)\n        .subscribe(res => {\n          this.$emit('success')\n          this.show = false\n          this.messageService.success({\n            content: '保存成功'\n          })\n        })\n    },\n    staffChange(e) {\n      this.staff_id = e\n      if (this.staff_id) {\n        this.cardReplacementService\n          .getAttendanceListHandle({ id: this.staff_id })\n          .subscribe(res => {\n            this.shopList = res.list\n            this.in_shop = ''\n            this.out_shop = ''\n          })\n      }\n    },\n    pickHandle(e) {\n      this.cardDate = moment(e).format('YYYY-MM-DD')\n    },\n    handleChange(value, tag) {\n      this[tag] = value\n    }\n  }\n}\n</script>\n\n<style lang=\"less\">\n.brand-app-attendance-card-replacement {\n  .staff-select .ant-select-selection {\n    background-color: #fff;\n    border: 1px solid #cdd4df;\n  }\n  .staff-select .ant-select-selection:hover {\n    border-color: #6b90ff;\n  }\n  .ant-select-focused .ant-select-selection,\n  .ant-select-selection:active,\n  .ant-select-selection:focus {\n    border-color: #6b90ff;\n    box-shadow: 0 0 0 2px rgba(63, 102, 246, 0.2);\n  }\n  .ant-form-item {\n    margin-bottom: 20px;\n  }\n  .member-select {\n    border-radius: 0;\n    background: #fff;\n  }\n  .staff-select {\n    background: #fff;\n  }\n  .remark {\n    height: 76px;\n  }\n  .name-space {\n    margin-right: 24px;\n  }\n}\n</style>\n"]}]}