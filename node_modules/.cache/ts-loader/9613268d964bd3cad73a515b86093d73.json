{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/course/team/list.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/course/team/list.service.ts","mtime":1591147717339},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b, _c;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { ShopApi } from '@/api/v1/shop';\nimport { Injectable } from 'vue-service-app';\nimport { State } from 'rx-state';\nimport { tap, map } from 'rxjs/operators';\nimport { forkJoin } from 'rxjs';\nimport { AuthService } from '@/services/auth.service';\nimport { CourseApi } from '@/api/v1/special/course';\n\nvar ListService = /*#__PURE__*/function () {\n  function ListService(shopApi, courseApi, authService) {\n    _classCallCheck(this, ListService);\n\n    this.shopApi = shopApi;\n    this.courseApi = courseApi;\n    this.authService = authService;\n    this.categoryList$ = new State([]);\n    this.shopSelectOptions$ = new State([]);\n    this.authTabs$ = this.authService.getAuthTabs$('brand-product-course-team-list');\n  }\n\n  _createClass(ListService, [{\n    key: \"getCategoryList\",\n    value: function getCategoryList() {\n      var _this = this;\n\n      return this.courseApi.getCourseCategoryList({}).pipe(map(function (res) {\n        var list = res.list;\n        return [{\n          value: -1,\n          label: '全部课程类型'\n        }].concat(_toConsumableArray(list.map(function (item) {\n          var id = item.id,\n              setting_name = item.setting_name;\n          return {\n            label: setting_name,\n            value: id\n          };\n        })));\n      }), tap(function (state) {\n        _this.categoryList$.commit(function () {\n          return state;\n        });\n      }));\n    }\n  }, {\n    key: \"getShopList\",\n    value: function getShopList() {\n      var _this2 = this;\n\n      return this.shopApi.getShopListForSelect().pipe(map(function (res) {\n        var list = res.shops.map(function (item) {\n          return {\n            label: item.shop_name,\n            value: item.id\n          };\n        });\n        return [{\n          label: '全部门店',\n          value: -1\n        }].concat(_toConsumableArray(list));\n      }), tap(function (state) {\n        _this2.shopSelectOptions$.commit(function () {\n          return state;\n        });\n      }));\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      return forkJoin(this.getShopList(), this.getCategoryList());\n    }\n  }, {\n    key: \"redirect\",\n    value: function redirect(to, from, next) {\n      if (to.name === 'brand-product-course-team-list') {\n        next({\n          name: 'brand-product-course-team-list-brand'\n        });\n      } else {\n        next();\n      }\n    }\n  }, {\n    key: \"beforeRouteEnter\",\n    value: function beforeRouteEnter(to, from, next) {\n      var _this3 = this;\n\n      this.init().subscribe(function () {\n        _this3.redirect(to, from, next);\n      });\n    }\n  }, {\n    key: \"beforeRouteUpdate\",\n    value: function beforeRouteUpdate(to, from, next) {\n      this.redirect(to, from, next);\n    }\n  }]);\n\n  return ListService;\n}();\n\nListService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof ShopApi !== \"undefined\" && ShopApi) === \"function\" ? _a : Object, typeof (_b = typeof CourseApi !== \"undefined\" && CourseApi) === \"function\" ? _b : Object, typeof (_c = typeof AuthService !== \"undefined\" && AuthService) === \"function\" ? _c : Object])], ListService);\nexport { ListService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/course/team/list.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { ShopApi } from '@/api/v1/shop'\nimport { Controller, ServiceRoute, Injectable } from 'vue-service-app'\nimport { State } from 'rx-state'\nimport { tap, map } from 'rxjs/operators'\nimport { forkJoin } from 'rxjs'\nimport { AuthService } from '@/services/auth.service'\nimport { CourseApi } from '@/api/v1/special/course'\n\n@Injectable()\nexport class ListService implements Controller {\n  categoryList$ = new State<any[]>([])\n  shopSelectOptions$ = new State<any[]>([])\n  authTabs$ = this.authService.getAuthTabs$('brand-product-course-team-list')\n  constructor(\n    private shopApi: ShopApi,\n    private courseApi: CourseApi,\n    private authService: AuthService\n  ) {}\n  getCategoryList() {\n    return this.courseApi.getCourseCategoryList({}).pipe(\n      map(res => {\n        const list = res.list\n        return [\n          { value: -1, label: '全部课程类型' },\n          ...list.map((item: any) => {\n            const { id, setting_name } = item\n            return {\n              label: setting_name,\n              value: id\n            }\n          })\n        ]\n      }),\n      tap(state => {\n        this.categoryList$.commit(() => state)\n      })\n    )\n  }\n  getShopList() {\n    return this.shopApi.getShopListForSelect().pipe(\n      map(res => {\n        const list = res.shops.map((item: any) => {\n          return { label: item.shop_name, value: item.id }\n        })\n        return [{ label: '全部门店', value: -1 }, ...list]\n      }),\n      tap(state => {\n        this.shopSelectOptions$.commit(() => state)\n      })\n    )\n  }\n  init() {\n    return forkJoin(this.getShopList(), this.getCategoryList())\n  }\n  redirect(to: ServiceRoute, from: ServiceRoute, next: any) {\n    if (to.name === 'brand-product-course-team-list') {\n      next({\n        name: 'brand-product-course-team-list-brand'\n      })\n    } else {\n      next()\n    }\n  }\n  beforeRouteEnter(to: ServiceRoute, from: ServiceRoute, next: any) {\n    this.init().subscribe(() => {\n      this.redirect(to, from, next)\n    })\n  }\n  beforeRouteUpdate(to: ServiceRoute, from: ServiceRoute, next: any) {\n    this.redirect(to, from, next)\n  }\n}\n"],"sourceRoot":""}]}