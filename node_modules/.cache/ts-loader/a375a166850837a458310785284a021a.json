{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/services/qq-map.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/services/qq-map.service.ts","mtime":1600926555629},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { Injectable } from 'vue-service-app';\nimport { Observable } from 'rxjs';\nimport { AppConfig } from '@/constants/config';\n/**\n * 腾讯地图\n */\n\nvar QqMapService = /*#__PURE__*/function () {\n  function QqMapService(appConfig) {\n    _classCallCheck(this, QqMapService);\n\n    this.appConfig = appConfig;\n    this.isCreated = false;\n    this.lat = null;\n    this.lng = null;\n    this.mapObject = null;\n    this.markerObject = null;\n  }\n\n  _createClass(QqMapService, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      this.lat = params.lat;\n      this.lng = params.lng;\n      return new Promise(function (resolve) {\n        if (!_this.isCreated) {\n          _this.create().then(function () {\n            _this.initMap();\n\n            resolve();\n          });\n        } else {\n          _this.initMap();\n\n          resolve();\n        }\n      });\n    }\n  }, {\n    key: \"create\",\n    value: function create() {\n      var _this2 = this;\n\n      return new Promise(function (resolve) {\n        // @ts-ignore\n        window.initQqMap = function () {\n          _this2.isCreated = true;\n          resolve();\n        };\n\n        var script = document.createElement('script');\n        script.src = \"https://map.qq.com/api/js?v=2.exp&key=\".concat(_this2.appConfig.QQ_MAP_KEY, \"&libraries=place&callback=initQqMap\"); // @ts-ignore\n\n        document.head.appendChild(script);\n      });\n    }\n    /**\n     * 实例化地图\n     */\n\n  }, {\n    key: \"initMap\",\n    value: function initMap() {\n      // @ts-ignore\n      var center = new qq.maps.LatLng(this.lat, this.lng); // @ts-ignore\n\n      this.mapObject = new qq.maps.Map(document.getElementById('mapcontainer'), {\n        center: center,\n        zoom: 13,\n        disableDefaultUI: true\n      });\n      this.resetMap(center);\n    }\n    /**\n     * 重置地图\n     * @param position\n     */\n\n  }, {\n    key: \"resetMap\",\n    value: function resetMap(position) {\n      console.log('reset', position); // @ts-ignore\n\n      var anchor = new qq.maps.Point(8, 16); // @ts-ignore\n\n      var size = new qq.maps.Size(16, 16); // @ts-ignore\n\n      var origin = new qq.maps.Point(0, 0); // @ts-ignore\n\n      var icon = new qq.maps.MarkerImage(require('@/assets/img/map_location.png'), size, origin, anchor, size); // @ts-ignore\n\n      this.markerObject && this.markerObject.setMap(null); // @ts-ignore\n\n      this.markerObject = new qq.maps.Marker({\n        position: position,\n        icon: icon,\n        // @ts-ignore\n        animation: qq.maps.MarkerAnimation.DROP,\n        map: this.mapObject\n      }); // @ts-ignore\n\n      this.mapObject.panTo(position);\n    }\n  }, {\n    key: \"getLocation\",\n    value: function getLocation(url) {\n      var index = 0;\n      var o$ = new Observable(function (observer) {\n        index++;\n        var key = '__jsonp_callback' + index;\n        var script = document.createElement('script');\n        script.src = url + key;\n\n        script.onerror = function (err) {\n          return observer.error(err);\n        }; // @ts-ignore\n\n\n        window[key] = function (response) {\n          // @ts-ignore\n          script.parentNode.removeChild(script); // @ts-ignore\n\n          delete window[key];\n          observer.next(response);\n          observer.complete();\n        };\n\n        document.getElementsByTagName('head')[0].appendChild(script);\n        index = 0;\n      });\n      return o$;\n    }\n  }]);\n\n  return QqMapService;\n}();\n\nQqMapService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof AppConfig !== \"undefined\" && AppConfig) === \"function\" ? _a : Object])], QqMapService);\nexport { QqMapService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/services/qq-map.service.ts"],"names":[],"mappings":";;;;;;AAAA,SAAS,UAAT,QAA2B,iBAA3B;AACA,SAAS,UAAT,QAA2B,MAA3B;AACA,SAAS,SAAT,QAA0B,oBAA1B;AAEA;;;;AAIA,IAAa,YAAb;AAME,wBAAoB,SAApB,EAAwC;AAAA;;AAApB,SAAA,SAAA,GAAA,SAAA;AALpB,SAAA,SAAA,GAAY,KAAZ;AACA,SAAA,GAAA,GAAM,IAAN;AACA,SAAA,GAAA,GAAM,IAAN;AACA,SAAA,SAAA,GAAY,IAAZ;AACA,SAAA,YAAA,GAAe,IAAf;AAC4C;;AAN9C;AAAA;AAAA,2BAOuB;AAAA;;AAAA,UAAhB,MAAgB,uEAAF,EAAE;AACnB,WAAK,GAAL,GAAW,MAAM,CAAC,GAAlB;AACA,WAAK,GAAL,GAAW,MAAM,CAAC,GAAlB;AACA,aAAO,IAAI,OAAJ,CAAY,UAAA,OAAO,EAAG;AAC3B,YAAI,CAAC,KAAI,CAAC,SAAV,EAAqB;AACnB,UAAA,KAAI,CAAC,MAAL,GAAc,IAAd,CAAmB,YAAK;AACtB,YAAA,KAAI,CAAC,OAAL;;AACA,YAAA,OAAO;AACR,WAHD;AAID,SALD,MAKO;AACL,UAAA,KAAI,CAAC,OAAL;;AACA,UAAA,OAAO;AACR;AACF,OAVM,CAAP;AAWD;AArBH;AAAA;AAAA,6BAsBQ;AAAA;;AACJ,aAAO,IAAI,OAAJ,CAAY,UAAA,OAAO,EAAG;AAC3B;AACA,QAAA,MAAM,CAAC,SAAP,GAAmB,YAAK;AACtB,UAAA,MAAI,CAAC,SAAL,GAAiB,IAAjB;AACA,UAAA,OAAO;AACR,SAHD;;AAIA,YAAM,MAAM,GAAG,QAAQ,CAAC,aAAT,CAAuB,QAAvB,CAAf;AACA,QAAA,MAAM,CAAC,GAAP,mDAAsD,MAAI,CAAC,SAAL,CAAe,UAArE,yCAP2B,CAQ3B;;AACA,QAAA,QAAQ,CAAC,IAAT,CAAc,WAAd,CAA0B,MAA1B;AACD,OAVM,CAAP;AAWD;AACD;;;;AAnCF;AAAA;AAAA,8BAsCS;AACL;AACA,UAAI,MAAM,GAAG,IAAI,EAAE,CAAC,IAAH,CAAQ,MAAZ,CAAmB,KAAK,GAAxB,EAA6B,KAAK,GAAlC,CAAb,CAFK,CAGL;;AACA,WAAK,SAAL,GAAiB,IAAI,EAAE,CAAC,IAAH,CAAQ,GAAZ,CAAgB,QAAQ,CAAC,cAAT,CAAwB,cAAxB,CAAhB,EAAyD;AACxE,QAAA,MAAM,EAAN,MADwE;AAExE,QAAA,IAAI,EAAE,EAFkE;AAGxE,QAAA,gBAAgB,EAAE;AAHsD,OAAzD,CAAjB;AAKA,WAAK,QAAL,CAAc,MAAd;AACD;AACD;;;;;AAjDF;AAAA;AAAA,6BAqDW,QArDX,EAqDwB;AACpB,MAAA,OAAO,CAAC,GAAR,CAAY,OAAZ,EAAqB,QAArB,EADoB,CAEpB;;AACA,UAAI,MAAM,GAAG,IAAI,EAAE,CAAC,IAAH,CAAQ,KAAZ,CAAkB,CAAlB,EAAqB,EAArB,CAAb,CAHoB,CAIpB;;AACA,UAAI,IAAI,GAAG,IAAI,EAAE,CAAC,IAAH,CAAQ,IAAZ,CAAiB,EAAjB,EAAqB,EAArB,CAAX,CALoB,CAMpB;;AACA,UAAI,MAAM,GAAG,IAAI,EAAE,CAAC,IAAH,CAAQ,KAAZ,CAAkB,CAAlB,EAAqB,CAArB,CAAb,CAPoB,CAQpB;;AACA,UAAI,IAAI,GAAG,IAAI,EAAE,CAAC,IAAH,CAAQ,WAAZ,CACT,OAAO,CAAC,+BAAD,CADE,EAET,IAFS,EAGT,MAHS,EAIT,MAJS,EAKT,IALS,CAAX,CAToB,CAgBpB;;AACA,WAAK,YAAL,IAAqB,KAAK,YAAL,CAAkB,MAAlB,CAAyB,IAAzB,CAArB,CAjBoB,CAkBpB;;AACA,WAAK,YAAL,GAAoB,IAAI,EAAE,CAAC,IAAH,CAAQ,MAAZ,CAAmB;AACrC,QAAA,QAAQ,EAAR,QADqC;AAErC,QAAA,IAAI,EAAE,IAF+B;AAGrC;AACA,QAAA,SAAS,EAAE,EAAE,CAAC,IAAH,CAAQ,eAAR,CAAwB,IAJE;AAKrC,QAAA,GAAG,EAAE,KAAK;AAL2B,OAAnB,CAApB,CAnBoB,CA0BpB;;AACA,WAAK,SAAL,CAAe,KAAf,CAAqB,QAArB;AACD;AAjFH;AAAA;AAAA,gCAkFc,GAlFd,EAkFyB;AACrB,UAAI,KAAK,GAAG,CAAZ;AACA,UAAI,EAAE,GAAG,IAAI,UAAJ,CAAe,UAAA,QAAQ,EAAG;AACjC,QAAA,KAAK;AACL,YAAM,GAAG,GAAG,qBAAqB,KAAjC;AACA,YAAM,MAAM,GAAG,QAAQ,CAAC,aAAT,CAAuB,QAAvB,CAAf;AACA,QAAA,MAAM,CAAC,GAAP,GAAa,GAAG,GAAG,GAAnB;;AACA,QAAA,MAAM,CAAC,OAAP,GAAiB,UAAA,GAAG;AAAA,iBAAI,QAAQ,CAAC,KAAT,CAAe,GAAf,CAAJ;AAAA,SAApB,CALiC,CAMjC;;;AACA,QAAA,MAAM,CAAC,GAAD,CAAN,GAAc,UAAC,QAAD,EAAkB;AAC9B;AACA,UAAA,MAAM,CAAC,UAAP,CAAkB,WAAlB,CAA8B,MAA9B,EAF8B,CAG9B;;AACA,iBAAO,MAAM,CAAC,GAAD,CAAb;AACA,UAAA,QAAQ,CAAC,IAAT,CAAc,QAAd;AACA,UAAA,QAAQ,CAAC,QAAT;AACD,SAPD;;AASA,QAAA,QAAQ,CAAC,oBAAT,CAA8B,MAA9B,EAAsC,CAAtC,EAAyC,WAAzC,CAAqD,MAArD;AACA,QAAA,KAAK,GAAG,CAAR;AACD,OAlBQ,CAAT;AAmBA,aAAO,EAAP;AACD;AAxGH;;AAAA;AAAA,GAAA;;AAAa,YAAY,GAAA,UAAA,CAAA,CADxB,UAAU,EACc,E,qDAMQ,S,KAAS,W,IAAT,S,MAAS,U,GAAA,E,GAAA,M,EANjB,CAAA,EAAZ,YAAY,CAAZ;SAAA,Y","sourcesContent":["import { Injectable } from 'vue-service-app'\nimport { Observable } from 'rxjs'\nimport { AppConfig } from '@/constants/config'\n\n/**\n * 腾讯地图\n */\n@Injectable()\nexport class QqMapService {\n  isCreated = false\n  lat = null\n  lng = null\n  mapObject = null\n  markerObject = null\n  constructor(private appConfig: AppConfig) {}\n  init(params: any = {}) {\n    this.lat = params.lat\n    this.lng = params.lng\n    return new Promise(resolve => {\n      if (!this.isCreated) {\n        this.create().then(() => {\n          this.initMap()\n          resolve()\n        })\n      } else {\n        this.initMap()\n        resolve()\n      }\n    })\n  }\n  create() {\n    return new Promise(resolve => {\n      // @ts-ignore\n      window.initQqMap = () => {\n        this.isCreated = true\n        resolve()\n      }\n      const script = document.createElement('script')\n      script.src = `https://map.qq.com/api/js?v=2.exp&key=${this.appConfig.QQ_MAP_KEY}&libraries=place&callback=initQqMap`\n      // @ts-ignore\n      document.head.appendChild(script)\n    })\n  }\n  /**\n   * 实例化地图\n   */\n  initMap() {\n    // @ts-ignore\n    let center = new qq.maps.LatLng(this.lat, this.lng)\n    // @ts-ignore\n    this.mapObject = new qq.maps.Map(document.getElementById('mapcontainer'), {\n      center,\n      zoom: 13,\n      disableDefaultUI: true\n    })\n    this.resetMap(center)\n  }\n  /**\n   * 重置地图\n   * @param position\n   */\n  resetMap(position: any) {\n    console.log('reset', position)\n    // @ts-ignore\n    let anchor = new qq.maps.Point(8, 16)\n    // @ts-ignore\n    let size = new qq.maps.Size(16, 16)\n    // @ts-ignore\n    let origin = new qq.maps.Point(0, 0)\n    // @ts-ignore\n    let icon = new qq.maps.MarkerImage(\n      require('@/assets/img/map_location.png'),\n      size,\n      origin,\n      anchor,\n      size\n    )\n    // @ts-ignore\n    this.markerObject && this.markerObject.setMap(null)\n    // @ts-ignore\n    this.markerObject = new qq.maps.Marker({\n      position,\n      icon: icon,\n      // @ts-ignore\n      animation: qq.maps.MarkerAnimation.DROP,\n      map: this.mapObject\n    })\n    // @ts-ignore\n    this.mapObject.panTo(position)\n  }\n  getLocation(url: string) {\n    let index = 0\n    let o$ = new Observable(observer => {\n      index++\n      const key = '__jsonp_callback' + index\n      const script = document.createElement('script')\n      script.src = url + key\n      script.onerror = err => observer.error(err)\n      // @ts-ignore\n      window[key] = (response: any) => {\n        // @ts-ignore\n        script.parentNode.removeChild(script)\n        // @ts-ignore\n        delete window[key]\n        observer.next(response)\n        observer.complete()\n      }\n\n      document.getElementsByTagName('head')[0].appendChild(script)\n      index = 0\n    })\n    return o$\n  }\n}\n"],"sourceRoot":""}]}