{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/package/form/form-item#/reserve-course.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/package/form/form-item#/reserve-course.vue","mtime":1600926555704},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { columns, dataSource } from \"./reserve-course.config\";\nimport SelectCourse from '@/views/biz-modals/package/select-course';\nexport default {\n  name: 'CourseSelectFormItem',\n  inject: ['form'],\n  data: function data() {\n    return {\n      visible: false,\n      cacheCoachId: -1,\n      dataSource: []\n    };\n  },\n  modals: {\n    SelectCourse: SelectCourse\n  },\n  props: {\n    courseType: {\n      type: String,\n      default: 'team'\n    },\n    initDataSource: {\n      type: Array,\n      default: function _default() {}\n    }\n  },\n  watch: {\n    dataSource: {\n      handler: function handler(newValue) {\n        var _this = this;\n\n        var course = newValue.map(function (item) {\n          var course_id = item.course_id,\n              course_name = item.course_name,\n              course_times = item.course_times,\n              course_unit_price = item.course_unit_price,\n              reduce_times = item.reduce_times,\n              coach_level_ids = item.coach_level_ids;\n          return _this.courseType === 'team' ? {\n            course_id: course_id,\n            course_name: course_name,\n            course_times: course_times,\n            course_unit_price: course_unit_price,\n            reduce_times: reduce_times\n          } : {\n            course_id: course_id,\n            course_name: course_name,\n            course_times: course_times,\n            course_unit_price: course_unit_price,\n            reduce_times: reduce_times,\n            coach_level_ids: coach_level_ids\n          };\n        });\n        this.$emit('change', course);\n      },\n      deep: true\n    }\n  },\n  computed: {\n    pagination: function pagination() {\n      var _this2 = this;\n\n      return {\n        total: this.courseList.length,\n        pageSize: 20,\n        pageSizeOptions: ['10', '20', '30', '40'],\n        showSizeChanger: true,\n        showTotal: function showTotal() {\n          return \"\\u5171\".concat(_this2.courseList.length, \"\\u6761\");\n        }\n      };\n    },\n    isShop$: function isShop$() {\n      return this.form.isShop$;\n    },\n    singleShops: function singleShops() {\n      return [this.$route.query.app_shop_id];\n    },\n    packageAttr: function packageAttr() {\n      return this.form.packageAttr;\n    },\n    allCoachLevelIds: function allCoachLevelIds() {\n      return this.form.coachList.map(function (ele) {\n        return ele.value;\n      });\n    },\n    formVueData: function formVueData() {\n      return this.form.form;\n    },\n    useRange: function useRange() {\n      return this.isShop$ ? 1 : this.form.useRange;\n    },\n    columns: columns,\n    courseList: function courseList() {\n      return _toConsumableArray(this.dataSource);\n    }\n  },\n  methods: {\n    // 应用到本页\n    onBatchCoachLevel: function onBatchCoachLevel(ids) {\n      var _this3 = this;\n\n      this.dataSource = this.dataSource.map(function (item) {\n        _this3.$set(item, 'coach_level_ids', ids);\n\n        _this3.$set(item, 'coachLevelName', _this3.getCoachLevelName(ids));\n\n        return item;\n      });\n    },\n    // 返回教练等级名用于列表展示\n    getCoachLevelName: function getCoachLevelName(ids) {\n      if (ids.length === this.form.coachList.length) return '全部等级';\n      return this.form.coachList.filter(function (item) {\n        return ids.includes(item.value);\n      }).map(function (item) {\n        return item.label;\n      }).toString();\n    },\n    onChangeCoachLevel: function onChangeCoachLevel(record, $event) {\n      // 当教练只剩下一个的时候，缓存教练，变化到零的时候再次添加进去\n      if (record.coach_level_ids.length === 1) {\n        this.cacheCoachId = $event;\n      } // 为零就补进去\n\n\n      if (record.coach_level_ids.length === 0) {\n        this.$set(record, 'coach_level_ids', this.cacheCoachId);\n      }\n\n      this.$set(record, 'coachLevelName', this.getCoachLevelName($event));\n    },\n    onBatchReserve: function onBatchReserve(value) {\n      var _this4 = this;\n\n      this.dataSource = this.dataSource.map(function (item) {\n        _this4.$set(item, 'reduce_times', value);\n\n        return item;\n      });\n    },\n    onDelete: function onDelete(record) {\n      this.dataSource = this.dataSource.filter(function (item) {\n        return !(item.course_id === record.course_id);\n      });\n    },\n    openModal: function openModal() {\n      var _this5 = this;\n\n      var dataSource = this.dataSource,\n          courseType = this.courseType,\n          useRange = this.useRange,\n          formVueData = this.formVueData;\n      var title = courseType === 'team' ? '选择支持预约的团体课' : '选择支持预约的私教课';\n      var useShopList = useRange === 1 ? this.singleShops : formVueData.getFieldValue('use_shop_list');\n      this.$modalRouter.push({\n        name: 'select-course',\n        props: {\n          initDataSource: dataSource,\n          title: title,\n          useRange: useRange,\n          courseType: this.courseType,\n          useShopList: useShopList\n        },\n        on: {\n          done: function done(courseList) {\n            _this5.dataSource = _this5.courseType === 'team' ? courseList : courseList.map(function (item) {\n              _this5.$set(item, 'coach_level_ids', _this5.allCoachLevelIds);\n\n              return item;\n            });\n            _this5.dataSource = _this5.dataSource.map(function (item) {\n              !item.reduce_times && _this5.$set(item, 'reduce_times', 1);\n              return item;\n            });\n          }\n        }\n      });\n    },\n    handleAdd: function handleAdd() {\n      this.openModal();\n    }\n  },\n  mounted: function mounted() {\n    this.dataSource = this.initDataSource;\n  }\n};",{"version":3,"sources":["reserve-course.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div\n    class=\"biz-package-form__course-select\"\n    :class=\"{ 'package-fix__course-list': packageAttr === 3 }\"\n  >\n    <st-form-table>\n      <thead>\n        <tr>\n          <th :width=\"item.width\" :key=\"item.dataIndex\" v-for=\"item in columns\">\n            {{ item.title }}\n          </th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td\n            :class=\"\n              courseList.length === 0\n                ? 'biz-package-form__has-not-data'\n                : 'has-data'\n            \"\n            :colspan=\"columns.length\"\n            class=\"st-form-table__add\"\n          >\n            <st-button\n              type=\"dashed\"\n              icon=\"add\"\n              @click=\"handleAdd\"\n              class=\"biz-package-form__course-select-button\"\n            >\n              {{\n                courseType === 'team'\n                  ? '选择支持预约的团体课'\n                  : '选择支持预约的私教课'\n              }}\n            </st-button>\n          </td>\n        </tr>\n\n        <tr style=\"background-color: #fff;\">\n          <td\n            v-if=\"courseList.length\"\n            style=\"padding: 0;\"\n            :colspan=\"columns.length\"\n          >\n            <!-- 为什么不使用st-table 因为使用它翻到第二页输入表单会跳到第一页 -->\n            <a-table\n              pageMode=\"client\"\n              :class=\"{\n                'biz-package-form__has-data': courseList.length\n              }\"\n              :pagination=\"pagination\"\n              class=\"biz-package-form__course-select-table\"\n              rowKey=\"course_id\"\n              :columns=\"columns\"\n              :dataSource=\"courseList\"\n            >\n              <!-- 教练等级 私教-->\n              <template slot=\"coach_level_ids\" slot-scope=\"text, record\">\n                <a-popover\n                  v-model=\"record.visible\"\n                  placement=\"bottom\"\n                  trigger=\"click\"\n                >\n                  <a-checkbox-group\n                    slot=\"content\"\n                    @change=\"onChangeCoachLevel(record, $event)\"\n                    v-model=\"record.coach_level_ids\"\n                  >\n                    <ul>\n                      <li\n                        class=\"mg-b8\"\n                        v-for=\"item in form.coachList\"\n                        :key=\"item.value\"\n                      >\n                        <a-checkbox :value=\"item.value\">\n                          {{ item.label }}\n                        </a-checkbox>\n                      </li>\n                    </ul>\n                    <div>\n                      <a @click=\"onBatchCoachLevel(record.coach_level_ids)\">\n                        复制到全部\n                      </a>\n                    </div>\n                  </a-checkbox-group>\n                  <a href=\"\">\n                    {{ record.coachLevelName || '全部等级' }}\n                    <st-icon class=\"icon-12\" type=\"down-small\" />\n                  </a>\n                </a-popover>\n              </template>\n              <!-- 预约课程扣除次数 范围内限次-->\n              <template slot=\"reduce_times\" slot-scope=\"text, record\">\n                <st-input-number\n                  v-model=\"record.reduce_times\"\n                  style=\"width: 114px\"\n                >\n                  <template slot=\"addonAfter\">次</template>\n                </st-input-number>\n                <a class=\"mg-l4\" @click=\"onBatchReserve(record.reduce_times)\">\n                  复制到全部\n                </a>\n              </template>\n              <!-- 参考单价/元  固定课程-->\n              <template slot=\"course_unit_price\" slot-scope=\"text, record\">\n                <st-input-number v-model=\"record.course_unit_price\">\n                  <template slot=\"addonAfter\" style=\"width: 114px\">元</template>\n                </st-input-number>\n              </template>\n              <!-- 课程次数 固定课程 -->\n              <template slot=\"course_times\" slot-scope=\"text, record\">\n                <st-input-number\n                  v-model=\"record.course_times\"\n                  style=\"width: 114px\"\n                >\n                  <template slot=\"addonAfter\">次</template>\n                </st-input-number>\n              </template>\n              <st-table-actions slot=\"action\" slot-scope=\"text, record\">\n                <a @click=\"onDelete(record)\">\n                  删除\n                </a>\n              </st-table-actions>\n            </a-table>\n          </td>\n        </tr>\n      </tbody>\n    </st-form-table>\n  </div>\n</template>\n\n<script>\nimport { columns, dataSource } from './reserve-course.config'\nimport SelectCourse from '@/views/biz-modals/package/select-course'\nexport default {\n  name: 'CourseSelectFormItem',\n  inject: ['form'],\n  data() {\n    return {\n      visible: false,\n      cacheCoachId: -1,\n      dataSource: []\n    }\n  },\n  modals: {\n    SelectCourse\n  },\n  props: {\n    courseType: {\n      type: String,\n      default: 'team'\n    },\n    initDataSource: {\n      type: Array,\n      default: () => {}\n    }\n  },\n  watch: {\n    dataSource: {\n      handler(newValue) {\n        const course = newValue.map(item => {\n          const {\n            course_id,\n            course_name,\n            course_times,\n            course_unit_price,\n            reduce_times,\n            coach_level_ids\n          } = item\n\n          return this.courseType === 'team'\n            ? {\n                course_id,\n                course_name,\n                course_times,\n                course_unit_price,\n                reduce_times\n              }\n            : {\n                course_id,\n                course_name,\n                course_times,\n                course_unit_price,\n                reduce_times,\n                coach_level_ids\n              }\n        })\n        this.$emit('change', course)\n      },\n      deep: true\n    }\n  },\n  computed: {\n    pagination() {\n      return {\n        total: this.courseList.length,\n        pageSize: 20,\n        pageSizeOptions: ['10', '20', '30', '40'],\n        showSizeChanger: true,\n        showTotal: () => `共${this.courseList.length}条`\n      }\n    },\n    isShop$() {\n      return this.form.isShop$\n    },\n    singleShops() {\n      return [this.$route.query.app_shop_id]\n    },\n    packageAttr() {\n      return this.form.packageAttr\n    },\n    allCoachLevelIds() {\n      return this.form.coachList.map(ele => ele.value)\n    },\n    formVueData() {\n      return this.form.form\n    },\n    useRange() {\n      return this.isShop$ ? 1 : this.form.useRange\n    },\n    columns,\n    courseList() {\n      return [...this.dataSource]\n    }\n  },\n  methods: {\n    // 应用到本页\n    onBatchCoachLevel(ids) {\n      this.dataSource = this.dataSource.map(item => {\n        this.$set(item, 'coach_level_ids', ids)\n        this.$set(item, 'coachLevelName', this.getCoachLevelName(ids))\n        return item\n      })\n    },\n    // 返回教练等级名用于列表展示\n    getCoachLevelName(ids) {\n      if (ids.length === this.form.coachList.length) return '全部等级'\n      return this.form.coachList\n        .filter(item => ids.includes(item.value))\n        .map(item => item.label)\n        .toString()\n    },\n    onChangeCoachLevel(record, $event) {\n      // 当教练只剩下一个的时候，缓存教练，变化到零的时候再次添加进去\n      if (record.coach_level_ids.length === 1) {\n        this.cacheCoachId = $event\n      }\n      // 为零就补进去\n      if (record.coach_level_ids.length === 0) {\n        this.$set(record, 'coach_level_ids', this.cacheCoachId)\n      }\n      this.$set(record, 'coachLevelName', this.getCoachLevelName($event))\n    },\n    onBatchReserve(value) {\n      this.dataSource = this.dataSource.map(item => {\n        this.$set(item, 'reduce_times', value)\n        return item\n      })\n    },\n    onDelete(record) {\n      this.dataSource = this.dataSource.filter(\n        item => !(item.course_id === record.course_id)\n      )\n    },\n    openModal() {\n      const { dataSource, courseType, useRange, formVueData } = this\n      const title =\n        courseType === 'team' ? '选择支持预约的团体课' : '选择支持预约的私教课'\n      const useShopList =\n        useRange === 1\n          ? this.singleShops\n          : formVueData.getFieldValue('use_shop_list')\n      this.$modalRouter.push({\n        name: 'select-course',\n        props: {\n          initDataSource: dataSource,\n          title,\n          useRange,\n          courseType: this.courseType,\n          useShopList\n        },\n        on: {\n          done: courseList => {\n            this.dataSource =\n              this.courseType === 'team'\n                ? courseList\n                : courseList.map(item => {\n                    this.$set(item, 'coach_level_ids', this.allCoachLevelIds)\n                    return item\n                  })\n            this.dataSource = this.dataSource.map(item => {\n              !item.reduce_times && this.$set(item, 'reduce_times', 1)\n              return item\n            })\n          }\n        }\n      })\n    },\n    handleAdd() {\n      this.openModal()\n    }\n  },\n  mounted() {\n    this.dataSource = this.initDataSource\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-components/package/form/form-item#"}]}