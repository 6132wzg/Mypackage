{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/package/component#/form.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/package/component#/form.vue","mtime":1597396799966},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _typeof from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/typeof\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { PatternService } from '@/services/pattern.service';\nimport ReserveIsLimit from \"./reserveIsLimit\";\nimport { ruleOptions } from \"./form.config\";\nimport StEditor from '@/views/biz-components/st/editor/editor.vue';\nimport SelectShop from '@/views/fragments/shop/select-shop';\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue';\nimport { FormService } from \"./form.service\";\nimport moment from 'moment';\nimport { SHOP_RANGE, SHELF_STATUS } from '@/constants/course/package.ts';\nimport { cloneDeep, intersection } from 'lodash-es';\nexport default {\n  name: 'BrandPackageAdd',\n  bem: {\n    b: 'brand-package-add'\n  },\n  components: {\n    SelectShop: SelectShop,\n    StEditor: StEditor,\n    ReserveIsLimit: ReserveIsLimit,\n    StImageUpload: StImageUpload\n  },\n  serviceInject: function serviceInject() {\n    return {\n      pattern: PatternService,\n      formService: FormService\n    };\n  },\n  rxState: function rxState() {\n    var _this$formService = this.formService,\n        supportSales$ = _this$formService.supportSales$,\n        unitList$ = _this$formService.unitList$,\n        auth$ = _this$formService.auth$,\n        transferUnitList$ = _this$formService.transferUnitList$,\n        sellTypeList$ = _this$formService.sellTypeList$;\n    return {\n      supportSales$: supportSales$,\n      unitList$: unitList$,\n      auth$: auth$,\n      transferUnitList$: transferUnitList$,\n      sellTypeList$: sellTypeList$\n    };\n  },\n  props: {\n    initInfo: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    isEdit: {\n      type: Boolean,\n      default: false\n    }\n  },\n  watch: {\n    content: function content(newValue) {\n      if (newValue && newValue.length > 10000) {\n        this.validateIntro = '输入字数不能超过10000， 请减少输入';\n      } else {\n        this.validateIntro = '';\n      }\n    },\n    fileList: {\n      handler: function handler(newValue, oldValue) {\n        if (!newValue.length) {\n          this.validateImage = '请上传封面';\n        } else {\n          this.validateImage = '';\n        }\n      },\n      deep: true\n    },\n    userShopList: {\n      handler: function handler(newValue, oldValue) {\n        if (intersection(newValue, oldValue).length !== oldValue.length) {\n          this.$emit('rest-use-shop');\n        }\n\n        this.$emit('use-shop', {\n          use_range: this.userRange,\n          use_shop_list: this.useShopIds\n        });\n      },\n      deep: true\n    }\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      SHOP_RANGE: SHOP_RANGE,\n      SHELF_STATUS: SHELF_STATUS,\n      moment: moment,\n      validateIntro: '',\n      validateUseShop: '',\n      validateSaleShop: '',\n      form: form,\n      decorators: decorators,\n      isTransfer: false,\n      validateImage: '',\n      transfer: {\n        transfer_unit: 1,\n        is_allow_transfer: 0\n      },\n      packageData: {\n        transfer_unit: 1,\n        is_allow_transfer: 0,\n        sale_mode: [1]\n      },\n      reserveIsLimitOptions: [{\n        label: '不限制',\n        value: 0\n      }, {\n        label: '限制',\n        value: 1\n      }],\n      useShopIds: [],\n      saleShopIds: [],\n      image: {},\n      content: '',\n      imageErrorText: '',\n      fileList: [],\n      saleDate: [null, null],\n      cropperModal: {},\n      reserveIsLimitInfo: {},\n      userRange: 3,\n      saleRange: 3,\n      // 支持使用门店\n      userShopList: [],\n      // 支持售卖门店\n      saleShopList: [],\n      // 备注\n      remarks: ''\n    };\n  },\n  methods: {\n    getFormdata: function getFormdata(values) {\n      var obj = cloneDeep(values) || {};\n      console.log('this.image', this.image); // 处理售卖时间\n\n      if (obj.saleDate && obj.saleDate.length) {\n        obj.start_time = typeof obj.saleDate[0] === 'string' ? obj.saleDate[0] : obj.saleDate[0].format('YYYY-MM-DD');\n        obj.end_time = typeof obj.saleDate[1] === 'string' ? obj.saleDate[1] : obj.saleDate[1].format('YYYY-MM-DD');\n        delete obj.saleDate;\n      } // 门店返回时，是对象。新增的时候是数组\n\n\n      var form = _objectSpread({}, obj, {\n        is_allow_transfer: +this.isTransfer,\n        remarks: this.remarks,\n        intro: this.content,\n        image: this.image,\n        sale_shop_list: this.saleShopList.map(function (item) {\n          return _typeof(item) === 'object' ? item.shop_id : item;\n        }),\n        use_shop_list: this.userShopList.map(function (item) {\n          return _typeof(item) === 'object' ? item.shop_id : item;\n        })\n      });\n\n      return form;\n    },\n    validate: function validate() {\n      if (this.useRange === SHOP_RANGE.SPECIFIED_STORE && !this.userShopList.length) {\n        this.validateUseShop = '请选择使用门店';\n      }\n\n      if (this.saleRange === SHOP_RANGE.SPECIFIED_STORE && !this.saleShopList.length) {\n        this.validateUseShop = '请选择售卖门店';\n      }\n\n      if (!this.fileList.length) {\n        this.imageErrorText = '请上传封面';\n      } else {\n        this.imageErrorText = '';\n      }\n\n      return this.validateIntro || this.validateUseShop || this.validateSaleShop;\n    },\n    onSave: function onSave() {\n      var _this = this;\n\n      if (this.validate()) return;\n      this.form.validate().then(function (values) {\n        _this.$emit('submit-form', _this.getFormdata(values));\n      });\n    },\n    onSaveAndOnShelf: function onSaveAndOnShelf() {\n      var _this2 = this;\n\n      if (this.validate()) return;\n      this.form.validate().then(function (values) {\n        _this2.$emit('up', _this2.getFormdata(values));\n      });\n    },\n    onUserShopChange: function onUserShopChange(event) {\n      this.$emit('rest-use-shop');\n      this.userRange = event.target.value;\n    },\n    onSaleShopChange: function onSaleShopChange(event) {\n      this.saleRange = event.target.value;\n    },\n    getUserShopFormItem: function getUserShopFormItem(userShopList) {\n      this.userShopList = userShopList;\n      this.useShopIds = userShopList;\n    },\n    getSaleShopFormItem: function getSaleShopFormItem(saleShopList) {\n      this.saleShopList = saleShopList;\n    },\n    onSaleDate: function onSaleDate() {},\n    transferUnitChange: function transferUnitChange(unit) {\n      this.transfer.transfer_unit = unit;\n    },\n    onTransferChange: function onTransferChange(event) {// console.log(event)\n    },\n    onChangeEditor: function onChangeEditor() {\n      console.log('富文本编辑');\n    },\n    fileChange: function fileChange(data) {\n      if (data.length) {\n        // 上传\n        this.image.image_id = data[0].image_id;\n        this.image.image_key = data[0].image_key;\n        this.imageIsNone = false;\n        this.imageErrorText = '';\n      } else {\n        // 删除\n        this.image.image_id = null;\n        this.image.image_key = '';\n        this.imageIsNone = true;\n        this.imageErrorText = '请上传封面';\n      }\n    }\n  },\n  created: function created() {\n    this.fileList = this.initInfo.image ? [this.initInfo.image] : [];\n    this.content = this.initInfo.intro;\n    this.remarks = this.initInfo.remarks;\n    this.isTransfer = !!this.initInfo.is_allow_transfer;\n    this.transfer.transfer_unit = this.initInfo.transfer_unit;\n    this.saleRange = this.initInfo.sale_range;\n    this.userRange = this.initInfo.use_range;\n\n    if (this.initInfo.sale_shop_list && this.initInfo.sale_shop_list.length) {\n      this.saleShopIds = this.initInfo.sale_shop_list.map(function (item) {\n        return item.shop_id;\n      }); // 支持售卖门店\n\n      this.saleShopList = this.initInfo.sale_shop_list;\n    }\n\n    if (this.initInfo.use_shop_list && this.initInfo.use_shop_list.length) {\n      this.userShopList = this.initInfo.use_shop_list;\n      this.useShopIds = this.initInfo.use_shop_list.map(function (item) {\n        return item.shop_id;\n      });\n    }\n  }\n};",null]}