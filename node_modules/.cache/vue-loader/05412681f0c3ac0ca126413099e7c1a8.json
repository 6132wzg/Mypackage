{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/personal/edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/personal/edit.vue","mtime":1595230476660},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { PersonalScheduleScheduleService } from '@/views/pages/shop/product/course/schedule/personal/service#/schedule.service'\nimport ScheduleTimePicker from '@/views/biz-components/schedule-time-picker/schedule-time-picker'\nexport default {\n  name: 'EditShchedule',\n  components: {\n    ScheduleTimePicker\n  },\n  serviceInject() {\n    return {\n      scheduleService: PersonalScheduleScheduleService\n    }\n  },\n  rxState() {\n    return {}\n  },\n  data() {\n    return {\n      show: false,\n      staffName: '',\n      isInit: false,\n      scheduleInfo: [\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        }\n      ]\n    }\n  },\n  props: {\n    id: {\n      type: Number\n    },\n    start: {\n      type: String,\n      default: ''\n    }\n  },\n  filters: {\n    filterDate(val) {\n      return moment(val)\n        .format('dddd')\n        .valueOf()\n    }\n  },\n  computed: {\n    end() {\n      return moment(moment(this.start).valueOf() + 24 * 6 * 3600 * 1000)\n        .format('YYYY-MM-DD')\n        .valueOf()\n    },\n    rangeTime() {\n      return `${this.start} ~ ${this.end}`\n    }\n  },\n  methods: {\n    onOkSave() {\n      let date = {\n        id: this.id,\n        schedule_info: this.scheduleInfo\n      }\n      this.scheduleService.update(date).subscribe(res => {\n        this.show = false\n        this.$emit('success:ok')\n        this.$emit('success')\n      })\n    },\n    onClickCopySchedule() {\n      this.scheduleService\n        .copy(this.id, { start_date: this.start, end_date: this.end })\n        .subscribe(res => {\n          this.show = false\n          this.$emit('success:copy')\n          this.$emit('success')\n        })\n    },\n    initScheduleInfo() {\n      const weekOfday = moment(this.start, 'YYYY-MM-DD').format('E')\n      this.scheduleInfo = this.scheduleInfo.map((item, index) => {\n        const day = moment(this.start)\n          .add(index + 1 - weekOfday, 'days')\n          .format('YYYY-MM-DD')\n        return {\n          schedule_time: day,\n          ...item\n        }\n      })\n    },\n    getInfo() {\n      let form = {\n        id: this.id,\n        start_time: this.start,\n        end_time: this.end\n      }\n      this.isInit = false\n      this.scheduleService.getUpdateInfo(form).subscribe(res => {\n        this.staffName = res.info.staff_name\n        const scheduleInfo = this.scheduleInfo.map(item => {\n          res.info.coach_info.forEach(ele => {\n            if (ele.schedule_time === item.schedule_time) {\n              item = ele\n            } else if (!item.id) {\n              item.id = 0\n            }\n          })\n          this.isInit = true\n          return item\n        })\n        this.$set(this, 'scheduleInfo', scheduleInfo)\n      })\n    }\n  },\n  created() {\n    this.initScheduleInfo(this.start)\n    this.getInfo()\n  }\n}\n",null]}