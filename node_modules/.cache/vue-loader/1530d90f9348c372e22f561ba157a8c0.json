{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/personal/edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/personal/edit.vue","mtime":1595230476660},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { PersonalScheduleScheduleService } from '@/views/pages/shop/product/course/schedule/personal/service#/schedule.service'\nimport ScheduleTimePicker from '@/views/biz-components/schedule-time-picker/schedule-time-picker'\nexport default {\n  name: 'EditShchedule',\n  components: {\n    ScheduleTimePicker\n  },\n  serviceInject() {\n    return {\n      scheduleService: PersonalScheduleScheduleService\n    }\n  },\n  rxState() {\n    return {}\n  },\n  data() {\n    return {\n      show: false,\n      staffName: '',\n      isInit: false,\n      scheduleInfo: [\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        }\n      ]\n    }\n  },\n  props: {\n    id: {\n      type: Number\n    },\n    start: {\n      type: String,\n      default: ''\n    }\n  },\n  filters: {\n    filterDate(val) {\n      return moment(val)\n        .format('dddd')\n        .valueOf()\n    }\n  },\n  computed: {\n    end() {\n      return moment(moment(this.start).valueOf() + 24 * 6 * 3600 * 1000)\n        .format('YYYY-MM-DD')\n        .valueOf()\n    },\n    rangeTime() {\n      return `${this.start} ~ ${this.end}`\n    }\n  },\n  methods: {\n    onOkSave() {\n      let date = {\n        id: this.id,\n        schedule_info: this.scheduleInfo\n      }\n      this.scheduleService.update(date).subscribe(res => {\n        this.show = false\n        this.$emit('success:ok')\n        this.$emit('success')\n      })\n    },\n    onClickCopySchedule() {\n      this.scheduleService\n        .copy(this.id, { start_date: this.start, end_date: this.end })\n        .subscribe(res => {\n          this.show = false\n          this.$emit('success:copy')\n          this.$emit('success')\n        })\n    },\n    initScheduleInfo() {\n      const weekOfday = moment(this.start, 'YYYY-MM-DD').format('E')\n      this.scheduleInfo = this.scheduleInfo.map((item, index) => {\n        const day = moment(this.start)\n          .add(index + 1 - weekOfday, 'days')\n          .format('YYYY-MM-DD')\n        return {\n          schedule_time: day,\n          ...item\n        }\n      })\n    },\n    getInfo() {\n      let form = {\n        id: this.id,\n        start_time: this.start,\n        end_time: this.end\n      }\n      this.isInit = false\n      this.scheduleService.getUpdateInfo(form).subscribe(res => {\n        this.staffName = res.info.staff_name\n        const scheduleInfo = this.scheduleInfo.map(item => {\n          res.info.coach_info.forEach(ele => {\n            if (ele.schedule_time === item.schedule_time) {\n              item = ele\n            } else if (!item.id) {\n              item.id = 0\n            }\n          })\n          this.isInit = true\n          return item\n        })\n        this.$set(this, 'scheduleInfo', scheduleInfo)\n      })\n    }\n  },\n  created() {\n    this.initScheduleInfo(this.start)\n    this.getInfo()\n  }\n}\n",{"version":3,"sources":["edit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"edit.vue","sourceRoot":"src/views/biz-modals/schedule/personal","sourcesContent":["<template>\n  <st-modal title=\"编辑排期\" @ok=\"onOkSave\" v-model=\"show\" width=\"1200px\">\n    <div class=\"modal-schedule-edit\">\n      <div class=\"modal-schedule-edit__info\">\n        <div class=\"coach\">\n          <span>上课{{ $c('coach') }}:</span>\n          <span>{{ staffName }}</span>\n        </div>\n        <div class=\"time\">\n          {{ rangeTime }}\n        </div>\n      </div>\n      <div class=\"copy-button-box mg-t16\">\n        <st-button class=\"copy-button\" @click=\"onClickCopySchedule\">\n          复制上周\n        </st-button>\n      </div>\n\n      <div\n        class=\"modal-schedule__time modal-add-schedule__time mg-t16\"\n        v-if=\"scheduleInfo.length\"\n      >\n        <st-container>\n          <a-row class=\"time-header\">\n            <a-col :lg=\"2\">\n              <span class=\"time-header__label mg-l8\">时间段</span>\n            </a-col>\n            <a-col :lg=\"22\">\n              <a-col class=\"time-header__value\" :lg=\"6\">00:00</a-col>\n              <a-col class=\"time-header__value\" :lg=\"6\">06:00</a-col>\n              <a-col class=\"time-header__value\" :lg=\"6\">12:00</a-col>\n              <a-col :lg=\"6\" class=\"time-header__value last\">\n                <span>18:00</span>\n                <span class=\"mg-r8\">24:00</span>\n              </a-col>\n            </a-col>\n          </a-row>\n          <div v-if=\"isInit\">\n            <a-row\n              class=\"time-item\"\n              v-for=\"info in scheduleInfo\"\n              :key=\"info.schedule_time\"\n            >\n              <a-col :lg=\"2\">\n                <span>{{ info.schedule_time | filterDate }}</span>\n              </a-col>\n              <a-col :lg=\"22\">\n                <schedule-time-picker\n                  v-model=\"info.timing\"\n                ></schedule-time-picker>\n              </a-col>\n            </a-row>\n          </div>\n        </st-container>\n      </div>\n    </div>\n  </st-modal>\n</template>\n\n<script>\nimport { PersonalScheduleScheduleService } from '@/views/pages/shop/product/course/schedule/personal/service#/schedule.service'\nimport ScheduleTimePicker from '@/views/biz-components/schedule-time-picker/schedule-time-picker'\nexport default {\n  name: 'EditShchedule',\n  components: {\n    ScheduleTimePicker\n  },\n  serviceInject() {\n    return {\n      scheduleService: PersonalScheduleScheduleService\n    }\n  },\n  rxState() {\n    return {}\n  },\n  data() {\n    return {\n      show: false,\n      staffName: '',\n      isInit: false,\n      scheduleInfo: [\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        },\n        {\n          timing: []\n        }\n      ]\n    }\n  },\n  props: {\n    id: {\n      type: Number\n    },\n    start: {\n      type: String,\n      default: ''\n    }\n  },\n  filters: {\n    filterDate(val) {\n      return moment(val)\n        .format('dddd')\n        .valueOf()\n    }\n  },\n  computed: {\n    end() {\n      return moment(moment(this.start).valueOf() + 24 * 6 * 3600 * 1000)\n        .format('YYYY-MM-DD')\n        .valueOf()\n    },\n    rangeTime() {\n      return `${this.start} ~ ${this.end}`\n    }\n  },\n  methods: {\n    onOkSave() {\n      let date = {\n        id: this.id,\n        schedule_info: this.scheduleInfo\n      }\n      this.scheduleService.update(date).subscribe(res => {\n        this.show = false\n        this.$emit('success:ok')\n        this.$emit('success')\n      })\n    },\n    onClickCopySchedule() {\n      this.scheduleService\n        .copy(this.id, { start_date: this.start, end_date: this.end })\n        .subscribe(res => {\n          this.show = false\n          this.$emit('success:copy')\n          this.$emit('success')\n        })\n    },\n    initScheduleInfo() {\n      const weekOfday = moment(this.start, 'YYYY-MM-DD').format('E')\n      this.scheduleInfo = this.scheduleInfo.map((item, index) => {\n        const day = moment(this.start)\n          .add(index + 1 - weekOfday, 'days')\n          .format('YYYY-MM-DD')\n        return {\n          schedule_time: day,\n          ...item\n        }\n      })\n    },\n    getInfo() {\n      let form = {\n        id: this.id,\n        start_time: this.start,\n        end_time: this.end\n      }\n      this.isInit = false\n      this.scheduleService.getUpdateInfo(form).subscribe(res => {\n        this.staffName = res.info.staff_name\n        const scheduleInfo = this.scheduleInfo.map(item => {\n          res.info.coach_info.forEach(ele => {\n            if (ele.schedule_time === item.schedule_time) {\n              item = ele\n            } else if (!item.id) {\n              item.id = 0\n            }\n          })\n          this.isInit = true\n          return item\n        })\n        this.$set(this, 'scheduleInfo', scheduleInfo)\n      })\n    }\n  },\n  created() {\n    this.initScheduleInfo(this.start)\n    this.getInfo()\n  }\n}\n</script>\n"]}]}