{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/lottery/add.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/lottery/add.vue","mtime":1600926556138},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { MessageService } from '@/services/message.service'\nimport { AddService } from './add.service'\nimport H5Container from '@/views/biz-components/h5/h5-container'\nimport Steps from './components#/step'\nimport { ruleOptions } from './form.config.ts'\nimport { PatternService } from '@/services/pattern.service'\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue'\nimport BrandMarketingPluginAddPrize from '@/views/biz-modals/brand/marketing/plugin/add-prize'\nimport { cloneDeep } from 'lodash-es'\nimport 'swiper/dist/css/swiper.css'\nimport { swiper, swiperSlide } from 'vue-awesome-swiper'\nimport {\n  TIMES_TYPE,\n  CROWD_TYPE,\n  SHARE_TYPE,\n  STOP_SWIPER,\n  ACTIVITY_STATUS,\n  NOT_PRIZE_IMG_TYPE,\n  CONDITION_TYPE\n} from '@/constants/marketing/lottery'\n\nexport default {\n  name: 'PluginLotteryAdd',\n  data(vm) {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      TIMES_TYPE,\n      CROWD_TYPE,\n      SHARE_TYPE,\n      STOP_SWIPER,\n      ACTIVITY_STATUS,\n      NOT_PRIZE_IMG_TYPE,\n      columsTitlelist: [\n        '奖品名称',\n        '奖品类型',\n        '可用门店（家）',\n        '奖品数量（个）',\n        '中奖概率 (%)',\n        '操作'\n      ],\n      info: {},\n      preview: {\n        title: '',\n        startTime: '',\n        endTime: '',\n        perTimes: 0,\n        totalTimes: 0,\n        description: '',\n        remain_points: 0\n      },\n      shareTitle: '',\n      fileList: [],\n      fileShareList: [],\n      prizeList: [],\n      timesType: TIMES_TYPE.DEFAULT,\n      crowdType: CROWD_TYPE.DEFAULT,\n      shareType: SHARE_TYPE.DEFAULT,\n      isStopSwiper: STOP_SWIPER.DEFAULT,\n      stepArr: [\n        {\n          title: '基础信息',\n          key: 1\n        },\n        {\n          title: '抽奖规则',\n          key: 2\n        },\n        {\n          title: '奖项设置',\n          key: 3\n        }\n      ],\n      currentIndex: 0,\n      curPrizeIndex: -1,\n      notPrizeImgType: NOT_PRIZE_IMG_TYPE.DEFAULT,\n      dateRangeVal: [],\n      notPrize: {\n        prize_name: '未中奖',\n        prize: {\n          image_url: ''\n        }\n      },\n      sliderOptions: {\n        autoplay: {\n          delay: 3000,\n          disableOnInteraction: false\n        }\n      },\n      swiperOption: {\n        spaceBetween: 6,\n        slidesPerView: 1.05\n      },\n      defaultValue: [moment().format('HH:mm'), moment('11:59', 'HH:mm')],\n      isShowEditTable: -1,\n      prizeRate: [],\n      prizeNum: [],\n      // 奖品顺序配置， -2代表空， -1 代表未中奖， >=0 为奖品列表的下标， 前三项有-2代表抽奖信息不全，有空项\n      prizeSort: [\n        [-2, -2, -2, -2, -2, -2, -2, -1],\n        [0, -2, -2, -2, -2, -2, -2, -1],\n        [0, 1, -2, -2, -2, -2, -2, -1],\n        // 奖品至少为三个，即以上三个仅做UI展示控制，不会传到后端，\n        [0, 1, 2, -1, 0, 1, 2, -1],\n        [0, -1, 1, -1, 2, -1, 3, -1],\n        [0, -1, 1, -1, 2, 3, 4, -1],\n        [0, 1, 2, -1, 3, 4, 5, -1],\n        [0, 1, 2, 3, 4, 5, 6, -1]\n      ],\n      hasFreeCondition: true,\n      hasPointsCondition: false\n    }\n  },\n  bem: {\n    bPage: 'page-brand-marketing-plugin-lottery-add'\n  },\n  serviceInject() {\n    return {\n      addService: AddService,\n      pattern: PatternService,\n      messageService: MessageService\n    }\n  },\n  rxState() {\n    return {\n      drawCondition: this.addService.drawCondition$,\n      drawTimesType: this.addService.drawTimesType$,\n      invitePoster: this.addService.invitePoster$,\n      wheelDefault: this.addService.wheelDefault$,\n      wheelTurnAround: this.addService.wheelTurnAround$,\n      joinCrowdAll: this.addService.joinCrowdAll$,\n      crowd: this.addService.crowd$,\n      imgType: this.addService.imgType$,\n      prizeInfoList: this.addService.prizeInfoList$,\n      lucky: this.addService.lucky$,\n      prize: this.addService.prize$,\n      share: this.addService.share$,\n      pluginStatus: this.addService.pluginStatus$\n    }\n  },\n  modals: {\n    BrandMarketingPluginAddPrize\n  },\n  components: {\n    H5Container,\n    Steps,\n    swiper,\n    swiperSlide,\n    StImageUpload\n  },\n  mounted() {\n    // this.notPrize.prize = this.lucky[0]\n    if (this.$searchQuery.activity_id) {\n      this.editVIew(this.$searchQuery.activity_id)\n    }\n  },\n  computed: {\n    // hasPointsCondition() {\n    //   return this.form.getFieldValue('draw_condition')\n    // },\n    deleteBtnStatus() {\n      return this.$searchQuery.activity_id && this.$searchQuery.status === 1\n    },\n    currentActive() {\n      if (this.prizeList.length) return 0\n      return -1\n    },\n    prizeListFilters(value) {\n      return this.prizeSort[this.prizeList.length].map((item, index) => {\n        if (item < -1) {\n          return {\n            prize: {\n              image_url: ''\n            },\n            prize_name: ''\n          }\n        } else if (item > -1) {\n          return this.prizeList[item]\n        } else {\n          return {\n            prize: {\n              image_url:\n                this.notPrizeImgType === this.NOT_PRIZE_IMG_TYPE.CUSTOM\n                  ? this.notPrize.prize.image_url\n                  : this.lucky[0].image_url\n            },\n            prize_name: this.notPrize.prize_name\n          }\n        }\n      })\n    }\n  },\n  methods: {\n    showEditTable(index) {\n      if (this.isShowEditTable === index) {\n        this.prizeList[index].number = this.prizeNum[index]\n        this.prizeList[index].rate = this.prizeRate[index]\n        this.isShowEditTable = -1\n      } else {\n        this.isShowEditTable = index\n      }\n    },\n    onDrawConditionChange(val) {\n      this.hasFreeCondition = val.includes(CONDITION_TYPE.FREE)\n      this.hasPointsCondition = val.includes(CONDITION_TYPE.POINTS)\n    },\n    next(para) {\n      if (para.index) {\n        para = para.index - 1\n      }\n      if (para === 0) {\n        this.currentIndex = 0\n      }\n      if (para === 1) {\n        this.form\n          .validate([\n            'activity_base.activity_name',\n            'activity_base.activity_description',\n            'activity_base.wheel_turn_around',\n            'activity_base.wheel_share_default',\n            'activity_base.share_title',\n            'activity_base.activity_sub_name'\n          ])\n          .then(() => {\n            this.currentIndex = para\n          })\n      }\n      if (para === 2) {\n        this.form\n          .validate([\n            'activity_base.activity_name',\n            'activity_base.activity_description',\n            'activity_base.wheel_turn_around',\n            'activity_base.wheel_share_default',\n            'activity_base.share_title',\n            'activity_base.activity_sub_name',\n            'activity_rule.join_crowd_all',\n            'activity_rule.draw_condition',\n            'activity_rule.draw_times_type',\n            'activity_rule.per_times',\n            'activity_rule.draw_points',\n            'activity_rule.total_times'\n          ])\n          .then(() => {\n            this.currentIndex = para\n          })\n      }\n    },\n    onChangeGetAvatar(imageFiles) {\n      this.fileList = cloneDeep(imageFiles)\n      this.notPrize.prize = this.fileList[0]\n      this.$forceUpdate()\n    },\n    onShareChangeGetAvatar(imageFiles) {\n      this.fileShareList = cloneDeep(imageFiles)\n    },\n    onSubmit() {\n      this.form.validate().then(value => {\n        value.activity_base.start_time = this.preview.startTime\n        value.activity_base.end_time = this.preview.endTime\n        value.activity_base.share_title = this.shareTitle\n        // 选择自定义却不传图片\n        value.activity_base.share_bg =\n          this.shareType === SHARE_TYPE.CUSTOM\n            ? this.fileShareList[0] || this.share[0]\n            : this.share[0]\n        value.activity_prizes = this.prizeList\n        value.activity_lucky.lucky =\n          this.notPrizeImgType === NOT_PRIZE_IMG_TYPE.CUSTOM\n            ? this.fileList[0] || this.prize[0]\n            : this.lucky[0]\n        if (\n          this.hasFreeCondition &&\n          this.timesType === 1 &&\n          !value.activity_rule.per_times\n        ) {\n          this.messageService.warn({\n            content: '请填写抽奖次数'\n          })\n          return\n        }\n        if (\n          this.hasFreeCondition &&\n          this.timesType === 2 &&\n          !value.activity_rule.total_times\n        ) {\n          this.messageService.warn({\n            content: '请填写抽奖次数'\n          })\n          return\n        }\n        // 无免费抽奖时也需要设置 默认的免费抽奖参数\n        if (!this.hasFreeCondition) {\n          value.activity_rule.per_times = 0\n          value.activity_rule.total_times = 0\n          value.activity_rule.draw_times_type = 1\n        }\n        value.activity_rule.prize_sort = this.prizeSort[this.prizeList.length]\n        if (this.$searchQuery.activity_id) {\n          value.activity_id = this.$searchQuery.activity_id\n          this.addService.edit(value).subscribe(res => {\n            this.$router.push('./success?id=' + res.id)\n          })\n        } else {\n          this.addService.add(value).subscribe(res => {\n            this.$router.push('./success?id=' + res.id)\n          })\n        }\n      })\n    },\n    getTitle(e) {\n      this.preview.title = e.target.value\n    },\n    getName(e) {\n      this.notPrize.prize_name = e.target.value\n    },\n    getPerTimes(val) {\n      this.preview.perTimes = val\n    },\n    getTotalTimes(val) {\n      this.preview.totalTimes = val\n    },\n    getDrawPoints(val) {\n      this.preview.drawPoints = val\n    },\n    getDescription(val) {\n      this.preview.description = val\n    },\n    // 抽奖次数类型\n    getCurTimesType(e) {\n      this.timesType = e.target.value\n    },\n    // 人群类型\n    getCurCrowdType(e) {\n      this.crowdType = e.target.value\n    },\n    // 分享类型\n    getCurShareType(e) {\n      this.shareType = e.target.value\n    },\n    // 轮播开关\n    stopSwiper(e) {\n      this.isStopSwiper = e.target.value\n    },\n    onDateChange(data, str) {\n      this.preview.startTime = str[0]\n      this.preview.endTime = str[1]\n    },\n    getNotImgType(e) {\n      this.notPrizeImgType = e.target.value\n    },\n    getPrizeInfo(val) {\n      if (this.curPrizeIndex > -1) {\n        this.prizeList.splice(this.curPrizeIndex, 1, val)\n      } else {\n        this.prizeList.push(val)\n        this.prizeRate.push(val.rate)\n        this.prizeNum.push(val.number)\n      }\n    },\n    getCurPrizeIndex(index) {\n      this.curPrizeIndex = index\n    },\n    disabledDate(current) {\n      return (\n        current && current.format('YYYY-MM-DD') < moment().format('YYYY-MM-DD')\n      )\n    },\n    onDelete(para) {\n      if (this.isShowEditTable === para) {\n        this.isShowEditTable = -1\n        return false\n      } else {\n        this.prizeRate.splice(para, 1)\n        this.prizeNum.splice(para, 1)\n      }\n      this.prizeList = this.prizeList.filter((item, index) => {\n        return index !== para\n      })\n    },\n    editTableNum(val, index) {\n      this.prizeNum[index] = val\n    },\n    editTableRate(val, index) {\n      this.prizeRate[index] = val\n    },\n    editVIew(id) {\n      return this.addService.editVIew(id).subscribe(res => {\n        this.info = res\n        this.$nextTick().then(() => {\n          this.form.setFieldsValue({\n            activity_base: res.activity_base,\n            activity_lucky: res.activity_lucky,\n            activity_prizes: res.activity_prizes,\n            activity_rule: res.activity_rule\n          })\n        })\n        this.dateRangeVal = [\n          moment(res.activity_base.start_time.trim()),\n          moment(res.activity_base.end_time.trim())\n        ]\n        this.prizeList = res.activity_prizes\n        res.activity_prizes.forEach((item, index) => {\n          this.prizeNum[index] = item.number\n          this.prizeRate[index] = item.rate\n        })\n        this.hasFreeCondition = res.activity_rule.draw_condition.includes(\n          CONDITION_TYPE.FREE\n        )\n        this.hasPointsCondition = res.activity_rule.draw_condition.includes(\n          CONDITION_TYPE.POINTS\n        )\n        this.preview.startTime = res.activity_base.start_time\n        this.preview.endTime = res.activity_base.end_time\n        this.preview.perTimes = res.activity_rule.per_times\n        this.preview.totalTimes = res.activity_rule.total_times\n        this.preview.description = res.activity_base.activity_description\n        this.preview.title = res.activity_base.activity_sub_name\n        this.notPrize.prize_name = res.activity_lucky.lucky_name\n        this.shareType = res.activity_base.wheel_share_default\n        this.timesType = res.activity_rule.draw_times_type\n        this.isStopSwiper = res.activity_base.wheel_turn_around\n        this.notPrizeImgType = res.activity_lucky.image_default\n        this.shareTitle = res.activity_base.share_title\n        this.share[0].image_id = res.activity_base.share_bg.image_id\n        res.activity_lucky.lucky &&\n          (this.fileList[0] = res.activity_lucky.lucky)\n        this.fileShareList[0] = res.activity_base.share_bg\n        this.prize[0] = res.activity_lucky.lucky\n        if (this.notPrizeImgType === this.NOT_PRIZE_IMG_TYPE.CUSTOM) {\n          this.notPrize.prize = res.activity_lucky.lucky\n        } else {\n          this.notPrize.prize = this.lucky[0]\n        }\n      })\n    }\n  }\n}\n",{"version":3,"sources":["add.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+hBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add.vue","sourceRoot":"src/views/pages/brand/marketing/plugin/lottery","sourcesContent":["<template>\n  <st-mina-panel>\n    <h5-container slot=\"preview\" fixed>\n      <template v-slot:title>\n        幸运大转盘\n      </template>\n      <div :class=\"bPage('lottery')\">\n        <img\n          :class=\"bPage('lottery-bg')\"\n          src=\"https://styd-frontend.oss-cn-shanghai.aliyuncs.com/images/turntable-bg1.png\"\n        />\n        <div :class=\"bPage('lottery-header')\">\n          <div class=\" wrap\">\n            <div\n              :class=\"bPage('swiper')\"\n              v-if=\"isStopSwiper === STOP_SWIPER.DEFAULT\"\n            >\n              <swiper :options=\"sliderOptions\">\n                <swiper-slide\n                  v-for=\"(item, index) in prizeInfoList\"\n                  :key=\"index\"\n                >\n                  <span :class=\"bPage('swiper-text')\">{{ item }}</span>\n                </swiper-slide>\n              </swiper>\n              <!-- <img class=\" swiper-img\" src=\"https://styd-frontend.oss-cn-shanghai.aliyuncs.com/imgs/turntable-swiper-msg.png\" alt=\"通知\"/>\n          <span class=\" swiper-text\">\n            <span v-for=\"(item, index) in prizeInfoList\" :key=\"index\"\n              decode=\"true\"\n              space=\"nbsp\"\n            >\n              {{ item }}&nbsp;&nbsp;&nbsp;&nbsp;\n            </span>\n          </span> -->\n            </div>\n          </div>\n          <div :class=\"bPage('lottery-title')\">{{ preview.title }}</div>\n        </div>\n        <div :class=\"bPage('lottery-content')\">\n          <div :class=\"bPage('lottery-content-changes')\">\n            还剩{{\n              (timesType === 1 ? preview.perTimes : preview.totalTimes) || 0\n            }}次免费抽奖机会\n          </div>\n          <div :class=\"bPage('lottery-content-box')\">\n            <div\n              v-for=\"(item, index) in prizeListFilters\"\n              :class=\"\n                'run-item run-item-' +\n                  index +\n                  (currentActive === index ? ' run-item--active' : '')\n              \"\n              :key=\"index\"\n            >\n              <div class=\"run-item-box\">\n                <img\n                  class=\"run-item-img\"\n                  v-if=\"item.prize.image_url\"\n                  :src=\"item.prize.image_url\"\n                  alt=\"奖品图片\"\n                />\n                <div class=\"run-item-text\">\n                  {{ item.prize_name }}\n                </div>\n              </div>\n            </div>\n            <div class=\"run-item run-item-start\">\n              <span class=\"run-item-start-text\">\n                {{\n                  hasPointsCondition && !hasFreeCondition\n                    ? (preview.drawPoints || 0) + '积分/次'\n                    : '免费抽奖'\n                }}\n              </span>\n              <img\n                src=\"https://styd-frontend.oss-cn-shanghai.aliyuncs.com/images/minaPro/plugin/draw-go.png\"\n              />\n            </div>\n          </div>\n          <div :class=\"bPage('lottery-content-my-prize')\">\n            <div :class=\"bPage('lottery-content-my-prize-text')\">我的奖品</div>\n            <img\n              :class=\"bPage('lottery-content-my-prize-img')\"\n              src=\"https://styd-frontend.oss-cn-shanghai.aliyuncs.com/images/minaPro/plugin/my-gift.png\"\n            />\n          </div>\n        </div>\n        <div\n          :class=\"bPage('lottery-my-point')\"\n          v-if=\"pluginStatus.pointActivityAtatus === 1 && hasPointsCondition\"\n        >\n          我的积分：\n          <span :class=\"bPage('lottery-my-point-num')\">\n            {{ preview.remain_points }}\n          </span>\n        </div>\n        <div :class=\"bPage('lottery-footer')\">\n          <div :class=\"bPage('lottery-footer-title')\">活动规则</div>\n          <div :class=\"bPage('lottery-footer-tip')\">\n            <span :class=\"bPage('lottery-footer-label')\">活动时间：</span>\n            <span :class=\"bPage('lottery-footer-value')\">\n              {{ preview.startTime }}--{{ preview.endTime }}\n            </span>\n          </div>\n          <div :class=\"bPage('lottery-footer-tip')\">\n            <span :class=\"bPage('lottery-footer-label')\">抽奖规则：</span>\n            <div :class=\"bPage('lottery-footer-value')\">\n              <div v-if=\"timesType === 1\">\n                每人每天有{{ preview.perTimes }}次机会\n              </div>\n              <div v-else>每人总共有{{ preview.totalTimes }}次机会</div>\n              <div v-if=\"hasPointsCondition\">\n                {{ preview.drawPoints || 0 }}积分兑换一次抽奖机会\n              </div>\n            </div>\n          </div>\n          <div :class=\"bPage('lottery-footer-tip')\">\n            <span :class=\"bPage('lottery-footer-label')\">活动说明：</span>\n            <span :class=\"bPage('lottery-footer-value')\">\n              {{ preview.description }}\n            </span>\n          </div>\n        </div>\n      </div>\n    </h5-container>\n    <div slot=\"actions\">\n      <st-button v-show=\"currentIndex === 0\" type=\"primary\" @click=\"next(1)\">\n        下一步\n      </st-button>\n      <st-button v-show=\"currentIndex === 1\" type=\"primary\" @click=\"next(2)\">\n        下一步\n      </st-button>\n      <st-button v-show=\"currentIndex === 2\" type=\"primary\" @click=\"onSubmit\">\n        完成\n      </st-button>\n    </div>\n\n    <div :class=\"bPage('form')\">\n      <Steps :value=\"currentIndex\" @skip=\"next\" :stepArr=\"stepArr\" />\n      <div style=\"padding:24px;\">\n        <st-form\n          style=\"width:500px\"\n          :form=\"form\"\n          labelGutter=\"0\"\n          v-show=\"currentIndex == 0\"\n          labelWidth=\"124px\"\n        >\n          <st-form-item label=\"活动名称\" required>\n            <a-input\n              :disabled=\"info.activity_status === ACTIVITY_STATUS.DISABLED\"\n              placeholder=\"请输入活动名称\"\n              v-decorator=\"decorators.activity_base.activity_name\"\n            ></a-input>\n          </st-form-item>\n          <st-form-item label=\"活动标题\" required>\n            <a-input\n              :disabled=\"info.activity_status === ACTIVITY_STATUS.DISABLED\"\n              @change=\"getTitle\"\n              placeholder=\"请输入活动标题\"\n              v-decorator=\"decorators.activity_base.activity_sub_name\"\n            ></a-input>\n          </st-form-item>\n          <st-form-item label=\"活动时间\" required>\n            <a-range-picker\n              :disabled=\"info.activity_status === ACTIVITY_STATUS.DISABLED\"\n              :disabledDate=\"disabledDate\"\n              :showTime=\"{\n                hideDisabledOptions: true,\n                defaultValue: defaultValue\n              }\"\n              format=\"YYYY-MM-DD HH:mm\"\n              v-model=\"dateRangeVal\"\n              @change=\"onDateChange\"\n            ></a-range-picker>\n          </st-form-item>\n          <st-form-item label=\"活动说明\">\n            <st-textarea\n              :rows=\"4\"\n              :maxlength=\"500\"\n              @change=\"getDescription\"\n              :disabled=\"info.activity_status === ACTIVITY_STATUS.DISABLED\"\n              placeholder=\"请输入活动说明\"\n              v-decorator=\"decorators.activity_base.activity_description\"\n            ></st-textarea>\n          </st-form-item>\n          <st-form-item label=\"轮播获奖\">\n            <a-radio-group\n              :disabled=\"info.activity_status === ACTIVITY_STATUS.DISABLED\"\n              @change=\"stopSwiper\"\n              v-decorator=\"decorators.activity_base.wheel_turn_around\"\n            >\n              <a-radio\n                v-for=\"(item, index) in wheelTurnAround\"\n                :key=\"index\"\n                :value=\"item.value\"\n              >\n                {{ item.label }}\n              </a-radio>\n            </a-radio-group>\n          </st-form-item>\n          <st-form-item label=\"分享设置\">\n            <a-radio-group\n              @change=\"getCurShareType\"\n              :disabled=\"info.activity_status === ACTIVITY_STATUS.DISABLED\"\n              v-decorator=\"decorators.activity_base.wheel_share_default\"\n            >\n              <a-radio\n                v-for=\"(item, index) in wheelDefault\"\n                :key=\"index\"\n                :value=\"item.value\"\n              >\n                {{ item.label }}\n              </a-radio>\n            </a-radio-group>\n            <div v-if=\"shareType === 2\" :class=\"bPage('share-upload')\">\n              <st-form-item label=\"选择图片\" labelWidth=\"60px\">\n                <st-image-upload\n                  width=\"96px\"\n                  height=\"96px\"\n                  :list=\"fileShareList\"\n                  @change=\"onShareChangeGetAvatar\"\n                  placeholder=\"上传图片\"\n                ></st-image-upload>\n                <span :class=\"bPage('share-upload-text')\">\n                  请上传jpg、png格式的图片\n                </span>\n              </st-form-item>\n              <st-form-item label=\"分享标题\" labelWidth=\"60px\">\n                <a-input placeholder=\"分享标题\" v-model=\"shareTitle\"></a-input>\n              </st-form-item>\n            </div>\n            <img\n              class=\"default-img\"\n              v-else\n              :src=\"share[0].image_url\"\n              alt=\"默认图片\"\n            />\n          </st-form-item>\n        </st-form>\n\n        <st-form\n          style=\"width:520px\"\n          :form=\"form\"\n          labelGutter=\"0\"\n          v-show=\"currentIndex == 1\"\n          labelWidth=\"124px\"\n        >\n          <st-form-item label=\"参与用户\" required>\n            <a-radio-group\n              @change=\"getCurCrowdType\"\n              v-decorator=\"decorators.activity_rule.join_crowd_all\"\n            >\n              <a-radio\n                v-for=\"(item, index) in joinCrowdAll\"\n                :key=\"index\"\n                :value=\"item.value\"\n              >\n                {{ item.label }}\n              </a-radio>\n            </a-radio-group>\n\n            <a-select\n              v-if=\"crowdType === CROWD_TYPE.CUSTOM\"\n              placeholder=\"请选择参与用户\"\n              v-decorator=\"decorators.activity_rule.crowd_id\"\n            >\n              <a-select-option\n                v-for=\"(item, index) in crowd\"\n                :key=\"index\"\n                :value=\"item.value\"\n              >\n                {{ item.label }}\n              </a-select-option>\n            </a-select>\n          </st-form-item>\n          <st-form-item label=\"抽奖条件\" required>\n            <a-checkbox-group\n              v-decorator=\"decorators.activity_rule.draw_condition\"\n              @change=\"onDrawConditionChange\"\n            >\n              <template v-for=\"(item, index) in drawCondition\">\n                <a-checkbox\n                  :key=\"index\"\n                  :value=\"item.value\"\n                  :disabled=\"\n                    item.value === 2 && pluginStatus.pointActivityAtatus !== 1\n                  \"\n                >\n                  {{ item.label }}\n                  <template\n                    v-if=\"\n                      item.value === 2 && pluginStatus.pointActivityAtatus !== 1\n                    \"\n                  >\n                    <span :class=\"bPage('point-condition-tips')\">\n                      请先开启会员积分功能，\n                    </span>\n                    <st-link\n                      _blank\n                      :class=\"bPage('point-condition-link')\"\n                      value=\"去开启\"\n                      :to=\"{\n                        path:\n                          '/brand/marketing/plugin/member-points/list/setting'\n                      }\"\n                    ></st-link>\n                  </template>\n                </a-checkbox>\n              </template>\n            </a-checkbox-group>\n          </st-form-item>\n          <st-form-item label=\"抽奖机会\" required v-if=\"hasFreeCondition\">\n            <a-radio-group\n              @change=\"getCurTimesType\"\n              v-decorator=\"decorators.activity_rule.draw_times_type\"\n            >\n              <a-radio\n                v-for=\"(item, index) in drawTimesType\"\n                :key=\"index\"\n                :value=\"item.value\"\n              >\n                {{ item.label }}\n              </a-radio>\n            </a-radio-group>\n            <template>\n              <a-form-item v-show=\"timesType === 1\">\n                每人每天有\n                <a-input-number\n                  :min=\"1\"\n                  :max=\"999\"\n                  :step=\"1\"\n                  :precision=\"0\"\n                  @change=\"getPerTimes\"\n                  style=\"width: 100px;\"\n                  placeholder=\"请输入\"\n                  v-decorator=\"decorators.activity_rule.per_times\"\n                ></a-input-number>\n                次\n              </a-form-item>\n            </template>\n            <template>\n              <a-form-item v-show=\"timesType === 2\">\n                每人总共有\n                <a-input-number\n                  :min=\"1\"\n                  :max=\"999\"\n                  :step=\"1\"\n                  :precision=\"0\"\n                  @change=\"getTotalTimes\"\n                  style=\"width: 100px;\"\n                  placeholder=\"请输入\"\n                  v-decorator=\"decorators.activity_rule.total_times\"\n                ></a-input-number>\n                次\n              </a-form-item>\n            </template>\n          </st-form-item>\n          <st-form-item label=\"积分抽奖\" required v-if=\"hasPointsCondition\">\n            可使用\n            <st-input-number\n              type=\"number\"\n              :min=\"1\"\n              :max=\"99999\"\n              :step=\"1\"\n              :precision=\"0\"\n              :disabled=\"pluginStatus.pointActivityAtatus !== 1\"\n              @change=\"getDrawPoints\"\n              style=\"width: 150px;\"\n              placeholder=\"请输入\"\n              v-decorator=\"decorators.activity_rule.draw_points\"\n            >\n              <template slot=\"addonAfter\">\n                积分\n              </template>\n            </st-input-number>\n            兑换一次抽奖机会\n          </st-form-item>\n          <st-form-item label=\" 中奖次数\">\n            每人最多可中奖\n            <a-input-number\n              :min=\"1\"\n              :max=\"999\"\n              :step=\"1\"\n              :precision=\"0\"\n              style=\"width: 100px;\"\n              placeholder=\"请输入\"\n              v-decorator=\"decorators.activity_rule.prize_times\"\n            ></a-input-number>\n            次\n          </st-form-item>\n        </st-form>\n\n        <st-form\n          style=\"width:756px;padding-left:62px;\"\n          :form=\"form\"\n          v-show=\"currentIndex == 2\"\n        >\n          <st-t3 class=\"mg-b24\">奖品设置</st-t3>\n          <st-form-table\n            style=\"border:1px solid rgba(205,212,223,1);padding:12px;\"\n          >\n            <thead>\n              <tr>\n                <template v-for=\"(item, index) in columsTitlelist\">\n                  <th :key=\"index\">{{ item }}</th>\n                </template>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <td colspan=\"6\" class=\"st-form-table__add\">\n                  <st-button\n                    :disabled=\"\n                      $searchQuery.activity_id && $searchQuery.status === 1\n                    \"\n                    @click=\"getCurPrizeIndex(-1)\"\n                    type=\"dashed\"\n                    block\n                    v-if=\"prizeList.length < 7\"\n                    v-modal-link=\"{\n                      name: 'brand-marketing-plugin-add-prize',\n                      on: { change: getPrizeInfo }\n                    }\"\n                  >\n                    新增奖品\n                  </st-button>\n                </td>\n              </tr>\n              <template v-for=\"(item, index) in prizeList\">\n                <tr :key=\"item.id\">\n                  <td>{{ item.prize_name }}</td>\n                  <td>\n                    {{\n                      item.prize_type | enumFilter('plugin.prize_type_setting')\n                    }}\n                  </td>\n                  <td>\n                    {{\n                      item.prize_type === 1\n                        ? item.shop_num ||\n                          (item.support_shop_ids &&\n                            item.support_shop_ids.length)\n                        : item.support_shop_ids && item.support_shop_ids.length\n                    }}\n                  </td>\n                  <td>\n                    <span v-show=\"isShowEditTable !== index\">\n                      {{ item.number }}\n                    </span>\n                    <st-input-number\n                      v-show=\"isShowEditTable === index\"\n                      :min=\"1\"\n                      :max=\"99999\"\n                      :step=\"1\"\n                      :precision=\"0\"\n                      :value=\"item.number\"\n                      :index=\"index\"\n                      @change=\"editTableNum($event, index)\"\n                    ></st-input-number>\n                  </td>\n                  <td>\n                    <span v-show=\"isShowEditTable !== index\">\n                      {{ item.rate }}\n                    </span>\n                    <st-input-number\n                      v-show=\"isShowEditTable === index\"\n                      :min=\"0\"\n                      :max=\"100\"\n                      :float=\"true\"\n                      :value=\"item.rate\"\n                      @change=\"editTableRate($event, index)\"\n                    ></st-input-number>\n                  </td>\n                  <td>\n                    <st-table-actions>\n                      <a @click=\"showEditTable(index)\">\n                        {{ isShowEditTable === index ? '确认' : '编辑' }}\n                      </a>\n                      <a\n                        :disabled=\"deleteBtnStatus\"\n                        href=\"javascript:;\"\n                        @click=\"onDelete(index)\"\n                      >\n                        {{ isShowEditTable === index ? '取消' : '删除' }}\n                      </a>\n                    </st-table-actions>\n                  </td>\n                </tr>\n              </template>\n            </tbody>\n          </st-form-table>\n          <st-t3 class=\"mg-b24 mg-t32\">未中奖设置</st-t3>\n          <st-form-item label=\"名称\" labelWidth=\"40px\" required>\n            <a-input\n              @change=\"getName\"\n              :disabled=\"info.activity_status === ACTIVITY_STATUS.DISABLED\"\n              placeholder=\"请输入未奖品名称\"\n              v-decorator=\"decorators.activity_lucky.lucky_name\"\n            ></a-input>\n          </st-form-item>\n          <st-form-item label=\" 图片\" labelWidth=\"43px\" required>\n            <a-radio-group\n              :disabled=\"info.activity_status === ACTIVITY_STATUS.DISABLED\"\n              v-decorator=\"decorators.activity_lucky.image_default\"\n              @change=\"getNotImgType\"\n            >\n              <a-radio\n                v-for=\"(item, index) in imgType\"\n                :key=\"index\"\n                :value=\"item.value\"\n              >\n                {{ item.label }}\n              </a-radio>\n            </a-radio-group>\n            <div\n              v-if=\"notPrizeImgType === NOT_PRIZE_IMG_TYPE.CUSTOM\"\n              :class=\"bPage('lucky-upload')\"\n            >\n              <st-image-upload\n                width=\"96px\"\n                height=\"96px\"\n                :list=\"fileList\"\n                @change=\"onChangeGetAvatar\"\n                placeholder=\"上传图片\"\n              ></st-image-upload>\n              <span :class=\"bPage('lucky-upload-text')\">\n                请上传jpg、png格式的图片\n              </span>\n            </div>\n\n            <img\n              class=\"default-img\"\n              v-else\n              :src=\"lucky[0].image_url\"\n              alt=\"默认图片\"\n            />\n          </st-form-item>\n        </st-form>\n      </div>\n    </div>\n  </st-mina-panel>\n</template>\n<script>\nimport { MessageService } from '@/services/message.service'\nimport { AddService } from './add.service'\nimport H5Container from '@/views/biz-components/h5/h5-container'\nimport Steps from './components#/step'\nimport { ruleOptions } from './form.config.ts'\nimport { PatternService } from '@/services/pattern.service'\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue'\nimport BrandMarketingPluginAddPrize from '@/views/biz-modals/brand/marketing/plugin/add-prize'\nimport { cloneDeep } from 'lodash-es'\nimport 'swiper/dist/css/swiper.css'\nimport { swiper, swiperSlide } from 'vue-awesome-swiper'\nimport {\n  TIMES_TYPE,\n  CROWD_TYPE,\n  SHARE_TYPE,\n  STOP_SWIPER,\n  ACTIVITY_STATUS,\n  NOT_PRIZE_IMG_TYPE,\n  CONDITION_TYPE\n} from '@/constants/marketing/lottery'\n\nexport default {\n  name: 'PluginLotteryAdd',\n  data(vm) {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      TIMES_TYPE,\n      CROWD_TYPE,\n      SHARE_TYPE,\n      STOP_SWIPER,\n      ACTIVITY_STATUS,\n      NOT_PRIZE_IMG_TYPE,\n      columsTitlelist: [\n        '奖品名称',\n        '奖品类型',\n        '可用门店（家）',\n        '奖品数量（个）',\n        '中奖概率 (%)',\n        '操作'\n      ],\n      info: {},\n      preview: {\n        title: '',\n        startTime: '',\n        endTime: '',\n        perTimes: 0,\n        totalTimes: 0,\n        description: '',\n        remain_points: 0\n      },\n      shareTitle: '',\n      fileList: [],\n      fileShareList: [],\n      prizeList: [],\n      timesType: TIMES_TYPE.DEFAULT,\n      crowdType: CROWD_TYPE.DEFAULT,\n      shareType: SHARE_TYPE.DEFAULT,\n      isStopSwiper: STOP_SWIPER.DEFAULT,\n      stepArr: [\n        {\n          title: '基础信息',\n          key: 1\n        },\n        {\n          title: '抽奖规则',\n          key: 2\n        },\n        {\n          title: '奖项设置',\n          key: 3\n        }\n      ],\n      currentIndex: 0,\n      curPrizeIndex: -1,\n      notPrizeImgType: NOT_PRIZE_IMG_TYPE.DEFAULT,\n      dateRangeVal: [],\n      notPrize: {\n        prize_name: '未中奖',\n        prize: {\n          image_url: ''\n        }\n      },\n      sliderOptions: {\n        autoplay: {\n          delay: 3000,\n          disableOnInteraction: false\n        }\n      },\n      swiperOption: {\n        spaceBetween: 6,\n        slidesPerView: 1.05\n      },\n      defaultValue: [moment().format('HH:mm'), moment('11:59', 'HH:mm')],\n      isShowEditTable: -1,\n      prizeRate: [],\n      prizeNum: [],\n      // 奖品顺序配置， -2代表空， -1 代表未中奖， >=0 为奖品列表的下标， 前三项有-2代表抽奖信息不全，有空项\n      prizeSort: [\n        [-2, -2, -2, -2, -2, -2, -2, -1],\n        [0, -2, -2, -2, -2, -2, -2, -1],\n        [0, 1, -2, -2, -2, -2, -2, -1],\n        // 奖品至少为三个，即以上三个仅做UI展示控制，不会传到后端，\n        [0, 1, 2, -1, 0, 1, 2, -1],\n        [0, -1, 1, -1, 2, -1, 3, -1],\n        [0, -1, 1, -1, 2, 3, 4, -1],\n        [0, 1, 2, -1, 3, 4, 5, -1],\n        [0, 1, 2, 3, 4, 5, 6, -1]\n      ],\n      hasFreeCondition: true,\n      hasPointsCondition: false\n    }\n  },\n  bem: {\n    bPage: 'page-brand-marketing-plugin-lottery-add'\n  },\n  serviceInject() {\n    return {\n      addService: AddService,\n      pattern: PatternService,\n      messageService: MessageService\n    }\n  },\n  rxState() {\n    return {\n      drawCondition: this.addService.drawCondition$,\n      drawTimesType: this.addService.drawTimesType$,\n      invitePoster: this.addService.invitePoster$,\n      wheelDefault: this.addService.wheelDefault$,\n      wheelTurnAround: this.addService.wheelTurnAround$,\n      joinCrowdAll: this.addService.joinCrowdAll$,\n      crowd: this.addService.crowd$,\n      imgType: this.addService.imgType$,\n      prizeInfoList: this.addService.prizeInfoList$,\n      lucky: this.addService.lucky$,\n      prize: this.addService.prize$,\n      share: this.addService.share$,\n      pluginStatus: this.addService.pluginStatus$\n    }\n  },\n  modals: {\n    BrandMarketingPluginAddPrize\n  },\n  components: {\n    H5Container,\n    Steps,\n    swiper,\n    swiperSlide,\n    StImageUpload\n  },\n  mounted() {\n    // this.notPrize.prize = this.lucky[0]\n    if (this.$searchQuery.activity_id) {\n      this.editVIew(this.$searchQuery.activity_id)\n    }\n  },\n  computed: {\n    // hasPointsCondition() {\n    //   return this.form.getFieldValue('draw_condition')\n    // },\n    deleteBtnStatus() {\n      return this.$searchQuery.activity_id && this.$searchQuery.status === 1\n    },\n    currentActive() {\n      if (this.prizeList.length) return 0\n      return -1\n    },\n    prizeListFilters(value) {\n      return this.prizeSort[this.prizeList.length].map((item, index) => {\n        if (item < -1) {\n          return {\n            prize: {\n              image_url: ''\n            },\n            prize_name: ''\n          }\n        } else if (item > -1) {\n          return this.prizeList[item]\n        } else {\n          return {\n            prize: {\n              image_url:\n                this.notPrizeImgType === this.NOT_PRIZE_IMG_TYPE.CUSTOM\n                  ? this.notPrize.prize.image_url\n                  : this.lucky[0].image_url\n            },\n            prize_name: this.notPrize.prize_name\n          }\n        }\n      })\n    }\n  },\n  methods: {\n    showEditTable(index) {\n      if (this.isShowEditTable === index) {\n        this.prizeList[index].number = this.prizeNum[index]\n        this.prizeList[index].rate = this.prizeRate[index]\n        this.isShowEditTable = -1\n      } else {\n        this.isShowEditTable = index\n      }\n    },\n    onDrawConditionChange(val) {\n      this.hasFreeCondition = val.includes(CONDITION_TYPE.FREE)\n      this.hasPointsCondition = val.includes(CONDITION_TYPE.POINTS)\n    },\n    next(para) {\n      if (para.index) {\n        para = para.index - 1\n      }\n      if (para === 0) {\n        this.currentIndex = 0\n      }\n      if (para === 1) {\n        this.form\n          .validate([\n            'activity_base.activity_name',\n            'activity_base.activity_description',\n            'activity_base.wheel_turn_around',\n            'activity_base.wheel_share_default',\n            'activity_base.share_title',\n            'activity_base.activity_sub_name'\n          ])\n          .then(() => {\n            this.currentIndex = para\n          })\n      }\n      if (para === 2) {\n        this.form\n          .validate([\n            'activity_base.activity_name',\n            'activity_base.activity_description',\n            'activity_base.wheel_turn_around',\n            'activity_base.wheel_share_default',\n            'activity_base.share_title',\n            'activity_base.activity_sub_name',\n            'activity_rule.join_crowd_all',\n            'activity_rule.draw_condition',\n            'activity_rule.draw_times_type',\n            'activity_rule.per_times',\n            'activity_rule.draw_points',\n            'activity_rule.total_times'\n          ])\n          .then(() => {\n            this.currentIndex = para\n          })\n      }\n    },\n    onChangeGetAvatar(imageFiles) {\n      this.fileList = cloneDeep(imageFiles)\n      this.notPrize.prize = this.fileList[0]\n      this.$forceUpdate()\n    },\n    onShareChangeGetAvatar(imageFiles) {\n      this.fileShareList = cloneDeep(imageFiles)\n    },\n    onSubmit() {\n      this.form.validate().then(value => {\n        value.activity_base.start_time = this.preview.startTime\n        value.activity_base.end_time = this.preview.endTime\n        value.activity_base.share_title = this.shareTitle\n        // 选择自定义却不传图片\n        value.activity_base.share_bg =\n          this.shareType === SHARE_TYPE.CUSTOM\n            ? this.fileShareList[0] || this.share[0]\n            : this.share[0]\n        value.activity_prizes = this.prizeList\n        value.activity_lucky.lucky =\n          this.notPrizeImgType === NOT_PRIZE_IMG_TYPE.CUSTOM\n            ? this.fileList[0] || this.prize[0]\n            : this.lucky[0]\n        if (\n          this.hasFreeCondition &&\n          this.timesType === 1 &&\n          !value.activity_rule.per_times\n        ) {\n          this.messageService.warn({\n            content: '请填写抽奖次数'\n          })\n          return\n        }\n        if (\n          this.hasFreeCondition &&\n          this.timesType === 2 &&\n          !value.activity_rule.total_times\n        ) {\n          this.messageService.warn({\n            content: '请填写抽奖次数'\n          })\n          return\n        }\n        // 无免费抽奖时也需要设置 默认的免费抽奖参数\n        if (!this.hasFreeCondition) {\n          value.activity_rule.per_times = 0\n          value.activity_rule.total_times = 0\n          value.activity_rule.draw_times_type = 1\n        }\n        value.activity_rule.prize_sort = this.prizeSort[this.prizeList.length]\n        if (this.$searchQuery.activity_id) {\n          value.activity_id = this.$searchQuery.activity_id\n          this.addService.edit(value).subscribe(res => {\n            this.$router.push('./success?id=' + res.id)\n          })\n        } else {\n          this.addService.add(value).subscribe(res => {\n            this.$router.push('./success?id=' + res.id)\n          })\n        }\n      })\n    },\n    getTitle(e) {\n      this.preview.title = e.target.value\n    },\n    getName(e) {\n      this.notPrize.prize_name = e.target.value\n    },\n    getPerTimes(val) {\n      this.preview.perTimes = val\n    },\n    getTotalTimes(val) {\n      this.preview.totalTimes = val\n    },\n    getDrawPoints(val) {\n      this.preview.drawPoints = val\n    },\n    getDescription(val) {\n      this.preview.description = val\n    },\n    // 抽奖次数类型\n    getCurTimesType(e) {\n      this.timesType = e.target.value\n    },\n    // 人群类型\n    getCurCrowdType(e) {\n      this.crowdType = e.target.value\n    },\n    // 分享类型\n    getCurShareType(e) {\n      this.shareType = e.target.value\n    },\n    // 轮播开关\n    stopSwiper(e) {\n      this.isStopSwiper = e.target.value\n    },\n    onDateChange(data, str) {\n      this.preview.startTime = str[0]\n      this.preview.endTime = str[1]\n    },\n    getNotImgType(e) {\n      this.notPrizeImgType = e.target.value\n    },\n    getPrizeInfo(val) {\n      if (this.curPrizeIndex > -1) {\n        this.prizeList.splice(this.curPrizeIndex, 1, val)\n      } else {\n        this.prizeList.push(val)\n        this.prizeRate.push(val.rate)\n        this.prizeNum.push(val.number)\n      }\n    },\n    getCurPrizeIndex(index) {\n      this.curPrizeIndex = index\n    },\n    disabledDate(current) {\n      return (\n        current && current.format('YYYY-MM-DD') < moment().format('YYYY-MM-DD')\n      )\n    },\n    onDelete(para) {\n      if (this.isShowEditTable === para) {\n        this.isShowEditTable = -1\n        return false\n      } else {\n        this.prizeRate.splice(para, 1)\n        this.prizeNum.splice(para, 1)\n      }\n      this.prizeList = this.prizeList.filter((item, index) => {\n        return index !== para\n      })\n    },\n    editTableNum(val, index) {\n      this.prizeNum[index] = val\n    },\n    editTableRate(val, index) {\n      this.prizeRate[index] = val\n    },\n    editVIew(id) {\n      return this.addService.editVIew(id).subscribe(res => {\n        this.info = res\n        this.$nextTick().then(() => {\n          this.form.setFieldsValue({\n            activity_base: res.activity_base,\n            activity_lucky: res.activity_lucky,\n            activity_prizes: res.activity_prizes,\n            activity_rule: res.activity_rule\n          })\n        })\n        this.dateRangeVal = [\n          moment(res.activity_base.start_time.trim()),\n          moment(res.activity_base.end_time.trim())\n        ]\n        this.prizeList = res.activity_prizes\n        res.activity_prizes.forEach((item, index) => {\n          this.prizeNum[index] = item.number\n          this.prizeRate[index] = item.rate\n        })\n        this.hasFreeCondition = res.activity_rule.draw_condition.includes(\n          CONDITION_TYPE.FREE\n        )\n        this.hasPointsCondition = res.activity_rule.draw_condition.includes(\n          CONDITION_TYPE.POINTS\n        )\n        this.preview.startTime = res.activity_base.start_time\n        this.preview.endTime = res.activity_base.end_time\n        this.preview.perTimes = res.activity_rule.per_times\n        this.preview.totalTimes = res.activity_rule.total_times\n        this.preview.description = res.activity_base.activity_description\n        this.preview.title = res.activity_base.activity_sub_name\n        this.notPrize.prize_name = res.activity_lucky.lucky_name\n        this.shareType = res.activity_base.wheel_share_default\n        this.timesType = res.activity_rule.draw_times_type\n        this.isStopSwiper = res.activity_base.wheel_turn_around\n        this.notPrizeImgType = res.activity_lucky.image_default\n        this.shareTitle = res.activity_base.share_title\n        this.share[0].image_id = res.activity_base.share_bg.image_id\n        res.activity_lucky.lucky &&\n          (this.fileList[0] = res.activity_lucky.lucky)\n        this.fileShareList[0] = res.activity_base.share_bg\n        this.prize[0] = res.activity_lucky.lucky\n        if (this.notPrizeImgType === this.NOT_PRIZE_IMG_TYPE.CUSTOM) {\n          this.notPrize.prize = res.activity_lucky.lucky\n        } else {\n          this.notPrize.prize = this.lucky[0]\n        }\n      })\n    }\n  }\n}\n</script>\n"]}]}