{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/layouts/default#/ws-notify.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/layouts/default#/ws-notify.service.ts","mtime":1601345845255},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b, _c, _d, _e, _f, _g;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { TokenService } from '@/services/token.service';\nimport { UserService } from '@/services/user.service';\nimport { AppConfig } from '@/constants/config';\nimport { webSocket } from 'rxjs/webSocket';\nimport { State, Effect } from 'rx-state/src';\nimport { NotificationService } from '@/services/notification.service';\nimport { Injectable } from 'vue-service-app';\nimport { NotifyApi } from '@/api/v1/notify';\nimport { CabinetCallConfirmApi } from '@/api/v1/setting/cabinet/call-confirm';\nimport { MessageService } from '@/services/message.service';\nimport { tap } from 'rxjs/operators';\nimport { anyAll } from '@/operators';\nimport { TEMPERATURE_TYPE } from '@/constants/common/notify';\n\nvar uuidV1 = require('uuid/v1');\n\nvar WsNotifyService = /*#__PURE__*/function () {\n  function WsNotifyService(api, cabinetCallConfirmApi, msg, notificationService, userService, tokenService, appConfig) {\n    _classCallCheck(this, WsNotifyService);\n\n    this.api = api;\n    this.cabinetCallConfirmApi = cabinetCallConfirmApi;\n    this.msg = msg;\n    this.notificationService = notificationService;\n    this.userService = userService;\n    this.tokenService = tokenService;\n    this.appConfig = appConfig;\n    this.token = this.tokenService.token$.value;\n    this.count = 0;\n    this.errCount = 0;\n    this.timer = 0;\n    this.key = 0;\n    this.timerSetTimeout = 0;\n    this.heartBeat = {\n      msg_id: uuidV1(),\n      msg_type: 2,\n      payload: {\n        count: this.count\n      }\n    }; // 设置心跳时间\n\n    this.pingTimeout = 15000;\n    this.open$ = new State({});\n    this.count$ = new State(0);\n    this.systemList$ = new State({});\n    this.activityList$ = new State({});\n    this.notReadNum$ = new State(0);\n    this.loading$ = new State({});\n    this.messageArr = [];\n    this.message$ = new State({});\n    this.user$ = this.userService.user$; //\n  }\n\n  _createClass(WsNotifyService, [{\n    key: \"getWebsocketInstance\",\n    value: function getWebsocketInstance(query) {\n      return this.ws = webSocket({\n        url: \"\".concat(this.appConfig.WEB_SOCKET_DOMAIN, \"?app-id=\").concat(query.appId, \"&token=\").concat(query.token),\n        openObserver: this.open$\n      });\n    }\n  }, {\n    key: \"setHeartBeat\",\n    value: function setHeartBeat() {\n      var _this = this;\n\n      this.send(this.heartBeat);\n      this.timer = setInterval(function () {\n        _this.heartBeat.payload.count = _this.count;\n        _this.heartBeat.msg_id = uuidV1();\n\n        _this.send(_this.heartBeat);\n      }, this.pingTimeout);\n    }\n  }, {\n    key: \"getSystemList\",\n    value: function getSystemList() {\n      var _this2 = this;\n\n      return this.api.getNewAnnouncementSystem().pipe(tap(function (res) {\n        _this2.systemList$.commit(function () {\n          return res.list;\n        });\n      }));\n    }\n  }, {\n    key: \"getActivityList\",\n    value: function getActivityList() {\n      var _this3 = this;\n\n      return this.api.getNewAnnouncementActivity().pipe(tap(function (res) {\n        _this3.activityList$.commit(function () {\n          return res.list;\n        });\n      }));\n    }\n  }, {\n    key: \"getCabinetConfirm\",\n    value: function getCabinetConfirm(msg_id, device_id) {\n      return this.cabinetCallConfirmApi.confirm(msg_id, {\n        device_id: device_id\n      });\n    }\n  }, {\n    key: \"setRead\",\n    value: function setRead() {\n      return this.api.setRead();\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      return anyAll(this.getActivityList(), this.getSystemList());\n    }\n  }, {\n    key: \"initWs\",\n    value: function initWs() {\n      this.getWebsocketInstance({\n        token: this.token,\n        appId: 10000\n      });\n      this.message();\n      this.setHeartBeat();\n    }\n  }, {\n    key: \"getMaMessage\",\n    value: function getMaMessage(msg, maxLength) {\n      var _this4 = this;\n\n      var args = msg.payload.args;\n      var _content = msg.payload.content; // 人体测温警告\n\n      var temperature = args.temperature_type_value === TEMPERATURE_TYPE.DANGER ? 'temperature-danger' : 'temperature-safety';\n      var danger = args.temperature_type_value === TEMPERATURE_TYPE.DANGER ? 'danger' : 'safety';\n      var title = msg.payload.msg_sub_type !== 8 ? msg.payload.title : args.member_name;\n      var config = {\n        customClass: temperature,\n        title: title,\n        content: function content(h) {\n          return msg.payload.msg_sub_type !== 8 ? h('div', {\n            attrs: {\n              class: 'st-ws-notice-description'\n            }\n          }, [h('div', {\n            attrs: {\n              class: 'st-ws-notice-description__content'\n            }\n          }, _content)]) : h('div', {\n            attrs: {\n              class: \"st-ws-notice-description\"\n            }\n          }, [h('div', {\n            attrs: {\n              class: 'st-ws-notice-description__content'\n            }\n          }, \"\\u6210\\u529F\\u8FDB\\u5165(\".concat(args.area_name, \")\")), h('div', {\n            attrs: {\n              class: 'st-ws-notice-description__cunsume  mg-t8'\n            }\n          }, [h('div', {\n            attrs: {\n              class: 'label'\n            }\n          }, '消费方式: '), h('div', {\n            attrs: {\n              class: 'value'\n            }\n          }, args.proof_name)]), h('div', {\n            attrs: {\n              class: 'st-ws-notice-description__detail mg-t8'\n            }\n          }, [h('div', {\n            attrs: {\n              class: 'st-ws-notice-description__member mg-r8'\n            }\n          }, [h('div', {\n            attrs: {\n              class: 'label'\n            }\n          }, '跟进会籍: '), h('div', {\n            attrs: {\n              class: 'value'\n            }\n          }, args.seller_name)]), h('div', {\n            attrs: {\n              class: 'st-ws-notice-description__coach'\n            }\n          }, [h('div', {\n            attrs: {\n              class: 'label'\n            }\n          }, '跟进教练: '), h('div', {\n            attrs: {\n              class: 'value'\n            }\n          }, args.coach_name)]), args.temperature_type_value === 0 ? h('div') : h('div', {\n            attrs: {\n              class: \"st-ws-notice-description__temperature \".concat(danger)\n            }\n          }, [h('span', {\n            attrs: {\n              class: 'temperature-text'\n            }\n          }, \"\".concat(args.temperature_type_text)), h('span', {\n            attrs: {\n              class: 'temperature-value'\n            }\n          }, \"\".concat(args.temperature))])])]);\n        },\n        icon: function icon(h) {\n          return msg.payload.msg_sub_type !== 8 ? h('st-icon', {\n            attrs: {\n              type: 'success',\n              width: '22',\n              color: '#52C41A',\n              height: '100%'\n            }\n          }) : h('img', {\n            attrs: {\n              src: args.image_url,\n              width: '96',\n              height: '100%'\n            }\n          });\n        },\n        duration: 5,\n        onClose: function onClose() {\n          var oldMessage = _this4.messageArr.shift();\n\n          _this4.notificationService.close(oldMessage.key);\n        },\n        key: uuidV1()\n      };\n      this.closeMessageIsOverLimit(maxLength);\n      msg.payload.msg_sub_type === 8 ? this.notificationService.open(config) : this.notificationService.openNormal(config);\n      this.messageArr.push(config);\n    }\n  }, {\n    key: \"getCabinetNotificationConfig\",\n    value: function getCabinetNotificationConfig(msg) {\n      var _this5 = this;\n\n      var args = msg.payload.args;\n      var title = msg.payload.title;\n      var _content2 = msg.payload.content;\n      var key = uuidV1();\n      var config = {\n        customClass: 'st-notification-cabinet-call',\n        title: title,\n        content: function content(h) {\n          return h('div', {\n            attrs: {\n              class: 'st-ws-notice-description'\n            }\n          }, [h('div', {\n            attrs: {\n              class: 'st-ws-notice-description__content'\n            },\n            domProps: {\n              innerHTML: _content2\n            }\n          })]);\n        },\n        btn: function btn(h) {\n          var loading = _this5.loading$.snapshot();\n\n          return h('a-button', {\n            props: {\n              type: 'primary',\n              loading: loading.getCabinetConfirm\n            },\n            on: {\n              click: function click() {\n                // 请求接口\n                _this5.getCabinetConfirm(msg.payload.msgId, args.device_id).subscribe(function (res) {\n                  var oldMessage = _this5.messageArr.filter(function (message) {\n                    return message.key === key;\n                  })[0];\n\n                  _this5.messageArr = _this5.messageArr.filter(function (message) {\n                    return message.key !== key;\n                  });\n\n                  _this5.notificationService.close(oldMessage.key);\n                });\n              }\n            }\n          }, '收到');\n        },\n        icon: function icon(h) {\n          return h('st-icon', {\n            attrs: {\n              type: 'warning',\n              color: '#FF5E41',\n              width: '22',\n              height: '100%'\n            }\n          });\n        },\n        duration: 30,\n        key: key\n      };\n      return config;\n    }\n  }, {\n    key: \"closeMessageIsOverLimit\",\n    value: function closeMessageIsOverLimit(maxLength) {\n      if (this.messageArr.length >= maxLength) {\n        var oldMessage = this.messageArr.shift();\n        this.notificationService.close(oldMessage.key);\n      }\n    }\n  }, {\n    key: \"message\",\n    value: function message() {\n      var _this6 = this;\n\n      this.ws.subscribe(function (msg) {\n        _this6.count++;\n\n        _this6.count$.commit(function () {\n          return _this6.count;\n        });\n\n        _this6.message$.commit(function () {\n          return msg;\n        });\n\n        if (msg.msg_type === 2) {\n          _this6.errCount = 0;\n          return;\n        }\n\n        var maxLength = 3;\n\n        if (msg.msg_type === 1) {\n          _this6.notReadNum$.commit(function () {\n            return msg.payload.not_read_num;\n          });\n        } else if (msg.msg_type === 3) {\n          _this6.notReadNum$.commit(function () {\n            return msg.payload.total;\n          });\n\n          return;\n        } else if (msg.msg_type === 5) {\n          // 月月付\n          return false;\n        } else if (msg.msg_type === 6) {\n          console.log('msg', msg); // 获取提示的config\n\n          var config = _this6.getCabinetNotificationConfig(msg); // 是否超出消息展示上限\n\n\n          _this6.closeMessageIsOverLimit(maxLength); // 开启消息通知\n\n\n          _this6.notificationService.openNormal(config); // 将消息的配置信息放入消息队列中\n\n\n          _this6.messageArr.push(config);\n\n          return;\n        }\n\n        _this6.getMaMessage(msg, maxLength);\n      }, function (err) {\n        _this6.reconnection(err);\n      }, function () {\n        clearInterval(_this6.timer);\n      });\n    }\n  }, {\n    key: \"reconnection\",\n    value: function reconnection(err) {\n      var _this7 = this;\n\n      clearTimeout(this.timerSetTimeout);\n      this.errCount++;\n      var rangeTime = 5000;\n      this.timerSetTimeout = setTimeout(function () {\n        console.log(\"\\u91CD\\u8FDE\\u7B2C\".concat(_this7.errCount, \"\\u6B21, \\u91CD\\u8FDE\\u65F6\\u95F4\").concat(rangeTime / 1000, \"s, \\u6B63\\u5728\\u91CD\\u8FDE...\"), '只重连三次');\n        _this7.errCount === 3 ? clearTimeout(_this7.timerSetTimeout) : _this7.initWs();\n      }, rangeTime);\n      this.errCount === 3 && console.log('websocket关闭连接');\n    }\n  }, {\n    key: \"creatMsgId\",\n    value: function creatMsgId() {\n      return uuidV1();\n    }\n  }, {\n    key: \"send\",\n    value: function send(content) {\n      this.ws.next(content || this.count);\n    }\n  }, {\n    key: \"complete\",\n    value: function complete() {\n      this.ws.complete(function (res) {\n        console.log('complete', res);\n      });\n    }\n  }, {\n    key: \"error\",\n    value: function error() {\n      this.ws.error({\n        code: 4000,\n        reason: 'I think our app just broke!'\n      });\n    }\n  }]);\n\n  return WsNotifyService;\n}();\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [Object, Object]), __metadata(\"design:returntype\", void 0)], WsNotifyService.prototype, \"getCabinetConfirm\", null);\n\nWsNotifyService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof NotifyApi !== \"undefined\" && NotifyApi) === \"function\" ? _a : Object, typeof (_b = typeof CabinetCallConfirmApi !== \"undefined\" && CabinetCallConfirmApi) === \"function\" ? _b : Object, typeof (_c = typeof MessageService !== \"undefined\" && MessageService) === \"function\" ? _c : Object, typeof (_d = typeof NotificationService !== \"undefined\" && NotificationService) === \"function\" ? _d : Object, typeof (_e = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _e : Object, typeof (_f = typeof TokenService !== \"undefined\" && TokenService) === \"function\" ? _f : Object, typeof (_g = typeof AppConfig !== \"undefined\" && AppConfig) === \"function\" ? _g : Object])], WsNotifyService);\nexport { WsNotifyService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/layouts/default#/ws-notify.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { TokenService } from '@/services/token.service'\nimport { UserService } from '@/services/user.service'\nimport { AppConfig } from '@/constants/config'\nimport { webSocket, WebSocketSubject } from 'rxjs/webSocket'\nimport { State, Effect } from 'rx-state/src'\nimport { NotificationService } from '@/services/notification.service'\nimport { Injectable } from 'vue-service-app'\nimport { NotifyApi } from '@/api/v1/notify'\nimport { CabinetCallConfirmApi } from '@/api/v1/setting/cabinet/call-confirm'\nimport { MessageService } from '@/services/message.service'\nimport { tap } from 'rxjs/operators'\nimport { anyAll } from '@/operators'\nimport { TEMPERATURE_TYPE } from '@/constants/common/notify'\nconst uuidV1 = require('uuid/v1')\n@Injectable()\nexport class WsNotifyService {\n  private ws: any\n  private token = this.tokenService.token$.value\n  private count = 0\n  private errCount = 0\n  private timer = 0\n  private key = 0\n  private timerSetTimeout = 0\n  private heartBeat = {\n    msg_id: uuidV1(),\n    msg_type: 2,\n    payload: { count: this.count }\n  }\n  // 设置心跳时间\n  private pingTimeout = 15000\n  open$ = new State({})\n  count$ = new State(0)\n  systemList$ = new State({})\n  activityList$ = new State({})\n  notReadNum$ = new State(0)\n  loading$ = new State({})\n  messageArr: any[] = []\n  message$ = new State({})\n  constructor(\n    private api: NotifyApi,\n    private cabinetCallConfirmApi: CabinetCallConfirmApi,\n    private msg: MessageService,\n    private notificationService: NotificationService,\n    private userService: UserService,\n    private tokenService: TokenService,\n    private appConfig: AppConfig\n  ) {\n    //\n  }\n  user$ = this.userService.user$\n\n  private getWebsocketInstance(query: any) {\n    return (this.ws = webSocket({\n      url: `${this.appConfig.WEB_SOCKET_DOMAIN}?app-id=${query.appId}&token=${query.token}`,\n      openObserver: this.open$\n    }))\n  }\n  setHeartBeat() {\n    this.send(this.heartBeat)\n    this.timer = setInterval(() => {\n      this.heartBeat.payload.count = this.count\n      this.heartBeat.msg_id = uuidV1()\n      this.send(this.heartBeat)\n    }, this.pingTimeout)\n  }\n\n  getSystemList() {\n    return this.api.getNewAnnouncementSystem().pipe(\n      tap((res: any) => {\n        this.systemList$.commit(() => res.list)\n      })\n    )\n  }\n  getActivityList() {\n    return this.api.getNewAnnouncementActivity().pipe(\n      tap((res: any) => {\n        this.activityList$.commit(() => res.list)\n      })\n    )\n  }\n  @Effect()\n  getCabinetConfirm(msg_id: any, device_id: any) {\n    return this.cabinetCallConfirmApi.confirm(msg_id, {\n      device_id\n    })\n  }\n  setRead() {\n    return this.api.setRead()\n  }\n  init() {\n    return anyAll(this.getActivityList(), this.getSystemList())\n  }\n  public initWs() {\n    this.getWebsocketInstance({ token: this.token, appId: 10000 })\n    this.message()\n    this.setHeartBeat()\n  }\n  private getMaMessage(msg: any, maxLength: number) {\n    const args = msg.payload.args\n    const content = msg.payload.content\n    // 人体测温警告\n    const temperature =\n      args.temperature_type_value === TEMPERATURE_TYPE.DANGER\n        ? 'temperature-danger'\n        : 'temperature-safety'\n    const danger =\n      args.temperature_type_value === TEMPERATURE_TYPE.DANGER\n        ? 'danger'\n        : 'safety'\n    const title =\n      msg.payload.msg_sub_type !== 8 ? msg.payload.title : args.member_name\n    const config = {\n      customClass: temperature,\n      title,\n      content: (h: any) => {\n        return msg.payload.msg_sub_type !== 8\n          ? h('div', { attrs: { class: 'st-ws-notice-description' } }, [\n              h(\n                'div',\n                {\n                  attrs: { class: 'st-ws-notice-description__content' }\n                },\n                content\n              )\n            ])\n          : h('div', { attrs: { class: `st-ws-notice-description` } }, [\n              h(\n                'div',\n                {\n                  attrs: { class: 'st-ws-notice-description__content' }\n                },\n                `成功进入(${args.area_name})`\n              ),\n              h(\n                'div',\n                {\n                  attrs: { class: 'st-ws-notice-description__cunsume  mg-t8' }\n                },\n                [\n                  h('div', { attrs: { class: 'label' } }, '消费方式: '),\n                  h('div', { attrs: { class: 'value' } }, args.proof_name)\n                ]\n              ),\n              h(\n                'div',\n                {\n                  attrs: { class: 'st-ws-notice-description__detail mg-t8' }\n                },\n                [\n                  h(\n                    'div',\n                    {\n                      attrs: {\n                        class: 'st-ws-notice-description__member mg-r8'\n                      }\n                    },\n                    [\n                      h('div', { attrs: { class: 'label' } }, '跟进会籍: '),\n                      h('div', { attrs: { class: 'value' } }, args.seller_name)\n                    ]\n                  ),\n                  h(\n                    'div',\n                    {\n                      attrs: { class: 'st-ws-notice-description__coach' }\n                    },\n                    [\n                      h('div', { attrs: { class: 'label' } }, '跟进教练: '),\n                      h('div', { attrs: { class: 'value' } }, args.coach_name)\n                    ]\n                  ),\n                  args.temperature_type_value === 0\n                    ? h('div')\n                    : h(\n                        'div',\n                        {\n                          attrs: {\n                            class: `st-ws-notice-description__temperature ${danger}`\n                          }\n                        },\n                        [\n                          h(\n                            'span',\n                            { attrs: { class: 'temperature-text' } },\n                            `${args.temperature_type_text}`\n                          ),\n                          h(\n                            'span',\n                            { attrs: { class: 'temperature-value' } },\n                            `${args.temperature}`\n                          )\n                        ]\n                      )\n                ]\n              )\n            ])\n      },\n      icon: (h: any) => {\n        return msg.payload.msg_sub_type !== 8\n          ? h('st-icon', {\n              attrs: {\n                type: 'success',\n                width: '22',\n                color: '#52C41A',\n                height: '100%'\n              }\n            })\n          : h('img', {\n              attrs: {\n                src: args.image_url,\n                width: '96',\n                height: '100%'\n              }\n            })\n      },\n      duration: 5,\n      onClose: () => {\n        const oldMessage = this.messageArr.shift()\n        this.notificationService.close(oldMessage.key)\n      },\n      key: uuidV1()\n    }\n    this.closeMessageIsOverLimit(maxLength)\n    msg.payload.msg_sub_type === 8\n      ? this.notificationService.open(config)\n      : this.notificationService.openNormal(config)\n    this.messageArr.push(config)\n  }\n  private getCabinetNotificationConfig(msg: any) {\n    const args = msg.payload.args\n    const title = msg.payload.title\n    const content = msg.payload.content\n    const key = uuidV1()\n    const config = {\n      customClass: 'st-notification-cabinet-call',\n      title,\n      content: (h: any) => {\n        return h('div', { attrs: { class: 'st-ws-notice-description' } }, [\n          h('div', {\n            attrs: { class: 'st-ws-notice-description__content' },\n            domProps: {\n              innerHTML: content\n            }\n          })\n        ])\n      },\n      btn: h => {\n        let loading: any = this.loading$.snapshot()\n        return h(\n          'a-button',\n          {\n            props: {\n              type: 'primary',\n              loading: loading.getCabinetConfirm\n            },\n            on: {\n              click: () => {\n                // 请求接口\n                this.getCabinetConfirm(\n                  msg.payload.msgId,\n                  args.device_id\n                ).subscribe(res => {\n                  const oldMessage = this.messageArr.filter(\n                    message => message.key === key\n                  )[0]\n                  this.messageArr = this.messageArr.filter(\n                    message => message.key !== key\n                  )\n                  this.notificationService.close(oldMessage.key)\n                })\n              }\n            }\n          },\n          '收到'\n        )\n      },\n      icon: (h: any) => {\n        return h('st-icon', {\n          attrs: {\n            type: 'warning',\n            color: '#FF5E41',\n            width: '22',\n            height: '100%'\n          }\n        })\n      },\n      duration: 30,\n      key\n    }\n    return config\n  }\n  private closeMessageIsOverLimit(maxLength: number) {\n    if (this.messageArr.length >= maxLength) {\n      const oldMessage = this.messageArr.shift()\n      this.notificationService.close(oldMessage.key)\n    }\n  }\n  message() {\n    this.ws.subscribe(\n      (msg: any) => {\n        this.count++\n        this.count$.commit(() => this.count)\n        this.message$.commit(() => msg)\n        if (msg.msg_type === 2) {\n          this.errCount = 0\n          return\n        }\n        const maxLength = 3\n        if (msg.msg_type === 1) {\n          this.notReadNum$.commit(() => msg.payload.not_read_num)\n        } else if (msg.msg_type === 3) {\n          this.notReadNum$.commit(() => msg.payload.total)\n          return\n        } else if (msg.msg_type === 5) {\n          // 月月付\n          return false\n        } else if (msg.msg_type === 6) {\n          console.log('msg', msg)\n          // 获取提示的config\n          let config = this.getCabinetNotificationConfig(msg)\n          // 是否超出消息展示上限\n          this.closeMessageIsOverLimit(maxLength)\n          // 开启消息通知\n          this.notificationService.openNormal(config)\n          // 将消息的配置信息放入消息队列中\n          this.messageArr.push(config)\n          return\n        }\n        this.getMaMessage(msg, maxLength)\n      },\n      (err: any) => {\n        this.reconnection(err)\n      },\n      () => {\n        clearInterval(this.timer)\n      }\n    )\n  }\n  reconnection(err: any) {\n    clearTimeout(this.timerSetTimeout)\n    this.errCount++\n    let rangeTime = 5000\n    this.timerSetTimeout = setTimeout(() => {\n      console.log(\n        `重连第${this.errCount}次, 重连时间${rangeTime / 1000}s, 正在重连...`,\n        '只重连三次'\n      )\n      this.errCount === 3 ? clearTimeout(this.timerSetTimeout) : this.initWs()\n    }, rangeTime)\n    this.errCount === 3 && console.log('websocket关闭连接')\n  }\n  creatMsgId() {\n    return uuidV1()\n  }\n  send(content?: any) {\n    this.ws.next(content || this.count)\n  }\n  complete() {\n    this.ws.complete((res: any) => {\n      console.log('complete', res)\n    })\n  }\n  error() {\n    this.ws.error({ code: 4000, reason: 'I think our app just broke!' })\n  }\n}\n"],"sourceRoot":""}]}