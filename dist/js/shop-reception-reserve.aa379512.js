(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["shop-reception-reserve"],{"4b12":function(e,t,n){"use strict";n.r(t),n.d(t,"CourseService",(function(){return y}));var s,i,r,a,c,o=n("d225"),u=n("b0b4"),d=n("9ab4"),l=n("c523"),h=n("0cd5"),v=n("df29"),p=n("c4cc"),m=n("54da"),f=n("e69b"),_=n("2cbb"),b=n("2138"),y=function(){function e(t,n,s,i){Object(o["a"])(this,e),this.api=t,this.msg=n,this.authService=s,this.userService=i,this.loading$=new v["d"]({}),this.page$=new v["d"]({}),this.list$=new v["d"]([]),this.auth$=this.authService.authMap$({export:"shop:front_end:module|reserve_export"}),this.courseTypeOptions$=this.userService.getOptions$("reserve.course_type",{addAll:"全部课程类型"}),this.reserveStatusOptions$=this.userService.getOptions$("reserve.reserve_status",{addAll:"全部预约状态"}),this.checkinOptions$=this.userService.getOptions$("reserve.is_checkin",{addAll:"全部签到状态"})}return Object(u["a"])(e,[{key:"getList",value:function(e){var t=this;return this.api.getCourseReserve(e).pipe(Object(p["a"])((function(e){t.list$.commit((function(){return e.list})),t.page$.commit((function(){return e.page}))})))}},{key:"confirmVisitReserve",value:function(e){var t=this;return this.api.confirmCourseReserve(e).pipe(Object(p["a"])((function(e){t.msg.success({content:"签到成功"})})))}},{key:"cancelVisitReserve",value:function(e){var t=this;return this.api.cancelCourseReserve(e).pipe(Object(p["a"])((function(e){t.msg.success({content:"取消预约成功"})})))}},{key:"init",value:function(e){return Object(m["a"])([this.getList(e)])}},{key:"beforeEach",value:function(e){return this.init(e.meta.query)}}]),e}();Object(d["b"])([Object(v["c"])(),Object(d["d"])("design:type",Function),Object(d["d"])("design:paramtypes",["function"===typeof(s="undefined"!==typeof l["GetReserveCourse"]&&l["GetReserveCourse"])?s:Object]),Object(d["d"])("design:returntype",void 0)],y.prototype,"getList",null),y=Object(d["b"])([Object(h["b"])(),Object(d["d"])("design:paramtypes",["function"===typeof(i="undefined"!==typeof l["d"]&&l["d"])?i:Object,"function"===typeof(r="undefined"!==typeof f["a"]&&f["a"])?r:Object,"function"===typeof(a="undefined"!==typeof _["a"]&&_["a"])?a:Object,"function"===typeof(c="undefined"!==typeof b["a"]&&b["a"])?c:Object])],y)},a143:function(e,t,n){"use strict";n.r(t);var s,i,r,a,c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.b()},[n("st-table-header-section",{staticClass:"mg-b24",class:e.b("nav")},[n("st-button",{staticClass:"shop-member-list-button",attrs:{type:"primary",icon:"add"},on:{click:e.onAddReverse}},[e._v("\n      到访预约\n    ")]),n("div",{attrs:{slot:"actions"},slot:"actions"},[n("st-range-picker",{staticClass:"value",on:{change:e.onSearchNative},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1)],1),n("st-table",{staticClass:"mg-t16",attrs:{columns:e.columns,rowKey:"id",page:e.page$,loading:e.loading$.getList,dataSource:e.list$},on:{change:e.onTableChange},scopedSlots:e._u([{key:"reserve_type",fn:function(t){return n("span",{},[e._v(e._s(t.name))])}},{key:"member",fn:function(t){return n("span",{},[e._v(e._s(t.name))])}},{key:"reserve_status",fn:function(t){return n("span",{},[e._v(e._s(t.name))])}},{key:"action",fn:function(t,s){return n("div",{},[s.reserve_type.id===e.RESERVE_TYPE.COURSE?n("st-table-actions",[s.auth["shop:reserve:course_reserve|del"]?n("a",{on:{click:function(t){return e.onClickCancel(s)}}},[e._v("\n          取消\n        ")]):e._e(),s.auth["shop:reserve:course_reserve|checkin"]?n("a",{on:{click:function(t){return e.onClickCourseSign(s)}}},[e._v("\n          签到\n        ")]):e._e(),s.reserve_status.id===e.VISIT_STATUS.RESERVED?n("a",{on:{click:function(t){return e.onPrint(s.id)}}},[e._v("\n          打印小票\n        ")]):e._e()]):e._e(),s.reserve_type.id===e.RESERVE_TYPE.VISIT?n("st-table-actions",[s.auth["shop:reserve:visit_reserve|del"]?n("a",{on:{click:function(t){return e.onClickCancelVisitReserve(s)}}},[e._v("\n          取消\n        ")]):e._e(),s.auth["shop:reserve:visit_reserve|checkin"]?n("a",{on:{click:function(t){return e.onClickconfirmVisitReserve(s)}}},[e._v("\n          确认到访\n        ")]):e._e()]):e._e()],1)}}])})],1)},o=[],u=n("ea3e"),d=n("c72b"),l=n("da8a"),h=function(){return[{title:"预约时间",dataIndex:"reserve_time",scopedSlots:{customRender:"reserve_time"}},{title:"预约用户",dataIndex:"member",scopedSlots:{customRender:"member"}},{title:"预约用户手机号",dataIndex:"mobile",scopedSlots:{customRender:"mobile"}},{title:"预约类型",dataIndex:"reserve_type",scopedSlots:{customRender:"reserve_type"}},{title:"预约课程",dataIndex:"reserve_course_name",scopedSlots:{customRender:"reserve_course_name"}},{title:"预约状态",dataIndex:"reserve_status",scopedSlots:{customRender:"reserve_status"}},{title:"接待人",dataIndex:"receptionist_name",scopedSlots:{customRender:"receptionist_name"}},{title:"操作",dataIndex:"action",fixed:"right",width:140,scopedSlots:{customRender:"action"}}]};(function(e){e[e["RESERVED"]=1]="RESERVED",e[e["VISITED"]=2]="VISITED",e[e["CANCELED"]=3]="CANCELED"})(s||(s={})),function(e){e[e["RESERVEING"]=2]="RESERVEING",e[e["RESERVED"]=3]="RESERVED",e[e["SIGNED"]=4]="SIGNED",e[e["CANCELED"]=5]="CANCELED"}(i||(i={})),function(e){e[e["COURSE"]=1]="COURSE",e[e["VISIT"]=2]="VISIT"}(r||(r={})),function(e){e[e["PERSONAL"]=1]="PERSONAL",e[e["DESOPOSIT"]=2]="DESOPOSIT",e[e["WECHAT"]=3]="WECHAT"}(a||(a={}));var v={name:"ReceptionReserve",mixins:[u["a"]],modals:{FrontAddReserve:l["a"]},bem:{b:"page-shop-reception-reserve-visit"},serviceInject:function(){return{service:d["VisitService"]}},rxState:function(){var e=this.service,t=e.loading$,n=e.page$,s=e.list$;return{loading$:t,page$:n,list$:s}},data:function(){return{VISIT_STATUS:s,COURSE_STATUS:i,RESERVE_TYPE:r,date:[]}},computed:{columns:h},methods:{onAddReverse:function(){var e=this;this.$modalRouter.push({name:"front-add-reserve",on:{success:function(){e.$router.reload()}}})},onClickCancelVisitReserve:function(e){var t=this;this.service.cancelVisitReserve(e.id).subscribe((function(e){t.$router.reload()}))},onClickconfirmVisitReserve:function(e){var t=this;this.service.confirmVisitReserve(e.id).subscribe((function(e){t.$router.reload()}))},onSearchNative:function(){var e=this.date[0]?"".concat(this.date[0].format("YYYY-MM-DD")," 00:00"):"",t=this.date[1]?"".concat(this.date[1].format("YYYY-MM-DD")," 23:59"):"";this.$searchQuery.start_time=e,this.$searchQuery.end_time=t,this.onSearch()},init:function(){var e=this.$searchQuery.start_time?moment(this.$searchQuery.start_time):null,t=this.$searchQuery.end_time?moment(this.$searchQuery.end_time):null;this.$set(this,"date",[e,t])},onReset:function(){this.$set(this,"date",[moment(),moment()]),this.onSearchReset()},onPrint:function(e){window.open("/ticket/print?id="+e,"_blank","width=800,height=600")}},created:function(){this.init()}},p=v,m=n("2877"),f=Object(m["a"])(p,c,o,!1,null,null,null);t["default"]=f.exports},c72b:function(e,t,n){"use strict";n.r(t),n.d(t,"VisitService",(function(){return m}));var s,i,r,a=n("d225"),c=n("b0b4"),o=n("9ab4"),u=n("c523"),d=n("0cd5"),l=n("df29"),h=n("c4cc"),v=n("54da"),p=n("e69b"),m=function(){function e(t,n){Object(a["a"])(this,e),this.api=t,this.msg=n,this.loading$=new l["d"]({}),this.page$=new l["d"]({}),this.list$=new l["d"]([])}return Object(c["a"])(e,[{key:"getList",value:function(e){var t=this;return this.api.getList(e).pipe(Object(h["a"])((function(e){t.list$.commit((function(){return e.list})),t.page$.commit((function(){return e.page}))})))}},{key:"confirmVisitReserve",value:function(e){var t=this;return this.api.confirmVisitReserve(e).pipe(Object(h["a"])((function(e){t.msg.success({content:"确认到访成功"})})))}},{key:"cancelVisitReserve",value:function(e){var t=this;return this.api.cancelVisitReserve(e).pipe(Object(h["a"])((function(e){t.msg.success({content:"取消到访预约成功"})})))}},{key:"init",value:function(e){return Object(v["a"])([this.getList(e)])}},{key:"beforeEach",value:function(e){return this.init(e.meta.query)}}]),e}();Object(o["b"])([Object(l["c"])(),Object(o["d"])("design:type",Function),Object(o["d"])("design:paramtypes",["function"===typeof(s="undefined"!==typeof u["GetListInput"]&&u["GetListInput"])?s:Object]),Object(o["d"])("design:returntype",void 0)],m.prototype,"getList",null),m=Object(o["b"])([Object(d["b"])(),Object(o["d"])("design:paramtypes",["function"===typeof(i="undefined"!==typeof u["d"]&&u["d"])?i:Object,"function"===typeof(r="undefined"!==typeof p["a"]&&p["a"])?r:Object])],m)},de5a:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.b()},[n("st-table-header-section",{staticClass:"mg-b16",class:e.b("nav")},[e.auth.export?n("st-button",{directives:[{name:"export-excel",rawName:"v-export-excel",value:{type:"reserve",query:e.reserveQuery},expression:"{\n        type: 'reserve',\n        query: reserveQuery\n      }"}],staticClass:"mg-r8",attrs:{type:"primary"}},[e._v("\n      全部导出\n    ")]):e._e(),n("div",{attrs:{slot:"actions"},slot:"actions"},[n("custom-radio-group",{on:{change:e.recentChange}})],1),n("a-select",{staticClass:"mg-r8",staticStyle:{width:"160px"},attrs:{options:e.courseTypeOptions},on:{change:e.onSearch},model:{value:e.$searchQuery.course_type,callback:function(t){e.$set(e.$searchQuery,"course_type",t)},expression:"$searchQuery.course_type"}}),n("a-select",{staticClass:"mg-r8",staticStyle:{width:"160px"},attrs:{options:e.reserveStatusOptions},on:{change:e.onSearch},model:{value:e.$searchQuery.reserve_status,callback:function(t){e.$set(e.$searchQuery,"reserve_status",t)},expression:"$searchQuery.reserve_status"}}),n("a-select",{staticClass:"mg-r8",staticStyle:{width:"160px"},attrs:{options:e.checkinOptions},on:{change:e.onSearch},model:{value:e.$searchQuery.is_checkin,callback:function(t){e.$set(e.$searchQuery,"is_checkin",t)},expression:"$searchQuery.is_checkin"}})],1),n("div",{class:e.b("table")},[n("st-table",{attrs:{page:e.page,loading:e.loading.getList,columns:e.mainColumns,dataSource:e.list,stripe:!1,rowKey:"id"},on:{change:e.onTableChange},scopedSlots:e._u([{key:"sub_reserve_type",fn:function(t){return[e._v("\n        "+e._s(t.name)+"\n      ")]}},{key:"remark",fn:function(e){return[n("st-overflow-text",{attrs:{value:e.remark,maxWidth:"200px",placement:"bottomLeft",needOverflowTextContainer:""}})]}},{key:"expandedRowRender",fn:function(t,s){return n("st-table",{staticClass:"reserve-course-child-table",attrs:{columns:e.childColumns,dataSource:t.list,pagination:!1,rowKey:"id"},scopedSlots:e._u([{key:"member",fn:function(t){return n("span",{},[e._v(e._s(t.name))])}},{key:"reserve_status",fn:function(t){return[e._v("\n          "+e._s(t.name)+"\n        ")]}},{key:"is_checkin",fn:function(t){return[e._v("\n          "+e._s(t.name)+"\n        ")]}},{key:"checkin_method",fn:function(t){return[e._v("\n          "+e._s(t.name)+"\n        ")]}},{key:"action",fn:function(t,i){return n("div",{},[n("st-table-actions",[i.auth["shop:reserve:course_reserve|del"]?n("a",{on:{click:function(t){return e.cancelBooking(i,s)}}},[e._v("\n              取消预约\n            ")]):e._e(),i.auth["shop:reserve:course_reserve|checkin"]?n("a",{on:{click:function(t){return e.booking(i,s)}}},[e._v("\n              签到\n            ")]):e._e(),1===i.reserve_status.id&&1===i.is_checkin.id?n("a",{on:{click:function(t){return e.onPrint(i.id)}}},[e._v("\n              打印小票\n            ")]):e._e()])],1)}}])})}}])})],1)],1)},i=[],r=n("ea3e"),a=function(e){return[{title:"课程类型",dataIndex:"sub_reserve_type",scopedSlots:{customRender:"sub_reserve_type"}},{title:"上课时间",dataIndex:"course_time"},{title:"课程名称",dataIndex:"reserve_course_name"},{title:"教练昵称",dataIndex:"reserve_coach_name"},{title:"预约人数",dataIndex:"reserved_num"},{title:"签到人数",dataIndex:"checkin_num"},{title:"备注",width:200,scopedSlots:{customRender:"remark"}}]},c=function(e){return[{title:"姓名",width:90,dataIndex:"member",scopedSlots:{customRender:"member"}},{title:"电话",dataIndex:"mobile"},{title:"预约人数",dataIndex:"reserved_num"},{title:"预约凭证",dataIndex:"reserve_consume"},{title:"使用额度",dataIndex:"consume_unit_num"},{title:"预约状态",dataIndex:"reserve_status",scopedSlots:{customRender:"reserve_status"}},{title:"签到状态",dataIndex:"is_checkin",scopedSlots:{customRender:"is_checkin"}},{title:"签到方式",dataIndex:"checkin_method",scopedSlots:{customRender:"checkin_method"}},{title:"预约时间",dataIndex:"reserve_time"},{title:"操作",dataIndex:"action",width:140,scopedSlots:{customRender:"action"}}]},o=n("4b12"),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.b()},[n("a-radio-group",{model:{value:e.recent,callback:function(t){e.recent=t},expression:"recent"}},e._l(e.days,(function(t){return n("a-radio-button",{key:t.id,attrs:{value:t.id}},[e._v("\n      "+e._s(t.name)+"\n    ")])})),1),n("a-range-picker",e._b({class:[e.b("range"),{active:!e.recent}],attrs:{disabledDate:e.disabledDate},on:{change:e.recentChange},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}},"a-range-picker",e.$attrs,!1))],1)},d=[],l=n("c32d"),h=n.n(l),v={name:"StCustomRadioGroup",bem:{b:"st-recent-radio-group"},props:{days:{type:Array,default:function(){return[{id:1,name:"今日"},{id:2,name:"昨日"},{id:3,name:"明日"}]}},value:{type:Object,default:function(){return{recent:void 0,start_time:void 0,end_time:void 0}}}},data:function(){return{recent:1,dateRange:[]}},watch:{recent:function(e){e&&(this.$emit("change",{recent:e,start_time:void 0,end_time:void 0}),this.dateRange=[])}},mounted:function(){this.value.start_date&&this.value.end_date?(this.recent=!1,this.dateRange=[h()(this.value.start_date),h()(this.value.end_date)]):this.dateRange=[],this.value.recent&&(this.recent=this.value.recent)},methods:{moment:h.a,recentChange:function(e,t){this.recent=void 0,this.$emit("change",{recent:void 0,start_time:e[0],end_time:e[1]})},disabledDate:function(e){return this.$attrs.disabledDate?this.$attrs.disabledDate(e):e&&e>h()().add(6,"months")}}},p=v,m=n("2877"),f=Object(m["a"])(p,u,d,!1,null,null,null),_=f.exports,b={name:"",bem:{b:"shop-reception-reserve-course"},components:{CustomRadioGroup:_},modals:{},serviceInject:function(){return{courseService:o["CourseService"]}},rxState:function(){var e=this.courseService;return{list:e.list$,page:e.page$,loading:e.loading$,auth:e.auth$,courseTypeOptions:e.courseTypeOptions$,reserveStatusOptions:e.reserveStatusOptions$,checkinOptions:e.checkinOptions$}},mixins:[r["a"]],props:{},data:function(){return{reserveQuery:{end_time:"",search_date:1,start_time:""}}},computed:{mainColumns:a,childColumns:c},mounted:function(){},methods:{moment:h.a,recentChange:function(e){var t=e.start_time?"".concat(e.start_time.format("YYYY-MM-DD")," 00:00"):"",n=e.end_time?"".concat(e.end_time.format("YYYY-MM-DD")," 23:59"):"",s=e.recent;this.$searchQuery.search_date=e.recent||void 0,this.$searchQuery.start_time=t||void 0,this.$searchQuery.end_time=n||void 0,(this.$searchQuery.start_time||this.$searchQuery.end_time)&&(this.$searchQuery.search_date=void 0,s=void 0),this.reserveQuery={start_time:t,end_time:n,search_date:s},this.onMultiSearch(this.reserveQuery)},getCourseForm:function(e,t){var n=e.id,s=e.member,i=this.list[t].sub_reserve_type;return{id:s.id,reserve_type:i.id,reserve_id:n}},cancelBooking:function(e,t){var n=this,s=this.getCourseForm(e,t);this.courseService.cancelVisitReserve(s).subscribe((function(e){n.$router.reload()}))},booking:function(e,t){var n=this,s=this.getCourseForm(e,t);this.courseService.confirmVisitReserve(s).subscribe((function(e){n.$router.reload()}))},onPrint:function(e){window.open("/ticket/print?id="+e,"_blank","width=800,height=600")},onSearch:function(){this.$router.push({query:this.$searchQuery})}}},y=b,g=Object(m["a"])(y,s,i,!1,null,"c3e97570",null);t["default"]=g.exports}}]);