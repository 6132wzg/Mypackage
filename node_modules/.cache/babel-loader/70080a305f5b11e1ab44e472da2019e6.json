{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/face-upload/face-upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/face-upload/face-upload.vue","mtime":1600926555676},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { OssService } from '@/services/oss.service';\nimport { AppConfig } from '@/constants/config';\nimport { MessageService } from '@/services/message.service';\nimport FaceRecognition from '@/views/biz-modals/face/recognition';\nvar defaultSize = {\n  w: '182px',\n  h: '114px'\n};\nexport default {\n  name: 'StFaceUpload',\n  serviceInject: function serviceInject() {\n    return {\n      oss: OssService,\n      appConfig: AppConfig,\n      messageService: MessageService\n    };\n  },\n  modals: {\n    FaceRecognition: FaceRecognition\n  },\n  props: {\n    numLimit: {\n      type: Number,\n      default: 1\n    },\n\n    /**\n     * 上传按钮的文字\n     */\n    placeholder: {\n      type: String,\n      default: '上传照片'\n    },\n\n    /**\n     * 图片及上传按钮的宽度\n     */\n    width: {\n      type: String,\n      default: defaultSize.w\n    },\n\n    /**\n     * 图片及上传按钮的宽度\n     */\n    height: {\n      type: String,\n      default: defaultSize.h\n    },\n\n    /**\n     * 初始图片列表 example: [{ image_id: 10000, image_key: 'http://styd-saas-test.oss-cn-shanghai.aliyuncs.com/image/pLOFb5kCPN4gPQ8H',image_url:'http://...' }]\n     */\n    list: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n\n    /**\n     * 缩略图filter选项 同imgFilter选项\n     */\n    filterOptions: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n\n    /**\n     * 后端字段映射 image_id,image_key,image_url\n     */\n    props: {\n      type: Object,\n      default: function _default() {\n        return {\n          image_id: 'image_id',\n          image_key: 'image_key',\n          image_url: 'image_url'\n        };\n      }\n    },\n    faceEditAuth: {\n      type: Boolean,\n      default: true\n    },\n    actionAuth: {\n      type: Boolean,\n      default: true\n    }\n  },\n  data: function data() {\n    return {\n      fileList: this.list,\n      isLoading: false,\n      progress: 0,\n      isShowFaceUpload: true\n    };\n  },\n  computed: {\n    imageId: function imageId() {\n      return this.props.image_id;\n    },\n    imageKey: function imageKey() {\n      return this.props.image_key;\n    },\n    imageUrl: function imageUrl() {\n      return this.props.image_url;\n    },\n    sizeStyle: function sizeStyle() {\n      return \"width: \".concat(this.width, \";  height: \").concat(this.height);\n    },\n    computedFilterOptions: function computedFilterOptions() {\n      var w = parseInt(this.width) * 2;\n      var h = parseInt(this.height) * 2;\n      return Object.assign({\n        w: w,\n        h: h\n      }, this.filterOptions);\n    }\n  },\n  watch: {\n    list: {\n      handler: function handler(newList) {\n        console.log('newList', newList);\n        this.isShowFaceUpload = this.list.length < this.numLimit;\n        this.fileList = this.list;\n      },\n      immediate: true\n    }\n  },\n  methods: {\n    handlerOpenFaceModal: function handlerOpenFaceModal() {\n      if (!this.faceEditAuth) {\n        this.messageService.error({\n          content: '无权限'\n        });\n        return false;\n      }\n\n      this.$modalRouter.push({\n        name: 'face-recognition',\n        props: {\n          fileList: this.fileList\n        },\n        on: {\n          change: this.onChange,\n          processChange: this.processChange,\n          loadingChange: this.loadingChange\n        }\n      });\n    },\n    onDel: function onDel() {\n      var fileList = this.fileList;\n      var deletedFile = fileList.splice(0, 1);\n      this.fileList = fileList;\n      this.$emit('delete', deletedFile[0]);\n      this.$emit('change', this.fileList);\n    },\n    onChange: function onChange(list) {\n      this.fileList = list;\n      this.isShowFaceUpload = this.fileList.length < this.numLimit;\n      this.$emit('change', this.fileList);\n    },\n    processChange: function processChange(processNum) {\n      this.progress = processNum;\n    },\n    loadingChange: function loadingChange(status) {\n      this.isLoading = status;\n    }\n  }\n};",{"version":3,"sources":["face-upload.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"st-face-upload\" v-viewer=\"{ url: 'data-src', toolbar: false }\">\n    <div\n      class=\"st-face-upload__item st-preview-item\"\n      v-for=\"(item, index) in fileList\"\n      :key=\"index\"\n    >\n      <img\n        class=\"st-face-upload__item-img\"\n        :src=\"item[imageUrl] || item[imageKey]\"\n        :data-src=\"item[imageUrl] || item[imageKey]\"\n        :style=\"sizeStyle\"\n      />\n      <slot name=\"item-extra\" :item=\"item\" :index=\"index\"></slot>\n    </div>\n\n    <div\n      class=\"st-face-upload__face\"\n      @click=\"handlerOpenFaceModal\"\n      v-show=\"isShowFaceUpload\"\n    >\n      <div class=\"container\">\n        <a-spin :spinning=\"isLoading\" :tip=\"progress + '%'\">\n          <a-icon\n            type=\"plus-circle\"\n            theme=\"filled\"\n            :style=\"{ fontSize: '36px', color: '#9BACB9' }\"\n          />\n          <div class=\"placeholder\">{{ placeholder }}</div>\n        </a-spin>\n      </div>\n    </div>\n    <div\n      class=\"st-face-upload__actions\"\n      v-if=\"$slots.actionContent || (fileList.length && actionAuth)\"\n    >\n      <slot name=\"actionContent\"></slot>\n      <slot name=\"actions\">\n        <span\n          class=\"action\"\n          @click.stop=\"onDel\"\n          v-if=\"fileList.length && actionAuth\"\n        >\n          删除\n        </span>\n      </slot>\n    </div>\n  </div>\n</template>\n<script>\nimport { OssService } from '@/services/oss.service'\nimport { AppConfig } from '@/constants/config'\nimport { MessageService } from '@/services/message.service'\nimport FaceRecognition from '@/views/biz-modals/face/recognition'\nconst defaultSize = {\n  w: '182px',\n  h: '114px'\n}\nexport default {\n  name: 'StFaceUpload',\n  serviceInject() {\n    return {\n      oss: OssService,\n      appConfig: AppConfig,\n      messageService: MessageService\n    }\n  },\n  modals: {\n    FaceRecognition\n  },\n  props: {\n    numLimit: {\n      type: Number,\n      default: 1\n    },\n    /**\n     * 上传按钮的文字\n     */\n    placeholder: {\n      type: String,\n      default: '上传照片'\n    },\n    /**\n     * 图片及上传按钮的宽度\n     */\n    width: {\n      type: String,\n      default: defaultSize.w\n    },\n    /**\n     * 图片及上传按钮的宽度\n     */\n    height: {\n      type: String,\n      default: defaultSize.h\n    },\n    /**\n     * 初始图片列表 example: [{ image_id: 10000, image_key: 'http://styd-saas-test.oss-cn-shanghai.aliyuncs.com/image/pLOFb5kCPN4gPQ8H',image_url:'http://...' }]\n     */\n    list: {\n      type: Array,\n      default: () => []\n    },\n    /**\n     * 缩略图filter选项 同imgFilter选项\n     */\n    filterOptions: {\n      type: Object,\n      default: () => ({})\n    },\n    /**\n     * 后端字段映射 image_id,image_key,image_url\n     */\n    props: {\n      type: Object,\n      default: () => ({\n        image_id: 'image_id',\n        image_key: 'image_key',\n        image_url: 'image_url'\n      })\n    },\n    faceEditAuth: {\n      type: Boolean,\n      default: true\n    },\n    actionAuth: {\n      type: Boolean,\n      default: true\n    }\n  },\n  data() {\n    return {\n      fileList: this.list,\n      isLoading: false,\n      progress: 0,\n      isShowFaceUpload: true\n    }\n  },\n  computed: {\n    imageId() {\n      return this.props.image_id\n    },\n    imageKey() {\n      return this.props.image_key\n    },\n    imageUrl() {\n      return this.props.image_url\n    },\n    sizeStyle() {\n      return `width: ${this.width};  height: ${this.height}`\n    },\n    computedFilterOptions() {\n      const w = parseInt(this.width) * 2\n      const h = parseInt(this.height) * 2\n      return Object.assign({ w, h }, this.filterOptions)\n    }\n  },\n  watch: {\n    list: {\n      handler(newList) {\n        console.log('newList', newList)\n        this.isShowFaceUpload = this.list.length < this.numLimit\n        this.fileList = this.list\n      },\n      immediate: true\n    }\n  },\n  methods: {\n    handlerOpenFaceModal() {\n      if (!this.faceEditAuth) {\n        this.messageService.error({ content: '无权限' })\n        return false\n      }\n      this.$modalRouter.push({\n        name: 'face-recognition',\n        props: {\n          fileList: this.fileList\n        },\n        on: {\n          change: this.onChange,\n          processChange: this.processChange,\n          loadingChange: this.loadingChange\n        }\n      })\n    },\n    onDel() {\n      const { fileList } = this\n      const deletedFile = fileList.splice(0, 1)\n      this.fileList = fileList\n      this.$emit('delete', deletedFile[0])\n      this.$emit('change', this.fileList)\n    },\n    onChange(list) {\n      this.fileList = list\n      this.isShowFaceUpload = this.fileList.length < this.numLimit\n      this.$emit('change', this.fileList)\n    },\n    processChange(processNum) {\n      this.progress = processNum\n    },\n    loadingChange(status) {\n      this.isLoading = status\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-components/face-upload"}]}