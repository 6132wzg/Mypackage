{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/mina/components#/h5/h5-setting-index.component.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/mina/components#/h5/h5-setting-index.component.vue","mtime":1598250255840},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { cloneDeep, omit } from 'lodash-es';\nimport H5ModuleComponent from \"./h5-module.component\";\nimport h5ShopListComponent from \"./h5-shop-list.component\";\nimport h5PhoneComponent from \"./h5-phone.component\";\nimport { H5SettingIndexService } from \"./h5-setting-index.service\";\nimport { swiper, swiperSlide } from 'vue-awesome-swiper';\nimport draggable from 'vuedraggable';\nimport BrandSettingMinaCheckoutShopinfoLayout from '@/views/biz-modals/brand/setting/mina/checkout-shopinfo-layout';\nimport h5FormShopinfoComponent from \"./form-components#/h5-form.shopinfo.component\";\nimport h5FormFnComponent from \"./form-components#/h5-form.fn.component\";\nimport h5FormCoachComponent from \"./form-components#/h5-form.coach.component\";\nimport h5FormCardComponent from \"./form-components#/h5-form.card.component\";\nimport h5FormCourseComponent from \"./form-components#/h5-form.course.component\";\nimport h5FormPackageComponent from \"./form-components#/h5-form.package.component\";\nimport h5FormCouponComponent from \"./form-components#/h5-form.coupon.component\";\nimport h5FormInvitationComponent from \"./form-components#/h5-form.invitation.component\";\nimport h5FormTurntableComponent from \"./form-components#/h5-form.turntable.component\";\nimport h5FormActivityComponent from \"./form-components#/h5-form.activity.component\";\nimport h5FormGroupComponent from \"./form-components#/h5-form.group.component\";\nimport { MessageService } from '@/services/message.service';\nexport default {\n  name: 'H5SettingIndexComponent',\n  components: {\n    H5ModuleComponent: H5ModuleComponent,\n    h5PhoneComponent: h5PhoneComponent,\n    h5ShopListComponent: h5ShopListComponent,\n    swiper: swiper,\n    swiperSlide: swiperSlide,\n    h5FormShopinfoComponent: h5FormShopinfoComponent,\n    h5FormFnComponent: h5FormFnComponent,\n    h5FormCoachComponent: h5FormCoachComponent,\n    h5FormCardComponent: h5FormCardComponent,\n    h5FormCourseComponent: h5FormCourseComponent,\n    h5FormPackageComponent: h5FormPackageComponent,\n    h5FormCouponComponent: h5FormCouponComponent,\n    h5FormInvitationComponent: h5FormInvitationComponent,\n    h5FormTurntableComponent: h5FormTurntableComponent,\n    h5FormActivityComponent: h5FormActivityComponent,\n    h5FormGroupComponent: h5FormGroupComponent,\n    draggable: draggable\n  },\n  bem: {\n    h5: 'h5-setting-index-component'\n  },\n  modals: {\n    BrandSettingMinaCheckoutShopinfoLayout: BrandSettingMinaCheckoutShopinfoLayout\n  },\n  serviceInject: function serviceInject() {\n    return {\n      messageService: MessageService,\n      h5SettingIndexService: H5SettingIndexService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      shopList: this.h5SettingIndexService.shopList$,\n      currentShopInfo: this.h5SettingIndexService.currentShopInfo$,\n      fnModules: this.h5SettingIndexService.fnModules$,\n      modulesData: this.h5SettingIndexService.modulesData$,\n      marketingModules: this.h5SettingIndexService.marketingModules$,\n      loading: this.h5SettingIndexService.loading$\n    };\n  },\n  computed: {\n    moduleType: function moduleType() {\n      return this.modulesData[this.sliderIndex] && this.modulesData[this.sliderIndex];\n    }\n  },\n  data: function data() {\n    return {\n      draggableOptions: {},\n      shopId: '',\n      shopActiveIndex: 0,\n      sliderIndex: 0,\n      phoneIndex: 0,\n      componentList: {\n        1: 'h5FormShopinfoComponent',\n        2: 'h5FormFnComponent',\n        3: 'h5FormCoachComponent',\n        4: 'h5FormCardComponent',\n        5: 'h5FormCourseComponent',\n        6: 'h5FormPackageComponent',\n        12: 'h5FormCouponComponent',\n        13: 'h5FormInvitationComponent',\n        14: 'h5FormTurntableComponent',\n        15: 'h5FormActivityComponent',\n        16: 'h5FormGroupComponent'\n      },\n      isEditFlag: false,\n      canDrag: true\n    };\n  },\n  created: function created() {\n    this.init();\n  },\n  mounted: function mounted() {},\n  watch: {\n    sliderIndex: function sliderIndex(newVal) {\n      if (this.$refs.leftModules) {\n        this.$refs.leftModules.scrollTop = newVal * 72;\n      }\n    }\n  },\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      this.h5SettingIndexService.getShopList().subscribe(function (res) {\n        if (!!res.list.length) {\n          _this.getModuleDataAndShopInfo(res.list[0].shop_id);\n        }\n      });\n    },\n    // 添加模块\n    selectModule: function selectModule(item) {\n      var _this2 = this;\n\n      var showModuleList = this.modulesData.filter(function (item) {\n        return +!item.module_is_delete;\n      });\n\n      if (showModuleList.length === 15) {\n        return this.messageService.warn({\n          content: '小程序最多可添加15个功能模块，当前已达数量上限，请在删除模块后再行添加'\n        });\n      }\n\n      var moduleItem = cloneDeep(item);\n      this.modulesData.push(moduleItem);\n      this.editEmit();\n      setTimeout(function () {\n        _this2.setIndex(_this2.modulesData.length - 1);\n      });\n    },\n    // 门店信息模块切换样式\n    shopDetailChange: function shopDetailChange() {\n      var _this3 = this;\n\n      this.$modalRouter.push({\n        name: 'brand-setting-mina-checkout-shopinfo-layout',\n        props: {\n          layout: this.modulesData[0].content.show_style\n        },\n        on: {\n          success: function success(e) {\n            _this3.editEmit();\n\n            _this3.modulesData[0].content.show_style = e;\n          }\n        }\n      });\n    },\n    // 操作了模块\n    moduleItemChange: function moduleItemChange(module, index) {\n      this.modulesData.splice(index, 1, cloneDeep(module));\n      this.editEmit();\n    },\n    // 删除模块\n    deleteModuleItem: function deleteModuleItem(module, index) {\n      this.editEmit();\n\n      if (+!this.modulesData[index].module_id) {\n        // 新模块module_id为0\n        this.modulesData.splice(index, 1);\n      } else {\n        this.modulesData.splice(index, 1, cloneDeep(module));\n      }\n\n      console.log(this.modulesData);\n      var remainingModules = this.modulesData.slice(index + 1);\n      var moduleNoDelete = [];\n\n      if (remainingModules.length) {\n        remainingModules.forEach(function (item) {\n          if (+!item.module_is_delete) {\n            moduleNoDelete.push(item);\n          }\n        });\n      }\n\n      if (moduleNoDelete.length > 0) {\n        // 向下查找到没有删除的\n        var i = index + 1;\n        var num = 1;\n\n        while (this.modulesData[i].module_is_delete) {\n          i++;\n          num++;\n        }\n\n        this.sliderIndex = i;\n        this.phoneIndex = i - num;\n      } else {\n        // 向上查找到没有删除的\n        var _i = index - 1;\n\n        while (this.modulesData[_i].module_is_delete) {\n          _i--;\n        }\n\n        this.setIndex(_i);\n      }\n    },\n    // 拖拽模块\n    dragModule: function dragModule(e) {\n      this.setIndex(e.moved.newIndex);\n      this.editEmit();\n    },\n    // 点击模块\n    tapModuleItem: function tapModuleItem(module, index) {\n      this.setIndex(index);\n    },\n    // 切换了门店\n    switchShop: function switchShop(shopId) {\n      var _this4 = this;\n\n      if (shopId != this.currentShopInfo.id) {\n        if (this.isEditFlag) {\n          this.$confirm({\n            title: '确定要离开？',\n            content: '此时离开将丢失已编辑的内容，是否确认离开？',\n            onOk: function onOk() {\n              _this4.getModuleDataAndShopInfo(shopId);\n\n              _this4.editEmit(false);\n            }\n          });\n        } else {\n          this.getModuleDataAndShopInfo(shopId);\n        }\n      }\n    },\n    // 手机中点击\n    tapSlide: function tapSlide(_ref) {\n      var sliderIndex = _ref.sliderIndex;\n      this.setIndex(sliderIndex);\n    },\n    // 获取模块数据和门店详情\n    getModuleDataAndShopInfo: function getModuleDataAndShopInfo(shopId) {\n      var _this5 = this;\n\n      this.shopId = shopId;\n      this.shopActiveIndex = this.shopList.findIndex(function (item) {\n        return item.shop_id === shopId;\n      });\n      this.h5SettingIndexService.getShopModules({\n        shop_id: shopId,\n        tab_type: '1'\n      }).subscribe(function (res) {\n        _this5.setIndex(0);\n      });\n      this.h5SettingIndexService.getShopInfo(shopId).subscribe();\n      this.h5SettingIndexService.getModules(shopId).subscribe();\n    },\n    setIndex: function setIndex(index) {\n      this.sliderIndex = this.phoneIndex = index;\n    },\n    saveData: function saveData() {\n      var _this6 = this;\n\n      var modulesData = cloneDeep(this.modulesData);\n\n      for (var i = 0; i < modulesData.length; i++) {\n        if (!modulesData[i].module_is_delete) {\n          if (modulesData[i].module_type === 2) {\n            var noHasImg = modulesData[i].content.list.find(function (list) {\n              return !Object.keys(list.image).length;\n            });\n\n            if (noHasImg) {\n              this.messageService.warn({\n                content: \"\\u8BF7\\u4E0A\\u4F20\".concat(modulesData[i].module_name, \"\\u56FE\\u7247\")\n              });\n              return false;\n            }\n          }\n\n          if (modulesData[i].module_type === 3) {\n            if (modulesData[i].content.list.length && modulesData[i].content.list.length > modulesData[i].max_num) {\n              this.messageService.warn({\n                content: \"\".concat(modulesData[i].module_name, \"\\u6700\\u591A\\u6DFB\\u52A0\").concat(modulesData[i].max_num, \"\\u9879\")\n              });\n              return false;\n            }\n          }\n        }\n      }\n\n      var saveData = modulesData.map(function (item) {\n        item = omit(item, ['is_can_rename', 'is_can_display', 'is_can_delete']);\n\n        if (item.module_type === 3 && !!item.content.list.length) {\n          // 教练模块\n          var coachList = item.content.list.map(function (coach) {\n            return coach.id;\n          });\n          item.content.list = coachList;\n        }\n\n        return item;\n      });\n      console.log(saveData);\n      this.$confirm({\n        title: '',\n        content: '确认将当前设置内容发布到小程序？',\n        onOk: function onOk() {\n          _this6.h5SettingIndexService.saveIndexConfig({\n            shop_id: _this6.shopId,\n            tab_type: 1,\n            module_list: saveData\n          }).subscribe(function (res) {\n            _this6.messageService.success({\n              content: '保存成功'\n            });\n\n            _this6.editEmit(false);\n\n            _this6.getModuleDataAndShopInfo(_this6.shopId);\n\n            _this6.setIndex(0);\n          });\n        }\n      });\n    },\n    editEmit: function editEmit() {\n      var flag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      this.isEditFlag = flag;\n      this.$emit('change', this.isEditFlag);\n    },\n    mouseEvent: function mouseEvent(e) {\n      this.canDrag = e;\n    }\n  }\n};",null]}