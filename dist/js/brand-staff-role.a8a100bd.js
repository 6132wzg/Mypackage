(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["brand-staff-role"],{"2df7":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-spin",{attrs:{spinning:e.loading.getInfo}},[n("div",{staticClass:"page-role-info"},[n("a-row",{staticClass:"page-role-detail"},[n("a-col",{staticClass:"page-role-info-item"},[n("span",{staticClass:"label"},[e._v("角色名称:")]),n("span",{staticClass:"value"},[e._v(e._s(e.info.name))])]),n("a-col",{staticClass:"page-role-info-item"},[n("span",{staticClass:"label"},[e._v("角色描述:")]),n("span",{staticClass:"value"},[e._v(e._s(e.info.role_description))])]),n("a-col",{staticClass:"page-role-info-item"},[n("span",{staticClass:"label"},[e._v("数据权限:")]),n("span",{staticClass:"value"},[e._v(e._s(e.dataGrant))])]),n("a-col",{staticClass:"page-role-detail__funrole"},[n("div",{staticClass:"label"},[n("span",[e._v("功能权限:")])]),n("div",{staticClass:"jurisdiction"},[n("st-container",{staticClass:"brand-list"},[n("p",{staticClass:"brand-list-title"},[e._v("品牌权限")]),n("a-tree",{staticClass:"role-tree",attrs:{showLine:"",treeData:e.brands}})],1),n("st-container",{staticClass:"shop-list"},[n("p",{staticClass:"brand-list-title"},[e._v("门店权限")]),n("a-tree",{staticClass:"role-tree",attrs:{showLine:"",treeData:e.shops}})],1)],1)])],1)],1)])},i=[],r=n("7ae2"),s=n("745c"),o={name:"RoleInfo",serviceInject:function(){return{infoService:r["InfoService"]}},rxState:function(){return{loading:this.infoService.loading$,info:this.infoService.info$,brandList:this.infoService.brandList$,shopList:this.infoService.shopList$,dataGrantList:this.infoService.dataGrant$}},computed:{dataGrant:function(){var e=this.dataGrantList[this.info.data_grant-1].label,t=this.info.departments.map((function(e){return e.department_name})).join(",");return 3===this.info.data_grant?"".concat(e,"  (").concat(t,")"):e},brands:function(){return Object(s["a"])(this.brandList)},shops:function(){return Object(s["a"])(this.shopList)}}},c=o,d=n("2877"),u=Object(d["a"])(c,a,i,!1,null,null,null);t["default"]=u.exports},"4b3b":function(e,t,n){"use strict";n.r(t),n.d(t,"AddService",(function(){return m}));var a,i,r,s=n("d225"),o=n("b0b4"),c=n("9ab4"),d=n("2138"),u=n("0cd5"),l=n("df29"),p=n("ebb6"),f=n("c4cc"),h=n("3bc6"),b=n("9757"),v=n("5c8a"),m=function(){function e(t,n){Object(s["a"])(this,e),this.roleService=t,this.userService=n,this.loading$=new l["d"]({}),this.info$=new l["d"]({}),this.shopList$=new l["d"]({}),this.brandList$=new l["d"]({}),this.dataGrant$=this.userService.getOptions$("data_grant.data_grant").pipe(Object(p["a"])((function(e){var t=Object(v["a"])(e),n=t[2];return t[2]=t[3],t[3]=n,t})))}return Object(o["a"])(e,[{key:"gitInitInfo",value:function(){var e=this;return this.roleService.getInitInfo({role_id:0}).pipe(Object(f["a"])((function(t){e.brandList$.commit((function(){return t.brand_list})),e.shopList$.commit((function(){return t.shop_list}))})))}},{key:"getInfo",value:function(e){var t=this;return this.roleService.getInfo(e).pipe(Object(f["a"])((function(e){t.info$.commit((function(){return e.role}))})))}},{key:"beforeRouteEnter",value:function(e,t){return this.gitInitInfo()}}]),e}();Object(c["b"])([Object(l["c"])(),Object(c["d"])("design:type",Function),Object(c["d"])("design:paramtypes",["function"===typeof(a="undefined"!==typeof h["GetInitInfoPut"]&&h["GetInitInfoPut"])?a:Object]),Object(c["d"])("design:returntype",void 0)],m.prototype,"getInfo",null),m=Object(c["b"])([Object(u["b"])(),Object(c["d"])("design:paramtypes",["function"===typeof(i="undefined"!==typeof b["RoleService"]&&b["RoleService"])?i:Object,"function"===typeof(r="undefined"!==typeof d["a"]&&d["a"])?r:Object])],m)},"745c":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n("7f7f");var a=n("3997"),i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.keyField,i=void 0===n?"id":n,r={};return Object(a["a"])(e,(function(e){r[e[i]]=e})),r},r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.keyField,r=void 0===n?"id":n,s=t.parentField,o=void 0===s?"parent_id":s,c=t.childrenField,d=void 0===c?"children":c,u=t.isLeafField,l=void 0===u?"isLeaf":u,p=t.isParentField,f=void 0===p?"isParent":p,h=i(e,{keyField:r}),b=[];return Object(a["a"])(e,(function(e){var t=e[o];if(e[l]=!0,e.key=e.id,e.title=e.name,e.scopedSlots={title:"title"},t&&h[t]){var n=h[t];n[d]=n[d]||[],-1===n[d].indexOf(e)&&(n[d].push(e),n[l]=!1,n[f]=!0)}else b.push(e)})),b}},"7ae2":function(e,t,n){"use strict";n.r(t),n.d(t,"InfoService",(function(){return O}));n("7f7f"),n("6762"),n("2fdb");var a,i,r,s=n("d225"),o=n("b0b4"),c=n("9ab4"),d=n("2138"),u=n("0cd5"),l=n("df29"),p=n("c4cc"),f=n("d792"),h=n("f59d"),b=n("3bc6"),v=n("9757"),m=n("1b92"),O=function(){function e(t,n){Object(s["a"])(this,e),this.roleService=t,this.userService=n,this.loading$=new l["d"]({}),this.info$=new l["d"]({}),this.shopList$=new l["d"]({}),this.brandList$=new l["d"]({}),this.dataGrant$=this.userService.getOptions$("data_grant.data_grant")}return Object(o["a"])(e,[{key:"gitInitInfo",value:function(e,t){var n=this;return this.roleService.getInitInfo(e).pipe(Object(p["a"])((function(e){var a=e.brand_list.filter((function(e){return t.includes(e.id)})).map((function(e){return e.title=e.name,e.key=e.id,e})),i=e.shop_list.filter((function(e){return t.includes(e.id)})).map((function(e){return e.title=e.name,e.key=e.id,e}));n.brandList$.commit((function(){return a})),n.shopList$.commit((function(){return i}))})))}},{key:"getInfo",value:function(e){var t=this;return this.roleService.getInfo(e).pipe(Object(p["a"])((function(e){t.info$.commit((function(){return e.role}))})),Object(f["a"])((function(n){return t.gitInitInfo(e,n.role.select_ids).pipe(Object(h["a"])((function(){return m["a"]})))})))}},{key:"beforeEach",value:function(e,t){var n=e.query.id;return this.getInfo({role_id:n})}}]),e}();Object(c["b"])([Object(l["c"])(),Object(c["d"])("design:type",Function),Object(c["d"])("design:paramtypes",["function"===typeof(a="undefined"!==typeof b["GetInitInfoPut"]&&b["GetInitInfoPut"])?a:Object]),Object(c["d"])("design:returntype",void 0)],O.prototype,"getInfo",null),O=Object(c["b"])([Object(u["b"])(),Object(c["d"])("design:paramtypes",["function"===typeof(i="undefined"!==typeof v["RoleService"]&&v["RoleService"])?i:Object,"function"===typeof(r="undefined"!==typeof d["a"]&&d["a"])?r:Object])],O)},9757:function(e,t,n){"use strict";n.r(t),n.d(t,"RoleService",(function(){return b}));n("7f7f");var a,i,r=n("d225"),s=n("b0b4"),o=n("9ab4"),c=n("0cd5"),d=n("df29"),u=n("c4cc"),l=n("d792"),p=n("3bc6"),f=n("2cbb"),h=n("ec41"),b=function(){function e(t,n){Object(r["a"])(this,e),this.roleApi=t,this.authService=n,this.roleList$=new d["d"]([]),this.stat$=new d["d"]({}),this.auth$=this.authService.authMap$({add:"brand:auth:role|add",del:"brand:auth:role|del",edit:"brand:auth:role|edit"})}return Object(s["a"])(e,[{key:"getAllList",value:function(){var e=this;return this.roleApi.getAllList().pipe(Object(u["a"])((function(t){e.roleList$.commit((function(){return t.roles})),e.stat$.commit((function(){return t.stat}))})))}},{key:"getInitInfo",value:function(e){return this.roleApi.getInitInfo(e)}},{key:"getInfo",value:function(e){return this.roleApi.getInfo(e)}},{key:"add",value:function(e){var t=this;return this.roleApi.add(e).pipe(Object(l["a"])((function(e){return t.getAllList()})))}},{key:"del",value:function(e){var t=this;return this.roleApi.del(e).pipe(Object(l["a"])((function(e){return t.getAllList()})))}},{key:"update",value:function(e){var t=this;return this.roleApi.update(e).pipe(Object(l["a"])((function(e){return t.getAllList()})))}},{key:"redirect",value:function(e,t,n){"brand-staff-role"===e.name?n({name:"brand-staff-role-info",query:{id:Object(h["a"])(this.roleList$.snapshot(),"0.id")}}):n()}},{key:"beforeRouteEnter",value:function(e,t,n){var a=this;this.getAllList().subscribe((function(){a.redirect(e,t,n)}))}},{key:"beforeRouteUpdate",value:function(e,t,n){this.redirect(e,t,n)}}]),e}();b=Object(o["b"])([Object(c["b"])(),Object(o["d"])("design:paramtypes",["function"===typeof(a="undefined"!==typeof p["b"]&&p["b"])?a:Object,"function"===typeof(i="undefined"!==typeof f["a"]&&f["a"])?i:Object])],b)},ad74:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("st-modal",{attrs:{title:"选择所属部门",size:"small"},on:{ok:e.onSubmit},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[n("department-select",{attrs:{size:"100%",labelInValue:"",treeCheckable:""},model:{value:e.mod,callback:function(t){e.mod=t},expression:"mod"}})],1)},i=[],r=(n("ac6a"),n("9e5b")),s={name:"AddDepartment",data:function(){return{show:!1,treeExpandedKeys:[],mod:void 0,label:[],value:[]}},components:{DepartmentSelect:r["a"]},methods:{onSubmit:function(){var e=this;this.show=!1,this.mod.forEach((function(t){e.label.push(t.label),e.value.push(t.value)})),this.$emit("success",{label:this.label,value:this.value})}}},o=s,c=n("2877"),d=Object(c["a"])(o,a,i,!1,null,null,null);t["a"]=d.exports},d1ae:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page-role-info"},[n("st-form",{staticClass:"page-role-info__add",attrs:{form:e.form,labelWidth:"80px"}},[n("st-form-item",{attrs:{label:"角色名称"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name"],expression:"['name']"}],attrs:{placeholder:"请输入角色名称"}})],1),n("st-form-item",{attrs:{label:"角色描述"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["role_description"],expression:"['role_description']"}],attrs:{placeholder:"请输入角色内容"}})],1),n("st-form-item",{attrs:{label:"数据权限"}},[n("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["data_grant"],expression:"['data_grant']"}],attrs:{name:"radioGroup",options:e.dataGrant},on:{change:e.onChangeDataRegion}}),e.departmentName?n("span",[e._v("("+e._s(e.departmentName)+")")]):e._e()],1),n("st-form-item",{attrs:{label:"功能权限"}},[n("div",{staticClass:"role-list"},[n("st-container",{staticClass:"brand-list mg-r16 pd-x24"},[n("p",[e._v("品牌权限")]),n("st-input-search",{attrs:{placeholder:"请输入",round:"round"},on:{change:e.fileterBrandList}}),n("a-tree",{attrs:{checkable:"",defaultSelectedKeys:["menu:1","menu:2","menu:3"],expandedKeys:e.expandedKeys,autoExpandParent:e.autoExpandParent,treeData:e.brands},on:{expand:e.onExpand,"update:expandedKeys":function(t){e.expandedKeys=t},"update:expanded-keys":function(t){e.expandedKeys=t}},scopedSlots:e._u([{key:"title",fn:function(t){var a=t.title;return[a.indexOf(e.searchValue)>-1?n("span",[e._v("\n                "+e._s(a.substr(0,a.indexOf(e.searchValue)))+"\n                "),n("span",{staticStyle:{color:"#f50"}},[e._v(e._s(e.searchValue))]),e._v("\n                "+e._s(a.substr(a.indexOf(e.searchValue)+e.searchValue.length))+"\n              ")]):n("span",[e._v(e._s(a))])]}}]),model:{value:e.brandIds,callback:function(t){e.brandIds=t},expression:"brandIds"}})],1),n("st-container",{staticClass:"shop-list pd-x24"},[n("p",[e._v("门店权限")]),n("st-input-search",{attrs:{placeholder:"请输入",round:"round"},on:{change:e.fileterShopList}}),n("a-tree",{attrs:{checkable:"",defaultSelectedKeys:["menu:1","menu:2","menu:3"],expandedKeys:e.expandedKeysShop,autoExpandParent:e.autoExpandParentShop,treeData:e.shops},on:{expand:e.onExpand,"update:expandedKeys":function(t){e.expandedKeysShop=t},"update:expanded-keys":function(t){e.expandedKeysShop=t}},scopedSlots:e._u([{key:"title",fn:function(t){var a=t.title;return[a.indexOf(e.searchShopValue)>-1?n("span",[e._v("\n                "+e._s(a.substr(0,a.indexOf(e.searchShopValue)))+"\n                "),n("span",{staticStyle:{color:"#f50"}},[e._v(e._s(e.searchShopValue))]),e._v("\n                "+e._s(a.substr(a.indexOf(e.searchShopValue)+e.searchShopValue.length))+"\n              ")]):n("span",[e._v(e._s(a))])]}}]),model:{value:e.shopIds,callback:function(t){e.shopIds=t},expression:"shopIds"}})],1)],1)])],1),n("div",{staticClass:"page-role-info__btn"},[n("st-button",{staticClass:"mg-r16",attrs:{type:"primary"},on:{click:e.onClickSubmit}},[e._v("\n      保存\n    ")]),n("st-button",{on:{click:e.onCancel}},[e._v("取消")])],1)],1)},i=[],r=(n("8e6e"),n("456d"),n("bd86")),s=(n("4f7f"),n("5df3"),n("1c4c"),n("ac6a"),n("75fc")),o=(n("7f7f"),n("745c")),c=n("9757"),d=n("5c8a"),u=n("4b3b"),l=n("ad74");function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h={name:"AddRole",modals:{RoleDepartment:l["a"]},serviceInject:function(){return{roleService:c["RoleService"],addService:u["AddService"]}},rxState:function(){return{brandList:this.addService.brandList$,shopList:this.addService.shopList$,dataGrant:this.addService.dataGrant$}},data:function(){return{expandedKeys:[],searchValue:"",autoExpandParent:!0,expandedKeysShop:[],searchShopValue:"",departmentName:"",autoExpandParentShop:!0,form:this.$form.createForm(this),brandIds:[],department_ids:[],shopIds:[],brands:[],shops:[]}},methods:{onCancel:function(){this.$router.go(-1)},onExpand:function(e){this.expandedKeys=e,this.autoExpandParent=!1},onExpandShop:function(e){this.expandedKeysShop=e,this.autoExpandParentShop=!1},fileterBrandList:function(e){var t=this,n=e.target.value,a=this.brandList.map((function(e){return e.name.indexOf(n)>-1?getParentKey(e.name,Object(d["a"])(t.brands)):null})).filter((function(e,t,n){return e&&n.indexOf(e)===t}));Object.assign(this,{expandedKeys:a,searchValue:n,autoExpandParent:!0})},fileterShopList:function(e){var t=this,n=e.target.value,a=this.shopList.map((function(e){return e.name.indexOf(n)>-1?getParentKey(e.name,Object(d["a"])(t.shops)):null})).filter((function(e,t,n){return e&&n.indexOf(e)===t}));Object.assign(this,{expandedKeysShop:a,searchShopValue:n,autoExpandParentShop:!0})},onChangeDataRegion:function(e){var t=this;3===e.target.value?this.$modalRouter.push({name:"role-department",on:{success:function(e){t.departmentName=e.label.join(","),t.department_ids=e.value,0===t.department_ids.length&&t.form.setFieldsValue({data_grant:void 0})}}}):(t.departmentName="",t.department_ids=[])},getSelectIds:function(e,t){var n=Object(d["a"])([].concat(Object(s["a"])(this.brandList),Object(s["a"])(this.shopList))),a=[];e.map((function(e){n.forEach((function(t){e===t.id&&a.push(t.parent_id)}))}));var i=Array.from(new Set([].concat(Object(s["a"])(e),a))),r=i.length;return r===t?i:this.getSelectIds(i,r)},onClickSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,n){if(!e){var a=t.getSelectIds(Object(d["a"])([].concat(Object(s["a"])(t.brandIds),Object(s["a"])(t.shopIds)))).filter((function(e){return"menu:0"!==e})),i=f({},n,{select_ids:a,department_ids:t.department_ids});t.roleService.add(i).subscribe(),t.$router.push({name:"brand-staff-role"})}}))}},mounted:function(){this.brands=Object(o["a"])(Object(d["a"])(this.brandList)),this.shops=Object(o["a"])(Object(d["a"])(this.shopList))}},b=h,v=n("2877"),m=Object(v["a"])(b,a,i,!1,null,null,null);t["default"]=m.exports},e21b:function(e,t,n){"use strict";n.r(t),n.d(t,"EditService",(function(){return y}));n("ac6a");var a,i,r,s,o=n("d225"),c=n("b0b4"),d=n("9ab4"),u=n("2138"),l=n("0cd5"),p=n("df29"),f=n("ebb6"),h=n("c4cc"),b=n("3bc6"),v=n("9757"),m=n("e69b"),O=n("5c8a"),g=n("54da"),y=function(){function e(t,n,a){Object(o["a"])(this,e),this.roleService=t,this.msg=n,this.userService=a,this.loading$=new p["d"]({}),this.info$=new p["d"]({}),this.departmentInfo$=new p["d"]({}),this.shopList$=new p["d"]({}),this.brandList$=new p["d"]({}),this.dataGrant$=this.userService.getOptions$("data_grant.data_grant").pipe(Object(f["a"])((function(e){var t=Object(O["a"])(e),n=t[2];return t[2]=t[3],t[3]=n,t})))}return Object(c["a"])(e,[{key:"update",value:function(e){var t=this;return this.roleService.update(e).pipe(Object(h["a"])((function(e){t.msg.success({content:"更新成功"})})))}},{key:"gitInitInfo",value:function(e){var t=this;return this.roleService.getInitInfo(e).pipe(Object(h["a"])((function(e){t.brandList$.commit((function(){return e.brand_list})),t.shopList$.commit((function(){return e.shop_list}))})))}},{key:"getInfo",value:function(e){var t=this;return this.roleService.getInfo(e).pipe(Object(h["a"])((function(e){t.info$.commit((function(){return e.role})),t.departmentInfo$.commit((function(){var t="";return 3===e.role.data_grant&&e.role.departments.forEach((function(e){t?t=t+","+e.department_name:t+=e.department_name})),t}))})))}},{key:"getInit",value:function(e){return Object(g["a"])(this.getInfo(e),this.gitInitInfo(e))}},{key:"beforeEach",value:function(e,t){var n=e.query.roleId;return this.getInit({role_id:n})}}]),e}();Object(d["b"])([Object(p["c"])(),Object(d["d"])("design:type",Function),Object(d["d"])("design:paramtypes",["function"===typeof(a="undefined"!==typeof b["GetInitInfoPut"]&&b["GetInitInfoPut"])?a:Object]),Object(d["d"])("design:returntype",void 0)],y.prototype,"getInfo",null),y=Object(d["b"])([Object(l["b"])(),Object(d["d"])("design:paramtypes",["function"===typeof(i="undefined"!==typeof v["RoleService"]&&v["RoleService"])?i:Object,"function"===typeof(r="undefined"!==typeof m["a"]&&m["a"])?r:Object,"function"===typeof(s="undefined"!==typeof u["a"]&&u["a"])?s:Object])],y)},e39d:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page-role-info"},[n("st-form",{staticClass:"page-role-info__edit",attrs:{form:e.form,labelWidth:"80px"},on:{submit:function(e){e.preventDefault()}}},[n("st-form-item",{attrs:{label:"角色名称"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{initialValue:e.info.name}],expression:"['name', { initialValue: info.name }]"}],attrs:{placeholder:"请输入角色名称"}})],1),n("st-form-item",{attrs:{label:"角色描述"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["role_description",{initialValue:e.info.role_description}],expression:"[\n          'role_description',\n          { initialValue: info.role_description }\n        ]"}],attrs:{placeholder:"请输入角色内容"}})],1),n("st-form-item",{attrs:{label:"数据权限"}},[n("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["data_grant",{initialValue:e.info.data_grant}],expression:"['data_grant', { initialValue: info.data_grant }]"}],attrs:{name:"radioGroup",options:e.dataGrant},on:{change:e.onChangeDataRegion}}),e.departmentInfo?n("span",[e._v("("+e._s(e.departmentInfo)+")")]):e._e()],1),n("st-form-item",{attrs:{label:"功能权限"}},[n("div",{staticClass:"jurisdiction"},[n("st-container",{staticClass:"brand-list"},[n("p",[e._v("品牌权限")]),n("st-input-search",{attrs:{placeholder:"请输入",round:"round"},on:{change:e.fileterBrandList}}),n("a-tree",{attrs:{checkable:"",defaultSelectedKeys:["menu:1","menu:2","menu:3"],expandedKeys:e.expandedKeys,autoExpandParent:e.autoExpandParent,treeData:e.brands},on:{expand:e.onExpand,"update:expandedKeys":function(t){e.expandedKeys=t},"update:expanded-keys":function(t){e.expandedKeys=t}},scopedSlots:e._u([{key:"title",fn:function(t){var a=t.title;return[a.indexOf(e.searchValue)>-1?n("span",[e._v("\n                "+e._s(a.substr(0,a.indexOf(e.searchValue)))+"\n                "),n("span",{staticStyle:{color:"#f50"}},[e._v(e._s(e.searchValue))]),e._v("\n                "+e._s(a.substr(a.indexOf(e.searchValue)+e.searchValue.length))+"\n              ")]):n("span",[e._v(e._s(a))])]}}]),model:{value:e.brandIds,callback:function(t){e.brandIds=t},expression:"brandIds"}})],1),n("st-container",{staticClass:"shop-list"},[n("p",[e._v("门店权限")]),n("st-input-search",{attrs:{placeholder:"请输入",round:"round"},on:{change:e.fileterShopList}}),n("a-tree",{attrs:{checkable:"",defaultSelectedKeys:["menu:1","menu:2","menu:3"],expandedKeys:e.expandedKeysShop,autoExpandParent:e.autoExpandParentShop,treeData:e.shops},on:{expand:e.onExpandShop,"update:expandedKeys":function(t){e.expandedKeysShop=t},"update:expanded-keys":function(t){e.expandedKeysShop=t}},scopedSlots:e._u([{key:"title",fn:function(t){var a=t.title;return[a.indexOf(e.searchShopValue)>-1?n("span",[e._v("\n                "+e._s(a.substr(0,a.indexOf(e.searchShopValue)))+"\n                "),n("span",{staticStyle:{color:"#f50"}},[e._v(e._s(e.searchShopValue))]),e._v("\n                "+e._s(a.substr(a.indexOf(e.searchShopValue)+e.searchShopValue.length))+"\n              ")]):n("span",[e._v(e._s(a))])]}}]),model:{value:e.shopIds,callback:function(t){e.shopIds=t},expression:"shopIds"}})],1)],1)])],1),n("div",{staticClass:"page-role-info__btn"},[n("st-button",{staticClass:"mg-r16",attrs:{type:"primary"},on:{click:e.onClickSubmit}},[e._v("\n      保存\n    ")]),n("st-button",{on:{click:e.onCancel}},[e._v("取消")])],1)],1)},i=[],r=(n("8e6e"),n("456d"),n("6762"),n("2fdb"),n("bd86")),s=(n("4f7f"),n("5df3"),n("1c4c"),n("ac6a"),n("75fc")),o=(n("7f7f"),n("e21b")),c=n("745c"),d=n("5c8a"),u=n("ad74");function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=function e(t,n){for(var a,i=0;i<n.length;i++){var r=n[i];r.children&&(r.children.some((function(e){return e.name===t}))?a=r.key:e(t,r.children)&&(a=e(t,r.children)))}return a},h={name:"EditRole",modals:{RoleDepartment:u["a"]},serviceInject:function(){return{editService:o["EditService"]}},rxState:function(){return{loading:this.editService.loading$,info:this.editService.info$,departmentInfo:this.editService.departmentInfo$,brandList:this.editService.brandList$,shopList:this.editService.shopList$,dataGrant:this.editService.dataGrant$}},data:function(){return{expandedKeys:[],searchValue:"",autoExpandParent:!0,expandedKeysShop:[],searchShopValue:"",autoExpandParentShop:!0,form:this.$form.createForm(this),brandIds:[],department_ids:[],shopIds:[],brands:[],shops:[]}},computed:{id:function(){return this.info.id}},methods:{a:function(){},onCancel:function(){this.$router.go(-1)},onExpand:function(e){this.expandedKeys=e,this.autoExpandParent=!1},onExpandShop:function(e){this.expandedKeysShop=e,this.autoExpandParentShop=!1},fileterBrandList:function(e){var t=this,n=e.target.value,a=this.brandList.map((function(e){return e.name.indexOf(n)>-1?f(e.name,Object(d["a"])(t.brands)):null})).filter((function(e,t,n){return e&&n.indexOf(e)===t}));Object.assign(this,{expandedKeys:a,searchValue:n,autoExpandParent:!0})},fileterShopList:function(e){var t=this,n=e.target.value,a=this.shopList.map((function(e){return e.name.indexOf(n)>-1?f(e.name,Object(d["a"])(t.shops)):null})).filter((function(e,t,n){return e&&n.indexOf(e)===t}));Object.assign(this,{expandedKeysShop:a,searchShopValue:n,autoExpandParentShop:!0})},onChangeDataRegion:function(e){var t=this;3===e.target.value?this.$modalRouter.push({name:"role-department",on:{success:function(e){t.departmentInfo=e.label.join(","),t.department_ids=e.value,0===t.department_ids.length&&t.form.setFieldsValue({data_grant:void 0})}}}):(t.departmentInfo="",t.department_ids=[])},getSelectIds:function(e,t){var n=Object(d["a"])([].concat(Object(s["a"])(this.brandList),Object(s["a"])(this.shopList))),a=[];e.map((function(e){n.forEach((function(t){e===t.id&&a.push(t.parent_id)}))}));var i=Array.from(new Set([].concat(Object(s["a"])(e),a))),r=i.length;return r===t?i:this.getSelectIds(i,r)},onClickSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,n){if(!e){var a=t.getSelectIds(Object(d["a"])([].concat(Object(s["a"])(t.brandIds),Object(s["a"])(t.shopIds)))).filter((function(e){return"menu:0"!==e})),i=p({id:t.id},n,{select_ids:a,department_ids:t.department_ids});t.editService.update(i).subscribe((function(e){t.$router.push({name:"brand-staff-role-info",query:{id:t.id}})}))}}))},isParent:function(e,t,n){if(Array.isArray(t))for(var a=0;a<t.length;a++){var i=t[a];e!==i.key||i.children?this.isParent(e,i.children,n):n.push(e)}}},mounted:function(){var e=this;this.brands=Object(c["a"])(Object(d["a"])(this.brandList)),this.brandList.filter((function(t){return e.info.select_ids.includes(t.id)})).map((function(e){return e.id})).map((function(t){return e.isParent(t,e.brands,e.brandIds)})),this.department_ids=this.info.departments.map((function(e){return e.id})),this.shops=Object(c["a"])(Object(d["a"])(this.shopList)),this.shopList.filter((function(t){return e.info.select_ids.includes(t.id)&&t.id.includes("permission")})).map((function(e){return e.id})).map((function(t){return e.isParent(t,e.shops,e.shopIds)}))}},b=h,v=n("2877"),m=Object(v["a"])(b,a,i,!1,null,null,null);t["default"]=m.exports}}]);