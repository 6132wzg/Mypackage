{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/sold/cabinet/list.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/sold/cabinet/list.vue","mtime":1600926556447},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport { cloneDeep, filter } from 'lodash-es';\nimport { UserService } from '@/services/user.service';\nimport { ListService } from \"./list.service\";\nimport tableMixin from '@/mixins/table.mixin';\nimport { columns } from \"./list.config\";\nimport SoldDealGatheringTip from '@/views/biz-modals/sold/deal/gathering-tip';\nimport SoldDealGathering from '@/views/biz-modals/sold/deal/gathering';\nimport SoldLeaseRefund from '@/views/biz-modals/sold/lease/refund';\nimport SoldLeaseRelet from '@/views/biz-modals/sold/lease/relet';\nimport SoldLeaseTransfer from '@/views/biz-modals/sold/lease/transfer';\nimport useInternalNoteActions from '@/hooks/shop/sold-internal-note-actions.hook';\nimport { PrintService } from '@/services/print.service';\nexport default {\n  name: 'PageShopSoldLease',\n  mixins: [tableMixin],\n  bem: {\n    basic: 'page-shop-sold'\n  },\n  modals: {\n    SoldDealGatheringTip: SoldDealGatheringTip,\n    SoldDealGathering: SoldDealGathering,\n    SoldLeaseRefund: SoldLeaseRefund,\n    SoldLeaseRelet: SoldLeaseRelet,\n    SoldLeaseTransfer: SoldLeaseTransfer\n  },\n  serviceInject: function serviceInject() {\n    return {\n      userService: UserService,\n      listService: ListService,\n      printService: PrintService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.listService.loading$,\n      cabinetStatus: this.listService.cabinetStatus$,\n      page: this.listService.page$,\n      list: this.listService.list$,\n      auth: this.listService.auth$\n    };\n  },\n  computed: {\n    columns: columns,\n    leaseList: function leaseList() {\n      var list = [{\n        value: -1,\n        label: '全部'\n      }];\n      if (!this.cabinetStatus.length) return list;\n      this.cabinetStatus.forEach(function (o) {\n        list.push({\n          value: +o.value,\n          label: o.label\n        });\n      });\n      return list;\n    }\n  },\n  hooks: function hooks() {\n    return {\n      internalNoteActions: useInternalNoteActions()\n    };\n  },\n  data: function data() {\n    return {\n      date: []\n    };\n  },\n  mounted: function mounted() {\n    this.setSearchData();\n  },\n  watch: {\n    query: function query(newVal) {\n      this.setSearchData();\n    }\n  },\n  methods: {\n    // 查询\n    onSearchNative: function onSearchNative() {\n      this.$searchQuery.start_time = this.date[0] ? \"\".concat(this.date[0].format('YYYY-MM-DD'), \" 00:00:00\") : '';\n      this.$searchQuery.end_time = this.date[1] ? \"\".concat(this.date[1].format('YYYY-MM-DD'), \" 23:59:59\") : '';\n      this.onSearch();\n    },\n    // 设置searchData\n    setSearchData: function setSearchData() {\n      var start = this.$searchQuery.start_time ? cloneDeep(moment(this.$searchQuery.start_time)) : null;\n      var end = this.$searchQuery.end_time ? cloneDeep(moment(this.$searchQuery.end_time)) : null;\n      this.date = [start, end];\n    },\n    // 跳转合同\n    toContract: function toContract(record) {\n      var order_id = record.order_id;\n      var url = \"\".concat(window.location.origin, \"/common/contract-preview?id=\").concat(order_id);\n      window.open(url);\n    },\n    // 查看订单\n    createdOrderViewOrder: function createdOrderViewOrder(order_id) {\n      console.log('查看订单');\n      this.$router.push({\n        name: 'shop-finance-order-info-collection-details',\n        query: {\n          id: order_id\n        }\n      });\n    },\n    // 续租\n    onRelet: function onRelet(record) {\n      var _this = this;\n\n      this.$modalRouter.push({\n        name: 'sold-lease-relet',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: function success(result) {\n            if (result.type === 'create') {\n              // 创建订单成功\n              _this.$modalRouter.push({\n                name: 'sold-deal-gathering-tip',\n                props: {\n                  order_id: result.order_id,\n                  type: 'cabinet_order',\n                  message: '订单创建成功',\n                  needPay: true\n                },\n                on: {\n                  success: function success(res) {\n                    _this.$router.reload();\n\n                    _this.tipCallBack(res.orderId, 'cabinet_order', res.type);\n                  }\n                }\n              });\n            } else if (result.type === 'createPay') {\n              // 创建订单成功 并且到支付页面\n              _this.$modalRouter.push({\n                name: 'sold-deal-gathering',\n                props: {\n                  order_id: result.order_id,\n                  type: 'cabinet_order'\n                },\n                on: {\n                  success: function success() {\n                    _this.$modalRouter.push({\n                      name: 'sold-deal-gathering-tip',\n                      props: {\n                        orderId: result.order_id,\n                        type: 'cabinet_order',\n                        message: '收款成功'\n                      },\n                      on: {\n                        success: function success(res) {\n                          _this.$router.reload();\n\n                          _this.tipCallBack(result.order_id, 'cabinet_order', res.type);\n                        }\n                      }\n                    });\n                  }\n                }\n              });\n            }\n          }\n        }\n      });\n    },\n    // 订单收款modal\n    createdOrderPay: function createdOrderPay(props) {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this2.$modalRouter.push({\n          name: 'sold-deal-gathering',\n          props: props,\n          on: {\n            success: resolve\n          }\n        });\n      });\n    },\n    // 订单收款回调\n    payCallBack: function payCallBack(orderId, modalType, callBackType) {\n      var _this3 = this;\n\n      switch (callBackType) {\n        case 'cancel':\n          this.onSearch();\n          break;\n\n        case 'pay':\n          this.createdGatheringTip({\n            message: '收款成功',\n            order_id: orderId\n          }).then(function (res) {\n            _this3.tipCallBack(orderId, modalType, res.type);\n          });\n          break;\n      }\n    },\n    // 提示框回调，gathering-tip\n    tipCallBack: function tipCallBack(orderId, modalType, callBackType) {\n      var _this4 = this;\n\n      switch (callBackType) {\n        case 'cancel':\n          this.$router.reload();\n          break;\n\n        case 'Print':\n          this.toContract({\n            order_id: orderId\n          });\n          break;\n\n        case 'PrintOrder':\n          this.printOrder(orderId);\n          break;\n\n        case 'ViewOrder':\n          this.createdOrderViewOrder(orderId);\n          break;\n\n        case 'Pay':\n          this.createdOrderPay({\n            order_id: orderId,\n            type: modalType\n          }).then(function (res) {\n            _this4.payCallBack(orderId, modalType, res.type);\n          });\n          break;\n      }\n    },\n    // 打印小票\n    printOrder: function printOrder(order_id) {\n      window.open('/ticket/gathering-print?id=' + order_id, '_blank', 'width=800,height=600');\n    },\n    // 转让\n    onTransfer: function onTransfer(record) {\n      var _this5 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-lease-transfer',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: function success(result) {\n            _this5.$router.reload();\n          }\n        }\n      });\n    },\n    // 退款\n    onRefund: function onRefund(record) {\n      var _this6 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-lease-refund',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: function success(result) {\n            _this6.$router.reload();\n          }\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["list.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-panel app initial :class=\"basic()\">\n    <st-input-search\n      slot=\"title\"\n      placeholder=\"请输入租赁柜号、合同编号、会员姓名或手机号查找\"\n      v-model=\"$searchQuery.search\"\n      @search=\"onKeywordsSearch('search', $event)\"\n      style=\"width:400px\"\n    />\n    <st-search-panel @search=\"onSearchNative\" @reset=\"onSearchReset\">\n      <st-search-panel-item label=\"租赁状态：\">\n        <st-search-radio\n          v-model=\"$searchQuery.lease_status\"\n          :options=\"leaseList\"\n        />\n      </st-search-panel-item>\n      <st-search-panel-item label=\"起租时间：\">\n        <st-range-picker :disabledDays=\"180\" v-model=\"date\" />\n      </st-search-panel-item>\n    </st-search-panel>\n\n    <div :class=\"basic('content')\">\n      <div :class=\"basic('content-batch')\">\n        <!-- NOTE: 导出 -->\n        <!-- <st-button v-if=\"auth.export\"  type=\"primary\">批量导出</st-button> -->\n      </div>\n      <st-table\n        :page=\"page\"\n        :loading=\"loading.getList\"\n        rowKey=\"id\"\n        :columns=\"columns\"\n        @change=\"onTableChange\"\n        :dataSource=\"list\"\n      >\n        <template slot=\"lease_status\" slot-scope=\"record\">\n          <st-text\n            class=\"white-nowrap\"\n            :status=\"{\n              success: record.id === 1,\n              error: record.id === 2,\n              warning: record.id === 3\n            }\"\n          >\n            {{ record.name }}\n          </st-text>\n        </template>\n        <template slot=\"member_name\" slot-scope=\"text, record\">\n          <template v-if=\"record.is_minors\">\n            <span class=\"word-break\">{{ record.member_name }}(未成年)</span>\n          </template>\n          <template v-else>\n            <span class=\"word-break\">{{ record.member_name }}</span>\n          </template>\n        </template>\n        <template slot=\"member_mobile\" slot-scope=\"text, record\">\n          <template v-if=\"record.is_minors\">\n            {{ record.parent_mobile }}({{ record.parent_user_role }})\n          </template>\n          <template v-else>\n            {{ record.member_mobile }}\n          </template>\n        </template>\n        <template slot=\"sell_time\" slot-scope=\"text, record\">\n          <span class=\"word-break\">\n            {{ record.start_time }} ~ {{ record.end_time }}\n          </span>\n        </template>\n        <div slot=\"action\" slot-scope=\"text, record\">\n          <st-table-actions>\n            <a\n              v-if=\"record.auth['shop:sold:sold_cabinet|renew']\"\n              @click=\"onRelet(record)\"\n            >\n              续租\n            </a>\n            <a\n              v-if=\"record.auth['shop:sold:sold_cabinet|export_contract']\"\n              @click=\"toContract(record)\"\n            >\n              查看合同\n            </a>\n            <a\n              v-if=\"record.auth['shop:sold:sold_cabinet|transfer']\"\n              @click=\"onTransfer(record)\"\n            >\n              转让\n            </a>\n            <a\n              v-if=\"record.auth['brand_shop:order:order|refund']\"\n              @click=\"onRefund(record)\"\n            >\n              退款\n            </a>\n            <a\n              v-if=\"record.auth['shop:sold:sold_cabinet|internal_description']\"\n              @click=\"internalNoteActions.onOpenModal(record)\"\n            >\n              对内备注\n            </a>\n            <a\n              v-if=\"record.auth['shop:order:order|print']\"\n              @click=\"printService.printSmallTicket(record.order_id)\"\n            >\n              打印小票\n            </a>\n          </st-table-actions>\n        </div>\n      </st-table>\n    </div>\n  </st-panel>\n</template>\n\n<script>\nimport moment from 'moment'\nimport { cloneDeep, filter } from 'lodash-es'\nimport { UserService } from '@/services/user.service'\nimport { ListService } from './list.service'\nimport tableMixin from '@/mixins/table.mixin'\nimport { columns } from './list.config'\nimport SoldDealGatheringTip from '@/views/biz-modals/sold/deal/gathering-tip'\nimport SoldDealGathering from '@/views/biz-modals/sold/deal/gathering'\nimport SoldLeaseRefund from '@/views/biz-modals/sold/lease/refund'\nimport SoldLeaseRelet from '@/views/biz-modals/sold/lease/relet'\nimport SoldLeaseTransfer from '@/views/biz-modals/sold/lease/transfer'\nimport useInternalNoteActions from '@/hooks/shop/sold-internal-note-actions.hook'\nimport { PrintService } from '@/services/print.service'\n\nexport default {\n  name: 'PageShopSoldLease',\n  mixins: [tableMixin],\n  bem: {\n    basic: 'page-shop-sold'\n  },\n  modals: {\n    SoldDealGatheringTip,\n    SoldDealGathering,\n    SoldLeaseRefund,\n    SoldLeaseRelet,\n    SoldLeaseTransfer\n  },\n  serviceInject() {\n    return {\n      userService: UserService,\n      listService: ListService,\n      printService: PrintService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.listService.loading$,\n      cabinetStatus: this.listService.cabinetStatus$,\n      page: this.listService.page$,\n      list: this.listService.list$,\n      auth: this.listService.auth$\n    }\n  },\n  computed: {\n    columns,\n    leaseList() {\n      let list = [{ value: -1, label: '全部' }]\n      if (!this.cabinetStatus.length) return list\n      this.cabinetStatus.forEach(o => {\n        list.push({ value: +o.value, label: o.label })\n      })\n      return list\n    }\n  },\n  hooks() {\n    return {\n      internalNoteActions: useInternalNoteActions()\n    }\n  },\n  data() {\n    return {\n      date: []\n    }\n  },\n  mounted() {\n    this.setSearchData()\n  },\n  watch: {\n    query(newVal) {\n      this.setSearchData()\n    }\n  },\n  methods: {\n    // 查询\n    onSearchNative() {\n      this.$searchQuery.start_time = this.date[0]\n        ? `${this.date[0].format('YYYY-MM-DD')} 00:00:00`\n        : ''\n      this.$searchQuery.end_time = this.date[1]\n        ? `${this.date[1].format('YYYY-MM-DD')} 23:59:59`\n        : ''\n      this.onSearch()\n    },\n    // 设置searchData\n    setSearchData() {\n      const start = this.$searchQuery.start_time\n        ? cloneDeep(moment(this.$searchQuery.start_time))\n        : null\n      const end = this.$searchQuery.end_time\n        ? cloneDeep(moment(this.$searchQuery.end_time))\n        : null\n      this.date = [start, end]\n    },\n    // 跳转合同\n    toContract(record) {\n      const order_id = record.order_id\n      let url = `${window.location.origin}/common/contract-preview?id=${order_id}`\n      window.open(url)\n    },\n    // 查看订单\n    createdOrderViewOrder(order_id) {\n      console.log('查看订单')\n      this.$router.push({\n        name: 'shop-finance-order-info-collection-details',\n        query: {\n          id: order_id\n        }\n      })\n    },\n    // 续租\n    onRelet(record) {\n      this.$modalRouter.push({\n        name: 'sold-lease-relet',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: result => {\n            if (result.type === 'create') {\n              // 创建订单成功\n              this.$modalRouter.push({\n                name: 'sold-deal-gathering-tip',\n                props: {\n                  order_id: result.order_id,\n                  type: 'cabinet_order',\n                  message: '订单创建成功',\n                  needPay: true\n                },\n                on: {\n                  success: res => {\n                    this.$router.reload()\n                    this.tipCallBack(res.orderId, 'cabinet_order', res.type)\n                  }\n                }\n              })\n            } else if (result.type === 'createPay') {\n              // 创建订单成功 并且到支付页面\n              this.$modalRouter.push({\n                name: 'sold-deal-gathering',\n                props: {\n                  order_id: result.order_id,\n                  type: 'cabinet_order'\n                },\n                on: {\n                  success: () => {\n                    this.$modalRouter.push({\n                      name: 'sold-deal-gathering-tip',\n                      props: {\n                        orderId: result.order_id,\n                        type: 'cabinet_order',\n                        message: '收款成功'\n                      },\n                      on: {\n                        success: res => {\n                          this.$router.reload()\n                          this.tipCallBack(\n                            result.order_id,\n                            'cabinet_order',\n                            res.type\n                          )\n                        }\n                      }\n                    })\n                  }\n                }\n              })\n            }\n          }\n        }\n      })\n    },\n    // 订单收款modal\n    createdOrderPay(props) {\n      return new Promise((resolve, reject) => {\n        this.$modalRouter.push({\n          name: 'sold-deal-gathering',\n          props,\n          on: {\n            success: resolve\n          }\n        })\n      })\n    },\n    // 订单收款回调\n    payCallBack(orderId, modalType, callBackType) {\n      switch (callBackType) {\n        case 'cancel':\n          this.onSearch()\n          break\n        case 'pay':\n          this.createdGatheringTip({\n            message: '收款成功',\n            order_id: orderId\n          }).then(res => {\n            this.tipCallBack(orderId, modalType, res.type)\n          })\n          break\n      }\n    },\n    // 提示框回调，gathering-tip\n    tipCallBack(orderId, modalType, callBackType) {\n      switch (callBackType) {\n        case 'cancel':\n          this.$router.reload()\n          break\n        case 'Print':\n          this.toContract({ order_id: orderId })\n          break\n        case 'PrintOrder':\n          this.printOrder(orderId)\n          break\n        case 'ViewOrder':\n          this.createdOrderViewOrder(orderId)\n          break\n        case 'Pay':\n          this.createdOrderPay({ order_id: orderId, type: modalType }).then(\n            res => {\n              this.payCallBack(orderId, modalType, res.type)\n            }\n          )\n          break\n      }\n    },\n    // 打印小票\n    printOrder(order_id) {\n      window.open(\n        '/ticket/gathering-print?id=' + order_id,\n        '_blank',\n        'width=800,height=600'\n      )\n    },\n    // 转让\n    onTransfer(record) {\n      this.$modalRouter.push({\n        name: 'sold-lease-transfer',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: result => {\n            this.$router.reload()\n          }\n        }\n      })\n    },\n    // 退款\n    onRefund(record) {\n      this.$modalRouter.push({\n        name: 'sold-lease-refund',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: result => {\n            this.$router.reload()\n          }\n        }\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/shop/sold/cabinet"}]}