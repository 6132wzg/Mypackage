{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-3!/Users/wangzhigang/Desktop/styd/web/src/services/no-captcha.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/services/no-captcha.service.ts","mtime":1591147717087},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es7.object.values\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar _a;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { Injectable } from 'vue-service-app';\nimport { NotificationService } from \"./notification.service\";\n\nvar NoCaptchaService = /*#__PURE__*/function () {\n  function NoCaptchaService(notification) {\n    _classCallCheck(this, NoCaptchaService);\n\n    this.notification = notification;\n    this.isCreated = false;\n  }\n\n  _createClass(NoCaptchaService, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      if (!this.isCreated) {\n        this.create().then(function () {\n          _this.initNvcOpt(opts);\n        });\n      } else {\n        this.initNvcOpt(opts);\n      }\n    }\n  }, {\n    key: \"create\",\n    value: function create() {\n      var _this2 = this;\n\n      return new Promise(function (resolve) {\n        var script = document.createElement('script');\n        script.src = '//g.alicdn.com/sd/nvc/1.1.112/guide.js';\n\n        script.onload = function () {\n          _this2.isCreated = true;\n          resolve();\n        };\n\n        document.body.appendChild(script);\n      });\n    }\n  }, {\n    key: \"initNvcOpt\",\n    value: function initNvcOpt() {\n      var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      //无痕配置 && 滑动验证、刮刮卡、问答验证码通用配置\n      // @ts-ignore\n      window.NVC_Opt = _objectSpread({}, window.NVC_Opt, {}, opts, {\n        isH5: false,\n        popUp: false,\n        // trans: { nvcCode: 200 },\n        language: 'cn',\n        //滑动验证长度配置\n        // customWidth: 300,\n        //刮刮卡配置项\n        width: 336,\n        height: 100,\n        elements: ['//img.alicdn.com/tfs/TB17cwllsLJ8KJjy0FnXXcFDpXa-50-74.png', '//img.alicdn.com/tfs/TB17cwllsLJ8KJjy0FnXXcFDpXa-50-74.png'],\n        bg_back_prepared: '//img.alicdn.com/tps/TB1skE5SFXXXXb3XXXXXXXXXXXX-100-80.png',\n        bg_front: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABQCAMAAADY1yDdAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAADUExURefk5w+ruswAAAAfSURBVFjD7cExAQAAAMKg9U9tCU+gAAAAAAAAAIC3AR+QAAFPlUGoAAAAAElFTkSuQmCC',\n        obj_ok: '//img.alicdn.com/tfs/TB1rmyTltfJ8KJjy0FeXXXKEXXa-50-74.png',\n        bg_back_pass: '//img.alicdn.com/tfs/TB1KDxCSVXXXXasXFXXXXXXXXXX-100-80.png',\n        obj_error: '//img.alicdn.com/tfs/TB1q9yTltfJ8KJjy0FeXXXKEXXa-50-74.png',\n        bg_back_fail: '//img.alicdn.com/tfs/TB1w2oOSFXXXXb4XpXXXXXXXXXX-100-80.png',\n        upLang: {\n          cn: {\n            _ggk_guide: '请摁住鼠标左键，刮出两面盾牌',\n            _ggk_success: '恭喜您成功刮出盾牌<br/>继续下一步操作吧',\n            _ggk_loading: '加载中',\n            _ggk_fail: ['呀，盾牌不见了<br/>请', 'javascript:noCaptcha.reset()', '再来一次', '或', 'http://survey.taobao.com/survey/QgzQDdDd?token=%TOKEN', '反馈问题'],\n            _ggk_action_timeout: ['我等得太久啦<br/>请', 'javascript:noCaptcha.reset()', '再来一次', '或', 'http://survey.taobao.com/survey/QgzQDdDd?token=%TOKEN', '反馈问题'],\n            _ggk_net_err: ['网络实在不给力<br/>请', 'javascript:noCaptcha.reset()', '再来一次', '或', 'http://survey.taobao.com/survey/QgzQDdDd?token=%TOKEN', '反馈问题'],\n            _ggk_too_fast: ['您刮得太快啦<br/>请', 'javascript:noCaptcha.reset()', '再来一次', '或', 'http://survey.taobao.com/survey/QgzQDdDd?token=%TOKEN', '反馈问题']\n          }\n        },\n        nvcCallback: function nvcCallback(data) {\n          // data为getNVCVal()的值，此函数为二次验证滑动或者刮刮卡通过后的回调函数\n          // data跟业务请求一起上传，由后端请求AnalyzeNvc接口，接口会返回100或者900\n          var el = document.getElementsByClassName('nc_bg')[0];\n          el.style.width = '100%';\n        }\n      });\n    }\n    /**\n     * 判断是否需要唤起验证码\n     * 60154 对应 400\n     * 60155 对应 600\n     * @param code 400 滑动验证 600 刮刮卡验证\n     */\n\n  }, {\n    key: \"testIsNeedCallCaptcha\",\n    value: function testIsNeedCallCaptcha(code) {\n      return [60154, 60155].includes(code);\n    }\n  }, {\n    key: \"callCaptcha\",\n    value: function callCaptcha(code) {\n      switch (code) {\n        case 60154:\n        case 60155:\n          //唤醒滑动验证\n          // @ts-ignore\n          getNC().then(function (data) {\n            // @ts-ignore\n            _nvc_nc.upLang('cn', {\n              _startTEXT: '请按住滑块，拖动到最右边',\n              _yesTEXT: '验证通过',\n              _error300: '哎呀，出错了，点击<a href=\"javascript:__nc.reset()\">刷新</a>再来一次',\n              _errorNetwork: '网络不给力，请<a href=\"javascript:__nc.reset()\">点击刷新</a>'\n            }); // @ts-ignore\n\n\n            _nvc_nc.reset();\n          });\n          break;\n        // case 60155:\n        //   //唤醒刮刮卡\n        //   // @ts-ignore\n        //   getSC()\n        //   break\n\n        default:\n          // @ts-ignore\n          nvcReset();\n          break;\n      }\n    }\n  }, {\n    key: \"resetNVC\",\n    value: function resetNVC() {\n      // @ts-ignore\n      nvcReset();\n    }\n  }, {\n    key: \"generateNVCVal\",\n    value: function generateNVCVal() {\n      // @ts-ignore\n      var nvcVal = window.getNVCVal();\n\n      if (!nvcVal) {\n        return;\n      }\n\n      var nvcValDecode = JSON.parse(decodeURIComponent(nvcVal));\n      var flag = this.validateVal(nvcValDecode);\n\n      if (!flag) {\n        this.notification.warn({\n          title: '提示',\n          key: 'ajaxError',\n          content: '登录异常，请刷新页面重试'\n        });\n        return false;\n      }\n\n      return nvcVal;\n    }\n  }, {\n    key: \"validateVal\",\n    value: function validateVal(val) {\n      var arr = Object.values(val);\n      var filterArr = arr.filter(function (item) {\n        return !item;\n      });\n      return !filterArr.length;\n    }\n  }]);\n\n  return NoCaptchaService;\n}();\n\nNoCaptchaService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof NotificationService !== \"undefined\" && NotificationService) === \"function\" ? _a : Object])], NoCaptchaService);\nexport { NoCaptchaService };",null]}