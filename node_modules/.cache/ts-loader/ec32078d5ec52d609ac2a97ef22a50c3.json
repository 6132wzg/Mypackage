{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/member/member-search/member-search.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/member/member-search/member-search.service.ts","mtime":1601345390863},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b, _c;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { UserService } from '@/services/user.service';\nimport { Injectable } from 'vue-service-app';\nimport { TransactionApi } from '@/api/v1/sold/transaction';\nimport { Effect, State, Action } from 'rx-state';\nimport { then } from '@/operators';\nimport { debounceTime, switchMap, catchError } from 'rxjs/operators';\nimport { EMPTY } from 'rxjs';\nimport { MemberApi } from '@/api/v1/member';\n\nvar MemberSearchService = /*#__PURE__*/function () {\n  function MemberSearchService(transactionApi, userService, memberApi) {\n    var _this = this;\n\n    _classCallCheck(this, MemberSearchService);\n\n    this.transactionApi = transactionApi;\n    this.userService = userService;\n    this.memberApi = memberApi;\n    this.memberList$ = new State([]);\n    this.loading$ = new State({});\n    this.type$ = new State('');\n    this.getMemberAction$ = new Action(function (action$) {\n      return action$.pipe(debounceTime(500), switchMap(function (params) {\n        return _this.getMemberRequest(params).pipe(catchError(function () {\n          return EMPTY;\n        }));\n      }));\n    });\n    this.parent_types$ = this.userService.getOptions$('small_course.parent_type');\n    this.id_types$ = this.userService.getOptions$('staff.id_type');\n  }\n\n  _createClass(MemberSearchService, [{\n    key: \"SET_TYPE\",\n    value: function SET_TYPE(type) {\n      this.type$.commit(function () {\n        return type;\n      });\n    }\n  }, {\n    key: \"RESET_LIST\",\n    value: function RESET_LIST() {\n      this.memberList$.commit(function () {\n        return [];\n      });\n    }\n  }, {\n    key: \"getTransactionMember\",\n    value: function getTransactionMember(params) {\n      var _this2 = this;\n\n      return this.transactionApi.getMemberList(params.member, params.type).pipe(then(function (res) {\n        _this2.memberList$.commit(function () {\n          return res.list;\n        });\n\n        return res.list;\n      }));\n    }\n  }, {\n    key: \"getTransfer\",\n    value: function getTransfer(params) {\n      var _this3 = this;\n\n      return this.transactionApi.getTransactionMemeberList(params).pipe(then(function (res) {\n        _this3.memberList$.commit(function () {\n          return res.list;\n        });\n\n        return res.list;\n      }));\n    }\n  }, {\n    key: \"getMemberRequest\",\n    value: function getMemberRequest(params) {\n      switch (this.type$.snapshot()) {\n        case 'transaction':\n          return this.getTransactionMember(params);\n\n        case 'transfer':\n          return this.getTransfer(params);\n\n        default:\n          throw new Error('member-search.service should pass type');\n      }\n    }\n  }, {\n    key: \"getMember\",\n    value: function getMember(member, type) {\n      this.getMemberAction$.dispatch({\n        member: member,\n        type: type\n      });\n    }\n  }, {\n    key: \"getParentInfoByPhone\",\n    value: function getParentInfoByPhone(params) {\n      return this.memberApi.getParentInfoByPhone(params);\n    }\n  }]);\n\n  return MemberSearchService;\n}();\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [Object]), __metadata(\"design:returntype\", void 0)], MemberSearchService.prototype, \"getTransactionMember\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [Object]), __metadata(\"design:returntype\", void 0)], MemberSearchService.prototype, \"getMemberRequest\", null);\n\nMemberSearchService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof TransactionApi !== \"undefined\" && TransactionApi) === \"function\" ? _a : Object, typeof (_b = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _b : Object, typeof (_c = typeof MemberApi !== \"undefined\" && MemberApi) === \"function\" ? _c : Object])], MemberSearchService);\nexport { MemberSearchService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/member/member-search/member-search.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { UserService } from '@/services/user.service'\nimport { Injectable } from 'vue-service-app'\nimport { TransactionApi } from '@/api/v1/sold/transaction'\nimport { Effect, State, Action } from 'rx-state'\nimport { then } from '@/operators'\nimport { debounceTime, switchMap, catchError } from 'rxjs/operators'\nimport { EMPTY } from 'rxjs'\nimport { MemberApi } from '@/api/v1/member'\n\n@Injectable()\nexport class MemberSearchService {\n  memberList$ = new State([])\n  loading$ = new State({})\n  type$ = new State('')\n  getMemberAction$ = new Action<object>(action$ =>\n    action$.pipe(\n      debounceTime(500),\n      switchMap((params: any) =>\n        this.getMemberRequest(params).pipe(catchError(() => EMPTY))\n      )\n    )\n  )\n  parent_types$ = this.userService.getOptions$('small_course.parent_type')\n  id_types$ = this.userService.getOptions$('staff.id_type')\n  constructor(\n    private transactionApi: TransactionApi,\n    private userService: UserService,\n    private memberApi: MemberApi\n  ) {}\n  SET_TYPE(type: string) {\n    this.type$.commit(() => type)\n  }\n  RESET_LIST() {\n    this.memberList$.commit(() => [])\n  }\n  @Effect()\n  getTransactionMember(params: any) {\n    return this.transactionApi.getMemberList(params.member, params.type).pipe(\n      then((res: any) => {\n        this.memberList$.commit(() => res.list)\n        return res.list\n      })\n    )\n  }\n  getTransfer(params: any) {\n    return this.transactionApi.getTransactionMemeberList(params).pipe(\n      then((res: any) => {\n        this.memberList$.commit(() => res.list)\n        return res.list\n      })\n    )\n  }\n  @Effect()\n  getMemberRequest(params: any) {\n    switch (this.type$.snapshot()) {\n      case 'transaction':\n        return this.getTransactionMember(params)\n      case 'transfer':\n        return this.getTransfer(params)\n      default:\n        throw new Error('member-search.service should pass type')\n    }\n  }\n  getMember(member: string, type: number) {\n    this.getMemberAction$.dispatch({\n      member,\n      type\n    })\n  }\n  getParentInfoByPhone(params: any) {\n    return this.memberApi.getParentInfoByPhone(params)\n  }\n}\n"],"sourceRoot":""}]}