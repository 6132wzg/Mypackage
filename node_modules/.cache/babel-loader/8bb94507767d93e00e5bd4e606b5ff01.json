{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/app/physical-test/list.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/app/physical-test/list.vue","mtime":1600926556091},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport draggable from 'vuedraggable';\nimport MarkteingPluginTitle from '@/views/pages/brand/marketing/components#/marketing-title';\nimport BrandAppPhysicalTestNewLabel from '@/views/biz-modals/brand/app/physical-test/new-label';\nimport { ListService } from \"./list.service\";\nimport { cloneDeep } from 'lodash-es';\nexport default {\n  name: 'brand-app-physical-test',\n  bem: {\n    b: 'brand-app-physical-test'\n  },\n  components: {\n    MarkteingPluginTitle: MarkteingPluginTitle\n  },\n  modals: {\n    BrandAppPhysicalTestNewLabel: BrandAppPhysicalTestNewLabel\n  },\n  serviceInject: function serviceInject() {\n    return {\n      physicalTestService: ListService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.physicalTestService.loading$,\n      indicators: this.physicalTestService.list$,\n      labels: this.physicalTestService.labelList$,\n      auth: this.physicalTestService.auth$\n    };\n  },\n  props: {},\n  data: function data() {\n    return {\n      statusAdd: false,\n      statusEdit: false,\n      tags: [],\n      editIndicator: {}\n    };\n  },\n  computed: {\n    indicatorsNum: function indicatorsNum() {\n      var len = this.indicators.length;\n\n      if (len === 1) {\n        return 0;\n      } else {\n        return this.statusAdd ? len - 2 : len - 1;\n      }\n    },\n    canEditIndicator: function canEditIndicator() {\n      return this.indicators.slice(1);\n    },\n    addButtonDisable: function addButtonDisable() {\n      if (this.auth.add) {\n        return this.statusAdd;\n      } else {\n        return true;\n      }\n    }\n  },\n  methods: {\n    checkMove: function checkMove(evt) {\n      var draggedContext = evt.draggedContext,\n          relatedContext = evt.relatedContext,\n          dragged = evt.dragged,\n          from = evt.from,\n          to = evt.to;\n      var draggedElement = draggedContext.element;\n      var relatedElement = relatedContext.element;\n      console.log('statusEdit', this.statusEdit); // 新增状态不可拖拽\n\n      if (this.statusAdd) return false; // 编辑状态不可拖拽\n\n      if (this.statusEdit) return false;\n      return (!relatedElement || !relatedElement.isAdd) && !draggedElement.isAdd;\n    },\n    resetIndicator: function resetIndicator() {\n      this.editIndicator = {\n        item_name: '',\n        item_unit: '',\n        is_show: 1,\n        is_must: 1,\n        isEdit: true\n      };\n    },\n    handleReGetBodyImg: function handleReGetBodyImg() {\n      this.$message.success({\n        content: '体态图新增成功'\n      });\n      this.physicalTestService.getBodyImgLableList().subscribe();\n    },\n    handleRemoveTag: function handleRemoveTag(tag) {\n      var _this = this;\n\n      this.physicalTestService.removePhysicalTestBodyImgLabel(tag.id).subscribe(function (res) {\n        _this.$message.success({\n          content: '体态图删除成功'\n        });\n\n        _this.physicalTestService.getBodyImgLableList().subscribe();\n      });\n    },\n    handleAddIndicator: function handleAddIndicator() {\n      this.indicators = this.indicators.map(function (i) {\n        i.isEdit = false;\n        return i;\n      });\n      this.statusAdd = true;\n      this.resetIndicator();\n      this.indicators.splice(1, 0, this.editIndicator);\n    },\n    handleEditIndicator: function handleEditIndicator(indicator) {\n      this.statusEdit = true; // 如果是从新增状态,点击编辑按钮时\n\n      if (this.statusAdd) {\n        this.indicators.splice(1, 1);\n        this.statusAdd = false;\n      }\n\n      this.editIndicator = cloneDeep(indicator);\n      this.indicators = this.indicators.map(function (i) {\n        if (i.id === indicator.id) {\n          i.isEdit = true;\n        } else {\n          i.isEdit = false;\n        }\n\n        return i;\n      });\n    },\n    handleRemoveIndicators: function handleRemoveIndicators(indicator) {\n      var _this2 = this;\n\n      this.physicalTestService.deleteBodyIndicator(indicator.id).subscribe(function (res) {\n        _this2.statusEdit = false;\n        _this2.indicators = _this2.indicators.filter(function (i) {\n          return i.id !== indicator.id;\n        });\n      });\n    },\n    handleSaveIndicators: function handleSaveIndicators(indicator) {\n      var _this3 = this;\n\n      console.log('handleSaveIndicators', indicator);\n\n      if (this.statusAdd) {\n        this.physicalTestService.addBodyIndicator({\n          item_name: indicator.item_name,\n          item_unit: indicator.item_unit,\n          is_show: indicator.is_show,\n          is_must: indicator.is_must\n        }).subscribe(function (res) {\n          // 保存新增的基础提测数据\n          _this3.statusEdit = false;\n          _this3.statusAdd = false;\n\n          _this3.resetIndicator();\n\n          _this3.physicalTestService.getBodyIndicatorList().subscribe();\n\n          console.log('res');\n        });\n      } else {\n        // 保存修改的基础提测数据\n        this.physicalTestService.editBodyIndicator({\n          id: this.editIndicator.id,\n          item_name: this.editIndicator.item_name,\n          item_unit: this.editIndicator.item_unit,\n          is_show: this.editIndicator.is_show,\n          is_must: this.editIndicator.is_must\n        }).subscribe(function (res) {\n          _this3.statusEdit = false;\n          _this3.indicators = _this3.indicators.map(function (i) {\n            if (i.id === indicator.id) {\n              _this3.editIndicator.isEdit = false;\n              i = _this3.editIndicator;\n\n              _this3.resetIndicator();\n            }\n\n            return i;\n          });\n        });\n      }\n    },\n    handleCancelEditIndicators: function handleCancelEditIndicators(indicator) {\n      this.statusEdit = false;\n\n      if (this.statusAdd) {\n        this.indicators.splice(1, 1);\n        this.resetIndicator();\n        this.statusAdd = false;\n      } else {\n        this.indicators = this.indicators.map(function (i) {\n          i.isEdit = false;\n          return i;\n        });\n      }\n    },\n    handleSortIndicator: function handleSortIndicator() {\n      var indicators = this.indicators.slice(1);\n      this.physicalTestService.moveBodyIndicators({\n        item_sort: indicators\n      }).subscribe();\n    },\n    dragStart: function dragStart(ev) {\n      ev.item.classList.add('dragged');\n    },\n    dragEnd: function dragEnd(ev) {\n      ev.item.classList.remove('dragged');\n    }\n  }\n};",{"version":3,"sources":["list.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div :class=\"b()\">\n    <st-panel-layout :class=\"b('container')\">\n      <!-- 会员体测信息说明 -->\n      <MarkteingPluginTitle pathName=\"brand-app-physical-test-list\" />\n      <!-- 会员体测表格 -->\n      <div :class=\"b('main')\">\n        <div :class=\"b('bodyImg')\">\n          <div :class=\"b('bodyImg-header')\">\n            <div :class=\"b('bodyImg-header__title')\">体态拍照设置</div>\n            <div :class=\"b('bodyImg-header__subtitle')\">\n              您可以新增更多的体态图，最多支持6张\n            </div>\n          </div>\n          <div :class=\"b('bodyImg-content')\">\n            <div :class=\"b('bodyImg-content-tag')\">\n              <div v-for=\"tag in labels\" :key=\"tag.id\">\n                <a-tooltip :key=\"tag.id\" :title=\"tag.img_name\">\n                  <a-tag\n                    :class=\"b('bodyImg-content-tag-item')\"\n                    :key=\"tag.img_name\"\n                    :closable=\"!tag.is_must\"\n                    @close=\"handleRemoveTag(tag)\"\n                  >\n                    {{ tag.img_name }}\n                  </a-tag>\n                </a-tooltip>\n              </div>\n              <a\n                v-modal-link=\"{\n                  name: 'brand-app-physical-test-new-label',\n                  props: {},\n                  on: { success: handleReGetBodyImg }\n                }\"\n                v-if=\"labels.length < 6\"\n              >\n                <a-tag style=\"background: #fff; borderStyle: dashed;\">\n                  <a-icon type=\"plus\" style=\"margin-right: 8px;\" />\n                  新增体态图\n                </a-tag>\n              </a>\n            </div>\n          </div>\n        </div>\n        <div :class=\"b('physicalTestTable')\">\n          <div :class=\"b('physicalTestTable-header')\">\n            <div :class=\"b('physicalTestTable-header__title')\">\n              基础体测数据\n            </div>\n            <div :class=\"b('physicalTestTable-header__subtitle')\">\n              已创建体测数据（{{ indicatorsNum }}/50）\n            </div>\n          </div>\n          <st-form-table>\n            <thead>\n              <tr>\n                <th style=\"width: 5%\"></th>\n                <th style=\"width: 29%\">数据名称</th>\n                <th style=\"width: 29%\">单位</th>\n                <th style=\"width: 11%\">展示状态</th>\n                <th style=\"width: 11%\">是否必填</th>\n                <th style=\"width: 15%\">操作</th>\n              </tr>\n            </thead>\n            <draggable\n              v-model=\"indicators\"\n              :animation=\"200\"\n              :move=\"checkMove\"\n              draggable=\".canDrag\"\n              @start=\"dragStart\"\n              @end=\"dragEnd\"\n              tag=\"tbody\"\n              @change=\"handleSortIndicator\"\n            >\n              <tr>\n                <td colspan=\"12\" class=\"st-form-table__add\">\n                  <st-button\n                    type=\"dashed\"\n                    icon=\"add\"\n                    block\n                    :disabled=\"addButtonDisable\"\n                    @click=\"handleAddIndicator\"\n                  >\n                    新增基础数据\n                  </st-button>\n                </td>\n              </tr>\n              <tr\n                :class=\"{ canDrag: !statusAdd && !statusEdit }\"\n                v-for=\"(indicator, index) in canEditIndicator\"\n                :key=\"index\"\n              >\n                <td>\n                  <st-icon type=\"tuozhuai\" />\n                </td>\n                <td>\n                  <div v-if=\"indicator.isEdit && !indicator.is_default\">\n                    <a-input\n                      v-model=\"editIndicator.item_name\"\n                      placeholder=\"请输入名称(必填)\"\n                      :maxLength=\"8\"\n                      style=\"width: 160px;\"\n                    ></a-input>\n                  </div>\n                  <div v-else>{{ indicator.item_name }}</div>\n                </td>\n                <td>\n                  <div v-if=\"indicator.isEdit && !indicator.is_default\">\n                    <a-input\n                      v-model=\"editIndicator.item_unit\"\n                      placeholder=\"请输入单位(必填)\"\n                      :maxLength=\"8\"\n                      style=\"width: 160px;\"\n                    ></a-input>\n                  </div>\n                  <div v-else>{{ indicator.item_unit }}</div>\n                </td>\n                <td>\n                  <div v-if=\"indicator.isEdit\">\n                    <st-switch v-model=\"editIndicator.is_show\"></st-switch>\n                  </div>\n                  <div v-else>\n                    <st-text\n                      :status=\"{\n                        success: indicator.is_show === 1,\n                        default: indicator.is_show === 0\n                      }\"\n                    >\n                      {{ indicator.show_text[indicator.is_show] }}\n                    </st-text>\n                  </div>\n                </td>\n                <td>\n                  <div v-if=\"indicator.isEdit\">\n                    <st-switch v-model=\"editIndicator.is_must\"></st-switch>\n                  </div>\n                  <div v-else>{{ indicator.must_text[indicator.is_must] }}</div>\n                </td>\n                <td>\n                  <div v-if=\"indicator.isEdit\">\n                    <st-table-actions>\n                      <a\n                        v-if=\"!statusAdd\"\n                        @click=\"handleSaveIndicators(indicator)\"\n                      >\n                        保存\n                      </a>\n                      <a\n                        v-if=\"statusAdd\"\n                        @click=\"handleSaveIndicators(indicator)\"\n                      >\n                        确认\n                      </a>\n                      <a @click=\"handleCancelEditIndicators(indicator)\">\n                        取消\n                      </a>\n                    </st-table-actions>\n                  </div>\n                  <div v-else>\n                    <st-table-actions>\n                      <a\n                        @click=\"handleEditIndicator(indicator)\"\n                        v-if=\"indicator.can_edit && auth.edit\"\n                      >\n                        编辑\n                      </a>\n                      <a v-if=\"!indicator.is_default && auth.del\">\n                        <st-popconfirm\n                          :title=\"'一旦删除则无法恢复，确认删除'\"\n                          @confirm=\"handleRemoveIndicators(indicator)\"\n                        >\n                          删除\n                        </st-popconfirm>\n                      </a>\n                    </st-table-actions>\n                  </div>\n                </td>\n              </tr>\n            </draggable>\n          </st-form-table>\n        </div>\n      </div>\n    </st-panel-layout>\n  </div>\n</template>\n\n<script>\nimport draggable from 'vuedraggable'\nimport MarkteingPluginTitle from '@/views/pages/brand/marketing/components#/marketing-title'\nimport BrandAppPhysicalTestNewLabel from '@/views/biz-modals/brand/app/physical-test/new-label'\nimport { ListService } from './list.service'\nimport { cloneDeep } from 'lodash-es'\nexport default {\n  name: 'brand-app-physical-test',\n\n  bem: {\n    b: 'brand-app-physical-test'\n  },\n\n  components: { MarkteingPluginTitle },\n\n  modals: { BrandAppPhysicalTestNewLabel },\n\n  serviceInject() {\n    return {\n      physicalTestService: ListService\n    }\n  },\n\n  rxState() {\n    return {\n      loading: this.physicalTestService.loading$,\n      indicators: this.physicalTestService.list$,\n      labels: this.physicalTestService.labelList$,\n      auth: this.physicalTestService.auth$\n    }\n  },\n\n  props: {},\n\n  data() {\n    return {\n      statusAdd: false,\n      statusEdit: false,\n      tags: [],\n      editIndicator: {}\n    }\n  },\n\n  computed: {\n    indicatorsNum() {\n      let len = this.indicators.length\n      if (len === 1) {\n        return 0\n      } else {\n        return this.statusAdd ? len - 2 : len - 1\n      }\n    },\n    canEditIndicator() {\n      return this.indicators.slice(1)\n    },\n    addButtonDisable() {\n      if (this.auth.add) {\n        return this.statusAdd\n      } else {\n        return true\n      }\n    }\n  },\n\n  methods: {\n    checkMove(evt) {\n      const { draggedContext, relatedContext, dragged, from, to } = evt\n      const draggedElement = draggedContext.element\n      const relatedElement = relatedContext.element\n      console.log('statusEdit', this.statusEdit)\n      // 新增状态不可拖拽\n      if (this.statusAdd) return false\n      // 编辑状态不可拖拽\n      if (this.statusEdit) return false\n      return (!relatedElement || !relatedElement.isAdd) && !draggedElement.isAdd\n    },\n    resetIndicator() {\n      this.editIndicator = {\n        item_name: '',\n        item_unit: '',\n        is_show: 1,\n        is_must: 1,\n        isEdit: true\n      }\n    },\n    handleReGetBodyImg() {\n      this.$message.success({ content: '体态图新增成功' })\n      this.physicalTestService.getBodyImgLableList().subscribe()\n    },\n    handleRemoveTag(tag) {\n      this.physicalTestService\n        .removePhysicalTestBodyImgLabel(tag.id)\n        .subscribe(res => {\n          this.$message.success({ content: '体态图删除成功' })\n          this.physicalTestService.getBodyImgLableList().subscribe()\n        })\n    },\n    handleAddIndicator() {\n      this.indicators = this.indicators.map(i => {\n        i.isEdit = false\n        return i\n      })\n      this.statusAdd = true\n      this.resetIndicator()\n      this.indicators.splice(1, 0, this.editIndicator)\n    },\n    handleEditIndicator(indicator) {\n      this.statusEdit = true\n      // 如果是从新增状态,点击编辑按钮时\n      if (this.statusAdd) {\n        this.indicators.splice(1, 1)\n        this.statusAdd = false\n      }\n      this.editIndicator = cloneDeep(indicator)\n      this.indicators = this.indicators.map(i => {\n        if (i.id === indicator.id) {\n          i.isEdit = true\n        } else {\n          i.isEdit = false\n        }\n        return i\n      })\n    },\n    handleRemoveIndicators(indicator) {\n      this.physicalTestService\n        .deleteBodyIndicator(indicator.id)\n        .subscribe(res => {\n          this.statusEdit = false\n          this.indicators = this.indicators.filter(i => i.id !== indicator.id)\n        })\n    },\n    handleSaveIndicators(indicator) {\n      console.log('handleSaveIndicators', indicator)\n      if (this.statusAdd) {\n        this.physicalTestService\n          .addBodyIndicator({\n            item_name: indicator.item_name,\n            item_unit: indicator.item_unit,\n            is_show: indicator.is_show,\n            is_must: indicator.is_must\n          })\n          .subscribe(res => {\n            // 保存新增的基础提测数据\n            this.statusEdit = false\n            this.statusAdd = false\n            this.resetIndicator()\n            this.physicalTestService.getBodyIndicatorList().subscribe()\n            console.log('res')\n          })\n      } else {\n        // 保存修改的基础提测数据\n        this.physicalTestService\n          .editBodyIndicator({\n            id: this.editIndicator.id,\n            item_name: this.editIndicator.item_name,\n            item_unit: this.editIndicator.item_unit,\n            is_show: this.editIndicator.is_show,\n            is_must: this.editIndicator.is_must\n          })\n          .subscribe(res => {\n            this.statusEdit = false\n            this.indicators = this.indicators.map(i => {\n              if (i.id === indicator.id) {\n                this.editIndicator.isEdit = false\n                i = this.editIndicator\n                this.resetIndicator()\n              }\n              return i\n            })\n          })\n      }\n    },\n    handleCancelEditIndicators(indicator) {\n      this.statusEdit = false\n      if (this.statusAdd) {\n        this.indicators.splice(1, 1)\n        this.resetIndicator()\n        this.statusAdd = false\n      } else {\n        this.indicators = this.indicators.map(i => {\n          i.isEdit = false\n          return i\n        })\n      }\n    },\n    handleSortIndicator() {\n      let indicators = this.indicators.slice(1)\n      this.physicalTestService\n        .moveBodyIndicators({\n          item_sort: indicators\n        })\n        .subscribe()\n    },\n    dragStart(ev) {\n      ev.item.classList.add('dragged')\n    },\n    dragEnd(ev) {\n      ev.item.classList.remove('dragged')\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped></style>\n"],"sourceRoot":"src/views/pages/brand/app/physical-test"}]}