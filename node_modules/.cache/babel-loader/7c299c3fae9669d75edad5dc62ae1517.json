{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/sold/course/info/package/info.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/sold/course/info/package/info.vue","mtime":1596188219757},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { InfoService } from \"./info.service\";\nimport { btnOptions } from \"./info.config\";\nimport moment from 'moment';\nimport SoldCoursePackageUpgrade from '@/views/biz-modals/sold/course/package/upgrade';\nimport SoldCourseFreeze from '@/views/biz-modals/sold/course/freeze';\nimport SoldCourseRefund from '@/views/biz-modals/sold/course/refund';\nimport SoldCourseSurplus from '@/views/biz-modals/sold/course/surplus';\nimport SoldCourseTransfer from '@/views/biz-modals/sold/course/transfer';\nimport SoldCourseValid from '@/views/biz-modals/sold/course/valid';\nimport SoldCoursePackageUpdateExpirationDate from '@/views/biz-modals/sold/course/package/update-expiration-date';\nimport SoldCoursePackageDeduction from '@/views/biz-modals/sold/course/package/deduction';\nimport SoldCoursePackageMembeChange from '@/views/biz-modals/sold/course/package/member-change';\nimport DealGathering from '@/views/biz-modals/sold/deal/gathering';\nimport { PACKAGE_TYPE, IS_LIMIT } from '@/constants/sold/package';\nimport useInternalNoteActions from '@/hooks/shop/sold-internal-note-actions.hook';\nimport contractActions from '@/hooks/contract.hook';\nexport default {\n  name: 'PageShopSoldCoursePackageInfo',\n  bem: {\n    basic: 'page-shop-sold-info'\n  },\n  modals: {\n    SoldCourseFreeze: SoldCourseFreeze,\n    SoldCourseRefund: SoldCourseRefund,\n    SoldCourseSurplus: SoldCourseSurplus,\n    SoldCourseValid: SoldCourseValid,\n    DealGathering: DealGathering,\n    SoldCoursePackageDeduction: SoldCoursePackageDeduction,\n    SoldCoursePackageUpdateExpirationDate: SoldCoursePackageUpdateExpirationDate,\n    SoldCoursePackageMembeChange: SoldCoursePackageMembeChange,\n    SoldCoursePackageUpgrade: SoldCoursePackageUpgrade,\n    SoldCourseTransfer: SoldCourseTransfer\n  },\n  data: function data() {\n    return {\n      PACKAGE_TYPE: PACKAGE_TYPE,\n      IS_LIMIT: IS_LIMIT\n    };\n  },\n  serviceInject: function serviceInject() {\n    return {\n      infoService: InfoService\n    };\n  },\n  hooks: function hooks() {\n    return {\n      internalNoteActions: useInternalNoteActions(),\n      contractActions: contractActions(this)\n    };\n  },\n  rxState: function rxState() {\n    return {\n      packageInfo: this.infoService.packageInfo$,\n      authTabs: this.infoService.authTabs$,\n      auth: this.infoService.auth$\n    };\n  },\n  computed: {\n    btnOptions: btnOptions,\n    rangeType: function rangeType() {\n      return this.packageInfo.course_range ? this.packageInfo.course_range.range_type : 1;\n    },\n    courseColumns: function courseColumns() {\n      var list = [{\n        title: '课程类型',\n        dataIndex: 'course_name',\n        key: 'course_name'\n      }, {\n        title: '上课门店',\n        dataIndex: 'support_shop',\n        key: 'support_shop',\n        width: '120px',\n        scopedSlots: {\n          customRender: 'support_shop'\n        }\n      }, {\n        title: '节数',\n        dataIndex: 'course_num',\n        key: 'course_num'\n      }, {\n        title: '课时费',\n        dataIndex: 'course_price',\n        key: 'course_price'\n      }, {\n        title: '小计',\n        dataIndex: 'pay_amount',\n        key: 'pay_amount'\n      }];\n\n      if (this.rangeType === 3) {\n        list.splice(3, 1);\n      }\n\n      if (this.packageInfo.package_type !== PACKAGE_TYPE.ALL_COURSE) {\n        if (this.packageInfo.is_limit === IS_LIMIT.NO_LIMIT) {\n          list.splice(2, 1);\n          list.splice(3, 1);\n        }\n\n        list.splice(1, 1);\n      }\n\n      return list;\n    },\n    courseTabData: function courseTabData() {\n      var data = [];\n      var team = this.packageInfo.course_range ? this.packageInfo.course_range.team : {};\n      var personal = this.packageInfo.course_range ? this.packageInfo.course_range.personal : {};\n      var support_shop = '';\n\n      if (team.support_shop) {\n        support_shop = team.support_shop;\n      }\n\n      if (personal.support_shop) {\n        support_shop = personal.support_shop;\n      }\n\n      data.push({\n        key: 0,\n        support_shop: support_shop,\n        course_name: team.course_name,\n        course_num: team.course_num,\n        course_price: team.course_price,\n        pay_amount: team.pay_amount\n      });\n\n      if (personal.course_name) {\n        data.push({\n          key: 1,\n          support_shop: support_shop,\n          course_name: personal.course_name,\n          course_num: personal.course_num,\n          course_price: personal.course_price,\n          pay_amount: personal.pay_amount\n        });\n      }\n\n      return data;\n    },\n    // 范围内课程团体课\n    innerColumnsTeam: function innerColumnsTeam() {\n      var list = [{\n        title: '课程名称',\n        dataIndex: 'course_name',\n        key: 'course_name',\n        scopedSlots: {\n          customRender: 'course_name'\n        },\n        width: '120px'\n      }, {\n        title: '上课门店',\n        dataIndex: 'support_shop',\n        key: 'support_shop',\n        width: '120px',\n        scopedSlots: {\n          customRender: 'support_shop'\n        }\n      }];\n      return list;\n    },\n    innerDataTeam: function innerDataTeam() {\n      return this.packageInfo.course_range.team.courses;\n    },\n    // 范围内课程私教课\n    innerColumnsPersonal: function innerColumnsPersonal() {\n      var list = [{\n        title: '课程名称',\n        dataIndex: 'course_name',\n        key: 'course_name',\n        width: '120px',\n        scopedSlots: {\n          customRender: 'course_name'\n        }\n      }, {\n        title: '上课门店',\n        dataIndex: 'support_shop',\n        key: 'support_shop',\n        width: '120px',\n        scopedSlots: {\n          customRender: 'support_shop'\n        }\n      }, {\n        title: \"\".concat(this.$c('coach'), \"\\u7B49\\u7EA7\"),\n        dataIndex: 'levels',\n        key: 'levels',\n        scopedSlots: {\n          customRender: 'levels'\n        }\n      }];\n      return list;\n    },\n    innerDataPersonal: function innerDataPersonal() {\n      var innerData = [];\n\n      for (var i = 0; i < this.packageInfo.course_range.personal.courses.length; i++) {\n        innerData.push({\n          key: i,\n          support_shop: this.packageInfo.course_range.personal.courses[i].support_shop,\n          course_name: this.packageInfo.course_range.personal.courses[i].course_name,\n          levels: this.packageInfo.course_range.personal.courses[i].levels.join(',')\n        });\n      }\n\n      return innerData;\n    },\n    // 固定课程\n    innerColumnsFix: function innerColumnsFix() {\n      var list = [{\n        title: '课程名称',\n        dataIndex: 'course_name',\n        key: 'course_name'\n      }, {\n        title: '上课门店',\n        dataIndex: 'support_shop',\n        key: 'support_shop',\n        scopedSlots: {\n          customRender: 'support_shop'\n        }\n      }, {\n        title: '节数',\n        dataIndex: 'course_num_init',\n        key: 'course_num_init'\n      }, {\n        title: '课时费',\n        dataIndex: 'course_price',\n        key: 'course_price'\n      }, {\n        title: '总价',\n        dataIndex: 'course_amount',\n        key: 'course_amount'\n      }];\n      return list;\n    },\n    innerDataFixPersonal: function innerDataFixPersonal() {\n      var innerData = [];\n\n      for (var i = 0; i < this.packageInfo.course_range.personal.courses.length; i++) {\n        innerData.push({\n          key: i,\n          course_name: this.packageInfo.course_range.personal.courses[i].course_name,\n          support_shop: this.packageInfo.course_range.personal.courses[i].support_shop,\n          course_num_init: this.packageInfo.course_range.personal.courses[i].course_num_init,\n          course_price: this.packageInfo.course_range.personal.courses[i].course_price,\n          course_amount: this.packageInfo.course_range.personal.courses[i].course_amount,\n          levels: this.packageInfo.course_range.personal.courses[i].levels.join(',')\n        });\n      }\n\n      return this.packageInfo.course_range.personal.courses;\n    },\n    innerDataFixTeam: function innerDataFixTeam() {\n      var innerData = [];\n\n      for (var i = 0; i < this.packageInfo.course_range.team.courses.length; i++) {\n        innerData.push({\n          key: i,\n          course_name: this.packageInfo.course_range.team.courses[i].course_name,\n          support_shop: this.packageInfo.course_range.team.courses[i].support_shop,\n          course_num_init: this.packageInfo.course_range.team.courses[i].course_num_init,\n          course_price: this.packageInfo.course_range.team.courses[i].course_price,\n          course_amount: this.packageInfo.course_range.team.courses[i].course_amount\n        });\n      }\n\n      return innerData;\n    }\n  },\n  methods: {\n    moment: moment,\n    onEditDate: function onEditDate() {\n      var id = this.packageInfo.id;\n      this.$modalRouter.push({\n        name: 'sold-course-package-update-expiration-date',\n        props: {\n          id: id\n        },\n        on: {\n          success: function success() {// this.successTip()\n          }\n        }\n      });\n    },\n    onMemberChange: function onMemberChange() {\n      var id = this.packageInfo.id;\n      this.$modalRouter.push({\n        name: 'sold-course-package-membe-change',\n        props: {\n          id: id\n        },\n        on: {\n          success: function success() {// this.successTip()\n          }\n        }\n      });\n    },\n    onReduceTimes: function onReduceTimes() {\n      var _this = this;\n\n      var id = this.packageInfo.id;\n      this.$modalRouter.push({\n        name: 'sold-course-package-deduction',\n        props: {\n          id: id\n        },\n        on: {\n          success: function success() {\n            _this.successTip();\n          }\n        }\n      });\n    },\n    // 修改剩余课时\n    onSurplus: function onSurplus() {\n      var _this2 = this;\n\n      // 后端返回的时间戳\n      var time = this.packageInfo.effective_state ? \"\".concat(moment(this.packageInfo.course_buy_time * 1000).format('YYYY-MM-DD HH:mm'), \" \\u81F3 \").concat(moment(this.packageInfo.course_end_time * 1000).format('YYYY-MM-DD HH:mm')) : '--';\n      var data = {\n        id: this.infoService.id,\n        courseName: this.packageInfo.course_name,\n        time: time\n      };\n      this.$modalRouter.push({\n        name: 'sold-course-surplus',\n        props: {\n          courseType: 'coursePackage',\n          courseData: data\n        },\n        on: {\n          success: function success() {\n            _this2.$router.reload();\n          }\n        }\n      });\n    },\n    // 跳转合同\n    toContract: function toContract() {\n      var record = this.packageInfo;\n      var url = \"\".concat(window.location.origin, \"/common/contract-preview?id=\").concat(record.order_id);\n      window.open(url);\n    },\n    onUpgrade: function onUpgrade() {\n      var _this3 = this;\n\n      var id = this.packageInfo.id;\n      this.$modalRouter.push({\n        name: 'sold-course-package-upgrade',\n        props: {\n          id: id\n        },\n        on: {\n          success: function success(res) {\n            if (res.type === 'create') {\n              // 创建订单成功\n              _this3.$router.reload();\n\n              _this3.onClear();\n            } else if (res.type === 'createPay') {\n              // 创建订单成功 并且到支付页面\n              _this3.$modalRouter.push({\n                name: 'deal-gathering',\n                props: {\n                  order_id: res.orderId,\n                  type: 'package'\n                },\n                on: {\n                  success: function success() {\n                    _this3.$router.reload();\n\n                    _this3.onClear();\n                  }\n                }\n              });\n            }\n          }\n        }\n      });\n    },\n    // 冻结\n    onFreeze: function onFreeze() {\n      var _this4 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-course-freeze',\n        props: {\n          type: 'package',\n          id: this.infoService.id,\n          courseName: this.packageInfo.course_name,\n          courseNum: this.packageInfo.remain_course_num,\n          courseEndTime: moment(this.packageInfo.course_end_time * 1000),\n          time: \"\".concat(moment(this.packageInfo.course_buy_time * 1000).format('YYYY-MM-DD HH:mm'), \" \\u81F3 \").concat(moment(this.packageInfo.course_end_time * 1000).format('YYYY-MM-DD HH:mm'))\n        },\n        on: {\n          success: function success() {\n            _this4.$router.reload();\n          }\n        }\n      });\n    },\n    // 取消冻结\n    onUnfreeze: function onUnfreeze() {\n      var _this5 = this;\n\n      this.$confirm({\n        title: '提示',\n        content: '是否取消冻结？',\n        maskClosable: true,\n        onOk: function onOk() {\n          return _this5.infoService.unFreeze(_this5.infoService.id).toPromise().then(function () {\n            _this5.$router.reload();\n          });\n        }\n      });\n    },\n    // 转让\n    onTransfer: function onTransfer() {\n      var _this6 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-course-transfer',\n        props: {\n          type: 'package',\n          id: this.infoService.id\n        },\n        on: {\n          success: function success() {\n            _this6.$router.reload();\n          }\n        }\n      });\n    },\n    onValid: function onValid() {\n      var _this7 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-course-valid',\n        props: {\n          info: this.packageInfo\n        },\n        on: {\n          success: function success() {\n            _this7.$router.reload();\n          }\n        }\n      });\n    },\n    // 退款\n    onRefund: function onRefund() {\n      var _this8 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-course-refund',\n        props: {\n          id: this.infoService.id,\n          type: 'package'\n        },\n        on: {\n          success: function success() {\n            _this8.$router.reload();\n          }\n        }\n      });\n    },\n    // 对内备注\n    onInternalNote: function onInternalNote() {\n      this.internalNoteActions.onOpenModal({\n        id: this.infoService.id\n      });\n    },\n\n    /**\n     * 修改合同备注\n     */\n    onEditContractDescription: function onEditContractDescription() {\n      var _this$packageInfo = this.packageInfo,\n          order_id = _this$packageInfo.order_id,\n          description = _this$packageInfo.description;\n      this.contractActions.editDescription({\n        order_id: order_id,\n        description: description\n      });\n    }\n  }\n};",null]}