{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/app/venue/setting.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/app/venue/setting.vue","mtime":1597396799941},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { SettingService } from './setting.service'\nimport { MessageService } from '@/services/message.service'\nimport { CYCLIC_TYPE, WEEK_MAP } from '@/constants/venue'\n\nexport default {\n  serviceInject() {\n    return {\n      settingService: SettingService,\n      messageService: MessageService\n    }\n  },\n  rxState() {\n    return {\n      list: this.settingService.list$,\n      auth: this.settingService.auth$\n    }\n  },\n  name: 'newLable',\n  props: {\n    siteId: {\n      type: Number,\n      default() {\n        return ''\n      }\n    },\n    venuesId: {\n      type: Number,\n      default() {\n        return ''\n      }\n    }\n  },\n  data() {\n    return {\n      show: false,\n      CYCLIC_TYPE\n    }\n  },\n  filters: {\n    cycleFilter(val) {\n      return '每' + val.map(item => WEEK_MAP[item]).join('、')\n    }\n  },\n  mounted() {\n    this.getList()\n  },\n  methods: {\n    getList() {\n      this.settingService.getList({ site_id: this.siteId }).subscribe()\n    },\n    delSetting(item) {\n      const data = {\n        settings_id: item.settings_id\n      }\n      this.settingService.deleteSetting(data).subscribe(() => {\n        this.getList()\n      })\n    },\n    order(item) {\n      const data = {\n        site_id: this.siteId,\n        settings_id: item.settings_id\n      }\n      this.settingService.orderSetting(data).subscribe(() => {\n        this.getList()\n      })\n    },\n    addRow() {\n      this.show = false\n      this.$router.push({\n        name: 'shop-app-venue-setting-add',\n        query: { venues_id: this.venuesId }\n      })\n    },\n    editRow(item) {\n      this.show = false\n      this.$router.push({\n        name: 'shop-app-venue-setting-edit',\n        query: { settings_id: item.settings_id }\n      })\n    },\n    save(e) {\n      let verify = true\n      e.preventDefault()\n      const sites = this.sites.map(item => {\n        item.name === '' && (verify = false)\n        return item.name\n      })\n      if (!verify) {\n        this.messageService.warn({ content: '场地名称不能为空' })\n        return\n      }\n      let data = {\n        venues_id: this.venuesId,\n        sites: this.sites.map(item => item.name)\n      }\n      this.settingService.addSites(data).subscribe(state => {\n        this.messageService.success({ content: '新增成功' })\n        this.show = false\n        this.$emit('success', true)\n      })\n    }\n  }\n}\n",{"version":3,"sources":["setting.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"setting.vue","sourceRoot":"src/views/biz-modals/shop/app/venue","sourcesContent":["<template>\n  <st-modal\n    title=\"高级设置\"\n    v-model=\"show\"\n    width=\"928px\"\n    :footer=\"null\"\n    wrapClassName=\"st-modal-shop-app-venue-setting\"\n  >\n    <div class=\"border-box\">\n      <st-form-table hoverable :isEmpty=\"false\">\n        <thead>\n          <tr>\n            <th>优先级</th>\n            <th>生效日期</th>\n            <th>循环日期</th>\n            <th>时间段</th>\n            <th>状态</th>\n            <th class=\"ta-r\">价格(元)</th>\n            <th style=\"width:160px\">操作</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-if=\"list.length < 3 && auth.add\">\n            <td colspan=\"7\" class=\"st-form-table__add\">\n              <st-button type=\"dashed\" icon=\"add\" block @click=\"addRow\">\n                新增\n              </st-button>\n            </td>\n          </tr>\n\n          <template v-for=\"(item, index) in list\">\n            <tr :key=\"index\">\n              <td>\n                {{ item.weight }}\n              </td>\n              <td>\n                {{ item.time_limit }}\n              </td>\n              <td>\n                <span v-if=\"item.cyclic_type === CYCLIC_TYPE.EVERYDAY\">\n                  每天\n                </span>\n                <span v-if=\"item.cyclic_type === CYCLIC_TYPE.CUSTOM\">\n                  {{ item.week_day | cycleFilter }}\n                </span>\n              </td>\n              <td>\n                {{ item.open_time }}\n              </td>\n              <td>\n                {{\n                  item.can_reserve | enumFilter('venues_reserve.can_reserve')\n                }}\n              </td>\n              <td class=\"ta-r\">\n                {{ item.price }}\n              </td>\n              <td>\n                <template>\n                  <a @click=\"editRow(item)\" v-if=\"auth.edit\">\n                    编辑\n                  </a>\n                  <a-divider type=\"vertical\"></a-divider>\n                  <a v-if=\"auth.del\">\n                    <st-popconfirm\n                      :title=\"'一旦删除则无法恢复，确认删除？'\"\n                      @confirm=\"delSetting(item)\"\n                    >\n                      删除\n                    </st-popconfirm>\n                  </a>\n                  <a-divider type=\"vertical\"></a-divider>\n                  <a v-if=\"item.weight !== 3 && auth.top\" @click=\"order(item)\">\n                    置顶\n                  </a>\n                </template>\n              </td>\n            </tr>\n          </template>\n        </tbody>\n      </st-form-table>\n    </div>\n    <p class=\"tips\">\n      当多条高级设置时间有冲突，执行优先级高的设置内容。数字越大，优先级越高。\n    </p>\n  </st-modal>\n</template>\n<script>\nimport { SettingService } from './setting.service'\nimport { MessageService } from '@/services/message.service'\nimport { CYCLIC_TYPE, WEEK_MAP } from '@/constants/venue'\n\nexport default {\n  serviceInject() {\n    return {\n      settingService: SettingService,\n      messageService: MessageService\n    }\n  },\n  rxState() {\n    return {\n      list: this.settingService.list$,\n      auth: this.settingService.auth$\n    }\n  },\n  name: 'newLable',\n  props: {\n    siteId: {\n      type: Number,\n      default() {\n        return ''\n      }\n    },\n    venuesId: {\n      type: Number,\n      default() {\n        return ''\n      }\n    }\n  },\n  data() {\n    return {\n      show: false,\n      CYCLIC_TYPE\n    }\n  },\n  filters: {\n    cycleFilter(val) {\n      return '每' + val.map(item => WEEK_MAP[item]).join('、')\n    }\n  },\n  mounted() {\n    this.getList()\n  },\n  methods: {\n    getList() {\n      this.settingService.getList({ site_id: this.siteId }).subscribe()\n    },\n    delSetting(item) {\n      const data = {\n        settings_id: item.settings_id\n      }\n      this.settingService.deleteSetting(data).subscribe(() => {\n        this.getList()\n      })\n    },\n    order(item) {\n      const data = {\n        site_id: this.siteId,\n        settings_id: item.settings_id\n      }\n      this.settingService.orderSetting(data).subscribe(() => {\n        this.getList()\n      })\n    },\n    addRow() {\n      this.show = false\n      this.$router.push({\n        name: 'shop-app-venue-setting-add',\n        query: { venues_id: this.venuesId }\n      })\n    },\n    editRow(item) {\n      this.show = false\n      this.$router.push({\n        name: 'shop-app-venue-setting-edit',\n        query: { settings_id: item.settings_id }\n      })\n    },\n    save(e) {\n      let verify = true\n      e.preventDefault()\n      const sites = this.sites.map(item => {\n        item.name === '' && (verify = false)\n        return item.name\n      })\n      if (!verify) {\n        this.messageService.warn({ content: '场地名称不能为空' })\n        return\n      }\n      let data = {\n        venues_id: this.venuesId,\n        sites: this.sites.map(item => item.name)\n      }\n      this.settingService.addSites(data).subscribe(state => {\n        this.messageService.success({ content: '新增成功' })\n        this.show = false\n        this.$emit('success', true)\n      })\n    }\n  }\n}\n</script>\n"]}]}