import pathToRegexp from 'path-to-regexp'
export function getMatchRoute(url = '', routes = []) {
  if (!routes.length) {
    return {
      input: url,
      params: {
        _rest: ''
      },
      path: url,
      useRoute: false
    }
  }
  const matches = []
  routes.forEach(route => {
    const routeKeys = []
    // 获取正则表达式
    const re = pathToRegexp(route, routeKeys)

    // 匹配项
    let routeMatch
    if ((routeMatch = re.exec(url))) {
      matches.unshift({
        path: route,
        // 匹配参数
        params: routeKeys.reduce(
          (res, key, keyIndex) => {
            res[key.name] = routeMatch[keyIndex + 1]
            return res
          },
          {
            _rest: ''
          }
        ),
        input: url,
        useRoute: true
      })
    }
  })
  if (matches.length) {
    return matches[0]
  } else {
    return {
      input: url,
      params: {
        _rest: ''
      },
      path: url,
      useRoute: false
    }
  }
}
