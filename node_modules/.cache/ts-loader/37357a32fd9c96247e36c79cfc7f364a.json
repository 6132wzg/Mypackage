{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/role/info.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/role/info.service.ts","mtime":1591147717370},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b, _c;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { UserService } from '@/services/user.service';\nimport { Injectable } from 'vue-service-app';\nimport { State, Effect } from 'rx-state';\nimport { tap, switchMap, catchError } from 'rxjs/operators';\nimport { GetInitInfoPut } from '@/api/v1/staff/role';\nimport { RoleService } from \"../role.service\";\nimport { EMPTY } from 'rxjs';\n\nvar InfoService = /*#__PURE__*/function () {\n  function InfoService(roleService, userService) {\n    _classCallCheck(this, InfoService);\n\n    this.roleService = roleService;\n    this.userService = userService;\n    this.loading$ = new State({});\n    this.info$ = new State({});\n    this.shopList$ = new State({});\n    this.brandList$ = new State({});\n    this.dataGrant$ = this.userService.getOptions$('data_grant.data_grant');\n  }\n\n  _createClass(InfoService, [{\n    key: \"gitInitInfo\",\n    value: function gitInitInfo(query, select_ids) {\n      var _this = this;\n\n      return this.roleService.getInitInfo(query).pipe(tap(function (res) {\n        var resBrandList = res.brand_list.filter(function (item) {\n          return select_ids.includes(item.id);\n        }).map(function (item) {\n          item.title = item.name;\n          item.key = item.id;\n          return item;\n        });\n        var resShopList = res.shop_list.filter(function (item) {\n          return select_ids.includes(item.id);\n        }).map(function (item) {\n          item.title = item.name;\n          item.key = item.id;\n          return item;\n        });\n\n        _this.brandList$.commit(function () {\n          return resBrandList;\n        });\n\n        _this.shopList$.commit(function () {\n          return resShopList;\n        });\n      }));\n    }\n    /**\n     * 获取所有角色详情\n     */\n\n  }, {\n    key: \"getInfo\",\n    value: function getInfo(query) {\n      var _this2 = this;\n\n      return this.roleService.getInfo(query).pipe(tap(function (res) {\n        _this2.info$.commit(function () {\n          return res.role;\n        });\n      }), switchMap(function (res) {\n        return _this2.gitInitInfo(query, res.role.select_ids).pipe(catchError(function () {\n          return EMPTY;\n        }));\n      }));\n    }\n  }, {\n    key: \"beforeEach\",\n    value: function beforeEach(to, from) {\n      var id = to.query.id;\n      return this.getInfo({\n        role_id: id\n      });\n    }\n  }]);\n\n  return InfoService;\n}();\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_a = typeof GetInitInfoPut !== \"undefined\" && GetInitInfoPut) === \"function\" ? _a : Object]), __metadata(\"design:returntype\", void 0)], InfoService.prototype, \"getInfo\", null);\n\nInfoService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_b = typeof RoleService !== \"undefined\" && RoleService) === \"function\" ? _b : Object, typeof (_c = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _c : Object])], InfoService);\nexport { InfoService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/role/info.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { UserService } from '@/services/user.service'\nimport { Injectable, ServiceRoute, Controller } from 'vue-service-app'\nimport { State, Effect } from 'rx-state'\nimport { pluck, tap, switchMap, catchError } from 'rxjs/operators'\nimport { GetInitInfoPut, RoleInfo, RoleApi } from '@/api/v1/staff/role'\nimport { RoleService } from '../role.service'\nimport { EMPTY } from 'rxjs'\n@Injectable()\nexport class InfoService {\n  loading$ = new State({})\n  info$ = new State({})\n  shopList$ = new State({})\n  brandList$ = new State({})\n  dataGrant$ = this.userService.getOptions$('data_grant.data_grant')\n  constructor(\n    private roleService: RoleService,\n    private userService: UserService\n  ) {}\n  gitInitInfo(query: GetInitInfoPut, select_ids: any) {\n    return this.roleService.getInitInfo(query).pipe(\n      tap(res => {\n        const resBrandList = res.brand_list\n          .filter((item: any) => {\n            return select_ids.includes(item.id)\n          })\n          .map((item: any) => {\n            item.title = item.name\n            item.key = item.id\n            return item\n          })\n\n        const resShopList = res.shop_list\n          .filter((item: any) => {\n            return select_ids.includes(item.id)\n          })\n          .map((item: any) => {\n            item.title = item.name\n            item.key = item.id\n            return item\n          })\n\n        this.brandList$.commit(() => resBrandList)\n        this.shopList$.commit(() => resShopList)\n      })\n    )\n  }\n  /**\n   * 获取所有角色详情\n   */\n  @Effect()\n  getInfo(query: GetInitInfoPut) {\n    return this.roleService.getInfo(query).pipe(\n      tap(res => {\n        this.info$.commit(() => res.role)\n      }),\n      switchMap(res => {\n        return this.gitInitInfo(query, res.role.select_ids).pipe(\n          catchError(() => EMPTY)\n        )\n      })\n    )\n  }\n\n  beforeEach(to: ServiceRoute, from: ServiceRoute) {\n    let { id } = to.query as any\n    return this.getInfo({ role_id: id })\n  }\n}\n"],"sourceRoot":""}]}