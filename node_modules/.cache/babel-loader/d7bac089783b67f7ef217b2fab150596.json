{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/card/member/period/edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/card/member/period/edit.vue","mtime":1600926556379},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { UserService } from '@/services/user.service';\nimport moment from 'moment';\nimport { PatternService } from '@/services/pattern.service';\nimport { cloneDeep, remove } from 'lodash-es';\nimport { EditService } from \"./edit.service\";\nimport MemberCard from '@/views/biz-components/h5/pages/member-card';\nimport H5Container from '@/views/biz-components/h5/h5-container';\nimport h5mixin from \"./h5mixin\";\nimport { MEMBER_CARD } from '@/views/biz-components/h5/pages/member-card.config';\nimport CardBgRadio from '@/views/biz-components/card-bg-radio/card-bg-radio';\nimport FormBanner from '@/views/biz-components/card/form-banner';\nimport { SELL_TYPE, UNIT, CARD_TYPE } from '@/constants/card/member';\nimport { ruleOptions } from \"./period.config\";\nimport StEditor from '@/views/components/editor#/editor.vue';\nexport default {\n  name: 'PageShopPeriodCardAdd',\n  mixins: [h5mixin],\n  components: {\n    StEditor: StEditor,\n    MemberCard: MemberCard,\n    H5Container: H5Container,\n    CardBgRadio: CardBgRadio,\n    FormBanner: FormBanner\n  },\n  serviceInject: function serviceInject() {\n    return {\n      pattern: PatternService,\n      editService: EditService,\n      userService: UserService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      cardInfo: this.editService.cardInfo$,\n      loading: this.editService.loading$,\n      shopName: this.userService.shop$,\n      cardBgList: this.editService.cardBgList$,\n      admissionRange: this.editService.admissionRange$,\n      priceSetting: this.editService.priceSetting$,\n      supportSales: this.editService.supportSales$,\n      unit: this.editService.unit$,\n      sellType: this.editService.sellType$,\n      isShelfCard: this.editService.isShelfCard$,\n      supportMemberNums: this.editService.supportMemberNums$\n    };\n  },\n  bem: {\n    b: 'st-help-popover'\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      SELL_TYPE: SELL_TYPE,\n      UNIT: UNIT,\n      cardType: MEMBER_CARD.PERIOD_CARD,\n      MEMBER_CARD: MEMBER_CARD,\n      // 结束时间面板是否显示\n      endOpen: false,\n      priceColumns: [{\n        title: '期限',\n        scopedSlots: {\n          customRender: 'time'\n        },\n        dataIndex: 'time'\n      }, {\n        title: '售价/元',\n        scopedSlots: {\n          customRender: 'rally_price'\n        },\n        dataIndex: 'rally_price'\n      }, {\n        title: '允许冻结/天',\n        scopedSlots: {\n          customRender: 'frozen_day'\n        },\n        dataIndex: 'frozen_day'\n      }, {\n        title: '赠送上限/天',\n        scopedSlots: {\n          customRender: 'gift_unit'\n        },\n        dataIndex: 'gift_unit'\n      }, {\n        title: '操作',\n        dataIndex: 'operation',\n        width: '60px',\n        scopedSlots: {\n          customRender: 'operation'\n        }\n      }],\n      // 价格梯度\n      rallyPriceList: [],\n      // 价格检验是否通过\n      rallyPriceIsOk: true,\n      // 价格是否未输入过\n      rallyPriceIsNoInput: true,\n      // 价格校验文案\n      rallyPriceValidText: '',\n      nuit_list: [{\n        value: 2,\n        label: '天'\n      }, {\n        value: 3,\n        label: '月'\n      }, {\n        value: 4,\n        label: '年'\n      }],\n      // 售卖时间\n      startTime: null,\n      endTime: null,\n      // 是否支持转让\n      is_transfer: false,\n      // 转让单位\n      transferUnit: UNIT.RMB,\n      // 转让手续费\n      transferNum: 0,\n      transfer_unit_is_first: true,\n      // 售卖方式\n      sell_type: [SELL_TYPE.OFFLINE],\n      // 卡背景\n      cardBg: {\n        image_id: 0,\n        image_key: this.cardBgList[0].image_key,\n        image_url: '',\n        index: 1\n      },\n      // 卡背景的help文本\n      cardBgValidatorText: '',\n      // 卡介绍\n      cardIntroduction: '',\n      // 备注\n      cardContents: '',\n      // 是否配置了用户端\n      appConfig: true,\n      // 是否禁止选择开始时间,如果卡状态是可售卖，则需要禁止修改开始时间\n      startTimeIsDisabled: false\n    };\n  },\n  mounted: function mounted() {\n    this.init();\n  },\n  methods: {\n    // init\n    init: function init() {\n      var _this = this;\n\n      // 价格设置\n      this.cardInfo.price_gradient.forEach(function (i) {\n        _this.rallyPriceList.push({\n          key: i.id,\n          id: i.id,\n          time: {\n            unit: +i.unit,\n            num: +i.num\n          },\n          rally_price: +i.rally_price,\n          frozen_day: +i.frozen_day,\n          gift_unit: +i.gift_unit\n        });\n      }); // 支持售卖时间\n\n      this.form.setFieldsValue({\n        special_note: this.cardInfo.special_note,\n        start_time: moment(this.cardInfo.start_time * 1000),\n        end_time: moment(this.cardInfo.end_time * 1000),\n        transferNum: this.cardInfo.transfer_num\n      });\n\n      if (this.isFamilyCard) {\n        this.form.setFieldsValue({\n          support_member_num: this.cardInfo.support_member_num\n        });\n      }\n\n      this.startTimeIsDisabled = this.cardInfo.start_time * 1000 < moment().startOf('day').valueOf() && this.cardInfo.end_time * 1000 > moment().valueOf();\n      this.startTime = moment(this.cardInfo.start_time * 1000);\n      this.endTime = moment(this.cardInfo.end_time * 1000); // 转让设置\n\n      this.is_transfer = !!this.cardInfo.is_transfer;\n      this.transferUnit = this.cardInfo.transfer_unit;\n      this.transferNum = this.cardInfo.transfer_num; // 售卖方式\n\n      this.sell_type = this.cardInfo.sell_type; // 卡背景\n\n      this.cardBg = cloneDeep(this.cardInfo.card_bg); // 卡介绍\n\n      this.cardIntroduction = this.cardInfo.card_introduction; // 卡备注\n\n      this.cardContents = this.cardInfo.card_contents;\n      this.initH5CardInfo();\n    },\n    // 保存\n    onHandleSubmit: function onHandleSubmit(e) {\n      var _this2 = this;\n\n      this.form.validateFieldsAndScroll(function (err, values) {\n        _this2.validatePrice();\n\n        _this2.cardBgValidator();\n\n        if (!err && _this2.priceValidateStatus === 'success' && _this2.cardBgIsOk) {\n          var unit = _this2.is_transfer ? _this2.transferUnit : undefined;\n          var num = _this2.is_transfer ? _this2.transferNum : undefined;\n          var price_gradient = [];\n\n          _this2.rallyPriceList.forEach(function (i) {\n            price_gradient.push({\n              id: i.id || 0,\n              unit: i.time.unit,\n              num: i.time.num,\n              rally_price: i.rally_price,\n              frozen_day: i.frozen_day,\n              gift_unit: i.gift_unit\n            });\n          });\n\n          _this2.editService.editCard({\n            id: _this2.cardInfo.card_id,\n            card_type: _this2.isFamilyCard ? CARD_TYPE.MORE_PERIOD : CARD_TYPE.PERIOD,\n            card_name: values.card_name,\n            special_note: values.special_note,\n            start_time: \"\".concat(_this2.startTime.format('YYYY-MM-DD')),\n            end_time: \"\".concat(_this2.endTime.format('YYYY-MM-DD')),\n            is_transfer: +_this2.is_transfer,\n            unit: unit,\n            num: num,\n            sell_type: _this2.sell_type,\n            card_introduction: _this2.cardIntroduction,\n            card_contents: _this2.cardContents,\n            card_bg: _this2.cardBg,\n            price_gradient: price_gradient,\n            support_member_num: _this2.isFamilyCard ? values.support_member_num : 1\n          }).subscribe(function (res) {\n            // 编辑成功\n            _this2.$router.push({\n              name: 'shop-product-card-member-list-all'\n            });\n          });\n        }\n      });\n    },\n    // 价格梯度\n    brandPriceSettingHandleChange: function brandPriceSettingHandleChange(_ref) {\n      var value = _ref.value,\n          key = _ref.key,\n          col = _ref.col,\n          prop = _ref.prop;\n      this.rallyPriceIsNoInput = false;\n\n      if (prop !== undefined) {\n        this.rallyPriceList[key][col][prop] = value;\n      } else {\n        this.rallyPriceList[key][col] = value;\n      }\n    },\n    // 删除价格\n    brand_price_delete: function brand_price_delete(index) {\n      this.rallyPriceList.splice(index, 1);\n    },\n    // 增加价格\n    brand_price_add: function brand_price_add() {\n      var key = parseInt(Math.random() * 999999).toString();\n      this.rallyPriceList.push({\n        key: key,\n        time: {\n          unit: 2,\n          num: null\n        },\n        rally_price: null,\n        frozen_day: null,\n        gift_unit: null\n      });\n    },\n    // 开始时间\n    disabledStartDate: function disabledStartDate(startValue) {\n      var endValue = this.end_time;\n\n      if (!endValue) {\n        // 结束时间未选择\n        return startValue.valueOf() < moment().startOf('day').valueOf();\n      }\n\n      var start = endValue.valueOf() > moment().add(30, 'y').valueOf() ? moment(endValue).subtract(30, 'y').valueOf() : moment().startOf('day').valueOf();\n      return startValue.valueOf() < start || startValue.valueOf() > moment(endValue).valueOf();\n    },\n    handleStartOpenChange: function handleStartOpenChange(open) {\n      if (!open) {\n        this.endOpen = true;\n      }\n    },\n    start_time_change: function start_time_change(data) {\n      this.startTime = cloneDeep(data);\n    },\n    // 结束时间\n    disabledEndDate: function disabledEndDate(endValue) {\n      var startValue = this.start_time;\n\n      if (!startValue) {\n        // 开始时间未选择\n        return endValue.valueOf() < moment().startOf('day').valueOf();\n      }\n\n      return endValue.valueOf() >= moment(startValue).add(30, 'y').valueOf() || endValue.valueOf() < moment(startValue).valueOf() || endValue.valueOf() < moment().startOf('day').valueOf();\n    },\n    handleEndOpenChange: function handleEndOpenChange(open) {\n      this.endOpen = open;\n    },\n    end_time_change: function end_time_change(data) {\n      this.endTime = cloneDeep(data);\n    },\n    // 转让\n    transfer: function transfer(e) {\n      this.is_transfer = e.target.checked; // 重置转让费用的校验\n\n      this.form.resetFields(['transferNum']);\n    },\n    transfter_change: function transfter_change(data) {\n      this.transferNum = data;\n    },\n    // moment\n    moment: moment,\n    // 检验price\n    validatePrice: function validatePrice() {\n      var _this3 = this;\n\n      this.rallyPriceIsNoInput = false;\n\n      if (!this.priceValidateRuleText.length) {\n        this.rallyPriceIsOk = false;\n      } else {\n        this.rallyPriceIsOk = this.priceValidateRuleText.every(function (i) {\n          return _this3.pattern.NUM_FLOAT(1).test(i);\n        });\n      }\n    },\n    onCardBgChange: function onCardBgChange(e) {\n      this.cardBgValidatorText = '';\n    },\n    // 卡背景校验\n    cardBgValidator: function cardBgValidator() {\n      var validata = this.cardBg.image_key !== '';\n      this.cardBgValidatorText = validata ? '' : '请上传卡背景';\n    }\n  },\n  watch: {\n    priceValidateStatus: function priceValidateStatus(newVal) {\n      this.rallyPriceValidText = newVal === 'success' ? '' : '请输入正确的数值';\n    },\n    transferUnit: {\n      deep: true,\n      handler: function handler() {\n        if (!this.transfer_unit_is_first) {\n          this.form.resetFields(['transferNum']);\n        }\n\n        this.transfer_unit_is_first = false;\n      }\n    }\n  },\n  computed: {\n    priceValidateStatus: function priceValidateStatus() {\n      if (this.rallyPriceIsNoInput) {\n        return 'success';\n      } else {\n        return this.rallyPriceIsOk ? 'success' : 'error';\n      }\n    },\n    priceValidateRuleText: function priceValidateRuleText() {\n      var text = [];\n      this.rallyPriceList.forEach(function (i) {\n        Object.keys(i).forEach(function (o) {\n          if (o !== 'key' && o !== 'time' && o !== '$_oddEvenKey') {\n            text.push(i[o]);\n          } else if (o === 'time') {\n            text.push(i[o].num);\n          }\n        });\n      });\n      return text;\n    },\n    // 售卖方式\n    sellTypeList: function sellTypeList() {\n      var sell_type = cloneDeep(this.sellType);\n      var arr = [];\n      sell_type.forEach(function (i) {\n        arr.push({\n          value: i.value,\n          label: i.label\n        });\n      });\n\n      if (!this.appConfig) {\n        remove(arr, function (i) {\n          return i.value === SELL_TYPE.CLIENT;\n        });\n      }\n\n      return arr;\n    },\n    // 卡背景是否校验通过\n    cardBgIsOk: function cardBgIsOk() {\n      return this.cardBgValidatorText === '';\n    },\n    // 转让设置的min\n    transferMin: function transferMin() {\n      return 0;\n    },\n    // 转让设置的max\n    transferMax: function transferMax() {\n      return this.transferUnit === UNIT.PERCENT ? 100 : 999999.9;\n    },\n    // 是否是多人卡\n    isFamilyCard: function isFamilyCard() {\n      return this.$searchQuery.type === 'family-card';\n    }\n  }\n};",{"version":3,"sources":["edit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-mina-panel class=\"page-shop-basic-card page-shop-edit-period-card\">\n    <h5-container slot=\"preview\" fixed>\n      <template v-slot:title>购卡</template>\n      <template v-slot:default>\n        <member-card\n          :data=\"h5CardInfo\"\n          :cardType=\"MEMBER_CARD.PERIOD_CARD\"\n        ></member-card>\n      </template>\n    </h5-container>\n\n    <form-banner slot=\"prepend\" :shelf-number=\"cardInfo.shelf_shop_num\" />\n    <div slot=\"actions\">\n      <st-button\n        :loading=\"loading.editCard\"\n        type=\"primary\"\n        @click=\"onHandleSubmit\"\n      >\n        保 存\n      </st-button>\n    </div>\n\n    <div class=\"page-content\">\n      <st-form :form=\"form\" labelWidth=\"118px\">\n        <a-row :gutter=\"8\" class=\"page-content-card-line__row\">\n          <a-col :lg=\"22\">\n            <p class=\"page-content-card__card__name\">\n              <st-tag type=\"period-card\" />\n              <span>{{ cardInfo.card_name }}</span>\n            </p>\n            <st-form-item class=\"page-content-card-line\" label=\"特别说明\">\n              <a-input\n                class=\"page-content-card-input\"\n                v-decorator=\"decorators.special_note\"\n                maxlength=\"20\"\n                placeholder=\"最多显示20个字符\"\n                @change=\"syncSpecialNote\"\n              ></a-input>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\" v-if=\"isFamilyCard\">\n          <a-col :lg=\"23\">\n            <st-form-item\n              class=\"page-content-card-admission-range mg-t4\"\n              required\n            >\n              <template slot=\"label\">\n                支持入场人数\n                <st-help-tooltip id=\"TBMCDC003\" />\n              </template>\n              <a-select\n                v-decorator=\"decorators.support_member_num\"\n                :disabled=\"isShelfCard\"\n                placeholder=\"请选择入场人数\"\n                class=\"page-content-card-input\"\n              >\n                <a-select-option\n                  v-for=\"(item, index) in supportMemberNums\"\n                  :key=\"index\"\n                  :value=\"item.value\"\n                >\n                  {{ item.label }}\n                </a-select-option>\n              </a-select>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"23\">\n            <st-form-item class=\"mg-b16\" label=\"支持入场门店\">\n              {{ shopName.name }}\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"23\">\n            <st-form-item\n              class=\"page-content-card-price-setting\"\n              label=\"价格设置\"\n              required\n              :help=\"rallyPriceValidText\"\n            >\n              <div\n                class=\"page-price-setting-set\"\n                :class=\"{\n                  'page-price-setting-set-error':\n                    priceValidateStatus === 'error'\n                }\"\n              >\n                <st-table\n                  :columns=\"priceColumns\"\n                  :dataSource=\"rallyPriceList\"\n                  rowKey=\"key\"\n                  :pagination=\"false\"\n                >\n                  <template slot=\"time\" slot-scope=\"text, record, index\">\n                    <st-input-number\n                      :min=\"1\"\n                      :max=\"99999\"\n                      :disabled=\"isShelfCard\"\n                      :value=\"text.num\"\n                      @change=\"\n                        e =>\n                          brandPriceSettingHandleChange({\n                            value: e,\n                            key: index,\n                            col: 'time',\n                            prop: 'num'\n                          })\n                      \"\n                    >\n                      <a-select\n                        slot=\"addonAfter\"\n                        :value=\"text.unit\"\n                        :disabled=\"isShelfCard\"\n                        @change=\"\n                          e =>\n                            brandPriceSettingHandleChange({\n                              value: e,\n                              key: index,\n                              col: 'time',\n                              prop: 'unit'\n                            })\n                        \"\n                        style=\"width: 50px\"\n                      >\n                        <a-select-option\n                          v-for=\"(item, index) in nuit_list\"\n                          :value=\"item.value\"\n                          :key=\"index\"\n                        >\n                          {{ item.label }}\n                        </a-select-option>\n                      </a-select>\n                    </st-input-number>\n                  </template>\n                  <template slot=\"rally_price\" slot-scope=\"text, record, index\">\n                    <st-input-number\n                      :disabled=\"isShelfCard\"\n                      :float=\"true\"\n                      :min=\"0\"\n                      :max=\"999999.9\"\n                      :value=\"text\"\n                      @change=\"\n                        e =>\n                          brandPriceSettingHandleChange({\n                            value: e,\n                            key: index,\n                            col: 'rally_price'\n                          })\n                      \"\n                    ></st-input-number>\n                  </template>\n                  <template slot=\"frozen_day\" slot-scope=\"text, record, index\">\n                    <st-input-number\n                      :min=\"0\"\n                      :max=\"99999\"\n                      :value=\"text\"\n                      :disabled=\"isShelfCard\"\n                      @change=\"\n                        e =>\n                          brandPriceSettingHandleChange({\n                            value: e,\n                            key: index,\n                            col: 'frozen_day'\n                          })\n                      \"\n                    ></st-input-number>\n                  </template>\n                  <template slot=\"gift_unit\" slot-scope=\"text, record, index\">\n                    <st-input-number\n                      :min=\"0\"\n                      :max=\"99999\"\n                      :disabled=\"isShelfCard\"\n                      :value=\"text\"\n                      @change=\"\n                        e =>\n                          brandPriceSettingHandleChange({\n                            value: e,\n                            key: index,\n                            col: 'gift_unit'\n                          })\n                      \"\n                    ></st-input-number>\n                  </template>\n                  <st-table-actions\n                    slot=\"operation\"\n                    slot-scope=\"text, record, index\"\n                  >\n                    <a\n                      v-if=\"!isShelfCard\"\n                      href=\"javascript:;\"\n                      @click=\"brand_price_delete(index)\"\n                    >\n                      删除\n                    </a>\n                  </st-table-actions>\n                </st-table>\n                <st-button\n                  v-if=\"!isShelfCard\"\n                  :disabled=\"rallyPriceList.length >= 12\"\n                  type=\"dashed\"\n                  icon=\"add\"\n                  class=\"page-price-setting-set__add\"\n                  block\n                  @click=\"brand_price_add\"\n                >\n                  新增定价规格（{{ rallyPriceList.length }}/12）\n                </st-button>\n              </div>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"20\">\n            <st-form-item class=\"page-content-card-time\" required>\n              <span slot=\"label\">\n                支持售卖时间\n                <a-popover\n                  trigger=\"hover\"\n                  placement=\"bottomRight\"\n                  arrowPointAtCenter\n                >\n                  <div slot=\"content\">\n                    设置此{{ $c('member_card') }}可售卖的时间范围\n                  </div>\n                  <a-icon\n                    class=\"page-content-card-time__icon\"\n                    type=\"info-circle\"\n                  ></a-icon>\n                </a-popover>\n              </span>\n              <a-form-item class=\"page-a-form\">\n                <a-date-picker\n                  :disabled=\"isShelfCard\"\n                  :disabledDate=\"disabledStartDate\"\n                  v-decorator=\"decorators.start_time\"\n                  format=\"YYYY-MM-DD\"\n                  placeholder=\"开始时间\"\n                  :showToday=\"false\"\n                  @openChange=\"handleStartOpenChange\"\n                  @change=\"start_time_change\"\n                />\n              </a-form-item>\n              &nbsp;~&nbsp;\n              <a-form-item class=\"page-a-form\">\n                <a-date-picker\n                  :disabledDate=\"disabledEndDate\"\n                  v-decorator=\"decorators.end_time\"\n                  format=\"YYYY-MM-DD\"\n                  placeholder=\"结束时间\"\n                  :showToday=\"false\"\n                  :open=\"endOpen\"\n                  @openChange=\"handleEndOpenChange\"\n                  @change=\"end_time_change\"\n                />\n              </a-form-item>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"20\">\n            <st-form-item class=\"page-content-card-transfer\" label=\"转让设置\">\n              <div class=\"page-content-card-transfer-body\">\n                <a-checkbox\n                  class=\"page-checkbox\"\n                  :checked=\"is_transfer\"\n                  @change=\"transfer\"\n                >\n                  支持转让\n                </a-checkbox>\n                <st-input-number\n                  v-decorator=\"decorators.transferNum\"\n                  class=\"page-input-group page-content-card-num-input\"\n                  :float=\"transferUnit === UNIT.RMB\"\n                  @change=\"transfter_change\"\n                  :disabled=\"!is_transfer\"\n                  :min=\"transferMin\"\n                  :max=\"transferMax\"\n                >\n                  <a-select\n                    slot=\"addonAfter\"\n                    v-model=\"transferUnit\"\n                    :disabled=\"!is_transfer\"\n                  >\n                    <a-select-option\n                      v-for=\"item in unit\"\n                      :key=\"item.value\"\n                      :value=\"item.value\"\n                    >\n                      {{ item.label }}\n                    </a-select-option>\n                  </a-select>\n                </st-input-number>\n              </div>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"20\">\n            <st-form-item\n              class=\"page-content-card-sell-type\"\n              label=\"售卖方式\"\n              required\n            >\n              <a-checkbox-group v-model=\"sell_type\">\n                <a-checkbox\n                  v-for=\"item in sellTypeList\"\n                  :key=\"item.value\"\n                  :value=\"item.value\"\n                >\n                  {{ item.label }}\n                </a-checkbox>\n              </a-checkbox-group>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"20\">\n            <st-form-item\n              class=\"page-content-card-bg\"\n              label=\"卡背景\"\n              required\n              :help=\"cardBgValidatorText\"\n            >\n              <card-bg-radio\n                @change=\"onCardBgChange\"\n                v-model=\"cardBg\"\n                :isFamilyCard=\"isFamilyCard\"\n              />\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"22\">\n            <st-form-item\n              class=\"page-content-card-introduction\"\n              :label=\"`${$c('member_card')}介绍`\"\n            >\n              <st-editor v-model=\"cardIntroduction\"></st-editor>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"22\">\n            <st-form-item class=\"page-content-card-contents\" label=\"内部备注\">\n              <st-textarea\n                v-model=\"cardContents\"\n                maxlength=\"500\"\n                class=\"page-content-card-textarea\"\n                placeholder=\"请输入\"\n              />\n            </st-form-item>\n          </a-col>\n        </a-row>\n      </st-form>\n    </div>\n  </st-mina-panel>\n</template>\n<script>\nimport { UserService } from '@/services/user.service'\nimport moment from 'moment'\nimport { PatternService } from '@/services/pattern.service'\nimport { cloneDeep, remove } from 'lodash-es'\nimport { EditService } from './edit.service'\nimport MemberCard from '@/views/biz-components/h5/pages/member-card'\nimport H5Container from '@/views/biz-components/h5/h5-container'\nimport h5mixin from './h5mixin'\nimport { MEMBER_CARD } from '@/views/biz-components/h5/pages/member-card.config'\nimport CardBgRadio from '@/views/biz-components/card-bg-radio/card-bg-radio'\nimport FormBanner from '@/views/biz-components/card/form-banner'\nimport { SELL_TYPE, UNIT, CARD_TYPE } from '@/constants/card/member'\nimport { ruleOptions } from './period.config'\nimport StEditor from '@/views/components/editor#/editor.vue'\n\nexport default {\n  name: 'PageShopPeriodCardAdd',\n  mixins: [h5mixin],\n  components: {\n    StEditor,\n    MemberCard,\n    H5Container,\n    CardBgRadio,\n    FormBanner\n  },\n  serviceInject() {\n    return {\n      pattern: PatternService,\n      editService: EditService,\n      userService: UserService\n    }\n  },\n  rxState() {\n    return {\n      cardInfo: this.editService.cardInfo$,\n      loading: this.editService.loading$,\n      shopName: this.userService.shop$,\n      cardBgList: this.editService.cardBgList$,\n      admissionRange: this.editService.admissionRange$,\n      priceSetting: this.editService.priceSetting$,\n      supportSales: this.editService.supportSales$,\n      unit: this.editService.unit$,\n      sellType: this.editService.sellType$,\n      isShelfCard: this.editService.isShelfCard$,\n      supportMemberNums: this.editService.supportMemberNums$\n    }\n  },\n  bem: {\n    b: 'st-help-popover'\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      SELL_TYPE,\n      UNIT,\n      cardType: MEMBER_CARD.PERIOD_CARD,\n      MEMBER_CARD,\n      // 结束时间面板是否显示\n      endOpen: false,\n      priceColumns: [\n        {\n          title: '期限',\n          scopedSlots: { customRender: 'time' },\n          dataIndex: 'time'\n        },\n        {\n          title: '售价/元',\n          scopedSlots: { customRender: 'rally_price' },\n          dataIndex: 'rally_price'\n        },\n        {\n          title: '允许冻结/天',\n          scopedSlots: { customRender: 'frozen_day' },\n          dataIndex: 'frozen_day'\n        },\n        {\n          title: '赠送上限/天',\n          scopedSlots: { customRender: 'gift_unit' },\n          dataIndex: 'gift_unit'\n        },\n        {\n          title: '操作',\n          dataIndex: 'operation',\n          width: '60px',\n          scopedSlots: { customRender: 'operation' }\n        }\n      ],\n      // 价格梯度\n      rallyPriceList: [],\n      // 价格检验是否通过\n      rallyPriceIsOk: true,\n      // 价格是否未输入过\n      rallyPriceIsNoInput: true,\n      // 价格校验文案\n      rallyPriceValidText: '',\n      nuit_list: [\n        {\n          value: 2,\n          label: '天'\n        },\n        {\n          value: 3,\n          label: '月'\n        },\n        {\n          value: 4,\n          label: '年'\n        }\n      ],\n      // 售卖时间\n      startTime: null,\n      endTime: null,\n      // 是否支持转让\n      is_transfer: false,\n      // 转让单位\n      transferUnit: UNIT.RMB,\n      // 转让手续费\n      transferNum: 0,\n      transfer_unit_is_first: true,\n      // 售卖方式\n      sell_type: [SELL_TYPE.OFFLINE],\n      // 卡背景\n      cardBg: {\n        image_id: 0,\n        image_key: this.cardBgList[0].image_key,\n        image_url: '',\n        index: 1\n      },\n      // 卡背景的help文本\n      cardBgValidatorText: '',\n      // 卡介绍\n      cardIntroduction: '',\n      // 备注\n      cardContents: '',\n      // 是否配置了用户端\n      appConfig: true,\n      // 是否禁止选择开始时间,如果卡状态是可售卖，则需要禁止修改开始时间\n      startTimeIsDisabled: false\n    }\n  },\n  mounted() {\n    this.init()\n  },\n  methods: {\n    // init\n    init() {\n      // 价格设置\n      this.cardInfo.price_gradient.forEach(i => {\n        this.rallyPriceList.push({\n          key: i.id,\n          id: i.id,\n          time: {\n            unit: +i.unit,\n            num: +i.num\n          },\n          rally_price: +i.rally_price,\n          frozen_day: +i.frozen_day,\n          gift_unit: +i.gift_unit\n        })\n      })\n      // 支持售卖时间\n      this.form.setFieldsValue({\n        special_note: this.cardInfo.special_note,\n        start_time: moment(this.cardInfo.start_time * 1000),\n        end_time: moment(this.cardInfo.end_time * 1000),\n        transferNum: this.cardInfo.transfer_num\n      })\n      if (this.isFamilyCard) {\n        this.form.setFieldsValue({\n          support_member_num: this.cardInfo.support_member_num\n        })\n      }\n      this.startTimeIsDisabled =\n        this.cardInfo.start_time * 1000 <\n          moment()\n            .startOf('day')\n            .valueOf() && this.cardInfo.end_time * 1000 > moment().valueOf()\n      this.startTime = moment(this.cardInfo.start_time * 1000)\n      this.endTime = moment(this.cardInfo.end_time * 1000)\n      // 转让设置\n      this.is_transfer = !!this.cardInfo.is_transfer\n      this.transferUnit = this.cardInfo.transfer_unit\n      this.transferNum = this.cardInfo.transfer_num\n      // 售卖方式\n      this.sell_type = this.cardInfo.sell_type\n      // 卡背景\n      this.cardBg = cloneDeep(this.cardInfo.card_bg)\n      // 卡介绍\n      this.cardIntroduction = this.cardInfo.card_introduction\n      // 卡备注\n      this.cardContents = this.cardInfo.card_contents\n      this.initH5CardInfo()\n    },\n    // 保存\n    onHandleSubmit(e) {\n      this.form.validateFieldsAndScroll((err, values) => {\n        this.validatePrice()\n        this.cardBgValidator()\n        if (!err && this.priceValidateStatus === 'success' && this.cardBgIsOk) {\n          let unit = this.is_transfer ? this.transferUnit : undefined\n          let num = this.is_transfer ? this.transferNum : undefined\n          let price_gradient = []\n          this.rallyPriceList.forEach(i => {\n            price_gradient.push({\n              id: i.id || 0,\n              unit: i.time.unit,\n              num: i.time.num,\n              rally_price: i.rally_price,\n              frozen_day: i.frozen_day,\n              gift_unit: i.gift_unit\n            })\n          })\n          this.editService\n            .editCard({\n              id: this.cardInfo.card_id,\n              card_type: this.isFamilyCard\n                ? CARD_TYPE.MORE_PERIOD\n                : CARD_TYPE.PERIOD,\n              card_name: values.card_name,\n              special_note: values.special_note,\n              start_time: `${this.startTime.format('YYYY-MM-DD')}`,\n              end_time: `${this.endTime.format('YYYY-MM-DD')}`,\n              is_transfer: +this.is_transfer,\n              unit,\n              num,\n              sell_type: this.sell_type,\n              card_introduction: this.cardIntroduction,\n              card_contents: this.cardContents,\n              card_bg: this.cardBg,\n              price_gradient,\n              support_member_num: this.isFamilyCard\n                ? values.support_member_num\n                : 1\n            })\n            .subscribe(res => {\n              // 编辑成功\n              this.$router.push({\n                name: 'shop-product-card-member-list-all'\n              })\n            })\n        }\n      })\n    },\n    // 价格梯度\n    brandPriceSettingHandleChange({ value, key, col, prop }) {\n      this.rallyPriceIsNoInput = false\n      if (prop !== undefined) {\n        this.rallyPriceList[key][col][prop] = value\n      } else {\n        this.rallyPriceList[key][col] = value\n      }\n    },\n    // 删除价格\n    brand_price_delete(index) {\n      this.rallyPriceList.splice(index, 1)\n    },\n    // 增加价格\n    brand_price_add() {\n      let key = parseInt(Math.random() * 999999).toString()\n      this.rallyPriceList.push({\n        key,\n        time: {\n          unit: 2,\n          num: null\n        },\n        rally_price: null,\n        frozen_day: null,\n        gift_unit: null\n      })\n    },\n    // 开始时间\n    disabledStartDate(startValue) {\n      const endValue = this.end_time\n      if (!endValue) {\n        // 结束时间未选择\n        return (\n          startValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n        )\n      }\n      let start =\n        endValue.valueOf() >\n        moment()\n          .add(30, 'y')\n          .valueOf()\n          ? moment(endValue)\n              .subtract(30, 'y')\n              .valueOf()\n          : moment()\n              .startOf('day')\n              .valueOf()\n      return (\n        startValue.valueOf() < start ||\n        startValue.valueOf() > moment(endValue).valueOf()\n      )\n    },\n    handleStartOpenChange(open) {\n      if (!open) {\n        this.endOpen = true\n      }\n    },\n    start_time_change(data) {\n      this.startTime = cloneDeep(data)\n    },\n    // 结束时间\n    disabledEndDate(endValue) {\n      const startValue = this.start_time\n      if (!startValue) {\n        // 开始时间未选择\n        return (\n          endValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n        )\n      }\n      return (\n        endValue.valueOf() >=\n          moment(startValue)\n            .add(30, 'y')\n            .valueOf() ||\n        endValue.valueOf() < moment(startValue).valueOf() ||\n        endValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n      )\n    },\n    handleEndOpenChange(open) {\n      this.endOpen = open\n    },\n    end_time_change(data) {\n      this.endTime = cloneDeep(data)\n    },\n    // 转让\n    transfer(e) {\n      this.is_transfer = e.target.checked\n      // 重置转让费用的校验\n      this.form.resetFields(['transferNum'])\n    },\n    transfter_change(data) {\n      this.transferNum = data\n    },\n    // moment\n    moment,\n    // 检验price\n    validatePrice() {\n      this.rallyPriceIsNoInput = false\n      if (!this.priceValidateRuleText.length) {\n        this.rallyPriceIsOk = false\n      } else {\n        this.rallyPriceIsOk = this.priceValidateRuleText.every(i =>\n          this.pattern.NUM_FLOAT(1).test(i)\n        )\n      }\n    },\n    onCardBgChange(e) {\n      this.cardBgValidatorText = ''\n    },\n    // 卡背景校验\n    cardBgValidator() {\n      let validata = this.cardBg.image_key !== ''\n      this.cardBgValidatorText = validata ? '' : '请上传卡背景'\n    }\n  },\n  watch: {\n    priceValidateStatus(newVal) {\n      this.rallyPriceValidText = newVal === 'success' ? '' : '请输入正确的数值'\n    },\n    transferUnit: {\n      deep: true,\n      handler() {\n        if (!this.transfer_unit_is_first) {\n          this.form.resetFields(['transferNum'])\n        }\n        this.transfer_unit_is_first = false\n      }\n    }\n  },\n  computed: {\n    priceValidateStatus() {\n      if (this.rallyPriceIsNoInput) {\n        return 'success'\n      } else {\n        return this.rallyPriceIsOk ? 'success' : 'error'\n      }\n    },\n    priceValidateRuleText() {\n      let text = []\n      this.rallyPriceList.forEach(i => {\n        Object.keys(i).forEach(o => {\n          if (o !== 'key' && o !== 'time' && o !== '$_oddEvenKey') {\n            text.push(i[o])\n          } else if (o === 'time') {\n            text.push(i[o].num)\n          }\n        })\n      })\n      return text\n    },\n    // 售卖方式\n    sellTypeList() {\n      let sell_type = cloneDeep(this.sellType)\n      let arr = []\n      sell_type.forEach(i => {\n        arr.push({\n          value: i.value,\n          label: i.label\n        })\n      })\n      if (!this.appConfig) {\n        remove(arr, i => i.value === SELL_TYPE.CLIENT)\n      }\n      return arr\n    },\n    // 卡背景是否校验通过\n    cardBgIsOk() {\n      return this.cardBgValidatorText === ''\n    },\n    // 转让设置的min\n    transferMin() {\n      return 0\n    },\n    // 转让设置的max\n    transferMax() {\n      return this.transferUnit === UNIT.PERCENT ? 100 : 999999.9\n    },\n    // 是否是多人卡\n    isFamilyCard() {\n      return this.$searchQuery.type === 'family-card'\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/shop/product/card/member/period"}]}