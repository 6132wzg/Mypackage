{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/card/brand-member/shelf.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/card/brand-member/shelf.vue","mtime":1600926555837},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.function.name\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.number.constructor\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { ShelfService } from \"./shelf.service\";\nimport { cloneDeep } from 'lodash-es';\nimport { PatternService } from '@/services/pattern.service';\nimport ShopHourPicker from '@/views/components/hour-picker#/hour-picker';\nimport { ruleOptions, shopColumns, admissionTimeList } from \"./shelf.config\";\nimport { BRAND_MEMBER } from '@/constants/card/brand-member';\nimport { MessageService } from '@/services/message.service';\nexport default {\n  name: 'ModalCardBrandMemberShelf',\n  bem: {\n    shelves: 'modal-card-batch-shelves'\n  },\n  components: {\n    ShopHourPicker: ShopHourPicker\n  },\n  serviceInject: function serviceInject() {\n    return {\n      pattern: PatternService,\n      messageService: MessageService,\n      shelfService: ShelfService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      courseData: this.shelfService.courseList$,\n      course_interests: this.shelfService.course_interests$,\n      activateTypes: this.shelfService.activateTypes$,\n      loading: this.shelfService.loading$,\n      info: this.shelfService.info$,\n      shelfCardDetail: this.shelfService.shelfCardDetail$\n    };\n  },\n  props: {\n    id: {\n      type: Number,\n      default: 0\n    },\n    shelf_id: {\n      type: Number,\n      default: 0\n    },\n    actionType: {\n      type: String,\n      default: 'shelf'\n    },\n    title: {\n      type: String,\n      default: '标题'\n    }\n  },\n  computed: {\n    shopColumns: shopColumns,\n    admissionTimeList: admissionTimeList,\n    shopList: function shopList() {\n      var shopList = [];\n\n      if (this.info.sell_shops) {\n        this.info.sell_shops.forEach(function (i) {\n          var id = parseInt(Math.random() * 999999).toString();\n          shopList.push(_objectSpread({}, i, {\n            key: id\n          }));\n        });\n      }\n\n      return shopList;\n    },\n    admissionTimeIsOk: function admissionTimeIsOk() {\n      return this.admissionTimeText === '';\n    },\n    courseInterestsIsOk: function courseInterestsIsOk() {\n      return this.courseInterestsStatus === 'success';\n    },\n    priceIsOk: function priceIsOk() {\n      return this.priceHelpText === '';\n    },\n    priceValidataArray: function priceValidataArray() {\n      var array = [];\n      this.priceList.forEach(function (i) {\n        array.push(i.priceInputValue);\n      });\n      return array;\n    },\n    vipTree: function vipTree() {\n      var array = [];\n\n      if (this.actionType === 'shelf' && this.info.areas) {\n        this.info.areas.forEach(function (i) {\n          var children = [];\n          i.areas.forEach(function (o) {\n            children.push({\n              title: o.name,\n              key: \"\".concat(i.id, \"-\").concat(o.id),\n              scopedSlots: {\n                title: 'title'\n              }\n            });\n          });\n          array.push({\n            title: i.name,\n            key: i.id,\n            scopedSlots: {\n              title: 'title'\n            },\n            children: children\n          });\n        });\n      }\n\n      return array;\n    },\n    // 回传给后台的上架门店\n    sell_shops: function sell_shops() {\n      var shops = [];\n\n      if (this.info.sell_shops) {\n        this.info.sell_shops.forEach(function (i) {\n          shops.push(+i.id);\n        });\n      }\n\n      return shops;\n    }\n  },\n  watch: {\n    priceList: {\n      deep: true,\n      handler: function handler() {\n        var _this = this;\n\n        var b = this.priceValidataArray.every(function (i) {\n          return _this.pattern.NUM_FLOAT(1).test(i);\n        });\n        b && this.checkedPrice();\n      }\n    },\n    info: {\n      deep: true,\n      handler: function handler(newVal) {\n        var _this2 = this;\n\n        newVal.specs.forEach(function (i) {\n          _this2.priceList.push(_objectSpread({}, i, {\n            priceInputValue: ''\n          }));\n        });\n      }\n    }\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      firstLoading: false,\n      BRAND_MEMBER: BRAND_MEMBER,\n      form: form,\n      decorators: decorators,\n      show: true,\n      // 卡tag类型\n      cardTypeTag: {\n        1: 'number-card',\n        2: 'period-card'\n      },\n      // 门店明细\n      visible: false,\n      // 范围价格列表\n      priceList: [],\n      priceHelpText: '',\n      // 回传给后台的价格\n      specs: [],\n      // 开卡方式\n      openTypeList: [],\n      // 约课权益\n      // 输入是否正确\n      courseInterestsStatus: 'success',\n      courseInterestsHelpText: '',\n      // 课列表\n      courseInterests: null,\n      courseList: [],\n      // 显示更多\n      moreIsShow: true,\n      admissionTime: 1,\n      timeList: [],\n      // 回传给后台的时间段\n      inoutTime: [],\n      admissionTimeText: '',\n      expandedKeys: [],\n      autoExpandParent: true,\n      searchValue: '',\n      // 选择的vip区域\n      selectVipAreas: []\n    };\n  },\n  created: function created() {\n    var _this3 = this;\n\n    this.firstLoading = true;\n    var query = {};\n    var actionType = this.actionType,\n        shelf_id = this.shelf_id;\n\n    if (actionType === 'updateShelf') {\n      query.shelf_id = shelf_id;\n    }\n\n    this.shelfService.getInfo(this.id, query).subscribe(function (res) {\n      if (actionType === 'updateShelf') {\n        _this3.initShelfData();\n      }\n\n      _this3.firstLoading = false;\n    });\n  },\n  methods: {\n    getCourseList: function getCourseList(search) {\n      var query = {\n        course_name: search\n      };\n      this.shelfService.courseListAction$.dispatch(query);\n    },\n    // 检验入场时间是否输入正确\n    checkedAdmission: function checkedAdmission() {\n      this.admissionTimeText = this.admissionTime === 2 && this.moreIsShow && !this.timeList.length ? '请选择入场时间' : '';\n    },\n    brandPriceSettingHandleChange: function brandPriceSettingHandleChange(_ref) {\n      var value = _ref.value,\n          key = _ref.key;\n      this.priceList[key].priceInputValue = value;\n    },\n    // 检验门店自主定价价格输入是否正确\n    checkedPrice: function checkedPrice() {\n      var _this4 = this;\n\n      if (!(this.info.publish_channel === this.BRAND_MEMBER.PUBLISH_CHANNEL_1 && this.info.price_setting === this.BRAND_MEMBER.PRICE_SETTING_2)) {\n        this.priceHelpText = '';\n        return false;\n      }\n\n      var b = this.priceValidataArray.every(function (i) {\n        return _this4.pattern.NUM_FLOAT(1).test(i);\n      });\n      this.priceHelpText = b ? '' : '请输入价格';\n    },\n    onTreeSearch: function onTreeSearch(data) {\n      if (data === '') {\n        Object.assign(this, {\n          expandedKeys: [],\n          searchValue: data,\n          autoExpandParent: true\n        });\n        return;\n      }\n\n      var expandedKeys = [];\n      this.vipTree.forEach(function (i) {\n        if (i.children) {\n          i.children.forEach(function (o) {\n            if (o.title.includes(data)) {\n              expandedKeys.push(i.key);\n            }\n          });\n        }\n      });\n      this.expandedKeys = cloneDeep(expandedKeys);\n      this.searchValue = data;\n      this.autoExpandParent = true;\n    },\n    onExpand: function onExpand(expandedKeys) {\n      this.expandedKeys = expandedKeys;\n      this.autoExpandParent = false;\n    },\n    onTreeSelect: function onTreeSelect(checkeds) {\n      var selectAreasObject = {};\n      var vipAreas = [];\n      var selectAreasArray = [];\n      vipAreas = checkeds.filter(function (i) {\n        return \"\".concat(i).includes('-');\n      });\n      vipAreas.forEach(function (i) {\n        if (selectAreasObject[i.split('-')[0]]) {\n          selectAreasObject[i.split('-')[0]].push(+i.split('-')[1]);\n        } else {\n          selectAreasObject[i.split('-')[0]] = [+i.split('-')[1]];\n        }\n      });\n      Object.keys(selectAreasObject).forEach(function (i) {\n        selectAreasArray.push({\n          shop_id: +i,\n          areas: cloneDeep(selectAreasObject[i])\n        });\n      });\n      this.selectVipAreas = cloneDeep(selectAreasArray);\n    },\n    // 格式化价格\n    formatSpecs: function formatSpecs() {\n      var _this5 = this;\n\n      this.specs = [];\n\n      if (this.info.publish_channel === this.BRAND_MEMBER.PUBLISH_CHANNEL_1 && this.info.price_setting === this.BRAND_MEMBER.PRICE_SETTING_2) {\n        // 有价格范围\n        this.priceList.forEach(function (i) {\n          _this5.specs.push({\n            specs_id: i.spec_id,\n            price: i.priceInputValue\n          });\n        });\n      } else {\n        // 无价格范围,发布渠道为2是门店，一定是无范围的\n        this.priceList.forEach(function (i) {\n          _this5.specs.push({\n            specs_id: i.spec_id,\n            price: i.rally_price\n          });\n        });\n      }\n    },\n    // 格式化入场时段\n    formatWeek: function formatWeek() {\n      var _this6 = this;\n\n      this.inoutTime = [];\n      this.timeList.forEach(function (i) {\n        _this6.inoutTime.push({\n          week_day: +i.week_day,\n          time_duration: [{\n            start_time: i.start_time,\n            end_time: i.end_time\n          }]\n        });\n      });\n    },\n    onSubmit: function onSubmit() {\n      var _this7 = this;\n\n      this.form.validate().then(function (values) {\n        _this7.checkedAdmission(); // TODO: shop hour picker后续修改，不能有默认值\n\n\n        _this7.formatWeek();\n\n        _this7.formatSpecs();\n\n        if (!_this7.inputCheck()) {\n          return;\n        }\n\n        if (_this7.admissionTimeIsOk) {\n          if (_this7.openTypeList.toString() === '3') {\n            _this7.$confirm({\n              title: '确认上架?',\n              content: '当前仅选择指定日期开卡，上架后小程序不显示该卡，确认上架？',\n              onOk: function onOk() {\n                _this7.sendShelfCard(values);\n              }\n            });\n\n            return;\n          }\n\n          _this7.sendShelfCard(values);\n        }\n      });\n    },\n    getParams: function getParams(values, shelf_id) {\n      var params = {\n        sell_shops: this.sell_shops,\n        open_type: this.openTypeList,\n        activate_duration: values.openDay === undefined ? values.openDay : +values.openDay,\n        course_interests: +this.courseInterests,\n        courses: values.courseList,\n        inout_type: this.admissionTime,\n        inout_time: this.inoutTime,\n        specs: this.specs\n      };\n      var actionType = this.actionType,\n          selectVipAreas = this.selectVipAreas,\n          shelfCardDetail = this.shelfCardDetail;\n\n      if (actionType === 'shelf') {\n        params.areas = selectVipAreas;\n      } else {\n        params.areas = shelfCardDetail.areas;\n      }\n\n      if (shelf_id) {\n        params.shelf_id = shelf_id;\n        /**\n         * 变更上架信息不传 sell_shops\n         */\n\n        delete params.sell_shops;\n      }\n\n      return params;\n    },\n    inputCheck: function inputCheck() {\n      if (!this.courseInterests) {\n        this.messageService.error({\n          content: '请选择约课权益'\n        });\n        return false;\n      }\n\n      return true;\n    },\n    sendShelfCard: function sendShelfCard(values) {\n      var _this8 = this;\n\n      var params = this.getParams(values);\n      this.shelfService.shelfCard(params, this.id).subscribe(function () {\n        _this8.show = false;\n\n        _this8.$emit('success');\n      });\n    },\n    onUpdateShelf: function onUpdateShelf() {\n      var _this9 = this;\n\n      this.form.validate().then(function (values) {\n        _this9.checkedAdmission();\n\n        _this9.formatWeek();\n\n        _this9.formatSpecs();\n\n        var params = _this9.getParams(values, _this9.shelf_id);\n\n        if (!_this9.inputCheck()) {\n          return;\n        }\n\n        _this9.shelfService.updateShelf(_this9.id, params).subscribe(function () {\n          _this9.show = false;\n\n          _this9.$emit('success');\n        });\n      });\n    },\n\n    /**\n     * 变更上架表单数据回显\n     */\n    initShelfData: function initShelfData() {\n      var _this10 = this;\n\n      var detail = this.shelfCardDetail;\n      this.openTypeList = detail.activate_type;\n      this.courseInterests = detail.course_interests;\n      this.admissionTime = detail.inout_type;\n      this.timeList = this.timeFilter(detail.inout_time);\n      this.vipAreaList = detail.areas;\n      this.$nextTick(function () {\n        _this10.form.setFieldsValue({\n          openDay: detail.automatic_num,\n          courseList: detail.courses\n        });\n      });\n      this.getCourseList('');\n    },\n    timeFilter: function timeFilter(timeList) {\n      return timeList.map(function (item) {\n        var week_day = item.week_day;\n        var _item$time_duration$ = item.time_duration[0],\n            start_time = _item$time_duration$.start_time,\n            end_time = _item$time_duration$.end_time;\n        return {\n          week_day: week_day,\n          start_time: start_time,\n          end_time: end_time\n        };\n      });\n    }\n  }\n};",{"version":3,"sources":["shelf.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal\n    :title=\"title\"\n    v-model=\"show\"\n    wrapClassName=\"modal-card-batch-shelves\"\n    width=\"668px\"\n    :loading=\"firstLoading\"\n  >\n    <section :class=\"shelves('content')\">\n      <div :class=\"shelves('info')\" class=\"mg-b24\">\n        <img\n          :class=\"shelves('card_bg')\"\n          v-if=\"info.bg_image\"\n          :src=\"info.bg_image | imgFilter({ w: 142, h: 80 })\"\n          width=\"142\"\n          height=\"80\"\n          alt=\"卡背景\"\n        />\n        <div :class=\"shelves('detail')\">\n          <p :class=\"shelves('detail-title')\" v-if=\"info.card_type\">\n            <st-tag\n              :type=\"cardTypeTag[info.card_type]\"\n              style=\"margin-right:8px;\"\n            />\n            {{ info.card_name }}\n          </p>\n          <p v-if=\"actionType === 'shelf'\" :class=\"shelves('detail-cards')\">\n            本次共上架{{ shopList.length }}家门店，\n            <a-popover\n              placement=\"bottom\"\n              trigger=\"click\"\n              :getPopupContainer=\"trigger => trigger.parentNode\"\n              v-model=\"visible\"\n            >\n              <span slot=\"title\" :class=\"shelves('card-list-title')\">\n                上架门店\n              </span>\n              <st-table\n                slot=\"content\"\n                rowKey=\"key\"\n                :dataSource=\"shopList\"\n                :columns=\"shopColumns\"\n                :pagination=\"false\"\n                :scroll=\"{ y: 270 }\"\n              />\n              <span>查看明细</span>\n            </a-popover>\n          </p>\n          <p :class=\"shelves('detail-saletype')\" v-if=\"info.sell_type\">\n            <span v-for=\"(item, index) in info.sell_type\" :key=\"index\">\n              {{ item | enumFilter('member_card.sell_type') }}\n            </span>\n          </p>\n        </div>\n      </div>\n      <st-form :form=\"form\" labelWidth=\"67px\" :class=\"shelves('form')\">\n        <!-- 次卡，无价格范围 -->\n        <div\n          :class=\"shelves('price')\"\n          v-if=\"\n            (info.publish_channel === BRAND_MEMBER.PUBLISH_CHANNEL_2 &&\n              info.card_type === BRAND_MEMBER.CARD_TYPE_1) ||\n              (info.price_setting === BRAND_MEMBER.PRICE_SETTING_1 &&\n                info.card_type === BRAND_MEMBER.CARD_TYPE_1)\n          \"\n          class=\"mg-b0\"\n        >\n          <st-form-table>\n            <colgroup>\n              <col style=\"width:4%;\" />\n              <col style=\"width:16%;\" />\n              <col style=\"width:22%;\" />\n              <col style=\"width:22%;\" />\n              <col style=\"width:18%;\" />\n              <col style=\"width:18%;\" />\n            </colgroup>\n            <tr>\n              <th></th>\n              <th>次数</th>\n              <th>售卖价格</th>\n              <th>有效期限</th>\n              <th>允许冻结</th>\n              <th>赠送上限</th>\n            </tr>\n            <tbody>\n              <tr v-for=\"(item, index) in info.specs\" :key=\"index\">\n                <td></td>\n                <td>{{ item.validity_times }}次</td>\n                <td>{{ item.rally_price }}元</td>\n                <td>\n                  {{ item.duration_num\n                  }}{{\n                    item.duration_unit | enumFilter('member_card.duration_unit')\n                  }}\n                </td>\n                <td>{{ item.frozen_day }}天</td>\n                <td>{{ item.gift_unit }}次</td>\n              </tr>\n            </tbody>\n          </st-form-table>\n        </div>\n        <!-- 期卡，无价格范围 -->\n        <div\n          :class=\"shelves('price')\"\n          v-if=\"\n            (info.publish_channel === BRAND_MEMBER.PUBLISH_CHANNEL_2 &&\n              info.card_type === BRAND_MEMBER.CARD_TYPE_2) ||\n              (info.price_setting === BRAND_MEMBER.PRICE_SETTING_1 &&\n                info.card_type === BRAND_MEMBER.CARD_TYPE_2)\n          \"\n          class=\"mg-b0\"\n        >\n          <st-form-table>\n            <colgroup>\n              <col style=\"width:4%;\" />\n              <col style=\"width:26%;\" />\n              <col style=\"width:26%;\" />\n              <col style=\"width:22%;\" />\n              <col style=\"width:22%;\" />\n            </colgroup>\n            <tr>\n              <th></th>\n              <th>有效期限</th>\n              <th>售卖价格</th>\n              <th>允许冻结</th>\n              <th>赠送上限</th>\n            </tr>\n            <tbody>\n              <tr v-for=\"(item, index) in info.specs\" :key=\"index\">\n                <td></td>\n                <td>\n                  {{ item.duration_num\n                  }}{{\n                    item.duration_unit | enumFilter('member_card.duration_unit')\n                  }}\n                </td>\n                <td>{{ item.rally_price }}元</td>\n                <td>{{ item.frozen_day }}天</td>\n                <td>{{ item.gift_unit }}天</td>\n              </tr>\n            </tbody>\n          </st-form-table>\n        </div>\n        <!-- 次卡，有价格范围 -->\n        <div\n          :class=\"{\n            'modal-card-batch-shelves__price-error': priceHelpText !== ''\n          }\"\n          v-if=\"\n            info.publish_channel === BRAND_MEMBER.PUBLISH_CHANNEL_1 &&\n              info.price_setting === BRAND_MEMBER.PRICE_SETTING_2 &&\n              info.card_type === BRAND_MEMBER.CARD_TYPE_1\n          \"\n          class=\"modal-card-batch-shelves__price mg-b0\"\n        >\n          <st-form-table>\n            <colgroup>\n              <col style=\"width:2%;\" />\n              <col style=\"width:10%;\" />\n              <col style=\"width:20%;\" />\n              <col style=\"width:17%;\" />\n              <col style=\"width:17%;\" />\n              <col style=\"width:17%;\" />\n              <col style=\"width:17%;\" />\n            </colgroup>\n            <tr>\n              <th></th>\n              <th>次数</th>\n              <th>售卖价格</th>\n              <th></th>\n              <th>有效期限</th>\n              <th>允许冻结</th>\n              <th>赠送上限</th>\n            </tr>\n            <tbody>\n              <tr v-for=\"(item, index) in priceList\" :key=\"index\">\n                <td></td>\n                <td>{{ item.validity_times }}次</td>\n                <td :class=\"shelves('price-input')\">\n                  <st-input-number\n                    :float=\"true\"\n                    :value=\"item.select_price || undefined\"\n                    :max=\"+item.max_price || undefined\"\n                    :min=\"+item.min_price || undefined\"\n                    @change=\"\n                      e =>\n                        brandPriceSettingHandleChange({ value: e, key: index })\n                    \"\n                    style=\"width:140px;\"\n                  >\n                    <span slot=\"addonAfter\">元</span>\n                  </st-input-number>\n                </td>\n                <td>\n                  &nbsp;{{ item.min_price }}&nbsp;~&nbsp;{{\n                    item.max_price\n                  }}&nbsp;\n                </td>\n                <td>\n                  {{ item.duration_num\n                  }}{{\n                    item.duration_unit | enumFilter('member_card.duration_unit')\n                  }}\n                </td>\n                <td>{{ item.frozen_day }}天</td>\n                <td>{{ item.gift_unit }}次</td>\n              </tr>\n            </tbody>\n          </st-form-table>\n        </div>\n        <!-- 期卡，有价格范围 -->\n        <div\n          :class=\"{\n            'modal-card-batch-shelves__price-error': priceHelpText !== ''\n          }\"\n          v-if=\"\n            info.publish_channel === BRAND_MEMBER.PUBLISH_CHANNEL_1 &&\n              info.price_setting === BRAND_MEMBER.PRICE_SETTING_2 &&\n              info.card_type === BRAND_MEMBER.CARD_TYPE_2\n          \"\n          class=\"modal-card-batch-shelves__price mg-b0\"\n        >\n          <st-form-table>\n            <colgroup>\n              <col style=\"width:2%;\" />\n              <col style=\"width:19%;\" />\n              <col style=\"width:22%;\" />\n              <col style=\"width:19%;\" />\n              <col style=\"width:19%;\" />\n              <col style=\"width:19%;\" />\n            </colgroup>\n            <tr>\n              <th></th>\n              <th>有效期限</th>\n              <th>售卖价格</th>\n              <th></th>\n              <th>允许冻结</th>\n              <th>赠送上限</th>\n            </tr>\n            <tbody>\n              <tr v-for=\"(item, index) in priceList\" :key=\"index\">\n                <td></td>\n                <td>\n                  {{ item.duration_num\n                  }}{{\n                    item.duration_unit | enumFilter('member_card.duration_unit')\n                  }}\n                </td>\n                <td :class=\"shelves('price-input')\">\n                  <st-input-number\n                    :float=\"true\"\n                    :value=\"item.select_price || undefined\"\n                    :max=\"+item.max_price || undefined\"\n                    :min=\"+item.min_price || undefined\"\n                    @change=\"\n                      e =>\n                        brandPriceSettingHandleChange({ value: e, key: index })\n                    \"\n                    style=\"width:140px;\"\n                  >\n                    <span slot=\"addonAfter\">元</span>\n                  </st-input-number>\n                </td>\n                <td>\n                  &nbsp;{{ item.min_price }}&nbsp;~&nbsp;{{\n                    item.max_price\n                  }}&nbsp;\n                </td>\n                <td>{{ item.frozen_day }}天</td>\n                <td>{{ item.gift_unit }}天</td>\n              </tr>\n            </tbody>\n          </st-form-table>\n        </div>\n        <p :class=\"shelves('price-valid-text')\">{{ priceHelpText }}</p>\n        <st-form-item\n          labelGutter=\"12px\"\n          class=\"mg-b0\"\n          label=\"开卡方式\"\n          required\n        >\n          <a-checkbox-group\n            v-model=\"openTypeList\"\n            :class=\"shelves('open-type')\"\n          >\n            <template\n              v-for=\"(item, index) in activateTypes\"\n              :value=\"+item.value\"\n            >\n              <span\n                :class=\"shelves('day-input')\"\n                v-if=\"+item.value === 2\"\n                :key=\"index\"\n              >\n                <a-checkbox :value=\"+item.value\">{{ item.label }}</a-checkbox>\n                <div class=\"autoplay-card-day\" v-if=\"openTypeList.includes(2)\">\n                  <a-form-item class=\"page-a-form\">\n                    <st-input-number\n                      v-decorator=\"decorators.openDay\"\n                      class=\"autoplay-card-day-input\"\n                    >\n                      <span slot=\"addonAfter\">天</span>\n                    </st-input-number>\n                    <span>内未开卡，则自动开卡</span>\n                  </a-form-item>\n                </div>\n              </span>\n              <a-checkbox v-else :key=\"index\" :value=\"+item.value\">\n                {{ item.label }}\n              </a-checkbox>\n            </template>\n          </a-checkbox-group>\n        </st-form-item>\n        <st-form-item labelGutter=\"12px\" label=\"约课权益\" required>\n          <a-radio-group v-model=\"courseInterests\" :class=\"shelves('course')\">\n            <a-radio\n              v-for=\"(item, index) in course_interests\"\n              :value=\"+item.value\"\n              :key=\"index\"\n            >\n              {{ item.label }}\n            </a-radio>\n          </a-radio-group>\n          <a-select\n            v-if=\"courseInterests === 3\"\n            mode=\"multiple\"\n            style=\"width: 419px;\"\n            v-decorator=\"decorators.courseList\"\n            placeholder=\"请输入课程名称搜索\"\n            :filterOption=\"false\"\n            @search=\"getCourseList\"\n            :notFoundContent=\"loading.getCourseList ? undefined : null\"\n          >\n            <a-spin\n              v-if=\"loading.getCourseList\"\n              slot=\"notFoundContent\"\n              size=\"small\"\n            />\n            <a-select-option v-for=\"d in courseData\" :key=\"d.id\">\n              {{ d.name }}\n            </a-select-option>\n          </a-select>\n        </st-form-item>\n        <div v-if=\"!moreIsShow\" :class=\"shelves('show-more')\" class=\"mg-b18\">\n          <span @click=\"moreIsShow = true\">展开更多设置</span>\n          <st-icon @click=\"moreIsShow = true\" type=\"down-small\" />\n        </div>\n        <st-form-item\n          v-if=\"moreIsShow\"\n          labelGutter=\"12px\"\n          label=\"入场时段\"\n          class=\"mg-b16\"\n          required\n        >\n          <a-radio-group v-model=\"admissionTime\">\n            <a-radio\n              v-for=\"(item, index) in admissionTimeList\"\n              :value=\"+item.value\"\n              :key=\"index\"\n            >\n              {{ item.label }}\n            </a-radio>\n          </a-radio-group>\n        </st-form-item>\n        <shop-hour-picker\n          v-if=\"admissionTime === BRAND_MEMBER.ADMISSION_TIME_2 && moreIsShow\"\n          v-model=\"timeList\"\n        ></shop-hour-picker>\n        <p\n          :class=\"shelves('admission-time-validata')\"\n          v-if=\"admissionTime === BRAND_MEMBER.ADMISSION_TIME_2 && moreIsShow\"\n        >\n          {{ admissionTimeText }}\n        </p>\n        <st-form-item\n          v-if=\"moreIsShow\"\n          labelGutter=\"12px\"\n          class=\"mg-t18 mg-b8\"\n          labelWidth=\"78px\"\n          label=\"VIP场地通行\"\n        >\n          <span v-if=\"info.areas && !info.areas.length\">无</span>\n          <div v-else>\n            <!-- 上架会员卡时展示的场地 -->\n            <div v-if=\"actionType === 'shelf'\" :class=\"shelves('tree')\">\n              <a-input-search\n                class=\"mg-b16\"\n                :class=\"shelves('tree-search')\"\n                @search=\"onTreeSearch\"\n                placeholder=\"请输入场地名称查询\"\n              />\n              <a-tree\n                checkable\n                @expand=\"onExpand\"\n                :autoExpandParent=\"autoExpandParent\"\n                :expandedKeys=\"expandedKeys\"\n                :treeData=\"vipTree\"\n                @check=\"onTreeSelect\"\n              >\n                <template slot=\"title\" slot-scope=\"{ title }\">\n                  <span v-if=\"title.indexOf(searchValue) > -1\">\n                    {{ title.substr(0, title.indexOf(searchValue)) }}\n                    <span :class=\"shelves('tree-title-span')\">\n                      {{ searchValue }}\n                    </span>\n                    {{\n                      title.substr(\n                        title.indexOf(searchValue) + searchValue.length\n                      )\n                    }}\n                  </span>\n                  <span v-else>{{ title }}</span>\n                </template>\n              </a-tree>\n            </div>\n            <!-- 变更上架信息时展示的场地 -->\n            <a-checkbox-group\n              v-if=\"actionType === 'updateShelf'\"\n              v-model=\"shelfCardDetail.areas\"\n            >\n              <a-checkbox\n                v-for=\"(item, index) in info.areas\"\n                :key=\"index\"\n                :value=\"item.id\"\n              >\n                {{ item.name }}\n              </a-checkbox>\n            </a-checkbox-group>\n          </div>\n        </st-form-item>\n        <div :class=\"shelves('hide-more')\" v-if=\"moreIsShow\">\n          <span @click=\"moreIsShow = false\">收起</span>\n        </div>\n      </st-form>\n    </section>\n    <template slot=\"footer\">\n      <div :class=\"shelves('footer')\">\n        <st-button @click=\"show = false\">取消</st-button>\n        <!-- 上架 -->\n        <st-button\n          v-if=\"actionType === 'shelf'\"\n          @click=\"onSubmit\"\n          :loading=\"loading.shelfCard\"\n          type=\"primary\"\n        >\n          确认上架\n        </st-button>\n        <!-- 变更上架 -->\n        <st-button\n          v-if=\"actionType === 'updateShelf'\"\n          @click=\"onUpdateShelf\"\n          :loading=\"loading.updateShelf\"\n          type=\"primary\"\n        >\n          确认变更\n        </st-button>\n      </div>\n    </template>\n  </st-modal>\n</template>\n<script>\nimport { ShelfService } from './shelf.service'\nimport { cloneDeep } from 'lodash-es'\nimport { PatternService } from '@/services/pattern.service'\nimport ShopHourPicker from '@/views/components/hour-picker#/hour-picker'\nimport { ruleOptions, shopColumns, admissionTimeList } from './shelf.config'\nimport { BRAND_MEMBER } from '@/constants/card/brand-member'\nimport { MessageService } from '@/services/message.service'\nexport default {\n  name: 'ModalCardBrandMemberShelf',\n  bem: {\n    shelves: 'modal-card-batch-shelves'\n  },\n  components: {\n    ShopHourPicker\n  },\n  serviceInject() {\n    return {\n      pattern: PatternService,\n      messageService: MessageService,\n      shelfService: ShelfService\n    }\n  },\n  rxState() {\n    return {\n      courseData: this.shelfService.courseList$,\n      course_interests: this.shelfService.course_interests$,\n      activateTypes: this.shelfService.activateTypes$,\n      loading: this.shelfService.loading$,\n      info: this.shelfService.info$,\n      shelfCardDetail: this.shelfService.shelfCardDetail$\n    }\n  },\n  props: {\n    id: {\n      type: Number,\n      default: 0\n    },\n    shelf_id: {\n      type: Number,\n      default: 0\n    },\n    actionType: {\n      type: String,\n      default: 'shelf'\n    },\n    title: {\n      type: String,\n      default: '标题'\n    }\n  },\n  computed: {\n    shopColumns,\n    admissionTimeList,\n    shopList() {\n      let shopList = []\n      if (this.info.sell_shops) {\n        this.info.sell_shops.forEach(i => {\n          let id = parseInt(Math.random() * 999999).toString()\n          shopList.push({ ...i, key: id })\n        })\n      }\n      return shopList\n    },\n    admissionTimeIsOk() {\n      return this.admissionTimeText === ''\n    },\n    courseInterestsIsOk() {\n      return this.courseInterestsStatus === 'success'\n    },\n    priceIsOk() {\n      return this.priceHelpText === ''\n    },\n    priceValidataArray() {\n      let array = []\n      this.priceList.forEach(i => {\n        array.push(i.priceInputValue)\n      })\n      return array\n    },\n    vipTree() {\n      let array = []\n      if (this.actionType === 'shelf' && this.info.areas) {\n        this.info.areas.forEach(i => {\n          let children = []\n          i.areas.forEach(o => {\n            children.push({\n              title: o.name,\n              key: `${i.id}-${o.id}`,\n              scopedSlots: { title: 'title' }\n            })\n          })\n          array.push({\n            title: i.name,\n            key: i.id,\n            scopedSlots: { title: 'title' },\n            children\n          })\n        })\n      }\n      return array\n    },\n    // 回传给后台的上架门店\n    sell_shops() {\n      let shops = []\n      if (this.info.sell_shops) {\n        this.info.sell_shops.forEach(i => {\n          shops.push(+i.id)\n        })\n      }\n      return shops\n    }\n  },\n  watch: {\n    priceList: {\n      deep: true,\n      handler() {\n        let b = this.priceValidataArray.every(i =>\n          this.pattern.NUM_FLOAT(1).test(i)\n        )\n        b && this.checkedPrice()\n      }\n    },\n    info: {\n      deep: true,\n      handler(newVal) {\n        newVal.specs.forEach(i => {\n          this.priceList.push({\n            ...i,\n            priceInputValue: ''\n          })\n        })\n      }\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      firstLoading: false,\n      BRAND_MEMBER,\n      form,\n      decorators,\n      show: true,\n      // 卡tag类型\n      cardTypeTag: {\n        1: 'number-card',\n        2: 'period-card'\n      },\n      // 门店明细\n      visible: false,\n      // 范围价格列表\n      priceList: [],\n      priceHelpText: '',\n      // 回传给后台的价格\n      specs: [],\n      // 开卡方式\n      openTypeList: [],\n      // 约课权益\n      // 输入是否正确\n      courseInterestsStatus: 'success',\n      courseInterestsHelpText: '',\n      // 课列表\n      courseInterests: null,\n      courseList: [],\n      // 显示更多\n      moreIsShow: true,\n      admissionTime: 1,\n      timeList: [],\n      // 回传给后台的时间段\n      inoutTime: [],\n      admissionTimeText: '',\n      expandedKeys: [],\n      autoExpandParent: true,\n      searchValue: '',\n      // 选择的vip区域\n      selectVipAreas: []\n    }\n  },\n  created() {\n    this.firstLoading = true\n    const query = {}\n    const { actionType, shelf_id } = this\n    if (actionType === 'updateShelf') {\n      query.shelf_id = shelf_id\n    }\n    this.shelfService.getInfo(this.id, query).subscribe(res => {\n      if (actionType === 'updateShelf') {\n        this.initShelfData()\n      }\n      this.firstLoading = false\n    })\n  },\n  methods: {\n    getCourseList(search) {\n      let query = { course_name: search }\n      this.shelfService.courseListAction$.dispatch(query)\n    },\n    // 检验入场时间是否输入正确\n    checkedAdmission() {\n      this.admissionTimeText =\n        this.admissionTime === 2 && this.moreIsShow && !this.timeList.length\n          ? '请选择入场时间'\n          : ''\n    },\n    brandPriceSettingHandleChange({ value, key }) {\n      this.priceList[key].priceInputValue = value\n    },\n    // 检验门店自主定价价格输入是否正确\n    checkedPrice() {\n      if (\n        !(\n          this.info.publish_channel === this.BRAND_MEMBER.PUBLISH_CHANNEL_1 &&\n          this.info.price_setting === this.BRAND_MEMBER.PRICE_SETTING_2\n        )\n      ) {\n        this.priceHelpText = ''\n        return false\n      }\n      let b = this.priceValidataArray.every(i =>\n        this.pattern.NUM_FLOAT(1).test(i)\n      )\n      this.priceHelpText = b ? '' : '请输入价格'\n    },\n    onTreeSearch(data) {\n      if (data === '') {\n        Object.assign(this, {\n          expandedKeys: [],\n          searchValue: data,\n          autoExpandParent: true\n        })\n        return\n      }\n      let expandedKeys = []\n      this.vipTree.forEach(i => {\n        if (i.children) {\n          i.children.forEach(o => {\n            if (o.title.includes(data)) {\n              expandedKeys.push(i.key)\n            }\n          })\n        }\n      })\n      this.expandedKeys = cloneDeep(expandedKeys)\n      this.searchValue = data\n      this.autoExpandParent = true\n    },\n    onExpand(expandedKeys) {\n      this.expandedKeys = expandedKeys\n      this.autoExpandParent = false\n    },\n    onTreeSelect(checkeds) {\n      let selectAreasObject = {}\n      let vipAreas = []\n      let selectAreasArray = []\n      vipAreas = checkeds.filter(i => `${i}`.includes('-'))\n      vipAreas.forEach(i => {\n        if (selectAreasObject[i.split('-')[0]]) {\n          selectAreasObject[i.split('-')[0]].push(+i.split('-')[1])\n        } else {\n          selectAreasObject[i.split('-')[0]] = [+i.split('-')[1]]\n        }\n      })\n      Object.keys(selectAreasObject).forEach(i => {\n        selectAreasArray.push({\n          shop_id: +i,\n          areas: cloneDeep(selectAreasObject[i])\n        })\n      })\n      this.selectVipAreas = cloneDeep(selectAreasArray)\n    },\n    // 格式化价格\n    formatSpecs() {\n      this.specs = []\n      if (\n        this.info.publish_channel === this.BRAND_MEMBER.PUBLISH_CHANNEL_1 &&\n        this.info.price_setting === this.BRAND_MEMBER.PRICE_SETTING_2\n      ) {\n        // 有价格范围\n        this.priceList.forEach(i => {\n          this.specs.push({\n            specs_id: i.spec_id,\n            price: i.priceInputValue\n          })\n        })\n      } else {\n        // 无价格范围,发布渠道为2是门店，一定是无范围的\n        this.priceList.forEach(i => {\n          this.specs.push({\n            specs_id: i.spec_id,\n            price: i.rally_price\n          })\n        })\n      }\n    },\n    // 格式化入场时段\n    formatWeek() {\n      this.inoutTime = []\n      this.timeList.forEach(i => {\n        this.inoutTime.push({\n          week_day: +i.week_day,\n          time_duration: [{ start_time: i.start_time, end_time: i.end_time }]\n        })\n      })\n    },\n    onSubmit() {\n      this.form.validate().then(values => {\n        this.checkedAdmission()\n        // TODO: shop hour picker后续修改，不能有默认值\n        this.formatWeek()\n        this.formatSpecs()\n        if (!this.inputCheck()) {\n          return\n        }\n        if (this.admissionTimeIsOk) {\n          if (this.openTypeList.toString() === '3') {\n            this.$confirm({\n              title: '确认上架?',\n              content:\n                '当前仅选择指定日期开卡，上架后小程序不显示该卡，确认上架？',\n              onOk: () => {\n                this.sendShelfCard(values)\n              }\n            })\n            return\n          }\n          this.sendShelfCard(values)\n        }\n      })\n    },\n    getParams(values, shelf_id) {\n      const params = {\n        sell_shops: this.sell_shops,\n        open_type: this.openTypeList,\n        activate_duration:\n          values.openDay === undefined ? values.openDay : +values.openDay,\n        course_interests: +this.courseInterests,\n        courses: values.courseList,\n        inout_type: this.admissionTime,\n        inout_time: this.inoutTime,\n        specs: this.specs\n      }\n      const { actionType, selectVipAreas, shelfCardDetail } = this\n      if (actionType === 'shelf') {\n        params.areas = selectVipAreas\n      } else {\n        params.areas = shelfCardDetail.areas\n      }\n      if (shelf_id) {\n        params.shelf_id = shelf_id\n        /**\n         * 变更上架信息不传 sell_shops\n         */\n\n        delete params.sell_shops\n      }\n      return params\n    },\n    inputCheck() {\n      if (!this.courseInterests) {\n        this.messageService.error({\n          content: '请选择约课权益'\n        })\n        return false\n      }\n      return true\n    },\n    sendShelfCard(values) {\n      const params = this.getParams(values)\n      this.shelfService.shelfCard(params, this.id).subscribe(() => {\n        this.show = false\n        this.$emit('success')\n      })\n    },\n    onUpdateShelf() {\n      this.form.validate().then(values => {\n        this.checkedAdmission()\n        this.formatWeek()\n        this.formatSpecs()\n        const params = this.getParams(values, this.shelf_id)\n        if (!this.inputCheck()) {\n          return\n        }\n        this.shelfService.updateShelf(this.id, params).subscribe(() => {\n          this.show = false\n          this.$emit('success')\n        })\n      })\n    },\n    /**\n     * 变更上架表单数据回显\n     */\n    initShelfData() {\n      const detail = this.shelfCardDetail\n      this.openTypeList = detail.activate_type\n      this.courseInterests = detail.course_interests\n      this.admissionTime = detail.inout_type\n      this.timeList = this.timeFilter(detail.inout_time)\n      this.vipAreaList = detail.areas\n      this.$nextTick(() => {\n        this.form.setFieldsValue({\n          openDay: detail.automatic_num,\n          courseList: detail.courses\n        })\n      })\n      this.getCourseList('')\n    },\n    timeFilter(timeList) {\n      return timeList.map(item => {\n        const { week_day } = item\n        const { start_time, end_time } = item.time_duration[0]\n        return {\n          week_day,\n          start_time,\n          end_time\n        }\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/card/brand-member"}]}