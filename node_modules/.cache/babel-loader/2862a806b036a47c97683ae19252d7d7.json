{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/brand/marketing/plugin/add-prize.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/brand/marketing/plugin/add-prize.vue","mtime":1598250255727},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { AddPrizeService } from \"./add-prize.service\";\nimport { ruleOptions } from \"./add-prize.config.ts\";\nimport { PatternService } from '@/services/pattern.service';\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue';\nimport { cloneDeep } from 'lodash-es';\nimport SelectShop from '@/views/fragments/shop/select-shop.vue';\nimport { IMG_TYPE, SHOP_TYPE, PRIZE_TYPE } from '@/constants/marketing/lottery';\nimport { MessageService } from '@/services/message.service';\nexport default {\n  name: 'BrandMarketingPoster',\n  bem: {\n    basic: 'brand-marketing-poster'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      addPrizeService: AddPrizeService,\n      pattern: PatternService,\n      messageService: MessageService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      shops: this.addPrizeService.shops$,\n      prizeType: this.addPrizeService.prizeType$,\n      imgType: this.addPrizeService.imgType$,\n      prize: this.addPrizeService.prize$\n    };\n  },\n  props: {\n    info: {\n      type: Object\n    },\n    id: {\n      type: String\n    },\n    status: {\n      type: Number\n    }\n  },\n  data: function data(vm) {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      IMG_TYPE: IMG_TYPE,\n      PRIZE_TYPE: PRIZE_TYPE,\n      SHOP_TYPE: SHOP_TYPE,\n      show: false,\n      shopIds: [],\n      shopNum: 0,\n      fileList: [],\n      couponList: [],\n      curPrizeType: PRIZE_TYPE.CUSTOM,\n      curImgType: IMG_TYPE.DEFAULT,\n      curShopType: SHOP_TYPE.CUSTOM\n    };\n  },\n  mounted: function mounted() {\n    if (this.info) {\n      this.form.setFieldsValue({\n        prize_name: this.info.prize_name,\n        prize_type: this.info.prize_type,\n        coupon_id: this.info.coupon_id,\n        prize_id: this.info.prize_id,\n        activity_prize_id: this.info.activity_prize_id,\n        is_shop_range: this.info.is_shop_range,\n        support_shop_ids: this.info.support_shop_ids,\n        rate: this.info.rate,\n        number: this.info.number,\n        image: this.info.image,\n        image_default: this.info.image_default\n      });\n    }\n  },\n  created: function created() {\n    this.getCouponList();\n\n    if (this.info) {\n      this.curImgType = this.info.image_default;\n      this.curPrizeType = this.info.prize_type;\n      this.fileList[0] = this.info.prize;\n      this.shopIds = this.info.support_shop_ids;\n    }\n  },\n  components: {\n    SelectShop: SelectShop,\n    StImageUpload: StImageUpload\n  },\n  methods: {\n    getCurCouponShops: function getCurCouponShops(e) {\n      var _this = this;\n\n      this.couponList.filter(function (item) {\n        if (item.id === e) {\n          _this.shopNum = item.shop_num;\n        }\n      });\n    },\n    onChangeShopSetting: function onChangeShopSetting(val) {\n      this.shopIds = val;\n    },\n    getCouponList: function getCouponList() {\n      var _this2 = this;\n\n      var coupon_id = this.info ? this.info.coupon_id : 0;\n      return this.addPrizeService.getCouponList(coupon_id).subscribe(function (res) {\n        _this2.couponList = res.list;\n      });\n    },\n    onChangeGetAvatar: function onChangeGetAvatar(imageFiles) {\n      this.fileList = cloneDeep(imageFiles);\n    },\n    getCurPrizeType: function getCurPrizeType(e) {\n      this.curPrizeType = e.target.value;\n    },\n    getCurShopType: function getCurShopType(e) {\n      this.curShopType = e.target.value;\n    },\n    getCurImgType: function getCurImgType(e) {\n      this.curImgType = e.target.value;\n    },\n    onSubmit: function onSubmit() {\n      var _this3 = this;\n\n      if (this.curPrizeType === this.PRIZE_TYPE.CUSTOM && this.shopIds.length === 0) {\n        this.messageService.warn({\n          content: '请选择门店'\n        });\n        return;\n      }\n\n      this.form.validate().then(function (value) {\n        value.prize = _this3.curImgType === _this3.IMG_TYPE.CUSTOM ? _this3.fileList[0] || _this3.prize[0] : _this3.prize[0];\n        value.support_shop_ids = _this3.shopIds;\n        value.shop_num = _this3.shopNum;\n        value.prize_id = _this3.info ? _this3.info.prize_id : 0;\n        value.activity_prize_id = _this3.info ? _this3.info.activity_prize_id : 0;\n\n        if (_this3.curPrizeType === _this3.PRIZE_TYPE.DEFAULT && !value.coupon_id) {\n          _this3.messageService.warn({\n            content: '请选择优惠券'\n          });\n\n          return;\n        }\n\n        _this3.$emit('change', value);\n\n        _this3.show = false;\n      });\n    }\n  }\n};",null]}