{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/card/member/period/h5mixin.js","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/card/member/period/h5mixin.js","mtime":1591147717333},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport { cloneDeep } from 'lodash-es';\nvar unitEnum = {\n  2: '天',\n  3: '月',\n  4: '年'\n};\nexport default {\n  data: function data() {\n    return {\n      h5CardInfo: {\n        card_name: '',\n        special_note: '',\n        admission_range: {},\n        admission_shop_list: [],\n        card_bg: {\n          image_id: 0,\n          image_key: this.cardBgList[0].image_key,\n          image_url: this.cardBgList[0].image_url,\n          index: 1\n        },\n        card_contents: '',\n        card_introduction: '',\n        price_gradient: [],\n        price: {\n          card_price: '',\n          deadline: {}\n        },\n        can_use_shop: [],\n        consumption_range: {},\n        description: '',\n        consumerList: []\n      }\n    };\n  },\n  watch: {\n    'cardData.card_introduction': function cardDataCard_introduction(val) {\n      this.h5CardInfo.card_introduction = val;\n    },\n    'cardData.card_contents': function cardDataCard_contents(val) {\n      this.h5CardInfo.card_contents = val;\n    },\n    'cardData.description': function cardDataDescription(val) {\n      this.h5CardInfo.description = val;\n    },\n    'cardData.card_bg': function cardDataCard_bg(val) {\n      console.log(val);\n      this.h5CardInfo.card_bg = val;\n    },\n    'cardData.price_setting': function cardDataPrice_setting(val) {\n      this.syncPrice();\n    },\n    'cardData.unit': function cardDataUnit(val) {\n      var cardData = this.form.getFieldsValue().cardData;\n      var price = {\n        card_price: cardData.card_price || '',\n        deadline: {\n          number: cardData.num || '',\n          type: val\n        }\n      };\n      this.h5CardInfo.price = price;\n    },\n    'cardData.bg_image': function cardDataBg_image(val) {\n      this.h5CardInfo.card_bg = val;\n    },\n    rallyPriceList: {\n      deep: true,\n      handler: function handler() {\n        this.syncPrice();\n      }\n    },\n    shopPriceList: {\n      deep: true,\n      handler: function handler() {\n        this.syncPrice();\n      }\n    }\n  },\n  methods: {\n    initH5CardInfo: function initH5CardInfo() {\n      var cardInfo = Object.assign({}, this.cardInfo);\n      this.h5CardInfo.card_name = cardInfo.card_name;\n      this.h5CardInfo.special_note = cardInfo.special_note;\n      this.syncAdmission();\n\n      if (this.cardType === 2) {\n        var price = {\n          card_price: cardInfo.card_price,\n          deadline: {\n            number: cardInfo.num,\n            type: cardInfo.unit\n          }\n        };\n        this.h5CardInfo.price = price;\n        cardInfo.card_consumer_id && this.syncConsumer(cardInfo.card_consumer_id);\n      }\n    },\n    syncName: function syncName(e) {\n      this.h5CardInfo.card_name = e.target.value;\n    },\n    syncSpecialNote: function syncSpecialNote(e) {\n      this.h5CardInfo.special_note = e.target.value;\n    },\n    syncDeadlineNum: function syncDeadlineNum(value) {\n      // 储值卡金额\n      var cardData = this.form.getFieldsValue().cardData;\n      var price = {\n        card_price: cardData.card_price || '',\n        deadline: {\n          number: value,\n          type: this.cardData.unit\n        }\n      };\n      this.h5CardInfo.price = price;\n    },\n    syncDepositPrice: function syncDepositPrice(value) {\n      // 储值卡金额\n      var cardData = this.form.getFieldsValue().cardData;\n      var price = {\n        card_price: value,\n        deadline: {\n          number: cardData.num || '',\n          type: this.cardData.unit\n        }\n      };\n      this.h5CardInfo.price = price;\n    },\n    syncPrice: function syncPrice(values) {\n      // 会员卡金额\n      var p = [];\n\n      switch (this.cardData.price_setting) {\n        case 1:\n          // 品牌统一定价\n          if (this.cardType === 0) {\n            this.rallyPriceList.forEach(function (i) {\n              p.push({\n                validity_period: +i.time.num + unitEnum[i.time.unit],\n                sale_price: +i.rally_price + '元'\n              });\n            });\n          } else if (this.cardType === 1) {\n            this.rallyPriceList.forEach(function (i) {\n              p.push({\n                validity_times: \"\".concat(+i.validity_times, \"\\u6B21\"),\n                sale_price: +i.rally_price + '元'\n              });\n            });\n          }\n\n          break;\n\n        case 2:\n          // 门店自主定价\n          if (this.cardType === 0) {\n            this.shopPriceList.forEach(function (i) {\n              p.push({\n                validity_period: +i.time.num + unitEnum[i.time.unit],\n                sale_price: \"\".concat(+i.rally_price.min_price, \"\\u5143~\").concat(+i.rally_price.max_price, \"\\u5143\")\n              });\n            });\n          } else if (this.cardType === 1) {\n            this.shopPriceList.forEach(function (i) {\n              p.push({\n                validity_times: \"\".concat(+i.validity_times, \"\\u6B21\"),\n                sale_price: \"\".concat(+i.rally_price.min_price, \"\\u5143~\").concat(+i.rally_price.max_price, \"\\u5143\")\n              });\n            });\n          }\n\n          break;\n      }\n\n      this.h5CardInfo.price_gradient = cloneDeep(p);\n    },\n    syncAdmission: function syncAdmission() {\n      if (this.cardType === 2) {\n        var rangeId = this.cardData.consumption_range;\n\n        switch (rangeId) {\n          case 1:\n            this.h5CardInfo.consumption_range = {\n              id: 1,\n              name: '仅消费门店'\n            };\n            break;\n\n          case 2:\n            this.h5CardInfo.consumption_range = {\n              id: 2,\n              name: '多门店'\n            };\n            break;\n\n          case 3:\n            this.h5CardInfo.consumption_range = {\n              id: 3,\n              name: '全门店'\n            };\n            break;\n        }\n      } else {\n        var _rangeId = this.cardData.admission_range;\n\n        switch (_rangeId) {\n          case 1:\n            this.h5CardInfo.admission_range = {\n              id: 1,\n              name: '仅消费门店'\n            };\n            break;\n\n          case 2:\n            this.h5CardInfo.admission_range = {\n              id: 2,\n              name: '多门店'\n            };\n            break;\n\n          case 3:\n            this.h5CardInfo.admission_range = {\n              id: 3,\n              name: '全门店'\n            };\n            break;\n        }\n      }\n    },\n    syncAdmissionShop: function syncAdmissionShop() {\n      var _this = this;\n\n      if (this.cardType === 2) {\n        var shopIDs = this.cardData.consumer_shop_list;\n\n        if (shopIDs.length) {\n          this.addService.getShopBasic({\n            shop_ids: shopIDs\n          }).subscribe(function (res) {\n            _this.h5CardInfo.can_use_shop = res;\n          });\n        }\n      } else {\n        var _shopIDs = this.cardData.admission_shop_list;\n\n        if (_shopIDs.length) {\n          this.addService.getShopBasic({\n            shop_ids: _shopIDs\n          }).subscribe(function (res) {\n            _this.h5CardInfo.admission_shop_list = res;\n          });\n        }\n      }\n    },\n    syncConsumer: function syncConsumer(checkValue) {\n      console.log(checkValue);\n      var consumerEnum = this.consumerType;\n      this.h5CardInfo.consumerList = checkValue.map(function (item) {\n        return consumerEnum[--item].label;\n      });\n    }\n  }\n};",null]}