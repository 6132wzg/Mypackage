{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/app/attendance/list.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/app/attendance/list.vue","mtime":1600926556080},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { attendanceInfo, columns, shopList } from './list.config'\nimport shopSelect from '@/views/biz-components/shop/shop-select'\nimport { ListService } from './list.service'\nimport StaffSelect from '@/views/biz-components/staff-select/staff-select'\nimport tableMixin from '@/mixins/table.mixin'\nimport StTotal from '@/views/components/total#/total.vue'\nimport BrandAttendanceCardReplacement from '@/views/biz-modals/brand/app/attendance/card-replacement'\nexport default {\n  name: 'brand-app-attendance-list',\n  mixins: [tableMixin],\n  bem: {\n    module: 'brand-app-attendance-list'\n  },\n  modals: {\n    BrandAttendanceCardReplacement\n  },\n  serviceInject() {\n    return {\n      listService: ListService\n    }\n  },\n  rxState() {\n    return {\n      auth: this.listService.auth$,\n      summaryList: this.listService.summaryList$,\n      loading: this.listService.loading$,\n      tableList: this.listService.tableList$,\n      page: this.listService.page$,\n      departmentList: this.listService.departmentList$,\n      cardType: this.listService.cardType$\n    }\n  },\n  components: {\n    shopSelect,\n    StTotal,\n    StaffSelect\n  },\n  props: {},\n  data() {\n    return {\n      departmentId: [-1],\n      start_date: '',\n      end_date: '',\n      redioDays: [\n        {\n          label: '今日',\n          value: 'today'\n        },\n        {\n          label: '本周',\n          value: 'week'\n        },\n        {\n          label: '本月',\n          value: 'month'\n        }\n      ]\n    }\n  },\n  created() {\n    this.listService.getDepartmentList().subscribe()\n    this.getListHandle()\n  },\n  watch: {\n    departmentList: {\n      deep: true,\n      handler() {\n        const getKeyArr = (list, id) => {\n          if (!list || !list.length) return []\n          let arr = []\n          list.map(item => {\n            if (item.value === id) {\n              return arr.push(item.value)\n            }\n            let childArr = getKeyArr(item.children, id)\n            if (childArr.length) arr = [item.value, ...childArr]\n          })\n          return arr\n        }\n        let ids = getKeyArr(\n          this.departmentList,\n          this.$searchQuery.department_id\n        )\n        console.log(333444, ids)\n        this.departmentId = ids.length ? ids : [-1]\n      }\n    }\n  },\n  methods: {\n    getListHandle() {\n      this.listService.getAttendanceListHandle(this.$searchQuery).subscribe()\n    },\n    recentChangeHandle(event) {\n      this.onMultiSearch({\n        date_symbol: event.recently_day || '',\n        date_start: event.start_date || '',\n        date_end: event.end_date || ''\n      })\n    },\n    onCascaderChange(val) {\n      console.log(333, val)\n      this.$searchQuery.department_id = val.length ? val[val.length - 1] : [-1]\n      this.onSearch()\n    }\n  },\n  computed: {\n    columns,\n    shopList,\n    attendanceInfo\n  }\n}\n",{"version":3,"sources":["list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"list.vue","sourceRoot":"src/views/pages/brand/app/attendance","sourcesContent":["<template>\n  <div :class=\"module()\">\n    <portal to=\"BRAND_MARKETING_SHI\">\n      <staff-select\n        style=\"width: 260px\"\n        type=\"brand\"\n        placeholder=\"搜索员工姓名、手机号\"\n        @change=\"onSingleSearch('staff_id', $event)\"\n      ></staff-select>\n    </portal>\n    <!-- 员工考勤表格 -->\n    <div :class=\"module('main')\">\n      <div :class=\"module('main-title')\">\n        <div :class=\"module('main-btn')\">\n          <st-button\n            v-if=\"auth['authMend']\"\n            type=\"primary\"\n            v-modal-link=\"{\n              name: 'brand-attendance-card-replacement',\n              props: { source: '1' },\n              on: { success: getListHandle }\n            }\"\n          >\n            补卡\n          </st-button>\n          <st-button\n            v-if=\"auth['authExport']\"\n            v-export-excel=\"{\n              type: 'applications/staff-attendance/export',\n              query: $searchQuery\n            }\"\n          >\n            导出明细\n          </st-button>\n        </div>\n        <st-recent-radio-group\n          :showBtnRangeDate=\"false\"\n          :range=\"360\"\n          :days=\"redioDays\"\n          :value=\"{ day: $searchQuery.date_symbol }\"\n          @change=\"recentChangeHandle\"\n        ></st-recent-radio-group>\n        <shop-select\n          width=\"160px\"\n          v-model=\"$searchQuery.shop_id\"\n          @change=\"onSingleSearch('shop_id', $event)\"\n          class=\"mg-x8\"\n        />\n        <a-cascader\n          style=\"width: 160px\"\n          :allowClear=\"false\"\n          placeholder=\"请选择部门\"\n          :options=\"departmentList\"\n          change-on-select\n          v-model=\"departmentId\"\n          @change=\"onCascaderChange\"\n        />\n      </div>\n    </div>\n    <st-total\n      :indexs=\"attendanceInfo\"\n      :dataSource=\"summaryList\"\n      hasTitle\n      class=\"mg-b16\"\n    ></st-total>\n    <st-table\n      :loading=\"loading.getAttendanceListHandle\"\n      :columns=\"columns\"\n      :scroll=\"{ x: 1440 }\"\n      class=\"mg-t16\"\n      rowKey=\"product_type\"\n      :page=\"page\"\n      @change=\"onTableChange\"\n      :dataSource=\"tableList\"\n    >\n      <template slot=\"is_shop_range\" slot-scope=\"text, record\">\n        <span v-if=\"record.shops && record.shops.length === 1\">\n          {{ record.shops[0].shop_name }}\n        </span>\n        <span\n          v-else-if=\"record.shops && record.shops.length > 1\"\n          class=\"select-color\"\n        >\n          <div class=\"select-color popover-shops\">\n            <a-popover\n              placement=\"bottom\"\n              :getPopupContainer=\"\n                triggerNode => {\n                  return triggerNode.parentNode || document.body\n                }\n              \"\n            >\n              <template slot=\"content\">\n                <div :class=\"module('popover-shops')\">\n                  <div :class=\"module('popover-shops-title')\">全门店</div>\n                  <div :class=\"module('popover-shops-table')\">\n                    <st-table\n                      :columns=\"shopList\"\n                      :scroll=\"{ x: 532 }\"\n                      :pagination=\"false\"\n                      :dataSource=\"record.shops\"\n                    ></st-table>\n                  </div>\n                </div>\n              </template>\n              共有{{ record.shops.length }}家门店\n            </a-popover>\n          </div>\n        </span>\n        <span v-else>\n          --\n        </span>\n      </template>\n\n      <template slot=\"department\" slot-scope=\"text, record\">\n        <span v-if=\"record.department\">{{ record.department }}</span>\n        <span v-else>--</span>\n      </template>\n      <template slot=\"in_time\" slot-scope=\"text, record\">\n        <span v-if=\"record.in_type == '2'\" class=\"select-color popover-time\">\n          <a-popover\n            placement=\"left\"\n            :getPopupContainer=\"\n              triggerNode => {\n                return triggerNode.parentNode || document.body\n              }\n            \"\n          >\n            <template slot=\"content\">\n              <a-row\n                :style=\"{\n                  width: record.in_time.includes('次日') ? '206px' : ''\n                }\"\n              >\n                <a-col :span=\"4\">\n                  时间\n                </a-col>\n                <a-col :span=\"18\" :offset=\"2\">\n                  {{ record.date + ' ' + record.in_time }}\n                </a-col>\n              </a-row>\n              <a-row>\n                <a-col :span=\"4\">\n                  位置\n                </a-col>\n                <a-col :span=\"18\" :offset=\"2\">\n                  {{ record.in_shop_address }}\n                </a-col>\n              </a-row>\n              <a-row>\n                <a-col :span=\"4\">\n                  备注\n                </a-col>\n                <a-col :span=\"18\" :offset=\"2\">\n                  <img :src=\"record.in_photo\" width=\"80px\" height=\"80px\" />\n                </a-col>\n              </a-row>\n            </template>\n            {{ record.in_time }}\n            <div>({{ cardType[record.in_type] }})</div>\n          </a-popover>\n        </span>\n        <span v-else>\n          {{ record.in_time }}\n          <div v-if=\"record.in_type == '1'\">\n            ({{ cardType[record.in_type] }})\n          </div>\n        </span>\n      </template>\n      <template slot=\"out_time\" slot-scope=\"text, record\">\n        <span v-if=\"record.out_type == '2'\" class=\"select-color popover-time\">\n          <a-popover\n            placement=\"left\"\n            :getPopupContainer=\"\n              triggerNode => {\n                return triggerNode.parentNode || document.body\n              }\n            \"\n          >\n            <template slot=\"content\">\n              <a-row\n                :style=\"{\n                  width: record.out_time.includes('次日') ? '206px' : ''\n                }\"\n              >\n                <a-col :span=\"4\">\n                  时间\n                </a-col>\n                <a-col :span=\"18\" :offset=\"2\">\n                  {{ record.date + ' ' + record.out_time }}\n                </a-col>\n              </a-row>\n              <a-row>\n                <a-col :span=\"4\">\n                  位置\n                </a-col>\n                <a-col :span=\"18\" :offset=\"2\">\n                  {{ record.out_shop_address }}\n                </a-col>\n              </a-row>\n              <a-row>\n                <a-col :span=\"4\">\n                  备注\n                </a-col>\n                <a-col :span=\"18\" :offset=\"2\">\n                  <img :src=\"record.out_photo\" width=\"80px\" height=\"80px\" />\n                </a-col>\n              </a-row>\n            </template>\n            {{ record.out_time }}\n            <div>({{ cardType[record.out_type] }})</div>\n          </a-popover>\n        </span>\n        <span v-else>\n          {{ record.out_time }}\n          <div v-if=\"record.out_type == '1'\">\n            ({{ cardType[record.out_type] }})\n          </div>\n        </span>\n      </template>\n      <template slot=\"remark\" slot-scope=\"text, record\">\n        <span v-if=\"record.remark\">{{ record.remark }}</span>\n        <span v-else>--</span>\n      </template>\n      <template slot=\"action\" slot-scope=\"text, record\">\n        <span\n          class=\"select-color\"\n          v-modal-link=\"{\n            name: 'brand-attendance-card-replacement',\n            props: { source: '2', record: record },\n            on: { success: getListHandle }\n          }\"\n          v-if=\"record.auth['brand:application:staff_attendance|mend']\"\n        >\n          补卡\n        </span>\n        <span v-else>--</span>\n      </template>\n    </st-table>\n  </div>\n</template>\n\n<script>\nimport { attendanceInfo, columns, shopList } from './list.config'\nimport shopSelect from '@/views/biz-components/shop/shop-select'\nimport { ListService } from './list.service'\nimport StaffSelect from '@/views/biz-components/staff-select/staff-select'\nimport tableMixin from '@/mixins/table.mixin'\nimport StTotal from '@/views/components/total#/total.vue'\nimport BrandAttendanceCardReplacement from '@/views/biz-modals/brand/app/attendance/card-replacement'\nexport default {\n  name: 'brand-app-attendance-list',\n  mixins: [tableMixin],\n  bem: {\n    module: 'brand-app-attendance-list'\n  },\n  modals: {\n    BrandAttendanceCardReplacement\n  },\n  serviceInject() {\n    return {\n      listService: ListService\n    }\n  },\n  rxState() {\n    return {\n      auth: this.listService.auth$,\n      summaryList: this.listService.summaryList$,\n      loading: this.listService.loading$,\n      tableList: this.listService.tableList$,\n      page: this.listService.page$,\n      departmentList: this.listService.departmentList$,\n      cardType: this.listService.cardType$\n    }\n  },\n  components: {\n    shopSelect,\n    StTotal,\n    StaffSelect\n  },\n  props: {},\n  data() {\n    return {\n      departmentId: [-1],\n      start_date: '',\n      end_date: '',\n      redioDays: [\n        {\n          label: '今日',\n          value: 'today'\n        },\n        {\n          label: '本周',\n          value: 'week'\n        },\n        {\n          label: '本月',\n          value: 'month'\n        }\n      ]\n    }\n  },\n  created() {\n    this.listService.getDepartmentList().subscribe()\n    this.getListHandle()\n  },\n  watch: {\n    departmentList: {\n      deep: true,\n      handler() {\n        const getKeyArr = (list, id) => {\n          if (!list || !list.length) return []\n          let arr = []\n          list.map(item => {\n            if (item.value === id) {\n              return arr.push(item.value)\n            }\n            let childArr = getKeyArr(item.children, id)\n            if (childArr.length) arr = [item.value, ...childArr]\n          })\n          return arr\n        }\n        let ids = getKeyArr(\n          this.departmentList,\n          this.$searchQuery.department_id\n        )\n        console.log(333444, ids)\n        this.departmentId = ids.length ? ids : [-1]\n      }\n    }\n  },\n  methods: {\n    getListHandle() {\n      this.listService.getAttendanceListHandle(this.$searchQuery).subscribe()\n    },\n    recentChangeHandle(event) {\n      this.onMultiSearch({\n        date_symbol: event.recently_day || '',\n        date_start: event.start_date || '',\n        date_end: event.end_date || ''\n      })\n    },\n    onCascaderChange(val) {\n      console.log(333, val)\n      this.$searchQuery.department_id = val.length ? val[val.length - 1] : [-1]\n      this.onSearch()\n    }\n  },\n  computed: {\n    columns,\n    shopList,\n    attendanceInfo\n  }\n}\n</script>\n\n<style lang=\"less\" scoped></style>\n"]}]}