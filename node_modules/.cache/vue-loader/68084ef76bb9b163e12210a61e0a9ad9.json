{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/package/component#/add-course-fix-table.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/package/component#/add-course-fix-table.vue","mtime":1597396799965},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport CourseSelectCourse from '@/views/biz-modals/course/select-course'\nimport { FormService } from './form.service'\nimport { AddFixPackageService } from '../add-fix-package.service'\nimport { forEach, cloneDeep, remove, every, reduce, filter } from 'lodash'\nimport { isEmpty } from 'lodash-es'\nexport default {\n  name: 'AddCourseFixTable',\n  bem: {\n    add: 'page-shop-add-fix-package',\n    b: 'page-shop-add-basic-package'\n  },\n  serviceInject() {\n    return {\n      addFixService: AddFixPackageService\n    }\n  },\n  rxState() {\n    return {\n      coachList: this.addFixService.coachList$\n    }\n  },\n  computed: {\n    all_total() {\n      let teamTotal = this.packageData.is_team\n        ? this.teamCourseTotalObject.total\n        : 0\n      let personalTotal = this.packageData.is_personal\n        ? this.personalCourseTotalObject.total\n        : 0\n      return teamTotal + personalTotal\n    }\n  },\n  props: {\n    initInfo: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    },\n    useShopInfo: {\n      type: Object,\n      default: () => {}\n    }\n  },\n  watch: {\n    packageData: {\n      handler: function(newValue, oldValue) {\n        if (!newValue.is_team && !newValue.is_personal) {\n          this.$emit('change', {})\n          return ''\n        }\n        if (newValue.is_team && !this.teamCourseList.length) {\n          this.$emit('change', {})\n          return false\n        }\n        if (newValue.is_personal && !this.personalCourseList.length) {\n          this.$emit('change', {})\n          return false\n        }\n        this.$emit(\n          'change',\n          this.getRangeCourse({\n            team_range: this.teamCourseList,\n            ...newValue,\n            personal_range: this.personalCourseList\n          })\n        )\n      },\n      deep: true\n    },\n    teamCourseList: {\n      handler: function(newValue, oldValue) {\n        let allSelect = false\n        let allNotSelect = false\n        allSelect = every(newValue, o => o.courseChecked)\n        allNotSelect = every(newValue, o => !o.courseChecked)\n        this.teamIndeterminate = !allSelect && !allNotSelect\n        this.teamCheckAll = newValue.length ? allSelect : false\n        newValue.forEach(item => {\n          this.validateTeam = !item.team_times || !item.team_unit_price\n        })\n        // 计算团课总计\n        this.teamCourseTotalObject.team_times = reduce(\n          newValue,\n          (sum, o) => {\n            let team_times = isNaN(+o.team_times) ? 0 : +o.team_times\n            return sum + team_times\n          },\n          0\n        )\n        this.teamCourseTotalObject.total = reduce(\n          newValue,\n          (sum, o) => {\n            let team_times = isNaN(+o.team_times) ? 0 : +o.team_times\n            let team_unit_price = isNaN(+o.team_unit_price)\n              ? 0\n              : +o.team_unit_price\n            return sum + (team_times * (team_unit_price * 10)) / 10\n          },\n          0\n        )\n        if (this.validateTeam) {\n          this.$emit('change', {})\n          return\n        }\n        this.$emit(\n          'change',\n          this.getRangeCourse({\n            personal_range: this.personalCourseList,\n            ...this.packageData,\n            team_range: newValue\n          })\n        )\n      },\n      deep: true\n    },\n    personalCourseList: {\n      handler: function(newValue, oldValue) {\n        newValue.forEach(item => {\n          this.validatePersonal =\n            !item.personal_times || !item.personal_unit_price\n        })\n        let allSelect = false\n        let allNotSelect = false\n        allSelect = every(newValue, o => o.courseChecked)\n        allNotSelect = every(newValue, o => !o.courseChecked)\n        this.personalIndeterminate = !allSelect && !allNotSelect\n        this.personalCheckAll = newValue.length ? allSelect : false\n        // 计算私教课总计\n        this.personalCourseTotalObject.personal_times = reduce(\n          newValue,\n          (sum, o) => {\n            let personal_times = isNaN(+o.personal_times)\n              ? 0\n              : +o.personal_times\n            return sum + personal_times\n          },\n          0\n        )\n        this.personalCourseTotalObject.total = reduce(\n          newValue,\n          (sum, o) => {\n            let personal_times = isNaN(+o.personal_times)\n              ? 0\n              : +o.personal_times\n            let personal_unit_price = isNaN(+o.personal_unit_price)\n              ? 0\n              : +o.personal_unit_price\n            return sum + (personal_times * (personal_unit_price * 10)) / 10\n          },\n          0\n        )\n        if (this.validatePersonal) {\n          this.$emit('change', {})\n          return\n        }\n        this.$emit(\n          'change',\n          this.getRangeCourse({\n            personal_range: newValue,\n            ...this.packageData,\n            team_range: this.teamCourseList\n          })\n        )\n      },\n      deep: true\n    }\n  },\n  data() {\n    return {\n      isCourseRange: false,\n      validateTeam: false,\n      validatePersonal: false,\n      personalCoachTotalList: {},\n      personalCoachListHistory: [],\n      // 操作栏checkbox是否半选\n      teamIndeterminate: false,\n      // 操作栏checkbox是否半选\n      personalIndeterminate: false,\n      // 操作栏checkbox是全选\n      personalCheckAll: false,\n      // 配置课程表格是否显示\n      teamCourseListIsShow: false,\n      // 配置的课程总计\n      teamCourseTotalObject: {\n        team_times: 0,\n        total: 0\n      },\n      // 备份课程已做的操作\n      teamCourseTotalList: {},\n      // 批量操作的值\n      teamOperationObject: {\n        team_times: undefined,\n        team_unit_price: undefined\n      },\n      // 操作栏选择教练等级的dorpdown是否显示\n      coachAllOperationDropdownIsShow: false,\n      // 操作栏教练等级选择的值\n      personalAllOperationCoachList: [],\n      // 批量操作的值\n      personalOperationObject: {\n        personal_times: undefined,\n        personal_unit_price: undefined\n      },\n      // 配置课程表格是否显示\n      personalCourseListIsShow: false,\n      // 配置的课程总计\n      personalCourseTotalObject: {\n        personal_times: 0,\n        total: 0\n      },\n      personalCourseTotalList: [],\n      // team course\n      teamCourseList: [],\n      // personal course\n      personalCourseList: [],\n      // 课程范围是否未输入过\n      courseIsFirstInput: true,\n      // 操作栏checkbox是全选\n      teamCheckAll: false,\n      packageData: {\n        is_team: false,\n        is_personal: false\n      },\n      validateCourseRange: ''\n    }\n  },\n  modals: {\n    CourseSelectCourse\n  },\n  filters: {\n    // 单课价格统计\n    course_item_total(times, unit_price) {\n      if (+times && +unit_price) {\n        return (+times * (+unit_price * 10)) / 10\n      } else {\n        return 0\n      }\n    }\n  },\n  methods: {\n    // 移除选择的课程\n    removeCourseItems(type) {\n      if (type === 'team') {\n        let arr = cloneDeep(this.teamCourseList)\n        let removeList = remove(arr, o => o.courseChecked)\n        this.teamCourseList = arr\n        // 移除备份\n        let list = cloneDeep(this.teamCourseTotalList)\n        removeList.forEach(i => {\n          delete list[i.course_id]\n        })\n        this.teamCourseTotalList = list\n      } else if (type === 'personal') {\n        let arr = cloneDeep(this.personalCourseList)\n        let removeList = remove(arr, o => o.courseChecked)\n        this.personalCourseList = arr\n        // 移除备份\n        let coachList = cloneDeep(this.personalCourseTotalList)\n        removeList.forEach(i => {\n          delete coachList[i.course_id]\n        })\n        this.personalCourseTotalList = coachList\n      }\n    },\n    getRangeCourse(rangeCourse) {\n      const form = cloneDeep(rangeCourse)\n      if (typeof form.personal_range === 'object') {\n        form.personal_range = form.personal_range.map(item => {\n          return {\n            personal_unit_price: item.personal_unit_price,\n            personal_times: item.personal_times,\n            course_id: item.course_id,\n            coach_level: item.coachGradeList.map(item =>\n              typeof item === 'number' ? item : item.id\n            )\n          }\n        })\n      }\n      if (typeof form.team_range === 'object') {\n        form.team_range = form.team_range.map(item => {\n          return {\n            team_unit_price: item.team_unit_price,\n            team_times: item.team_times,\n            course_id: item.course_id\n          }\n        })\n      }\n      if (!rangeCourse.is_team) {\n        form.team_range = []\n      }\n      if (!rangeCourse.is_personal) {\n        form.personal_range = []\n      }\n      form.is_team = +rangeCourse.is_team\n      form.is_personal = +rangeCourse.is_personal\n      return form\n    },\n    // item coach checkboxGroup changeEvent\n    coachItemChange(e, id, index) {\n      if (!e.length) {\n        this.personalCourseList[\n          index\n        ].coachGradeList = this.personalCoachListHistory[index]\n        return\n      } else {\n        this.personalCoachListHistory[index] = cloneDeep(e)\n      }\n      this.personalCourseTotalList[id] = this.personalCourseTotalList[id]\n        ? this.personalCourseTotalList[id]\n        : {}\n      this.personalCourseTotalList[id].list = cloneDeep(e)\n    },\n    // teamItems input change\n    teamInputChange(e, type, id) {\n      this.teamCourseTotalList[id] = this.teamCourseTotalList[id]\n        ? this.teamCourseTotalList[id]\n        : {}\n      this.teamCourseTotalList[id][type] = e\n    },\n    // 选择课程\n    courseItemCheckedChange(e, type, index) {\n      if (type === 'team') {\n        this.teamCourseList[index].courseChecked = e.target.checked\n      } else if (type === 'personal') {\n        this.personalCourseList[index].courseChecked = e.target.checked\n      }\n    },\n    // personalItems input change\n    personalInputChange(e, type, id) {\n      this.personalCourseTotalList[id] = this.personalCourseTotalList[id]\n        ? this.personalCourseTotalList[id]\n        : {}\n      this.personalCourseTotalList[id][type] = e\n    },\n    // 移除课程\n    removeCourseItem(type, id) {\n      if (type === 'team') {\n        let arr = cloneDeep(this.teamCourseList)\n        remove(arr, o => o.course_id === id)\n        this.teamCourseList = arr\n        // 移除备份\n        let list = cloneDeep(this.teamCourseTotalList)\n        delete list[id]\n        this.teamCourseTotalList = list\n      } else if (type === 'personal') {\n        let arr = cloneDeep(this.personalCourseList)\n        remove(arr, o => o.course_id === id)\n        this.personalCourseList = arr\n        // 移除备份\n        let coachList = cloneDeep(this.personalCourseTotalList)\n        delete coachList[id]\n        this.personalCourseTotalList = coachList\n      }\n    },\n    // 新增团课课程\n    addCourseTeam() {\n      let that = this\n      this.$modalRouter.push({\n        name: 'course-select-course',\n        props: {\n          platform: 'brand',\n          type: 'team',\n          useShopInfo: this.useShopInfo,\n          courses: this.teamCourseList,\n          isLimit: true\n        },\n        on: {\n          ok: data => {\n            data.list.forEach(i => {\n              i.courseChecked = false\n              i.team_times = i.team_times ? +i.team_times : 0\n              i.team_unit_price = i.team_unit_price ? +i.team_unit_price : 0\n            })\n            forEach(this.teamCourseTotalList, (value, key) => {\n              forEach(data.list, innerValue => {\n                if (+innerValue.course_id === +key) {\n                  innerValue.team_times = value.team_times\n                    ? +value.team_times\n                    : 0\n                  innerValue.team_unit_price = value.team_unit_price\n                    ? +value.team_unit_price\n                    : 0\n                }\n              })\n              // 删除teamCourseTotalList里不存在的course_id项\n              if (!data.list.some(o => +o.course_id === +key)) {\n                delete this.teamCourseTotalList[key]\n              }\n            })\n            this.teamCourseList = cloneDeep(data.list)\n          }\n        }\n      })\n    },\n    // 新增私教课\n    addCoursePersonal() {\n      let that = this\n      this.$modalRouter.push({\n        name: 'course-select-course',\n        props: {\n          platform: 'brand',\n          type: 'personal',\n          useShopInfo: this.useShopInfo,\n          courses: this.personalCourseList,\n          isLimit: true\n        },\n        on: {\n          ok(data) {\n            let coachGradeList = []\n            forEach(that.coachList, i => {\n              coachGradeList.push(i.id)\n            })\n            let total = reduce(\n              that.coachList,\n              (sum, o) => sum + o.coach_number,\n              0\n            )\n            data.list.forEach(i => {\n              i.courseChecked = false\n              i.coachGradeList = coachGradeList\n              i.personal_times = i.personal_times ? +i.personal_times : 0\n              i.personal_unit_price = i.personal_unit_price\n                ? +i.personal_unit_price\n                : 0\n            })\n            forEach(that.personalCourseTotalList, (value, key) => {\n              forEach(data.list, innerValue => {\n                if (+innerValue.course_id === +key) {\n                  innerValue.coachGradeList = cloneDeep(\n                    value.list ? value.list : coachGradeList\n                  )\n                  innerValue.personal_times = value.personal_times\n                    ? +value.personal_times\n                    : 0\n                  innerValue.personal_unit_price = value.personal_unit_price\n                    ? +value.personal_unit_price\n                    : 0\n                }\n              })\n              // 删除personalCoachTotalList里不存在的course_id项\n              if (!data.list.some(o => +o.course_id === +key)) {\n                delete that.personalCourseTotalList[key]\n              }\n            })\n            // 缓存选择的教练等级\n            that.personalCoachListHistory = []\n            data.list.forEach(i => {\n              that.personalCoachListHistory.push(i.coachGradeList)\n            })\n            that.personalCourseList = cloneDeep(data.list)\n            that.personalCourseList.forEach(item => {\n              if (item.coachGradeList && item.coachGradeList.length > 0) {\n                item.coachGradeList = item.coachGradeList.map(i => {\n                  return i.id || i\n                })\n              }\n            })\n            console.log(that.personalCourseList)\n          }\n        }\n      })\n    },\n    teamCheckboxChange(event) {\n      this.courseIsFirstInput = false\n      this.teamCourseListIsShow = +event.target.checked\n    },\n    personalCheckboxChange(e) {\n      this.courseIsFirstInput = false\n      this.personalCourseListIsShow = +e.target.checked\n    },\n    // team\n    teamCourseListShow() {\n      this.teamCourseListIsShow = !this.teamCourseListIsShow\n    },\n    // personal\n    personalCourseListShow() {\n      this.personalCourseListIsShow = !this.personalCourseListIsShow\n    },\n    // 全选\n    checkAllChange(type) {\n      if (type === 'team') {\n        this.teamCheckAll = !this.teamCheckAll\n        this.teamCourseList.forEach(i => {\n          i.courseChecked = this.teamCheckAll\n        })\n      } else if (type === 'personal') {\n        this.personalCheckAll = !this.personalCheckAll\n        this.personalCourseList.forEach(i => {\n          i.courseChecked = this.personalCheckAll\n        })\n      }\n    },\n    // 批量操作团课课程包节数\n    timesOperationOk(type) {\n      if (type === 'team') {\n        forEach(this.teamCourseList, o => {\n          if (o.courseChecked) {\n            o.team_times = +this.teamOperationObject.team_times\n            // 备份批量操作的数据\n            this.teamCourseTotalList[o.course_id] = this.teamCourseTotalList[\n              o.course_id\n            ]\n              ? this.teamCourseTotalList[o.course_id]\n              : {}\n            this.teamCourseTotalList[o.course_id].team_times = +this\n              .teamOperationObject.team_times\n          }\n        })\n      } else if (type === 'personal') {\n        forEach(this.personalCourseList, o => {\n          if (o.courseChecked) {\n            o.personal_times = +this.personalOperationObject.personal_times\n            // 备份批量操作的数据\n            let personalCourse = this.personalCourseTotalList[o.course_id]\n              ? this.personalCourseTotalList[o.course_id]\n              : {}\n            let personal_times = +this.personalOperationObject.personal_times\n            this.personalCourseTotalList[o.course_id] = {\n              ...personalCourse,\n              personal_times\n            }\n          }\n        })\n      }\n    },\n    // 批量操作团课课程包价格\n    unitPriceOperationOk(type) {\n      if (type === 'team') {\n        forEach(this.teamCourseList, o => {\n          if (o.courseChecked) {\n            o.team_unit_price = +this.teamOperationObject.team_unit_price\n            // 备份批量操作的数据\n            this.teamCourseTotalList[o.course_id] = this.teamCourseTotalList[\n              o.course_id\n            ]\n              ? this.teamCourseTotalList[o.course_id]\n              : {}\n            this.teamCourseTotalList[o.course_id].team_unit_price = +this\n              .teamOperationObject.team_unit_price\n          }\n        })\n      } else if (type === 'personal') {\n        forEach(this.personalCourseList, o => {\n          if (o.courseChecked) {\n            o.personal_unit_price = +this.personalOperationObject\n              .personal_unit_price\n            // 备份批量操作的数据\n            this.personalCourseTotalList[o.course_id] = this\n              .personalCourseTotalList[o.course_id]\n              ? this.personalCourseTotalList[o.course_id]\n              : {}\n            this.personalCourseTotalList[\n              o.course_id\n            ].personal_unit_price = +this.personalOperationObject\n              .personal_unit_price\n          }\n        })\n      }\n    },\n    coachAllOperationOk() {\n      // 批量设置\n      forEach(this.personalCourseList, value => {\n        if (value.courseChecked) {\n          value.coachGradeList = cloneDeep(this.personalAllOperationCoachList)\n          this.personalCourseTotalList[value.course_id] = this\n            .personalCourseTotalList[value.course_id]\n            ? this.personalCourseTotalList[value.course_id]\n            : {}\n          this.personalCourseTotalList[value.course_id].list = cloneDeep(\n            this.personalAllOperationCoachList\n          )\n        }\n      })\n      // 缓存选择的教练等级\n      this.personalCoachListHistory = []\n      forEach(this.personalCourseList, i => {\n        this.personalCoachListHistory.push(i.coachGradeList)\n      })\n      // 清空\n      this.personalAllOperationCoachList = []\n      // 收起\n      this.coachAllOperationDropdownIsShow = false\n    }\n  },\n  created() {\n    if (isEmpty(this.initInfo)) return ''\n    this.packageData.is_team = this.initInfo.is_team\n    this.packageData.is_personal = this.initInfo.is_personal\n    this.packageData.personal_unit_price = this.initInfo.personal_unit_price\n    this.packageData.team_unit_price = this.initInfo.team_unit_price\n    forEach(this.initInfo.team_range, o => {\n      this.teamCourseList.push({\n        courseChecked: false,\n        ...o\n      })\n      this.teamCourseTotalList[o.course_id] =\n        this.teamCourseTotalList[o.course_id] || {}\n      this.teamCourseTotalList[o.course_id].team_times = o.team_times\n      this.teamCourseTotalList[o.course_id].team_unit_price = o.team_unit_price\n    })\n    forEach(this.initInfo.personal_range, o => {\n      let coachGradeList = []\n      o.coach_level.forEach(i => {\n        coachGradeList.push(i.id)\n      })\n      let selectCoach = filter(this.coachList, i =>\n        coachGradeList.includes(i.id)\n      )\n      let total = reduce(selectCoach, (sum, i) => sum + i.coach_number, 0)\n      this.personalCourseList.push({\n        courseChecked: false,\n        ...o,\n        coachGradeList,\n        coach: total\n      })\n      this.personalCoachTotalList[o.course_id] =\n        this.personalCoachTotalList[o.course_id] || {}\n      this.personalCoachTotalList[o.course_id].list = cloneDeep(o.coach_level)\n      this.personalCoachTotalList[o.course_id].total = total\n      this.personalCoachListHistory.push(\n        cloneDeep(o.coach_level.map(item => item.id))\n      )\n    })\n  },\n  mounted() {\n    this.addFixService.getCoachList().subscribe()\n  }\n}\n",{"version":3,"sources":["add-course-fix-table.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6mBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add-course-fix-table.vue","sourceRoot":"src/views/pages/brand/product/package/component#","sourcesContent":["<template>\n  <!-- TODO: 样式不修改 -->\n  <div\n    :class=\"add('course')\"\n    class=\"page-shop-add-basic-package  page-shop-add-range-package page-brand-add-fix-package\"\n  >\n    <div>\n      <st-form-table>\n        <colgroup>\n          <col style=\"width:5%;\" />\n          <col style=\"width:10%;\" />\n          <col style=\"width:24%;\" />\n          <col style=\"width:18%;\" />\n          <col style=\"width:18%;\" />\n          <col style=\"width:25%;\" />\n        </colgroup>\n        <tr class=\"bg-thead table-header\">\n          <th></th>\n          <th class=\"rightline pd-x16\">课程类型</th>\n          <th></th>\n          <th class=\"pd-x16\">节数(节)</th>\n          <th class=\"pd-x16\">小计(元)</th>\n          <th></th>\n        </tr>\n        <tbody>\n          <tr class=\"bg-row-odd add-team checkbox border-bottom\">\n            <td class=\"tg-c\">\n              <a-checkbox\n                v-model=\"packageData.is_team\"\n                @change=\"teamCheckboxChange\"\n              />\n            </td>\n            <td class=\"rightline white-nowrap\">\n              团体课程\n            </td>\n            <td :class=\"{ 'add-team__item': !!packageData.is_team }\"></td>\n            <td>{{ teamCourseTotalObject.team_times }}</td>\n            <td>{{ teamCourseTotalObject.total }}</td>\n            <td class=\"overflow-hidden\">\n              <a\n                class=\"set-course-button\"\n                @click=\"teamCourseListShow\"\n                :disabled=\"!packageData.is_team\"\n                :class=\"{\n                  hide: !(teamCourseListIsShow && packageData.is_team)\n                }\"\n                href=\"javascript:void(0)\"\n              >\n                配置上课范围&nbsp;&nbsp;\n                <st-icon class=\"icon-12\" type=\"down-small\" />\n              </a>\n            </td>\n          </tr>\n          <tr\n            class=\"bg-row-odd team-course-list-content\"\n            v-if=\"teamCourseListIsShow && packageData.is_team\"\n          >\n            <td\n              class=\"rightline\"\n              style=\"background-color:#fff\"\n              colspan=\"2\"\n            ></td>\n            <td class=\"team-course-table\" colspan=\"4\">\n              <div :class=\"add('team-course-table')\">\n                <st-form-table>\n                  <colgroup>\n                    <col style=\"width:5%;\" />\n                    <col style=\"width:10%;\" />\n                    <col style=\"width:14%;\" />\n                    <col style=\"width:18%;\" />\n                    <col style=\"width:18%;\" />\n                    <col style=\"width:15%;\" />\n                    <col style=\"width:10%;\" />\n                  </colgroup>\n                  <tr class=\"bg-thead th\">\n                    <th></th>\n                    <th>课程名称</th>\n                    <th>上课门店</th>\n                    <th>节数</th>\n                    <th>课时费</th>\n                    <th>总价(元)</th>\n                    <th>操作</th>\n                  </tr>\n                  <tbody>\n                    <tr class=\"checkbox border-bottom\">\n                      <td colspan=\"7\" class=\"team-course-add-buton\">\n                        <st-button\n                          block\n                          type=\"dashed\"\n                          icon=\"add\"\n                          @click=\"addCourseTeam\"\n                        >\n                          新增团体课程\n                        </st-button>\n                      </td>\n                    </tr>\n                    <tr>\n                      <td colspan=\"7\">\n                        <p\n                          v-if=\"!teamCourseList.length\"\n                          class=\"bg-row-even\"\n                          style=\"margin: 0;text-align:center;\"\n                        >\n                          无数据\n                        </p>\n                        <!-- 在AForm组件里用自定义指令时，需要加上v-decorator,值不能重复 -->\n                      </td>\n                    </tr>\n                    <template\n                      class=\"package-course-content-table\"\n                      v-if=\"teamCourseList.length\"\n                      v-scrollBar=\"{ stopPropagation: true }\"\n                      v-decorator=\"['teamCourseList2']\"\n                    >\n                      <tr\n                        class=\"checkbox border-bottom\"\n                        :class=\"{\n                          'bg-row-odd': index % 2 !== 0,\n                          'bg-row-even': index % 2 === 0\n                        }\"\n                        v-for=\"(i, index) in teamCourseList\"\n                        :key=\"i.course_id\"\n                      >\n                        <td class=\"tg-c\">\n                          <a-checkbox\n                            :checked=\"i.courseChecked\"\n                            @change=\"\n                              courseItemCheckedChange($event, 'team', index)\n                            \"\n                          />\n                        </td>\n                        <td>\n                          <st-overflow-text\n                            maxWidth=\"120px\"\n                            :value=\"i.course_name\"\n                          ></st-overflow-text>\n                        </td>\n                        <td>\n                          <st-overflow-text\n                            maxWidth=\"120px\"\n                            :value=\"i.shop_name\"\n                          ></st-overflow-text>\n                        </td>\n                        <td>\n                          <st-input-number\n                            :min=\"1\"\n                            :max=\"99999\"\n                            @change=\"\n                              teamInputChange($event, 'team_times', i.course_id)\n                            \"\n                            v-model=\"i.team_times\"\n                          >\n                            <template slot=\"addonAfter\">\n                              节\n                            </template>\n                          </st-input-number>\n                          <span\n                            style=\"color: red;font-size: 12px\"\n                            v-if=\"validateTeam && !i.team_times\"\n                          >\n                            请填写节数\n                          </span>\n                        </td>\n                        <td>\n                          <st-input-number\n                            :min=\"0\"\n                            :max=\"999999.9\"\n                            @change=\"\n                              teamInputChange(\n                                $event,\n                                'team_unit_price',\n                                i.course_id\n                              )\n                            \"\n                            v-model=\"i.team_unit_price\"\n                            :float=\"true\"\n                          >\n                            <template slot=\"addonAfter\">\n                              元\n                            </template>\n                          </st-input-number>\n                          <span\n                            style=\"color: red;font-size: 12px\"\n                            v-if=\"validateTeam && !i.team_unit_price\"\n                          >\n                            请填写价格\n                          </span>\n                        </td>\n                        <td>\n                          {{\n                            i.team_times | course_item_total(i.team_unit_price)\n                          }}\n                        </td>\n                        <td>\n                          <a\n                            @click=\"removeCourseItem('team', i.course_id)\"\n                            href=\"javascript:void(0)\"\n                          >\n                            删除\n                          </a>\n                        </td>\n                      </tr>\n                    </template>\n                    <tr class=\"bg-thead checkbox topline\">\n                      <td class=\"tg-c\">\n                        <a-checkbox\n                          :indeterminate=\"teamIndeterminate\"\n                          @change=\"checkAllChange('team')\"\n                          :checked=\"teamCheckAll\"\n                        />\n                      </td>\n                      <td>批量操作</td>\n                      <td></td>\n                      <td>\n                        <st-input-number\n                          :min=\"1\"\n                          :max=\"99999\"\n                          v-model=\"teamOperationObject.team_times\"\n                        >\n                          <a\n                            :disabled=\"!+teamOperationObject.team_times\"\n                            slot=\"addonAfter\"\n                            @click=\"timesOperationOk('team')\"\n                          >\n                            确定\n                          </a>\n                        </st-input-number>\n                      </td>\n                      <td>\n                        <st-input-number\n                          :min=\"0\"\n                          :max=\"999999.9\"\n                          v-model=\"teamOperationObject.team_unit_price\"\n                          :float=\"true\"\n                        >\n                          <a\n                            :disabled=\"!+teamOperationObject.team_unit_price\"\n                            slot=\"addonAfter\"\n                            @click=\"unitPriceOperationOk('team')\"\n                          >\n                            确定\n                          </a>\n                        </st-input-number>\n                      </td>\n                      <td>\n                        {{\n                          teamOperationObject.team_times\n                            | course_item_total(\n                              teamOperationObject.team_unit_price\n                            )\n                        }}\n                      </td>\n                      <td>\n                        <a\n                          @click=\"removeCourseItems('team')\"\n                          href=\"javascript:void(0)\"\n                        >\n                          删除\n                        </a>\n                      </td>\n                    </tr>\n                  </tbody>\n                </st-form-table>\n              </div>\n            </td>\n          </tr>\n          <tr class=\"checkbox topline add-personal  border-bottom\">\n            <td class=\"tg-c\">\n              <a-checkbox\n                v-model=\"packageData.is_personal\"\n                @change=\"personalCheckboxChange\"\n              />\n            </td>\n            <td class=\"rightline\">私教课程</td>\n            <td\n              :class=\"{ 'add-personal__item': !!packageData.is_personal }\"\n            ></td>\n            <td>{{ personalCourseTotalObject.personal_times }}</td>\n            <td>{{ personalCourseTotalObject.total }}</td>\n            <td class=\"overflow-hidden\">\n              <a\n                class=\"set-course-button\"\n                @click=\"personalCourseListShow\"\n                :disabled=\"!packageData.is_personal\"\n                :class=\"{\n                  hide: !(personalCourseListIsShow && packageData.is_personal)\n                }\"\n                href=\"javascript:void(0)\"\n              >\n                配置上课范围&nbsp;&nbsp;\n                <st-icon class=\"icon-12\" type=\"down-small\" />\n              </a>\n            </td>\n          </tr>\n          <tr\n            class=\"personal-course-list-content\"\n            v-if=\"personalCourseListIsShow && packageData.is_personal\"\n          >\n            <td class=\"rightline\" colspan=\"2\"></td>\n            <td class=\"personal-course-table\" colspan=\"4\">\n              <div :class=\"add('personal-course-table')\">\n                <table>\n                  <colgroup>\n                    <col style=\"width:5%;\" />\n                    <col style=\"width:15%;\" />\n                    <col style=\"width:15%;\" />\n                    <col style=\"width:13%;\" />\n                    <col style=\"width:13%;\" />\n                    <col style=\"width:23%;\" />\n                    <col style=\"width:8%;\" />\n                    <col style=\"width:8%;\" />\n                  </colgroup>\n                  <tr class=\"bg-thead th\">\n                    <th></th>\n                    <th>课程名称</th>\n                    <th>上课门店</th>\n                    <th>节数</th>\n                    <th>课时费</th>\n                    <th class=\"tg-c\">支持预约的{{ $c('coach') }}等级</th>\n                    <th>总价(元)</th>\n                    <th>操作</th>\n                  </tr>\n                  <tbody>\n                    <tr class=\"checkbox border-bottom\">\n                      <td colspan=\"8\" class=\"personal-course-add-buton\">\n                        <st-button\n                          block\n                          type=\"dashed\"\n                          icon=\"add\"\n                          @click=\"addCoursePersonal\"\n                        >\n                          新增私教课程\n                        </st-button>\n                      </td>\n                    </tr>\n                    <tr>\n                      <td colspan=\"8\">\n                        <p\n                          v-if=\"!personalCourseList.length\"\n                          class=\"bg-row-even\"\n                          style=\"margin: 0;text-align:center;\"\n                        >\n                          无数据\n                        </p>\n                        <!-- 在AForm组件里用自定义指令时，需要加上v-decorator,值不能重复 -->\n                      </td>\n                    </tr>\n                    <template\n                      class=\"package-course-content-table\"\n                      v-if=\"personalCourseList.length\"\n                      v-scrollBar=\"{ stopPropagation: true }\"\n                      v-decorator=\"['personalCourseList1']\"\n                    >\n                      <tr\n                        class=\"checkbox border-bottom\"\n                        :class=\"{\n                          'bg-row-odd': index % 2 !== 0,\n                          'bg-row-even': index % 2 === 0\n                        }\"\n                        v-for=\"(item, index) in personalCourseList\"\n                        :key=\"item.course_id\"\n                      >\n                        <td class=\"tg-c\">\n                          <a-checkbox\n                            :checked=\"item.courseChecked\"\n                            @change=\"\n                              courseItemCheckedChange($event, 'personal', index)\n                            \"\n                          />\n                        </td>\n                        <td>\n                          <st-overflow-text\n                            max-width=\"120px\"\n                            :value=\"item.course_name\"\n                          ></st-overflow-text>\n                        </td>\n                        <td>\n                          <st-overflow-text\n                            maxWidth=\"120px\"\n                            :value=\"item.shop_name\"\n                          ></st-overflow-text>\n                        </td>\n                        <td>\n                          <st-input-number\n                            :min=\"1\"\n                            :max=\"99999\"\n                            @change=\"\n                              personalInputChange(\n                                $event,\n                                'personal_times',\n                                item.course_id\n                              )\n                            \"\n                            v-model=\"item.personal_times\"\n                          >\n                            <template slot=\"addonAfter\">\n                              节\n                            </template>\n                          </st-input-number>\n                          <span\n                            style=\"color: red;font-size: 12px\"\n                            v-if=\"validatePersonal && !item.personal_times\"\n                          >\n                            请填写节数\n                          </span>\n                        </td>\n                        <td>\n                          <st-input-number\n                            :min=\"0\"\n                            :max=\"999999.9\"\n                            @change=\"\n                              personalInputChange(\n                                $event,\n                                'personal_unit_price',\n                                item.course_id\n                              )\n                            \"\n                            v-model=\"item.personal_unit_price\"\n                            :float=\"true\"\n                          >\n                            <template slot=\"addonAfter\">\n                              元\n                            </template>\n                          </st-input-number>\n                          <span\n                            style=\"color: red;font-size: 12px\"\n                            v-if=\"validatePersonal && !item.personal_unit_price\"\n                          >\n                            请填写价格\n                          </span>\n                        </td>\n                        <td class=\"tg-c\">\n                          <a-dropdown\n                            placement=\"bottomRight\"\n                            :trigger=\"['click']\"\n                          >\n                            <a href=\"javascript:void(0)\">\n                              {{\n                                item.coachGradeList.length === coachList.length\n                                  ? '全部'\n                                  : `${item.coachGradeList.length}个`\n                              }}等级&nbsp;&nbsp;\n                              <st-icon class=\"icon-12\" type=\"down-small\" />\n                            </a>\n                            <a-checkbox-group\n                              :class=\"b(`personal-dropdown`)\"\n                              v-model=\"item.coachGradeList\"\n                              @change=\"\n                                coachItemChange($event, item.course_id, index)\n                              \"\n                              slot=\"overlay\"\n                            >\n                              <!-- 在AForm组件里用自定义指令时，需要加上v-decorator,值不能重复 -->\n                              <ul\n                                class=\"personal-course-coach-grade-dropdown brand-page-package__personal-course-coach-grade-dropdown\"\n                                v-scrollBar=\"{\n                                  stopPropagation: true\n                                }\"\n                                v-decorator=\"[\n                                  `personalCourseListCoachGrade${index}`\n                                ]\"\n                              >\n                                <li\n                                  v-for=\"(coachItem, coachIndex) in coachList\"\n                                  :key=\"coachIndex\"\n                                >\n                                  <a-checkbox :value=\"coachItem.id\">\n                                    {{ coachItem.setting_name }}\n                                  </a-checkbox>\n                                </li>\n                              </ul>\n                            </a-checkbox-group>\n                          </a-dropdown>\n                        </td>\n                        <td>\n                          {{\n                            item.personal_times\n                              | course_item_total(item.personal_unit_price)\n                          }}\n                        </td>\n                        <td>\n                          <a\n                            @click=\"\n                              removeCourseItem('personal', item.course_id)\n                            \"\n                          >\n                            删除\n                          </a>\n                        </td>\n                      </tr>\n                    </template>\n                    <tr class=\"bg-thead checkbox topline\">\n                      <td class=\"tg-c\">\n                        <a-checkbox\n                          :indeterminate=\"personalIndeterminate\"\n                          @change=\"checkAllChange('personal')\"\n                          :checked=\"personalCheckAll\"\n                        />\n                      </td>\n                      <td>批量操作</td>\n                      <td></td>\n                      <td class=\"batch-sure\">\n                        <st-input-number\n                          :min=\"1\"\n                          :max=\"99999\"\n                          v-model=\"personalOperationObject.personal_times\"\n                        >\n                          <a\n                            :disabled=\"!+personalOperationObject.personal_times\"\n                            href=\"javascript:void(0)\"\n                            slot=\"addonAfter\"\n                            @click=\"timesOperationOk('personal')\"\n                          >\n                            确定\n                          </a>\n                        </st-input-number>\n                      </td>\n                      <td class=\"batch-sure\">\n                        <st-input-number\n                          :min=\"0\"\n                          :max=\"999999.9\"\n                          v-model=\"personalOperationObject.personal_unit_price\"\n                          :float=\"true\"\n                        >\n                          <a\n                            :disabled=\"\n                              !+personalOperationObject.personal_unit_price\n                            \"\n                            href=\"javascript:void(0)\"\n                            slot=\"addonAfter\"\n                            @click=\"unitPriceOperationOk('personal')\"\n                          >\n                            确定\n                          </a>\n                        </st-input-number>\n                      </td>\n                      <td class=\"tg-c\">\n                        <a-dropdown\n                          placement=\"bottomRight\"\n                          :trigger=\"['click']\"\n                          v-model=\"coachAllOperationDropdownIsShow\"\n                        >\n                          <a href=\"javascript:void(0)\">\n                            批量设置等级&nbsp;&nbsp;\n                            <st-icon class=\"icon-12\" type=\"down-small\" />\n                          </a>\n                          <a-checkbox-group\n                            class=\"all page-shop-add-basic-package__personal-dropdown\"\n                            v-model=\"personalAllOperationCoachList\"\n                            slot=\"overlay\"\n                          >\n                            <!-- 在AForm组件里用自定义指令时，需要加上v-decorator,值不能重复 -->\n                            <ul\n                              class=\"personal-course-coach-grade-dropdown brand-page-package__personal-course-coach-grade-dropdown \"\n                              v-scrollBar=\"{ stopPropagation: true }\"\n                              v-decorator=\"['personalCourseListCoachGradeAll']\"\n                            >\n                              <li\n                                v-for=\"(coachItem, coachIndex) in coachList\"\n                                :key=\"coachIndex\"\n                              >\n                                <a-checkbox :value=\"coachItem.id\">\n                                  {{ coachItem.setting_name }}\n                                </a-checkbox>\n                              </li>\n                            </ul>\n                            <div\n                              class=\"personal-course-coach-grade-dropdown-button\"\n                            >\n                              <a\n                                :disabled=\"\n                                  !personalAllOperationCoachList.length\n                                \"\n                                @click=\"coachAllOperationOk\"\n                              >\n                                确定\n                              </a>\n                            </div>\n                          </a-checkbox-group>\n                        </a-dropdown>\n                      </td>\n                      <td>\n                        {{\n                          personalOperationObject.personal_times\n                            | course_item_total(\n                              personalOperationObject.personal_unit_price\n                            )\n                        }}\n                      </td>\n                      <td>\n                        <a\n                          @click=\"removeCourseItems('personal')\"\n                          href=\"javascript:void(0)\"\n                        >\n                          删除\n                        </a>\n                      </td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n            </td>\n          </tr>\n        </tbody>\n      </st-form-table>\n      <portal to=\"BRAND_PACKAGE_FORM_TOTAL\">\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n            <st-form-item label=\"总价\">\n              {{\n                personalCourseTotalObject.total + teamCourseTotalObject.total\n              }}元\n            </st-form-item>\n          </a-col>\n        </a-row>\n      </portal>\n    </div>\n  </div>\n</template>\n\n<script>\nimport CourseSelectCourse from '@/views/biz-modals/course/select-course'\nimport { FormService } from './form.service'\nimport { AddFixPackageService } from '../add-fix-package.service'\nimport { forEach, cloneDeep, remove, every, reduce, filter } from 'lodash'\nimport { isEmpty } from 'lodash-es'\nexport default {\n  name: 'AddCourseFixTable',\n  bem: {\n    add: 'page-shop-add-fix-package',\n    b: 'page-shop-add-basic-package'\n  },\n  serviceInject() {\n    return {\n      addFixService: AddFixPackageService\n    }\n  },\n  rxState() {\n    return {\n      coachList: this.addFixService.coachList$\n    }\n  },\n  computed: {\n    all_total() {\n      let teamTotal = this.packageData.is_team\n        ? this.teamCourseTotalObject.total\n        : 0\n      let personalTotal = this.packageData.is_personal\n        ? this.personalCourseTotalObject.total\n        : 0\n      return teamTotal + personalTotal\n    }\n  },\n  props: {\n    initInfo: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    },\n    useShopInfo: {\n      type: Object,\n      default: () => {}\n    }\n  },\n  watch: {\n    packageData: {\n      handler: function(newValue, oldValue) {\n        if (!newValue.is_team && !newValue.is_personal) {\n          this.$emit('change', {})\n          return ''\n        }\n        if (newValue.is_team && !this.teamCourseList.length) {\n          this.$emit('change', {})\n          return false\n        }\n        if (newValue.is_personal && !this.personalCourseList.length) {\n          this.$emit('change', {})\n          return false\n        }\n        this.$emit(\n          'change',\n          this.getRangeCourse({\n            team_range: this.teamCourseList,\n            ...newValue,\n            personal_range: this.personalCourseList\n          })\n        )\n      },\n      deep: true\n    },\n    teamCourseList: {\n      handler: function(newValue, oldValue) {\n        let allSelect = false\n        let allNotSelect = false\n        allSelect = every(newValue, o => o.courseChecked)\n        allNotSelect = every(newValue, o => !o.courseChecked)\n        this.teamIndeterminate = !allSelect && !allNotSelect\n        this.teamCheckAll = newValue.length ? allSelect : false\n        newValue.forEach(item => {\n          this.validateTeam = !item.team_times || !item.team_unit_price\n        })\n        // 计算团课总计\n        this.teamCourseTotalObject.team_times = reduce(\n          newValue,\n          (sum, o) => {\n            let team_times = isNaN(+o.team_times) ? 0 : +o.team_times\n            return sum + team_times\n          },\n          0\n        )\n        this.teamCourseTotalObject.total = reduce(\n          newValue,\n          (sum, o) => {\n            let team_times = isNaN(+o.team_times) ? 0 : +o.team_times\n            let team_unit_price = isNaN(+o.team_unit_price)\n              ? 0\n              : +o.team_unit_price\n            return sum + (team_times * (team_unit_price * 10)) / 10\n          },\n          0\n        )\n        if (this.validateTeam) {\n          this.$emit('change', {})\n          return\n        }\n        this.$emit(\n          'change',\n          this.getRangeCourse({\n            personal_range: this.personalCourseList,\n            ...this.packageData,\n            team_range: newValue\n          })\n        )\n      },\n      deep: true\n    },\n    personalCourseList: {\n      handler: function(newValue, oldValue) {\n        newValue.forEach(item => {\n          this.validatePersonal =\n            !item.personal_times || !item.personal_unit_price\n        })\n        let allSelect = false\n        let allNotSelect = false\n        allSelect = every(newValue, o => o.courseChecked)\n        allNotSelect = every(newValue, o => !o.courseChecked)\n        this.personalIndeterminate = !allSelect && !allNotSelect\n        this.personalCheckAll = newValue.length ? allSelect : false\n        // 计算私教课总计\n        this.personalCourseTotalObject.personal_times = reduce(\n          newValue,\n          (sum, o) => {\n            let personal_times = isNaN(+o.personal_times)\n              ? 0\n              : +o.personal_times\n            return sum + personal_times\n          },\n          0\n        )\n        this.personalCourseTotalObject.total = reduce(\n          newValue,\n          (sum, o) => {\n            let personal_times = isNaN(+o.personal_times)\n              ? 0\n              : +o.personal_times\n            let personal_unit_price = isNaN(+o.personal_unit_price)\n              ? 0\n              : +o.personal_unit_price\n            return sum + (personal_times * (personal_unit_price * 10)) / 10\n          },\n          0\n        )\n        if (this.validatePersonal) {\n          this.$emit('change', {})\n          return\n        }\n        this.$emit(\n          'change',\n          this.getRangeCourse({\n            personal_range: newValue,\n            ...this.packageData,\n            team_range: this.teamCourseList\n          })\n        )\n      },\n      deep: true\n    }\n  },\n  data() {\n    return {\n      isCourseRange: false,\n      validateTeam: false,\n      validatePersonal: false,\n      personalCoachTotalList: {},\n      personalCoachListHistory: [],\n      // 操作栏checkbox是否半选\n      teamIndeterminate: false,\n      // 操作栏checkbox是否半选\n      personalIndeterminate: false,\n      // 操作栏checkbox是全选\n      personalCheckAll: false,\n      // 配置课程表格是否显示\n      teamCourseListIsShow: false,\n      // 配置的课程总计\n      teamCourseTotalObject: {\n        team_times: 0,\n        total: 0\n      },\n      // 备份课程已做的操作\n      teamCourseTotalList: {},\n      // 批量操作的值\n      teamOperationObject: {\n        team_times: undefined,\n        team_unit_price: undefined\n      },\n      // 操作栏选择教练等级的dorpdown是否显示\n      coachAllOperationDropdownIsShow: false,\n      // 操作栏教练等级选择的值\n      personalAllOperationCoachList: [],\n      // 批量操作的值\n      personalOperationObject: {\n        personal_times: undefined,\n        personal_unit_price: undefined\n      },\n      // 配置课程表格是否显示\n      personalCourseListIsShow: false,\n      // 配置的课程总计\n      personalCourseTotalObject: {\n        personal_times: 0,\n        total: 0\n      },\n      personalCourseTotalList: [],\n      // team course\n      teamCourseList: [],\n      // personal course\n      personalCourseList: [],\n      // 课程范围是否未输入过\n      courseIsFirstInput: true,\n      // 操作栏checkbox是全选\n      teamCheckAll: false,\n      packageData: {\n        is_team: false,\n        is_personal: false\n      },\n      validateCourseRange: ''\n    }\n  },\n  modals: {\n    CourseSelectCourse\n  },\n  filters: {\n    // 单课价格统计\n    course_item_total(times, unit_price) {\n      if (+times && +unit_price) {\n        return (+times * (+unit_price * 10)) / 10\n      } else {\n        return 0\n      }\n    }\n  },\n  methods: {\n    // 移除选择的课程\n    removeCourseItems(type) {\n      if (type === 'team') {\n        let arr = cloneDeep(this.teamCourseList)\n        let removeList = remove(arr, o => o.courseChecked)\n        this.teamCourseList = arr\n        // 移除备份\n        let list = cloneDeep(this.teamCourseTotalList)\n        removeList.forEach(i => {\n          delete list[i.course_id]\n        })\n        this.teamCourseTotalList = list\n      } else if (type === 'personal') {\n        let arr = cloneDeep(this.personalCourseList)\n        let removeList = remove(arr, o => o.courseChecked)\n        this.personalCourseList = arr\n        // 移除备份\n        let coachList = cloneDeep(this.personalCourseTotalList)\n        removeList.forEach(i => {\n          delete coachList[i.course_id]\n        })\n        this.personalCourseTotalList = coachList\n      }\n    },\n    getRangeCourse(rangeCourse) {\n      const form = cloneDeep(rangeCourse)\n      if (typeof form.personal_range === 'object') {\n        form.personal_range = form.personal_range.map(item => {\n          return {\n            personal_unit_price: item.personal_unit_price,\n            personal_times: item.personal_times,\n            course_id: item.course_id,\n            coach_level: item.coachGradeList.map(item =>\n              typeof item === 'number' ? item : item.id\n            )\n          }\n        })\n      }\n      if (typeof form.team_range === 'object') {\n        form.team_range = form.team_range.map(item => {\n          return {\n            team_unit_price: item.team_unit_price,\n            team_times: item.team_times,\n            course_id: item.course_id\n          }\n        })\n      }\n      if (!rangeCourse.is_team) {\n        form.team_range = []\n      }\n      if (!rangeCourse.is_personal) {\n        form.personal_range = []\n      }\n      form.is_team = +rangeCourse.is_team\n      form.is_personal = +rangeCourse.is_personal\n      return form\n    },\n    // item coach checkboxGroup changeEvent\n    coachItemChange(e, id, index) {\n      if (!e.length) {\n        this.personalCourseList[\n          index\n        ].coachGradeList = this.personalCoachListHistory[index]\n        return\n      } else {\n        this.personalCoachListHistory[index] = cloneDeep(e)\n      }\n      this.personalCourseTotalList[id] = this.personalCourseTotalList[id]\n        ? this.personalCourseTotalList[id]\n        : {}\n      this.personalCourseTotalList[id].list = cloneDeep(e)\n    },\n    // teamItems input change\n    teamInputChange(e, type, id) {\n      this.teamCourseTotalList[id] = this.teamCourseTotalList[id]\n        ? this.teamCourseTotalList[id]\n        : {}\n      this.teamCourseTotalList[id][type] = e\n    },\n    // 选择课程\n    courseItemCheckedChange(e, type, index) {\n      if (type === 'team') {\n        this.teamCourseList[index].courseChecked = e.target.checked\n      } else if (type === 'personal') {\n        this.personalCourseList[index].courseChecked = e.target.checked\n      }\n    },\n    // personalItems input change\n    personalInputChange(e, type, id) {\n      this.personalCourseTotalList[id] = this.personalCourseTotalList[id]\n        ? this.personalCourseTotalList[id]\n        : {}\n      this.personalCourseTotalList[id][type] = e\n    },\n    // 移除课程\n    removeCourseItem(type, id) {\n      if (type === 'team') {\n        let arr = cloneDeep(this.teamCourseList)\n        remove(arr, o => o.course_id === id)\n        this.teamCourseList = arr\n        // 移除备份\n        let list = cloneDeep(this.teamCourseTotalList)\n        delete list[id]\n        this.teamCourseTotalList = list\n      } else if (type === 'personal') {\n        let arr = cloneDeep(this.personalCourseList)\n        remove(arr, o => o.course_id === id)\n        this.personalCourseList = arr\n        // 移除备份\n        let coachList = cloneDeep(this.personalCourseTotalList)\n        delete coachList[id]\n        this.personalCourseTotalList = coachList\n      }\n    },\n    // 新增团课课程\n    addCourseTeam() {\n      let that = this\n      this.$modalRouter.push({\n        name: 'course-select-course',\n        props: {\n          platform: 'brand',\n          type: 'team',\n          useShopInfo: this.useShopInfo,\n          courses: this.teamCourseList,\n          isLimit: true\n        },\n        on: {\n          ok: data => {\n            data.list.forEach(i => {\n              i.courseChecked = false\n              i.team_times = i.team_times ? +i.team_times : 0\n              i.team_unit_price = i.team_unit_price ? +i.team_unit_price : 0\n            })\n            forEach(this.teamCourseTotalList, (value, key) => {\n              forEach(data.list, innerValue => {\n                if (+innerValue.course_id === +key) {\n                  innerValue.team_times = value.team_times\n                    ? +value.team_times\n                    : 0\n                  innerValue.team_unit_price = value.team_unit_price\n                    ? +value.team_unit_price\n                    : 0\n                }\n              })\n              // 删除teamCourseTotalList里不存在的course_id项\n              if (!data.list.some(o => +o.course_id === +key)) {\n                delete this.teamCourseTotalList[key]\n              }\n            })\n            this.teamCourseList = cloneDeep(data.list)\n          }\n        }\n      })\n    },\n    // 新增私教课\n    addCoursePersonal() {\n      let that = this\n      this.$modalRouter.push({\n        name: 'course-select-course',\n        props: {\n          platform: 'brand',\n          type: 'personal',\n          useShopInfo: this.useShopInfo,\n          courses: this.personalCourseList,\n          isLimit: true\n        },\n        on: {\n          ok(data) {\n            let coachGradeList = []\n            forEach(that.coachList, i => {\n              coachGradeList.push(i.id)\n            })\n            let total = reduce(\n              that.coachList,\n              (sum, o) => sum + o.coach_number,\n              0\n            )\n            data.list.forEach(i => {\n              i.courseChecked = false\n              i.coachGradeList = coachGradeList\n              i.personal_times = i.personal_times ? +i.personal_times : 0\n              i.personal_unit_price = i.personal_unit_price\n                ? +i.personal_unit_price\n                : 0\n            })\n            forEach(that.personalCourseTotalList, (value, key) => {\n              forEach(data.list, innerValue => {\n                if (+innerValue.course_id === +key) {\n                  innerValue.coachGradeList = cloneDeep(\n                    value.list ? value.list : coachGradeList\n                  )\n                  innerValue.personal_times = value.personal_times\n                    ? +value.personal_times\n                    : 0\n                  innerValue.personal_unit_price = value.personal_unit_price\n                    ? +value.personal_unit_price\n                    : 0\n                }\n              })\n              // 删除personalCoachTotalList里不存在的course_id项\n              if (!data.list.some(o => +o.course_id === +key)) {\n                delete that.personalCourseTotalList[key]\n              }\n            })\n            // 缓存选择的教练等级\n            that.personalCoachListHistory = []\n            data.list.forEach(i => {\n              that.personalCoachListHistory.push(i.coachGradeList)\n            })\n            that.personalCourseList = cloneDeep(data.list)\n            that.personalCourseList.forEach(item => {\n              if (item.coachGradeList && item.coachGradeList.length > 0) {\n                item.coachGradeList = item.coachGradeList.map(i => {\n                  return i.id || i\n                })\n              }\n            })\n            console.log(that.personalCourseList)\n          }\n        }\n      })\n    },\n    teamCheckboxChange(event) {\n      this.courseIsFirstInput = false\n      this.teamCourseListIsShow = +event.target.checked\n    },\n    personalCheckboxChange(e) {\n      this.courseIsFirstInput = false\n      this.personalCourseListIsShow = +e.target.checked\n    },\n    // team\n    teamCourseListShow() {\n      this.teamCourseListIsShow = !this.teamCourseListIsShow\n    },\n    // personal\n    personalCourseListShow() {\n      this.personalCourseListIsShow = !this.personalCourseListIsShow\n    },\n    // 全选\n    checkAllChange(type) {\n      if (type === 'team') {\n        this.teamCheckAll = !this.teamCheckAll\n        this.teamCourseList.forEach(i => {\n          i.courseChecked = this.teamCheckAll\n        })\n      } else if (type === 'personal') {\n        this.personalCheckAll = !this.personalCheckAll\n        this.personalCourseList.forEach(i => {\n          i.courseChecked = this.personalCheckAll\n        })\n      }\n    },\n    // 批量操作团课课程包节数\n    timesOperationOk(type) {\n      if (type === 'team') {\n        forEach(this.teamCourseList, o => {\n          if (o.courseChecked) {\n            o.team_times = +this.teamOperationObject.team_times\n            // 备份批量操作的数据\n            this.teamCourseTotalList[o.course_id] = this.teamCourseTotalList[\n              o.course_id\n            ]\n              ? this.teamCourseTotalList[o.course_id]\n              : {}\n            this.teamCourseTotalList[o.course_id].team_times = +this\n              .teamOperationObject.team_times\n          }\n        })\n      } else if (type === 'personal') {\n        forEach(this.personalCourseList, o => {\n          if (o.courseChecked) {\n            o.personal_times = +this.personalOperationObject.personal_times\n            // 备份批量操作的数据\n            let personalCourse = this.personalCourseTotalList[o.course_id]\n              ? this.personalCourseTotalList[o.course_id]\n              : {}\n            let personal_times = +this.personalOperationObject.personal_times\n            this.personalCourseTotalList[o.course_id] = {\n              ...personalCourse,\n              personal_times\n            }\n          }\n        })\n      }\n    },\n    // 批量操作团课课程包价格\n    unitPriceOperationOk(type) {\n      if (type === 'team') {\n        forEach(this.teamCourseList, o => {\n          if (o.courseChecked) {\n            o.team_unit_price = +this.teamOperationObject.team_unit_price\n            // 备份批量操作的数据\n            this.teamCourseTotalList[o.course_id] = this.teamCourseTotalList[\n              o.course_id\n            ]\n              ? this.teamCourseTotalList[o.course_id]\n              : {}\n            this.teamCourseTotalList[o.course_id].team_unit_price = +this\n              .teamOperationObject.team_unit_price\n          }\n        })\n      } else if (type === 'personal') {\n        forEach(this.personalCourseList, o => {\n          if (o.courseChecked) {\n            o.personal_unit_price = +this.personalOperationObject\n              .personal_unit_price\n            // 备份批量操作的数据\n            this.personalCourseTotalList[o.course_id] = this\n              .personalCourseTotalList[o.course_id]\n              ? this.personalCourseTotalList[o.course_id]\n              : {}\n            this.personalCourseTotalList[\n              o.course_id\n            ].personal_unit_price = +this.personalOperationObject\n              .personal_unit_price\n          }\n        })\n      }\n    },\n    coachAllOperationOk() {\n      // 批量设置\n      forEach(this.personalCourseList, value => {\n        if (value.courseChecked) {\n          value.coachGradeList = cloneDeep(this.personalAllOperationCoachList)\n          this.personalCourseTotalList[value.course_id] = this\n            .personalCourseTotalList[value.course_id]\n            ? this.personalCourseTotalList[value.course_id]\n            : {}\n          this.personalCourseTotalList[value.course_id].list = cloneDeep(\n            this.personalAllOperationCoachList\n          )\n        }\n      })\n      // 缓存选择的教练等级\n      this.personalCoachListHistory = []\n      forEach(this.personalCourseList, i => {\n        this.personalCoachListHistory.push(i.coachGradeList)\n      })\n      // 清空\n      this.personalAllOperationCoachList = []\n      // 收起\n      this.coachAllOperationDropdownIsShow = false\n    }\n  },\n  created() {\n    if (isEmpty(this.initInfo)) return ''\n    this.packageData.is_team = this.initInfo.is_team\n    this.packageData.is_personal = this.initInfo.is_personal\n    this.packageData.personal_unit_price = this.initInfo.personal_unit_price\n    this.packageData.team_unit_price = this.initInfo.team_unit_price\n    forEach(this.initInfo.team_range, o => {\n      this.teamCourseList.push({\n        courseChecked: false,\n        ...o\n      })\n      this.teamCourseTotalList[o.course_id] =\n        this.teamCourseTotalList[o.course_id] || {}\n      this.teamCourseTotalList[o.course_id].team_times = o.team_times\n      this.teamCourseTotalList[o.course_id].team_unit_price = o.team_unit_price\n    })\n    forEach(this.initInfo.personal_range, o => {\n      let coachGradeList = []\n      o.coach_level.forEach(i => {\n        coachGradeList.push(i.id)\n      })\n      let selectCoach = filter(this.coachList, i =>\n        coachGradeList.includes(i.id)\n      )\n      let total = reduce(selectCoach, (sum, i) => sum + i.coach_number, 0)\n      this.personalCourseList.push({\n        courseChecked: false,\n        ...o,\n        coachGradeList,\n        coach: total\n      })\n      this.personalCoachTotalList[o.course_id] =\n        this.personalCoachTotalList[o.course_id] || {}\n      this.personalCoachTotalList[o.course_id].list = cloneDeep(o.coach_level)\n      this.personalCoachTotalList[o.course_id].total = total\n      this.personalCoachListHistory.push(\n        cloneDeep(o.coach_level.map(item => item.id))\n      )\n    })\n  },\n  mounted() {\n    this.addFixService.getCoachList().subscribe()\n  }\n}\n</script>\n"]}]}