{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/components#/event.component.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/components#/event.component.vue","mtime":1597396799952},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue'\nimport { H5WrapperService } from '@/views/pages/brand/setting/mina/components#/h5/h5-wrapper.service'\nimport { cloneDeep } from 'lodash-es'\nimport { ActivityService } from '../activity.service'\nimport { Tree } from '@/utils/tree'\nexport default {\n  bem: {\n    event: 'activity-event-component'\n  },\n  components: {\n    StImageUpload\n  },\n  serviceInject() {\n    return {\n      h5WrapperService: H5WrapperService,\n      activityService: ActivityService\n    }\n  },\n  rxState() {\n    return {\n      eventInfo: this.h5WrapperService.eventInfo$,\n      activityList: this.activityService.actList$\n    }\n  },\n  data() {\n    return {\n      info: {},\n      list: {\n        1: [],\n        2: [],\n        3: [],\n        4: []\n      },\n      actList: [],\n      selected: [],\n      filelist: [],\n      link: '',\n      number: 0,\n      span: 24\n    }\n  },\n  created() {\n    this.initList()\n  },\n  mounted() {\n    let actList = cloneDeep(this.activityList.list)\n    if (this.eventInfo && this.eventInfo.length) {\n      let number = this.eventInfo.length\n      this.number = number\n      this.list[number] = cloneDeep(this.eventInfo)\n      this.list[number].forEach(item => {\n        item.activity_id = [item.activity_type, item.activity_id]\n        const tree = new Tree(actList, { name: 'activity_name' })\n        if (this.number && !tree.findNodeById(item.activity_id[1])) {\n          // 找到对应的父节点\n          const node =\n            actList.filter(act => act.id === item.activity_type)[0] || {}\n          console.log(node, 'event====node')\n          if (item.activity_type === 5 && node.children) {\n            node.children.push({\n              activity_name: item.activity_name,\n              activity_type: item.activity_type,\n              id: item.activity_id[1],\n              isover: true,\n              product_type: item.product_type,\n              product_template_id: item.product_template_id\n            })\n          } else if (node.children) {\n            node.children.push({\n              activity_name: item.activity_name,\n              activity_type: item.activity_type,\n              id: item.activity_id[1],\n              isover: true\n            })\n          }\n        }\n      })\n    } else {\n      this.number = 0\n      actList = cloneDeep(this.activityList.list)\n    }\n    actList.forEach(item => {\n      if (!item.children.length) {\n        item.disabled = true\n      }\n    })\n    this.actList = cloneDeep(actList)\n    console.log(this.actList, actList, 'eventList')\n  },\n  watch: {\n    list: {\n      deep: true,\n      handler(newVal) {\n        let number = this.number\n        this.h5WrapperService.SET_H5INFO(newVal[number], 3)\n      }\n    },\n    number(newValue) {\n      this.h5WrapperService.SET_H5INFO(this.list[newValue], 3)\n    }\n  },\n  methods: {\n    initList() {\n      let list = {\n        1: [],\n        2: [],\n        3: [],\n        4: []\n      }\n      list[1].push({\n        image_url: '',\n        title: '',\n        link: '',\n        span: 24\n      })\n      for (let i = 0; i < 2; i++) {\n        list[2].push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 12\n        })\n      }\n      for (let i = 0; i < 3; i++) {\n        if (i === 2) {\n          list[3].push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 24\n          })\n        } else {\n          list[3].push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 12\n          })\n        }\n      }\n      for (let i = 0; i < 4; i++) {\n        list[4].push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 12\n        })\n      }\n      this.list = list\n    },\n    onActChange(item, value) {\n      console.log('vlaue', value)\n      item.activity_type = value[1][1].activity_type\n      item.activity_name = value[1][1].activity_name\n      if (value[1][0].id === 5) {\n        item.product_type = value[1][1].product_type\n        item.product_template_id = value[1][1].product_template_id\n      }\n      // const selecttedParent = this.actList.filter(ite => ite.id === value[0])[0]\n      // const selected = selecttedParent.children.filter(\n      //   it => it.id === value[1]\n      // )[0]\n      // item.activity_type = selected.activity_type\n      // item.activity_name = selected.activity_name\n      // if (selected.activity_type === 5) {\n      //   item.product_type = selected.product_type\n      //   item.product_template_id = selected.product_template_id\n      // }\n    },\n    imageUploadChange(e, index) {\n      if (e.length) {\n        let number = this.number\n        this.list[number][index].image_url = e[0].image_url\n        this.list[number][index].image_key = e[0].image_key\n      }\n    },\n    numberChange(e) {\n      let num = e.target.value\n      let list = []\n      if (num === 1) {\n        list.push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 24\n        })\n      } else if (num === 2 || num === 4) {\n        for (let i = 0; i < num; i++) {\n          list.push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 12\n          })\n        }\n      } else if (num === 3) {\n        for (let i = 0; i < num; i++) {\n          if (i === 2) {\n            list.push({\n              image_url: '',\n              title: '',\n              link: '',\n              span: 24\n            })\n          } else {\n            list.push({\n              image_url: '',\n              title: '',\n              link: '',\n              span: 12\n            })\n          }\n        }\n      }\n      this.list = list\n    },\n    calImgSize(li) {\n      const w = li.span === 24 ? 670 : 327\n      const h = 120\n      return {\n        w,\n        h\n      }\n    },\n    generateFilteroptions(li) {\n      return this.calImgSize(li)\n    },\n    generateCropperOptions(li) {\n      const { w, h } = this.calImgSize(li)\n      return {\n        title: '活动图片裁剪',\n        cropper: { aspectRatio: w / h }\n      }\n    }\n  }\n}\n",{"version":3,"sources":["event.component.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"event.component.vue","sourceRoot":"src/views/pages/brand/marketing/components#","sourcesContent":["<template>\n  <div :class=\"event()\">\n    <st-form labelWidth=\"71px\">\n      <st-form-item label=\"推广活动数\" :class=\"event('activity-wrapper')\">\n        <a-radio-group v-model=\"number\">\n          <a-radio :value=\"1\">1</a-radio>\n          <a-radio :value=\"2\">2</a-radio>\n          <a-radio :value=\"3\">3</a-radio>\n          <a-radio :value=\"4\">4</a-radio>\n        </a-radio-group>\n      </st-form-item>\n      <st-form-item label=\"活动展示\" :class=\"event('activity-show-title')\">\n        <div\n          v-for=\"(li, index) in list[number]\"\n          :key=\"index\"\n          :class=\"['col-' + li.span, { 'clear-float': index === 2 }]\"\n        >\n          <div :class=\"event('box')\">\n            <st-image-upload\n              @change=\"imageUploadChange($event, index)\"\n              width=\"100%\"\n              height=\"85px\"\n              :filterOptions=\"generateFilteroptions(li)\"\n              :list=\"li.image_url ? [li] : li.filelist\"\n              :sizeLimit=\"5\"\n              placeholder=\"新增活动图片\"\n              :numLimit=\"1\"\n              :cropperModal=\"generateCropperOptions(li)\"\n            >\n              <a-icon\n                type=\"plus-circle\"\n                theme=\"filled\"\n                :style=\"{\n                  fontSize: '24px',\n                  verticalAlign: 'super',\n                  marginRight: '8px',\n                  color: '#9BACB9'\n                }\"\n              />\n              <div :class=\"event('uploadtip-wrap')\">\n                <div class=\"st-image-upload__placeholder\">新增活动图片</div>\n                <span :class=\"event('uploadtip')\">\n                  {{\n                    li.span === 24\n                      ? '大小不超过5M，建议尺寸670*120'\n                      : '建议尺寸327*120'\n                  }}\n                </span>\n              </div>\n            </st-image-upload>\n            <div class=\"st-form-item-wrapper\">\n              <st-form-item labelWidth=\"46px\" label=\"标题\">\n                <a-input\n                  placeholder=\"选填\"\n                  v-model=\"li.module_name\"\n                  maxlength=\"20\"\n                ></a-input>\n              </st-form-item>\n              <st-form-item labelWidth=\"46px\" label=\"链接\">\n                <a-cascader\n                  :options=\"actList\"\n                  :allowClear=\"false\"\n                  v-model=\"li.activity_id\"\n                  placeholder=\"请输入链接的活动\"\n                  :fieldNames=\"{\n                    label: 'activity_name',\n                    value: 'id',\n                    children: 'children'\n                  }\"\n                  @change=\"onActChange(li, arguments)\"\n                />\n              </st-form-item>\n            </div>\n          </div>\n        </div>\n      </st-form-item>\n    </st-form>\n  </div>\n</template>\n<script>\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue'\nimport { H5WrapperService } from '@/views/pages/brand/setting/mina/components#/h5/h5-wrapper.service'\nimport { cloneDeep } from 'lodash-es'\nimport { ActivityService } from '../activity.service'\nimport { Tree } from '@/utils/tree'\nexport default {\n  bem: {\n    event: 'activity-event-component'\n  },\n  components: {\n    StImageUpload\n  },\n  serviceInject() {\n    return {\n      h5WrapperService: H5WrapperService,\n      activityService: ActivityService\n    }\n  },\n  rxState() {\n    return {\n      eventInfo: this.h5WrapperService.eventInfo$,\n      activityList: this.activityService.actList$\n    }\n  },\n  data() {\n    return {\n      info: {},\n      list: {\n        1: [],\n        2: [],\n        3: [],\n        4: []\n      },\n      actList: [],\n      selected: [],\n      filelist: [],\n      link: '',\n      number: 0,\n      span: 24\n    }\n  },\n  created() {\n    this.initList()\n  },\n  mounted() {\n    let actList = cloneDeep(this.activityList.list)\n    if (this.eventInfo && this.eventInfo.length) {\n      let number = this.eventInfo.length\n      this.number = number\n      this.list[number] = cloneDeep(this.eventInfo)\n      this.list[number].forEach(item => {\n        item.activity_id = [item.activity_type, item.activity_id]\n        const tree = new Tree(actList, { name: 'activity_name' })\n        if (this.number && !tree.findNodeById(item.activity_id[1])) {\n          // 找到对应的父节点\n          const node =\n            actList.filter(act => act.id === item.activity_type)[0] || {}\n          console.log(node, 'event====node')\n          if (item.activity_type === 5 && node.children) {\n            node.children.push({\n              activity_name: item.activity_name,\n              activity_type: item.activity_type,\n              id: item.activity_id[1],\n              isover: true,\n              product_type: item.product_type,\n              product_template_id: item.product_template_id\n            })\n          } else if (node.children) {\n            node.children.push({\n              activity_name: item.activity_name,\n              activity_type: item.activity_type,\n              id: item.activity_id[1],\n              isover: true\n            })\n          }\n        }\n      })\n    } else {\n      this.number = 0\n      actList = cloneDeep(this.activityList.list)\n    }\n    actList.forEach(item => {\n      if (!item.children.length) {\n        item.disabled = true\n      }\n    })\n    this.actList = cloneDeep(actList)\n    console.log(this.actList, actList, 'eventList')\n  },\n  watch: {\n    list: {\n      deep: true,\n      handler(newVal) {\n        let number = this.number\n        this.h5WrapperService.SET_H5INFO(newVal[number], 3)\n      }\n    },\n    number(newValue) {\n      this.h5WrapperService.SET_H5INFO(this.list[newValue], 3)\n    }\n  },\n  methods: {\n    initList() {\n      let list = {\n        1: [],\n        2: [],\n        3: [],\n        4: []\n      }\n      list[1].push({\n        image_url: '',\n        title: '',\n        link: '',\n        span: 24\n      })\n      for (let i = 0; i < 2; i++) {\n        list[2].push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 12\n        })\n      }\n      for (let i = 0; i < 3; i++) {\n        if (i === 2) {\n          list[3].push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 24\n          })\n        } else {\n          list[3].push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 12\n          })\n        }\n      }\n      for (let i = 0; i < 4; i++) {\n        list[4].push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 12\n        })\n      }\n      this.list = list\n    },\n    onActChange(item, value) {\n      console.log('vlaue', value)\n      item.activity_type = value[1][1].activity_type\n      item.activity_name = value[1][1].activity_name\n      if (value[1][0].id === 5) {\n        item.product_type = value[1][1].product_type\n        item.product_template_id = value[1][1].product_template_id\n      }\n      // const selecttedParent = this.actList.filter(ite => ite.id === value[0])[0]\n      // const selected = selecttedParent.children.filter(\n      //   it => it.id === value[1]\n      // )[0]\n      // item.activity_type = selected.activity_type\n      // item.activity_name = selected.activity_name\n      // if (selected.activity_type === 5) {\n      //   item.product_type = selected.product_type\n      //   item.product_template_id = selected.product_template_id\n      // }\n    },\n    imageUploadChange(e, index) {\n      if (e.length) {\n        let number = this.number\n        this.list[number][index].image_url = e[0].image_url\n        this.list[number][index].image_key = e[0].image_key\n      }\n    },\n    numberChange(e) {\n      let num = e.target.value\n      let list = []\n      if (num === 1) {\n        list.push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 24\n        })\n      } else if (num === 2 || num === 4) {\n        for (let i = 0; i < num; i++) {\n          list.push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 12\n          })\n        }\n      } else if (num === 3) {\n        for (let i = 0; i < num; i++) {\n          if (i === 2) {\n            list.push({\n              image_url: '',\n              title: '',\n              link: '',\n              span: 24\n            })\n          } else {\n            list.push({\n              image_url: '',\n              title: '',\n              link: '',\n              span: 12\n            })\n          }\n        }\n      }\n      this.list = list\n    },\n    calImgSize(li) {\n      const w = li.span === 24 ? 670 : 327\n      const h = 120\n      return {\n        w,\n        h\n      }\n    },\n    generateFilteroptions(li) {\n      return this.calImgSize(li)\n    },\n    generateCropperOptions(li) {\n      const { w, h } = this.calImgSize(li)\n      return {\n        title: '活动图片裁剪',\n        cropper: { aspectRatio: w / h }\n      }\n    }\n  }\n}\n</script>\n"]}]}