{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/app/auto-renewal-edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/app/auto-renewal-edit.vue","mtime":1600926556082},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport tableMixin from '@/mixins/table.mixin';\nimport { ruleOptions, columns } from \"./auto-renewal-edit.config\";\nimport { AutoRenewalEditService } from \"./auto-renewal-edit.service\";\nimport { get, cloneDeep } from 'lodash-es';\nimport SelectScroll from '@/views/components/select-scroll#/select-scroll';\nexport default {\n  name: '',\n  bem: {\n    b: 'wexin-stage-product-edit'\n  },\n  mixins: [tableMixin],\n  serviceInject: function serviceInject() {\n    return {\n      editService: AutoRenewalEditService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      auth: this.editService.auth$,\n      loading: this.editService.loading$,\n      product: this.editService.product$,\n      specs: this.editService.specs$,\n      list: this.editService.list$,\n      page: this.editService.page$\n    };\n  },\n  components: {\n    SelectScroll: SelectScroll\n  },\n  props: {},\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      options: [],\n      editSpecs: []\n    };\n  },\n  computed: {\n    columns: columns,\n    isEdit: function isEdit() {\n      return !!this.$searchQuery.id;\n    },\n    rowSelection: function rowSelection() {\n      1;\n      var self = this;\n      var selectedRowKeys = this.selectedRowKeys,\n          onSelectionChange = this.onSelectionChange;\n      return {\n        onChange: onSelectionChange,\n        selectedRowKeys: selectedRowKeys\n      };\n    }\n  },\n  watch: {\n    specs: {\n      handler: function handler(value) {\n        this.editSpecs = cloneDeep(value);\n        this.selectedRowKeys = value.filter(function (spec) {\n          return spec.is_select;\n        }).map(function (spec) {\n          return spec.template_id;\n        });\n      },\n      immediate: true,\n      deep: true\n    }\n  },\n  async: {},\n  mounted: function mounted() {\n    var _this = this;\n\n    if (this.$searchQuery.id) {\n      this.editService.getProductDetail({\n        id: this.$searchQuery.id\n      }).subscribe(function (res) {\n        _this.editService.setList([{\n          card_id: res.card_id,\n          card_name: res.card_name\n        }]);\n\n        _this.form.setFieldsValue({\n          card_id: res.card_id,\n          remark: res.remark\n        });\n      });\n    } else {\n      this.editService.getCardList().subscribe();\n    }\n  },\n  methods: {\n    handleGetList: function handleGetList() {\n      if (this.finished) return false;\n      this.editService.getCardList({\n        current_page: ++this.page.current_page\n      }).subscribe();\n    },\n    judgeIfCanEdit: function judgeIfCanEdit(id) {\n      return !this.selectedRowKeys.includes(id);\n    },\n    productUp: function productUp() {\n      var _this2 = this;\n\n      this.form.validate().then(function (values) {\n        var specs = _this2.editSpecs.map(function (spec) {\n          spec.is_select = _this2.selectedRowKeys.includes(spec.template_id);\n          return spec;\n        });\n\n        var params = {\n          specs: specs,\n          remark: values.remark\n        };\n        console.log('params', params);\n\n        if (_this2.isEdit) {\n          params.id = _this2.$searchQuery.id;\n\n          _this2.editService.productEdit(params).subscribe(function (res) {\n            _this2.$message.success({\n              content: '商品上架成功'\n            });\n\n            _this2.$router.replace({\n              name: 'brand-app-auto-renewal'\n            });\n          });\n        } else {\n          params.card_id = values.card_id;\n\n          _this2.editService.productAdd(params).subscribe(function (res) {\n            _this2.$message.success({\n              content: '商品上架成功'\n            });\n\n            _this2.$router.replace({\n              name: 'brand-app-auto-renewal'\n            });\n          });\n        }\n      });\n    },\n    handleAmountChange: function handleAmountChange(value, id) {\n      console.log(value);\n      this.editSpecs = this.editSpecs.map(function (spec) {\n        if (spec.template_id === id) {\n          spec.amount = value;\n        }\n\n        return spec;\n      });\n    },\n    handleFirstAmountChange: function handleFirstAmountChange(value, id) {\n      console.log('id', id);\n      this.editSpecs = this.editSpecs.map(function (spec) {\n        if (spec.template_id === id) {\n          spec.first_amount = value;\n        }\n\n        return spec;\n      });\n    },\n    handleSelectProduct: function handleSelectProduct(id) {\n      this.form.setFieldsValue({\n        card_id: id\n      });\n      this.editService.getProductDetail({\n        id: this.$searchQuery.id || 0\n      }).subscribe();\n    }\n  }\n};",{"version":3,"sources":["auto-renewal-edit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div :class=\"b()\">\n    <st-panel-layout :class=\"b('container')\">\n      <st-form :form=\"form\" labelWidth=\"88px\" labelGutter=\"16px\">\n        <a-row>\n          <a-col :lg=\"13\">\n            <st-form-item label=\"选择会员卡\" required>\n              <div :class=\"b('select-wrapper')\">\n                <select-scroll\n                  v-decorator=\"decorators.card_id\"\n                  _key=\"card_id\"\n                  _name=\"card_name\"\n                  placeholder=\"请选择会员卡\"\n                  notFoundContent=\"无搜索结果\"\n                  :list=\"list\"\n                  :disabled=\"isEdit\"\n                  :loading=\"loading.getCardList\"\n                  :showSearch=\"false\"\n                  @load=\"handleGetList\"\n                  @select=\"handleSelectProduct\"\n                ></select-scroll>\n                <div>\n                  仅支持会员期限卡\n                </div>\n              </div>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <st-form-item label=\"分期规格\" required>\n          <a-row>\n            <a-col :lg=\"13\">\n              <st-table\n                :page=\"false\"\n                @change=\"onTableChange\"\n                :rowSelection=\"rowSelection\"\n                :columns=\"columns\"\n                :dataSource=\"editSpecs\"\n                rowKey=\"template_id\"\n              >\n                <template slot=\"name\" slot-scope=\"text, record\">\n                  {{ record.name }}（扣费周期{{ record.days }}天）\n                </template>\n                <!-- <template slot=\"first_amount\" slot-scope=\"text, record\">\n                  <st-input-number\n                    style=\"margin: -5px 0\"\n                    :value=\"text\"\n                    float\n                    :disabled=\"judgeIfCanEdit(record.template_id)\"\n                    @change=\"\n                      value =>\n                        handleFirstAmountChange(value, record.template_id)\n                    \"\n                  />\n                </template>\n                <template slot=\"amount\" slot-scope=\"text, record\">\n                  <st-input-number\n                    style=\"margin: -5px 0\"\n                    :value=\"text\"\n                    float\n                    :disabled=\"judgeIfCanEdit(record.template_id)\"\n                    @change=\"\n                      value => handleAmountChange(value, record.template_id)\n                    \"\n                  />\n                </template> -->\n              </st-table>\n            </a-col>\n          </a-row>\n        </st-form-item>\n        <st-form-item label=\"备注\">\n          <a-row>\n            <a-col :lg=\"13\">\n              <st-textarea\n                v-decorator=\"decorators.remark\"\n                :autosize=\"{ minRows: 4, maxRows: 6 }\"\n                :maxlength=\"200\"\n                placeholder=\"请填写备注，限制200字以内\"\n              />\n            </a-col>\n          </a-row>\n        </st-form-item>\n        <st-form-item label-fix>\n          <a-row>\n            <a-col :lg=\"13\">\n              <a-popconfirm @confirm=\"productUp\" placement=\"topRight\">\n                <template slot=\"title\">\n                  <p>确认是否上架</p>\n                </template>\n                <st-button type=\"primary\">\n                  上架\n                </st-button>\n              </a-popconfirm>\n            </a-col>\n          </a-row>\n        </st-form-item>\n      </st-form>\n    </st-panel-layout>\n  </div>\n</template>\n\n<script>\nimport tableMixin from '@/mixins/table.mixin'\nimport { ruleOptions, columns } from './auto-renewal-edit.config'\nimport { AutoRenewalEditService } from './auto-renewal-edit.service'\nimport { get, cloneDeep } from 'lodash-es'\n\nimport SelectScroll from '@/views/components/select-scroll#/select-scroll'\nexport default {\n  name: '',\n\n  bem: {\n    b: 'wexin-stage-product-edit'\n  },\n\n  mixins: [tableMixin],\n\n  serviceInject() {\n    return {\n      editService: AutoRenewalEditService\n    }\n  },\n\n  rxState() {\n    return {\n      auth: this.editService.auth$,\n      loading: this.editService.loading$,\n      product: this.editService.product$,\n      specs: this.editService.specs$,\n      list: this.editService.list$,\n      page: this.editService.page$\n    }\n  },\n\n  components: { SelectScroll },\n\n  props: {},\n\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      options: [],\n      editSpecs: []\n    }\n  },\n\n  computed: {\n    columns,\n    isEdit() {\n      return !!this.$searchQuery.id\n    },\n    rowSelection() {\n      1\n      let self = this\n      const { selectedRowKeys, onSelectionChange } = this\n      return {\n        onChange: onSelectionChange,\n        selectedRowKeys: selectedRowKeys\n      }\n    }\n  },\n\n  watch: {\n    specs: {\n      handler(value) {\n        this.editSpecs = cloneDeep(value)\n        this.selectedRowKeys = value\n          .filter(spec => spec.is_select)\n          .map(spec => spec.template_id)\n      },\n      immediate: true,\n      deep: true\n    }\n  },\n\n  async: {},\n\n  mounted() {\n    if (this.$searchQuery.id) {\n      this.editService\n        .getProductDetail({\n          id: this.$searchQuery.id\n        })\n        .subscribe(res => {\n          this.editService.setList([\n            {\n              card_id: res.card_id,\n              card_name: res.card_name\n            }\n          ])\n          this.form.setFieldsValue({\n            card_id: res.card_id,\n            remark: res.remark\n          })\n        })\n    } else {\n      this.editService.getCardList().subscribe()\n    }\n  },\n\n  methods: {\n    handleGetList() {\n      if (this.finished) return false\n      this.editService\n        .getCardList({\n          current_page: ++this.page.current_page\n        })\n        .subscribe()\n    },\n    judgeIfCanEdit(id) {\n      return !this.selectedRowKeys.includes(id)\n    },\n    productUp() {\n      this.form.validate().then(values => {\n        let specs = this.editSpecs.map(spec => {\n          spec.is_select = this.selectedRowKeys.includes(spec.template_id)\n          return spec\n        })\n        let params = {\n          specs,\n          remark: values.remark\n        }\n        console.log('params', params)\n        if (this.isEdit) {\n          params.id = this.$searchQuery.id\n          this.editService.productEdit(params).subscribe(res => {\n            this.$message.success({\n              content: '商品上架成功'\n            })\n            this.$router.replace({\n              name: 'brand-app-auto-renewal'\n            })\n          })\n        } else {\n          params.card_id = values.card_id\n          this.editService.productAdd(params).subscribe(res => {\n            this.$message.success({\n              content: '商品上架成功'\n            })\n            this.$router.replace({\n              name: 'brand-app-auto-renewal'\n            })\n          })\n        }\n      })\n    },\n    handleAmountChange(value, id) {\n      console.log(value)\n      this.editSpecs = this.editSpecs.map(spec => {\n        if (spec.template_id === id) {\n          spec.amount = value\n        }\n        return spec\n      })\n    },\n    handleFirstAmountChange(value, id) {\n      console.log('id', id)\n      this.editSpecs = this.editSpecs.map(spec => {\n        if (spec.template_id === id) {\n          spec.first_amount = value\n        }\n        return spec\n      })\n    },\n    handleSelectProduct(id) {\n      this.form.setFieldsValue({\n        card_id: id\n      })\n      this.editService\n        .getProductDetail({\n          id: this.$searchQuery.id || 0\n        })\n        .subscribe()\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped></style>\n"],"sourceRoot":"src/views/pages/brand/app"}]}