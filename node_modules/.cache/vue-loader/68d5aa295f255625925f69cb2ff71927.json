{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/course/select-course.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/course/select-course.vue","mtime":1597396799932},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { MessageService } from '@/services/message.service'\nimport { SelectCourseService } from './select-course.service'\nimport { cloneDeep, filter, remove } from 'lodash-es'\nimport { FIX_PACKAGE_LIMIT } from '@/constants/course/package'\nimport infiniteScroll from 'vue-infinite-scroll'\nexport default {\n  name: 'SelectCourse',\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      selectCourseService: SelectCourseService\n    }\n  },\n  rxState() {\n    return {\n      addLoading: this.selectCourseService.loading$\n    }\n  },\n  bem: {\n    course: 'st-select-course'\n  },\n  directives: { infiniteScroll },\n  props: {\n    type: {\n      type: String,\n      default() {\n        return 'team'\n      }\n    },\n    platform: {\n      type: String,\n      default() {\n        return ''\n      }\n    },\n    useShopInfo: {\n      type: Object,\n      default: () => {}\n    },\n    courses: {\n      type: Array,\n      default() {\n        return []\n      }\n    },\n    /**\n     * 是否限定选择课程数量，可传入限制数量（比如固定课程包限定选择10种）,0代表不限制\n     */\n    isLimit: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      FIX_PACKAGE_LIMIT,\n      show: false,\n      courseTypeList: [],\n      /**\n       * 最多选择团课数量\n       */\n      titleList: {\n        team: '选择团课',\n        personal: '选择私教课'\n      },\n      searchData: {\n        course_type: null,\n        search: ''\n      },\n      TABEL_LOAD_TIME: 200,\n      TABEL_LOAD_SIZE: 20,\n      courseList: [],\n      total: 0,\n      busy: true,\n      i: 10,\n      selectCourseList: [],\n      loadCourseList: []\n    }\n  },\n  computed: {\n    /**\n     * 新增按钮是否可用\n     */\n    isAddDisabled() {\n      return (\n        !!this.isLimit &&\n        (!this.courseList.length ||\n          this.selectCourseList.length >= this.FIX_PACKAGE_LIMIT)\n      )\n    }\n  },\n  methods: {\n    // loadMore(baseSize) {\n    //   console.log(this.i)\n    //   this.busy = false\n    //   this.i += baseSize\n    //   let start = this.i\n    //   let end = this.TABEL_LOAD_SIZE + this.i\n    //   if (baseSize < 0) {\n    //     start = this.i + baseSize\n    //     end = this.i\n    //   }\n    //   console.log(end)\n    //   let timer = setTimeout(() => {\n    //     this.busy = true\n    //     this.loadCourseList = this.$set(this, 'loadCourseList', [\n    //       ...this.courseList.slice(start, end)\n    //     ])\n    //     document.querySelector(\n    //       '.st-select-course__scroll-content'\n    //     ).scrollTop = 2\n    //     if (this.i > this.total) {\n    //       clearTimeout(timer)\n    //     }\n    //   }, this.TABEL_LOAD_TIME)\n    // },\n    onCourseTypeChange(data) {\n      this.searchData.search = ''\n      this.searchData.course_type = data\n      this.getCourseList()\n    },\n    onAdd(id) {\n      if (this.isAddDisabled) {\n        return\n      }\n      let arr = filter(this.courseList, o => o.course_id === id)\n      this.selectCourseList.push(...arr)\n      this.filterCourse()\n    },\n    onAllAdd() {\n      if (!this.validate()) {\n        return\n      }\n      this.selectCourseList.push(...cloneDeep(this.courseList))\n      this.courseList = []\n    },\n    /**\n     * 判断新增课程数量是否超出上限\n     */\n    validate() {\n      if (\n        this.isLimit &&\n        this.selectCourseList.length + this.courseList.length >\n          FIX_PACKAGE_LIMIT\n      ) {\n        this.messageService.error({\n          content: `最多新增${this.FIX_PACKAGE_LIMIT}种课程，新增失败`\n        })\n        return false\n      }\n      return true\n    },\n    onRemove(id) {\n      let arr = cloneDeep(this.selectCourseList)\n      remove(arr, o => o.course_id === id)\n      this.selectCourseList = arr\n      this.getCourseList()\n    },\n    onOk() {\n      this.$emit('ok', { list: cloneDeep(this.selectCourseList) })\n      this.show = false\n    },\n    // 根据已选课程，过滤可选课程\n    filterCourse() {\n      let arr = cloneDeep(this.courseList)\n      this.selectCourseList.forEach(i => {\n        remove(arr, o => o.course_id === i.course_id)\n      })\n      this.courseList = arr\n    },\n    getCourseType() {\n      this.selectCourseService.getCourseTypeList().subscribe(res => {\n        this.courseTypeList = cloneDeep(res.list)\n        this.searchData.course_type = res.list[0].id\n        this.getCourseList()\n      })\n    },\n    // handleScroll() {\n    //   let height = document.querySelector('.st-select-course__scroll-content')\n    //     .clientHeight\n    //   let liHeight = document.querySelector(\n    //     '.st-select-course__scroll-content .table-item'\n    //   ).clientHeight\n    //   let scrollTop = document.querySelector(\n    //     '.st-select-course__scroll-content'\n    //   ).scrollTop\n    //   //滚动条到底部的条件\n    //   if (scrollTop === liHeight * this.TABEL_LOAD_SIZE - height) {\n    //     console.log(\n    //       '1-' +\n    //         '距顶部' +\n    //         scrollTop +\n    //         '可视区高度' +\n    //         height +\n    //         'li总高度' +\n    //         liHeight * this.TABEL_LOAD_SIZE\n    //     )\n    //     this.loadMore(10)\n    //   } else {\n    //     console.log('0-' + '距顶部' + scrollTop + '可视区高度' + height)\n    //   }\n    //   if (scrollTop === 0 && this.i >= 20) {\n    //     this.loadMore(-10)\n    //   }\n    // },\n    getCourseList() {\n      let form = {\n        platform: this.platform,\n        type: this.type,\n        search: this.searchData.search,\n        course_type: this.searchData.course_type\n      }\n      if (this.platform === 'brand') {\n        form = { ...form, ...this.useShopInfo }\n      }\n      this.selectCourseService.getCourseList(form).subscribe(res => {\n        // TODO: 上线一定优化\n        this.total = res.list.length\n        this.courseList = cloneDeep(res.list)\n        // this.loadCourseList = this.$set(this, 'loadCourseList', [\n        //   this.courseList.slice(0, this.i)\n        // ])\n        this.filterCourse()\n      })\n    }\n  },\n  created() {\n    this.getCourseType()\n    this.selectCourseList.push(...this.courses)\n  }\n}\n",{"version":3,"sources":["select-course.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"select-course.vue","sourceRoot":"src/views/biz-modals/course","sourcesContent":["<template>\n  <st-modal :title=\"titleList[type]\" @ok=\"onOk\" v-model=\"show\">\n    <div :class=\"course()\">\n      <div :class=\"course('search')\">\n        <a-select\n          :class=\"course('search-select')\"\n          :getPopupContainer=\"trigger => trigger.parentNode\"\n          v-model=\"searchData.course_type\"\n          @change=\"onCourseTypeChange\"\n        >\n          <a-select-option\n            v-for=\"(item, index) in courseTypeList\"\n            :key=\"index\"\n            :value=\"item.id\"\n          >\n            {{ item.setting_name }}\n          </a-select-option>\n        </a-select>\n        <st-input-search\n          @search=\"getCourseList\"\n          v-model=\"searchData.search\"\n          :class=\"course('search-input')\"\n          placeholder=\"请输入课程名称进行查询\"\n        />\n      </div>\n      <div :class=\"course('all-table')\">\n        <st-form-table>\n          <colgroup v-if=\"platform === 'brand'\">\n            <col style=\"width:20%;\" />\n            <col style=\"width:20%;\" />\n            <col style=\"width:20%;\" />\n            <col style=\"width:20%;\" />\n            <col style=\"width:20%;\" />\n          </colgroup>\n          <colgroup v-if=\"platform === 'shop'\">\n            <col style=\"width:25%;\" />\n            <col style=\"width:25%;\" />\n            <col style=\"width:25%;\" />\n            <col style=\"width:25%;\" />\n          </colgroup>\n          <tr class=\"bg-thead\">\n            <th class=\"pl-9\">课程类别</th>\n            <th v-if=\"platform === 'brand'\">上课门店</th>\n            <th>课程类型</th>\n            <th>课程名称</th>\n            <th class=\"tg-c\" style=\"text-align:center\">操作</th>\n          </tr>\n          <tbody>\n            <tr>\n              <td colspan=\"5\">\n                <ul\n                  :class=\"course('scroll-content')\"\n                  v-scrollBar=\"{ stopPropagation: true }\"\n                >\n                  <li\n                    class=\"table-item \"\n                    v-for=\"(item, index) in courseList\"\n                    :class=\"{\n                      'table-item-brand': platform === 'brand',\n                      'bg-row-odd': index % 2 === 0,\n                      'bg-row-even': index % 2 !== 0\n                    }\"\n                    :key=\"item.course_id\"\n                  >\n                    <div class=\"pl-9\">{{ item.course_category }}</div>\n                    <div v-if=\"platform === 'brand'\">\n                      <st-overflow-text\n                        maxWidth=\"120px\"\n                        :value=\"item.shop_name\"\n                      ></st-overflow-text>\n                    </div>\n                    <div>{{ item.course_type }}</div>\n                    <div>\n                      <st-overflow-text\n                        max-width=\"180px\"\n                        :value=\"item.course_name\"\n                      ></st-overflow-text>\n                    </div>\n                    <div style=\"text-align: center\">\n                      <a\n                        :disabled=\"isAddDisabled\"\n                        :class=\"{ 'color-text-light': isAddDisabled }\"\n                        @click=\"onAdd(item.course_id)\"\n                      >\n                        新增\n                      </a>\n                    </div>\n                  </li>\n                </ul>\n              </td>\n            </tr>\n          </tbody>\n        </st-form-table>\n      </div>\n      <p :class=\"course('count')\">\n        <span>共查到{{ total }}条记录</span>\n        <a\n          :disabled=\"isAddDisabled\"\n          :class=\"{ 'color-text-light': isAddDisabled }\"\n          @click=\"onAllAdd\"\n        >\n          全部新增\n        </a>\n      </p>\n      <p :class=\"course('selet-course-title')\">\n        已选定{{ selectCourseList.length }}种课程\n        <span v-if=\"isLimit\" class=\"st-des\">\n          （最多选择{{ this.FIX_PACKAGE_LIMIT }}种课程）\n        </span>\n      </p>\n      <div :class=\"course('select-table')\">\n        <st-form-table>\n          <colgroup v-if=\"platform === 'brand'\">\n            <col style=\"width:20%;\" />\n            <col style=\"width:20%;\" />\n            <col style=\"width:20%;\" />\n            <col style=\"width:20%;\" />\n            <col style=\"width:20%;\" />\n          </colgroup>\n          <colgroup v-if=\"platform === 'shop'\">\n            <col style=\"width:25%;\" />\n            <col style=\"width:25%;\" />\n            <col style=\"width:25%;\" />\n            <col style=\"width:25%;\" />\n          </colgroup>\n          <tr class=\"bg-thead\">\n            <th class=\"pl-9\">课程类别</th>\n            <th v-if=\"platform === 'brand'\">上课门店</th>\n            <th>课程类型</th>\n            <th>课程名称</th>\n            <th class=\"tg-c\" style=\"text-align:center\">操作</th>\n          </tr>\n          <tbody>\n            <tr>\n              <td colspan=\"5\">\n                <ul\n                  :class=\"course('scroll-content')\"\n                  v-scrollBar=\"{ stopPropagation: true }\"\n                >\n                  <li\n                    class=\"table-item\"\n                    v-for=\"(item, index) in selectCourseList\"\n                    :class=\"{\n                      'table-item-brand': platform === 'brand',\n                      'bg-row-odd': index % 2 === 0,\n                      'bg-row-even': index % 2 !== 0\n                    }\"\n                    :key=\"item.course_id\"\n                  >\n                    <div class=\"pl-9\">{{ item.course_category }}</div>\n                    <div v-if=\"platform === 'brand'\">\n                      <st-overflow-text\n                        maxWidth=\"120px\"\n                        :value=\"item.shop_name\"\n                      ></st-overflow-text>\n                    </div>\n                    <div>{{ item.course_type }}</div>\n                    <div>\n                      <st-overflow-text\n                        slot\n                        max-width=\"180px\"\n                        :value=\"item.course_name\"\n                      ></st-overflow-text>\n                    </div>\n                    <div style=\"text-align:center\">\n                      <a @click=\"onRemove(item.course_id)\">删除</a>\n                    </div>\n                  </li>\n                </ul>\n              </td>\n            </tr>\n          </tbody>\n        </st-form-table>\n      </div>\n    </div>\n  </st-modal>\n</template>\n<script>\nimport { MessageService } from '@/services/message.service'\nimport { SelectCourseService } from './select-course.service'\nimport { cloneDeep, filter, remove } from 'lodash-es'\nimport { FIX_PACKAGE_LIMIT } from '@/constants/course/package'\nimport infiniteScroll from 'vue-infinite-scroll'\nexport default {\n  name: 'SelectCourse',\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      selectCourseService: SelectCourseService\n    }\n  },\n  rxState() {\n    return {\n      addLoading: this.selectCourseService.loading$\n    }\n  },\n  bem: {\n    course: 'st-select-course'\n  },\n  directives: { infiniteScroll },\n  props: {\n    type: {\n      type: String,\n      default() {\n        return 'team'\n      }\n    },\n    platform: {\n      type: String,\n      default() {\n        return ''\n      }\n    },\n    useShopInfo: {\n      type: Object,\n      default: () => {}\n    },\n    courses: {\n      type: Array,\n      default() {\n        return []\n      }\n    },\n    /**\n     * 是否限定选择课程数量，可传入限制数量（比如固定课程包限定选择10种）,0代表不限制\n     */\n    isLimit: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      FIX_PACKAGE_LIMIT,\n      show: false,\n      courseTypeList: [],\n      /**\n       * 最多选择团课数量\n       */\n      titleList: {\n        team: '选择团课',\n        personal: '选择私教课'\n      },\n      searchData: {\n        course_type: null,\n        search: ''\n      },\n      TABEL_LOAD_TIME: 200,\n      TABEL_LOAD_SIZE: 20,\n      courseList: [],\n      total: 0,\n      busy: true,\n      i: 10,\n      selectCourseList: [],\n      loadCourseList: []\n    }\n  },\n  computed: {\n    /**\n     * 新增按钮是否可用\n     */\n    isAddDisabled() {\n      return (\n        !!this.isLimit &&\n        (!this.courseList.length ||\n          this.selectCourseList.length >= this.FIX_PACKAGE_LIMIT)\n      )\n    }\n  },\n  methods: {\n    // loadMore(baseSize) {\n    //   console.log(this.i)\n    //   this.busy = false\n    //   this.i += baseSize\n    //   let start = this.i\n    //   let end = this.TABEL_LOAD_SIZE + this.i\n    //   if (baseSize < 0) {\n    //     start = this.i + baseSize\n    //     end = this.i\n    //   }\n    //   console.log(end)\n    //   let timer = setTimeout(() => {\n    //     this.busy = true\n    //     this.loadCourseList = this.$set(this, 'loadCourseList', [\n    //       ...this.courseList.slice(start, end)\n    //     ])\n    //     document.querySelector(\n    //       '.st-select-course__scroll-content'\n    //     ).scrollTop = 2\n    //     if (this.i > this.total) {\n    //       clearTimeout(timer)\n    //     }\n    //   }, this.TABEL_LOAD_TIME)\n    // },\n    onCourseTypeChange(data) {\n      this.searchData.search = ''\n      this.searchData.course_type = data\n      this.getCourseList()\n    },\n    onAdd(id) {\n      if (this.isAddDisabled) {\n        return\n      }\n      let arr = filter(this.courseList, o => o.course_id === id)\n      this.selectCourseList.push(...arr)\n      this.filterCourse()\n    },\n    onAllAdd() {\n      if (!this.validate()) {\n        return\n      }\n      this.selectCourseList.push(...cloneDeep(this.courseList))\n      this.courseList = []\n    },\n    /**\n     * 判断新增课程数量是否超出上限\n     */\n    validate() {\n      if (\n        this.isLimit &&\n        this.selectCourseList.length + this.courseList.length >\n          FIX_PACKAGE_LIMIT\n      ) {\n        this.messageService.error({\n          content: `最多新增${this.FIX_PACKAGE_LIMIT}种课程，新增失败`\n        })\n        return false\n      }\n      return true\n    },\n    onRemove(id) {\n      let arr = cloneDeep(this.selectCourseList)\n      remove(arr, o => o.course_id === id)\n      this.selectCourseList = arr\n      this.getCourseList()\n    },\n    onOk() {\n      this.$emit('ok', { list: cloneDeep(this.selectCourseList) })\n      this.show = false\n    },\n    // 根据已选课程，过滤可选课程\n    filterCourse() {\n      let arr = cloneDeep(this.courseList)\n      this.selectCourseList.forEach(i => {\n        remove(arr, o => o.course_id === i.course_id)\n      })\n      this.courseList = arr\n    },\n    getCourseType() {\n      this.selectCourseService.getCourseTypeList().subscribe(res => {\n        this.courseTypeList = cloneDeep(res.list)\n        this.searchData.course_type = res.list[0].id\n        this.getCourseList()\n      })\n    },\n    // handleScroll() {\n    //   let height = document.querySelector('.st-select-course__scroll-content')\n    //     .clientHeight\n    //   let liHeight = document.querySelector(\n    //     '.st-select-course__scroll-content .table-item'\n    //   ).clientHeight\n    //   let scrollTop = document.querySelector(\n    //     '.st-select-course__scroll-content'\n    //   ).scrollTop\n    //   //滚动条到底部的条件\n    //   if (scrollTop === liHeight * this.TABEL_LOAD_SIZE - height) {\n    //     console.log(\n    //       '1-' +\n    //         '距顶部' +\n    //         scrollTop +\n    //         '可视区高度' +\n    //         height +\n    //         'li总高度' +\n    //         liHeight * this.TABEL_LOAD_SIZE\n    //     )\n    //     this.loadMore(10)\n    //   } else {\n    //     console.log('0-' + '距顶部' + scrollTop + '可视区高度' + height)\n    //   }\n    //   if (scrollTop === 0 && this.i >= 20) {\n    //     this.loadMore(-10)\n    //   }\n    // },\n    getCourseList() {\n      let form = {\n        platform: this.platform,\n        type: this.type,\n        search: this.searchData.search,\n        course_type: this.searchData.course_type\n      }\n      if (this.platform === 'brand') {\n        form = { ...form, ...this.useShopInfo }\n      }\n      this.selectCourseService.getCourseList(form).subscribe(res => {\n        // TODO: 上线一定优化\n        this.total = res.list.length\n        this.courseList = cloneDeep(res.list)\n        // this.loadCourseList = this.$set(this, 'loadCourseList', [\n        //   this.courseList.slice(0, this.i)\n        // ])\n        this.filterCourse()\n      })\n    }\n  },\n  created() {\n    this.getCourseType()\n    this.selectCourseList.push(...this.courses)\n  }\n}\n</script>\n"]}]}