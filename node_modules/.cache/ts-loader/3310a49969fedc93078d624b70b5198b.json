{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/services/udesk.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/services/udesk.service.ts","mtime":1591147717089},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import \"core-js/modules/es6.string.link\";\nimport _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { State } from 'rx-state';\nimport { Injectable } from 'vue-service-app';\nimport { HttpService } from \"./http.service\";\nimport { tap } from 'rxjs/operators';\nimport { AppConfig } from '@/constants/config';\n/**\n * udesk 接入信息\n */\n\nvar UdeskService = /*#__PURE__*/function () {\n  function UdeskService(http, appConfig) {\n    _classCallCheck(this, UdeskService);\n\n    this.http = http;\n    this.appConfig = appConfig;\n    this.customer$ = new State({});\n    this.isShowUdeskBtn$ = new State(true);\n    this.loading$ = new State(false);\n    this.isCreated = false;\n  }\n\n  _createClass(UdeskService, [{\n    key: \"fetchUdeskCustomerInfo\",\n    value: function fetchUdeskCustomerInfo() {\n      var _this = this;\n\n      return this.http.get('/udesk').pipe(tap(function (res) {\n        _this.customer$.commit(function () {\n          return res;\n        });\n      }));\n    }\n  }, {\n    key: \"create\",\n    value: function create() {\n      var config = this.appConfig.UDESK_CONFIG;\n      var customer = this.customer$.snapshot();\n      customer.c_name = customer.user_name + '_' + customer.brand_name;\n      customer.c_cf_品牌名称 = customer.brand_name;\n\n      (function (a, h, c, b, f, g) {\n        a['UdeskApiObject'] = f;\n\n        a[f] = a[f] || function () {\n          ;\n          (a[f].d = a[f].d || []).push(arguments);\n        };\n\n        g = h.createElement(c);\n        g.async = 1;\n        g.charset = 'utf-8';\n        g.src = b;\n        c = h.getElementsByTagName(c)[0];\n        c.parentNode.insertBefore(g, c);\n      })(window, document, 'script', \"\".concat(config.config_link), 'ud');\n\n      return new Promise(function (resolve, reject) {\n        // @ts-ignore\n        ud({\n          code: \"\".concat(config.code),\n          link: \"\".concat(config.link),\n          customer: customer,\n          onReady: function onReady() {\n            setTimeout(function () {\n              resolve();\n            }, 300);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"setIsShowUdeskBtn\",\n    value: function setIsShowUdeskBtn(val) {\n      this.isShowUdeskBtn$.commit(function () {\n        return val;\n      });\n    }\n  }, {\n    key: \"setLoading\",\n    value: function setLoading(val) {\n      this.loading$.commit(function () {\n        return val;\n      });\n    }\n    /**\n     * 打开 udesk 对话面板\n     * 如果 udesk 实例尚未创建，先创建再打开\n     * @return {promise}\n     */\n\n  }, {\n    key: \"show\",\n    value: function show() {\n      var _this2 = this;\n\n      if (this.loading$.snapshot()) {\n        return;\n      }\n\n      return new Promise(function (resolve) {\n        if (!_this2.isCreated) {\n          _this2.setLoading(true);\n          /**\n           * 获取udesk 校验参数\n           */\n\n\n          _this2.fetchUdeskCustomerInfo().subscribe(function () {\n            /**\n             * 实例化 udesk\n             */\n            _this2.create().then(function () {\n              _this2.isCreated = true;\n\n              _this2.setLoading(false); // @ts-ignore\n\n\n              ud('showPanel');\n              resolve();\n            });\n          });\n        } else {\n          // @ts-ignore\n          ud('showPanel');\n          resolve();\n        }\n      });\n    }\n    /**\n     * 隐藏 udesk 面板\n     */\n\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      // @ts-ignore\n      ud('hidePanel');\n    }\n  }]);\n\n  return UdeskService;\n}();\n\nUdeskService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof HttpService !== \"undefined\" && HttpService) === \"function\" ? _a : Object, typeof (_b = typeof AppConfig !== \"undefined\" && AppConfig) === \"function\" ? _b : Object])], UdeskService);\nexport { UdeskService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/services/udesk.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { State } from 'rx-state'\nimport { Injectable } from 'vue-service-app'\nimport { HttpService } from './http.service'\nimport { tap } from 'rxjs/operators'\nimport { AppConfig } from '@/constants/config'\n\n/**\n * udesk 接入信息\n */\n@Injectable()\nexport class UdeskService {\n  customer$ = new State<any>({})\n  isShowUdeskBtn$ = new State(true)\n  loading$ = new State(false)\n  isCreated = false\n  constructor(private http: HttpService, private appConfig: AppConfig) {}\n  fetchUdeskCustomerInfo() {\n    return this.http.get('/udesk').pipe(\n      tap((res: any) => {\n        this.customer$.commit(() => res)\n      })\n    )\n  }\n  create() {\n    const config: any = this.appConfig.UDESK_CONFIG\n    const customer = this.customer$.snapshot()\n    customer.c_name = customer.user_name + '_' + customer.brand_name\n    customer.c_cf_品牌名称 = customer.brand_name\n    // @ts-ignore\n    ;(function(a: any, h, c: any, b, f, g: any) {\n      a['UdeskApiObject'] = f\n      a[f] =\n        a[f] ||\n        function() {\n          ;(a[f].d = a[f].d || []).push(arguments)\n        }\n      g = h.createElement(c)\n      g.async = 1\n      g.charset = 'utf-8'\n      g.src = b\n      c = h.getElementsByTagName(c)[0]\n      c.parentNode.insertBefore(g, c)\n    })(window, document, 'script', `${config.config_link}`, 'ud')\n    return new Promise((resolve, reject) => {\n      // @ts-ignore\n      ud({\n        code: `${config.code}`,\n        link: `${config.link}`,\n        customer,\n        onReady: () => {\n          setTimeout(() => {\n            resolve()\n          }, 300)\n        }\n      })\n    })\n  }\n  setIsShowUdeskBtn(val: boolean) {\n    this.isShowUdeskBtn$.commit(() => val)\n  }\n  setLoading(val: boolean) {\n    this.loading$.commit(() => val)\n  }\n  /**\n   * 打开 udesk 对话面板\n   * 如果 udesk 实例尚未创建，先创建再打开\n   * @return {promise}\n   */\n  show() {\n    if (this.loading$.snapshot()) {\n      return\n    }\n    return new Promise(resolve => {\n      if (!this.isCreated) {\n        this.setLoading(true)\n        /**\n         * 获取udesk 校验参数\n         */\n        this.fetchUdeskCustomerInfo().subscribe(() => {\n          /**\n           * 实例化 udesk\n           */\n          this.create().then(() => {\n            this.isCreated = true\n            this.setLoading(false)\n            // @ts-ignore\n            ud('showPanel')\n            resolve()\n          })\n        })\n      } else {\n        // @ts-ignore\n        ud('showPanel')\n        resolve()\n      }\n    })\n  }\n  /**\n   * 隐藏 udesk 面板\n   */\n  hide() {\n    // @ts-ignore\n    ud('hidePanel')\n  }\n}\n"],"sourceRoot":""}]}