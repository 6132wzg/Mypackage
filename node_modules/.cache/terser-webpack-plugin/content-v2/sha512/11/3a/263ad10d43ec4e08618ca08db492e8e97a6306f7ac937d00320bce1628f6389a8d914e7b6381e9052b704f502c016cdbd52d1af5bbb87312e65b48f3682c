{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"tier-7~shop-finance-gathering~shop-reception~shop-sold-card-info-member~shop-sold-card-list~shop-sol~f241a4a4\"],{3577:function(e,t,i){\"use strict\";var n,r,s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i(\"st-container\",[i(\"st-form-table\",{class:e.b()},[i(\"colgroup\",[i(\"col\",{staticStyle:{width:\"40%\"}}),i(\"col\",{staticStyle:{width:\"40%\"}}),i(\"col\",{staticStyle:{width:\"20%\"}})]),i(\"thead\",[i(\"tr\",[i(\"th\",[e._v(\"成员姓名\")]),i(\"th\",[e._v(\"手机号\")]),i(\"th\",[e._v(\"操作\")])])]),i(\"tbody\",[i(\"tr\",[i(\"td\",{class:e.b(\"search-wrapper\"),attrs:{colspan:\"3\"}},[i(\"a-popover\",{attrs:{trigger:\"click\",placement:\"bottom\",arrowPointAtCenter:!0,overlayClassName:\"change-member-popover\"},model:{value:e.visible,callback:function(t){e.visible=t},expression:\"visible\"}},[i(\"div\",{ref:\"searchSection\",class:e.b(\"search-section\"),attrs:{slot:\"content\",id:\"search-section\"},slot:\"content\"},[i(\"a-input-search\",{staticClass:\"test-input\",style:{width:e.searchWidth},attrs:{placeholder:\"请输入手机号码或者会员姓名\"},on:{change:e.onMemberSearch},model:{value:e.memberSearchText,callback:function(t){e.memberSearchText=t},expression:\"memberSearchText\"}}),i(\"ul\",{class:e.b(\"search-list\")},[e._l(e.memberList,(function(t,n){return i(\"li\",{key:n,class:e.b(\"search-text\"),attrs:{value:t.id},on:{click:function(i){return i.stopPropagation(),e.onMemberChange(t)}}},[i(\"span\",{domProps:{innerHTML:e._s((\"\"+e.selectItemLabel(t)).replace(new RegExp(e.memberSearchText,\"g\"),\"<span class='global-highlight-color'>\"+e.memberSearchText+\"</span>\"))}},[e._v(\"\\n                    \"+e._s(e.selectItemLabel(t))+\"\\n                  \")])])})),2!==e.type?i(\"li\",{class:[e.b(\"search-text\"),e.b(\"search-tip\")]},[e._v(\"\\n                  查无此会员，\\n                  \"),i(\"a\",{on:{click:e.onAddMember}},[e._v(\"新增新会员？\")])]):e._e()],2)],1),i(\"st-button\",{ref:\"addMemberCardButton\",attrs:{disabled:e.list.length>=e.max,type:\"dashed\",icon:\"add\",block:\"\"}},[e._v(\"\\n              \"+e._s(e.addText)+\"\\n            \")])],1)],1)]),e._l(e.list,(function(t,n){return i(\"tr\",{key:n},[i(\"td\",[t.isEdit?[i(\"a-input\",{attrs:{placeholder:\"输入姓名\"},model:{value:t.name,callback:function(i){e.$set(t,\"name\",i)},expression:\"item.name\"}},[\"package\"===e.productType?i(\"a-select\",{staticStyle:{width:\"100px\"},attrs:{slot:\"addonAfter\",\"default-value\":\"1\",options:e.minorsTypeOptions$},on:{change:function(i){return e.onChangeMinors(i,t)}},slot:\"addonAfter\",model:{value:t.is_minors,callback:function(i){e.$set(t,\"is_minors\",i)},expression:\"item.is_minors\"}}):e._e()],1)]:[e._v(\"\\n            \"+e._s(t.name)+\"\\n            \"),t.is_minors?i(\"st-icon\",{attrs:{type:\"user-type\",color:\"#3F66F6\"}}):e._e()]],2),i(\"td\",[t.isEdit?[i(\"a-input\",{attrs:{placeholder:\"输入手机号\"},model:{value:t.mobile,callback:function(i){e.$set(t,\"mobile\",i)},expression:\"item.mobile\"}},[\"package\"===e.productType&&t.is_minors?i(\"a-select\",{staticStyle:{width:\"80px\"},attrs:{slot:\"addonAfter\",\"default-value\":1,options:e.parentTypeOptions$},slot:\"addonAfter\",model:{value:t.parent_user_role,callback:function(i){e.$set(t,\"parent_user_role\",i)},expression:\"item.parent_user_role\"}}):e._e()],1)]:t.is_minors?[e._v(\"\\n            \"+e._s(t.parent_mobile)+\"(\"+e._s(e.parentUserRoleStr(t.parent_user_role))+\")\\n          \")]:[e._v(\"\\n            \"+e._s(t.mobile)+\"\\n          \")]],2),i(\"td\",[t.isEdit?i(\"a\",{staticClass:\"mg-r8\",on:{click:function(i){return e.onConfirmItem(t,n)}}},[e._v(\"\\n            确认\\n          \")]):e._e(),t.isEdit?i(\"a\",{on:{click:function(i){return e.onCancelItem(t,n)}}},[e._v(\"取消\")]):e._e(),t.isEdit?e._e():i(\"a\",{on:{click:function(i){return e.onDeleteItem(t,n)}}},[e._v(\"删除\")])])])})),e.list.length<=0?i(\"tr\",[i(\"td\",{attrs:{colspan:\"3\"}},[i(\"st-no-data\")],1)]):e._e()],2)])],1)},a=[],o=(i(\"7f7f\"),i(\"ac6a\"),i(\"c5f6\"),i(\"d225\")),c=i(\"b0b4\"),l=i(\"9ab4\"),m=i(\"2138\"),p=i(\"0cd5\"),u=i(\"df29\"),d=i(\"75ca\"),h=i(\"c4cc\"),b=i(\"1a2d\"),f=i(\"d792\"),_=i(\"f59d\"),v=i(\"1b92\"),g=function(){function e(t,i){var n=this;Object(o[\"a\"])(this,e),this.transactionApi=t,this.userService=i,this.memberList$=new u[\"d\"]({}),this.minorsTypeOptions$=this.userService.getOptions$(\"small_course.minors_type\"),this.parentTypeOptions$=this.userService.getOptions$(\"small_course.parent_type\"),this.memberListAction$=new u[\"a\"]((function(e){return e.pipe(n.debounceMap(),Object(h[\"a\"])((function(e){n.memberList$.commit((function(){return e.list}))})))}))}return Object(c[\"a\"])(e,[{key:\"debounceMap\",value:function(){var e=this;return function(t){return t.pipe(Object(b[\"a\"])(200),Object(f[\"a\"])((function(t,i){return e.getMember(t,i).pipe(Object(_[\"a\"])((function(){return v[\"a\"]})))})))}}},{key:\"getMember\",value:function(e,t){return this.transactionApi.getMemberList(e,t)}}]),e}();Object(l[\"b\"])([Object(u[\"c\"])(),Object(l[\"d\"])(\"design:type\",Function),Object(l[\"d\"])(\"design:paramtypes\",[String,Number]),Object(l[\"d\"])(\"design:returntype\",void 0)],g.prototype,\"getMember\",null),g=Object(l[\"b\"])([Object(p[\"b\"])(),Object(l[\"d\"])(\"design:paramtypes\",[\"function\"===typeof(n=\"undefined\"!==typeof d[\"c\"]&&d[\"c\"])?n:Object,\"function\"===typeof(r=\"undefined\"!==typeof m[\"a\"]&&m[\"a\"])?r:Object])],g);var y=i(\"e69b\"),S=i(\"2527\"),x={name:\"AddCardMember\",bem:{b:\"page-add-card-member\"},serviceProviders:function(){return[g]},serviceInject:function(){return{addCardMemberService:g,messageService:y[\"a\"],patternService:S[\"a\"]}},rxState:function(){var e=this.addCardMemberService,t=e.parentTypeOptions$,i=e.minorsTypeOptions$;return{memberList:this.addCardMemberService.memberList$,parentTypeOptions$:t,minorsTypeOptions$:i}},model:{prop:\"list\",event:\"change\"},props:{addText:{type:String,default:\"新增卡成员\"},type:{type:Number,default:1},productType:{type:String},max:{type:Number,default:10},list:{type:Array,default:function(){return[]}}},data:function(){return{visible:!1,memberSearchText:\"\",searchMemberIsShow:!0,memberId:\"\",searchFlag:!1,searchWidth:\"\"}},mounted:function(){this.$nextTick((function(){this.searchWidth=this.$refs.addMemberCardButton.$el.offsetWidth-32+\"px\"}))},methods:{parentUserRoleStr:function(e){var t=e;return\"number\"===typeof e&&this.parentTypeOptions$.forEach((function(i){i.value===e&&(t=i.label)})),t},selectItemLabel:function(e){return 1===e.is_minors?\"\".concat(e.member_name,\"(未成年) \").concat(e.parent_mobile,\"(\").concat(e.parent_user_role,\")\"):\"\".concat(e.member_name,\" \").concat(e.mobile)},onConfirmItem:function(e,t){if(e.name)if(e.mobile&&this.patternService.MOBILE.test(e.mobile)){var i=this.list.filter((function(t){return t.mobile===e.mobile&&!t.isEdit}));e.is_minors&&(e.parent_mobile=e.mobile),!e.is_minors&&i&&i.length>0?this.messageService.error({content:\"该手机号已经存在\"}):(e.isEdit=!1,this.$emit(\"change\",this.list))}else this.messageService.error({content:\"请填写正确手机号\"});else this.messageService.error({content:\"请填写正确成员姓名\"})},onCancelItem:function(e,t){this.list.shift(),this.$emit(\"change\",this.list)},onDeleteItem:function(e,t){this.list.splice(t,1),this.$emit(\"change\",this.list)},onChangeMinors:function(e,t){1===e&&(t.parent_mobile=t.mobile,this.$set(t,\"parent_user_role\",1))},onAddMember:function(){this.memberSearchText=\"\";var e=this.list.filter((function(e){return e.isEdit}));e&&e.length>0?this.messageService.error({content:\"还有没有新增完成的成员\"}):(this.visible=!1,this.list.unshift({name:\"\",mobile:\"\",is_minors:0,isEdit:!0}))},onMemberSearch:function(e){this.memberSearchText=e.target.value,e&&this.addCardMemberService.memberListAction$.dispatch(e.target.value,this.type)},onMemberChange:function(e){if(!(this.list.length>=this.max)){var t=this.list.filter((function(t){return t.mobile===e.mobile&&!t.isEdit}));if(t&&t.length>0)this.messageService.error({content:\"该手机号已经存在\"});else{var i=this.list.filter((function(e){return e.isEdit})),n=0;i&&i.length>0&&(n=1),this.list.splice(n,0,{id:e.id,name:e.member_name,mobile:e.mobile,is_minors:e.is_minors,parent_mobile:e.parent_mobile,parent_name:e.parent_name,parent_user_role:e.parent_user_role}),this.visible=!1,this.resetSearchCondition(),this.$emit(\"change\",this.list)}}},resetSearchCondition:function(){this.memberSearchText=\"\",this.memberList=[]}}},O=x,$=i(\"2877\"),T=Object($[\"a\"])(O,s,a,!1,null,null,null);t[\"a\"]=T.exports}}]);","extractedComments":[]}