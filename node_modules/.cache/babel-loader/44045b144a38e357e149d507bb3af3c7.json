{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/reception/components#/shortcut-model.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/reception/components#/shortcut-model.vue","mtime":1597396800000},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { ShortcutModelService } from \"./shortcut-model.service\";\nimport FrontAddReserve from '@/views/biz-modals/front/add-reserve';\nimport ShopFinanceGatheringEarnestAdd from '@/views/biz-modals/shop/finance/gathering/earnest/add';\nimport SoldDealSaleCabinet from '@/views/biz-modals/sold/deal/sale-cabinet';\nimport SoldDealSaleCourse from '@/views/biz-modals/sold/deal/sale-course';\nimport SoldDealSaleDepositCard from '@/views/biz-modals/sold/deal/sale-deposit-card';\nimport SoldDealSaleMemberCard from '@/views/biz-modals/sold/deal/sale-member-card';\nimport SoldDealSalePersonalCourse from '@/views/biz-modals/sold/deal/sale-personal-course';\nimport SoldDealSaleSmallCourse from '@/views/biz-modals/sold/deal/sale-small-course';\nimport ShopReceptionEditShortcuts from '@/views/biz-modals/shop/reception/edit-shortcuts';\nimport SoldDealGatheringTip from '@/views/biz-modals/sold/deal/gathering-tip';\nimport SoldDealGathering from '@/views/biz-modals/sold/deal/gathering';\nimport { cloneDeep } from 'lodash-es';\nexport default {\n  name: '',\n  bem: {},\n  components: {},\n  serviceInject: function serviceInject() {\n    return {\n      shortcutModelService: ShortcutModelService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      auth: this.shortcutModelService.auth$,\n      list: this.shortcutModelService.list$,\n      loading: this.shortcutModelService.loading$\n    };\n  },\n  modals: {\n    SoldDealSaleMemberCard: SoldDealSaleMemberCard,\n    SoldDealSaleDepositCard: SoldDealSaleDepositCard,\n    SoldDealSalePersonalCourse: SoldDealSalePersonalCourse,\n    SoldDealSaleSmallCourse: SoldDealSaleSmallCourse,\n    SoldDealSaleCabinet: SoldDealSaleCabinet,\n    SoldDealSaleCourse: SoldDealSaleCourse,\n    FrontAddReserve: FrontAddReserve,\n    ShopFinanceGatheringEarnestAdd: ShopFinanceGatheringEarnestAdd,\n    ShopReceptionEditShortcuts: ShopReceptionEditShortcuts,\n    SoldDealGatheringTip: SoldDealGatheringTip,\n    SoldDealGathering: SoldDealGathering\n  },\n  props: {},\n  data: function data() {\n    return {\n      // 根据权限处理后的快捷操作列表\n      filterShortcutList: []\n    };\n  },\n  computed: {\n    isAllShow: function isAllShow() {\n      var len = this.list.length;\n      var fLen = this.filterShortcutList.length;\n      return len === fLen;\n    }\n  },\n  async: {},\n  mounted: function mounted() {\n    this.getShortCutList();\n  },\n  methods: {\n    getShortCutList: function getShortCutList() {\n      var _this = this;\n\n      this.shortcutModelService.getIcons().subscribe(function (res) {\n        _this.formatShortcutList();\n      });\n    },\n    handleRemoveModels: function handleRemoveModels(id) {\n      var _this2 = this;\n\n      var icons = this.list.map(function (i) {\n        if (i.id === id) i.is_show = 0;\n        return i;\n      });\n      console.log('icons', icons);\n      this.shortcutModelService.setIcons({\n        icons: icons\n      }).subscribe(function (res) {\n        _this2.show = false;\n\n        _this2.getShortCutList();\n      });\n    },\n    // 快捷操作\n    onShortcut: function onShortcut(data) {\n      var _this3 = this;\n\n      switch (data) {\n        case 'memberBill':\n          this.$modalRouter.push({\n            name: 'sold-deal-sale-member-card',\n            on: {\n              success: function success(result) {\n                _this3.saleCallBack(result, 'member');\n              }\n            }\n          });\n          break;\n\n        case 'depositBill':\n          this.$modalRouter.push({\n            name: 'sold-deal-sale-deposit-card',\n            on: {\n              success: function success(result) {\n                _this3.saleCallBack(result, 'deposit');\n              }\n            }\n          });\n          break;\n\n        case 'personalBill':\n          this.$modalRouter.push({\n            name: 'sold-deal-sale-personal-course',\n            on: {\n              success: function success(result) {\n                _this3.saleCallBack(result, 'personal');\n              }\n            }\n          });\n          break;\n\n        case 'packageBill':\n          this.$modalRouter.push({\n            name: 'sold-deal-sale-course',\n            on: {\n              success: function success(result) {\n                _this3.saleCallBack(result, 'package');\n              }\n            }\n          });\n          break;\n\n        case 'smallCourseBill':\n          this.$modalRouter.push({\n            name: 'sold-deal-sale-small-course',\n            on: {\n              success: function success(result) {\n                _this3.saleCallBack(result, 'small_course_order/detail');\n              }\n            }\n          });\n          break;\n\n        case 'cabinetBill':\n          this.$modalRouter.push({\n            name: 'sold-deal-sale-cabinet',\n            on: {\n              success: function success(result) {\n                _this3.saleCallBack(result, 'cabinet_order');\n              }\n            }\n          });\n          break;\n\n        case 'reserveAdd':\n          this.$modalRouter.push({\n            name: 'front-add-reserve',\n            on: {\n              success: function success(result) {\n                _this3.$router.reload();\n              }\n            }\n          });\n          break;\n\n        case 'earnestAdd':\n          this.$modalRouter.push({\n            name: 'shop-finance-gathering-earnest-add',\n            props: {},\n            on: {\n              success: function success(res) {\n                _this3.$router.reload();\n\n                _this3.payCallBack(res.orderId, res.type, 'pay');\n              }\n            }\n          });\n          break;\n\n        default:\n          this.$modalRouter.push({\n            name: 'shop-reception-edit-shortcuts',\n            on: {\n              success: function success(res) {\n                _this3.$router.reload();\n              }\n            }\n          });\n          break;\n      }\n    },\n    // 签单成功回调\n    saleCallBack: function () {\n      var _saleCallBack = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(result, type) {\n        var props, orderSuccessRes, _props, payOrderRes;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(result.type === 'create')) {\n                  _context.next = 8;\n                  break;\n                }\n\n                // 创建订单成功\n                props = {\n                  order_id: result.orderId,\n                  type: type,\n                  message: '订单创建成功',\n                  needPay: true\n                };\n                _context.next = 4;\n                return this.createdGatheringTip(props);\n\n              case 4:\n                orderSuccessRes = _context.sent;\n                this.tipCallBack(result.orderId, type, orderSuccessRes.type);\n                _context.next = 14;\n                break;\n\n              case 8:\n                if (!(result.type === 'createPay')) {\n                  _context.next = 14;\n                  break;\n                }\n\n                // 创建订单成功 并且到支付页面\n                _props = {\n                  order_id: result.orderId,\n                  type: type\n                };\n                _context.next = 12;\n                return this.createdOrderPay(_props);\n\n              case 12:\n                payOrderRes = _context.sent;\n                this.payCallBack(result.orderId, type, payOrderRes.type);\n\n              case 14:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function saleCallBack(_x, _x2) {\n        return _saleCallBack.apply(this, arguments);\n      }\n\n      return saleCallBack;\n    }(),\n    // 订单收款回调\n    payCallBack: function () {\n      var _payCallBack = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(orderId, modalType, callBackType) {\n        var _this4 = this;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.t0 = callBackType;\n                _context2.next = _context2.t0 === 'pay' ? 3 : 5;\n                break;\n\n              case 3:\n                this.createdGatheringTip({\n                  message: '收款成功',\n                  order_id: orderId\n                }).then(function (res) {\n                  _this4.tipCallBack(orderId, modalType, res.type);\n                });\n                return _context2.abrupt(\"break\", 5);\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function payCallBack(_x3, _x4, _x5) {\n        return _payCallBack.apply(this, arguments);\n      }\n\n      return payCallBack;\n    }(),\n    // 订单支付\n    createdOrderPay: function createdOrderPay(props) {\n      var _this5 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this5.$modalRouter.push({\n          name: 'sold-deal-gathering',\n          props: props,\n          on: {\n            success: resolve\n          }\n        });\n      });\n    },\n    // 创建成功，提示框modal\n    createdGatheringTip: function createdGatheringTip(props) {\n      var _this6 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this6.$modalRouter.push({\n          name: 'sold-deal-gathering-tip',\n          props: props,\n          on: {\n            success: resolve\n          }\n        });\n      });\n    },\n    // 提示框回调，gathering-tip\n    tipCallBack: function () {\n      var _tipCallBack = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(orderId, modalType, callBackType) {\n        var _this7 = this;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.t0 = callBackType;\n                _context3.next = _context3.t0 === 'cancel' ? 3 : _context3.t0 === 'Print' ? 4 : _context3.t0 === 'ViewOrder' ? 6 : _context3.t0 === 'PrintOrder' ? 8 : _context3.t0 === 'Pay' ? 10 : 12;\n                break;\n\n              case 3:\n                return _context3.abrupt(\"break\", 12);\n\n              case 4:\n                this.createdOrderPrint(orderId);\n                return _context3.abrupt(\"break\", 12);\n\n              case 6:\n                this.createdOrderViewOrder(orderId);\n                return _context3.abrupt(\"break\", 12);\n\n              case 8:\n                this.printOrder(orderId);\n                return _context3.abrupt(\"break\", 12);\n\n              case 10:\n                this.createdOrderPay({\n                  order_id: orderId,\n                  type: modalType\n                }).then(function (res) {\n                  _this7.payCallBack(orderId, modalType, res.type);\n                });\n                return _context3.abrupt(\"break\", 12);\n\n              case 12:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function tipCallBack(_x6, _x7, _x8) {\n        return _tipCallBack.apply(this, arguments);\n      }\n\n      return tipCallBack;\n    }(),\n    // 打印合同\n    createdOrderPrint: function createdOrderPrint(order_id) {\n      var url = \"\".concat(window.location.origin, \"/common/contract-preview?id=\").concat(order_id);\n      window.open(url);\n    },\n    // 查看订单\n    createdOrderViewOrder: function createdOrderViewOrder(order_id) {\n      this.$router.push({\n        name: 'shop-finance-order-info-collection-details',\n        query: {\n          id: order_id\n        }\n      });\n    },\n    // 打印小票\n    printOrder: function printOrder(order_id) {\n      window.open('/ticket/gathering-print?id=' + order_id, '_blank', 'width=800,height=600');\n    },\n    formatShortcutList: function formatShortcutList() {\n      var _this8 = this;\n\n      console.log('list', this.list);\n      this.filterShortcutList = this.list.map(function (i) {\n        i.auth = _this8.auth[i.id];\n        return i;\n      }).filter(function (i) {\n        return i.auth && i.is_show;\n      });\n    },\n    onAddShortcut: function onAddShortcut() {\n      var _this9 = this;\n\n      this.$modalRouter.push({\n        name: 'shop-reception-edit-shortcuts',\n        on: {\n          done: function done() {\n            _this9.getShortCutList();\n          }\n        }\n      });\n    }\n  }\n};",null]}