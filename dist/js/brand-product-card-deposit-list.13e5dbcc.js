(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["brand-product-card-deposit-list"],{"030a":function(e,t,n){"use strict";var a,s,r,i,o,c,l,d;n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return s})),n.d(t,"b",(function(){return r})),n.d(t,"f",(function(){return i})),n.d(t,"h",(function(){return o})),n.d(t,"g",(function(){return c})),n.d(t,"c",(function(){return l})),n.d(t,"a",(function(){return d})),function(e){e[e["CAN_SELL"]=1]="CAN_SELL",e[e["NO_SELL"]=2]="NO_SELL"}(a||(a={})),function(e){e[e["CLIENT"]=1]="CLIENT",e[e["OFFLINE"]=2]="OFFLINE"}(s||(s={})),function(e){e[e["ONLY_STORE"]=1]="ONLY_STORE",e[e["GENERAL_STORE"]=2]="GENERAL_STORE",e[e["ALL_STORE"]=3]="ALL_STORE"}(r||(r={})),function(e){e[e["ALL_STORE"]=1]="ALL_STORE",e[e["SPECIFIED_STORE"]=2]="SPECIFIED_STORE",e[e["CONSUMER_STORE"]=3]="CONSUMER_STORE"}(i||(i={})),function(e){e[e["DAY"]=1]="DAY",e[e["MONTH"]=2]="MONTH",e[e["YEAR"]=3]="YEAR"}(o||(o={})),function(e){e[e["PERCENT"]=1]="PERCENT",e[e["RMB"]=2]="RMB"}(c||(c={})),function(e){e[e["NOT_ALLOW"]=0]="NOT_ALLOW",e[e["ALLOW"]=1]="ALLOW"}(l||(l={})),function(e){e[e["VALID"]=1]="VALID",e[e["INVALID"]=2]="INVALID"}(d||(d={}))},"96dc":function(e,t,n){"use strict";n.r(t);var a,s,r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.all()},[n("portal",{attrs:{to:"BRAND_PRODUCT_CARD_DEPOSIT_KEYWORDS_SEARCH"}},[n("st-input-search",{attrs:{placeholder:"请输入储值卡名称搜索",maxlength:"50"},on:{search:function(t){return e.onKeywordsSearch("card_name",t)}},model:{value:e.$searchQuery.card_name,callback:function(t){e.$set(e.$searchQuery,"card_name",t)},expression:"$searchQuery.card_name"}})],1),n("div",{class:e.all("search")},[e.auth.add?n("router-link",{attrs:{to:"../add"}},[n("st-button",{attrs:{type:"primary",icon:"add"}},[e._v("新增储值卡")])],1):e._e(),n("div",[n("a-select",{staticClass:"mg-r8",class:e.all("search__select"),on:{change:function(t){return e.onSingleSearch("publish_channel",t)}},model:{value:e.$searchQuery.publish_channel,callback:function(t){e.$set(e.$searchQuery,"publish_channel",t)},expression:"$searchQuery.publish_channel"}},e._l(e.publishChannel,(function(t,a){return n("a-select-option",{key:a,attrs:{value:t.value}},[e._v("\n          "+e._s(t.label)+"\n        ")])})),1),n("a-select",{class:e.all("search__select"),on:{change:function(t){return e.onSingleSearch("sell_status",t)}},model:{value:e.$searchQuery.sell_status,callback:function(t){e.$set(e.$searchQuery,"sell_status",t)},expression:"$searchQuery.sell_status"}},e._l(e.sellStatus,(function(t,a){return n("a-select-option",{key:a,attrs:{value:t.value}},[e._v("\n          "+e._s(t.label)+"\n        ")])})),1)],1)],1),n("st-table",{attrs:{scroll:{x:1500},page:e.page,loading:e.loading.getList,columns:e.columns,dataSource:e.list,rowKey:"id"},on:{change:e.onTableChange},scopedSlots:e._u([{key:"card_name",fn:function(t){return[e._v("\n      "+e._s(t)+"\n    ")]}},{key:"num",fn:function(t,n){return[e._v("\n      "+e._s(t)+e._s(e._f("enumFilter")(n.unit,"deposit_card.unit"))+"\n    ")]}},{key:"card_price",fn:function(t){return[e._v("\n      "+e._s(t)+"\n    ")]}},{key:"sell_price",fn:function(t){return[e._v("\n      "+e._s(t)+"\n    ")]}},{key:"support_sales",fn:function(t,a){return[t.id===e.SUPPORT_SALES.SPECIFIED_STORE?n("a",{directives:[{name:"modal-link",rawName:"v-modal-link",value:{name:"card-brand-deposit-shop-table",props:{id:a.id,type:"Sale",title:"支持售卖门店"}},expression:"{\n          name: 'card-brand-deposit-shop-table',\n          props: { id: record.id, type: 'Sale', title: '支持售卖门店' }\n        }"}]},[e._v("\n        "+e._s(t.name)+"\n      ")]):n("span",{staticClass:"use_num"},[e._v(e._s(t.name))])]}},{key:"consumption_range",fn:function(t,a){return[t.id===e.CONSUMPTION_RANGE.GENERAL_STORE?n("a",{directives:[{name:"modal-link",rawName:"v-modal-link",value:{name:"card-brand-deposit-shop-table",props:{id:a.id,type:"Consume",title:"支持消费门店"}},expression:"{\n          name: 'card-brand-deposit-shop-table',\n          props: { id: record.id, type: 'Consume', title: '支持消费门店' }\n        }"}]},[e._v("\n        "+e._s(t.name)+"\n      ")]):n("span",{staticClass:"use_num"},[e._v(e._s(t.name))])]}},{key:"sell_time",fn:function(t,n){return[e._v("\n      "+e._s(n.start_time)+" ~ "+e._s(n.end_time)+"\n    ")]}},{key:"upper_lower_num",fn:function(t,n){return[e._v("\n      "+e._s(n.upper_shelf_num)+"/"+e._s(n.lower_shelf_num)+"\n    ")]}},{key:"publish_channel",fn:function(t){return[e._v("\n      "+e._s(t.name)+"\n    ")]}},{key:"sell_status",fn:function(t,a){return[n("st-text",{attrs:{status:{success:1===t.id,error:2===t.id}}},[e._v("\n        "+e._s(t.name)+"\n      ")]),t.id===e.SELL_STATUS.NO_SELL?n("st-help-popover",[n("span",{attrs:{slot:"title"},slot:"title"},[e._v("\n          操作人："+e._s(a.stop_sale.operator_name)+"\n          "),n("br"),e._v("\n          操作时间："+e._s(a.stop_sale.stop_time)+"\n        ")]),n("span",{attrs:{slot:"content"},slot:"content"},[e._v("\n          "+e._s(a.stop_sale.stop_reason)+"\n        ")])]):e._e()]}},{key:"action",fn:function(t,a){return n("div",{},[n("st-table-actions",[a.auth["brand:product:deposit_card|get"]?n("router-link",{attrs:{to:{path:"/brand/product/card/deposit/info",query:{id:a.id}}}},[e._v("\n          详情\n        ")]):e._e(),a.auth["brand:product:deposit_card|edit"]?n("a",{on:{click:function(t){return e.onEdit(a)}}},[e._v("\n          编辑\n        ")]):e._e(),a.auth["brand:product:deposit_card|up"]?n("a",{on:{click:function(t){return e.onShelf(a)}}},[e._v("\n          上架\n        ")]):e._e(),a.auth["brand:product:deposit_card|pause"]?n("a",{on:{click:function(t){return e.onStopSale(a)}}},[e._v("\n          停售\n        ")]):e._e(),a.auth["brand:product:deposit_card|restore"]?n("a",{on:{click:function(t){return e.onRecoverSale(a)}}},[e._v("\n          恢复售卖\n        ")]):e._e(),a.auth["brand:product:deposit_card|del"]?n("a",{on:{click:function(t){return e.onDelete(a)}}},[e._v("\n          删除\n        ")]):e._e()],1)],1)}}])})],1)},i=[],o=n("e5ea"),c=function(){return[{title:"储值卡名称",dataIndex:"card_name",fixed:"left",width:175,scopedSlots:{customRender:"card_name"}},{title:"有效期",dataIndex:"num",scopedSlots:{customRender:"num"}},{title:"储值金额(元)",dataIndex:"card_price",scopedSlots:{customRender:"card_price"}},{title:"售卖价格(元)",dataIndex:"sell_price",scopedSlots:{customRender:"sell_price"}},{title:"支持售卖门店",dataIndex:"support_sales",width:175,scopedSlots:{customRender:"support_sales"}},{title:"支持消费门店",width:175,dataIndex:"consumption_range",scopedSlots:{customRender:"consumption_range"}},{title:"上/下架门店数",scopedSlots:{customRender:"upper_lower_num"}},{title:"支持售卖时间",dataIndex:"sell_time",scopedSlots:{customRender:"sell_time"}},{title:"售卖状态",dataIndex:"sell_status",scopedSlots:{customRender:"sell_status"}},{title:"发布渠道",dataIndex:"publish_channel",scopedSlots:{customRender:"publish_channel"}},{title:"操作",dataIndex:"action",fixed:"right",width:160,scopedSlots:{customRender:"action"}}]},l=n("ea3e"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("st-modal",{attrs:{title:e.$c("member_card")+"恢复售卖",wrapClassName:"modal-card-brand-recover-sale",width:"484px"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[n("div",{class:e.recoverSale()},[n("div",{staticClass:"mg-b24",class:e.recoverSale("warn-text")},[n("st-icon",{staticStyle:{"line-height":"22px",flex:"none","margin-top":"4px"},attrs:{color:"#1890FF",size:"14px",type:"help"}}),n("p",[e._v("\n        注：仅恢复"+e._s(e.$c("member_card"))+"为可售卖状态，该"+e._s(e.$c("member_card"))+"需要重新上架至门店。\n      ")])],1),n("div",{staticClass:"mg-b24",class:e.recoverSale("card-name")},[n("st-tag",{staticStyle:{"margin-right":"8px"},attrs:{type:"deposit-card"}}),n("span",[e._v(e._s(e.cardName))])],1),n("st-form",{class:e.recoverSale("form"),attrs:{form:e.form,labelWidth:"94px"}},[n("st-form-item",{staticClass:"mg-b0",attrs:{label:"支持售卖时间",required:""}},[n("div",{class:e.recoverSale("saletime")},[n("a-form-item",{staticClass:"page-a-form"},[n("a-date-picker",{staticStyle:{width:"100%"},attrs:{disabled:"",format:"YYYY-MM-DD",placeholder:"开始时间"},model:{value:e.startTime,callback:function(t){e.startTime=t},expression:"startTime"}})],1),n("span",[e._v("~")]),n("a-form-item",{staticClass:"page-a-form"},[n("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorators.endTime,expression:"decorators.endTime"}],attrs:{disabledDate:e.disabledEndDate,format:"YYYY-MM-DD",placeholder:"结束时间",showToday:!1}})],1)],1)])],1)],1),n("footer",{class:e.recoverSale("footer"),attrs:{slot:"footer"},slot:"footer"},[n("st-button",{on:{click:function(t){e.show=!1}}},[e._v("取消")]),n("st-button",{attrs:{type:"primary",loading:e.loading.setRecoverSale,ghost:""},on:{click:e.onSubmit}},[e._v("\n      恢复售卖\n    ")])],1)])},u=[],p=n("5c8a"),h=n("c32d"),f=n.n(h),m=n("d225"),b=n("b0b4"),_=n("9ab4"),v=n("0cd5"),S=n("df29"),g=n("f80f"),y=n("c4cc"),O=function(){function e(t){Object(m["a"])(this,e),this.cardApi=t,this.loading$=new S["d"]({}),this.time$=new S["d"](0)}return Object(b["a"])(e,[{key:"getServiceTime",value:function(){var e=this;return this.cardApi.getServiceTime().pipe(Object(y["a"])((function(t){e.time$.commit((function(){return t.info}))})))}},{key:"setRecoverSale",value:function(e,t){return this.cardApi.setCardsSaleRecover(e,t,"brand","deposit")}}]),e}();Object(_["b"])([Object(S["c"])(),Object(_["d"])("design:type",Function),Object(_["d"])("design:paramtypes",["function"===typeof(a="undefined"!==typeof g["CardSaleRecoverInput"]&&g["CardSaleRecoverInput"])?a:Object,String]),Object(_["d"])("design:returntype",void 0)],O.prototype,"setRecoverSale",null),O=Object(_["b"])([Object(v["b"])(),Object(_["d"])("design:paramtypes",["function"===typeof(s="undefined"!==typeof g["f"]&&g["f"])?s:Object])],O);var j,$,w=function(e){return{endTime:{rules:[{required:!0,message:"请选择结束售卖时间"}]}}},C={name:"ModalCardBrandDepositRecoverSale",bem:{recoverSale:"modal-card-brand-recover-sale"},serviceInject:function(){return{recoverSaleService:O}},rxState:function(){return{loading:this.recoverSaleService.loading$,serviceTime:this.recoverSaleService.time$}},props:["id","cardName"],data:function(){var e=this.$stForm.create(),t=e.decorators(w);return{form:e,decorators:t,show:!1,startTime:null,endTime:null}},methods:{moment:f.a,disabledEndDate:function(e){return e.valueOf()<1e3*this.serviceTime||e.valueOf()>f()(1e3*this.serviceTime).add(30,"y").valueOf()},onSubmit:function(){var e=this;this.form.validate().then((function(t){e.recoverSaleService.setRecoverSale({start_time:"".concat(f()(1e3*e.serviceTime).format("YYYY-MM-DD")),end_time:"".concat(t.endTime.format("YYYY-MM-DD"))},e.id).subscribe((function(){e.show=!1,e.$emit("success")}))}))}},mounted:function(){var e=this;this.recoverSaleService.getServiceTime().subscribe((function(){e.startTime=Object(p["a"])(f()(1e3*e.serviceTime))}))}},R=C,L=n("2877"),k=Object(L["a"])(R,d,u,!1,null,null,null),x=k.exports,E=n("bb56"),I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("st-modal",{attrs:{title:"储值卡停售",wrapClassName:"modal-card-brand-stop-sale",width:"484px"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[n("div",{class:e.stopSale()},[n("div",{staticClass:"mg-b24",class:e.stopSale("warn-text")},[n("st-icon",{staticStyle:{"line-height":"22px",flex:"none","margin-top":"4px"},attrs:{color:"#1890FF",size:"14px",type:"help"}}),n("p",[e._v("\n        注：停止售卖储值卡，将自动下架在门店售卖的本储值卡；已购买本储值卡的会员仍旧享有该"+e._s(e.$c("member_card"))+"权益。\n      ")])],1),n("div",{staticClass:"mg-b24",class:e.stopSale("card-name")},[n("st-tag",{staticStyle:{"margin-right":"8px"},attrs:{type:"deposit-card"}}),n("span",[e._v(e._s(e.cardName))])],1),n("div",{staticClass:"mg-b24",class:e.stopSale("num")},[n("p",{staticClass:"mg-b16"},[n("span",{staticClass:"label "},[e._v("当前上架门店（家）：")]),n("span",{staticClass:"value"},[e._v(e._s(e.info.shelf_shop_num))]),n("span",{staticClass:"description"},[e._v("（不含已下架门店）")])]),n("p",{staticClass:"mg-b0"},[n("span",{staticClass:"label "},[e._v("当前有效卡数（张）：")]),n("span",{staticClass:"value"},[e._v(e._s(e.info.valid_card_num))]),n("span",{staticClass:"description"},[e._v("（不含已过期卡）")])])]),n("st-form",{class:e.stopSale("form"),attrs:{form:e.form,labelGutter:"0"}},[n("st-form-item",{staticClass:"mg-b0",attrs:{label:"停售原因",labelWidth:"68px",required:""}}),n("st-form-item",{attrs:{labelWidth:"0px"}},[n("st-textarea",{attrs:{maxlength:300,placeholder:"请输入内容"},on:{change:e.onReasonChange},model:{value:e.reason,callback:function(t){e.reason=t},expression:"reason"}})],1)],1)],1),n("footer",{class:e.stopSale("footer"),attrs:{slot:"footer"},slot:"footer"},[n("st-button",{on:{click:function(t){e.show=!1}}},[e._v("取消")]),e.reasonIsNone?n("st-button",{attrs:{type:"danger",disabled:e.reasonIsNone}},[e._v("\n      确认停售\n    ")]):n("a-popconfirm",{attrs:{title:"确认停售该储值卡"},on:{confirm:e.onStop}},[n("st-button",{attrs:{type:"danger",loading:e.loading.setStopSale}},[e._v("\n        确认停售\n      ")])],1)],1)])},D=[],T=function(){function e(t){Object(m["a"])(this,e),this.cardApi=t,this.loading$=new S["d"]({}),this.info$=new S["d"]({})}return Object(b["a"])(e,[{key:"getStopSaleInfo",value:function(e){var t=this;return this.cardApi.getCardSaleStopInfo(e,"brand","deposit").pipe(Object(y["a"])((function(e){t.info$.commit((function(){return e.info}))})))}},{key:"setStopSale",value:function(e,t){return this.cardApi.setCardsSaleStop(e,t,"brand","deposit")}}]),e}();Object(_["b"])([Object(S["c"])(),Object(_["d"])("design:type",Function),Object(_["d"])("design:paramtypes",["function"===typeof(j="undefined"!==typeof g["CardSaleStopInput"]&&g["CardSaleStopInput"])?j:Object,String]),Object(_["d"])("design:returntype",void 0)],T.prototype,"setStopSale",null),T=Object(_["b"])([Object(v["b"])(),Object(_["d"])("design:paramtypes",["function"===typeof($="undefined"!==typeof g["f"]&&g["f"])?$:Object])],T);var A={name:"ModalCardBrandDepositStopSale",bem:{stopSale:"modal-card-brand-stop-sale"},serviceInject:function(){return{stopSaleService:T}},rxState:function(){return{loading:this.stopSaleService.loading$,info:this.stopSaleService.info$}},props:["id","cardName"],data:function(){return{form:this.$form.createForm(this),show:!1,reason:"",reasonIsNone:!0}},methods:{onReasonChange:function(e){this.reasonIsNone=""===e.trim()},onStop:function(){var e=this;this.stopSaleService.setStopSale({reason:this.reason},this.id).subscribe((function(){e.show=!1,e.$emit("success")}))}},mounted:function(){this.stopSaleService.getStopSaleInfo(this.id).subscribe()}},N=A,P=Object(L["a"])(N,I,D,!1,null,null,null),M=P.exports,F=n("030a"),Y={mixins:[l["a"]],name:"PageBrandProductDepositAll",bem:{all:"page-brand-product-deposit-list-all"},serviceInject:function(){return{allService:o["AllService"]}},modals:{CardBrandDepositRecoverSale:x,CardBrandDepositShopTable:E["a"],CardBrandDepositStopSale:M},rxState:function(){return{sellStatus:this.allService.sellStatus$,loading:this.allService.loading$,publishChannel:this.allService.publishChannel$,list:this.allService.list$,page:this.allService.page$,auth:this.allService.auth$}},data:function(){return{SUPPORT_SALES:F["f"],CONSUMPTION_RANGE:F["b"],SELL_STATUS:F["d"]}},computed:{columns:c},methods:{onEdit:function(e){this.$router.push({path:"/brand/product/card/deposit/edit",query:{id:e.id}})},onShelf:function(e){var t=this;this.$confirm({title:"上架",content:"确认上架".concat(e.card_name,"储值卡至").concat(e.wait_shelf_num,"家门店？"),onOk:function(){return t.allService.setShelf(e.id).toPromise().then((function(){t.$router.reload()}))}})},onStopSale:function(e){var t=this;this.$modalRouter.push({name:"card-brand-deposit-stop-sale",props:{id:+e.id,cardName:e.card_name},on:{success:function(){t.$router.push({query:t.$searchQuery})}}})},onRecoverSale:function(e){var t=this;this.$modalRouter.push({name:"card-brand-deposit-recover-sale",props:{id:e.id,cardName:e.card_name},on:{success:function(){t.$router.push({query:t.$searchQuery})}}})},onDelete:function(e){var t=this;this.$confirm({title:"确认要删除",content:"确认删除".concat(e.card_name).concat(this.$c("member_card"),"？"),onOk:function(){return t.allService.deleteCard(e.id).toPromise().then((function(){t.$router.reload()}))}})}}},Q=Y,B=Object(L["a"])(Q,r,i,!1,null,null,null);t["default"]=B.exports},a246:function(e,t,n){"use strict";n.r(t),n.d(t,"ShelvesService",(function(){return y}));var a,s,r,i,o,c,l=n("d225"),d=n("b0b4"),u=n("9ab4"),p=n("0cd5"),h=n("df29"),f=n("f80f"),m=n("ebb6"),b=n("c4cc"),_=n("5afb"),v=n("54da"),S=n("2cbb"),g=n("2138"),y=function(){function e(t,n,a,s){Object(l["a"])(this,e),this.cardApi=t,this.shopApi=n,this.userService=a,this.authService=s,this.shopList$=new h["d"]([]),this.list$=new h["d"]([]),this.page$=new h["d"]({}),this.loading$=new h["d"]({}),this.auth$=this.authService.authMap$({batchDown:"brand_shop:product:deposit_card|batch_down"}),this.publishChannel$=this.userService.getOptions$("deposit_card.publish_channel").pipe(Object(m["a"])((function(e){return[{value:-1,label:"所有渠道"}].concat(e)})))}return Object(d["a"])(e,[{key:"getList",value:function(e){var t=this;return this.cardApi.getCardShelfList(e,"brand","deposit").pipe(Object(b["a"])((function(e){t.page$.commit((function(){return e.page})),t.list$.commit((function(){return e.list}))})))}},{key:"getShopList",value:function(){var e=this;return this.shopApi.getShopListForSelect().pipe(Object(b["a"])((function(t){e.shopList$.commit((function(){return t.shops}))})))}},{key:"init",value:function(e){return Object(v["a"])(this.getList(e),this.getShopList())}},{key:"setCardShelfDown",value:function(e){return this.cardApi.setBrandDepositShelfDown(e)}},{key:"beforeEach",value:function(e){return this.init(e.meta.query)}}]),e}();Object(u["b"])([Object(h["c"])(),Object(u["d"])("design:type",Function),Object(u["d"])("design:paramtypes",["function"===typeof(a="undefined"!==typeof f["CardShelfListInput"]&&f["CardShelfListInput"])?a:Object]),Object(u["d"])("design:returntype",void 0)],y.prototype,"getList",null),Object(u["b"])([Object(h["c"])(),Object(u["d"])("design:type",Function),Object(u["d"])("design:paramtypes",["function"===typeof(s="undefined"!==typeof f["BrandCardShelfDownInput"]&&f["BrandCardShelfDownInput"])?s:Object]),Object(u["d"])("design:returntype",void 0)],y.prototype,"setCardShelfDown",null),y=Object(u["b"])([Object(p["b"])(),Object(u["d"])("design:paramtypes",["function"===typeof(r="undefined"!==typeof f["f"]&&f["f"])?r:Object,"function"===typeof(i="undefined"!==typeof _["c"]&&_["c"])?i:Object,"function"===typeof(o="undefined"!==typeof g["a"]&&g["a"])?o:Object,"function"===typeof(c="undefined"!==typeof S["a"]&&S["a"])?c:Object])],y)},bb56:function(e,t,n){"use strict";var a,s,r,i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("st-modal",{attrs:{title:e.title,footer:null,wrapClassName:"scroll-modal"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[n("st-table",{attrs:{rowKey:"key",loading:e.loading["get"+e.type+"ShopList"],dataSource:e.stList,columns:e.columns,scroll:{y:230},page:e.page},on:{change:e.onPageChange}})],1)},o=[],c=(n("8e6e"),n("456d"),n("bd86")),l=(n("6b54"),n("ac6a"),n("d225")),d=n("b0b4"),u=n("9ab4"),p=n("0cd5"),h=n("df29"),f=n("f80f"),m=n("c4cc"),b=function(){function e(t){Object(l["a"])(this,e),this.cardApi=t,this.loading$=new h["d"]({}),this.list$=new h["d"]([]),this.page$=new h["d"]({current_page:1,size:20,total_counts:1,total_pages:1})}return Object(d["a"])(e,[{key:"getConsumeShopList",value:function(e,t){var n=this;return this.cardApi.getCardsDepositConsumeShop(e,t).pipe(Object(m["a"])((function(e){n.list$.commit((function(){return e.list})),n.page$.commit((function(){return e.page}))})))}},{key:"getSaleShopList",value:function(e,t){var n=this;return this.cardApi.getCardsDepositSaleShop(e,t).pipe(Object(m["a"])((function(e){n.list$.commit((function(){return e.list})),n.page$.commit((function(){return e.page}))})))}}]),e}();Object(u["b"])([Object(h["c"])(),Object(u["d"])("design:type",Function),Object(u["d"])("design:paramtypes",["function"===typeof(a="undefined"!==typeof f["ListPageInput"]&&f["ListPageInput"])?a:Object,String]),Object(u["d"])("design:returntype",void 0)],b.prototype,"getConsumeShopList",null),Object(u["b"])([Object(h["c"])(),Object(u["d"])("design:type",Function),Object(u["d"])("design:paramtypes",["function"===typeof(s="undefined"!==typeof f["ListPageInput"]&&f["ListPageInput"])?s:Object,String]),Object(u["d"])("design:returntype",void 0)],b.prototype,"getSaleShopList",null),b=Object(u["b"])([Object(p["b"])(),Object(u["d"])("design:paramtypes",["function"===typeof(r="undefined"!==typeof f["f"]&&f["f"])?r:Object])],b);var _=function(){return[{title:"省",dataIndex:"province_name",width:"22%",scopedSlots:{customRender:"province_name"}},{title:"市",width:"22%",dataIndex:"city_name"},{title:"区",width:"22%",dataIndex:"district_name"},{title:"门店名称",width:"34%",dataIndex:"shop_name"}]},v=n("ea3e");function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){Object(c["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y={name:"ModalBrandDepositShopTable",mixins:[v["a"]],serviceInject:function(){return{shopTableService:b}},rxState:function(){return{loading:this.shopTableService.loading$,list:this.shopTableService.list$,page:this.shopTableService.page$}},computed:{stList:function(){var e=[];return this.list.forEach((function(t){var n=parseInt(999999*Math.random()).toString();e.push(g({},t,{key:n}))})),e},columns:_},props:["id","type","title"],data:function(){return{show:!1}},created:function(){this.getList({size:20,current_page:1})},methods:{getList:function(e){this.shopTableService["get".concat(this.type,"ShopList")](e,this.id).subscribe()},onPageChange:function(e){this.getList({size:e.pageSize,current_page:e.current})}}},O=y,j=n("2877"),$=Object(j["a"])(O,i,o,!1,null,null,null);t["a"]=$.exports},e5ea:function(e,t,n){"use strict";n.r(t),n.d(t,"AllService",(function(){return v}));var a,s,r,i,o=n("d225"),c=n("b0b4"),l=n("9ab4"),d=n("0cd5"),u=n("df29"),p=n("f80f"),h=n("2cbb"),f=n("ebb6"),m=n("c4cc"),b=n("2138"),_=n("54da"),v=function(){function e(t,n,a){Object(o["a"])(this,e),this.cardsApi=t,this.userService=n,this.authService=a,this.list$=new u["d"]([]),this.page$=new u["d"]({}),this.loading$=new u["d"]({}),this.auth$=this.authService.authMap$({add:"brand:product:deposit_card|add"}),this.publishChannel$=this.userService.getOptions$("deposit_card.publish_channel").pipe(Object(f["a"])((function(e){return[{value:-1,label:"所有渠道"}].concat(e)}))),this.sellStatus$=this.userService.getOptions$("deposit_card.sell_status").pipe(Object(f["a"])((function(e){return[{value:-1,label:"所有售卖状态"}].concat(e)})))}return Object(c["a"])(e,[{key:"getList",value:function(e){var t=this;return this.cardsApi.getCardList(e,"brand","deposit").pipe(Object(m["a"])((function(e){t.list$.commit((function(){return e.list})),t.page$.commit((function(){return e.page}))})))}},{key:"setShelf",value:function(e){return this.cardsApi.setCardsDepositShelf(e,"brand")}},{key:"deleteCard",value:function(e){return this.cardsApi.setCardsDelete(e,"brand","deposit")}},{key:"init",value:function(e){return Object(_["a"])(this.getList(e))}},{key:"beforeEach",value:function(e){return this.init(e.meta.query)}}]),e}();Object(l["b"])([Object(u["c"])(),Object(l["d"])("design:type",Function),Object(l["d"])("design:paramtypes",["function"===typeof(a="undefined"!==typeof p["CardListInput"]&&p["CardListInput"])?a:Object]),Object(l["d"])("design:returntype",void 0)],v.prototype,"getList",null),v=Object(l["b"])([Object(d["b"])(),Object(l["d"])("design:paramtypes",["function"===typeof(s="undefined"!==typeof p["f"]&&p["f"])?s:Object,"function"===typeof(r="undefined"!==typeof b["a"]&&b["a"])?r:Object,"function"===typeof(i="undefined"!==typeof h["a"]&&h["a"])?i:Object])],v)},f3d6:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.shelves()},[n("portal",{attrs:{to:"BRAND_PRODUCT_CARD_DEPOSIT_KEYWORDS_SEARCH"}},[n("st-input-search",{attrs:{placeholder:"请输入储值卡名称搜索",maxlength:"50"},on:{search:function(t){return e.onKeywordsSearch("card_name",t)}},model:{value:e.$searchQuery.card_name,callback:function(t){e.$set(e.$searchQuery,"card_name",t)},expression:"$searchQuery.card_name"}})],1),n("div",{staticClass:"mg-b16",class:e.shelves("search")},[n("div",[n("a-select",{staticClass:"mg-r8",class:e.shelves("search__select"),on:{change:function(t){return e.onSingleSearch("publish_channel",t)}},model:{value:e.$searchQuery.publish_channel,callback:function(t){e.$set(e.$searchQuery,"publish_channel",t)},expression:"$searchQuery.publish_channel"}},e._l(e.publishChannel,(function(t,a){return n("a-select-option",{key:a,attrs:{value:t.value}},[e._v("\n          "+e._s(t.label)+"\n        ")])})),1),n("a-select",{class:e.shelves("search__select"),attrs:{showSearch:"",placeholder:"输入门店名称搜索",optionFilterProp:"children",filterOption:e.filterOption},on:{change:function(t){return e.onSingleSearch("shop_id",t)}},model:{value:e.$searchQuery.shop_id,callback:function(t){e.$set(e.$searchQuery,"shop_id",t)},expression:"$searchQuery.shop_id"}},[n("a-select-option",{attrs:{value:-1}},[e._v("所有门店")]),e._l(e.shopList,(function(t,a){return n("a-select-option",{key:a,attrs:{value:t.id}},[e._v("\n          "+e._s(t.shop_name)+"\n        ")])}))],2)],1),e.auth.batchDown?n("st-button",{attrs:{type:"primary",disabled:!e.selectedRowKeys.length},on:{click:e.onBatchShelfDown}},[e._v("\n      批量下架\n    ")]):e._e()],1),n("st-table",{attrs:{scroll:{x:1300},page:e.page,alertSelection:{onReset:e.onSelectionReset},rowSelection:{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectionChange},loading:e.loading.getList,columns:e.columns,dataSource:e.list,rowKey:"key"},on:{change:e.onTableChange},scopedSlots:e._u([{key:"shop_name",fn:function(t){return[e._v("\n      "+e._s(t)+"\n    ")]}},{key:"card_name",fn:function(t){return[e._v("\n      "+e._s(t)+"\n    ")]}},{key:"num",fn:function(t,n){return[e._v("\n      "+e._s(t)+e._s(e._f("enumFilter")(n.unit,"deposit_card.unit"))+"\n    ")]}},{key:"card_price",fn:function(t){return[e._v("\n      "+e._s(t)+"\n    ")]}},{key:"sell_price",fn:function(t){return[e._v("\n      "+e._s(t)+"\n    ")]}},{key:"consumption_range",fn:function(t,a){return[t.id===e.CONSUMPTION_RANGE.GENERAL_STORE?n("a",{directives:[{name:"modal-link",rawName:"v-modal-link",value:{name:"card-brand-deposit-shop-table",props:{id:a.id,type:"Consume",title:"支持消费门店"}},expression:"{\n          name: 'card-brand-deposit-shop-table',\n          props: { id: record.id, type: 'Consume', title: '支持消费门店' }\n        }"}]},[e._v("\n        "+e._s(t.name)+"\n      ")]):n("span",{staticClass:"use_num"},[e._v(e._s(t.name))])]}},{key:"sell_time",fn:function(t,n){return[e._v("\n      "+e._s(n.start_time)+" ~ "+e._s(n.end_time)+"\n    ")]}},{key:"publish_channel",fn:function(t){return[e._v("\n      "+e._s(t.name)+"\n    ")]}},{key:"action",fn:function(t,a){return n("div",{},[n("st-table-actions",[a.auth["brand:product:deposit_card|get"]?n("router-link",{attrs:{to:{path:"/brand/product/card/deposit/info",query:{id:a.id}}}},[e._v("\n          详情\n        ")]):e._e(),a.auth["brand:product:deposit_card|down"]?n("a",{on:{click:function(t){return e.onShelfDown(a)}}},[e._v("\n          下架\n        ")]):e._e()],1)],1)}}])})],1)},s=[],r=(n("8e6e"),n("456d"),n("6762"),n("2fdb"),n("bd86")),i=(n("6b54"),n("ac6a"),n("a246")),o=function(){return[{title:"售卖门店",dataIndex:"shop_name",fixed:"left",width:175,scopedSlots:{customRender:"shop_name"}},{title:"储值卡名称",dataIndex:"card_name",width:175,scopedSlots:{customRender:"card_name"}},{title:"有效期",dataIndex:"num",scopedSlots:{customRender:"num"}},{title:"储值金额(元)",dataIndex:"card_price",scopedSlots:{customRender:"card_price"}},{title:"售卖价格(元)",dataIndex:"sell_price",scopedSlots:{customRender:"sell_price"}},{title:"支持消费门店",dataIndex:"consumption_range",width:175,scopedSlots:{customRender:"consumption_range"}},{title:"售卖时间",dataIndex:"sell_time",scopedSlots:{customRender:"sell_time"}},{title:"发布渠道",dataIndex:"publish_channel",scopedSlots:{customRender:"publish_channel"}},{title:"操作",dataIndex:"action",fixed:"right",width:140,scopedSlots:{customRender:"action"}}]},c=n("ea3e"),l=n("bb56"),d=n("030a");function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h={mixins:[c["a"]],name:"PageBrandProductDepositShelves",bem:{shelves:"page-brand-product-deposit-list-shelves"},modals:{CardBrandDepositShopTable:l["a"]},serviceInject:function(){return{shelvesService:i["ShelvesService"]}},rxState:function(){return{shopList:this.shelvesService.shopList$,publishChannel:this.shelvesService.publishChannel$,cardList:this.shelvesService.list$,page:this.shelvesService.page$,loading:this.shelvesService.loading$,auth:this.shelvesService.auth$}},data:function(){return{CONSUMPTION_RANGE:d["b"]}},computed:{list:function(){var e=[];return this.cardList.forEach((function(t){var n=parseInt(999999*Math.random()).toString();e.push(p({},t,{key:n}))})),e},columns:o},methods:{filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().includes(e)},onBatchShelfDown:function(){var e=this,t=[];this.selectedRows.forEach((function(e){t.push({card_id:e.id,shop_id:e.shop_id})})),this.$confirm({title:"批量下架",content:"确定下架所选的".concat(this.selectedRowKeys.length,"张").concat(this.$c("member_card"),"吗？"),onOk:function(){return e.shelvesService.setCardShelfDown({card_shop:t}).toPromise().then((function(){e.onSelectionReset(),e.onSearch()}))}})},onShelfDown:function(e){var t=this;this.$confirm({title:"单个下架",content:"确定下架".concat(e.card_name).concat(this.$c("member_card"),"吗？"),onOk:function(){return t.shelvesService.setCardShelfDown({card_shop:[{card_id:e.id,shop_id:e.shop_id}]}).toPromise().then((function(){t.onSearch()}))}})}}},f=h,m=n("2877"),b=Object(m["a"])(f,a,s,!1,null,null,null);t["default"]=b.exports}}]);