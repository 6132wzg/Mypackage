{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-3!/Users/wangzhigang/Desktop/styd/web/src/services/qq-map.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/services/qq-map.service.ts","mtime":1594718339827},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { Injectable } from 'vue-service-app';\nimport { Observable } from 'rxjs';\nimport { AppConfig } from '@/constants/config';\n/**\n * 腾讯地图\n */\n\nvar QqMapService = /*#__PURE__*/function () {\n  function QqMapService(appConfig) {\n    _classCallCheck(this, QqMapService);\n\n    this.appConfig = appConfig;\n    this.isCreated = false;\n    this.lat = null;\n    this.lng = null;\n    this.mapObject = null;\n    this.markerObject = null;\n  }\n\n  _createClass(QqMapService, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      this.lat = params.lat;\n      this.lng = params.lng;\n      return new Promise(function (resolve) {\n        if (!_this.isCreated) {\n          _this.create().then(function () {\n            _this.initMap();\n\n            resolve();\n          });\n        } else {\n          _this.initMap();\n\n          resolve();\n        }\n      });\n    }\n  }, {\n    key: \"create\",\n    value: function create() {\n      var _this2 = this;\n\n      return new Promise(function (resolve) {\n        // @ts-ignore\n        window.initQqMap = function () {\n          _this2.isCreated = true;\n          resolve();\n        };\n\n        var script = document.createElement('script');\n        script.src = \"https://map.qq.com/api/js?v=2.exp&key=\".concat(_this2.appConfig.QQ_MAP_KEY, \"&libraries=place&callback=initQqMap\"); // @ts-ignore\n\n        document.head.appendChild(script);\n      });\n    }\n    /**\n     * 实例化地图\n     */\n\n  }, {\n    key: \"initMap\",\n    value: function initMap() {\n      // @ts-ignore\n      var center = new qq.maps.LatLng(this.lat, this.lng); // @ts-ignore\n\n      this.mapObject = new qq.maps.Map(document.getElementById('mapcontainer'), {\n        center: center,\n        zoom: 13,\n        disableDefaultUI: true\n      });\n      this.resetMap(center);\n    }\n    /**\n     * 重置地图\n     * @param position\n     */\n\n  }, {\n    key: \"resetMap\",\n    value: function resetMap(position) {\n      console.log('reset', position); // @ts-ignore\n\n      var anchor = new qq.maps.Point(8, 16); // @ts-ignore\n\n      var size = new qq.maps.Size(16, 16); // @ts-ignore\n\n      var origin = new qq.maps.Point(0, 0); // @ts-ignore\n\n      var icon = new qq.maps.MarkerImage(require('@/assets/img/map_location.png'), size, origin, anchor, size); // @ts-ignore\n\n      this.markerObject && this.markerObject.setMap(null); // @ts-ignore\n\n      this.markerObject = new qq.maps.Marker({\n        position: position,\n        icon: icon,\n        // @ts-ignore\n        animation: qq.maps.MarkerAnimation.DROP,\n        map: this.mapObject\n      }); // @ts-ignore\n\n      this.mapObject.panTo(position);\n    }\n  }, {\n    key: \"getLocation\",\n    value: function getLocation(url) {\n      var index = 0;\n      var o$ = new Observable(function (observer) {\n        index++;\n        var key = '__jsonp_callback' + index;\n        var script = document.createElement('script');\n        script.src = url + key;\n\n        script.onerror = function (err) {\n          return observer.error(err);\n        }; // @ts-ignore\n\n\n        window[key] = function (response) {\n          // @ts-ignore\n          script.parentNode.removeChild(script); // @ts-ignore\n\n          delete window[key];\n          observer.next(response);\n          observer.complete();\n        };\n\n        document.getElementsByTagName('head')[0].appendChild(script);\n        index = 0;\n      });\n      return o$;\n    }\n  }]);\n\n  return QqMapService;\n}();\n\nQqMapService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof AppConfig !== \"undefined\" && AppConfig) === \"function\" ? _a : Object])], QqMapService);\nexport { QqMapService };",null]}