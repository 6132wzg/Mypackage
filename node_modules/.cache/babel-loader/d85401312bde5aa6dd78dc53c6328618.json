{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/store/add.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/store/add.vue","mtime":1597396800008},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.to-string\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { ruleOptions, skuColumns } from \"./add.config\";\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue';\nimport StEditor from '@/views/biz-components/st/editor/editor.vue';\nimport StoreClassManage from '@/views/biz-modals/store/class-manage.vue';\nimport { PatternService } from '@/services/pattern.service';\nimport { AddService } from \"./add.service.ts\";\nimport StoreAddSku from '@/views/biz-modals/store/add-sku';\nimport { result } from 'lodash-es';\nimport { UserService } from '@/services/user.service';\nimport { cloneDeep } from 'lodash-es';\nexport default {\n  bem: {\n    basic: 'shop-store-add',\n    skuItem: 'sku-item'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      pattern: PatternService,\n      addService: AddService,\n      userService: UserService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.addService.loading$,\n      saleType: this.userService.getOptions$('cloud_store.sale_type'),\n      shippingMode: this.userService.getOptions$('cloud_store.shipping_mode'),\n      shelvesStatus: this.userService.getOptions$('cloud_store.edit_shelves_status')\n    };\n  },\n  modals: {\n    StoreClassManage: StoreClassManage,\n    StoreAddSku: StoreAddSku\n  },\n  props: {\n    isEditMode: {\n      type: Boolean,\n      default: false\n    },\n    info: {\n      type: Object,\n      default: function _default() {}\n    }\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      cropperModal: {\n        cropper: {\n          aspectRatio: 1\n        }\n      },\n      name: '',\n      // 商品名称\n      isMore: 1,\n      // 是否是多规格\n      tableData: [{\n        market_price: '',\n        selling_price: '',\n        stock_amount: '',\n        key: parseInt(Math.random() * 999999).toString()\n      }],\n      skuList: [],\n      content: '',\n      isEditor: false,\n      fileList: [],\n      // 商品图片组件中\n      imgList: [],\n      //上传的图片\n      isImgError: false,\n      shelves_status: 1,\n      product_images_del: [],\n      product_images_add: [],\n      classList: [],\n      tableErr: false,\n      tableTips: '',\n      isChoose: false,\n      isDisabledCourier: false\n    };\n  },\n  components: {\n    StEditor: StEditor,\n    StImageUpload: StImageUpload\n  },\n  computed: {\n    skuColumns: skuColumns,\n    sku: function sku() {\n      var list = [];\n      this.skuList.forEach(function (item, index) {\n        var skuItem = {\n          title: item.spec_name,\n          dataIndex: index\n        };\n        list.push(skuItem);\n      });\n      return list;\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    this.addService.getList().subscribe(function (res) {\n      _this.classList = res.list;\n    });\n\n    if (this.isEditMode) {\n      this.goodDetail();\n    }\n  },\n  methods: {\n    changeSale: function changeSale(event) {\n      var type = this.form.getFieldValue('delivery_type');\n      var deliveryType = [];\n\n      if (event.indexOf(1) !== -1) {\n        this.isChoose = true;\n\n        if (type !== undefined) {\n          deliveryType = type;\n        }\n\n        if (deliveryType.indexOf(1) === -1) {\n          deliveryType.push(1);\n          this.form.setFieldsValue({\n            delivery_type: deliveryType\n          });\n        }\n      } else {\n        this.isChoose = false;\n      }\n\n      if (event.indexOf(1) !== -1 && event.indexOf(2) === -1) {\n        this.isDisabledCourier = true;\n      } else {\n        this.isDisabledCourier = false;\n      }\n    },\n    // 保存\n    onSubmit: function onSubmit() {\n      var _this2 = this;\n\n      var isReturn = false;\n      var tableError = false;\n\n      if (!this.imgList.length) {\n        this.isReturn = true;\n        this.isImgError = true;\n      }\n\n      this.skuList.forEach(function (item) {\n        item.isErr = false;\n        item.isNameErr = false;\n\n        if (!item.spec_item_name.length) {\n          item.isErr = true;\n          isReturn = true;\n        }\n\n        if (!item.spec_name) {\n          item.isNameErr = true;\n          isReturn = true;\n        }\n      });\n      this.tableData.forEach(function (item) {\n        if (!item.market_price || !item.selling_price || !_this2.isEditMode && !item.stock_amount) {\n          tableError = true;\n          _this2.tableTips = '请正确填写表格';\n          _this2.tableErr = true;\n          isReturn = true;\n        }\n      });\n\n      if (!tableError) {\n        this.tableTips = '';\n        this.tableErr = false;\n      }\n\n      this.form.validate().then(function (values) {\n        if (isReturn) {\n          return;\n        }\n\n        if (_this2.isEditMode) {\n          _this2.editGoodOld(values);\n        } else {\n          _this2.addGoodNew(values);\n        }\n      });\n    },\n    addGoodNew: function addGoodNew(values) {\n      var _this3 = this;\n\n      var data = {};\n      var product_sku = [];\n      var spec_name_arr = [];\n      this.tableData.forEach(function (item, index) {\n        var skuItem = {};\n        skuItem.market_price = item.market_price;\n        skuItem.selling_price = item.selling_price;\n        skuItem.stock_amount = item.stock_amount;\n        skuItem.spec_arr = [];\n\n        if (_this3.skuList.length > 0) {\n          skuItem.spec_arr.push({\n            spec_name: _this3.skuList[0].spec_name,\n            spec_item_name: item['0']\n          });\n        }\n\n        if (_this3.skuList.length > 1) {\n          skuItem.spec_arr.push({\n            spec_name: _this3.skuList[1].spec_name,\n            spec_item_name: item['1']\n          });\n        }\n\n        if (_this3.skuList.length > 2) {\n          skuItem.spec_arr.push({\n            spec_name: _this3.skuList[2].spec_name,\n            spec_item_name: item['2']\n          });\n        }\n\n        product_sku.push(skuItem);\n      });\n      this.skuList.forEach(function (item) {\n        spec_name_arr.push(item.spec_name);\n      });\n      data = {\n        product_images: this.imgList,\n        // 商品图片\n        product_intro: this.content,\n        // 商品介绍\n        product_sku: product_sku,\n        // 规格设置\n        shelves_status: this.shelves_status,\n        // 上架状态\n        product_name: values.product_name,\n        // 商品名称\n        category_id: values.category_id,\n        // 分类id\n        delivery_type: values.delivery_type.length === this.shippingMode.length ? -1 : values.delivery_type[0],\n        // 配送方式\n        sale_type: values.sale_type.length === this.saleType.length ? -1 : values.sale_type[0],\n        // 售卖方式\n        spec_name_arr: spec_name_arr\n      };\n      this.addService.addGoods(data).subscribe(function (res) {\n        _this3.$router.push({\n          path: './list'\n        });\n      });\n    },\n    editGoodOld: function editGoodOld(values) {\n      var _this4 = this;\n\n      var data = {};\n      var product_sku = [];\n      this.tableData.forEach(function (item, index) {\n        var skuItem = {};\n        skuItem.market_price = item.market_price;\n        skuItem.selling_price = item.selling_price;\n        skuItem.stock_amount = item.stock_amount;\n\n        if (item.sku_id) {\n          skuItem.is_update = item.is_update;\n          skuItem.sku_id = item.sku_id;\n        }\n\n        skuItem.spec_arr = [];\n\n        if (_this4.skuList.length > 0) {\n          var sku = {};\n\n          _this4.info.all_spec[0].spec_item_arr.forEach(function (spec) {\n            sku.spec_id = _this4.info.all_spec[0].spec_id;\n\n            if (spec.spec_item_name === item['0']) {\n              sku.spec_item_id = spec.spec_item_id;\n            }\n          });\n\n          sku.spec_name = _this4.skuList[0].spec_name;\n          sku.spec_item_name = item['0'];\n          skuItem.spec_arr.push(sku);\n        }\n\n        if (_this4.skuList.length > 1) {\n          var _sku = {};\n\n          _this4.info.all_spec[1].spec_item_arr.forEach(function (spec) {\n            _sku.spec_id = _this4.info.all_spec[1].spec_id;\n\n            if (spec.spec_item_name === item['1']) {\n              _sku.spec_item_id = spec.spec_item_id;\n            }\n          });\n\n          _sku.spec_name = _this4.skuList[1].spec_name;\n          _sku.spec_item_name = item['1'];\n          skuItem.spec_arr.push(_sku);\n        }\n\n        if (_this4.skuList.length > 2) {\n          var _sku2 = {};\n\n          _this4.info.all_spec[2].spec_item_arr.forEach(function (spec) {\n            _sku2.spec_id = _this4.info.all_spec[2].spec_id;\n\n            if (spec.spec_item_name === item['2']) {\n              _sku2.spec_item_id = spec.spec_item_id;\n            }\n          });\n\n          _sku2.spec_name = _this4.skuList[2].spec_name;\n          _sku2.spec_item_name = item['2'];\n          skuItem.spec_arr.push(_sku2);\n        }\n\n        product_sku.push(skuItem);\n      });\n      data = {\n        product_images_del: this.product_images_del,\n        // 商品图片\n        product_images_add: this.imgList.filter(function (item) {\n          return item.isNew;\n        }),\n        // 商品图片\n        product_intro: this.content,\n        // 商品介绍\n        product_sku: product_sku,\n        // 规格设置\n        shelves_status: this.shelves_status,\n        // 上架状态\n        product_name: values.product_name,\n        // 商品名称\n        category_id: values.category_id,\n        // 分类id\n        delivery_type: values.delivery_type.length === this.shippingMode.length ? -1 : values.delivery_type[0],\n        // 配送方式\n        sale_type: values.sale_type.length === this.saleType.length ? -1 : values.sale_type[0] // 售卖方式\n\n      };\n      this.addService.editGoods(this.$route.query.id, data).subscribe(function (res) {\n        _this4.$router.push({\n          path: './list'\n        });\n      });\n    },\n    goodDetail: function goodDetail() {\n      var _this5 = this;\n\n      this.form.setFieldsValue({\n        product_name: this.info.product_name,\n        category_id: this.info.category_id,\n        delivery_type: this.info.delivery_type === -1 ? this.shippingMode.map(function (item) {\n          return item.value;\n        }) : [this.info.delivery_type],\n        sale_type: this.info.sale_type === -1 ? this.saleType.map(function (item) {\n          return item.value;\n        }) : [this.info.sale_type]\n      });\n      this.name = this.info.product_name;\n      this.isMore = this.info.all_spec ? 2 : 1;\n      this.imgList = this.info.product_images;\n      this.content = this.info.product_intro;\n      this.shelves_status = this.info.shelves_status;\n      this.skuList = [];\n\n      if (this.info.all_spec) {\n        this.info.all_spec.forEach(function (item) {\n          var list = [];\n\n          if (item.spec_item_arr) {\n            item.spec_item_arr.forEach(function (it) {\n              list.push(it.spec_item_name);\n            });\n\n            _this5.skuList.push({\n              spec_name: item.spec_name,\n              spec_item_name: list,\n              isErr: false,\n              isNameErr: false\n            });\n          }\n        });\n      }\n\n      var tableData = [];\n      this.info.product_sku.forEach(function (item, index) {\n        var tableItem = {};\n        tableItem.market_price = item.market_price;\n        tableItem.selling_price = item.selling_price;\n        tableItem.stock_amount = item.stock_amount;\n        tableItem.sku_id = item.sku_id;\n        tableItem.is_update = 0;\n        tableItem.key = parseInt(Math.random() * 999999).toString();\n\n        if (item.spec_arr) {\n          item.spec_arr.forEach(function (item, index) {\n            tableItem[index] = item.spec_item_name;\n          });\n        }\n\n        tableData.push(tableItem);\n      });\n      this.tableData = tableData;\n    },\n    // 为了同步字数\n    changeName: function changeName(e) {\n      this.name = e.target.value;\n    },\n    delImg: function delImg(item, index) {\n      if (this.isEditMode && item.image_id) {\n        this.product_images_del.push(item.image_id);\n      }\n\n      this.imgList.splice(index, 1);\n    },\n    addSku: function addSku() {\n      this.skuList.push({\n        spec_name: '',\n        spec_item_name: [],\n        isErr: false,\n        isNameErr: false\n      });\n    },\n    addSkuItem: function addSkuItem(index) {\n      var _this6 = this;\n\n      this.$modalRouter.push({\n        name: 'store-add-sku',\n        props: {\n          list: this.skuList[index].spec_item_name\n        },\n        on: {\n          success: function success(result) {\n            _this6.skuList[index].spec_item_name.push(result);\n\n            _this6.changeTable();\n          }\n        }\n      });\n    },\n    delSkuItem: function delSkuItem(index, i) {\n      this.skuList[index].spec_item_name.splice(i, 1);\n      this.changeTable();\n    },\n    delSku: function delSku(index) {\n      this.skuList.splice(index, 1);\n\n      if (!this.skuList.length) {\n        this.isMore = 1;\n        this.tableData = [{\n          market_price: '',\n          selling_price: '',\n          stock_amount: '',\n          key: parseInt(Math.random() * 999999).toString()\n        }];\n      }\n    },\n    getImageUrl: function getImageUrl(imageUrl) {\n      var imgEl = \"<img src='\".concat(imageUrl.url, \"' width='400' height='400'>\");\n      this.content = this.content + imgEl;\n    },\n    onChangeEditor: function onChangeEditor() {\n      this.isEditor = this.content.length === 0;\n      return this.content.length === 0;\n    },\n    getImage: function getImage(data) {\n      var img = {\n        image_id: data[0].image_id,\n        image_key: data[0].image_key,\n        image_url: data[0].image_url,\n        is_cover: 0\n      };\n      this.imgList.push(img);\n\n      if (this.isEditMode) {\n        img.isNew = true;\n      }\n\n      this.isImgError = false;\n      this.fileList = [];\n    },\n    // 规格发生改变时列表数据相应改变\n    changeTable: function changeTable() {\n      var list = [];\n      var skuList = [];\n      this.skuList.forEach(function (item, index) {\n        if (item.spec_item_name.length !== 0) {\n          skuList.push(item);\n        }\n      });\n      skuList[0].spec_item_name.forEach(function (item, index) {\n        var skuItem = {\n          market_price: '',\n          selling_price: '',\n          stock_amount: ''\n        };\n        skuItem['0'] = item;\n\n        if (skuList[1] && skuList[1].spec_item_name.length) {\n          skuList[1].spec_item_name.forEach(function (ite, inde) {\n            skuItem['1'] = ite;\n\n            if (skuList[2] && skuList[2].spec_item_name.length) {\n              skuList[2].spec_item_name.forEach(function (it, ind) {\n                skuItem['2'] = it;\n                list.push(cloneDeep(skuItem));\n              });\n            } else {\n              list.push(cloneDeep(skuItem));\n            }\n          });\n        } else {\n          list.push(cloneDeep(skuItem));\n        }\n      });\n      list.forEach(function (o) {\n        o.key = parseInt(Math.random() * 999999).toString();\n      });\n      this.tableData = list;\n      console.log(this.tableData, 'tableDatatableData');\n    },\n    openClass: function openClass() {\n      var _this7 = this;\n\n      this.$modalRouter.push({\n        name: 'store-class-manage',\n        props: {\n          shopList: 1\n        },\n        on: {\n          success: function success(res) {\n            _this7.addService.getList().subscribe(function (res) {\n              _this7.classList = res.list;\n\n              var data = _this7.form.getFieldsValue();\n\n              if (!_this7.classList.some(function (item) {\n                return item.id === data.category_id;\n              })) {\n                _this7.form.setFieldsValue({\n                  category_id: ''\n                });\n              }\n            });\n          }\n        }\n      });\n    },\n    changeMore: function changeMore() {\n      this.skuList = [];\n      this.tableData = [{\n        market_price: '',\n        selling_price: '',\n        stock_amount: '',\n        key: parseInt(Math.random() * 999999).toString()\n      }];\n    },\n    allApply: function allApply(attr, value) {\n      this.tableData.map(function (item) {\n        return item[attr] = value;\n      });\n    }\n  }\n};",null]}