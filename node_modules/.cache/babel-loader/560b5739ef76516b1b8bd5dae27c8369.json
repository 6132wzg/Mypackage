{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/invitation/index/setting.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/invitation/index/setting.vue","mtime":1600926556137},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { SettingService } from \"./setting.service\";\nimport { cloneDeep } from 'lodash-es';\nimport { IndexService } from \"../index.service\";\nimport StInvitationBgRadio from \"./components#/invitation-bg-radio\";\nimport MarketingAddCoupon from '@/views/biz-modals/marketing/add-coupon';\nimport CouponTag from '@/views/biz-components/plugin/coupon-tag/coupon-tag';\nexport default {\n  name: 'PageBrandMarketingInviationSetting',\n  bem: {\n    inviation: 'page-brand-marketing-inviation-setting'\n  },\n  modals: {\n    MarketingAddCoupon: MarketingAddCoupon\n  },\n  serviceInject: function serviceInject() {\n    return {\n      settingService: SettingService,\n      indexService: IndexService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      isOpen: this.indexService.isOpen$,\n      loading: this.settingService.loading$,\n      settingInfo: this.settingService.settingInfo$,\n      pluginStatus: this.settingService.pluginStatus$,\n      auth: this.settingService.auth$\n    };\n  },\n  data: function data() {\n    return {\n      // 缓存settingInfo\n      settingInfoHistory: null,\n      form: this.$form.createForm(this),\n      // 活动状态\n      openStatus: 1,\n      // 邀请人\n      inviteeCoupon: {},\n      inviteeHelpText: '',\n      inviteeCouponNum: undefined,\n      // 被邀请人\n      inviterCoupon: {},\n      inviterHelpText: '',\n      inviterCouponNum: undefined,\n      // 邀请海报\n      invite_poster: {\n        image_id: 0,\n        image_key: 'image/VZ0RGBwTX7FA1yKb.png',\n        image_url: '',\n        index: 1\n      },\n      gift_points: false,\n      points_per_time: 0,\n      day_points_limit: 0\n    };\n  },\n  computed: {\n    inviteeIsOk: function inviteeIsOk() {\n      return this.inviteeHelpText === '';\n    },\n    inviterIsOk: function inviterIsOk() {\n      return this.inviterHelpText === '';\n    }\n  },\n  watch: {\n    settingInfo: {\n      deep: true,\n      handler: function handler() {\n        this.init();\n      }\n    }\n  },\n  methods: {\n    onConfigHandle: function onConfigHandle() {\n      this.$router.push({\n        path: '/brand/setting/mina/index'\n      });\n    },\n    init: function init() {\n      this.settingInfoHistory = cloneDeep(this.settingInfo);\n      this.inviteeHelpText = '';\n      this.inviterHelpText = '';\n      this.openStatus = this.settingInfo.activity_status === 1 ? 1 : 0;\n      this.gift_points = this.settingInfo.gift_points === 1;\n      this.points_per_time = this.settingInfo.points_per_time;\n      this.day_points_limit = this.settingInfo.day_points_limit;\n\n      if (this.settingInfo.invitee_coupon_id) {\n        // 开启过，需要回显\n        this.inviterCoupon = {\n          id: this.settingInfo.inviter_coupon_id,\n          coupon_name: this.settingInfo.inviter_coupon_name\n        };\n        this.inviterCouponNum = this.settingInfo.inviter_coupon_num;\n        this.inviteeCoupon = {\n          id: this.settingInfo.invitee_coupon_id,\n          coupon_name: this.settingInfo.invitee_coupon_name\n        };\n        this.inviteeCouponNum = this.settingInfo.invitee_coupon_num;\n        this.invite_poster = this.settingInfo.invite_poster;\n      }\n    },\n    // 开关\n    onOpenStatusChange: function onOpenStatusChange(data) {\n      var _this = this;\n\n      if (!data && this.settingInfoHistory.activity_status === 1 && this.settingInfoHistory.invitee_coupon_id) {\n        this.$confirm({\n          title: '提示',\n          content: \"\\u4E00\\u65E6\\u5173\\u95ED\\uFF0C\\u5168\\u90E8\\u63A8\\u5E7F\\u529F\\u80FD\\u5C06\\u5931\\u6548\\uFF0C\\u8BF7\\u8C28\\u614E\\u64CD\\u4F5C\\u3002\",\n          onCancel: function onCancel() {\n            _this.openStatus = 1;\n          },\n          onOk: function onOk() {\n            var params = _objectSpread({}, _this.settingInfoHistory, {\n              activity_status: 2\n            });\n\n            return _this.settingService.edit(params).toPromise().then(function () {\n              // 关闭成功\n              _this.$router.push({\n                path: '/brand/marketing/plugin/invitation/index/data'\n              }); // this.$router.reload()\n\n            });\n          }\n        });\n      }\n    },\n    // onPointsChange(e) {\n    //   console.log(e.target)\n    //   this.isOpenPoints = e.target.checked\n    // },\n    // 校验\n    onValidate: function onValidate(type) {\n      if (!this[\"\".concat(type, \"Coupon\")]) {\n        this[\"\".concat(type, \"HelpText\")] = '请选择优惠券';\n        return;\n      }\n\n      if (!this[\"\".concat(type, \"CouponNum\")]) {\n        this[\"\".concat(type, \"HelpText\")] = '请输入优惠券数量';\n        return;\n      }\n\n      this[\"\".concat(type, \"HelpText\")] = '';\n    },\n    // 新增券\n    onAddCoupon: function onAddCoupon(type) {\n      var _this2 = this;\n\n      this.$modalRouter.push({\n        name: 'marketing-add-coupon',\n        on: {\n          success: function success(res) {\n            _this2[\"\".concat(type, \"Coupon\")] = cloneDeep(res.coupon);\n          }\n        }\n      });\n    },\n    onEditCoupon: function onEditCoupon(type) {\n      var _this3 = this;\n\n      this.$modalRouter.push({\n        name: 'marketing-add-coupon',\n        props: {\n          id: this[\"\".concat(type, \"Coupon\")].id\n        },\n        on: {\n          success: function success(res) {\n            _this3[\"\".concat(type, \"Coupon\")] = cloneDeep(res.coupon);\n          }\n        }\n      });\n    },\n    onClose: function onClose(type) {\n      this[\"\".concat(type, \"Coupon\")] = {};\n    },\n    onSubmit: function onSubmit() {\n      var _this4 = this;\n\n      this.onValidate('invitee');\n      this.onValidate('inviter');\n\n      if (this.inviteeIsOk && this.inviterIsOk) {\n        var fn = this.isOpen ? 'edit' : 'add';\n        console.log(fn);\n        this.settingService[fn]({\n          activity_status: this.openStatus ? 1 : 2,\n          // 邀请人\n          inviter_coupon_id: this.inviterCoupon.id,\n          inviter_coupon_num: +this.inviterCouponNum,\n          // 被邀请人\n          invitee_coupon_id: this.inviteeCoupon.id,\n          invitee_coupon_num: +this.inviteeCouponNum,\n          invite_poster: this.invite_poster,\n          gift_points: this.gift_points ? 1 : 0,\n          points_per_time: +this.points_per_time || 0,\n          day_points_limit: +this.day_points_limit || 0\n        }).subscribe(function () {\n          _this4.$router.push({\n            path: './data'\n          });\n        });\n      }\n    }\n  },\n  created: function created() {\n    this.init();\n  },\n  components: {\n    StInvitationBgRadio: StInvitationBgRadio,\n    CouponTag: CouponTag\n  }\n};",{"version":3,"sources":["setting.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div :class=\"inviation()\">\n    <st-form :form=\"form\" labelWidth=\"108px\">\n      <st-form-item label=\"功能开关\" required v-if=\"auth.add\">\n        <st-switch v-model=\"openStatus\" @change=\"onOpenStatusChange\" />\n        <span class=\"mg-l12 mg-r12\">{{ openStatus ? '已' : '未' }}开启</span>\n        <span v-if=\"!openStatus\">\n          （一旦开启，将会在小程序展示，如需关闭，请谨慎操作。）\n        </span>\n      </st-form-item>\n      <template v-if=\"openStatus\">\n        <st-form-item label=\"成功规则\">\n          每邀请1人成功购买卡项或课程（成功支付）\n        </st-form-item>\n        <template v-if=\"!isOpen\">\n          <st-form-item label=\"邀请人奖励\" required :help=\"inviterHelpText\">\n            <div :class=\"inviation('coupon')\">\n              <span class=\"mg-r8\">可获得</span>\n              <st-input-number\n                :min=\"1\"\n                :max=\"99\"\n                v-model=\"inviterCouponNum\"\n                style=\"width:142px\"\n              >\n                <span slot=\"addonAfter\">张</span>\n              </st-input-number>\n              <span class=\"mg-l24 mg-r8\">选择券</span>\n              <template v-if=\"!inviterCoupon.id\">\n                <st-button icon=\"anticon:plus\" @click=\"onAddCoupon('inviter')\">\n                  新增券\n                </st-button>\n              </template>\n              <template v-else>\n                <coupon-tag\n                  key=\"1\"\n                  class=\"mg-r8\"\n                  :name=\"\n                    inviterCoupon.coupon_name ? inviterCoupon.coupon_name : ''\n                  \"\n                  @close=\"onClose('inviter')\"\n                />\n                <st-button @click=\"onEditCoupon('inviter')\">重新选择</st-button>\n              </template>\n            </div>\n          </st-form-item>\n          <st-form-item label=\"被邀请人奖励\" required :help=\"inviteeHelpText\">\n            <div :class=\"inviation('coupon')\">\n              <span class=\"mg-r8\">可获得</span>\n              <st-input-number\n                :min=\"1\"\n                :max=\"99\"\n                v-model=\"inviteeCouponNum\"\n                style=\"width:142px\"\n              >\n                <span slot=\"addonAfter\">张</span>\n              </st-input-number>\n              <span class=\"mg-l24 mg-r8\">选择券</span>\n              <template v-if=\"!inviteeCoupon.id\">\n                <st-button icon=\"anticon:plus\" @click=\"onAddCoupon('invitee')\">\n                  新增券\n                </st-button>\n              </template>\n              <template v-else>\n                <coupon-tag\n                  key=\"2\"\n                  class=\"mg-r8\"\n                  :name=\"\n                    inviteeCoupon.coupon_name ? inviteeCoupon.coupon_name : ''\n                  \"\n                  @close=\"onClose('invitee')\"\n                />\n                <st-button @click=\"onEditCoupon('invitee')\">重新选择</st-button>\n              </template>\n            </div>\n          </st-form-item>\n        </template>\n        <template v-else>\n          <st-form-item label=\"邀请人奖励\" required :help=\"inviterHelpText\">\n            <div :class=\"inviation('coupon')\">\n              <span class=\"mg-r8\">可获得</span>\n              <st-input-number\n                :min=\"1\"\n                :max=\"99\"\n                v-model=\"inviterCouponNum\"\n                style=\"width:142px\"\n              >\n                <span slot=\"addonAfter\">张</span>\n              </st-input-number>\n              <span class=\"mg-l24 mg-r8\">选择券</span>\n              <coupon-tag\n                class=\"mg-r8\"\n                :name=\"\n                  inviterCoupon.coupon_name ? inviterCoupon.coupon_name : ''\n                \"\n                key=\"3\"\n                @close=\"onEditCoupon('inviter')\"\n              />\n            </div>\n          </st-form-item>\n          <st-form-item label=\"被邀请人奖励\" required :help=\"inviteeHelpText\">\n            <div :class=\"inviation('coupon')\">\n              <span class=\"mg-r8\">可获得</span>\n              <st-input-number\n                :min=\"1\"\n                :max=\"99\"\n                v-model=\"inviteeCouponNum\"\n                style=\"width:142px\"\n              >\n                <span slot=\"addonAfter\">张</span>\n              </st-input-number>\n              <span class=\"mg-l24 mg-r8\">选择券</span>\n              <coupon-tag\n                class=\"mg-r8\"\n                :name=\"\n                  inviteeCoupon.coupon_name ? inviteeCoupon.coupon_name : ''\n                \"\n                key=\"3\"\n                @close=\"onEditCoupon('invitee')\"\n              />\n            </div>\n          </st-form-item>\n        </template>\n        <st-form-item label=\"邀请海报\">\n          <!-- <st-card-bg-radio v-model=\"banner\"/> -->\n          <st-invitation-bg-radio v-model=\"invite_poster\" />\n        </st-form-item>\n        <st-form-item label=\"邀请返积分\">\n          <div :class=\"inviation('integral')\">\n            <a-checkbox\n              v-model=\"gift_points\"\n              :disabled=\"pluginStatus.pointActivityAtatus !== 1\"\n            >\n              开启邀请返积分\n            </a-checkbox>\n            <template v-if=\"pluginStatus.pointActivityAtatus !== 1\">\n              <span :class=\"inviation('integral-condition-tips')\">\n                请先开启会员积分功能，\n              </span>\n              <st-link\n                _blank\n                :class=\"inviation('integral-condition-link')\"\n                value=\"去开启\"\n                :to=\"{\n                  path: '/brand/marketing/plugin/member-points/list/setting'\n                }\"\n              ></st-link>\n            </template>\n          </div>\n          <div :class=\"inviation('integral')\" class=\"mg-t12\" v-if=\"gift_points\">\n            每成功邀请一人注册可获取\n            <span style=\"width: 150px;padding: 0 10px\">\n              <st-input-number\n                v-model=\"points_per_time\"\n                width=\"150px\"\n                type=\"number\"\n                :min=\"1\"\n                :max=\"99999\"\n                :float=\"true\"\n                :disabled=\"pluginStatus.pointActivityAtatus !== 1\"\n                placeholder=\"请输入\"\n              >\n                <template slot=\"addonAfter\">\n                  积分\n                </template>\n              </st-input-number>\n            </span>\n            一天最多可获取\n            <span style=\"width: 150px;padding: 0 10px\">\n              <st-input-number\n                width=\"150px\"\n                v-model=\"day_points_limit\"\n                type=\"number\"\n                :min=\"1\"\n                :max=\"99999\"\n                :float=\"true\"\n                :disabled=\"pluginStatus.pointActivityAtatus !== 1\"\n                placeholder=\"请输入\"\n              >\n                <template slot=\"addonAfter\">\n                  积分\n                </template>\n              </st-input-number>\n            </span>\n          </div>\n        </st-form-item>\n        <st-form-item label-fix v-if=\"auth.edit\">\n          <st-button\n            type=\"primary\"\n            :loading=\"loading.edit || loading.add\"\n            @click=\"onSubmit\"\n          >\n            保存\n          </st-button>\n          <st-button @click=\"onConfigHandle\" class=\"mg-l16\">\n            配置到小程序\n          </st-button>\n        </st-form-item>\n      </template>\n    </st-form>\n  </div>\n</template>\n<script>\nimport { SettingService } from './setting.service'\nimport { cloneDeep } from 'lodash-es'\nimport { IndexService } from '../index.service'\nimport StInvitationBgRadio from './components#/invitation-bg-radio'\nimport MarketingAddCoupon from '@/views/biz-modals/marketing/add-coupon'\nimport CouponTag from '@/views/biz-components/plugin/coupon-tag/coupon-tag'\nexport default {\n  name: 'PageBrandMarketingInviationSetting',\n  bem: {\n    inviation: 'page-brand-marketing-inviation-setting'\n  },\n  modals: {\n    MarketingAddCoupon\n  },\n  serviceInject() {\n    return {\n      settingService: SettingService,\n      indexService: IndexService\n    }\n  },\n  rxState() {\n    return {\n      isOpen: this.indexService.isOpen$,\n      loading: this.settingService.loading$,\n      settingInfo: this.settingService.settingInfo$,\n      pluginStatus: this.settingService.pluginStatus$,\n      auth: this.settingService.auth$\n    }\n  },\n  data() {\n    return {\n      // 缓存settingInfo\n      settingInfoHistory: null,\n      form: this.$form.createForm(this),\n      // 活动状态\n      openStatus: 1,\n      // 邀请人\n      inviteeCoupon: {},\n      inviteeHelpText: '',\n      inviteeCouponNum: undefined,\n      // 被邀请人\n      inviterCoupon: {},\n      inviterHelpText: '',\n      inviterCouponNum: undefined,\n      // 邀请海报\n      invite_poster: {\n        image_id: 0,\n        image_key: 'image/VZ0RGBwTX7FA1yKb.png',\n        image_url: '',\n        index: 1\n      },\n      gift_points: false,\n      points_per_time: 0,\n      day_points_limit: 0\n    }\n  },\n  computed: {\n    inviteeIsOk() {\n      return this.inviteeHelpText === ''\n    },\n    inviterIsOk() {\n      return this.inviterHelpText === ''\n    }\n  },\n  watch: {\n    settingInfo: {\n      deep: true,\n      handler() {\n        this.init()\n      }\n    }\n  },\n  methods: {\n    onConfigHandle() {\n      this.$router.push({\n        path: '/brand/setting/mina/index'\n      })\n    },\n    init() {\n      this.settingInfoHistory = cloneDeep(this.settingInfo)\n      this.inviteeHelpText = ''\n      this.inviterHelpText = ''\n      this.openStatus = this.settingInfo.activity_status === 1 ? 1 : 0\n      this.gift_points = this.settingInfo.gift_points === 1\n      this.points_per_time = this.settingInfo.points_per_time\n      this.day_points_limit = this.settingInfo.day_points_limit\n      if (this.settingInfo.invitee_coupon_id) {\n        // 开启过，需要回显\n        this.inviterCoupon = {\n          id: this.settingInfo.inviter_coupon_id,\n          coupon_name: this.settingInfo.inviter_coupon_name\n        }\n        this.inviterCouponNum = this.settingInfo.inviter_coupon_num\n        this.inviteeCoupon = {\n          id: this.settingInfo.invitee_coupon_id,\n          coupon_name: this.settingInfo.invitee_coupon_name\n        }\n        this.inviteeCouponNum = this.settingInfo.invitee_coupon_num\n        this.invite_poster = this.settingInfo.invite_poster\n      }\n    },\n    // 开关\n    onOpenStatusChange(data) {\n      if (\n        !data &&\n        this.settingInfoHistory.activity_status === 1 &&\n        this.settingInfoHistory.invitee_coupon_id\n      ) {\n        this.$confirm({\n          title: '提示',\n          content: `一旦关闭，全部推广功能将失效，请谨慎操作。`,\n          onCancel: () => {\n            this.openStatus = 1\n          },\n          onOk: () => {\n            let params = { ...this.settingInfoHistory, activity_status: 2 }\n            return this.settingService\n              .edit(params)\n              .toPromise()\n              .then(() => {\n                // 关闭成功\n                this.$router.push({\n                  path: '/brand/marketing/plugin/invitation/index/data'\n                })\n                // this.$router.reload()\n              })\n          }\n        })\n      }\n    },\n    // onPointsChange(e) {\n    //   console.log(e.target)\n    //   this.isOpenPoints = e.target.checked\n    // },\n    // 校验\n    onValidate(type) {\n      if (!this[`${type}Coupon`]) {\n        this[`${type}HelpText`] = '请选择优惠券'\n        return\n      }\n      if (!this[`${type}CouponNum`]) {\n        this[`${type}HelpText`] = '请输入优惠券数量'\n        return\n      }\n      this[`${type}HelpText`] = ''\n    },\n    // 新增券\n    onAddCoupon(type) {\n      this.$modalRouter.push({\n        name: 'marketing-add-coupon',\n        on: {\n          success: res => {\n            this[`${type}Coupon`] = cloneDeep(res.coupon)\n          }\n        }\n      })\n    },\n    onEditCoupon(type) {\n      this.$modalRouter.push({\n        name: 'marketing-add-coupon',\n        props: {\n          id: this[`${type}Coupon`].id\n        },\n        on: {\n          success: res => {\n            this[`${type}Coupon`] = cloneDeep(res.coupon)\n          }\n        }\n      })\n    },\n    onClose(type) {\n      this[`${type}Coupon`] = {}\n    },\n    onSubmit() {\n      this.onValidate('invitee')\n      this.onValidate('inviter')\n      if (this.inviteeIsOk && this.inviterIsOk) {\n        let fn = this.isOpen ? 'edit' : 'add'\n        console.log(fn)\n        this.settingService[fn]({\n          activity_status: this.openStatus ? 1 : 2,\n          // 邀请人\n          inviter_coupon_id: this.inviterCoupon.id,\n          inviter_coupon_num: +this.inviterCouponNum,\n          // 被邀请人\n          invitee_coupon_id: this.inviteeCoupon.id,\n          invitee_coupon_num: +this.inviteeCouponNum,\n          invite_poster: this.invite_poster,\n          gift_points: this.gift_points ? 1 : 0,\n          points_per_time: +this.points_per_time || 0,\n          day_points_limit: +this.day_points_limit || 0\n        }).subscribe(() => {\n          this.$router.push({\n            path: './data'\n          })\n        })\n      }\n    }\n  },\n  created() {\n    this.init()\n  },\n  components: {\n    StInvitationBgRadio,\n    CouponTag\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/brand/marketing/plugin/invitation/index"}]}