{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/package/select-course.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/package/select-course.vue","mtime":1600926555875},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// TODO: 暂时是前端翻页，准备做后端翻页。\nimport tableMixin from '@/mixins/table.mixin';\nimport { columns } from \"./select-course.config\";\nimport { SelectCourseService } from \"./select-course.service\";\nimport { cloneDeep, uniqBy } from 'lodash';\nexport default {\n  name: 'ModalSelectCourse',\n  bem: {\n    course: 'biz-select-course'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      service: SelectCourseService\n    };\n  },\n  rxState: function rxState() {\n    var _this$service = this.service,\n        courseTypeOptions$ = _this$service.courseTypeOptions$,\n        page$ = _this$service.page$,\n        courseList$ = _this$service.courseList$,\n        loading$ = _this$service.loading$;\n    return {\n      courseTypeOptions$: courseTypeOptions$,\n      page$: page$,\n      courseList$: courseList$,\n      loading$: loading$\n    };\n  },\n  computed: {\n    columns: columns\n  },\n  mixins: [tableMixin],\n  data: function data() {\n    return {\n      show: false,\n      courseList: [],\n      selectedRowKeys: [],\n      searchData: {\n        search: '',\n        course_type: '',\n        use_range: 3,\n        use_shop_list: []\n      }\n    };\n  },\n  props: {\n    title: {\n      type: String,\n      default: '选择团课'\n    },\n    courseType: {\n      type: String,\n      default: ''\n    },\n    useRange: {\n      type: Number\n    },\n    useShopList: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    initDataSource: {\n      type: Array,\n      default: function _default() {\n        return [{\n          course_id: 1,\n          shop_id: 1,\n          shop_name: '常青一点都不帅，银鞍照白马，更换名字测11试，更换名字测12试，kael，kael1，关店测试，超超的三体云动门店，云云的门店测试',\n          course_name: '团体课测试',\n          course_category: '团体课程',\n          course_type: '团体课'\n        }, {\n          course_id: 2,\n          shop_id: 1,\n          shop_name: '银鞍照白马',\n          course_name: '团体课测试1',\n          course_category: '团体课程',\n          course_type: '团体课'\n        }, {\n          course_id: 5,\n          shop_id: 0,\n          shop_name: '银鞍照白马，更换名字测11试',\n          course_name: '新增团体课-测试',\n          course_category: '团体课程',\n          course_type: '团体课'\n        }];\n      }\n    }\n  },\n  methods: {\n    initSelectedRowKeys: function initSelectedRowKeys() {\n      this.selectedRows = cloneDeep(this.initDataSource);\n      this.selectedRowKeys = this.initDataSource.map(function (item) {\n        return item.course_id;\n      });\n    },\n    // 初始化搜索数据\n    initSearchData: function initSearchData() {\n      this.searchData = {\n        type: this.courseType,\n        platform: 'brand',\n        search: '',\n        course_type: -1,\n        use_range: this.useRange,\n        use_shop_list: this.useShopList\n      };\n    },\n    init: function init() {\n      this.initSelectedRowKeys();\n      this.initSearchData();\n      this.getCourseList();\n      this.getCourseTypeOptions();\n    },\n    onClear: function onClear() {\n      console.log('onClear');\n      this.onSelectionReset();\n    },\n    onSelectionChange: function onSelectionChange(selectedRowKeys, selectedRows) {\n      this.selectedRowKeys = selectedRowKeys; //  修复antd tablebug ，当搜索后返回的搜索之前selectedRows不会返回\n\n      this.selectedRows = uniqBy([].concat(_toConsumableArray(this.selectedRows), _toConsumableArray(selectedRows)), 'course_id');\n    },\n    // 请求课程列表\n    getCourseList: function getCourseList() {\n      return this.service.getCourseList(this.searchData).subscribe(function (res) {// 将已选中的数据与请求回来的列表比对，选中的默认勾上\n      });\n    },\n    getCourseTypeOptions: function getCourseTypeOptions() {\n      return this.service.getCourseTypeList().subscribe();\n    },\n    // 课程类型的选择\n    onChange: function onChange() {\n      this.getCourseList();\n    },\n    // 课程的模糊搜索\n    onSearch: function onSearch() {\n      this.getCourseList();\n    },\n    // 选中课程提交\n    onOk: function onOk() {\n      // 最后传出去的出去原来被选中的和重复应该过滤掉\n      var courseList = this.selectedRows;\n      this.$emit('done', courseList);\n      this.show = false;\n    }\n  },\n  created: function created() {\n    this.init();\n  }\n};",{"version":3,"sources":["select-course.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal :title=\"title\" @ok=\"onOk\" v-model=\"show\">\n    <div :class=\"course()\">\n      <div :class=\"course('search')\">\n        <div></div>\n        <div>\n          <a-select\n            :class=\"course('search-select')\"\n            v-model=\"searchData.course_type\"\n            :options=\"courseTypeOptions$\"\n            @change=\"onChange\"\n            style=\"width:148px\"\n            class=\"mg-r16\"\n          ></a-select>\n          <st-input-search\n            @search=\"onSearch\"\n            v-model=\"searchData.search\"\n            :class=\"course('search-input')\"\n            placeholder=\"搜索课程\"\n          />\n        </div>\n      </div>\n      <st-container class=\"mg-t16\">\n        <st-table\n          :columns=\"columns\"\n          :dataSource=\"courseList$\"\n          :simplePage=\"true\"\n          rowKey=\"course_id\"\n          :page=\"page$\"\n          :alertSelection=\"{ onReset: onClear }\"\n          :rowSelection=\"{ selectedRowKeys, onChange: onSelectionChange }\"\n          :loading=\"loading$.getCourseList\"\n          pageMode=\"client\"\n        >\n          <template slot=\"shop_name\" slot-scope=\"text\">\n            <st-overflow-text\n              :value=\"text\"\n              max-width=\"180px\"\n            ></st-overflow-text>\n          </template>\n        </st-table>\n      </st-container>\n    </div>\n  </st-modal>\n</template>\n\n<script>\n// TODO: 暂时是前端翻页，准备做后端翻页。\nimport tableMixin from '@/mixins/table.mixin'\nimport { columns } from './select-course.config'\nimport { SelectCourseService } from './select-course.service'\nimport { cloneDeep, uniqBy } from 'lodash'\nexport default {\n  name: 'ModalSelectCourse',\n  bem: {\n    course: 'biz-select-course'\n  },\n  serviceInject() {\n    return {\n      service: SelectCourseService\n    }\n  },\n  rxState() {\n    const { courseTypeOptions$, page$, courseList$, loading$ } = this.service\n    return { courseTypeOptions$, page$, courseList$, loading$ }\n  },\n  computed: {\n    columns\n  },\n  mixins: [tableMixin],\n  data() {\n    return {\n      show: false,\n      courseList: [],\n      selectedRowKeys: [],\n      searchData: {\n        search: '',\n        course_type: '',\n        use_range: 3,\n        use_shop_list: []\n      }\n    }\n  },\n  props: {\n    title: {\n      type: String,\n      default: '选择团课'\n    },\n    courseType: {\n      type: String,\n      default: ''\n    },\n    useRange: {\n      type: Number\n    },\n    useShopList: {\n      type: Array,\n      default: () => []\n    },\n    initDataSource: {\n      type: Array,\n      default: () => [\n        {\n          course_id: 1,\n          shop_id: 1,\n          shop_name:\n            '常青一点都不帅，银鞍照白马，更换名字测11试，更换名字测12试，kael，kael1，关店测试，超超的三体云动门店，云云的门店测试',\n          course_name: '团体课测试',\n          course_category: '团体课程',\n          course_type: '团体课'\n        },\n        {\n          course_id: 2,\n          shop_id: 1,\n          shop_name: '银鞍照白马',\n          course_name: '团体课测试1',\n          course_category: '团体课程',\n          course_type: '团体课'\n        },\n        {\n          course_id: 5,\n          shop_id: 0,\n          shop_name: '银鞍照白马，更换名字测11试',\n          course_name: '新增团体课-测试',\n          course_category: '团体课程',\n          course_type: '团体课'\n        }\n      ]\n    }\n  },\n  methods: {\n    initSelectedRowKeys() {\n      this.selectedRows = cloneDeep(this.initDataSource)\n      this.selectedRowKeys = this.initDataSource.map(item => item.course_id)\n    },\n    // 初始化搜索数据\n    initSearchData() {\n      this.searchData = {\n        type: this.courseType,\n        platform: 'brand',\n        search: '',\n        course_type: -1,\n        use_range: this.useRange,\n        use_shop_list: this.useShopList\n      }\n    },\n    init() {\n      this.initSelectedRowKeys()\n      this.initSearchData()\n      this.getCourseList()\n      this.getCourseTypeOptions()\n    },\n    onClear() {\n      console.log('onClear')\n      this.onSelectionReset()\n    },\n    onSelectionChange(selectedRowKeys, selectedRows) {\n      this.selectedRowKeys = selectedRowKeys\n      //  修复antd tablebug ，当搜索后返回的搜索之前selectedRows不会返回\n      this.selectedRows = uniqBy(\n        [...this.selectedRows, ...selectedRows],\n        'course_id'\n      )\n    },\n    // 请求课程列表\n    getCourseList() {\n      return this.service.getCourseList(this.searchData).subscribe(res => {\n        // 将已选中的数据与请求回来的列表比对，选中的默认勾上\n      })\n    },\n    getCourseTypeOptions() {\n      return this.service.getCourseTypeList().subscribe()\n    },\n    // 课程类型的选择\n    onChange() {\n      this.getCourseList()\n    },\n    // 课程的模糊搜索\n    onSearch() {\n      this.getCourseList()\n    },\n    // 选中课程提交\n    onOk() {\n      // 最后传出去的出去原来被选中的和重复应该过滤掉\n      let courseList = this.selectedRows\n      this.$emit('done', courseList)\n      this.show = false\n    }\n  },\n  created() {\n    this.init()\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/package"}]}