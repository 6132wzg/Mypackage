{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/shop/edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/shop/edit.vue","mtime":1600926556238},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { UserService } from '@/services/user.service'\nimport { EditService } from './edit.service'\nimport { PatternService } from '@/services/pattern.service'\nimport { cloneDeep } from 'lodash-es'\nimport CheckboxFacilityGroup from '@/views/biz-components/checkbox-facility/checkbox-facility-group'\nimport CheckboxFacilityItem from '@/views/biz-components/checkbox-facility/checkbox-facility-item'\nimport MapButton from '@/views/components/map-button#/map-button'\nimport ShopHourPicker from '@/views/components/hour-picker#/hour-picker'\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue'\nimport MoreInput from '@/views/components/more-input#/more-input.vue'\n\nexport default {\n  name: 'EditShopSetting',\n  components: {\n    CheckboxFacilityGroup,\n    CheckboxFacilityItem,\n    MapButton,\n    ShopHourPicker,\n    StImageUpload,\n    MoreInput\n  },\n  serviceInject() {\n    return {\n      pattern: PatternService,\n      editService: EditService,\n      userService: UserService\n    }\n  },\n  rxState() {\n    return {\n      serviceList: this.editService.serviceList$,\n      shopInfo: this.editService.shopInfo$,\n      editLoading: this.editService.loading$\n    }\n  },\n  mounted() {\n    this.init(this.shopInfo)\n  },\n  data() {\n    return {\n      editMap: {\n        lat: '',\n        lng: '',\n        address: '',\n        province: {},\n        city: {},\n        district: {}\n      },\n      fileList: [],\n      fileListHostiry: [],\n      cropperModal: {},\n      shopData: {\n        shop_name: '',\n        province_id: null,\n        city_id: null,\n        district_id: null,\n        address: '',\n        shop_phones: [],\n        shop_status: 1,\n        lat: '',\n        lng: '',\n        service_ids: [],\n        business_time: [],\n        email: '',\n        shop_images: []\n      },\n      shopCoverImageValidateText: '',\n      shopPhoneValidateText: '',\n      serviceIcon_icon_list: {\n        1: 'WIFI',\n        2: 'park',\n        3: 'shower',\n        4: 'medical',\n        5: 'heating',\n        6: 'snow',\n        7: 'nosmoking',\n        8: 'energy'\n      }\n    }\n  },\n  beforeCreate() {\n    this.form = this.$form.createForm(this)\n  },\n  computed: {\n    shopCoverImageIsOk() {\n      return this.shopCoverImageValidateText === ''\n    }\n  },\n  methods: {\n    // 获取门店信息\n    init(data) {\n      this.form.setFieldsValue({\n        shop_name: data.shop_name,\n        email: data.email\n      })\n      // 门店电话\n      this.shopData.shop_phones = cloneDeep(data.shop_phones)\n      // 门店地址\n      this.editMap.lat = data.lat\n      this.editMap.lng = data.lng\n      this.editMap.address = data.shop_position.address\n      this.editMap.province.id = data.shop_position.province_id\n      this.editMap.province.name = data.shop_position.province_name\n      this.editMap.city.id = data.shop_position.city_id\n      this.editMap.city.name = data.shop_position.city_name\n      this.editMap.district.id = data.shop_position.district_id\n      this.editMap.district.name = data.shop_position.district_name\n      // 服务设施\n      data.shop_services.forEach(i => {\n        this.shopData.service_ids.push(i.service_id)\n      })\n      // 店招\n      this.fileListHostiry = cloneDeep(data.shop_images)\n      this.fileList = cloneDeep(data.shop_images.filter(i => i.is_cover))\n      this.shopData.shop_images = cloneDeep(\n        data.shop_images.filter(i => i.is_cover)\n      )\n      // 营业状态\n      this.shopData.shop_status = data.shop_status\n      // 营业时间\n      this.shopData.business_time = data.business_time\n    },\n    // 校验店招是否已上传\n    shopCoverImageValidator() {\n      this.shopCoverImageValidateText = this.shopData.shop_images.length\n        ? ''\n        : '请上传店招'\n    },\n    // 校验门店电话是否输入\n    shopPhoneValidator() {\n      const length = this.shopData.shop_phones.filter(i => i).length\n      this.shopPhoneValidateText = length ? '' : '请输入门店电话'\n      return this.shopPhoneValidateText\n    },\n    fileChange(data) {\n      if (data.length) {\n        this.shopData.shop_images = cloneDeep(data)\n        this.shopData.shop_images[0].is_cover = 1\n      } else {\n        this.shopData.shop_images = []\n      }\n      this.shopCoverImageValidator()\n    },\n    editMapChange(data) {\n      this.editMap = cloneDeep(data)\n    },\n    onShopPhoneChange(list) {\n      this.shopData.shop_phones = list\n      this.shopPhoneValidator()\n    },\n    // 表单提交\n    onHandleSubmit(e) {\n      // 确认为提交表单校验\n      e.preventDefault()\n      this.shopCoverImageValidator()\n      this.form.validateFieldsAndScroll((err, values) => {\n        if (this.shopPhoneValidator()) {\n          return\n        }\n        if (!err && this.shopCoverImageIsOk) {\n          // 过滤空数据\n          this.shopData.shop_phones = this.shopData.shop_phones.filter(i => i)\n          this.shopData.shop_name = values.shop_name\n          this.shopData.province_id = this.editMap.province.id\n          this.shopData.province_name = this.editMap.province.name\n          this.shopData.city_id = this.editMap.city.id\n          this.shopData.city_name = this.editMap.city.name\n          this.shopData.district_id = this.editMap.district.id\n          this.shopData.district_name = this.editMap.district.name\n          this.shopData.address = this.editMap.address\n          this.shopData.lat = this.editMap.lat\n          this.shopData.lng = this.editMap.lng\n          this.shopData.email = values.email\n          // 替换店招\n          let i = 0\n          this.fileListHostiry.some((item, index) => {\n            if (item.is_cover) {\n              i = index\n            }\n          })\n          this.fileListHostiry.splice(i, 1)\n          this.fileListHostiry.unshift(...this.shopData.shop_images)\n          this.shopData.shop_images = cloneDeep(this.fileListHostiry)\n          this.editService\n            .edit(this.$searchQuery.id, this.shopData)\n            .subscribe(() => {\n              this.$router.push({\n                name: 'brand-setting-shop-list'\n              })\n            })\n        } else {\n        }\n      })\n    },\n    // shop_name validatorFn\n    shop_name_validator(rule, value, callback) {\n      if (value === undefined || !value) {\n        // eslint-disable-next-line\n        callback('请填写门店名称')\n      } else if (value && !this.pattern.CN_EN_NUM_SPACE('1-20').test(value)) {\n        // eslint-disable-next-line\n        callback('支持中英文、数字,不超过20个字')\n      } else {\n        // eslint-disable-next-line\n        callback()\n      }\n    }\n  }\n}\n",{"version":3,"sources":["edit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"edit.vue","sourceRoot":"src/views/pages/brand/setting/shop","sourcesContent":["<template>\n  <st-panel app class=\"page-brand-shop-edit\">\n    <st-form :form=\"form\">\n      <a-row :gutter=\"8\" class=\"page-edit-shop-name-row\">\n        <a-col offset=\"1\" :lg=\"10\">\n          <st-form-item label=\"门店名称\" required>\n            <a-input\n              v-decorator=\"[\n                'shop_name',\n                { rules: [{ validator: shop_name_validator }] }\n              ]\"\n              maxlength=\"20\"\n              placeholder=\"支持中英文、数字,不超过20个字\"\n            ></a-input>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item\n            label=\"门店电话\"\n            required\n            :help=\"shopPhoneValidateText\"\n            :validateStatus=\"shopPhoneValidateText ? 'error' : ''\"\n          >\n            <more-input\n              :length=\"3\"\n              :list=\"shopData.shop_phones\"\n              @change=\"onShopPhoneChange\"\n              placeholder=\"请输入门店电话\"\n            ></more-input>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"门店地址\" required>\n            <map-button\n              :lat=\"editMap.lat\"\n              :lng=\"editMap.lng\"\n              :address=\"editMap.address\"\n              :province=\"editMap.province\"\n              :city=\"editMap.city\"\n              :district=\"editMap.district\"\n              @select=\"editMapChange\"\n            ></map-button>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"邮箱\">\n            <a-input\n              v-decorator=\"[\n                'email',\n                {\n                  rules: [\n                    {\n                      type: 'email',\n                      message: '输入的邮箱格式错误，请重新输入!'\n                    }\n                  ]\n                }\n              ]\"\n              placeholder=\"请输入门店邮箱\"\n            ></a-input>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"23\">\n          <st-form-item label=\"服务设施\">\n            <checkbox-facility-group v-model=\"shopData.service_ids\">\n              <checkbox-facility-item\n                style=\"margin-right:24px\"\n                v-for=\"item in serviceList\"\n                :label=\"item.service_name\"\n                :icon=\"serviceIcon_icon_list[item.service_id]\"\n                :key=\"item.service_id\"\n                :value=\"item.service_id\"\n              ></checkbox-facility-item>\n            </checkbox-facility-group>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"23\">\n          <st-form-item\n            label=\"店招\"\n            v-viewer=\"{ url: 'data-src', toolbar: false }\"\n            required\n            validateStatus=\"error\"\n            :help=\"shopCoverImageValidateText\"\n          >\n            <st-image-upload\n              :cropperModal=\"cropperModal\"\n              :sizeLimit=\"5\"\n              :list=\"fileList\"\n              @change=\"fileChange\"\n              width=\"240px\"\n              height=\"135px\"\n            >\n              <a-icon type=\"plus\" />\n              <div class=\"page-upload-text\">上传店招</div>\n              <div class=\"page-upload-text\">大小不超过5M，建议尺寸16:9</div>\n            </st-image-upload>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"22\">\n          <st-form-item label=\"营业时间\">\n            <shop-hour-picker\n              v-model=\"shopData.business_time\"\n            ></shop-hour-picker>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"22\">\n          <st-form-item label=\" \">\n            <st-button\n              type=\"primary\"\n              @click=\"onHandleSubmit\"\n              :loading=\"editLoading.edit\"\n            >\n              提交\n            </st-button>\n          </st-form-item>\n        </a-col>\n      </a-row>\n    </st-form>\n  </st-panel>\n</template>\n<script>\nimport { UserService } from '@/services/user.service'\nimport { EditService } from './edit.service'\nimport { PatternService } from '@/services/pattern.service'\nimport { cloneDeep } from 'lodash-es'\nimport CheckboxFacilityGroup from '@/views/biz-components/checkbox-facility/checkbox-facility-group'\nimport CheckboxFacilityItem from '@/views/biz-components/checkbox-facility/checkbox-facility-item'\nimport MapButton from '@/views/components/map-button#/map-button'\nimport ShopHourPicker from '@/views/components/hour-picker#/hour-picker'\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue'\nimport MoreInput from '@/views/components/more-input#/more-input.vue'\n\nexport default {\n  name: 'EditShopSetting',\n  components: {\n    CheckboxFacilityGroup,\n    CheckboxFacilityItem,\n    MapButton,\n    ShopHourPicker,\n    StImageUpload,\n    MoreInput\n  },\n  serviceInject() {\n    return {\n      pattern: PatternService,\n      editService: EditService,\n      userService: UserService\n    }\n  },\n  rxState() {\n    return {\n      serviceList: this.editService.serviceList$,\n      shopInfo: this.editService.shopInfo$,\n      editLoading: this.editService.loading$\n    }\n  },\n  mounted() {\n    this.init(this.shopInfo)\n  },\n  data() {\n    return {\n      editMap: {\n        lat: '',\n        lng: '',\n        address: '',\n        province: {},\n        city: {},\n        district: {}\n      },\n      fileList: [],\n      fileListHostiry: [],\n      cropperModal: {},\n      shopData: {\n        shop_name: '',\n        province_id: null,\n        city_id: null,\n        district_id: null,\n        address: '',\n        shop_phones: [],\n        shop_status: 1,\n        lat: '',\n        lng: '',\n        service_ids: [],\n        business_time: [],\n        email: '',\n        shop_images: []\n      },\n      shopCoverImageValidateText: '',\n      shopPhoneValidateText: '',\n      serviceIcon_icon_list: {\n        1: 'WIFI',\n        2: 'park',\n        3: 'shower',\n        4: 'medical',\n        5: 'heating',\n        6: 'snow',\n        7: 'nosmoking',\n        8: 'energy'\n      }\n    }\n  },\n  beforeCreate() {\n    this.form = this.$form.createForm(this)\n  },\n  computed: {\n    shopCoverImageIsOk() {\n      return this.shopCoverImageValidateText === ''\n    }\n  },\n  methods: {\n    // 获取门店信息\n    init(data) {\n      this.form.setFieldsValue({\n        shop_name: data.shop_name,\n        email: data.email\n      })\n      // 门店电话\n      this.shopData.shop_phones = cloneDeep(data.shop_phones)\n      // 门店地址\n      this.editMap.lat = data.lat\n      this.editMap.lng = data.lng\n      this.editMap.address = data.shop_position.address\n      this.editMap.province.id = data.shop_position.province_id\n      this.editMap.province.name = data.shop_position.province_name\n      this.editMap.city.id = data.shop_position.city_id\n      this.editMap.city.name = data.shop_position.city_name\n      this.editMap.district.id = data.shop_position.district_id\n      this.editMap.district.name = data.shop_position.district_name\n      // 服务设施\n      data.shop_services.forEach(i => {\n        this.shopData.service_ids.push(i.service_id)\n      })\n      // 店招\n      this.fileListHostiry = cloneDeep(data.shop_images)\n      this.fileList = cloneDeep(data.shop_images.filter(i => i.is_cover))\n      this.shopData.shop_images = cloneDeep(\n        data.shop_images.filter(i => i.is_cover)\n      )\n      // 营业状态\n      this.shopData.shop_status = data.shop_status\n      // 营业时间\n      this.shopData.business_time = data.business_time\n    },\n    // 校验店招是否已上传\n    shopCoverImageValidator() {\n      this.shopCoverImageValidateText = this.shopData.shop_images.length\n        ? ''\n        : '请上传店招'\n    },\n    // 校验门店电话是否输入\n    shopPhoneValidator() {\n      const length = this.shopData.shop_phones.filter(i => i).length\n      this.shopPhoneValidateText = length ? '' : '请输入门店电话'\n      return this.shopPhoneValidateText\n    },\n    fileChange(data) {\n      if (data.length) {\n        this.shopData.shop_images = cloneDeep(data)\n        this.shopData.shop_images[0].is_cover = 1\n      } else {\n        this.shopData.shop_images = []\n      }\n      this.shopCoverImageValidator()\n    },\n    editMapChange(data) {\n      this.editMap = cloneDeep(data)\n    },\n    onShopPhoneChange(list) {\n      this.shopData.shop_phones = list\n      this.shopPhoneValidator()\n    },\n    // 表单提交\n    onHandleSubmit(e) {\n      // 确认为提交表单校验\n      e.preventDefault()\n      this.shopCoverImageValidator()\n      this.form.validateFieldsAndScroll((err, values) => {\n        if (this.shopPhoneValidator()) {\n          return\n        }\n        if (!err && this.shopCoverImageIsOk) {\n          // 过滤空数据\n          this.shopData.shop_phones = this.shopData.shop_phones.filter(i => i)\n          this.shopData.shop_name = values.shop_name\n          this.shopData.province_id = this.editMap.province.id\n          this.shopData.province_name = this.editMap.province.name\n          this.shopData.city_id = this.editMap.city.id\n          this.shopData.city_name = this.editMap.city.name\n          this.shopData.district_id = this.editMap.district.id\n          this.shopData.district_name = this.editMap.district.name\n          this.shopData.address = this.editMap.address\n          this.shopData.lat = this.editMap.lat\n          this.shopData.lng = this.editMap.lng\n          this.shopData.email = values.email\n          // 替换店招\n          let i = 0\n          this.fileListHostiry.some((item, index) => {\n            if (item.is_cover) {\n              i = index\n            }\n          })\n          this.fileListHostiry.splice(i, 1)\n          this.fileListHostiry.unshift(...this.shopData.shop_images)\n          this.shopData.shop_images = cloneDeep(this.fileListHostiry)\n          this.editService\n            .edit(this.$searchQuery.id, this.shopData)\n            .subscribe(() => {\n              this.$router.push({\n                name: 'brand-setting-shop-list'\n              })\n            })\n        } else {\n        }\n      })\n    },\n    // shop_name validatorFn\n    shop_name_validator(rule, value, callback) {\n      if (value === undefined || !value) {\n        // eslint-disable-next-line\n        callback('请填写门店名称')\n      } else if (value && !this.pattern.CN_EN_NUM_SPACE('1-20').test(value)) {\n        // eslint-disable-next-line\n        callback('支持中英文、数字,不超过20个字')\n      } else {\n        // eslint-disable-next-line\n        callback()\n      }\n    }\n  }\n}\n</script>\n"]}]}