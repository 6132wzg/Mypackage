{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/app/plugin/discount/components#/discount-form.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/app/plugin/discount/components#/discount-form.vue","mtime":1600926556097},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { MessageService } from '@/services/message.service'\nimport ProductSetting from '../../components#/product-setting.vue'\nimport FormMixin from '../../components#/form.mixin'\nimport { merge } from 'lodash'\nimport moment from 'moment'\nimport { ruleOptions } from './discount-form.config'\nexport default {\n  name: 'BrandAppPluginDiscountAdd',\n  mixins: [FormMixin],\n  components: {\n    ProductSetting\n  },\n  props: {\n    form: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    }\n  },\n  serviceInject() {\n    return {\n      messageService: MessageService\n    }\n  },\n  data() {\n    return {}\n  },\n  // 数据源与表单数据之间格式转换\n  computed: {\n    decorators() {\n      return this.form.decorators(ruleOptions)\n    },\n    startTime: {\n      get() {\n        return this.formValue.start_time\n          ? moment(this.formValue.start_time)\n          : undefined\n      },\n      set(value) {\n        this.formValue.start_time = value.format('YYYY-MM-DD HH:mm:ss')\n      }\n    },\n    endTime: {\n      get() {\n        return this.formValue.end_time\n          ? moment(this.formValue.end_time)\n          : undefined\n      },\n      set(value) {\n        this.formValue.end_time = value.format('YYYY-MM-DD HH:mm:ss')\n      }\n    },\n    isLimitStock: {\n      get() {\n        return this.formValue.is_limit_stock ? true : false\n      },\n      set(value) {\n        this.formValue.is_limit_stock = value ? 1 : 0\n        this.$nextTick(() => {\n          if (!value) {\n            this.form.validateFields(['stock_num'], { force: true })\n            this.form.setFieldsValue({ stock_num: 0 })\n          }\n        })\n      }\n    },\n    isLimitBuy: {\n      get() {\n        return this.formValue.is_limit_buy ? true : false\n      },\n      set(value) {\n        this.formValue.is_limit_buy = value ? 1 : 0\n        this.$nextTick(() => {\n          if (!value) {\n            this.form.validateFields(['buy_num'], { force: true })\n            this.form.setFieldsValue({ buy_num: 0 })\n          }\n        })\n      }\n    },\n    dateRange: {\n      get() {\n        const start = this.formValue.start_time\n          ? moment(this.formValue.start_time)\n          : undefined\n        const end = this.formValue.end_time\n          ? moment(this.formValue.end_time)\n          : undefined\n        return [start, end]\n      },\n      set(value) {\n        this.formValue.start_time = value[0]\n          ? value[0].format('YYYY-MM-DD HH:mm:ss')\n          : undefined\n        this.formValue.end_time = value[1]\n          ? value[1].format('YYYY-MM-DD HH:mm:ss')\n          : undefined\n      }\n    }\n  },\n  mounted() {},\n  methods: {\n    moment,\n    // 自定义的数据格式校验\n    validate() {\n      return new Promise((resolve, reject) => {\n        this.form.validateFieldsAndScroll((err, values) => {\n          resolve(!err)\n        })\n      })\n    },\n    // 以下方法为日期选择范围控制\n    range(start, end) {\n      const result = []\n      for (let i = start; i < end; i++) {\n        result.push(i)\n      }\n      return result\n    },\n    // disabledEndDate(newEndValue) {\n    //   return newEndValue.format('YYYY-MM-DD') < moment().format('YYYY-MM-DD')\n    // },\n    disabledEndTime() {\n      let hour = 0\n      let min = 0\n      let sec = 0\n      if (\n        moment(this.formValue.start_time).format('YYYY-MM-DD') ===\n        moment(this.formValue.end_time).format('YYYY-MM-DD')\n      ) {\n        hour = moment(this.formValue.start_time).hours()\n        if (\n          moment(this.formValue.start_time).format('YYYY-MM-DD HH') ===\n          moment(this.formValue.end_time).format('YYYY-MM-DD HH')\n        ) {\n          min = moment(this.formValue.start_time).minutes()\n        }\n        if (\n          moment(this.formValue.start_time).format('YYYY-MM-DD HH:mm') ===\n          moment(this.formValue.end_time).format('YYYY-MM-DD HH:mm')\n        ) {\n          sec = moment(this.formValue.start_time).seconds() + 1\n        }\n      }\n      return {\n        disabledHours: () => this.range(0, hour),\n        disabledMinutes: () => this.range(0, min),\n        disabledSeconds: () => this.range(0, sec)\n      }\n    }\n  }\n}\n",{"version":3,"sources":["discount-form.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"discount-form.vue","sourceRoot":"src/views/pages/brand/app/plugin/discount/components#","sourcesContent":["<template>\n  <st-form class=\"mg-t8\" :form=\"form\" labelWidth=\"125px\">\n    <st-form-item required label=\"活动名称\">\n      <st-input\n        v-decorator=\"decorators.activity_name\"\n        placeholder=\"请输入活动名称\"\n        style=\"width: 470px\"\n        @change=\"formValueChange('activity_name', $event, formValue)\"\n        :maxLength=\"30\"\n      ></st-input>\n    </st-form-item>\n    <!-- 商品选择、商品优惠设置 -->\n    <product-setting\n      discountPriceLabel=\"优惠价(元)\"\n      v-model=\"formValue\"\n      :formCheck=\"formCheck\"\n      :form=\"form\"\n      :isEdit=\"isEdit\"\n      :isSubmit=\"isSubmit\"\n      @submit=\"onSubmit\"\n    ></product-setting>\n    <st-form-item required label=\"活动时间\">\n      <st-range-picker\n        v-decorator=\"decorators.dateRange\"\n        :options=\"{\n          start: {\n            showTime: {\n              format: 'HH:mm:ss'\n            },\n            format: 'YYYY-MM-DD HH:mm:ss'\n          },\n          end: {\n            showTime: {\n              format: 'HH:mm:ss'\n            },\n            format: 'YYYY-MM-DD HH:mm:ss',\n            disabledDateTime: disabledEndTime\n          }\n        }\"\n        @change=\"formValueChange('dateRange', $event)\"\n      />\n    </st-form-item>\n    <st-form-item label=\"活动库存\">\n      <a-checkbox v-model=\"isLimitStock\">限制库存</a-checkbox>\n      <st-input-number\n        style=\"width: 150px\"\n        class=\"mg-l12\"\n        v-decorator=\"decorators.stock_num\"\n        :min=\"1\"\n        :max=\"99999\"\n        :disabled=\"!formValue.is_limit_stock\"\n        @change=\"formValueChange('stock_num', $event, formValue)\"\n      ></st-input-number>\n    </st-form-item>\n    <st-form-item label=\"单人购买限制\">\n      <a-checkbox v-model=\"isLimitBuy\">限制购买</a-checkbox>\n      <st-input-number\n        style=\"width: 150px; padding: 0\"\n        class=\"mg-l12\"\n        v-decorator=\"decorators.buy_num\"\n        :min=\"1\"\n        :max=\"999\"\n        :disabled=\"!formValue.is_limit_buy\"\n        @change=\"formValueChange('buy_num', $event, formValue)\"\n      >\n        <span slot=\"addonAfter\">笔订单</span>\n      </st-input-number>\n    </st-form-item>\n    <st-form-item label=\"备注\">\n      <st-textarea\n        style=\"min-width: 540px\"\n        placeholder=\"备注内容仅商家可见\"\n        v-model=\"formValue.description\"\n        :autosize=\"{ minRows: 2, maxRows: 3 }\"\n        :maxlength=\"200\"\n      ></st-textarea>\n    </st-form-item>\n    <slot></slot>\n  </st-form>\n</template>\n<script>\nimport { MessageService } from '@/services/message.service'\nimport ProductSetting from '../../components#/product-setting.vue'\nimport FormMixin from '../../components#/form.mixin'\nimport { merge } from 'lodash'\nimport moment from 'moment'\nimport { ruleOptions } from './discount-form.config'\nexport default {\n  name: 'BrandAppPluginDiscountAdd',\n  mixins: [FormMixin],\n  components: {\n    ProductSetting\n  },\n  props: {\n    form: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    }\n  },\n  serviceInject() {\n    return {\n      messageService: MessageService\n    }\n  },\n  data() {\n    return {}\n  },\n  // 数据源与表单数据之间格式转换\n  computed: {\n    decorators() {\n      return this.form.decorators(ruleOptions)\n    },\n    startTime: {\n      get() {\n        return this.formValue.start_time\n          ? moment(this.formValue.start_time)\n          : undefined\n      },\n      set(value) {\n        this.formValue.start_time = value.format('YYYY-MM-DD HH:mm:ss')\n      }\n    },\n    endTime: {\n      get() {\n        return this.formValue.end_time\n          ? moment(this.formValue.end_time)\n          : undefined\n      },\n      set(value) {\n        this.formValue.end_time = value.format('YYYY-MM-DD HH:mm:ss')\n      }\n    },\n    isLimitStock: {\n      get() {\n        return this.formValue.is_limit_stock ? true : false\n      },\n      set(value) {\n        this.formValue.is_limit_stock = value ? 1 : 0\n        this.$nextTick(() => {\n          if (!value) {\n            this.form.validateFields(['stock_num'], { force: true })\n            this.form.setFieldsValue({ stock_num: 0 })\n          }\n        })\n      }\n    },\n    isLimitBuy: {\n      get() {\n        return this.formValue.is_limit_buy ? true : false\n      },\n      set(value) {\n        this.formValue.is_limit_buy = value ? 1 : 0\n        this.$nextTick(() => {\n          if (!value) {\n            this.form.validateFields(['buy_num'], { force: true })\n            this.form.setFieldsValue({ buy_num: 0 })\n          }\n        })\n      }\n    },\n    dateRange: {\n      get() {\n        const start = this.formValue.start_time\n          ? moment(this.formValue.start_time)\n          : undefined\n        const end = this.formValue.end_time\n          ? moment(this.formValue.end_time)\n          : undefined\n        return [start, end]\n      },\n      set(value) {\n        this.formValue.start_time = value[0]\n          ? value[0].format('YYYY-MM-DD HH:mm:ss')\n          : undefined\n        this.formValue.end_time = value[1]\n          ? value[1].format('YYYY-MM-DD HH:mm:ss')\n          : undefined\n      }\n    }\n  },\n  mounted() {},\n  methods: {\n    moment,\n    // 自定义的数据格式校验\n    validate() {\n      return new Promise((resolve, reject) => {\n        this.form.validateFieldsAndScroll((err, values) => {\n          resolve(!err)\n        })\n      })\n    },\n    // 以下方法为日期选择范围控制\n    range(start, end) {\n      const result = []\n      for (let i = start; i < end; i++) {\n        result.push(i)\n      }\n      return result\n    },\n    // disabledEndDate(newEndValue) {\n    //   return newEndValue.format('YYYY-MM-DD') < moment().format('YYYY-MM-DD')\n    // },\n    disabledEndTime() {\n      let hour = 0\n      let min = 0\n      let sec = 0\n      if (\n        moment(this.formValue.start_time).format('YYYY-MM-DD') ===\n        moment(this.formValue.end_time).format('YYYY-MM-DD')\n      ) {\n        hour = moment(this.formValue.start_time).hours()\n        if (\n          moment(this.formValue.start_time).format('YYYY-MM-DD HH') ===\n          moment(this.formValue.end_time).format('YYYY-MM-DD HH')\n        ) {\n          min = moment(this.formValue.start_time).minutes()\n        }\n        if (\n          moment(this.formValue.start_time).format('YYYY-MM-DD HH:mm') ===\n          moment(this.formValue.end_time).format('YYYY-MM-DD HH:mm')\n        ) {\n          sec = moment(this.formValue.start_time).seconds() + 1\n        }\n      }\n      return {\n        disabledHours: () => this.range(0, hour),\n        disabledMinutes: () => this.range(0, min),\n        disabledSeconds: () => this.range(0, sec)\n      }\n    }\n  }\n}\n</script>\n"]}]}