{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/fragments/course/set-price.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/fragments/course/set-price.vue","mtime":1598250255820},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { remove } from 'lodash-es'\nimport SelectCoachLevel from '@/views/fragments/coach/select-coach-level'\nimport { UserService } from '@/services/user.service'\n\nexport default {\n  name: 'SetPrice',\n  serviceInject() {\n    return {\n      userService: UserService\n    }\n  },\n  rxState() {\n    return {\n      personalCourseTransferUnitOptions: this.userService.getOptions$(\n        'personal_course.transfer_unit'\n      ),\n      brand: this.userService.brand$\n    }\n  },\n  computed: {\n    /**\n     *私教课程定价模式 1、教练谈单 2、统一标价\n     */\n    saleModel() {\n      return this.brand.saleModel\n    },\n    /**\n     *定价模式 1、教练统一定价 2、教练分级定价\n     */\n    priceModel() {\n      return this.brand.priceModel\n    }\n  },\n  watch: {\n    priceGradient: {\n      handler(val) {\n        this.$emit('change', this.priceGradientFilter(val))\n      },\n      deep: true\n    },\n    value: {\n      handler(val) {\n        this.priceGradient = val\n      },\n      deep: true\n    }\n  },\n  props: {\n    value: {\n      type: Array,\n      default() {\n        return []\n      }\n    }\n  },\n  data() {\n    return {\n      priceGradient: []\n    }\n  },\n  created() {\n    // 获取定价模式\n    this.initPriceGradient()\n  },\n  methods: {\n    initPriceGradient() {\n      this.priceGradient = this.value.length\n        ? this.value\n        : [\n            {\n              level_id: 0,\n              prices: []\n            }\n          ]\n    },\n    onChange(e) {\n      this.priceSetting = e.target.value\n    },\n    del(key, rowIndex) {\n      this.priceGradient[key].prices.splice(rowIndex, 1)\n      this.priceGradient = [...this.priceGradient]\n    },\n    addRecord() {\n      const newRecord = {\n        level_id: 0,\n        single_sell: 0,\n        single_price: '',\n        prices: []\n      }\n      this.priceGradient.push(newRecord)\n    },\n    delRecord(key) {\n      let { priceGradient } = this\n      remove(priceGradient, (item, index) => {\n        return index === key\n      })\n      this.priceGradient = [...priceGradient]\n    },\n    addPriceRecord(key) {\n      const newRecord = {\n        id: 0,\n        priceGradient: '',\n        price: '',\n        serviceFee: '',\n        transfer_unit: 1\n      }\n      if (!this.priceGradient[key].prices) {\n        this.priceGradient[key].prices = []\n      }\n      this.priceGradient = [...this.priceGradient]\n      this.priceGradient[key].prices.push(newRecord)\n    },\n    onLevelChange(val, key) {\n      this.priceGradient[key].level_id = val\n    },\n    priceGradientFilter(priceGradient) {\n      const DEFAULT_MAX_NUM = 10000\n      priceGradient.map((item, index) => {\n        const prices = item.prices || []\n        const pricesLen = prices.length\n        prices.map((price, i) => {\n          delete price.serviceFee\n          delete price.priceGradient\n          delete price.price\n          if (this.saleModel === 1) {\n            // 教练谈单模式，没有固定价格\n            price.sell_price = 0\n          }\n          if (this.saleModel === 2) {\n            // 统一标价模式下，没有价格梯度，传0\n            price.min_sell_price = 0\n            price.max_sell_price = 0\n          }\n          if (pricesLen === 1) {\n            prices[0].max_sale = DEFAULT_MAX_NUM\n          }\n          if (i > 0) {\n            prices[i - 1].max_sale = price.min_sale - 1\n            if (i === pricesLen - 1) {\n              price.max_sale = DEFAULT_MAX_NUM\n            }\n          }\n          return price\n        })\n        return item\n      })\n      return priceGradient\n    }\n  },\n  components: {\n    SelectCoachLevel\n  }\n}\n",null]}