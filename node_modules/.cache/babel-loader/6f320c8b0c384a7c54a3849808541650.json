{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/finance/refund.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/finance/refund.vue","mtime":1600926555922},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.number.constructor\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport { RefundService } from \"./refund.service\";\nimport { ruleOptions } from \"./refund.config\";\nimport { ORDER_PRODUCT_TYPE } from '@/constants/finance/order';\nexport default {\n  name: 'ModalShopFinanceOrderRefund',\n  bem: {\n    refund: 'modal-shop-finance-order-refund'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      refundService: RefundService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      info: this.refundService.info$,\n      refundChannels: this.refundService.refundChannels$,\n      refundReasons: this.refundService.refundReasons$,\n      refundReasonsSmallCourse: this.refundService.refundReasonsSmallCourse$,\n      loading: this.refundService.loading$\n    };\n  },\n  props: {\n    id: {\n      type: Number\n    },\n    isParent: {\n      type: Boolean,\n      default: true\n    },\n    product_type: [Number, String]\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      ORDER_PRODUCT_TYPE: ORDER_PRODUCT_TYPE,\n      form: form,\n      decorators: decorators,\n      show: false,\n      description: '',\n      frozenPayType: 2,\n      refundReason: 1,\n      updateReasonFlag: false\n    };\n  },\n  computed: {\n    isVenues: function isVenues() {\n      return this.product_type === this.ORDER_PRODUCT_TYPE.VENUES;\n    },\n    isRefundPriceEditable: function isRefundPriceEditable() {\n      return this.product_type !== this.ORDER_PRODUCT_TYPE.EARNEST;\n    },\n    refundReasonsChange: function refundReasonsChange() {\n      var arr = this.refundReasons;\n      console.log('arr', arr); // 小班课的退款原因\n\n      if (this.product_type === this.ORDER_PRODUCT_TYPE.SMALL_COURSE_TYPE) {\n        arr = this.refundReasonsSmallCourse;\n      } // 定金去掉第一个退款原因\n\n\n      if (this.product_type === this.ORDER_PRODUCT_TYPE.EARNEST) {\n        arr = arr.slice(1);\n      } // 场地预约退款原因过滤\n\n\n      var reason = this.info.refund_reason;\n\n      if (this.isVenues && reason) {\n        arr = arr.filter(function (item) {\n          return reason.indexOf(item.value) > -1;\n        });\n      }\n\n      return arr;\n    },\n    getRefundReason: {\n      get: function get() {\n        if (!this.updateReasonFlag && !this.isVenues) {\n          // 客户要求退款退货（此商品变为无效）\n          return 2;\n        }\n\n        return this.refundReason;\n      },\n      set: function set(value) {\n        this.updateReasonFlag = true;\n        this.refundReason = value;\n      }\n    }\n  },\n  created: function created() {\n    var _this = this;\n\n    console.log('refundReasons', this.refundReasons);\n\n    if (this.isParent) {\n      this.refundService.getDetail(this.id).subscribe(function (res) {\n        res.info.gift_points && _this.$nextTick().then(function () {\n          _this.form.setFieldsValue({\n            gift_points: res.info.gift_points\n          });\n        });\n      });\n    } else {\n      this.refundService.getChildInfo(this.id).subscribe();\n    }\n  },\n  methods: {\n    moment: moment,\n    onSubmit: function onSubmit() {\n      var _this2 = this;\n\n      this.form.validate().then(function (values) {\n        var parmas = {\n          order_id: _this2.info.order_id || _this2.info.id,\n          refund_money: +values.refundPrice,\n          refund_points: +values.gift_points,\n          reason: _this2.getRefundReason,\n          pay_channel: +_this2.frozenPayType,\n          description: _this2.description\n        }; // 快速退款默认原因，退货退款\n\n        if (_this2.info.is_fast_refund == 1) {\n          parmas.reason = 2;\n        }\n\n        if (_this2.info.is_sub) {\n          var childParmas = _objectSpread({}, parmas, {\n            order_sub_id: _this2.info.id\n          });\n\n          _this2.refundService.orderChildRefund(childParmas, _this2.id, _this2.type).subscribe(function (res) {\n            _this2.$emit('success');\n\n            _this2.show = false;\n          });\n        } else {\n          _this2.refundService.orderRefund(parmas, _this2.id, _this2.type).subscribe(function (res) {\n            _this2.$emit('success');\n\n            _this2.show = false;\n          });\n        }\n      });\n    },\n    handleIntegralCheck: function handleIntegralCheck(rule, value) {\n      if (value > this.info.member_points) {\n        return \"\\u8BE5\\u7528\\u6237\\u4EC5\\u5269\".concat(this.info.member_points, \"\\u79EF\\u5206\\uFF0C\\u4E0D\\u8DB3\\u6263\\u51CF\");\n      }\n\n      return true;\n    }\n  }\n};",{"version":3,"sources":["refund.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal\n    title=\"退款\"\n    v-model=\"show\"\n    wrapClassName=\"modal-shop-finance-refund\"\n  >\n    <div :class=\"refund('content')\">\n      <a-row :class=\"refund('info')\">\n        <a-col :span=\"13\" class=\"mg-b36\">\n          <st-info>\n            <st-info-item label=\"订单号\" v-if=\"isParent\">\n              {{ info.order_id }}\n            </st-info-item>\n            <!-- 此条展示为子订单id  -->\n            <st-info-item label=\"订单号\" v-else>\n              {{ info.id }}\n            </st-info-item>\n            <st-info-item class=\"mg-b0\" label=\"下单时间\">\n              {{ info.created_time }}\n            </st-info-item>\n          </st-info>\n        </a-col>\n        <a-col :span=\"11\" class=\"mg-b36\">\n          <st-info>\n            <st-info-item label=\"下单人\">{{ info.operator_name }}</st-info-item>\n            <st-info-item class=\"mg-b0\" label=\"销售\">\n              {{ info.staff_name }}\n            </st-info-item>\n          </st-info>\n        </a-col>\n        <a-col :span=\"13\" class=\"mg-b36\">\n          <st-info>\n            <st-info-item label=\"订单类型\" v-if=\"info.order_type\">\n              {{ info.order_type | enumFilter('sold_common.order_type') }}\n            </st-info-item>\n            <st-info-item class=\"mg-b0\" label=\"订单来源\">\n              {{ info.order_source | enumFilter('finance.order_source') }}\n              {{ info.mobile }}\n            </st-info-item>\n          </st-info>\n        </a-col>\n        <a-col :span=\"11\" class=\"mg-b36\">\n          <st-info>\n            <st-info-item label=\"场馆\">{{ info.shop_name }}</st-info-item>\n            <st-info-item class=\"mg-b0\" label=\"用户\">\n              {{ info.member_name }}\n            </st-info-item>\n          </st-info>\n        </a-col>\n        <a-col :span=\"13\" class=\"mg-b36\">\n          <st-info>\n            <st-info-item\n              label=\"购买\"\n              v-if=\"info.order_type !== 6 || info.is_sub === 1\"\n            >\n              {{ info.product_name }}\n            </st-info-item>\n            <st-info-item\n              label=\"购买\"\n              v-if=\"info.order_type === 6 && !info.is_sub\"\n            >\n              <!-- TODO:雄伟给返回 -->\n              <st-overflow-text\n                title=\"购买\"\n                max-width=\"180px\"\n                :value=\"\n                  info.product_list &&\n                    info.product_list.map(\n                      item =>\n                        `${item.product_name}&nbsp;${\n                          item.rule_name ? '规格：' : ''\n                        }${item.rule_name}*${item.product_count} 金额：&yen;${\n                          item.price\n                        }`\n                    )\n                \"\n              ></st-overflow-text>\n            </st-info-item>\n            <st-info-item label=\"订单总额\">\n              {{ info.total_price }}元\n            </st-info-item>\n            <st-info-item label=\"实收金额\">\n              {{ info.actual_price }}元\n            </st-info-item>\n          </st-info>\n        </a-col>\n\n        <a-col :span=\"11\" class=\"mg-b36\">\n          <st-info>\n            <st-info-item label=\"赠送\">{{ info.gift_amount }}</st-info-item>\n            <st-info-item label=\"应收金额\">{{ info.pay_price }}元</st-info-item>\n          </st-info>\n        </a-col>\n        <a-col :span=\"24\" class=\"mg-b36\">\n          <st-info>\n            <st-info-item label=\"备注\">\n              {{ info.description || '' }}\n            </st-info-item>\n          </st-info>\n        </a-col>\n      </a-row>\n      <st-form :form=\"form\">\n        <div :class=\"refund('refund')\">\n          <st-form-item\n            class=\"mg-b16\"\n            required\n            v-if=\"info.is_fast_refund !== 1\"\n          >\n            <template slot=\"label\">\n              退款原因\n              <st-help-tooltip id=\"TSMC005\" />\n            </template>\n            <a-radio-group v-model=\"getRefundReason\">\n              <a-radio\n                v-for=\"(item, index) in refundReasonsChange\"\n                :key=\"index\"\n                :value=\"+item.value\"\n              >\n                {{ item.label }}\n              </a-radio>\n            </a-radio-group>\n          </st-form-item>\n          <st-form-item label=\"退款金额\" required>\n            <st-input-number\n              v-if=\"isRefundPriceEditable\"\n              :max=\"+info.actual_price\"\n              :float=\"true\"\n              placeholder=\"请输入本次退款的实际金额\"\n              v-decorator=\"decorators.refundPrice\"\n            >\n              <template slot=\"addonAfter\">元</template>\n            </st-input-number>\n            <template v-else>{{ info.actual_price }}元</template>\n          </st-form-item>\n          <st-form-item label=\"退款方式\" class=\"mg-b16\" required>\n            <a-radio-group v-model=\"frozenPayType\">\n              <a-radio\n                v-for=\"(item, index) in refundChannels\"\n                :key=\"index\"\n                :value=\"+item.value\"\n              >\n                {{ item.label }}\n              </a-radio>\n            </a-radio-group>\n          </st-form-item>\n          <st-form-item v-if=\"info.gift_points\">\n            <div :class=\"refund('integral')\">\n              该订单赠送{{ info.gift_points }}积分，退款时需扣回\n              <span style=\"width: 150px; padding-left: 10px\">\n                <st-input-number\n                  width=\"150px\"\n                  type=\"number\"\n                  :max=\"+info.gift_points\"\n                  placeholder=\"请输入\"\n                  v-decorator=\"decorators.gift_points\"\n                >\n                  <template slot=\"addonAfter\">积分</template>\n                </st-input-number>\n              </span>\n            </div>\n          </st-form-item>\n          <st-form-item label=\"备注\" class=\"mg-b0\">\n            <a-textarea\n              v-model=\"description\"\n              :autosize=\"{ minRows: 4, maxRows: 6 }\"\n            />\n          </st-form-item>\n        </div>\n      </st-form>\n    </div>\n    <template slot=\"footer\">\n      <span class=\"info\">\n        提交后无法修改&nbsp;\n        <st-icon type=\"help\" />\n      </span>\n      <st-button\n        @click=\"onSubmit\"\n        :loading=\"loading.orderRefund || loading.getChildInfo\"\n        type=\"primary\"\n      >\n        确认提交\n      </st-button>\n    </template>\n  </st-modal>\n</template>\n\n<script>\nimport moment from 'moment'\nimport { RefundService } from './refund.service'\nimport { ruleOptions } from './refund.config'\nimport { ORDER_PRODUCT_TYPE } from '@/constants/finance/order'\nexport default {\n  name: 'ModalShopFinanceOrderRefund',\n  bem: {\n    refund: 'modal-shop-finance-order-refund'\n  },\n  serviceInject() {\n    return {\n      refundService: RefundService\n    }\n  },\n  rxState() {\n    return {\n      info: this.refundService.info$,\n      refundChannels: this.refundService.refundChannels$,\n      refundReasons: this.refundService.refundReasons$,\n      refundReasonsSmallCourse: this.refundService.refundReasonsSmallCourse$,\n      loading: this.refundService.loading$\n    }\n  },\n  props: {\n    id: {\n      type: Number\n    },\n    isParent: {\n      type: Boolean,\n      default: true\n    },\n    product_type: [Number, String]\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      ORDER_PRODUCT_TYPE,\n      form,\n      decorators,\n      show: false,\n      description: '',\n      frozenPayType: 2,\n      refundReason: 1,\n      updateReasonFlag: false\n    }\n  },\n  computed: {\n    isVenues() {\n      return this.product_type === this.ORDER_PRODUCT_TYPE.VENUES\n    },\n    isRefundPriceEditable() {\n      return this.product_type !== this.ORDER_PRODUCT_TYPE.EARNEST\n    },\n    refundReasonsChange() {\n      let arr = this.refundReasons\n      console.log('arr', arr)\n      // 小班课的退款原因\n      if (this.product_type === this.ORDER_PRODUCT_TYPE.SMALL_COURSE_TYPE) {\n        arr = this.refundReasonsSmallCourse\n      }\n      // 定金去掉第一个退款原因\n      if (this.product_type === this.ORDER_PRODUCT_TYPE.EARNEST) {\n        arr = arr.slice(1)\n      }\n      // 场地预约退款原因过滤\n      const reason = this.info.refund_reason\n      if (this.isVenues && reason) {\n        arr = arr.filter(item => reason.indexOf(item.value) > -1)\n      }\n      return arr\n    },\n    getRefundReason: {\n      get: function() {\n        if (!this.updateReasonFlag && !this.isVenues) {\n          // 客户要求退款退货（此商品变为无效）\n          return 2\n        }\n        return this.refundReason\n      },\n      set: function(value) {\n        this.updateReasonFlag = true\n        this.refundReason = value\n      }\n    }\n  },\n  created() {\n    console.log('refundReasons', this.refundReasons)\n    if (this.isParent) {\n      this.refundService.getDetail(this.id).subscribe(res => {\n        res.info.gift_points &&\n          this.$nextTick().then(() => {\n            this.form.setFieldsValue({\n              gift_points: res.info.gift_points\n            })\n          })\n      })\n    } else {\n      this.refundService.getChildInfo(this.id).subscribe()\n    }\n  },\n  methods: {\n    moment,\n    onSubmit() {\n      this.form.validate().then(values => {\n        let parmas = {\n          order_id: this.info.order_id || this.info.id,\n          refund_money: +values.refundPrice,\n          refund_points: +values.gift_points,\n          reason: this.getRefundReason,\n          pay_channel: +this.frozenPayType,\n          description: this.description\n        }\n        // 快速退款默认原因，退货退款\n        if (this.info.is_fast_refund == 1) {\n          parmas.reason = 2\n        }\n        if (this.info.is_sub) {\n          let childParmas = { ...parmas, order_sub_id: this.info.id }\n\n          this.refundService\n            .orderChildRefund(childParmas, this.id, this.type)\n            .subscribe(res => {\n              this.$emit('success')\n              this.show = false\n            })\n        } else {\n          this.refundService\n            .orderRefund(parmas, this.id, this.type)\n            .subscribe(res => {\n              this.$emit('success')\n              this.show = false\n            })\n        }\n      })\n    },\n    handleIntegralCheck(rule, value) {\n      if (value > this.info.member_points) {\n        return `该用户仅剩${this.info.member_points}积分，不足扣减`\n      }\n      return true\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/shop/finance"}]}