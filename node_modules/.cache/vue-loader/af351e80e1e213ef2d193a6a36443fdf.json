{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/card/upgrade-member.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/card/upgrade-member.vue","mtime":1594718340030},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { UpgradeMemberService } from './upgrade-member.service'\nimport { cloneDeep } from 'lodash-es'\nimport { timer } from 'rxjs'\nimport { ruleOptions } from './upgrade-member.config'\nimport autoContractBtn from '@/views/biz-components/contract/auto-contract-btn.vue'\nimport moment from 'moment'\nimport { PERSON_TYPE } from '@/constants/course/small-course'\nimport EditableContractNumber from '@/views/biz-components/contract/editable-contract-number.vue'\nexport default {\n  name: 'ModalSoldUpgradeMemberCard',\n  bem: {\n    sale: 'modal-sold-deal-sale'\n  },\n  components: {\n    EditableContractNumber\n  },\n  serviceProviders() {\n    return [UpgradeMemberService]\n  },\n  serviceInject() {\n    return {\n      upgradeMemberService: UpgradeMemberService\n    }\n  },\n  rxState() {\n    return {\n      info: this.upgradeMemberService.info$,\n      couponList: this.upgradeMemberService.couponList$,\n      advanceList: this.upgradeMemberService.advanceList$,\n      priceInfo: this.upgradeMemberService.priceInfo$,\n      saleList: this.upgradeMemberService.saleList$,\n      loading: this.upgradeMemberService.loading$\n    }\n  },\n  props: ['id'],\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      PERSON_TYPE,\n      form,\n      decorators,\n      show: false,\n      // 会员卡列表\n      cardList: [],\n      cardLists: {},\n      // 选择的卡\n      selectCardItem: {},\n      // 选择的卡的详情\n      upgradeCardInfo: {},\n      upgradeCardsInfo: {},\n      // 规格\n      selectSpecs: null,\n      // 选择的规格\n      selectSpecsItem: {},\n      // 初始额度可编辑\n      isAmountDisabled: true,\n      getValidTime: 0,\n      // 开卡方式\n      selectOpenType: null,\n      // 有效时间\n      startTime: null,\n      endTime: '-',\n      // 购买赠送\n      giftAmount: '',\n      // 商品金额\n      cardPrice: '0',\n      // 原卡折扣\n      surplusPrice: '',\n      // 优惠\n      couponDropdownVisible: false,\n      couponText: '未选择优惠券',\n      couponAmount: '',\n      selectCoupon: '',\n      // 定金\n      advanceDropdownVisible: false,\n      advanceText: '未选择定金',\n      advanceAmount: '',\n      selectAdvance: '',\n      // 减免金额\n      reduceAmount: '',\n      // 描述\n      description: ''\n    }\n  },\n  computed: {\n    // 是否未选择卡\n    selectCardIsNone() {\n      return !this.selectCardItem.id\n    },\n    // 卡跟规格，用来判断规格是否切换了，因为有可能不同的卡有同一个规格，但是同卡同规格是不会出现的\n    cardAndSpecs() {\n      return `${this.selectCardItem.id || ''}-${this.selectSpecsItem.id || ''}`\n    },\n    // 小计判断\n    orderAmountText() {\n      return this.priceInfo < 0 ? '小计不能为负' : ''\n    },\n    // 计算小计用\n    priceOB() {\n      return `${this.selectSpecs}-\n              ${this.selectAdvance}-\n              ${this.reduceAmount}-\n              ${this.selectCoupon}-\n              ${this.surplusPrice}`\n    },\n    isFamilyCard() {\n      return this.info.card_number_type === 2\n    }\n  },\n  watch: {\n    cardAndSpecs(newVal, oldVal) {\n      // 先重围优惠券\n      this.resetCoupon()\n      if (!this.upgradeCardInfo.id || !this.selectSpecsItem.id) return\n      this.upgradeMemberService.couponAction$.dispatch({\n        member_id: this.info.member_id,\n        card_id: this.upgradeCardInfo.id,\n        specs_id: this.selectSpecsItem.id\n      })\n    },\n    // 计算小计\n    priceOB() {\n      this.getPrice({\n        product_id: this.selectCardItem.id,\n        product_type: this.info.contract_type,\n        specs_id: +this.selectSpecs,\n        advance_id: this.selectAdvance === -1 ? '' : this.selectAdvance,\n        reduce_amount: +this.reduceAmount,\n        coupon_id: this.selectCoupon === -1 ? '' : this.selectCoupon,\n        member_id: +this.info.member_id,\n        surplus_amount: +this.surplusPrice\n      })\n    }\n  },\n  created() {\n    this.upgradeMemberService.serviceInit(this.id).subscribe()\n  },\n  methods: {\n    moment,\n    // 搜索会员卡\n    onCardSearch(data) {\n      if (data === '') {\n        this.cardList = []\n      } else {\n        // 判断之前是否请求过\n        if (!this.cardLists[data]) {\n          this.upgradeMemberService\n            .getCardList(data, this.info.card_number_type)\n            .subscribe(res => {\n              // 缓存请求结果\n              this.cardLists[data] = cloneDeep(res.list)\n              this.cardList = cloneDeep(res.list)\n            })\n        } else {\n          // 取缓存\n          this.cardList = cloneDeep(this.cardLists[data])\n        }\n      }\n    },\n    // 重置规格/开卡方式/有效时间/商品金额/购买赠送/表单重置\n    resetData() {\n      // 规格\n      this.selectSpecs = null\n      this.selectSpecsItem = {}\n      // 开卡方式\n      this.selectOpenType = null\n      // 有效时间\n      this.startTime = null\n      this.endTime = '-'\n      // 商品金额\n      this.cardPrice = '0'\n      // 购买赠送\n      this.giftAmount = ''\n      this.form.resetFields()\n    },\n    onSelectCardChange(data) {\n      if (data) {\n        // 选择了卡\n        this.selectCardItem = cloneDeep(\n          this.cardList.filter(i => i.id === data)[0]\n        )\n        // 获取选择的卡的详情\n        this.getUpgradeCardInfo(data)\n      } else {\n        // 清空了选择的卡\n        this.selectCardItem = {}\n        this.resetData()\n      }\n    },\n    getUpgradeCardInfo(id) {\n      // 判断之前是否请求过\n      if (!this.upgradeCardsInfo[id]) {\n        // 缓存请求结果\n        this.upgradeMemberService.getUpgradeCardInfo(id).subscribe(res => {\n          this.upgradeCardsInfo[id] = cloneDeep(res.info)\n          this.upgradeCardInfo = cloneDeep(res.info)\n          // 设置默认规格\n          this.selectSpecs = this.upgradeCardInfo.specs[0].id\n          this.selectSpecsItem = cloneDeep(this.upgradeCardInfo.specs[0])\n          // 设置默认开卡方式\n          this.selectOpenType = this.upgradeCardInfo.open_type[0].id\n          // 设置初始额度\n          this.form.setFieldsValue({\n            card_amount: this.selectSpecsItem.card_amount\n          })\n          this.getValidTime = this.selectSpecsItem.valid_time\n          this.form.validate(['card_amount'])\n          // 设置默认卡价格\n          this.cardPrice = this.upgradeCardInfo.specs[0].price\n        })\n      } else {\n        // 取缓存\n        this.upgradeCardInfo = cloneDeep(this.upgradeCardsInfo[id])\n        // 设置默认规格\n        this.selectSpecs = this.upgradeCardInfo.specs[0].id\n        this.selectSpecsItem = cloneDeep(this.upgradeCardInfo.specs[0])\n        // 设置默认开卡方式\n        this.selectOpenType = this.upgradeCardInfo.open_type[0].id\n        // 设置初始额度\n        this.form.setFieldsValue({\n          card_amount: this.selectSpecsItem.card_amount\n        })\n        this.form.validate(['card_amount'])\n        this.getValidTime = this.selectSpecsItem.valid_time\n        // 设置默认卡价格\n        this.cardPrice = this.upgradeCardInfo.specs[0].price\n      }\n    },\n    // 规格\n    onSpecsChange(data) {\n      this.selectSpecsItem = cloneDeep(\n        this.upgradeCardInfo.specs.filter(i => i.id === data.target.value)[0]\n      )\n      this.cardPrice = this.upgradeCardInfo.specs.filter(\n        i => i.id === data.target.value\n      )[0].price\n      // 重置选择的开始时间\n      this.form.resetFields(['startTime'])\n      this.endTime = '-'\n      this.form.setFieldsValue({\n        card_amount: this.selectSpecsItem.card_amount\n      })\n      this.getValidTime = this.selectSpecsItem.valid_time\n      this.form.validate(['card_amount'])\n    },\n    // 开卡方式\n    onOpenTypeChange(data) {\n      // 重置选择的开始时间\n      this.form.resetFields(['startTime'])\n      this.endTime = '-'\n    },\n    onClickAmountConfirm() {\n      const val = this.form.getFieldValue('card_amount')\n      const productType = this.upgradeCardInfo.product_type.id\n      const currentStartTime = moment(this.form.getFieldValue('startTime'))\n      this.isAmountDisabled = true\n      this.form.setFieldsValue({\n        card_amount: val\n      })\n      if (productType === 1) {\n        val = this.selectSpecsItem.valid_time\n      }\n      if (this.startTime) {\n        this.endTime = currentStartTime.add(val, 'd').format('YYYY-MM-DD HH:mm')\n      }\n      this.getValidTime = val\n    },\n    onClickAmountEdit() {\n      const val = this.form.getFieldValue('card_amount')\n      this.isAmountDisabled = false\n      this.form.setFieldsValue({\n        card_amount: val\n      })\n      this.form.validate(['card_amount'])\n    },\n    // 有效时间\n    disabledStartDate(startTime) {\n      return startTime.valueOf() < this.upgradeCardInfo.server_time * 1000\n    },\n    onStartTimeChange(data) {\n      this.startTime = cloneDeep(data)\n      let s = cloneDeep(data)\n      let productType = this.upgradeCardInfo.product_type.id\n      let dayScope = this.form.getFieldValue('card_amount')\n      if (productType === 1) {\n        dayScope = this.selectSpecsItem.valid_time\n      }\n      this.endTime = s.add(dayScope, 'd').format('YYYY-MM-DD HH:mm')\n    },\n    // 原卡折扣\n    onSurplusPriceChange(data) {\n      this.surplusPrice = data\n    },\n    // 优惠\n    onSelectCouponChange(data) {\n      if (data.target.value === -1) {\n        this.couponAmount = ''\n        this.couponText = '未选择优惠券'\n        return\n      }\n      let price = this.couponList.filter(o => o.id === data.target.value)[0]\n        .price\n      this.couponAmount = price\n      this.couponText = `${price}元`\n    },\n    onSelectCoupon() {\n      timer(200).subscribe(() => {\n        this.couponDropdownVisible = false\n      })\n    },\n    resetCoupon() {\n      this.upgradeMemberService.resetCouponList()\n      this.couponText = '未选择优惠券'\n      this.couponAmount = ''\n      this.selectCoupon = ''\n    },\n    // 定金\n    onSelectAdvanceChange(data) {\n      if (data.target.value === -1) {\n        this.advanceAmount = ''\n        this.advanceText = '未选择定金'\n        return\n      }\n      let price = this.advanceList.filter(o => o.id === data.target.value)[0]\n        .price\n      this.advanceAmount = price\n      this.advanceText = `${price}元`\n    },\n    onSelectAdvance() {\n      timer(200).subscribe(() => {\n        this.advanceDropdownVisible = false\n      })\n    },\n    resetAdvance() {\n      this.upgradeMemberService.resetAdvanceList()\n      this.advanceText = '未选择定金'\n      this.advanceAmount = ''\n      this.selectAdvance = ''\n    },\n    // 计算实付金额\n    getPrice(params) {\n      this.upgradeMemberService.priceAction$.dispatch(params)\n    },\n    onCreateOrder() {\n      this.form.validate((error, values) => {\n        if (!error) {\n          this.upgradeMemberService\n            .upgrade(\n              {\n                product_id: +values.memberCardId,\n                contract_number: this.info.contract_number,\n                rule_id: +this.selectSpecs,\n                surplus_price: +values.surplusPrice,\n                valid_start_time: moment(values.startTime).format(\n                  'YYYY-MM-DD HH:mm'\n                ),\n                open_card_type: +this.selectOpenType,\n                user_coupon_id: this.selectCoupon,\n                advance_id: this.selectAdvance,\n                reduce_price: +this.reduceAmount,\n                description: this.description,\n                staff_sale_id: +values.saleName,\n                gift_amount: +this.giftAmount,\n                init_amount: values.card_amount\n              },\n              this.id\n            )\n            .subscribe(res => {\n              this.show = false\n              this.$emit('success', {\n                type: 'create',\n                orderId: res.info.order_id,\n                soldId: res.info.sold_id,\n                isFamilyCard: this.isFamilyCard\n              })\n            })\n        }\n      })\n    },\n    onPay() {\n      this.form.validate((error, values) => {\n        if (!error) {\n          this.upgradeMemberService\n            .upgrade(\n              {\n                product_id: +values.memberCardId,\n                contract_number: this.info.contract_number,\n                rule_id: +this.selectSpecs,\n                surplus_price: +values.surplusPrice,\n                valid_start_time: moment(values.startTime).format(\n                  'YYYY-MM-DD HH:mm'\n                ),\n                open_card_type: +this.selectOpenType,\n                user_coupon_id: this.selectCoupon,\n                advance_id: this.selectAdvance,\n                reduce_price: +this.reduceAmount,\n                description: this.description,\n                staff_sale_id: +values.saleName,\n                gift_amount: +this.giftAmount,\n                init_amount: values.card_amount\n              },\n              this.id\n            )\n            .subscribe(res => {\n              this.show = false\n              this.$emit('success', {\n                type: 'createPay',\n                orderId: res.info.order_id,\n                soldId: res.info.sold_id,\n                isFamilyCard: this.isFamilyCard\n              })\n            })\n        }\n      })\n    },\n    onCancel() {\n      this.upgradeMemberService.resetCouponList()\n      this.upgradeMemberService.resetAdvanceList()\n    }\n  }\n}\n",{"version":3,"sources":["upgrade-member.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2XA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"upgrade-member.vue","sourceRoot":"src/views/biz-modals/sold/card","sourcesContent":["<template>\n  <st-modal\n    v-model=\"show\"\n    @cancel=\"onCancel\"\n    wrapClassName=\"modal-sold-deal-sale\"\n  >\n    <template slot=\"title\">\n      升级\n      <st-help-tooltip id=\"TSMC002\" placement=\"right\" />\n    </template>\n    <div :class=\"sale('content')\">\n      <a-row :class=\"sale('info')\">\n        <a-col :span=\"13\">\n          <st-info>\n            <st-info-item label=\"卡名\">{{ info.card_name }}</st-info-item>\n            <st-info-item label=\"当前额度\">\n              {{ info.remain_amount }}\n            </st-info-item>\n            <st-info-item label=\"初始额度\">{{ info.init_amount }}</st-info-item>\n            <st-info-item label=\"优惠赠送\">{{ info.gift_amount }}</st-info-item>\n            <st-info-item label=\"实付金额\">{{ info.pay_price }}</st-info-item>\n            <st-info-item label=\"到期日期\">{{ info.end_time }}</st-info-item>\n          </st-info>\n        </a-col>\n        <a-col :span=\"11\">\n          <st-info>\n            <st-info-item label=\"购卡人\">{{ info.member_name }}</st-info-item>\n            <st-info-item label=\"卡成员\" v-if=\"isFamilyCard\">\n              {{ info.card_member }}\n            </st-info-item>\n            <template v-if=\"info.is_minors === PERSON_TYPE.CHILD\">\n              <st-info-item label=\"家长手机号\">\n                {{ info.parent_mobile }}\n              </st-info-item>\n              <st-info-item label=\"家长姓名\">\n                {{ info.parent_name }}\n              </st-info-item>\n            </template>\n            <st-info-item label=\"手机号\" v-else>{{ info.mobile }}</st-info-item>\n            <st-info-item label=\"订单号\">{{ info.order_id }}</st-info-item>\n            <st-info-item label=\"订单状态\">\n              {{ info.order_status }}\n            </st-info-item>\n            <st-info-item label=\"销售人员\">{{ info.staff_name }}</st-info-item>\n          </st-info>\n        </a-col>\n      </a-row>\n      <st-form :form=\"form\" labelWidth=\"88px\">\n        <div :class=\"sale('sale')\">\n          <st-form-item :label=\"$c('member_card')\" required>\n            <a-select\n              showSearch\n              allowClear\n              :placeholder=\"`输入${$c('member_card')}名搜索`\"\n              :defaultActiveFirstOption=\"false\"\n              :showArrow=\"false\"\n              :filterOption=\"false\"\n              @change=\"onSelectCardChange\"\n              v-decorator=\"decorators.memberCardId\"\n              @search=\"onCardSearch\"\n              notFoundContent=\"无搜索结果\"\n            >\n              <a-select-option\n                v-for=\"(item, index) in cardList\"\n                :value=\"+item.id\"\n                :key=\"index\"\n              >\n                {{ item.card_name }}\n              </a-select-option>\n            </a-select>\n          </st-form-item>\n          <st-form-item label=\"规格\" class=\"mg-b16\" required>\n            <template v-if=\"selectCardIsNone\">\n              无\n            </template>\n            <a-radio-group v-else v-model=\"selectSpecs\" @change=\"onSpecsChange\">\n              <a-radio\n                v-for=\"(item, index) in upgradeCardInfo.specs\"\n                :value=\"item.id\"\n                :key=\"index\"\n              >\n                {{ item.specs_name }}/{{ item.price }}元\n              </a-radio>\n            </a-radio-group>\n          </st-form-item>\n          <st-form-item label=\"开卡方式\" required>\n            <template v-if=\"selectCardIsNone\">\n              无\n            </template>\n            <a-radio-group\n              v-else\n              v-model=\"selectOpenType\"\n              @change=\"onOpenTypeChange\"\n            >\n              <a-radio\n                v-for=\"(item, index) in upgradeCardInfo.open_type\"\n                :value=\"item.id\"\n                :key=\"index\"\n              >\n                {{ item.open_type }}\n              </a-radio>\n            </a-radio-group>\n          </st-form-item>\n          <st-form-item label=\"初始额度\" required>\n            <div :class=\"sale('contract')\">\n              <st-input-number\n                class=\"input-number\"\n                :min=\"1\"\n                :max=\"selectSpecsItem.card_amount\"\n                v-decorator=\"decorators.card_amount\"\n                placeholder=\"请输入初始额度\"\n                :disabled=\"isAmountDisabled\"\n              >\n                <div slot=\"addonAfter\" v-if=\"selectSpecsItem.card_type\">\n                  {{ selectSpecsItem.card_type }}\n                </div>\n              </st-input-number>\n              <st-button\n                class=\"create-button\"\n                @click=\"onClickAmountConfirm\"\n                v-if=\"!isAmountDisabled\"\n              >\n                确定\n              </st-button>\n              <st-button\n                class=\"create-button\"\n                @click=\"onClickAmountEdit\"\n                v-else\n              >\n                编辑\n              </st-button>\n            </div>\n          </st-form-item>\n          <st-form-item\n            label=\"有效时间\"\n            :class=\"{ 'mg-b0': !selectCardIsNone && +selectOpenType === 3 }\"\n            :required=\"!selectCardIsNone && +selectOpenType === 3\"\n          >\n            <template v-if=\"selectCardIsNone\">\n              无\n            </template>\n            <template\n              v-if=\"\n                !selectCardIsNone &&\n                  +selectOpenType === 1 &&\n                  upgradeCardInfo.server_time\n              \"\n            >\n              {{\n                moment(upgradeCardInfo.server_time * 1000).format(\n                  'YYYY-MM-DD HH:mm'\n                )\n              }}&nbsp;至&nbsp;\n              {{\n                moment(upgradeCardInfo.server_time * 1000)\n                  .add(getValidTime, 'd')\n                  .format('YYYY-MM-DD HH:mm')\n              }}\n            </template>\n            <template v-if=\"!selectCardIsNone && +selectOpenType === 2\">\n              {{\n                upgradeCardInfo.open_type.filter(i => +i.id === 2)[0]\n                  .automatic_num\n              }}天内未开卡，则{{\n                upgradeCardInfo.open_type.filter(i => +i.id === 2)[0]\n                  .automatic_num + 1\n              }}天0：00自动开卡\n            </template>\n            <div\n              :class=\"sale('time')\"\n              v-if=\"!selectCardIsNone && +selectOpenType === 3\"\n            >\n              <a-form-item class=\"page-a-form\">\n                <a-date-picker\n                  :disabledDate=\"disabledStartDate\"\n                  v-decorator=\"decorators.startTime\"\n                  @change=\"onStartTimeChange\"\n                  style=\"width: 188px;\"\n                  format=\"YYYY-MM-DD HH:mm\"\n                  :showTime=\"{ format: 'HH:mm' }\"\n                  placeholder=\"开始时间\"\n                  :allowClear=\"false\"\n                  :showToday=\"false\"\n                />\n                <span style=\"width:158px;\">\n                  &nbsp;&nbsp;至&nbsp;&nbsp;{{ endTime }}\n                </span>\n              </a-form-item>\n            </div>\n          </st-form-item>\n          <st-form-item label=\"购买赠送\">\n            <st-input-number\n              :disabled=\"selectCardIsNone\"\n              v-model=\"giftAmount\"\n              :max=\"+selectSpecsItem.gift_max\"\n              :placeholder=\"\n                `请输入赠送的${\n                  selectCardItem.card_type !== 1 ? '天数' : '次数'\n                }`\n              \"\n            >\n              <span slot=\"addonAfter\">\n                {{ selectCardItem.card_type !== 1 ? '天' : '次' }}\n              </span>\n            </st-input-number>\n          </st-form-item>\n          <editable-contract-number\n            v-model=\"info.contract_number\"\n            :form=\"form\"\n          />\n          <st-form-item class=\"mg-b12\" label=\"商品价格\">\n            {{ cardPrice }}元\n          </st-form-item>\n          <st-form-item required>\n            <template slot=\"label\">\n              原卡抵扣\n              <st-help-tooltip id=\"TSMC003\" />\n            </template>\n            <st-input-number\n              @change=\"onSurplusPriceChange\"\n              v-decorator=\"decorators.surplusPrice\"\n              :float=\"true\"\n              :max=\"+info.pay_price\"\n              placeholder=\"请输入原卡可以抵扣的剩余价值金额\"\n            >\n              <span slot=\"addonAfter\">元</span>\n            </st-input-number>\n          </st-form-item>\n          <st-form-item :class=\"sale('discounts')\" label=\"优惠金额\">\n            <div>\n              <div :class=\"sale('discounts-total')\">\n                <span>{{ couponText }}</span>\n                <a-dropdown\n                  v-model=\"couponDropdownVisible\"\n                  :disabled=\"couponList.length === 0\"\n                  :class=\"sale({ disabled: couponList.length === 0 })\"\n                  placement=\"bottomRight\"\n                  :getPopupContainer=\"trigger => trigger.parentNode\"\n                  :trigger=\"['click']\"\n                >\n                  <div :class=\"sale('discounts-promotion')\">\n                    <span>\n                      {{ couponList.length === 0 ? '无优惠券' : '优惠券选择' }}\n                    </span>\n                    <a-icon type=\"right\" />\n                  </div>\n                  <a-radio-group\n                    v-model=\"selectCoupon\"\n                    @change=\"onSelectCouponChange\"\n                    :class=\"sale('dropdown')\"\n                    slot=\"overlay\"\n                  >\n                    <a-menu>\n                      <a-menu-item @click=\"onSelectCoupon\">\n                        <a-radio :value=\"-1\">不使用</a-radio>\n                      </a-menu-item>\n                      <a-menu-item\n                        @click=\"onSelectCoupon\"\n                        :key=\"index\"\n                        v-for=\"(item, index) in couponList\"\n                      >\n                        <a-radio :value=\"item.id\">\n                          {{ item.name }} {{ item.price }}\n                        </a-radio>\n                      </a-menu-item>\n                    </a-menu>\n                  </a-radio-group>\n                </a-dropdown>\n              </div>\n            </div>\n          </st-form-item>\n          <st-form-item :class=\"sale('discounts')\" label=\"定金抵扣\">\n            <div>\n              <div :class=\"sale('discounts-total')\">\n                <span>{{ advanceText }}</span>\n                <a-dropdown\n                  v-model=\"advanceDropdownVisible\"\n                  :disabled=\"advanceList.length === 0\"\n                  :class=\"sale({ disabled: advanceList.length === 0 })\"\n                  placement=\"bottomRight\"\n                  :getPopupContainer=\"trigger => trigger.parentNode\"\n                  :trigger=\"['click']\"\n                >\n                  <div :class=\"sale('discounts-promotion')\">\n                    <span>\n                      {{ advanceList.length === 0 ? '无定金' : '定金选择' }}\n                    </span>\n                    <a-icon type=\"right\" />\n                  </div>\n                  <a-radio-group\n                    v-model=\"selectAdvance\"\n                    @change=\"onSelectAdvanceChange\"\n                    :class=\"sale('dropdown')\"\n                    slot=\"overlay\"\n                  >\n                    <a-menu>\n                      <a-menu-item @click=\"onSelectAdvance\">\n                        <a-radio :value=\"-1\">不使用</a-radio>\n                      </a-menu-item>\n                      <a-menu-item\n                        @click=\"onSelectAdvance\"\n                        :key=\"index\"\n                        v-for=\"(item, index) in advanceList\"\n                      >\n                        <a-radio :value=\"item.id\">\n                          定金 {{ item.price }}\n                        </a-radio>\n                      </a-menu-item>\n                    </a-menu>\n                  </a-radio-group>\n                </a-dropdown>\n              </div>\n            </div>\n          </st-form-item>\n          <st-form-item label=\"减免金额\">\n            <st-input-number\n              v-model=\"reduceAmount\"\n              :float=\"true\"\n              placeholder=\"请输入\"\n            >\n              <span slot=\"addonAfter\">元</span>\n            </st-input-number>\n          </st-form-item>\n          <st-form-item\n            validateStatus=\"error\"\n            :help=\"orderAmountText\"\n            class=\"mg-b0\"\n            label=\"小计\"\n          >\n            <span class=\"total\">{{ priceInfo }}元</span>\n          </st-form-item>\n        </div>\n        <div :class=\"sale('remarks')\">\n          <st-form-item label=\"销售人员\" required>\n            <a-select\n              v-decorator=\"decorators.saleName\"\n              placeholder=\"选择签单的工作人员\"\n            >\n              <a-select-option\n                v-for=\"(item, index) in saleList\"\n                :key=\"index\"\n                :value=\"item.id\"\n              >\n                {{ item.staff_name }}\n              </a-select-option>\n            </a-select>\n          </st-form-item>\n          <st-form-item label=\"备注\" class=\"mg-b0\">\n            <a-textarea\n              v-model=\"description\"\n              :autosize=\"{ minRows: 4, maxRows: 6 }\"\n            />\n          </st-form-item>\n        </div>\n      </st-form>\n    </div>\n    <template slot=\"footer\">\n      <div :class=\"sale('footer')\">\n        <div class=\"price\">\n          <span>{{ priceInfo }}元</span>\n          <span>订单总额：{{ cardPrice }}元</span>\n        </div>\n        <div class=\"button\">\n          <st-button @click=\"onCreateOrder\" :loading=\"loading.upgrade\">\n            创建订单\n          </st-button>\n          <st-button\n            @click=\"onPay\"\n            :loading=\"loading.upgradePay\"\n            type=\"primary\"\n          >\n            立即支付\n          </st-button>\n        </div>\n      </div>\n    </template>\n  </st-modal>\n</template>\n<script>\nimport { UpgradeMemberService } from './upgrade-member.service'\nimport { cloneDeep } from 'lodash-es'\nimport { timer } from 'rxjs'\nimport { ruleOptions } from './upgrade-member.config'\nimport autoContractBtn from '@/views/biz-components/contract/auto-contract-btn.vue'\nimport moment from 'moment'\nimport { PERSON_TYPE } from '@/constants/course/small-course'\nimport EditableContractNumber from '@/views/biz-components/contract/editable-contract-number.vue'\nexport default {\n  name: 'ModalSoldUpgradeMemberCard',\n  bem: {\n    sale: 'modal-sold-deal-sale'\n  },\n  components: {\n    EditableContractNumber\n  },\n  serviceProviders() {\n    return [UpgradeMemberService]\n  },\n  serviceInject() {\n    return {\n      upgradeMemberService: UpgradeMemberService\n    }\n  },\n  rxState() {\n    return {\n      info: this.upgradeMemberService.info$,\n      couponList: this.upgradeMemberService.couponList$,\n      advanceList: this.upgradeMemberService.advanceList$,\n      priceInfo: this.upgradeMemberService.priceInfo$,\n      saleList: this.upgradeMemberService.saleList$,\n      loading: this.upgradeMemberService.loading$\n    }\n  },\n  props: ['id'],\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      PERSON_TYPE,\n      form,\n      decorators,\n      show: false,\n      // 会员卡列表\n      cardList: [],\n      cardLists: {},\n      // 选择的卡\n      selectCardItem: {},\n      // 选择的卡的详情\n      upgradeCardInfo: {},\n      upgradeCardsInfo: {},\n      // 规格\n      selectSpecs: null,\n      // 选择的规格\n      selectSpecsItem: {},\n      // 初始额度可编辑\n      isAmountDisabled: true,\n      getValidTime: 0,\n      // 开卡方式\n      selectOpenType: null,\n      // 有效时间\n      startTime: null,\n      endTime: '-',\n      // 购买赠送\n      giftAmount: '',\n      // 商品金额\n      cardPrice: '0',\n      // 原卡折扣\n      surplusPrice: '',\n      // 优惠\n      couponDropdownVisible: false,\n      couponText: '未选择优惠券',\n      couponAmount: '',\n      selectCoupon: '',\n      // 定金\n      advanceDropdownVisible: false,\n      advanceText: '未选择定金',\n      advanceAmount: '',\n      selectAdvance: '',\n      // 减免金额\n      reduceAmount: '',\n      // 描述\n      description: ''\n    }\n  },\n  computed: {\n    // 是否未选择卡\n    selectCardIsNone() {\n      return !this.selectCardItem.id\n    },\n    // 卡跟规格，用来判断规格是否切换了，因为有可能不同的卡有同一个规格，但是同卡同规格是不会出现的\n    cardAndSpecs() {\n      return `${this.selectCardItem.id || ''}-${this.selectSpecsItem.id || ''}`\n    },\n    // 小计判断\n    orderAmountText() {\n      return this.priceInfo < 0 ? '小计不能为负' : ''\n    },\n    // 计算小计用\n    priceOB() {\n      return `${this.selectSpecs}-\n              ${this.selectAdvance}-\n              ${this.reduceAmount}-\n              ${this.selectCoupon}-\n              ${this.surplusPrice}`\n    },\n    isFamilyCard() {\n      return this.info.card_number_type === 2\n    }\n  },\n  watch: {\n    cardAndSpecs(newVal, oldVal) {\n      // 先重围优惠券\n      this.resetCoupon()\n      if (!this.upgradeCardInfo.id || !this.selectSpecsItem.id) return\n      this.upgradeMemberService.couponAction$.dispatch({\n        member_id: this.info.member_id,\n        card_id: this.upgradeCardInfo.id,\n        specs_id: this.selectSpecsItem.id\n      })\n    },\n    // 计算小计\n    priceOB() {\n      this.getPrice({\n        product_id: this.selectCardItem.id,\n        product_type: this.info.contract_type,\n        specs_id: +this.selectSpecs,\n        advance_id: this.selectAdvance === -1 ? '' : this.selectAdvance,\n        reduce_amount: +this.reduceAmount,\n        coupon_id: this.selectCoupon === -1 ? '' : this.selectCoupon,\n        member_id: +this.info.member_id,\n        surplus_amount: +this.surplusPrice\n      })\n    }\n  },\n  created() {\n    this.upgradeMemberService.serviceInit(this.id).subscribe()\n  },\n  methods: {\n    moment,\n    // 搜索会员卡\n    onCardSearch(data) {\n      if (data === '') {\n        this.cardList = []\n      } else {\n        // 判断之前是否请求过\n        if (!this.cardLists[data]) {\n          this.upgradeMemberService\n            .getCardList(data, this.info.card_number_type)\n            .subscribe(res => {\n              // 缓存请求结果\n              this.cardLists[data] = cloneDeep(res.list)\n              this.cardList = cloneDeep(res.list)\n            })\n        } else {\n          // 取缓存\n          this.cardList = cloneDeep(this.cardLists[data])\n        }\n      }\n    },\n    // 重置规格/开卡方式/有效时间/商品金额/购买赠送/表单重置\n    resetData() {\n      // 规格\n      this.selectSpecs = null\n      this.selectSpecsItem = {}\n      // 开卡方式\n      this.selectOpenType = null\n      // 有效时间\n      this.startTime = null\n      this.endTime = '-'\n      // 商品金额\n      this.cardPrice = '0'\n      // 购买赠送\n      this.giftAmount = ''\n      this.form.resetFields()\n    },\n    onSelectCardChange(data) {\n      if (data) {\n        // 选择了卡\n        this.selectCardItem = cloneDeep(\n          this.cardList.filter(i => i.id === data)[0]\n        )\n        // 获取选择的卡的详情\n        this.getUpgradeCardInfo(data)\n      } else {\n        // 清空了选择的卡\n        this.selectCardItem = {}\n        this.resetData()\n      }\n    },\n    getUpgradeCardInfo(id) {\n      // 判断之前是否请求过\n      if (!this.upgradeCardsInfo[id]) {\n        // 缓存请求结果\n        this.upgradeMemberService.getUpgradeCardInfo(id).subscribe(res => {\n          this.upgradeCardsInfo[id] = cloneDeep(res.info)\n          this.upgradeCardInfo = cloneDeep(res.info)\n          // 设置默认规格\n          this.selectSpecs = this.upgradeCardInfo.specs[0].id\n          this.selectSpecsItem = cloneDeep(this.upgradeCardInfo.specs[0])\n          // 设置默认开卡方式\n          this.selectOpenType = this.upgradeCardInfo.open_type[0].id\n          // 设置初始额度\n          this.form.setFieldsValue({\n            card_amount: this.selectSpecsItem.card_amount\n          })\n          this.getValidTime = this.selectSpecsItem.valid_time\n          this.form.validate(['card_amount'])\n          // 设置默认卡价格\n          this.cardPrice = this.upgradeCardInfo.specs[0].price\n        })\n      } else {\n        // 取缓存\n        this.upgradeCardInfo = cloneDeep(this.upgradeCardsInfo[id])\n        // 设置默认规格\n        this.selectSpecs = this.upgradeCardInfo.specs[0].id\n        this.selectSpecsItem = cloneDeep(this.upgradeCardInfo.specs[0])\n        // 设置默认开卡方式\n        this.selectOpenType = this.upgradeCardInfo.open_type[0].id\n        // 设置初始额度\n        this.form.setFieldsValue({\n          card_amount: this.selectSpecsItem.card_amount\n        })\n        this.form.validate(['card_amount'])\n        this.getValidTime = this.selectSpecsItem.valid_time\n        // 设置默认卡价格\n        this.cardPrice = this.upgradeCardInfo.specs[0].price\n      }\n    },\n    // 规格\n    onSpecsChange(data) {\n      this.selectSpecsItem = cloneDeep(\n        this.upgradeCardInfo.specs.filter(i => i.id === data.target.value)[0]\n      )\n      this.cardPrice = this.upgradeCardInfo.specs.filter(\n        i => i.id === data.target.value\n      )[0].price\n      // 重置选择的开始时间\n      this.form.resetFields(['startTime'])\n      this.endTime = '-'\n      this.form.setFieldsValue({\n        card_amount: this.selectSpecsItem.card_amount\n      })\n      this.getValidTime = this.selectSpecsItem.valid_time\n      this.form.validate(['card_amount'])\n    },\n    // 开卡方式\n    onOpenTypeChange(data) {\n      // 重置选择的开始时间\n      this.form.resetFields(['startTime'])\n      this.endTime = '-'\n    },\n    onClickAmountConfirm() {\n      const val = this.form.getFieldValue('card_amount')\n      const productType = this.upgradeCardInfo.product_type.id\n      const currentStartTime = moment(this.form.getFieldValue('startTime'))\n      this.isAmountDisabled = true\n      this.form.setFieldsValue({\n        card_amount: val\n      })\n      if (productType === 1) {\n        val = this.selectSpecsItem.valid_time\n      }\n      if (this.startTime) {\n        this.endTime = currentStartTime.add(val, 'd').format('YYYY-MM-DD HH:mm')\n      }\n      this.getValidTime = val\n    },\n    onClickAmountEdit() {\n      const val = this.form.getFieldValue('card_amount')\n      this.isAmountDisabled = false\n      this.form.setFieldsValue({\n        card_amount: val\n      })\n      this.form.validate(['card_amount'])\n    },\n    // 有效时间\n    disabledStartDate(startTime) {\n      return startTime.valueOf() < this.upgradeCardInfo.server_time * 1000\n    },\n    onStartTimeChange(data) {\n      this.startTime = cloneDeep(data)\n      let s = cloneDeep(data)\n      let productType = this.upgradeCardInfo.product_type.id\n      let dayScope = this.form.getFieldValue('card_amount')\n      if (productType === 1) {\n        dayScope = this.selectSpecsItem.valid_time\n      }\n      this.endTime = s.add(dayScope, 'd').format('YYYY-MM-DD HH:mm')\n    },\n    // 原卡折扣\n    onSurplusPriceChange(data) {\n      this.surplusPrice = data\n    },\n    // 优惠\n    onSelectCouponChange(data) {\n      if (data.target.value === -1) {\n        this.couponAmount = ''\n        this.couponText = '未选择优惠券'\n        return\n      }\n      let price = this.couponList.filter(o => o.id === data.target.value)[0]\n        .price\n      this.couponAmount = price\n      this.couponText = `${price}元`\n    },\n    onSelectCoupon() {\n      timer(200).subscribe(() => {\n        this.couponDropdownVisible = false\n      })\n    },\n    resetCoupon() {\n      this.upgradeMemberService.resetCouponList()\n      this.couponText = '未选择优惠券'\n      this.couponAmount = ''\n      this.selectCoupon = ''\n    },\n    // 定金\n    onSelectAdvanceChange(data) {\n      if (data.target.value === -1) {\n        this.advanceAmount = ''\n        this.advanceText = '未选择定金'\n        return\n      }\n      let price = this.advanceList.filter(o => o.id === data.target.value)[0]\n        .price\n      this.advanceAmount = price\n      this.advanceText = `${price}元`\n    },\n    onSelectAdvance() {\n      timer(200).subscribe(() => {\n        this.advanceDropdownVisible = false\n      })\n    },\n    resetAdvance() {\n      this.upgradeMemberService.resetAdvanceList()\n      this.advanceText = '未选择定金'\n      this.advanceAmount = ''\n      this.selectAdvance = ''\n    },\n    // 计算实付金额\n    getPrice(params) {\n      this.upgradeMemberService.priceAction$.dispatch(params)\n    },\n    onCreateOrder() {\n      this.form.validate((error, values) => {\n        if (!error) {\n          this.upgradeMemberService\n            .upgrade(\n              {\n                product_id: +values.memberCardId,\n                contract_number: this.info.contract_number,\n                rule_id: +this.selectSpecs,\n                surplus_price: +values.surplusPrice,\n                valid_start_time: moment(values.startTime).format(\n                  'YYYY-MM-DD HH:mm'\n                ),\n                open_card_type: +this.selectOpenType,\n                user_coupon_id: this.selectCoupon,\n                advance_id: this.selectAdvance,\n                reduce_price: +this.reduceAmount,\n                description: this.description,\n                staff_sale_id: +values.saleName,\n                gift_amount: +this.giftAmount,\n                init_amount: values.card_amount\n              },\n              this.id\n            )\n            .subscribe(res => {\n              this.show = false\n              this.$emit('success', {\n                type: 'create',\n                orderId: res.info.order_id,\n                soldId: res.info.sold_id,\n                isFamilyCard: this.isFamilyCard\n              })\n            })\n        }\n      })\n    },\n    onPay() {\n      this.form.validate((error, values) => {\n        if (!error) {\n          this.upgradeMemberService\n            .upgrade(\n              {\n                product_id: +values.memberCardId,\n                contract_number: this.info.contract_number,\n                rule_id: +this.selectSpecs,\n                surplus_price: +values.surplusPrice,\n                valid_start_time: moment(values.startTime).format(\n                  'YYYY-MM-DD HH:mm'\n                ),\n                open_card_type: +this.selectOpenType,\n                user_coupon_id: this.selectCoupon,\n                advance_id: this.selectAdvance,\n                reduce_price: +this.reduceAmount,\n                description: this.description,\n                staff_sale_id: +values.saleName,\n                gift_amount: +this.giftAmount,\n                init_amount: values.card_amount\n              },\n              this.id\n            )\n            .subscribe(res => {\n              this.show = false\n              this.$emit('success', {\n                type: 'createPay',\n                orderId: res.info.order_id,\n                soldId: res.info.sold_id,\n                isFamilyCard: this.isFamilyCard\n              })\n            })\n        }\n      })\n    },\n    onCancel() {\n      this.upgradeMemberService.resetCouponList()\n      this.upgradeMemberService.resetAdvanceList()\n    }\n  }\n}\n</script>\n"]}]}