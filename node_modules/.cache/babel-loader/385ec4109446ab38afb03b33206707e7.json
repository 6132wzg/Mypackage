{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/activity-registration/components#/step1-form.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/activity-registration/components#/step1-form.vue","mtime":1600926556119},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { ruleOptions } from \"./form.config\";\nimport { PatternService } from '@/services/pattern.service';\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue';\nimport MapButton from '@/views/components/map-button#/map-button';\nimport StEditor from '@/views/components/editor#/editor.vue';\nimport moment from 'moment';\nimport { ACTIVITY_STATUS } from '@/constants/brand/marketing';\nimport { cloneDeep } from 'lodash-es';\nimport { CopyService } from \"../copy.service\";\nimport { EditService } from \"../edit.service\";\nexport default {\n  name: 'Step1Form',\n  bem: {\n    b: 'step-form-activity'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      copyService: CopyService,\n      editService: EditService,\n      pattern: PatternService\n    };\n  },\n  rxState: function rxState() {\n    var defaultForm$ = this.copyService.defaultForm$;\n    return {\n      defaultForm$: defaultForm$\n    };\n  },\n  data: function data() {\n    var that = this;\n    var form = this.$stForm.create({\n      onValuesChange: function onValuesChange(props, values) {\n        that.$nextTick().then(function () {\n          that.formInfo = _objectSpread({}, that.formInfo, {}, that.form.getFieldsValue());\n          that.$emit('change', that.formInfo);\n        });\n      }\n    });\n    var decorators = form.decorators(ruleOptions);\n    return {\n      ACTIVITY_STATUS: ACTIVITY_STATUS,\n      isEditor: false,\n      isPoster: false,\n      isAddress: false,\n      form: form,\n      formInfo: {},\n      decorators: decorators,\n      fileShareList: [],\n      address: {},\n      content: ''\n    };\n  },\n  props: {\n    isCopy: {\n      type: Boolean,\n      default: false\n    },\n    isEdit: {\n      type: Boolean,\n      default: false\n    },\n    show: {\n      type: Boolean,\n      default: false\n    }\n  },\n  computed: {\n    isMemberNumDisabled: function isMemberNumDisabled() {\n      return this.isEdit && this.defaultForm$.activity_status === ACTIVITY_STATUS.PUBLISHED && this.defaultForm$.member_limit_num === 0;\n    }\n  },\n  created: function created() {\n    if (!this.isCopy && !this.isEdit) return;\n    this.initForm();\n  },\n  components: {\n    MapButton: MapButton,\n    StEditor: StEditor,\n    StImageUpload: StImageUpload\n  },\n  watch: {\n    content: function content(newValue, oldValue) {\n      this.$set(this.formInfo, 'content', newValue);\n      this.$emit('change', this.formInfo);\n    }\n  },\n  methods: {\n    moment: moment,\n    onChangeEditor: function onChangeEditor() {\n      this.isEditor = this.content.length === 0;\n      return this.content.length === 0;\n    },\n    onChangePoster: function onChangePoster() {\n      this.isPoster = this.fileShareList.length === 0;\n      return this.fileShareList.length === 0;\n    },\n    onChangeAddress: function onChangeAddress() {\n      this.isAddress = !!!this.address.address;\n      return !!!this.address.address;\n    },\n    initForm: function initForm() {\n      var _this = this;\n\n      this.$nextTick().then(function () {\n        var date = [moment(_this.defaultForm$.start_time), moment(_this.defaultForm$.end_time)];\n        _this.content = _this.defaultForm$.description;\n\n        _this.fileShareList.push(_this.defaultForm$.image);\n\n        _this.$set(_this.formInfo, 'imageUrl', _this.defaultForm$.image.image_url);\n\n        var _this$defaultForm$ = _this.defaultForm$,\n            address = _this$defaultForm$.address,\n            lat = _this$defaultForm$.lat,\n            lng = _this$defaultForm$.lng,\n            district = _this$defaultForm$.district,\n            province = _this$defaultForm$.province,\n            city = _this$defaultForm$.city;\n        _this.address = {\n          address: address,\n          lat: lat,\n          lng: lng,\n          district: district,\n          province: province,\n          city: city\n        };\n\n        _this.$set(_this.formInfo, 'address', address);\n\n        _this.$emit('change', _this.formInfo);\n\n        _this.form.setFieldsValue({\n          activity_name: _this.defaultForm$.activity_name,\n          date: date,\n          member_limit_num: _this.defaultForm$.member_limit_num\n        });\n      });\n    },\n    onShareChangeGetImage: function onShareChangeGetImage(imageFiles) {\n      // 如果是编辑应该把原来image_id传过去\n      if (this.defaultForm$.image && this.isEdit) {\n        imageFiles[0].image_id = this.defaultForm$.image.image_id;\n      }\n\n      this.$set(this.formInfo, 'imageUrl', imageFiles[0].image_url);\n      this.$emit('change', this.formInfo);\n      this.fileShareList = cloneDeep(imageFiles);\n      this.onChangePoster();\n    },\n    onSelectGetAddress: function onSelectGetAddress(address) {\n      this.$set(this.formInfo, 'address', address.address);\n      this.$emit('change', this.formInfo);\n      this.address = address;\n      this.onChangeAddress();\n    },\n    disabledDate: function disabledDate(current) {\n      return current && current.format('YYYY-MM-DD') < moment().format('YYYY-MM-DD');\n    },\n    onSubmit: function onSubmit() {\n      var _this2 = this;\n\n      this.form.validate().then(function (values) {\n        if (_this2.onChangeEditor() || _this2.onChangePoster() || _this2.onChangeAddress()) return;\n        var activity_name = values.activity_name,\n            member_limit_num = values.member_limit_num;\n        var start_time = values.date[0].format('YYYY-MM-DD HH:mm');\n        var end_time = values.date[1].format('YYYY-MM-DD HH:mm');\n        var image = _this2.file;\n        var _this2$address = _this2.address,\n            address = _this2$address.address,\n            province = _this2$address.province,\n            city = _this2$address.city,\n            district = _this2$address.district,\n            lat = _this2$address.lat,\n            lng = _this2$address.lng;\n        var activity_id = _this2.isEdit ? _this2.defaultForm$.activity_id : undefined;\n        var form = {\n          activity_id: activity_id,\n          address: address,\n          province: province,\n          city: city,\n          district: district,\n          lat: lat,\n          lng: lng,\n          end_time: end_time,\n          start_time: start_time,\n          activity_name: activity_name,\n          member_limit_num: +member_limit_num,\n          description: _this2.content,\n          image: _this2.fileShareList[0]\n        };\n\n        _this2.$emit('step-submit', form);\n      }).catch(function () {\n        if (_this2.onChangeEditor() && _this2.onChangePoster() && _this2.onChangeAddress()) return;\n      });\n    }\n  }\n};",{"version":3,"sources":["step1-form.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuEA,SAAA,WAAA;AACA,SAAA,cAAA,QAAA,4BAAA;AACA,OAAA,aAAA,MAAA,mDAAA;AACA,OAAA,SAAA,MAAA,2CAAA;AACA,OAAA,QAAA,MAAA,uCAAA;AACA,OAAA,MAAA,MAAA,QAAA;AACA,SAAA,eAAA,QAAA,6BAAA;AACA,SAAA,SAAA,QAAA,WAAA;AACA,SAAA,WAAA;AACA,SAAA,WAAA;AAEA,eAAA;AACA,EAAA,IAAA,EAAA,WADA;AAEA,EAAA,GAAA,EAAA;AACA,IAAA,CAAA,EAAA;AADA,GAFA;AAKA,EAAA,aALA,2BAKA;AACA,WAAA;AACA,MAAA,WAAA,EAAA,WADA;AAEA,MAAA,WAAA,EAAA,WAFA;AAGA,MAAA,OAAA,EAAA;AAHA,KAAA;AAKA,GAXA;AAYA,EAAA,OAZA,qBAYA;AAAA,QACA,YADA,GACA,KAAA,WADA,CACA,YADA;AAEA,WAAA;AACA,MAAA,YAAA,EAAA;AADA,KAAA;AAGA,GAjBA;AAkBA,EAAA,IAlBA,kBAkBA;AACA,QAAA,IAAA,GAAA,IAAA;AACA,QAAA,IAAA,GAAA,KAAA,OAAA,CAAA,MAAA,CAAA;AACA,MAAA,cADA,0BACA,KADA,EACA,MADA,EACA;AACA,QAAA,IAAA,CAAA,SAAA,GAAA,IAAA,CAAA,YAAA;AACA,UAAA,IAAA,CAAA,QAAA,qBAAA,IAAA,CAAA,QAAA,MAAA,IAAA,CAAA,IAAA,CAAA,cAAA,EAAA;AACA,UAAA,IAAA,CAAA,KAAA,CAAA,QAAA,EAAA,IAAA,CAAA,QAAA;AACA,SAHA;AAIA;AANA,KAAA,CAAA;AAQA,QAAA,UAAA,GAAA,IAAA,CAAA,UAAA,CAAA,WAAA,CAAA;AACA,WAAA;AACA,MAAA,eAAA,EAAA,eADA;AAEA,MAAA,QAAA,EAAA,KAFA;AAGA,MAAA,QAAA,EAAA,KAHA;AAIA,MAAA,SAAA,EAAA,KAJA;AAKA,MAAA,IAAA,EAAA,IALA;AAMA,MAAA,QAAA,EAAA,EANA;AAOA,MAAA,UAAA,EAAA,UAPA;AAQA,MAAA,aAAA,EAAA,EARA;AASA,MAAA,OAAA,EAAA,EATA;AAUA,MAAA,OAAA,EAAA;AAVA,KAAA;AAYA,GAzCA;AA0CA,EAAA,KAAA,EAAA;AACA,IAAA,MAAA,EAAA;AACA,MAAA,IAAA,EAAA,OADA;AAEA,MAAA,OAAA,EAAA;AAFA,KADA;AAKA,IAAA,MAAA,EAAA;AACA,MAAA,IAAA,EAAA,OADA;AAEA,MAAA,OAAA,EAAA;AAFA,KALA;AASA,IAAA,IAAA,EAAA;AACA,MAAA,IAAA,EAAA,OADA;AAEA,MAAA,OAAA,EAAA;AAFA;AATA,GA1CA;AAwDA,EAAA,QAAA,EAAA;AACA,IAAA,mBADA,iCACA;AACA,aACA,KAAA,MAAA,IACA,KAAA,YAAA,CAAA,eAAA,KAAA,eAAA,CAAA,SADA,IAEA,KAAA,YAAA,CAAA,gBAAA,KAAA,CAHA;AAKA;AAPA,GAxDA;AAiEA,EAAA,OAjEA,qBAiEA;AACA,QAAA,CAAA,KAAA,MAAA,IAAA,CAAA,KAAA,MAAA,EAAA;AACA,SAAA,QAAA;AACA,GApEA;AAqEA,EAAA,UAAA,EAAA;AACA,IAAA,SAAA,EAAA,SADA;AAEA,IAAA,QAAA,EAAA,QAFA;AAGA,IAAA,aAAA,EAAA;AAHA,GArEA;AA0EA,EAAA,KAAA,EAAA;AACA,IAAA,OADA,mBACA,QADA,EACA,QADA,EACA;AACA,WAAA,IAAA,CAAA,KAAA,QAAA,EAAA,SAAA,EAAA,QAAA;AACA,WAAA,KAAA,CAAA,QAAA,EAAA,KAAA,QAAA;AACA;AAJA,GA1EA;AAgFA,EAAA,OAAA,EAAA;AACA,IAAA,MAAA,EAAA,MADA;AAEA,IAAA,cAFA,4BAEA;AACA,WAAA,QAAA,GAAA,KAAA,OAAA,CAAA,MAAA,KAAA,CAAA;AACA,aAAA,KAAA,OAAA,CAAA,MAAA,KAAA,CAAA;AACA,KALA;AAMA,IAAA,cANA,4BAMA;AACA,WAAA,QAAA,GAAA,KAAA,aAAA,CAAA,MAAA,KAAA,CAAA;AACA,aAAA,KAAA,aAAA,CAAA,MAAA,KAAA,CAAA;AACA,KATA;AAUA,IAAA,eAVA,6BAUA;AACA,WAAA,SAAA,GAAA,CAAA,CAAA,CAAA,KAAA,OAAA,CAAA,OAAA;AACA,aAAA,CAAA,CAAA,CAAA,KAAA,OAAA,CAAA,OAAA;AACA,KAbA;AAcA,IAAA,QAdA,sBAcA;AAAA;;AACA,WAAA,SAAA,GAAA,IAAA,CAAA,YAAA;AACA,YAAA,IAAA,GAAA,CACA,MAAA,CAAA,KAAA,CAAA,YAAA,CAAA,UAAA,CADA,EAEA,MAAA,CAAA,KAAA,CAAA,YAAA,CAAA,QAAA,CAFA,CAAA;AAIA,QAAA,KAAA,CAAA,OAAA,GAAA,KAAA,CAAA,YAAA,CAAA,WAAA;;AACA,QAAA,KAAA,CAAA,aAAA,CAAA,IAAA,CAAA,KAAA,CAAA,YAAA,CAAA,KAAA;;AACA,QAAA,KAAA,CAAA,IAAA,CAAA,KAAA,CAAA,QAAA,EAAA,UAAA,EAAA,KAAA,CAAA,YAAA,CAAA,KAAA,CAAA,SAAA;;AAPA,iCAeA,KAAA,CAAA,YAfA;AAAA,YASA,OATA,sBASA,OATA;AAAA,YAUA,GAVA,sBAUA,GAVA;AAAA,YAWA,GAXA,sBAWA,GAXA;AAAA,YAYA,QAZA,sBAYA,QAZA;AAAA,YAaA,QAbA,sBAaA,QAbA;AAAA,YAcA,IAdA,sBAcA,IAdA;AAgBA,QAAA,KAAA,CAAA,OAAA,GAAA;AACA,UAAA,OAAA,EAAA,OADA;AAEA,UAAA,GAAA,EAAA,GAFA;AAGA,UAAA,GAAA,EAAA,GAHA;AAIA,UAAA,QAAA,EAAA,QAJA;AAKA,UAAA,QAAA,EAAA,QALA;AAMA,UAAA,IAAA,EAAA;AANA,SAAA;;AAQA,QAAA,KAAA,CAAA,IAAA,CAAA,KAAA,CAAA,QAAA,EAAA,SAAA,EAAA,OAAA;;AACA,QAAA,KAAA,CAAA,KAAA,CAAA,QAAA,EAAA,KAAA,CAAA,QAAA;;AACA,QAAA,KAAA,CAAA,IAAA,CAAA,cAAA,CAAA;AACA,UAAA,aAAA,EAAA,KAAA,CAAA,YAAA,CAAA,aADA;AAEA,UAAA,IAAA,EAAA,IAFA;AAGA,UAAA,gBAAA,EAAA,KAAA,CAAA,YAAA,CAAA;AAHA,SAAA;AAKA,OA/BA;AAgCA,KA/CA;AAgDA,IAAA,qBAhDA,iCAgDA,UAhDA,EAgDA;AACA;AACA,UAAA,KAAA,YAAA,CAAA,KAAA,IAAA,KAAA,MAAA,EAAA;AACA,QAAA,UAAA,CAAA,CAAA,CAAA,CAAA,QAAA,GAAA,KAAA,YAAA,CAAA,KAAA,CAAA,QAAA;AACA;;AACA,WAAA,IAAA,CAAA,KAAA,QAAA,EAAA,UAAA,EAAA,UAAA,CAAA,CAAA,CAAA,CAAA,SAAA;AACA,WAAA,KAAA,CAAA,QAAA,EAAA,KAAA,QAAA;AACA,WAAA,aAAA,GAAA,SAAA,CAAA,UAAA,CAAA;AACA,WAAA,cAAA;AACA,KAzDA;AA0DA,IAAA,kBA1DA,8BA0DA,OA1DA,EA0DA;AACA,WAAA,IAAA,CAAA,KAAA,QAAA,EAAA,SAAA,EAAA,OAAA,CAAA,OAAA;AACA,WAAA,KAAA,CAAA,QAAA,EAAA,KAAA,QAAA;AACA,WAAA,OAAA,GAAA,OAAA;AACA,WAAA,eAAA;AACA,KA/DA;AAgEA,IAAA,YAhEA,wBAgEA,OAhEA,EAgEA;AACA,aACA,OAAA,IAAA,OAAA,CAAA,MAAA,CAAA,YAAA,IAAA,MAAA,GAAA,MAAA,CAAA,YAAA,CADA;AAGA,KApEA;AAqEA,IAAA,QArEA,sBAqEA;AAAA;;AACA,WAAA,IAAA,CACA,QADA,GAEA,IAFA,CAEA,UAAA,MAAA,EAAA;AACA,YACA,MAAA,CAAA,cAAA,MACA,MAAA,CAAA,cAAA,EADA,IAEA,MAAA,CAAA,eAAA,EAHA,EAKA;AANA,YAOA,aAPA,GAOA,MAPA,CAOA,aAPA;AAAA,YAOA,gBAPA,GAOA,MAPA,CAOA,gBAPA;AAQA,YAAA,UAAA,GAAA,MAAA,CAAA,IAAA,CAAA,CAAA,EAAA,MAAA,CAAA,kBAAA,CAAA;AACA,YAAA,QAAA,GAAA,MAAA,CAAA,IAAA,CAAA,CAAA,EAAA,MAAA,CAAA,kBAAA,CAAA;AACA,YAAA,KAAA,GAAA,MAAA,CAAA,IAAA;AAVA,6BAWA,MAAA,CAAA,OAXA;AAAA,YAWA,OAXA,kBAWA,OAXA;AAAA,YAWA,QAXA,kBAWA,QAXA;AAAA,YAWA,IAXA,kBAWA,IAXA;AAAA,YAWA,QAXA,kBAWA,QAXA;AAAA,YAWA,GAXA,kBAWA,GAXA;AAAA,YAWA,GAXA,kBAWA,GAXA;AAYA,YAAA,WAAA,GAAA,MAAA,CAAA,MAAA,GACA,MAAA,CAAA,YAAA,CAAA,WADA,GAEA,SAFA;AAGA,YAAA,IAAA,GAAA;AACA,UAAA,WAAA,EAAA,WADA;AAEA,UAAA,OAAA,EAAA,OAFA;AAGA,UAAA,QAAA,EAAA,QAHA;AAIA,UAAA,IAAA,EAAA,IAJA;AAKA,UAAA,QAAA,EAAA,QALA;AAMA,UAAA,GAAA,EAAA,GANA;AAOA,UAAA,GAAA,EAAA,GAPA;AAQA,UAAA,QAAA,EAAA,QARA;AASA,UAAA,UAAA,EAAA,UATA;AAUA,UAAA,aAAA,EAAA,aAVA;AAWA,UAAA,gBAAA,EAAA,CAAA,gBAXA;AAYA,UAAA,WAAA,EAAA,MAAA,CAAA,OAZA;AAaA,UAAA,KAAA,EAAA,MAAA,CAAA,aAAA,CAAA,CAAA;AAbA,SAAA;;AAeA,QAAA,MAAA,CAAA,KAAA,CAAA,aAAA,EAAA,IAAA;AACA,OAjCA,EAkCA,KAlCA,CAkCA,YAAA;AACA,YACA,MAAA,CAAA,cAAA,MACA,MAAA,CAAA,cAAA,EADA,IAEA,MAAA,CAAA,eAAA,EAHA,EAKA;AACA,OAzCA;AA0CA;AAhHA;AAhFA,CAAA","sourcesContent":["<template>\n  <a-row>\n    <a-col :xl=\"14\">\n      <st-form :form=\"form\" :class=\"b()\">\n        <st-form-item label=\"活动标题\" required>\n          <a-input\n            placeholder=\"请输入活动标题\"\n            maxlength=\"15\"\n            v-decorator=\"decorators.activity_name\"\n          ></a-input>\n        </st-form-item>\n        <st-form-item label=\"活动时间\" required>\n          <a-range-picker\n            v-decorator=\"decorators.date\"\n            :disabledDate=\"disabledDate\"\n            :class=\"b('picker')\"\n            :showTime=\"{ format: 'HH:mm' }\"\n            format=\"YYYY-MM-DD HH:mm\"\n          />\n        </st-form-item>\n        <st-form-item label=\"活动地点\" required>\n          <map-button\n            addText=\"设置活动地点\"\n            :lat=\"address.lat\"\n            :lng=\"address.lng\"\n            :province=\"address.province\"\n            :city=\"address.city\"\n            :district=\"address.district\"\n            :address=\"address.address\"\n            @select=\"onSelectGetAddress\"\n          ></map-button>\n          <div class=\"color-danger\" v-if=\"isAddress\">请选择地址</div>\n        </st-form-item>\n        <st-form-item label=\"活动海报\" required>\n          <st-image-upload\n            width=\"220px\"\n            height=\"140px\"\n            :list=\"fileShareList\"\n            @change=\"onShareChangeGetImage\"\n            placeholder=\"上传图片\"\n          >\n            <template v-slot:description>\n              <p>请上传jpg、png格式的图片</p>\n              <p>大小不超过2M，建议尺寸16:9</p>\n            </template>\n          </st-image-upload>\n          <div class=\"color-danger\" v-if=\"isPoster\">请上传活动海报</div>\n        </st-form-item>\n        <st-form-item label=\"活动人数\" required>\n          <st-input-number\n            placeholder=\"若不限制活动人数，请填写0\"\n            :min=\"0\"\n            :disabled=\"isMemberNumDisabled\"\n            :max=\"9999\"\n            v-decorator=\"decorators.member_limit_num\"\n          ></st-input-number>\n        </st-form-item>\n        <st-form-item label=\"活动详情\" required>\n          <st-editor @input=\"onChangeEditor\" v-model=\"content\"></st-editor>\n          <div class=\"color-danger\" v-if=\"isEditor\">请输入活动详情</div>\n        </st-form-item>\n        <portal to=\"BRAND_MARKETING_ACTIVITY_FORM_ACTIONS\" v-if=\"show\">\n          <st-button type=\"primary\" @click=\"onSubmit\">下一步</st-button>\n        </portal>\n      </st-form>\n    </a-col>\n    <a-col :xl=\"10\"></a-col>\n  </a-row>\n</template>\n\n<script>\nimport { ruleOptions } from './form.config'\nimport { PatternService } from '@/services/pattern.service'\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue'\nimport MapButton from '@/views/components/map-button#/map-button'\nimport StEditor from '@/views/components/editor#/editor.vue'\nimport moment from 'moment'\nimport { ACTIVITY_STATUS } from '@/constants/brand/marketing'\nimport { cloneDeep } from 'lodash-es'\nimport { CopyService } from '../copy.service'\nimport { EditService } from '../edit.service'\n\nexport default {\n  name: 'Step1Form',\n  bem: {\n    b: 'step-form-activity'\n  },\n  serviceInject() {\n    return {\n      copyService: CopyService,\n      editService: EditService,\n      pattern: PatternService\n    }\n  },\n  rxState() {\n    const { defaultForm$ } = this.copyService\n    return {\n      defaultForm$\n    }\n  },\n  data() {\n    const that = this\n    const form = this.$stForm.create({\n      onValuesChange(props, values) {\n        that.$nextTick().then(() => {\n          that.formInfo = { ...that.formInfo, ...that.form.getFieldsValue() }\n          that.$emit('change', that.formInfo)\n        })\n      }\n    })\n    const decorators = form.decorators(ruleOptions)\n    return {\n      ACTIVITY_STATUS,\n      isEditor: false,\n      isPoster: false,\n      isAddress: false,\n      form,\n      formInfo: {},\n      decorators,\n      fileShareList: [],\n      address: {},\n      content: ''\n    }\n  },\n  props: {\n    isCopy: {\n      type: Boolean,\n      default: false\n    },\n    isEdit: {\n      type: Boolean,\n      default: false\n    },\n    show: {\n      type: Boolean,\n      default: false\n    }\n  },\n  computed: {\n    isMemberNumDisabled() {\n      return (\n        this.isEdit &&\n        this.defaultForm$.activity_status === ACTIVITY_STATUS.PUBLISHED &&\n        this.defaultForm$.member_limit_num === 0\n      )\n    }\n  },\n  created() {\n    if (!this.isCopy && !this.isEdit) return\n    this.initForm()\n  },\n  components: {\n    MapButton,\n    StEditor,\n    StImageUpload\n  },\n  watch: {\n    content(newValue, oldValue) {\n      this.$set(this.formInfo, 'content', newValue)\n      this.$emit('change', this.formInfo)\n    }\n  },\n  methods: {\n    moment,\n    onChangeEditor() {\n      this.isEditor = this.content.length === 0\n      return this.content.length === 0\n    },\n    onChangePoster() {\n      this.isPoster = this.fileShareList.length === 0\n      return this.fileShareList.length === 0\n    },\n    onChangeAddress() {\n      this.isAddress = !!!this.address.address\n      return !!!this.address.address\n    },\n    initForm() {\n      this.$nextTick().then(() => {\n        const date = [\n          moment(this.defaultForm$.start_time),\n          moment(this.defaultForm$.end_time)\n        ]\n        this.content = this.defaultForm$.description\n        this.fileShareList.push(this.defaultForm$.image)\n        this.$set(this.formInfo, 'imageUrl', this.defaultForm$.image.image_url)\n        const {\n          address,\n          lat,\n          lng,\n          district,\n          province,\n          city\n        } = this.defaultForm$\n        this.address = {\n          address,\n          lat,\n          lng,\n          district,\n          province,\n          city\n        }\n        this.$set(this.formInfo, 'address', address)\n        this.$emit('change', this.formInfo)\n        this.form.setFieldsValue({\n          activity_name: this.defaultForm$.activity_name,\n          date,\n          member_limit_num: this.defaultForm$.member_limit_num\n        })\n      })\n    },\n    onShareChangeGetImage(imageFiles) {\n      // 如果是编辑应该把原来image_id传过去\n      if (this.defaultForm$.image && this.isEdit) {\n        imageFiles[0].image_id = this.defaultForm$.image.image_id\n      }\n      this.$set(this.formInfo, 'imageUrl', imageFiles[0].image_url)\n      this.$emit('change', this.formInfo)\n      this.fileShareList = cloneDeep(imageFiles)\n      this.onChangePoster()\n    },\n    onSelectGetAddress(address) {\n      this.$set(this.formInfo, 'address', address.address)\n      this.$emit('change', this.formInfo)\n      this.address = address\n      this.onChangeAddress()\n    },\n    disabledDate(current) {\n      return (\n        current && current.format('YYYY-MM-DD') < moment().format('YYYY-MM-DD')\n      )\n    },\n    onSubmit() {\n      this.form\n        .validate()\n        .then(values => {\n          if (\n            this.onChangeEditor() ||\n            this.onChangePoster() ||\n            this.onChangeAddress()\n          )\n            return\n          let { activity_name, member_limit_num } = values\n          const start_time = values.date[0].format('YYYY-MM-DD HH:mm')\n          const end_time = values.date[1].format('YYYY-MM-DD HH:mm')\n          const image = this.file\n          const { address, province, city, district, lat, lng } = this.address\n          const activity_id = this.isEdit\n            ? this.defaultForm$.activity_id\n            : undefined\n          const form = {\n            activity_id,\n            address,\n            province,\n            city,\n            district,\n            lat,\n            lng,\n            end_time,\n            start_time,\n            activity_name,\n            member_limit_num: +member_limit_num,\n            description: this.content,\n            image: this.fileShareList[0]\n          }\n          this.$emit('step-submit', form)\n        })\n        .catch(() => {\n          if (\n            this.onChangeEditor() &&\n            this.onChangePoster() &&\n            this.onChangeAddress()\n          )\n            return\n        })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/brand/marketing/plugin/activity-registration/components#"}]}