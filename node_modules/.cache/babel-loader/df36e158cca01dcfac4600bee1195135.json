{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/member-search/member-search.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/member-search/member-search.vue","mtime":1597396799922},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { MemberSearchService } from \"./member-search.service\";\nimport { merge } from 'lodash-es';\nimport { ruleOptions } from \"./member-search.config\";\nimport { PatternService } from '@/services/pattern.service';\nimport InputPhone from '@/views/biz-components/input-phone/input-phone';\nexport default {\n  name: 'MemberSearch',\n  model: {\n    event: 'change'\n  },\n  props: {\n    value: {\n      type: String\n    },\n    id: {\n      type: String\n    },\n    label: {\n      type: String,\n      default: '购买会员'\n    },\n\n    /**\n     * 会员查询类型 transaction | transfer\n     */\n    type: {\n      type: String,\n      default: 'transaction' // required: true\n\n    },\n    placeholder: {\n      type: String,\n      default: '输入手机号或会员名搜索'\n    },\n    // 外部 form 表单 必传\n    form: {\n      type: Object,\n      required: true\n    },\n    fields: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    // 回填会员填写信息\n    memberInfo: {\n      type: Object // default: () => {\n      //   return {\n      //     member_id: 110676207534127,\n      //     member_name: '张飞123222',\n      //     member_mobile: 19134752085\n      //   }\n      // }\n\n    },\n    saleRangeType: {\n      type: Number,\n      default: 1\n    },\n    isSoldDeal: {\n      type: Boolean,\n      default: false\n    }\n  },\n  serviceInject: function serviceInject() {\n    return {\n      memberSearchService: MemberSearchService,\n      pattern: PatternService\n    };\n  },\n  serviceProviders: function serviceProviders() {\n    return [MemberSearchService];\n  },\n  rxState: function rxState() {\n    var _this$memberSearchSer = this.memberSearchService,\n        memberList$ = _this$memberSearchSer.memberList$,\n        loading$ = _this$memberSearchSer.loading$,\n        id_types$ = _this$memberSearchSer.id_types$;\n    return {\n      memberList$: memberList$,\n      loading$: loading$,\n      parent_types: this.memberSearchService.parent_types$,\n      id_types: this.memberSearchService.id_types$\n    };\n  },\n  data: function data() {\n    return {\n      memberSearchText: '',\n      searchMemberIsShow: true,\n      personModel: 0,\n      selectInfo: {},\n      disabledParentMobile: false,\n      idCardValidatorText: '',\n      cardNumValidatorText: '',\n      pidValidatorText: ''\n    };\n  },\n  computed: {\n    ruleOptions: ruleOptions,\n    decorators: function decorators() {\n      return this.form.addDecorators(this.ruleOptions);\n    },\n    usedFields: function usedFields() {\n      return merge({\n        member_id: 'member_id',\n        mobile: 'mobile',\n        member_name: 'member_name',\n        parent_name: 'parent_name',\n        is_minors: 'is_minors',\n        parent_mobile: 'parent_mobile',\n        parent_user_role: 'parent_user_role',\n        id_card: 'id_card',\n        id_card_type: 'id_card_type',\n        card_num: 'card_num',\n        physical_id: 'physical_id'\n      }, this.fields);\n    },\n    memberId: function memberId() {\n      return this.usedFields.member_id;\n    },\n    memberMobile: function memberMobile() {\n      return this.usedFields.mobile;\n    },\n    memberName: function memberName() {\n      return this.usedFields.member_name;\n    },\n    parentName: function parentName() {\n      return this.usedFields.parent_name;\n    },\n    isMinors: function isMinors() {\n      return this.usedFields.is_minors;\n    },\n    parentMobile: function parentMobile() {\n      return this.usedFields.parent_mobile;\n    },\n    parentUserRole: function parentUserRole() {\n      return this.usedFields.parent_user_role;\n    },\n    idCard: function idCard() {\n      return this.usedFields.id_card;\n    },\n    idCardType: function idCardType() {\n      return this.usedFields.id_card_type;\n    },\n    cardNum: function cardNum() {\n      return this.usedFields.card_num;\n    },\n    physicalId: function physicalId() {\n      return this.usedFields.physical_id;\n    }\n  },\n  methods: {\n    idCardValidator: function idCardValidator(e) {\n      var value = e.target.value;\n      var pattern = this.pattern;\n      var id_card_type = this.form.getFieldValue('id_card_type');\n      this.idCardValidatorText = '';\n\n      if (id_card_type === 1 && value && !pattern.ID.test(value)) {\n        this.idCardValidatorText = '请填写正确的身份证号';\n      }\n\n      if (id_card_type === 2 && value && !pattern.PASSPORT.test(value)) {\n        this.idCardValidatorText = '请填写正确的护照号码';\n      }\n    },\n    cardNumValidator: function cardNumValidator(e) {\n      var value = e.target.value;\n\n      if (!value || value.length > 20) {\n        this.cardNumValidatorText = '请输入正确格式的卡号';\n      } else {\n        this.cardNumValidatorText = '';\n      }\n    },\n    pidValidator: function pidValidator(e) {\n      var value = e.target.value;\n\n      if (!value || value.length > 10) {\n        this.pidValidatorText = '请输入正确格式的物理ID';\n      } else {\n        this.pidValidatorText = '';\n      }\n    },\n    onChangeParentMobile: function onChangeParentMobile(val) {\n      var _this = this;\n\n      setTimeout(function () {\n        _this.form.validate(['parent_mobile']).then(function (values) {\n          val.mobile = val.phone;\n\n          _this.memberSearchService.getParentInfoByPhone(val).subscribe(function (res) {\n            if (res.exists) {\n              _this.disabledParentMobile = true;\n\n              _this.form.setFieldsValue({\n                parent_name: res.info.member_name\n              });\n            } else {\n              _this.disabledParentMobile = false;\n\n              _this.form.setFieldsValue({\n                parent_name: ''\n              });\n            }\n          });\n        });\n      });\n    },\n    selectItemLabel: function selectItemLabel(item) {\n      if (item.is_minors === 1) {\n        return \"\".concat(item.member_name, \"(\\u672A\\u6210\\u5E74) \").concat(item.parent_mobile, \"(\").concat(item.parent_user_role, \")\");\n      }\n\n      return \"\".concat(item.member_name, \" \").concat(item.mobile);\n    },\n    onSelectMember: function onSelectMember(val) {\n      var _this$form$setFieldsV;\n\n      console.log('memberList', this.memberList$);\n      this.selectInfo = val ? this.memberList$.filter(function (item) {\n        return item.id === val;\n      })[0] : {};\n      this.form.setFieldsValue((_this$form$setFieldsV = {}, _defineProperty(_this$form$setFieldsV, this.memberId, this.selectInfo.memberId || undefined), _defineProperty(_this$form$setFieldsV, this.physicalId, this.selectInfo.physical_id || undefined), _defineProperty(_this$form$setFieldsV, this.idCard, this.selectInfo.id_card || undefined), _defineProperty(_this$form$setFieldsV, this.cardNum, this.selectInfo.card_num || undefined), _defineProperty(_this$form$setFieldsV, this.idCardType, this.selectInfo.id_card_type || 1), _this$form$setFieldsV));\n      console.log('this.selectInfo', this.selectInfo); // setTimeout(() => {\n      // })\n\n      this.$emit('select', val);\n    },\n    onChangeMember: function onChangeMember(val) {\n      console.log('onChangeMember', val);\n\n      if (!val) {\n        this.onSelectMember(val);\n      } else {\n        // TODO: b254dd12 fix: 购买会员change事件 三个月前\n        this.$emit('change', val);\n      }\n    },\n    onChangeModel: function onChangeModel(val) {\n      this.personModel = val;\n    },\n    // 搜索会员\n    onMemberSearch: function onMemberSearch(data) {\n      var _this2 = this;\n\n      this.memberSearchText = data;\n\n      if (data === '') {\n        this.memberSearchService.RESET_LIST();\n        this.form.resetFields([this.memberId]);\n        this.$emit('change:list', []);\n      } else {\n        this.memberSearchService.getMember(data, this.saleRangeType);\n        this.memberSearchService.getMemberAction$.subscribe(function (list) {\n          if (!list.length) {\n            _this2.form.resetFields([_this2.memberId]);\n\n            _this2.onChangeMember('');\n          } else {\n            console.log('memberInfo', _this2.memberInfo);\n\n            if (_this2.memberInfo) {\n              _this2.form.setFieldsValue(_defineProperty({}, _this2.memberId, _this2.memberInfo.member_id));\n\n              _this2.onChangeMember(_this2.memberInfo.member_id);\n            }\n          }\n        });\n      }\n    },\n    // 切换新增会员\n    onAddMember: function onAddMember() {\n      this.selectInfo = {};\n      this.searchMemberIsShow = false;\n    },\n    onCancelMember: function onCancelMember() {\n      this.searchMemberIsShow = true;\n      this.selectInfo = {}; // 取消新增，重置为成年人模式\n\n      this.personModel = 0;\n      this.form.resetFields([this.memberId, this.memberName, this.memberMobile]);\n    }\n  },\n  mounted: function mounted() {\n    var _this3 = this;\n\n    this.memberSearchService.SET_TYPE(this.type);\n    console.log('member-search');\n\n    try {\n      if (this.memberInfo) {\n        console.log('memberInfo', this.memberInfo);\n        this.onMemberSearch(this.memberInfo.member_name);\n\n        if (this.isSoldDeal) {\n          var _this$form$setFieldsV2;\n\n          this.form.setFieldsValue((_this$form$setFieldsV2 = {}, _defineProperty(_this$form$setFieldsV2, this.physicalId, this.memberInfo.physical_id), _defineProperty(_this$form$setFieldsV2, this.idCard, this.memberInfo.id_card), _defineProperty(_this$form$setFieldsV2, this.cardNum, this.memberInfo.card_num), _defineProperty(_this$form$setFieldsV2, this.idCardType, this.memberInfo.id_card_type), _this$form$setFieldsV2));\n        }\n      } else {\n        this.memberSearchService.getMemberAction$.subscribe(function (list) {\n          console.log('list', list);\n\n          if (!list.length) {\n            _this3.form.resetFields([_this3.memberId]);\n          }\n        });\n      }\n    } catch (error) {\n      console.log('error', error);\n    }\n  },\n  components: {\n    InputPhone: InputPhone\n  }\n};",null]}