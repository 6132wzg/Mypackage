{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/group/components#/group-form.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/group/components#/group-form.vue","mtime":1591147717315},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport SelectShop from '@/views/fragments/shop/select-shop';\nimport moment from 'moment';\nimport { values } from 'lodash-es';\nimport { ACTIVITY_STATUS } from '@/constants/marketing/group-buy';\nimport { UserService } from '@/services/user.service';\nexport default {\n  serviceInject: function serviceInject() {\n    return {\n      userService: UserService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      publishedType: this.userService.getOptions$('group_buy.published_type')\n    };\n  },\n  bem: {\n    basic: 'brand-marketing-group-form'\n  },\n  props: {\n    isEdit: {\n      type: Boolean,\n      default: false\n    },\n    info: {\n      type: Object,\n      default: function _default() {}\n    },\n    form: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    decorators: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    groupParams: {\n      type: Object,\n      default: function _default() {\n        return {\n          type: null,\n          id: null\n        };\n      }\n    },\n    loading: {\n      type: Boolean\n    },\n    confirmLoading: {\n      type: Boolean\n    },\n    showSelectShop: {\n      type: Boolean,\n      default: function _default() {\n        return true;\n      }\n    }\n  },\n  mounted: function mounted() {\n    console.log(this.publishedType, 'publishedType');\n\n    if (this.isEdit) {\n      this.setFieldsValue();\n    }\n  },\n  data: function data() {\n    return {\n      ACTIVITY_STATUS: ACTIVITY_STATUS,\n      groupName: '',\n      errTips: '',\n      // 活动时间错误提示\n      showErr: false,\n      activityState: Number,\n      // 当前活动活动状态\n      isLimit: true,\n      releaseStatus: 1,\n      // 发布状态\n      publishTime: null,\n      activityOptions: {\n        start: {\n          showTime: true,\n          disabledBegin: moment().format('YYYY-MM-DD'),\n          placeholder: '开始日期',\n          disabled: false,\n          format: 'YYYY-MM-DD HH:mm:ss'\n        },\n        end: {\n          showTime: true,\n          placeholder: '结束日期',\n          disabled: false,\n          format: 'YYYY-MM-DD HH:mm:ss'\n        }\n      },\n      shopIds: []\n    };\n  },\n  methods: {\n    updateShop: function updateShop() {\n      this.$refs.selectShop.clearShopList();\n    },\n    // 是否限制库存\n    limitStock: function limitStock(value) {\n      this.isLimit = value.target.checked;\n    },\n    // 选择门店\n    onSelectShop: function onSelectShop(shopIds) {\n      this.shopIds = shopIds;\n\n      if (this.shopIds.length) {\n        this.errTips = '';\n        this.showErr = false;\n      }\n    },\n    // 为了同步字数\n    changeName: function changeName(e) {\n      this.groupName = e.target.value;\n    },\n    // select选择设置开始时间不能小于现在\n    disabledDate: function disabledDate(current) {\n      return current && current.format('YYYY-MM-DD HH:mm') < moment().format('YYYY-MM-DD HH:mm');\n    },\n    // 新建拼团活动\n    onSubmit: function onSubmit() {\n      var _this = this;\n\n      var shopFlag = false;\n\n      if (this.showSelectShop && !this.shopIds.length) {\n        this.errTips = '请选择门店';\n        this.showErr = true;\n        shopFlag = true;\n      }\n\n      this.form.validate().then(function (values) {\n        if (shopFlag) return;\n\n        _this.$emit('onsubmit', {\n          activity_name: values.activity_name,\n          // 活动名称\n          start_time: moment(values.activity_time[0]).format('YYYY-MM-DD HH:mm:ss'),\n          end_time: moment(values.activity_time[1]).format('YYYY-MM-DD HH:mm:ss'),\n          group_sum: +values.group_sum,\n          //成团人数\n          valid_time: +values.valid_time,\n          //拼团有效期\n          is_limit_stock: _this.isLimit ? 1 : 0,\n          //是否限制库存0不限制 1限制\n          stock_total: _this.isLimit ? +values.stock_total : 0,\n          //库存\n          shop_ids: _this.shopIds,\n          //门店ids [1,2,3,4]\n          published_type: _this.releaseStatus,\n          //发布状态(1-立即发布 2-暂不发布 3-定时发布)\n          published_time: moment(values.published_time).format('YYYY-MM-DD HH:mm:ss') //发布时间\n\n        });\n      });\n    },\n    // 详情回显\n    setFieldsValue: function setFieldsValue() {\n      this.releaseStatus = this.info.published_type;\n      this.activityState = Number(this.info.activity_state.id);\n      this.isLimit = this.info.is_limit_stock === 1;\n      this.shopIds = this.info.support_shop;\n      this.groupName = this.info.activity_name;\n      this.form.setFieldsValue({\n        activity_name: this.info.activity_name,\n        group_sum: this.info.group_sum,\n        valid_time: this.info.valid_time,\n        stock_total: this.info.stock_total,\n        activity_time: [this.info.start_time, this.info.end_time]\n      });\n\n      if (this.releaseStatus === this.publishedType[2].value) {\n        this.form.setFieldsValue({\n          published_time: moment(this.info.published_time)\n        });\n      } // 编辑不能改变活动开始时间\n\n\n      this.activityOptions.start.disabled = this.isEdit && this.activityState > this.ACTIVITY_STATUS.PUBLISHER; // 活动结束不能改变活动结束时间\n\n      this.activityOptions.end.disabled = this.isEdit && this.activityState >= this.ACTIVITY_STATUS.END;\n    }\n  },\n  components: {\n    SelectShop: SelectShop\n  }\n};",null]}