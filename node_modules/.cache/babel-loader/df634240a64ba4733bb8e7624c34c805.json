{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/sold/transaction/list.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/sold/transaction/list.vue","mtime":1600926556497},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { PRODUCT_TYPE, SOLD_DETAIL_PAGE_NAMES } from '@/constants/sold/transaction';\nimport { ListService } from \"./list.service\";\nimport tableMixin from '@/mixins/table.mixin';\nimport { columns } from \"./list.config\";\nimport SoldDealGatheringTip from '@/views/biz-modals/sold/deal/gathering-tip';\nimport SoldDealGathering from '@/views/biz-modals/sold/deal/gathering';\nimport SoldDealSaleCabinet from '@/views/biz-modals/sold/deal/sale-cabinet';\nimport SoldDealSaleCourse from '@/views/biz-modals/sold/deal/sale-course';\nimport SoldDealSaleDepositCard from '@/views/biz-modals/sold/deal/sale-deposit-card';\nimport SoldDealSaleMemberCard from '@/views/biz-modals/sold/deal/sale-member-card';\nimport SoldDealSalePersonalCourse from '@/views/biz-modals/sold/deal/sale-personal-course';\nimport SoldDealSaleSmallCourse from '@/views/biz-modals/sold/deal/sale-small-course';\nimport SoldDealWaitPay from '@/views/biz-modals/brand/app/pos/wait-pay-result';\nexport default {\n  name: 'PageShopSoldLease',\n  mixins: [tableMixin],\n  bem: {\n    basic: 'page-shop-sold',\n    sale: 'page-shop-sold-sale'\n  },\n  modals: {\n    SoldDealGatheringTip: SoldDealGatheringTip,\n    SoldDealGathering: SoldDealGathering,\n    SoldDealSaleCabinet: SoldDealSaleCabinet,\n    SoldDealSaleCourse: SoldDealSaleCourse,\n    SoldDealSaleDepositCard: SoldDealSaleDepositCard,\n    SoldDealSaleMemberCard: SoldDealSaleMemberCard,\n    SoldDealSalePersonalCourse: SoldDealSalePersonalCourse,\n    SoldDealSaleSmallCourse: SoldDealSaleSmallCourse,\n    SoldDealWaitPay: SoldDealWaitPay\n  },\n  props: {\n    product_type: {\n      type: Number,\n      default: 1\n    }\n  },\n  data: function data() {\n    return {\n      PRODUCT_TYPE: PRODUCT_TYPE\n    };\n  },\n  serviceInject: function serviceInject() {\n    return {\n      listService: ListService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      list: this.listService.list$,\n      page: this.listService.page$,\n      loading: this.listService.loading$,\n      productTypes: this.listService.productTypes$,\n      auth: this.listService.auth$\n    };\n  },\n  computed: {\n    columns: columns\n  },\n  mounted: function mounted() {\n    this.$searchQuery.product_type = this.product_type;\n    this.getList();\n  },\n  watch: {\n    $searchQuery: function $searchQuery() {\n      this.getList();\n    }\n  },\n  methods: {\n    getList: function getList() {\n      this.listService.getProductList(this.$searchQuery).subscribe();\n    },\n    // 签单\n    onTransaction: function onTransaction(record) {\n      switch (this.$searchQuery.product_type) {\n        case this.PRODUCT_TYPE.MEMBER_CARD:\n          this.onMember(record);\n          break;\n\n        case this.PRODUCT_TYPE.DEPOSIT_CARD:\n          this.onDeposit(record);\n          break;\n\n        case this.PRODUCT_TYPE.PERSONAL_COURSE:\n          this.onPersonalCourse(record);\n          break;\n\n        case this.PRODUCT_TYPE.PACKAGE:\n          this.onPackage(record);\n          break;\n\n        case this.PRODUCT_TYPE.CABINET:\n          this.onCabinet(record);\n          break;\n\n        case this.PRODUCT_TYPE.SMALL_COURSE:\n          this.onSmallCourse(record);\n          break;\n      }\n    },\n    // 打印合同\n    createdOrderPrint: function createdOrderPrint(order_id) {\n      var url = \"\".concat(window.location.origin, \"/common/contract-preview?id=\").concat(order_id);\n      window.open(url);\n    },\n    // 查看订单\n    createdOrderViewOrder: function createdOrderViewOrder(order_id) {\n      this.$router.push({\n        name: 'shop-finance-order-info-collection-details',\n        query: {\n          id: order_id\n        }\n      });\n    },\n    viewSoldDetetail: function viewSoldDetetail(soldId, type) {\n      var name = SOLD_DETAIL_PAGE_NAMES[type];\n      this.$router.push({\n        name: name,\n        query: {\n          id: soldId\n        }\n      });\n    },\n    // 打印小票\n    printOrder: function printOrder(order_id) {\n      window.open('/ticket/gathering-print?id=' + order_id, '_blank', 'width=800,height=600');\n    },\n    // 订单收款modal\n    createdOrderPay: function createdOrderPay(props) {\n      var _this = this;\n\n      return new Promise(function (resolve, reject) {\n        _this.$modalRouter.push({\n          name: 'sold-deal-gathering',\n          props: props,\n          on: {\n            success: resolve\n          }\n        });\n      });\n    },\n    // 创建成功，提示框modal\n    createdGatheringTip: function createdGatheringTip(props) {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this2.$modalRouter.push({\n          name: 'sold-deal-gathering-tip',\n          props: props,\n          on: {\n            success: resolve\n          }\n        });\n      });\n    },\n    // 等待支付回调modal\n    createdWaitPay: function createdWaitPay(props) {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this3.$modalRouter.push({\n          name: 'sold-deal-wait-pay',\n          props: props,\n          on: {\n            success: resolve\n          }\n        });\n      });\n    },\n    // 提示框回调，gathering-tip\n    tipCallBack: function () {\n      var _tipCallBack = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var _this4 = this;\n\n        var params,\n            orderId,\n            soldId,\n            modalType,\n            callBackType,\n            _args = arguments;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                params = _args.length > 0 && _args[0] !== undefined ? _args[0] : {};\n                orderId = params.orderId, soldId = params.soldId, modalType = params.modalType, callBackType = params.callBackType;\n                _context.t0 = callBackType;\n                _context.next = _context.t0 === 'cancel' ? 5 : _context.t0 === 'Print' ? 7 : _context.t0 === 'ViewOrder' ? 9 : _context.t0 === 'PrintOrder' ? 11 : _context.t0 === 'viewSoldDetetail' ? 13 : _context.t0 === 'Pay' ? 15 : 17;\n                break;\n\n              case 5:\n                this.getList();\n                return _context.abrupt(\"break\", 17);\n\n              case 7:\n                this.createdOrderPrint(orderId);\n                return _context.abrupt(\"break\", 17);\n\n              case 9:\n                this.createdOrderViewOrder(orderId);\n                return _context.abrupt(\"break\", 17);\n\n              case 11:\n                this.printOrder(orderId);\n                return _context.abrupt(\"break\", 17);\n\n              case 13:\n                this.viewSoldDetetail(soldId, modalType);\n                return _context.abrupt(\"break\", 17);\n\n              case 15:\n                this.createdOrderPay({\n                  order_id: orderId,\n                  type: modalType\n                }).then(function (res) {\n                  _this4.payCallBack({\n                    orderId: orderId,\n                    soldId: res.soldId,\n                    modalType: modalType,\n                    callBackType: res.type,\n                    callBackData: res\n                  });\n                });\n                return _context.abrupt(\"break\", 17);\n\n              case 17:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function tipCallBack() {\n        return _tipCallBack.apply(this, arguments);\n      }\n\n      return tipCallBack;\n    }(),\n    // 订单收款回调\n    payCallBack: function () {\n      var _payCallBack = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(params) {\n        var _this5 = this;\n\n        var orderId, soldId, modalType, callBackType, callBackData;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                orderId = params.orderId, soldId = params.soldId, modalType = params.modalType, callBackType = params.callBackType, callBackData = params.callBackData;\n                _context2.t0 = callBackType;\n                _context2.next = _context2.t0 === 'cancel' ? 4 : _context2.t0 === 'pay' ? 6 : _context2.t0 === 'pos' ? 8 : 10;\n                break;\n\n              case 4:\n                this.getList();\n                return _context2.abrupt(\"break\", 10);\n\n              case 6:\n                this.createdGatheringTip({\n                  message: '收款成功',\n                  type: this.product_type\n                }).then(function (res) {\n                  _this5.tipCallBack({\n                    orderId: orderId,\n                    soldId: soldId,\n                    modalType: modalType,\n                    callBackType: res.type\n                  });\n                });\n                return _context2.abrupt(\"break\", 10);\n\n              case 8:\n                this.createdWaitPay(callBackData).then(function () {\n                  _this5.createdGatheringTip({\n                    message: '收款成功',\n                    type: _this5.product_type,\n                    order_id: orderId\n                  }).then(function (res) {\n                    _this5.tipCallBack({\n                      orderId: orderId,\n                      soldId: res.soldId,\n                      modalType: modalType,\n                      callBackType: res.type\n                    });\n                  });\n                });\n                return _context2.abrupt(\"break\", 10);\n\n              case 10:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function payCallBack(_x) {\n        return _payCallBack.apply(this, arguments);\n      }\n\n      return payCallBack;\n    }(),\n    // 签单成功回调\n    saleCallBack: function () {\n      var _saleCallBack = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(result, type) {\n        var props, orderSuccessRes, _props, payOrderRes;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(result.type === 'create')) {\n                  _context3.next = 8;\n                  break;\n                }\n\n                // 创建订单成功\n                props = {\n                  order_id: result.orderId,\n                  type: type,\n                  message: '订单创建成功',\n                  needPay: true\n                };\n                _context3.next = 4;\n                return this.createdGatheringTip(props);\n\n              case 4:\n                orderSuccessRes = _context3.sent;\n                this.tipCallBack({\n                  orderId: result.orderId,\n                  soldId: result.soldId,\n                  modalType: type,\n                  callBackType: orderSuccessRes.type\n                });\n                _context3.next = 14;\n                break;\n\n              case 8:\n                if (!(result.type === 'createPay')) {\n                  _context3.next = 14;\n                  break;\n                }\n\n                // 创建订单成功 并且到支付页面\n                _props = {\n                  order_id: result.orderId,\n                  type: type\n                };\n                _context3.next = 12;\n                return this.createdOrderPay(_props);\n\n              case 12:\n                payOrderRes = _context3.sent;\n                this.payCallBack({\n                  orderId: result.orderId,\n                  soldId: payOrderRes.soldId,\n                  modalType: type,\n                  callBackType: payOrderRes.type,\n                  callBackData: payOrderRes\n                });\n\n              case 14:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function saleCallBack(_x2, _x3) {\n        return _saleCallBack.apply(this, arguments);\n      }\n\n      return saleCallBack;\n    }(),\n    // 会员卡签单\n    onMember: function onMember(record) {\n      var _this6 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-member-card',\n        props: {\n          id: \"\".concat(record.id)\n        },\n        on: {\n          success: function success(result) {\n            _this6.saleCallBack(result, 'member');\n          }\n        }\n      });\n    },\n    // 储值卡签单\n    onDeposit: function onDeposit(record) {\n      var _this7 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-deposit-card',\n        props: {\n          id: \"\".concat(record.id)\n        },\n        on: {\n          success: function success(result) {\n            _this7.saleCallBack(result, 'deposit');\n          }\n        }\n      });\n    },\n    // 储物柜签单\n    onCabinet: function onCabinet(record) {\n      var _this8 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-cabinet',\n        props: {\n          // 默认传0，因为没有选择具体的柜子\n          id: '0',\n          areaId: \"\".concat(record.id)\n        },\n        on: {\n          success: function success(result) {\n            _this8.saleCallBack(result, 'cabinet_order');\n          }\n        }\n      });\n    },\n    // 课程包签单\n    onPackage: function onPackage(record) {\n      var _this9 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-course',\n        props: {\n          id: \"\".concat(record.id)\n        },\n        on: {\n          success: function success(result) {\n            _this9.saleCallBack(result, 'package');\n          }\n        }\n      });\n    },\n    // 私教课签单\n    onPersonalCourse: function onPersonalCourse(record) {\n      var _this10 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-personal-course',\n        props: {\n          id: \"\".concat(record.id)\n        },\n        on: {\n          success: function success(result) {\n            _this10.saleCallBack(result, 'personal');\n          }\n        }\n      });\n    },\n    // 小班课签单\n    onSmallCourse: function onSmallCourse(record) {\n      var _this11 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-small-course',\n        props: {\n          id: \"\".concat(record.id)\n        },\n        on: {\n          success: function success(result) {\n            _this11.saleCallBack(result, 'small_course_order/detail');\n          }\n        }\n      });\n    },\n    onTableChange: function onTableChange(pagination) {\n      this.$searchQuery.current_page = pagination.current;\n      this.$searchQuery.size = pagination.pageSize;\n      this.getList();\n    }\n  }\n};",{"version":3,"sources":["list.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-panel initial app :class=\"basic()\">\n    <st-table\n      :page=\"page\"\n      :class=\"basic('table')\"\n      rowKey=\"id\"\n      :loading=\"loading.getProductList\"\n      :columns=\"columns\"\n      @change=\"onTableChange\"\n      :dataSource=\"list\"\n    >\n      <div slot=\"action\" slot-scope=\"text, record\">\n        <st-table-actions>\n          <a\n            v-if=\"record.auth['shop:sold:transaction|order']\"\n            @click=\"onTransaction(record)\"\n          >\n            签单\n          </a>\n        </st-table-actions>\n      </div>\n    </st-table>\n  </st-panel>\n</template>\n\n<script>\nimport {\n  PRODUCT_TYPE,\n  SOLD_DETAIL_PAGE_NAMES\n} from '@/constants/sold/transaction'\nimport { ListService } from './list.service'\nimport tableMixin from '@/mixins/table.mixin'\nimport { columns } from './list.config'\nimport SoldDealGatheringTip from '@/views/biz-modals/sold/deal/gathering-tip'\nimport SoldDealGathering from '@/views/biz-modals/sold/deal/gathering'\nimport SoldDealSaleCabinet from '@/views/biz-modals/sold/deal/sale-cabinet'\nimport SoldDealSaleCourse from '@/views/biz-modals/sold/deal/sale-course'\nimport SoldDealSaleDepositCard from '@/views/biz-modals/sold/deal/sale-deposit-card'\nimport SoldDealSaleMemberCard from '@/views/biz-modals/sold/deal/sale-member-card'\nimport SoldDealSalePersonalCourse from '@/views/biz-modals/sold/deal/sale-personal-course'\nimport SoldDealSaleSmallCourse from '@/views/biz-modals/sold/deal/sale-small-course'\nimport SoldDealWaitPay from '@/views/biz-modals/brand/app/pos/wait-pay-result'\nexport default {\n  name: 'PageShopSoldLease',\n  mixins: [tableMixin],\n  bem: {\n    basic: 'page-shop-sold',\n    sale: 'page-shop-sold-sale'\n  },\n  modals: {\n    SoldDealGatheringTip,\n    SoldDealGathering,\n    SoldDealSaleCabinet,\n    SoldDealSaleCourse,\n    SoldDealSaleDepositCard,\n    SoldDealSaleMemberCard,\n    SoldDealSalePersonalCourse,\n    SoldDealSaleSmallCourse,\n    SoldDealWaitPay\n  },\n  props: {\n    product_type: {\n      type: Number,\n      default: 1\n    }\n  },\n  data() {\n    return {\n      PRODUCT_TYPE\n    }\n  },\n  serviceInject() {\n    return {\n      listService: ListService\n    }\n  },\n  rxState() {\n    return {\n      list: this.listService.list$,\n      page: this.listService.page$,\n      loading: this.listService.loading$,\n      productTypes: this.listService.productTypes$,\n      auth: this.listService.auth$\n    }\n  },\n  computed: {\n    columns\n  },\n  mounted() {\n    this.$searchQuery.product_type = this.product_type\n    this.getList()\n  },\n  watch: {\n    $searchQuery() {\n      this.getList()\n    }\n  },\n  methods: {\n    getList() {\n      this.listService.getProductList(this.$searchQuery).subscribe()\n    },\n    // 签单\n    onTransaction(record) {\n      switch (this.$searchQuery.product_type) {\n        case this.PRODUCT_TYPE.MEMBER_CARD:\n          this.onMember(record)\n          break\n        case this.PRODUCT_TYPE.DEPOSIT_CARD:\n          this.onDeposit(record)\n          break\n        case this.PRODUCT_TYPE.PERSONAL_COURSE:\n          this.onPersonalCourse(record)\n          break\n        case this.PRODUCT_TYPE.PACKAGE:\n          this.onPackage(record)\n          break\n        case this.PRODUCT_TYPE.CABINET:\n          this.onCabinet(record)\n          break\n        case this.PRODUCT_TYPE.SMALL_COURSE:\n          this.onSmallCourse(record)\n          break\n      }\n    },\n    // 打印合同\n    createdOrderPrint(order_id) {\n      let url = `${window.location.origin}/common/contract-preview?id=${order_id}`\n      window.open(url)\n    },\n    // 查看订单\n    createdOrderViewOrder(order_id) {\n      this.$router.push({\n        name: 'shop-finance-order-info-collection-details',\n        query: {\n          id: order_id\n        }\n      })\n    },\n    viewSoldDetetail(soldId, type) {\n      const name = SOLD_DETAIL_PAGE_NAMES[type]\n      this.$router.push({\n        name,\n        query: {\n          id: soldId\n        }\n      })\n    },\n    // 打印小票\n    printOrder(order_id) {\n      window.open(\n        '/ticket/gathering-print?id=' + order_id,\n        '_blank',\n        'width=800,height=600'\n      )\n    },\n    // 订单收款modal\n    createdOrderPay(props) {\n      return new Promise((resolve, reject) => {\n        this.$modalRouter.push({\n          name: 'sold-deal-gathering',\n          props,\n          on: {\n            success: resolve\n          }\n        })\n      })\n    },\n    // 创建成功，提示框modal\n    createdGatheringTip(props) {\n      return new Promise((resolve, reject) => {\n        this.$modalRouter.push({\n          name: 'sold-deal-gathering-tip',\n          props,\n          on: {\n            success: resolve\n          }\n        })\n      })\n    },\n    // 等待支付回调modal\n    createdWaitPay(props) {\n      return new Promise((resolve, reject) => {\n        this.$modalRouter.push({\n          name: 'sold-deal-wait-pay',\n          props,\n          on: {\n            success: resolve\n          }\n        })\n      })\n    },\n    // 提示框回调，gathering-tip\n    async tipCallBack(params = {}) {\n      const { orderId, soldId, modalType, callBackType } = params\n      switch (callBackType) {\n        case 'cancel':\n          this.getList()\n          break\n        case 'Print':\n          this.createdOrderPrint(orderId)\n          break\n        case 'ViewOrder':\n          this.createdOrderViewOrder(orderId)\n          break\n        case 'PrintOrder':\n          this.printOrder(orderId)\n          break\n        case 'viewSoldDetetail':\n          this.viewSoldDetetail(soldId, modalType)\n          break\n        case 'Pay':\n          this.createdOrderPay({\n            order_id: orderId,\n            type: modalType\n          }).then(res => {\n            this.payCallBack({\n              orderId,\n              soldId: res.soldId,\n              modalType,\n              callBackType: res.type,\n              callBackData: res\n            })\n          })\n          break\n      }\n    },\n    // 订单收款回调\n    async payCallBack(params) {\n      const { orderId, soldId, modalType, callBackType, callBackData } = params\n      switch (callBackType) {\n        case 'cancel':\n          this.getList()\n          break\n        case 'pay':\n          this.createdGatheringTip({\n            message: '收款成功',\n            type: this.product_type\n          }).then(res => {\n            this.tipCallBack({\n              orderId,\n              soldId,\n              modalType,\n              callBackType: res.type\n            })\n          })\n          break\n        case 'pos':\n          this.createdWaitPay(callBackData).then(() => {\n            this.createdGatheringTip({\n              message: '收款成功',\n              type: this.product_type,\n              order_id: orderId\n            }).then(res => {\n              this.tipCallBack({\n                orderId,\n                soldId: res.soldId,\n                modalType,\n                callBackType: res.type\n              })\n            })\n          })\n          break\n      }\n    },\n    // 签单成功回调\n    async saleCallBack(result, type) {\n      if (result.type === 'create') {\n        // 创建订单成功\n        let props = {\n          order_id: result.orderId,\n          type,\n          message: '订单创建成功',\n          needPay: true\n        }\n        let orderSuccessRes = await this.createdGatheringTip(props)\n        this.tipCallBack({\n          orderId: result.orderId,\n          soldId: result.soldId,\n          modalType: type,\n          callBackType: orderSuccessRes.type\n        })\n      } else if (result.type === 'createPay') {\n        // 创建订单成功 并且到支付页面\n        let props = {\n          order_id: result.orderId,\n          type\n        }\n        let payOrderRes = await this.createdOrderPay(props)\n        this.payCallBack({\n          orderId: result.orderId,\n          soldId: payOrderRes.soldId,\n          modalType: type,\n          callBackType: payOrderRes.type,\n          callBackData: payOrderRes\n        })\n      }\n    },\n    // 会员卡签单\n    onMember(record) {\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-member-card',\n        props: {\n          id: `${record.id}`\n        },\n        on: {\n          success: result => {\n            this.saleCallBack(result, 'member')\n          }\n        }\n      })\n    },\n    // 储值卡签单\n    onDeposit(record) {\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-deposit-card',\n        props: {\n          id: `${record.id}`\n        },\n        on: {\n          success: result => {\n            this.saleCallBack(result, 'deposit')\n          }\n        }\n      })\n    },\n    // 储物柜签单\n    onCabinet(record) {\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-cabinet',\n        props: {\n          // 默认传0，因为没有选择具体的柜子\n          id: '0',\n          areaId: `${record.id}`\n        },\n        on: {\n          success: result => {\n            this.saleCallBack(result, 'cabinet_order')\n          }\n        }\n      })\n    },\n    // 课程包签单\n    onPackage(record) {\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-course',\n        props: {\n          id: `${record.id}`\n        },\n        on: {\n          success: result => {\n            this.saleCallBack(result, 'package')\n          }\n        }\n      })\n    },\n    // 私教课签单\n    onPersonalCourse(record) {\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-personal-course',\n        props: {\n          id: `${record.id}`\n        },\n        on: {\n          success: result => {\n            this.saleCallBack(result, 'personal')\n          }\n        }\n      })\n    },\n    // 小班课签单\n    onSmallCourse(record) {\n      this.$modalRouter.push({\n        name: 'sold-deal-sale-small-course',\n        props: {\n          id: `${record.id}`\n        },\n        on: {\n          success: result => {\n            this.saleCallBack(result, 'small_course_order/detail')\n          }\n        }\n      })\n    },\n    onTableChange(pagination) {\n      this.$searchQuery.current_page = pagination.current\n      this.$searchQuery.size = pagination.pageSize\n      this.getList()\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/shop/sold/transaction"}]}