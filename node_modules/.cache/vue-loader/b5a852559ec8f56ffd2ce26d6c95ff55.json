{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/department.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/department.vue","mtime":1597396799976},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport FilterStaff from './department#/filter-staff.vue'\nimport OpreationButton from './department#/opreation-button.vue'\nimport StaffTable from './department#/staff-table'\nimport { DepartmentService } from './department.service'\nimport { UserService } from '@/services/user.service'\nimport StOrganTree from './department#/tree/tree.vue'\nimport { ShopStaffApi } from '@/api/v1/staff/staff'\nimport { cloneDeep } from 'lodash-es'\nimport StaffBatchImport from '@/views/biz-modals/staff/batch-import'\nexport default {\n  name: 'Staff',\n  modals: {\n    StaffBatchImport\n  },\n  serviceInject() {\n    return {\n      departmentService: DepartmentService,\n      userService: UserService,\n      shopStaffApi: ShopStaffApi\n    }\n  },\n  rxState() {\n    return {\n      departmentList: this.departmentService.departmentList$,\n      departmentSearchList: this.departmentService.departmentSearchList$,\n      staffList: this.departmentService.staffList$,\n      roleOptions: this.departmentService.roleOptions$,\n      loading: this.departmentService.loading$,\n      page: this.departmentService.page$,\n      auth: this.departmentService.auth$,\n      brand: this.userService.brand$\n    }\n  },\n  components: {\n    FilterStaff,\n    OpreationButton,\n    StaffTable,\n    StOrganTree\n  },\n  computed: {\n    shopList() {\n      return [{ id: -1, name: '  全部' }, ...this.shopOptions]\n    },\n    treeData() {\n      let num = 0\n      let len = this.treeList.length\n      // eslint-disable-next-line\n      if (!len) this.treeList = this.departmentList\n      console.log('treeData', this.treeList)\n      this.treeList.forEach(department => {\n        num += department.count\n      })\n      return {\n        name: this.brand.name,\n        id: 0,\n        count: this.departmentCount,\n        children: this.treeList\n      }\n    },\n    departmentCount() {\n      let num = 0\n      this.departmentList.forEach(department => {\n        num += department.count\n      })\n      return num\n    }\n  },\n  data() {\n    return {\n      ids: [],\n      treeList: []\n    }\n  },\n  methods: {\n    updateData() {\n      this.departmentService.getDepartmentList().subscribe(res => {\n        this.treeList = res.department\n      })\n    },\n    getDepartment(item = 0) {\n      this.$searchQuery.shop_id = -1\n      this.$searchQuery.work_status = -1\n      this.$searchQuery.department_id = item\n      this.$searchQuery.keyword = ''\n      this.$router.push({ query: this.$searchQuery })\n    },\n    selectedRow(ids) {\n      this.ids = ids\n    },\n    // 查询\n    handleDepartmentSearch(e) {\n      console.log('搜索条件', e)\n      this.departmentService.searchDepartment(e)\n      // this.$router.push({ name: 'brand-staff-department', query: { department_id: e } })\n    },\n    // 查询部门后点击列表某项\n    handleDepartmentSearchChange(e) {\n      console.log(e)\n      if (!e) this.treeList = this.departmentList\n      else this.treeList = this.deepSearchDepartment(this.departmentList, e)\n    },\n    // 查询部门后点击列表某项查找到对应列表\n    deepSearchDepartment(departments, id) {\n      let result = []\n      if (!departments || !Array.isArray(departments)) return result\n      for (let x = 0; x < departments.length; x++) {\n        let department = departments[x]\n        if (result && result.length) {\n          break\n        }\n        if (department.id === id) {\n          result = [department]\n        } else if (department.children && department.children.length) {\n          result = this.deepSearchDepartment(department.children, id)\n        }\n      }\n      return result\n    },\n    // 编辑\n    onEditStaff(staffId) {\n      this.$router.push({ name: 'brand-staff-edit', query: { id: staffId } })\n    },\n    // 新增员工\n    onAddStaff() {\n      this.$router.push('/brand/staff/add')\n    },\n    // 批量导入\n    onbatchImport() {\n      this.$modalRouter.push({\n        name: 'staff-batch-import',\n        props: {\n          ids: this.ids\n        },\n        on: {\n          ok: res => {\n            this.updateData()\n            this.$refs.staffTable.selectedRowKeys = []\n            this.$router.reload()\n          }\n        }\n      })\n\n      console.log('批量导入')\n    },\n    // 导入员工\n    onImportStaff() {\n      console.log('导入员工')\n    }\n  }\n}\n",null]}