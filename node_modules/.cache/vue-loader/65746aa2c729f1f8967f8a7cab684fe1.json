{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/finance/edit-performance-template.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/finance/edit-performance-template.vue","mtime":1597396799934},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { MessageService } from '@/services/message.service'\nimport { EditTemplateService } from './edit-performance-template.service'\nimport { forEach } from 'lodash-es'\nimport { ruleOptions } from './performance-template.config'\nimport { PERFORMANCE } from '@/constants/finance/performance'\nexport default {\n  serviceInject() {\n    return {\n      service: EditTemplateService,\n      message: MessageService\n    }\n  },\n  rxState() {\n    return {\n      performanceModes: this.service.performanceModes$,\n      performanceTypes: this.service.performanceTypes$\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      PERFORMANCE,\n      form,\n      decorators,\n      data: [],\n      gradients: {\n        range_min: '',\n        royalty_num: ''\n      },\n      show: false,\n      choose: 1, // 1 百分比 0 金额\n      isChooseks: true, // 是否选中课时\n      performance_type: 1,\n      performance_mode: 1,\n      infodata: {}\n    }\n  },\n  watch: {\n    performance_type: function(newValue, oldValue) {\n      if (\n        newValue === PERFORMANCE.PERFORMANCE_TYPE_1 ||\n        newValue === PERFORMANCE.PERFORMANCE_TYPE_2\n      ) {\n        this.isChooseks = true\n      } else if (newValue === 3) {\n        this.isChooseks = false\n      }\n    }\n  },\n  props: {\n    id: Number\n  },\n  computed: {\n    placeholderGradient() {\n      if (this.performance_type == this.PERFORMANCE.PERFORMANCE_TYPE_1) {\n        return '请输入月销售额'\n      }\n      if (this.performance_type == this.PERFORMANCE.PERFORMANCE_TYPE_2) {\n        return '请输入月课时价值'\n      }\n      if (this.performance_type == this.PERFORMANCE.PERFORMANCE_TYPE_3) {\n        return '请输入月课时数'\n      }\n      return '请输入'\n    },\n    errorMessageTip() {\n      if (this.performance_type == this.PERFORMANCE.PERFORMANCE_TYPE_1) {\n        return '月销售额不能重复'\n      }\n      if (this.performance_type == this.PERFORMANCE.PERFORMANCE_TYPE_2) {\n        return '月课时价值不能重复'\n      }\n      if (this.performance_type == this.PERFORMANCE.PERFORMANCE_TYPE_3) {\n        return '月课时数不能重复'\n      }\n      return '请输入'\n    },\n    placeholderGradientFee() {\n      if (this.performance_type == this.PERFORMANCE.PERFORMANCE_TYPE_3) {\n        return '请输入课时费'\n      }\n      return '请输入月销售额'\n    }\n  },\n  mounted() {\n    this.service.getInfo(this.id).subscribe(res => {\n      this.infodata = res.info\n      res.info.gradients.forEach(item => {\n        this.$set(item, 'isEdit', false)\n        this.data.push(item)\n      })\n      this.performance_type = res.info.performance_type.id\n      this.performance_mode = res.info.performance_mode.id\n      this.form.setFieldsValue({\n        template_name: this.infodata.template_name,\n        performance_type: this.infodata.performance_type.id,\n        performance_mode: this.infodata.performance_mode.id,\n        performance_num: this.infodata.performance_num\n      })\n    })\n  },\n  methods: {\n    selectType(e) {\n      this.performance_type = e\n      if (\n        e === PERFORMANCE.PERFORMANCE_TYPE_1 ||\n        e === PERFORMANCE.PERFORMANCE_TYPE_2\n      ) {\n        this.isChooseks = true\n      } else if (e === PERFORMANCE.PERFORMANCE_TYPE_3) {\n        this.isChooseks = false\n      }\n    },\n    submitEdit(e) {\n      let range_min = this.data[e].range_min\n      let royalty_num = this.data[e].royalty_num\n      if (!this.data[e].range_min || !this.data[e].royalty_num) {\n        this.message.warn({ content: '请填写完整' })\n        return\n      }\n      if (this.performance_type == this.PERFORMANCE.PERFORMANCE_TYPE_3) {\n        range_min = parseInt(range_min)\n      } else {\n        range_min = parseFloat(range_min).toFixed(1)\n      }\n      royalty_num = parseFloat(royalty_num).toFixed(1)\n      const arr = this.data.filter(\n        (item, index) => item.range_min === range_min && index !== e\n      )\n      if (arr.length > 0) {\n        this.message.warn({ content: this.errorMessageTip })\n        return\n      }\n      this.data[e].range_min = range_min\n      this.data[e].royalty_num = royalty_num\n      delete this.data[e].range_min_bak\n      delete this.data[e].royalty_num_bak\n      this.data[e].isEdit = false\n    },\n    cancelEdit(e) {\n      this.data[e].isEdit = false\n      this.data[e].range_min = this.data[e].range_min_bak\n      this.data[e].royalty_num = this.data[e].royalty_num_bak\n      delete this.data[e].range_min_bak\n      delete this.data[e].royalty_num_bak\n    },\n    editPerformanceNum(e) {\n      this.data[e].isEdit = true\n      this.data[e].range_min_bak = this.data[e].range_min\n      this.data[e].royalty_num_bak = this.data[e].royalty_num\n    },\n    deletePerformanceNum(e) {\n      this.data.splice(e, 1)\n    },\n    addGradients(e) {\n      // 加校验\n      let { range_min, royalty_num } = this.gradients\n      if (!range_min || !royalty_num) {\n        this.message.warn({ content: '请填写完整' })\n        return\n      }\n      if (this.performance_type == this.PERFORMANCE.PERFORMANCE_TYPE_3) {\n        range_min = parseInt(range_min)\n      } else {\n        range_min = parseFloat(range_min).toFixed(1)\n      }\n      royalty_num = parseInt(royalty_num)\n\n      const arr = this.data.filter(item => item.range_min === range_min)\n      if (arr.length > 0) {\n        this.message.warn({ content: this.errorMessageTip })\n        return\n      }\n      this.data.push({\n        id: 0,\n        range_min,\n        royalty_num,\n        isEdit: false\n      })\n      this.gradients.range_min = ''\n      this.gradients.royalty_num = ''\n    },\n    handleSubmit(e) {\n      e.preventDefault()\n      this.form.validate().then(values => {\n        values.gradients = this.data\n        if (values.performance_type === 3) {\n          values.performance_mode = 0\n        }\n        this.service.editTemplate(this.id, values).subscribe(() => {\n          this.$emit('change')\n          this.message.success({ content: '编辑成功' })\n          this.show = false\n        })\n      })\n    },\n    onChooseRadio(e) {\n      this.performance_mode = e.target.value\n      this.data = []\n    }\n  }\n}\n",null]}