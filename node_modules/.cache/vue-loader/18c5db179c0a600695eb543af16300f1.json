{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/group/components#/group-form.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/group/components#/group-form.vue","mtime":1591147717315},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport SelectShop from '@/views/fragments/shop/select-shop'\nimport moment from 'moment'\nimport { values } from 'lodash-es'\nimport { ACTIVITY_STATUS } from '@/constants/marketing/group-buy'\nimport { UserService } from '@/services/user.service'\nexport default {\n  serviceInject() {\n    return {\n      userService: UserService\n    }\n  },\n  rxState() {\n    return {\n      publishedType: this.userService.getOptions$('group_buy.published_type')\n    }\n  },\n  bem: {\n    basic: 'brand-marketing-group-form'\n  },\n  props: {\n    isEdit: {\n      type: Boolean,\n      default: false\n    },\n    info: {\n      type: Object,\n      default: () => {}\n    },\n    form: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    },\n    decorators: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    },\n    groupParams: {\n      type: Object,\n      default: () => {\n        return {\n          type: null,\n          id: null\n        }\n      }\n    },\n    loading: {\n      type: Boolean\n    },\n    confirmLoading: {\n      type: Boolean\n    },\n    showSelectShop: {\n      type: Boolean,\n      default: () => {\n        return true\n      }\n    }\n  },\n  mounted() {\n    console.log(this.publishedType, 'publishedType')\n    if (this.isEdit) {\n      this.setFieldsValue()\n    }\n  },\n  data() {\n    return {\n      ACTIVITY_STATUS,\n      groupName: '',\n      errTips: '', // 活动时间错误提示\n      showErr: false,\n      activityState: Number, // 当前活动活动状态\n      isLimit: true,\n      releaseStatus: 1, // 发布状态\n      publishTime: null,\n      activityOptions: {\n        start: {\n          showTime: true,\n          disabledBegin: moment().format('YYYY-MM-DD'),\n          placeholder: '开始日期',\n          disabled: false,\n          format: 'YYYY-MM-DD HH:mm:ss'\n        },\n        end: {\n          showTime: true,\n          placeholder: '结束日期',\n          disabled: false,\n          format: 'YYYY-MM-DD HH:mm:ss'\n        }\n      },\n      shopIds: []\n    }\n  },\n  methods: {\n    updateShop() {\n      this.$refs.selectShop.clearShopList()\n    },\n    // 是否限制库存\n    limitStock(value) {\n      this.isLimit = value.target.checked\n    },\n    // 选择门店\n    onSelectShop(shopIds) {\n      this.shopIds = shopIds\n      if (this.shopIds.length) {\n        this.errTips = ''\n        this.showErr = false\n      }\n    },\n    // 为了同步字数\n    changeName(e) {\n      this.groupName = e.target.value\n    },\n    // select选择设置开始时间不能小于现在\n    disabledDate(current) {\n      return (\n        current &&\n        current.format('YYYY-MM-DD HH:mm') < moment().format('YYYY-MM-DD HH:mm')\n      )\n    },\n    // 新建拼团活动\n    onSubmit() {\n      let shopFlag = false\n      if (this.showSelectShop && !this.shopIds.length) {\n        this.errTips = '请选择门店'\n        this.showErr = true\n        shopFlag = true\n      }\n      this.form.validate().then(values => {\n        if (shopFlag) return\n        this.$emit('onsubmit', {\n          activity_name: values.activity_name, // 活动名称\n          start_time: moment(values.activity_time[0]).format(\n            'YYYY-MM-DD HH:mm:ss'\n          ),\n          end_time: moment(values.activity_time[1]).format(\n            'YYYY-MM-DD HH:mm:ss'\n          ),\n          group_sum: +values.group_sum, //成团人数\n          valid_time: +values.valid_time, //拼团有效期\n          is_limit_stock: this.isLimit ? 1 : 0, //是否限制库存0不限制 1限制\n          stock_total: this.isLimit ? +values.stock_total : 0, //库存\n          shop_ids: this.shopIds, //门店ids [1,2,3,4]\n          published_type: this.releaseStatus, //发布状态(1-立即发布 2-暂不发布 3-定时发布)\n          published_time: moment(values.published_time).format(\n            'YYYY-MM-DD HH:mm:ss'\n          ) //发布时间\n        })\n      })\n    },\n    // 详情回显\n    setFieldsValue() {\n      this.releaseStatus = this.info.published_type\n      this.activityState = Number(this.info.activity_state.id)\n      this.isLimit = this.info.is_limit_stock === 1\n      this.shopIds = this.info.support_shop\n      this.groupName = this.info.activity_name\n      this.form.setFieldsValue({\n        activity_name: this.info.activity_name,\n        group_sum: this.info.group_sum,\n        valid_time: this.info.valid_time,\n        stock_total: this.info.stock_total,\n        activity_time: [this.info.start_time, this.info.end_time]\n      })\n      if (this.releaseStatus === this.publishedType[2].value) {\n        this.form.setFieldsValue({\n          published_time: moment(this.info.published_time)\n        })\n      }\n      // 编辑不能改变活动开始时间\n      this.activityOptions.start.disabled =\n        this.isEdit && this.activityState > this.ACTIVITY_STATUS.PUBLISHER\n      // 活动结束不能改变活动结束时间\n      this.activityOptions.end.disabled =\n        this.isEdit && this.activityState >= this.ACTIVITY_STATUS.END\n    }\n  },\n  components: {\n    SelectShop\n  }\n}\n",{"version":3,"sources":["group-form.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"group-form.vue","sourceRoot":"src/views/pages/brand/marketing/plugin/group/components#","sourcesContent":["<template>\n  <st-mina-panel app>\n    <div slot=\"actions\">\n      <st-button :loading=\"confirmLoading\" type=\"primary\" @click=\"onSubmit\">\n        保 存\n      </st-button>\n    </div>\n    <div>\n      <st-form :form=\"form\" labelWidth=\"118px\">\n        <a-row :gutter=\"8\">\n          <a-col :span=\"10\">\n            <st-form-item label=\"活动名称\" required>\n              <a-input\n                v-decorator=\"decorators.activity_name\"\n                placeholder=\"请输入活动名称\"\n                @change=\"changeName\"\n                maxlength=\"30\"\n              >\n                <span :class=\"basic('name--gray')\" slot=\"suffix\">\n                  {{ groupName.length }}\n                  /30\n                </span>\n              </a-input>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <slot name=\"choose-product\"></slot>\n        <a-row :gutter=\"8\">\n          <a-col :span=\"16\">\n            <st-form-item label=\"活动时间\" required>\n              <st-range-picker\n                :disabledDays=\"180\"\n                :options=\"activityOptions\"\n                v-decorator=\"decorators.activity_time\"\n              ></st-range-picker>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :span=\"10\">\n            <st-form-item required>\n              <span slot=\"label\">\n                参团人数\n                <st-help-tooltip id=\"TBPTXJ001\" />\n              </span>\n              <st-input-number\n                :disabled=\"isEdit && activityState > ACTIVITY_STATUS.PUBLISHER\"\n                v-decorator=\"decorators.group_sum\"\n              >\n                <template slot=\"addonAfter\">\n                  人\n                </template>\n              </st-input-number>\n            </st-form-item>\n            <st-form-item required>\n              <span slot=\"label\">\n                拼团有效期\n                <st-help-tooltip id=\"TBPTXJ002\" />\n              </span>\n              <st-input-number\n                :disabled=\"isEdit && activityState > ACTIVITY_STATUS.PUBLISHER\"\n                v-decorator=\"decorators.valid_time\"\n              >\n                <template slot=\"addonAfter\">\n                  小时\n                </template>\n              </st-input-number>\n            </st-form-item>\n            <st-form-item required>\n              <span slot=\"label\">\n                活动库存\n                <st-help-tooltip id=\"TBPTXJ003\" />\n              </span>\n              <a-checkbox\n                @change=\"limitStock\"\n                :checked=\"isLimit\"\n                :disabled=\"isEdit && activityState > ACTIVITY_STATUS.PUBLISHER\"\n              >\n                限制库存&nbsp;&nbsp;\n              </a-checkbox>\n              <st-input-number\n                v-if=\"isLimit\"\n                :class=\"basic('stock')\"\n                v-decorator=\"decorators.stock_total\"\n                :disabled=\"isEdit && activityState >= ACTIVITY_STATUS.END\"\n              ></st-input-number>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\" v-if=\"showSelectShop\">\n          <a-col :span=\"16\">\n            <st-form-item\n              required\n              :help=\"errTips\"\n              :validateStatus=\"showErr ? 'error' : ''\"\n              :class=\"basic('shop')\"\n            >\n              <span slot=\"label\">\n                选择门店\n                <st-help-tooltip id=\"TBPTXJ004\" />\n              </span>\n              <st-container>\n                <st-t4 :class=\"basic('shop--set')\">\n                  设置支持活动的场馆范围\n                </st-t4>\n                <select-shop\n                  :shopIds=\"info ? info.support_shop : []\"\n                  type=\"group\"\n                  :groupParams=\"groupParams\"\n                  @change=\"onSelectShop\"\n                  ref=\"selectShop\"\n                  :disabled=\"\n                    isEdit && activityState > ACTIVITY_STATUS.PUBLISHER\n                  \"\n                ></select-shop>\n              </st-container>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :span=\"10\">\n            <st-form-item required>\n              <span slot=\"label\">\n                发布状态\n                <st-help-tooltip id=\"TBPTXJ006\" />\n              </span>\n              <a-radio-group\n                :defaultValue=\"releaseStatus || publishedType[0].value\"\n                v-model=\"releaseStatus\"\n                :disabled=\"isEdit && activityState > ACTIVITY_STATUS.PUBLISHER\"\n              >\n                <a-radio\n                  :value=\"item.value\"\n                  v-for=\"item in publishedType\"\n                  :key=\"item.value\"\n                >\n                  {{ item.label }}\n                </a-radio>\n              </a-radio-group>\n            </st-form-item>\n            <st-form-item\n              label=\"发布时间\"\n              required\n              v-show=\"releaseStatus === publishedType[2].value\"\n            >\n              <a-date-picker\n                :disabledDate=\"disabledDate\"\n                :showTime=\"{ format: 'HH:mm' }\"\n                format=\"YYYY-MM-DD HH:mm\"\n                v-decorator=\"decorators.published_time\"\n              />\n            </st-form-item>\n          </a-col>\n        </a-row>\n      </st-form>\n    </div>\n  </st-mina-panel>\n</template>\n<script>\nimport SelectShop from '@/views/fragments/shop/select-shop'\nimport moment from 'moment'\nimport { values } from 'lodash-es'\nimport { ACTIVITY_STATUS } from '@/constants/marketing/group-buy'\nimport { UserService } from '@/services/user.service'\nexport default {\n  serviceInject() {\n    return {\n      userService: UserService\n    }\n  },\n  rxState() {\n    return {\n      publishedType: this.userService.getOptions$('group_buy.published_type')\n    }\n  },\n  bem: {\n    basic: 'brand-marketing-group-form'\n  },\n  props: {\n    isEdit: {\n      type: Boolean,\n      default: false\n    },\n    info: {\n      type: Object,\n      default: () => {}\n    },\n    form: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    },\n    decorators: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    },\n    groupParams: {\n      type: Object,\n      default: () => {\n        return {\n          type: null,\n          id: null\n        }\n      }\n    },\n    loading: {\n      type: Boolean\n    },\n    confirmLoading: {\n      type: Boolean\n    },\n    showSelectShop: {\n      type: Boolean,\n      default: () => {\n        return true\n      }\n    }\n  },\n  mounted() {\n    console.log(this.publishedType, 'publishedType')\n    if (this.isEdit) {\n      this.setFieldsValue()\n    }\n  },\n  data() {\n    return {\n      ACTIVITY_STATUS,\n      groupName: '',\n      errTips: '', // 活动时间错误提示\n      showErr: false,\n      activityState: Number, // 当前活动活动状态\n      isLimit: true,\n      releaseStatus: 1, // 发布状态\n      publishTime: null,\n      activityOptions: {\n        start: {\n          showTime: true,\n          disabledBegin: moment().format('YYYY-MM-DD'),\n          placeholder: '开始日期',\n          disabled: false,\n          format: 'YYYY-MM-DD HH:mm:ss'\n        },\n        end: {\n          showTime: true,\n          placeholder: '结束日期',\n          disabled: false,\n          format: 'YYYY-MM-DD HH:mm:ss'\n        }\n      },\n      shopIds: []\n    }\n  },\n  methods: {\n    updateShop() {\n      this.$refs.selectShop.clearShopList()\n    },\n    // 是否限制库存\n    limitStock(value) {\n      this.isLimit = value.target.checked\n    },\n    // 选择门店\n    onSelectShop(shopIds) {\n      this.shopIds = shopIds\n      if (this.shopIds.length) {\n        this.errTips = ''\n        this.showErr = false\n      }\n    },\n    // 为了同步字数\n    changeName(e) {\n      this.groupName = e.target.value\n    },\n    // select选择设置开始时间不能小于现在\n    disabledDate(current) {\n      return (\n        current &&\n        current.format('YYYY-MM-DD HH:mm') < moment().format('YYYY-MM-DD HH:mm')\n      )\n    },\n    // 新建拼团活动\n    onSubmit() {\n      let shopFlag = false\n      if (this.showSelectShop && !this.shopIds.length) {\n        this.errTips = '请选择门店'\n        this.showErr = true\n        shopFlag = true\n      }\n      this.form.validate().then(values => {\n        if (shopFlag) return\n        this.$emit('onsubmit', {\n          activity_name: values.activity_name, // 活动名称\n          start_time: moment(values.activity_time[0]).format(\n            'YYYY-MM-DD HH:mm:ss'\n          ),\n          end_time: moment(values.activity_time[1]).format(\n            'YYYY-MM-DD HH:mm:ss'\n          ),\n          group_sum: +values.group_sum, //成团人数\n          valid_time: +values.valid_time, //拼团有效期\n          is_limit_stock: this.isLimit ? 1 : 0, //是否限制库存0不限制 1限制\n          stock_total: this.isLimit ? +values.stock_total : 0, //库存\n          shop_ids: this.shopIds, //门店ids [1,2,3,4]\n          published_type: this.releaseStatus, //发布状态(1-立即发布 2-暂不发布 3-定时发布)\n          published_time: moment(values.published_time).format(\n            'YYYY-MM-DD HH:mm:ss'\n          ) //发布时间\n        })\n      })\n    },\n    // 详情回显\n    setFieldsValue() {\n      this.releaseStatus = this.info.published_type\n      this.activityState = Number(this.info.activity_state.id)\n      this.isLimit = this.info.is_limit_stock === 1\n      this.shopIds = this.info.support_shop\n      this.groupName = this.info.activity_name\n      this.form.setFieldsValue({\n        activity_name: this.info.activity_name,\n        group_sum: this.info.group_sum,\n        valid_time: this.info.valid_time,\n        stock_total: this.info.stock_total,\n        activity_time: [this.info.start_time, this.info.end_time]\n      })\n      if (this.releaseStatus === this.publishedType[2].value) {\n        this.form.setFieldsValue({\n          published_time: moment(this.info.published_time)\n        })\n      }\n      // 编辑不能改变活动开始时间\n      this.activityOptions.start.disabled =\n        this.isEdit && this.activityState > this.ACTIVITY_STATUS.PUBLISHER\n      // 活动结束不能改变活动结束时间\n      this.activityOptions.end.disabled =\n        this.isEdit && this.activityState >= this.ACTIVITY_STATUS.END\n    }\n  },\n  components: {\n    SelectShop\n  }\n}\n</script>\n"]}]}