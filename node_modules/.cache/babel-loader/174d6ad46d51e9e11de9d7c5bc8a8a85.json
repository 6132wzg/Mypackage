{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/card/member/period/h5mixin.js","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/card/member/period/h5mixin.js","mtime":1600912106792},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport { cloneDeep } from 'lodash-es';\nvar unitEnum = {\n  2: '天',\n  3: '月',\n  4: '年'\n};\nexport default {\n  data: function data() {\n    return {\n      h5CardInfo: {\n        card_name: '',\n        special_note: '',\n        admission_range: {},\n        admission_shop_list: [],\n        card_bg: {\n          image_id: 0,\n          image_key: this.cardBgList[0].image_key,\n          image_url: this.cardBgList[0].image_url,\n          index: 1\n        },\n        card_contents: '',\n        card_introduction: '',\n        price_gradient: [],\n        price: {\n          card_price: '',\n          deadline: {}\n        },\n        can_use_shop: [],\n        consumption_range: {},\n        description: '',\n        consumerList: []\n      }\n    };\n  },\n  watch: {\n    'cardData.card_introduction': function cardDataCard_introduction(val) {\n      this.h5CardInfo.card_introduction = val;\n    },\n    'cardData.card_contents': function cardDataCard_contents(val) {\n      this.h5CardInfo.card_contents = val;\n    },\n    'cardData.description': function cardDataDescription(val) {\n      this.h5CardInfo.description = val;\n    },\n    'cardData.card_bg': function cardDataCard_bg(val) {\n      console.log(val);\n      this.h5CardInfo.card_bg = val;\n    },\n    'cardData.price_setting': function cardDataPrice_setting(val) {\n      this.syncPrice();\n    },\n    'cardData.unit': function cardDataUnit(val) {\n      var cardData = this.form.getFieldsValue().cardData;\n      var price = {\n        card_price: cardData.card_price || '',\n        deadline: {\n          number: cardData.num || '',\n          type: val\n        }\n      };\n      this.h5CardInfo.price = price;\n    },\n    'cardData.bg_image': function cardDataBg_image(val) {\n      this.h5CardInfo.card_bg = val;\n    },\n    rallyPriceList: {\n      deep: true,\n      handler: function handler() {\n        this.syncPrice();\n      }\n    },\n    shopPriceList: {\n      deep: true,\n      handler: function handler() {\n        this.syncPrice();\n      }\n    }\n  },\n  methods: {\n    initH5CardInfo: function initH5CardInfo() {\n      var cardInfo = Object.assign({}, this.cardInfo);\n      this.h5CardInfo.card_name = cardInfo.card_name;\n      this.h5CardInfo.special_note = cardInfo.special_note;\n      this.syncAdmission();\n\n      if (this.cardType === 2) {\n        var price = {\n          card_price: cardInfo.card_price,\n          deadline: {\n            number: cardInfo.num,\n            type: cardInfo.unit\n          }\n        };\n        this.h5CardInfo.price = price;\n        cardInfo.card_consumer_id && this.syncConsumer(cardInfo.card_consumer_id);\n      }\n    },\n    syncName: function syncName(e) {\n      this.h5CardInfo.card_name = e.target.value;\n    },\n    syncSpecialNote: function syncSpecialNote(e) {\n      this.h5CardInfo.special_note = e.target.value;\n    },\n    syncDeadlineNum: function syncDeadlineNum(value) {\n      // 储值卡金额\n      var cardData = this.form.getFieldsValue().cardData;\n      var price = {\n        card_price: cardData.card_price || '',\n        deadline: {\n          number: value,\n          type: this.cardData.unit\n        }\n      };\n      this.h5CardInfo.price = price;\n    },\n    syncDepositPrice: function syncDepositPrice(value) {\n      // 储值卡金额\n      var cardData = this.form.getFieldsValue().cardData;\n      var price = {\n        card_price: value,\n        deadline: {\n          number: cardData.num || '',\n          type: this.cardData.unit\n        }\n      };\n      this.h5CardInfo.price = price;\n    },\n    syncPrice: function syncPrice(values) {\n      // 会员卡金额\n      var p = [];\n\n      switch (this.cardData.price_setting) {\n        case 1:\n          // 品牌统一定价\n          if (this.cardType === 0) {\n            this.rallyPriceList.forEach(function (i) {\n              p.push({\n                validity_period: +i.time.num + unitEnum[i.time.unit],\n                sale_price: +i.rally_price + '元'\n              });\n            });\n          } else if (this.cardType === 1) {\n            this.rallyPriceList.forEach(function (i) {\n              p.push({\n                validity_times: \"\".concat(+i.validity_times, \"\\u6B21\"),\n                sale_price: +i.rally_price + '元'\n              });\n            });\n          }\n\n          break;\n\n        case 2:\n          // 门店自主定价\n          if (this.cardType === 0) {\n            this.shopPriceList.forEach(function (i) {\n              p.push({\n                validity_period: +i.time.num + unitEnum[i.time.unit],\n                sale_price: \"\".concat(+i.rally_price.min_price, \"\\u5143~\").concat(+i.rally_price.max_price, \"\\u5143\")\n              });\n            });\n          } else if (this.cardType === 1) {\n            this.shopPriceList.forEach(function (i) {\n              p.push({\n                validity_times: \"\".concat(+i.validity_times, \"\\u6B21\"),\n                sale_price: \"\".concat(+i.rally_price.min_price, \"\\u5143~\").concat(+i.rally_price.max_price, \"\\u5143\")\n              });\n            });\n          }\n\n          break;\n      }\n\n      this.h5CardInfo.price_gradient = cloneDeep(p);\n    },\n    syncAdmission: function syncAdmission() {\n      if (this.cardType === 2) {\n        var rangeId = this.cardData.consumption_range;\n\n        switch (rangeId) {\n          case 1:\n            this.h5CardInfo.consumption_range = {\n              id: 1,\n              name: '仅消费门店'\n            };\n            break;\n\n          case 2:\n            this.h5CardInfo.consumption_range = {\n              id: 2,\n              name: '多门店'\n            };\n            break;\n\n          case 3:\n            this.h5CardInfo.consumption_range = {\n              id: 3,\n              name: '全门店'\n            };\n            break;\n        }\n      } else {\n        var _rangeId = this.cardData.admission_range;\n\n        switch (_rangeId) {\n          case 1:\n            this.h5CardInfo.admission_range = {\n              id: 1,\n              name: '仅消费门店'\n            };\n            break;\n\n          case 2:\n            this.h5CardInfo.admission_range = {\n              id: 2,\n              name: '多门店'\n            };\n            break;\n\n          case 3:\n            this.h5CardInfo.admission_range = {\n              id: 3,\n              name: '全门店'\n            };\n            break;\n        }\n      }\n    },\n    syncAdmissionShop: function syncAdmissionShop() {\n      var _this = this;\n\n      if (this.cardType === 2) {\n        var shopIDs = this.cardData.consumer_shop_list;\n\n        if (shopIDs.length) {\n          this.addService.getShopBasic({\n            shop_ids: shopIDs\n          }).subscribe(function (res) {\n            _this.h5CardInfo.can_use_shop = res;\n          });\n        }\n      } else {\n        var _shopIDs = this.cardData.admission_shop_list;\n\n        if (_shopIDs.length) {\n          this.addService.getShopBasic({\n            shop_ids: _shopIDs\n          }).subscribe(function (res) {\n            _this.h5CardInfo.admission_shop_list = res;\n          });\n        }\n      }\n    },\n    syncConsumer: function syncConsumer(checkValue) {\n      console.log(checkValue);\n      var consumerEnum = this.consumerType;\n      this.h5CardInfo.consumerList = checkValue.map(function (item) {\n        return consumerEnum[--item].label;\n      });\n    }\n  }\n};",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/card/member/period/h5mixin.js"],"names":["cloneDeep","unitEnum","data","h5CardInfo","card_name","special_note","admission_range","admission_shop_list","card_bg","image_id","image_key","cardBgList","image_url","index","card_contents","card_introduction","price_gradient","price","card_price","deadline","can_use_shop","consumption_range","description","consumerList","watch","val","console","log","syncPrice","cardData","form","getFieldsValue","number","num","type","rallyPriceList","deep","handler","shopPriceList","methods","initH5CardInfo","cardInfo","Object","assign","syncAdmission","cardType","unit","card_consumer_id","syncConsumer","syncName","e","target","value","syncSpecialNote","syncDeadlineNum","syncDepositPrice","values","p","price_setting","forEach","i","push","validity_period","time","sale_price","rally_price","validity_times","min_price","max_price","rangeId","id","name","syncAdmissionShop","shopIDs","consumer_shop_list","length","addService","getShopBasic","shop_ids","subscribe","res","checkValue","consumerEnum","consumerType","map","item","label"],"mappings":"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","sourcesContent":["import { cloneDeep } from 'lodash-es'\n\nconst unitEnum = {\n  2: '天',\n  3: '月',\n  4: '年'\n}\nexport default {\n  data() {\n    return {\n      h5CardInfo: {\n        card_name: '',\n        special_note: '',\n        admission_range: {},\n        admission_shop_list: [],\n        card_bg: {\n          image_id: 0,\n          image_key: this.cardBgList[0].image_key,\n          image_url: this.cardBgList[0].image_url,\n          index: 1\n        },\n        card_contents: '',\n        card_introduction: '',\n        price_gradient: [],\n        price: {\n          card_price: '',\n          deadline: {}\n        },\n        can_use_shop: [],\n        consumption_range: {},\n        description: '',\n        consumerList: []\n      }\n    }\n  },\n  watch: {\n    'cardData.card_introduction'(val) {\n      this.h5CardInfo.card_introduction = val\n    },\n    'cardData.card_contents'(val) {\n      this.h5CardInfo.card_contents = val\n    },\n    'cardData.description'(val) {\n      this.h5CardInfo.description = val\n    },\n    'cardData.card_bg'(val) {\n      console.log(val)\n      this.h5CardInfo.card_bg = val\n    },\n    'cardData.price_setting'(val) {\n      this.syncPrice()\n    },\n    'cardData.unit'(val) {\n      let cardData = this.form.getFieldsValue().cardData\n      let price = {\n        card_price: cardData.card_price || '',\n        deadline: {\n          number: cardData.num || '',\n          type: val\n        }\n      }\n      this.h5CardInfo.price = price\n    },\n    'cardData.bg_image'(val) {\n      this.h5CardInfo.card_bg = val\n    },\n    rallyPriceList: {\n      deep: true,\n      handler() {\n        this.syncPrice()\n      }\n    },\n    shopPriceList: {\n      deep: true,\n      handler() {\n        this.syncPrice()\n      }\n    }\n  },\n  methods: {\n    initH5CardInfo() {\n      let cardInfo = Object.assign({}, this.cardInfo)\n      this.h5CardInfo.card_name = cardInfo.card_name\n      this.h5CardInfo.special_note = cardInfo.special_note\n      this.syncAdmission()\n      if (this.cardType === 2) {\n        let price = {\n          card_price: cardInfo.card_price,\n          deadline: {\n            number: cardInfo.num,\n            type: cardInfo.unit\n          }\n        }\n        this.h5CardInfo.price = price\n        cardInfo.card_consumer_id &&\n          this.syncConsumer(cardInfo.card_consumer_id)\n      }\n    },\n    syncName(e) {\n      this.h5CardInfo.card_name = e.target.value\n    },\n    syncSpecialNote(e) {\n      this.h5CardInfo.special_note = e.target.value\n    },\n    syncDeadlineNum(value) {\n      // 储值卡金额\n      let cardData = this.form.getFieldsValue().cardData\n      let price = {\n        card_price: cardData.card_price || '',\n        deadline: {\n          number: value,\n          type: this.cardData.unit\n        }\n      }\n      this.h5CardInfo.price = price\n    },\n    syncDepositPrice(value) {\n      // 储值卡金额\n      let cardData = this.form.getFieldsValue().cardData\n      let price = {\n        card_price: value,\n        deadline: {\n          number: cardData.num || '',\n          type: this.cardData.unit\n        }\n      }\n      this.h5CardInfo.price = price\n    },\n    syncPrice(values) {\n      // 会员卡金额\n      let p = []\n      switch (this.cardData.price_setting) {\n        case 1:\n          // 品牌统一定价\n          if (this.cardType === 0) {\n            this.rallyPriceList.forEach(i => {\n              p.push({\n                validity_period: +i.time.num + unitEnum[i.time.unit],\n                sale_price: +i.rally_price + '元'\n              })\n            })\n          } else if (this.cardType === 1) {\n            this.rallyPriceList.forEach(i => {\n              p.push({\n                validity_times: `${+i.validity_times}次`,\n                sale_price: +i.rally_price + '元'\n              })\n            })\n          }\n          break\n        case 2:\n          // 门店自主定价\n          if (this.cardType === 0) {\n            this.shopPriceList.forEach(i => {\n              p.push({\n                validity_period: +i.time.num + unitEnum[i.time.unit],\n                sale_price: `${+i.rally_price.min_price}元~${+i.rally_price\n                  .max_price}元`\n              })\n            })\n          } else if (this.cardType === 1) {\n            this.shopPriceList.forEach(i => {\n              p.push({\n                validity_times: `${+i.validity_times}次`,\n                sale_price: `${+i.rally_price.min_price}元~${+i.rally_price\n                  .max_price}元`\n              })\n            })\n          }\n          break\n      }\n      this.h5CardInfo.price_gradient = cloneDeep(p)\n    },\n    syncAdmission() {\n      if (this.cardType === 2) {\n        let rangeId = this.cardData.consumption_range\n        switch (rangeId) {\n          case 1:\n            this.h5CardInfo.consumption_range = { id: 1, name: '仅消费门店' }\n            break\n          case 2:\n            this.h5CardInfo.consumption_range = { id: 2, name: '多门店' }\n            break\n          case 3:\n            this.h5CardInfo.consumption_range = { id: 3, name: '全门店' }\n            break\n        }\n      } else {\n        let rangeId = this.cardData.admission_range\n        switch (rangeId) {\n          case 1:\n            this.h5CardInfo.admission_range = { id: 1, name: '仅消费门店' }\n            break\n          case 2:\n            this.h5CardInfo.admission_range = { id: 2, name: '多门店' }\n            break\n          case 3:\n            this.h5CardInfo.admission_range = { id: 3, name: '全门店' }\n            break\n        }\n      }\n    },\n    syncAdmissionShop() {\n      if (this.cardType === 2) {\n        let shopIDs = this.cardData.consumer_shop_list\n        if (shopIDs.length) {\n          this.addService.getShopBasic({ shop_ids: shopIDs }).subscribe(res => {\n            this.h5CardInfo.can_use_shop = res\n          })\n        }\n      } else {\n        let shopIDs = this.cardData.admission_shop_list\n        if (shopIDs.length) {\n          this.addService.getShopBasic({ shop_ids: shopIDs }).subscribe(res => {\n            this.h5CardInfo.admission_shop_list = res\n          })\n        }\n      }\n    },\n    syncConsumer(checkValue) {\n      console.log(checkValue)\n      let consumerEnum = this.consumerType\n      this.h5CardInfo.consumerList = checkValue.map(\n        item => consumerEnum[--item].label\n      )\n    }\n  }\n}\n"]}]}