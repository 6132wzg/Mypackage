{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/setting/court/site.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/setting/court/site.vue","mtime":1600926556443},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { cloneDeep } from 'lodash-es';\nimport { imgFilter } from '@/filters/resource.filters';\nimport { MessageService } from '@/services/message.service';\nimport { SiteService } from \"./site.service\";\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue';\nexport default {\n  serviceInject: function serviceInject() {\n    return {\n      messageService: MessageService,\n      siteService: SiteService\n    };\n  },\n  rxState: function rxState() {\n    var siteService = this.siteService;\n    return {\n      resData: siteService.resData$,\n      loading: siteService.loading$\n    };\n  },\n  components: {\n    StImageUpload: StImageUpload\n  },\n  bem: {\n    bPage: 'page-shop-setting-court-site'\n  },\n  filters: {\n    imgFilter: imgFilter\n  },\n  data: function data() {\n    return {\n      isAdd: false,\n      addInfo: {},\n      editInfo: {}\n    };\n  },\n  computed: {\n    canShowAddBtn: function canShowAddBtn() {\n      /**\n       * 单个场地最多可以新增20个座位模板\n       */\n      return this.list.length < 20 && !this.isAdd && !this.editInfo.id;\n    },\n    list: function list() {\n      return this.resData.list;\n    }\n  },\n  methods: {\n    onAdd: function onAdd() {\n      this.isAdd = true;\n      this.editInfo = {};\n      this.addInfo = {\n        shop_area_id: this.$searchQuery.id,\n        seat_img: {},\n        seat_name: '',\n        seat_num: ''\n      };\n    },\n    onAddSubmit: function onAddSubmit() {\n      var _this = this;\n\n      if (!this.inputCheck(this.addInfo)) {\n        return;\n      }\n\n      this.siteService.add(this.addInfo).subscribe(function () {\n        _this.onActionSuccess('add');\n      });\n    },\n    onAddCancel: function onAddCancel() {\n      this.isAdd = false;\n    },\n    onEdit: function onEdit(record) {\n      this.isAdd = false;\n      this.editInfo = cloneDeep(record);\n    },\n    onEditSubmit: function onEditSubmit() {\n      var _this2 = this;\n\n      if (!this.inputCheck(this.editInfo)) {\n        return;\n      }\n\n      this.siteService.update(this.editInfo).subscribe(function () {\n        _this2.onActionSuccess('edit');\n      });\n    },\n    onEditCancel: function onEditCancel() {\n      this.editInfo = {};\n    },\n    onDelete: function onDelete(id) {\n      var _this3 = this;\n\n      this.siteService.del(id).subscribe(function () {\n        _this3.onActionSuccess('del');\n      });\n    },\n    onActionSuccess: function onActionSuccess(type) {\n      var msg = {\n        add: '新增成功',\n        edit: '编辑成功',\n        del: '删除成功'\n      }[type];\n      this.messageService.success({\n        content: msg\n      });\n      this.onListChange();\n    },\n    onListChange: function onListChange() {\n      this.isAdd = false;\n      this.editInfo = {};\n      this.$router.push({\n        query: this.$searchQuery\n      });\n    },\n    onAddImgChange: function onAddImgChange(fileList) {\n      this.addInfo.seat_img = fileList[0];\n    },\n    onEditImgChange: function onEditImgChange(fileList) {\n      this.editInfo.seat_img = fileList[0];\n    },\n    inputCheck: function inputCheck() {\n      var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var seatImg = data.seat_img;\n      var seatName = data.seat_name;\n      var seatNum = data.seat_num.toString();\n\n      if (!seatImg.image_key) {\n        this.onErrorTip('请上传座位图片');\n        return false;\n      }\n\n      if (!seatName.length) {\n        this.onErrorTip('请输入座位模板名称');\n        return false;\n      }\n\n      if (!seatNum.length) {\n        this.onErrorTip('请输入座位数量');\n        return false;\n      }\n\n      if (seatNum > this.resData.contain_number) {\n        this.onErrorTip('座位数量不能超过场地的最大容纳人数');\n        return false;\n      }\n\n      return true;\n    },\n    onErrorTip: function onErrorTip(msg) {\n      this.messageService.error({\n        content: msg\n      });\n    }\n  }\n};",{"version":3,"sources":["site.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmIA,SAAA,SAAA,QAAA,WAAA;AACA,SAAA,SAAA,QAAA,4BAAA;AACA,SAAA,cAAA,QAAA,4BAAA;AACA,SAAA,WAAA;AACA,OAAA,aAAA,MAAA,mDAAA;AACA,eAAA;AACA,EAAA,aADA,2BACA;AACA,WAAA;AACA,MAAA,cAAA,EAAA,cADA;AAEA,MAAA,WAAA,EAAA;AAFA,KAAA;AAIA,GANA;AAOA,EAAA,OAPA,qBAOA;AACA,QAAA,WAAA,GAAA,KAAA,WAAA;AACA,WAAA;AACA,MAAA,OAAA,EAAA,WAAA,CAAA,QADA;AAEA,MAAA,OAAA,EAAA,WAAA,CAAA;AAFA,KAAA;AAIA,GAbA;AAcA,EAAA,UAAA,EAAA;AACA,IAAA,aAAA,EAAA;AADA,GAdA;AAiBA,EAAA,GAAA,EAAA;AACA,IAAA,KAAA,EAAA;AADA,GAjBA;AAoBA,EAAA,OAAA,EAAA;AACA,IAAA,SAAA,EAAA;AADA,GApBA;AAuBA,EAAA,IAvBA,kBAuBA;AACA,WAAA;AACA,MAAA,KAAA,EAAA,KADA;AAEA,MAAA,OAAA,EAAA,EAFA;AAGA,MAAA,QAAA,EAAA;AAHA,KAAA;AAKA,GA7BA;AA8BA,EAAA,QAAA,EAAA;AACA,IAAA,aADA,2BACA;AACA;;;AAGA,aAAA,KAAA,IAAA,CAAA,MAAA,GAAA,EAAA,IAAA,CAAA,KAAA,KAAA,IAAA,CAAA,KAAA,QAAA,CAAA,EAAA;AACA,KANA;AAOA,IAAA,IAPA,kBAOA;AACA,aAAA,KAAA,OAAA,CAAA,IAAA;AACA;AATA,GA9BA;AAyCA,EAAA,OAAA,EAAA;AACA,IAAA,KADA,mBACA;AACA,WAAA,KAAA,GAAA,IAAA;AACA,WAAA,QAAA,GAAA,EAAA;AACA,WAAA,OAAA,GAAA;AACA,QAAA,YAAA,EAAA,KAAA,YAAA,CAAA,EADA;AAEA,QAAA,QAAA,EAAA,EAFA;AAGA,QAAA,SAAA,EAAA,EAHA;AAIA,QAAA,QAAA,EAAA;AAJA,OAAA;AAMA,KAVA;AAWA,IAAA,WAXA,yBAWA;AAAA;;AACA,UAAA,CAAA,KAAA,UAAA,CAAA,KAAA,OAAA,CAAA,EAAA;AACA;AACA;;AACA,WAAA,WAAA,CAAA,GAAA,CAAA,KAAA,OAAA,EAAA,SAAA,CAAA,YAAA;AACA,QAAA,KAAA,CAAA,eAAA,CAAA,KAAA;AACA,OAFA;AAGA,KAlBA;AAmBA,IAAA,WAnBA,yBAmBA;AACA,WAAA,KAAA,GAAA,KAAA;AACA,KArBA;AAsBA,IAAA,MAtBA,kBAsBA,MAtBA,EAsBA;AACA,WAAA,KAAA,GAAA,KAAA;AACA,WAAA,QAAA,GAAA,SAAA,CAAA,MAAA,CAAA;AACA,KAzBA;AA0BA,IAAA,YA1BA,0BA0BA;AAAA;;AACA,UAAA,CAAA,KAAA,UAAA,CAAA,KAAA,QAAA,CAAA,EAAA;AACA;AACA;;AACA,WAAA,WAAA,CAAA,MAAA,CAAA,KAAA,QAAA,EAAA,SAAA,CAAA,YAAA;AACA,QAAA,MAAA,CAAA,eAAA,CAAA,MAAA;AACA,OAFA;AAGA,KAjCA;AAkCA,IAAA,YAlCA,0BAkCA;AACA,WAAA,QAAA,GAAA,EAAA;AACA,KApCA;AAqCA,IAAA,QArCA,oBAqCA,EArCA,EAqCA;AAAA;;AACA,WAAA,WAAA,CAAA,GAAA,CAAA,EAAA,EAAA,SAAA,CAAA,YAAA;AACA,QAAA,MAAA,CAAA,eAAA,CAAA,KAAA;AACA,OAFA;AAGA,KAzCA;AA0CA,IAAA,eA1CA,2BA0CA,IA1CA,EA0CA;AACA,UAAA,GAAA,GAAA;AACA,QAAA,GAAA,EAAA,MADA;AAEA,QAAA,IAAA,EAAA,MAFA;AAGA,QAAA,GAAA,EAAA;AAHA,QAIA,IAJA,CAAA;AAKA,WAAA,cAAA,CAAA,OAAA,CAAA;AACA,QAAA,OAAA,EAAA;AADA,OAAA;AAGA,WAAA,YAAA;AACA,KApDA;AAqDA,IAAA,YArDA,0BAqDA;AACA,WAAA,KAAA,GAAA,KAAA;AACA,WAAA,QAAA,GAAA,EAAA;AACA,WAAA,OAAA,CAAA,IAAA,CAAA;AACA,QAAA,KAAA,EAAA,KAAA;AADA,OAAA;AAGA,KA3DA;AA4DA,IAAA,cA5DA,0BA4DA,QA5DA,EA4DA;AACA,WAAA,OAAA,CAAA,QAAA,GAAA,QAAA,CAAA,CAAA,CAAA;AACA,KA9DA;AA+DA,IAAA,eA/DA,2BA+DA,QA/DA,EA+DA;AACA,WAAA,QAAA,CAAA,QAAA,GAAA,QAAA,CAAA,CAAA,CAAA;AACA,KAjEA;AAkEA,IAAA,UAlEA,wBAkEA;AAAA,UAAA,IAAA,uEAAA,EAAA;AACA,UAAA,OAAA,GAAA,IAAA,CAAA,QAAA;AACA,UAAA,QAAA,GAAA,IAAA,CAAA,SAAA;AACA,UAAA,OAAA,GAAA,IAAA,CAAA,QAAA,CAAA,QAAA,EAAA;;AACA,UAAA,CAAA,OAAA,CAAA,SAAA,EAAA;AACA,aAAA,UAAA,CAAA,SAAA;AACA,eAAA,KAAA;AACA;;AACA,UAAA,CAAA,QAAA,CAAA,MAAA,EAAA;AACA,aAAA,UAAA,CAAA,WAAA;AACA,eAAA,KAAA;AACA;;AACA,UAAA,CAAA,OAAA,CAAA,MAAA,EAAA;AACA,aAAA,UAAA,CAAA,SAAA;AACA,eAAA,KAAA;AACA;;AACA,UAAA,OAAA,GAAA,KAAA,OAAA,CAAA,cAAA,EAAA;AACA,aAAA,UAAA,CAAA,mBAAA;AACA,eAAA,KAAA;AACA;;AACA,aAAA,IAAA;AACA,KAvFA;AAwFA,IAAA,UAxFA,sBAwFA,GAxFA,EAwFA;AACA,WAAA,cAAA,CAAA,KAAA,CAAA;AACA,QAAA,OAAA,EAAA;AADA,OAAA;AAGA;AA5FA;AAzCA,CAAA","sourcesContent":["<template>\n  <st-panel app :class=\"bPage()\">\n    <div slot=\"title\">\n      {{ resData.area_name }}\n      <img\n        v-if=\"resData.is_vip\"\n        src=\"~@/assets/img/icon_vip.png\"\n        width=\"26px\"\n        alt\n      />\n    </div>\n    <div slot=\"actions\">\n      <span>容纳人数：{{ resData.contain_number }}人</span>\n      <span class=\"mg-l32\">座位模版：{{ resData.count }}个</span>\n    </div>\n    <st-form-table>\n      <thead>\n        <tr>\n          <th width=\"20%\">座位图</th>\n          <th width=\"30%\">座位模版名称</th>\n          <th width=\"30%\">座位数量</th>\n          <th>操作</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td colspan=\"4\" class=\"st-form-table__add\">\n            <st-button\n              :disabled=\"!canShowAddBtn\"\n              @click=\"onAdd\"\n              type=\"dashed\"\n              icon=\"add\"\n              block\n            >\n              新增座位\n            </st-button>\n          </td>\n        </tr>\n        <tr v-if=\"isAdd\">\n          <td class=\"align-items-center\">\n            <st-image-upload\n              width=\"80px\"\n              height=\"80px\"\n              :size-limit=\"5\"\n              @change=\"onAddImgChange\"\n            />\n            <span class=\"st-des mg-l8\" style=\"width: 100px\">\n              大小不超过5M，比例1:1\n            </span>\n          </td>\n          <td>\n            <a-input v-model=\"addInfo.seat_name\" placeholder=\"请输入模版名称\" />\n          </td>\n          <td>\n            <st-input-number\n              style=\"width:300px\"\n              v-model=\"addInfo.seat_num\"\n              placeholder=\"请输入座位数量\"\n            />\n          </td>\n          <td>\n            <st-table-actions>\n              <a @click=\"onAddSubmit\">保存</a>\n              <a @click=\"onAddCancel\">取消</a>\n            </st-table-actions>\n          </td>\n        </tr>\n\n        <tr v-for=\"item in list\" :key=\"item.id\">\n          <template v-if=\"editInfo.id !== item.id\">\n            <td>\n              <div\n                v-if=\"item.seat_img\"\n                class=\"st-preview-item\"\n                v-viewer=\"{ url: 'data-src', toolbar: false }\"\n              >\n                <img\n                  v-if=\"item.seat_img\"\n                  width=\"80px\"\n                  :src=\"item.seat_img.image_key | imgFilter({ w: 80 })\"\n                  :data-src=\"item.seat_img.image_key | imgFilter\"\n                  alt=\"site-img\"\n                />\n              </div>\n            </td>\n            <td>{{ item.seat_name }}</td>\n            <td>{{ item.seat_num }}</td>\n            <td>\n              <st-table-actions>\n                <a @click=\"onEdit(item)\">编辑</a>\n                <a @click=\"onDelete(item.id)\">删除</a>\n              </st-table-actions>\n            </td>\n          </template>\n          <!-- 编辑状态 -->\n          <template v-else>\n            <td>\n              <st-image-upload\n                @change=\"onEditImgChange\"\n                :list=\"[item.seat_img]\"\n                width=\"80px\"\n                height=\"80px\"\n              />\n            </td>\n            <td>\n              <a-input\n                v-model=\"editInfo.seat_name\"\n                placeholder=\"请输入模版名称\"\n              ></a-input>\n            </td>\n            <td>\n              <st-input-number\n                style=\"width:300px\"\n                v-model=\"editInfo.seat_num\"\n                placeholder=\"请输入数位数量\"\n              ></st-input-number>\n            </td>\n            <td>\n              <st-table-actions>\n                <a @click=\"onEditSubmit\">保存</a>\n                <a @click=\"onEditCancel\">取消</a>\n              </st-table-actions>\n            </td>\n          </template>\n        </tr>\n      </tbody>\n    </st-form-table>\n  </st-panel>\n</template>\n\n<script>\nimport { cloneDeep } from 'lodash-es'\nimport { imgFilter } from '@/filters/resource.filters'\nimport { MessageService } from '@/services/message.service'\nimport { SiteService } from './site.service'\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue'\nexport default {\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      siteService: SiteService\n    }\n  },\n  rxState() {\n    const siteService = this.siteService\n    return {\n      resData: siteService.resData$,\n      loading: siteService.loading$\n    }\n  },\n  components: {\n    StImageUpload\n  },\n  bem: {\n    bPage: 'page-shop-setting-court-site'\n  },\n  filters: {\n    imgFilter\n  },\n  data() {\n    return {\n      isAdd: false,\n      addInfo: {},\n      editInfo: {}\n    }\n  },\n  computed: {\n    canShowAddBtn() {\n      /**\n       * 单个场地最多可以新增20个座位模板\n       */\n      return this.list.length < 20 && !this.isAdd && !this.editInfo.id\n    },\n    list() {\n      return this.resData.list\n    }\n  },\n  methods: {\n    onAdd() {\n      this.isAdd = true\n      this.editInfo = {}\n      this.addInfo = {\n        shop_area_id: this.$searchQuery.id,\n        seat_img: {},\n        seat_name: '',\n        seat_num: ''\n      }\n    },\n    onAddSubmit() {\n      if (!this.inputCheck(this.addInfo)) {\n        return\n      }\n      this.siteService.add(this.addInfo).subscribe(() => {\n        this.onActionSuccess('add')\n      })\n    },\n    onAddCancel() {\n      this.isAdd = false\n    },\n    onEdit(record) {\n      this.isAdd = false\n      this.editInfo = cloneDeep(record)\n    },\n    onEditSubmit() {\n      if (!this.inputCheck(this.editInfo)) {\n        return\n      }\n      this.siteService.update(this.editInfo).subscribe(() => {\n        this.onActionSuccess('edit')\n      })\n    },\n    onEditCancel() {\n      this.editInfo = {}\n    },\n    onDelete(id) {\n      this.siteService.del(id).subscribe(() => {\n        this.onActionSuccess('del')\n      })\n    },\n    onActionSuccess(type) {\n      const msg = {\n        add: '新增成功',\n        edit: '编辑成功',\n        del: '删除成功'\n      }[type]\n      this.messageService.success({\n        content: msg\n      })\n      this.onListChange()\n    },\n    onListChange() {\n      this.isAdd = false\n      this.editInfo = {}\n      this.$router.push({\n        query: this.$searchQuery\n      })\n    },\n    onAddImgChange(fileList) {\n      this.addInfo.seat_img = fileList[0]\n    },\n    onEditImgChange(fileList) {\n      this.editInfo.seat_img = fileList[0]\n    },\n    inputCheck(data = {}) {\n      const seatImg = data.seat_img\n      const seatName = data.seat_name\n      const seatNum = data.seat_num.toString()\n      if (!seatImg.image_key) {\n        this.onErrorTip('请上传座位图片')\n        return false\n      }\n      if (!seatName.length) {\n        this.onErrorTip('请输入座位模板名称')\n        return false\n      }\n      if (!seatNum.length) {\n        this.onErrorTip('请输入座位数量')\n        return false\n      }\n      if (seatNum > this.resData.contain_number) {\n        this.onErrorTip('座位数量不能超过场地的最大容纳人数')\n        return false\n      }\n      return true\n    },\n    onErrorTip(msg) {\n      this.messageService.error({\n        content: msg\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/shop/setting/court"}]}