{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/finance/split.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/finance/split.vue","mtime":1591147717217},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport { SplitService } from \"./split.service\";\nimport { cloneDeep } from 'lodash-es';\nimport { columns } from \"./split.config\";\nimport { SPLIT } from '@/constants/finance/split';\nimport { MessageService } from '@/services/message.service';\nexport default {\n  name: 'ModalShopFinanceOrderSplit',\n  bem: {\n    basic: 'modal-shop-finance-split'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      splitService: SplitService,\n      messageService: MessageService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      info: this.splitService.info$,\n      loading: this.splitService.loading$,\n      saleList: this.splitService.saleList$\n    };\n  },\n  props: ['id'],\n  data: function data() {\n    return {\n      SPLIT: SPLIT,\n      form: this.$form.createForm(this),\n      show: false,\n      description: '',\n      rate: 0,\n      saleMan: ''\n    };\n  },\n  computed: {\n    columns: columns\n  },\n  created: function created() {\n    var _this = this;\n\n    this.splitService.serviceInit(this.id).subscribe(function (result) {\n      _this.description = _this.info.description || '';\n      var item = {\n        edit: _this.SPLIT.EDIT_TYPE_3,\n        // 1 主销售编辑 2 协助销售编辑 3协助销售新增\n        staff_id: undefined,\n        staff_name: '',\n        staff_type: _this.SPLIT.STAFF_TYPE_2,\n        staff_type_name: '协助销售',\n        split_ratio: '',\n        split_money: ''\n      };\n      return _this.info.split_items.unshift(item);\n    });\n  },\n  methods: {\n    changeSaleMan: function changeSaleMan(saler, index) {\n      this.info.split_items[index].staff_id = saler.staff_id;\n      this.info.split_items[index].staff_name = saler.staff_name;\n    },\n    validSaleMan: function validSaleMan(record) {\n      if (!this.info.split_items || this.info.split_items.length >= 7) {\n        return false;\n      }\n\n      var percent = 0;\n\n      for (var i = 1; i < this.info.split_items.length; i++) {\n        percent += parseInt(this.info.split_items[i].split_ratio || 0, 10);\n\n        if (this.info.split_items[i].staff_id === record.staff_id) {\n          this.messageService.error({\n            content: '销售人员不能重复'\n          });\n          return false;\n        }\n      }\n\n      percent += parseInt(record.split_ratio, 10);\n\n      if (percent > 100) {\n        this.messageService.error({\n          content: '拆分比例总和不能超过100%'\n        });\n        return false;\n      }\n\n      return true;\n    },\n    addSaleMan: function addSaleMan(record) {\n      if (!record.staff_id || !record.split_ratio) {\n        return;\n      }\n\n      if (!this.validSaleMan(record)) {\n        return;\n      }\n\n      delete record.edit;\n      var split_money = +record.split_ratio / 100 * +this.info.actual_price;\n      split_money = Math.floor(split_money * 10) / 10;\n      record.split_money = split_money;\n      this.info.split_items.splice(0, 1, record);\n      var newRecord = {\n        edit: this.SPLIT.EDIT_TYPE_3,\n        staff_id: undefined,\n        staff_name: '',\n        staff_type: this.SPLIT.STAFF_TYPE_2,\n        staff_type_name: '协助销售',\n        split_ratio: '',\n        split_money: ''\n      };\n      this.info.split_items.unshift(newRecord);\n    },\n    onSave: function onSave(record, index) {\n      var percent = 0;\n      var arr = cloneDeep(this.info.split_items);\n      arr.shift();\n      arr.map(function (item) {\n        percent += parseInt(item.split_ratio || 0, 10);\n      }); // percent += parseInt(record.split_ratio, 10)\n\n      if (percent > 100) {\n        this.messageService.error({\n          content: '拆分比例总和不能超过100%'\n        });\n        return;\n      }\n\n      delete record.edit;\n      var split_money = +record.split_ratio / 100 * +this.info.actual_price;\n      split_money = Math.floor(split_money * 10) / 10;\n      record.split_money = split_money;\n      this.info.split_items.splice(index, 1, record);\n      this.info.split_items[0].staff_id = undefined;\n      this.info.split_items[0].split_ratio = '';\n    },\n    onEidt: function onEidt(record, index) {\n      record.meta = cloneDeep(record);\n      record.edit = record.staff_type;\n      this.info.split_items.splice(index, 1, record);\n    },\n    onCanel: function onCanel(record, index) {\n      record = record.meta;\n      this.info.split_items.splice(index, 1, record);\n    },\n    onDelete: function onDelete(index) {\n      this.info.split_items.splice(index, 1);\n    },\n    moment: moment,\n    onSubmit: function onSubmit() {\n      var _this2 = this;\n\n      var list = this.info.split_items.map(function (item) {\n        var params = {};\n\n        if (item.staff_id !== -1) {\n          params.staff_id = item.staff_id;\n          params.staff_rate = item.split_ratio;\n        }\n\n        return params;\n      });\n      list.shift();\n      var params = {\n        order_id: this.id,\n        description: this.description,\n        split_data: list\n      };\n      this.splitService.split(params).subscribe(function (result) {\n        _this2.show = false;\n\n        _this2.$emit('success');\n      });\n    }\n  }\n};",{"version":3,"sources":["split.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2HA,OAAA,MAAA,MAAA,QAAA;AACA,SAAA,YAAA;AACA,SAAA,SAAA,QAAA,WAAA;AACA,SAAA,OAAA;AACA,SAAA,KAAA,QAAA,2BAAA;AACA,SAAA,cAAA,QAAA,4BAAA;AACA,eAAA;AACA,EAAA,IAAA,EAAA,4BADA;AAEA,EAAA,GAAA,EAAA;AACA,IAAA,KAAA,EAAA;AADA,GAFA;AAKA,EAAA,aALA,2BAKA;AACA,WAAA;AACA,MAAA,YAAA,EAAA,YADA;AAEA,MAAA,cAAA,EAAA;AAFA,KAAA;AAIA,GAVA;AAWA,EAAA,OAXA,qBAWA;AACA,WAAA;AACA,MAAA,IAAA,EAAA,KAAA,YAAA,CAAA,KADA;AAEA,MAAA,OAAA,EAAA,KAAA,YAAA,CAAA,QAFA;AAGA,MAAA,QAAA,EAAA,KAAA,YAAA,CAAA;AAHA,KAAA;AAKA,GAjBA;AAkBA,EAAA,KAAA,EAAA,CAAA,IAAA,CAlBA;AAmBA,EAAA,IAnBA,kBAmBA;AACA,WAAA;AACA,MAAA,KAAA,EAAA,KADA;AAEA,MAAA,IAAA,EAAA,KAAA,KAAA,CAAA,UAAA,CAAA,IAAA,CAFA;AAGA,MAAA,IAAA,EAAA,KAHA;AAIA,MAAA,WAAA,EAAA,EAJA;AAKA,MAAA,IAAA,EAAA,CALA;AAMA,MAAA,OAAA,EAAA;AANA,KAAA;AAQA,GA5BA;AA6BA,EAAA,QAAA,EAAA;AACA,IAAA,OAAA,EAAA;AADA,GA7BA;AAgCA,EAAA,OAhCA,qBAgCA;AAAA;;AACA,SAAA,YAAA,CAAA,WAAA,CAAA,KAAA,EAAA,EAAA,SAAA,CAAA,UAAA,MAAA,EAAA;AACA,MAAA,KAAA,CAAA,WAAA,GAAA,KAAA,CAAA,IAAA,CAAA,WAAA,IAAA,EAAA;AACA,UAAA,IAAA,GAAA;AACA,QAAA,IAAA,EAAA,KAAA,CAAA,KAAA,CAAA,WADA;AACA;AACA,QAAA,QAAA,EAAA,SAFA;AAGA,QAAA,UAAA,EAAA,EAHA;AAIA,QAAA,UAAA,EAAA,KAAA,CAAA,KAAA,CAAA,YAJA;AAKA,QAAA,eAAA,EAAA,MALA;AAMA,QAAA,WAAA,EAAA,EANA;AAOA,QAAA,WAAA,EAAA;AAPA,OAAA;AASA,aAAA,KAAA,CAAA,IAAA,CAAA,WAAA,CAAA,OAAA,CAAA,IAAA,CAAA;AACA,KAZA;AAaA,GA9CA;AA+CA,EAAA,OAAA,EAAA;AACA,IAAA,aADA,yBACA,KADA,EACA,KADA,EACA;AACA,WAAA,IAAA,CAAA,WAAA,CAAA,KAAA,EAAA,QAAA,GAAA,KAAA,CAAA,QAAA;AACA,WAAA,IAAA,CAAA,WAAA,CAAA,KAAA,EAAA,UAAA,GAAA,KAAA,CAAA,UAAA;AACA,KAJA;AAKA,IAAA,YALA,wBAKA,MALA,EAKA;AACA,UAAA,CAAA,KAAA,IAAA,CAAA,WAAA,IAAA,KAAA,IAAA,CAAA,WAAA,CAAA,MAAA,IAAA,CAAA,EAAA;AACA,eAAA,KAAA;AACA;;AACA,UAAA,OAAA,GAAA,CAAA;;AACA,WAAA,IAAA,CAAA,GAAA,CAAA,EAAA,CAAA,GAAA,KAAA,IAAA,CAAA,WAAA,CAAA,MAAA,EAAA,CAAA,EAAA,EAAA;AACA,QAAA,OAAA,IAAA,QAAA,CAAA,KAAA,IAAA,CAAA,WAAA,CAAA,CAAA,EAAA,WAAA,IAAA,CAAA,EAAA,EAAA,CAAA;;AACA,YAAA,KAAA,IAAA,CAAA,WAAA,CAAA,CAAA,EAAA,QAAA,KAAA,MAAA,CAAA,QAAA,EAAA;AACA,eAAA,cAAA,CAAA,KAAA,CAAA;AACA,YAAA,OAAA,EAAA;AADA,WAAA;AAGA,iBAAA,KAAA;AACA;AACA;;AACA,MAAA,OAAA,IAAA,QAAA,CAAA,MAAA,CAAA,WAAA,EAAA,EAAA,CAAA;;AACA,UAAA,OAAA,GAAA,GAAA,EAAA;AACA,aAAA,cAAA,CAAA,KAAA,CAAA;AACA,UAAA,OAAA,EAAA;AADA,SAAA;AAGA,eAAA,KAAA;AACA;;AACA,aAAA,IAAA;AACA,KA3BA;AA4BA,IAAA,UA5BA,sBA4BA,MA5BA,EA4BA;AACA,UAAA,CAAA,MAAA,CAAA,QAAA,IAAA,CAAA,MAAA,CAAA,WAAA,EAAA;AACA;AACA;;AACA,UAAA,CAAA,KAAA,YAAA,CAAA,MAAA,CAAA,EAAA;AACA;AACA;;AACA,aAAA,MAAA,CAAA,IAAA;AACA,UAAA,WAAA,GAAA,CAAA,MAAA,CAAA,WAAA,GAAA,GAAA,GAAA,CAAA,KAAA,IAAA,CAAA,YAAA;AACA,MAAA,WAAA,GAAA,IAAA,CAAA,KAAA,CAAA,WAAA,GAAA,EAAA,IAAA,EAAA;AACA,MAAA,MAAA,CAAA,WAAA,GAAA,WAAA;AACA,WAAA,IAAA,CAAA,WAAA,CAAA,MAAA,CAAA,CAAA,EAAA,CAAA,EAAA,MAAA;AACA,UAAA,SAAA,GAAA;AACA,QAAA,IAAA,EAAA,KAAA,KAAA,CAAA,WADA;AAEA,QAAA,QAAA,EAAA,SAFA;AAGA,QAAA,UAAA,EAAA,EAHA;AAIA,QAAA,UAAA,EAAA,KAAA,KAAA,CAAA,YAJA;AAKA,QAAA,eAAA,EAAA,MALA;AAMA,QAAA,WAAA,EAAA,EANA;AAOA,QAAA,WAAA,EAAA;AAPA,OAAA;AASA,WAAA,IAAA,CAAA,WAAA,CAAA,OAAA,CAAA,SAAA;AACA,KAlDA;AAmDA,IAAA,MAnDA,kBAmDA,MAnDA,EAmDA,KAnDA,EAmDA;AACA,UAAA,OAAA,GAAA,CAAA;AACA,UAAA,GAAA,GAAA,SAAA,CAAA,KAAA,IAAA,CAAA,WAAA,CAAA;AACA,MAAA,GAAA,CAAA,KAAA;AACA,MAAA,GAAA,CAAA,GAAA,CAAA,UAAA,IAAA,EAAA;AACA,QAAA,OAAA,IAAA,QAAA,CAAA,IAAA,CAAA,WAAA,IAAA,CAAA,EAAA,EAAA,CAAA;AACA,OAFA,EAJA,CAOA;;AACA,UAAA,OAAA,GAAA,GAAA,EAAA;AACA,aAAA,cAAA,CAAA,KAAA,CAAA;AACA,UAAA,OAAA,EAAA;AADA,SAAA;AAGA;AACA;;AACA,aAAA,MAAA,CAAA,IAAA;AACA,UAAA,WAAA,GAAA,CAAA,MAAA,CAAA,WAAA,GAAA,GAAA,GAAA,CAAA,KAAA,IAAA,CAAA,YAAA;AACA,MAAA,WAAA,GAAA,IAAA,CAAA,KAAA,CAAA,WAAA,GAAA,EAAA,IAAA,EAAA;AACA,MAAA,MAAA,CAAA,WAAA,GAAA,WAAA;AACA,WAAA,IAAA,CAAA,WAAA,CAAA,MAAA,CAAA,KAAA,EAAA,CAAA,EAAA,MAAA;AACA,WAAA,IAAA,CAAA,WAAA,CAAA,CAAA,EAAA,QAAA,GAAA,SAAA;AACA,WAAA,IAAA,CAAA,WAAA,CAAA,CAAA,EAAA,WAAA,GAAA,EAAA;AACA,KAxEA;AAyEA,IAAA,MAzEA,kBAyEA,MAzEA,EAyEA,KAzEA,EAyEA;AACA,MAAA,MAAA,CAAA,IAAA,GAAA,SAAA,CAAA,MAAA,CAAA;AACA,MAAA,MAAA,CAAA,IAAA,GAAA,MAAA,CAAA,UAAA;AACA,WAAA,IAAA,CAAA,WAAA,CAAA,MAAA,CAAA,KAAA,EAAA,CAAA,EAAA,MAAA;AACA,KA7EA;AA8EA,IAAA,OA9EA,mBA8EA,MA9EA,EA8EA,KA9EA,EA8EA;AACA,MAAA,MAAA,GAAA,MAAA,CAAA,IAAA;AACA,WAAA,IAAA,CAAA,WAAA,CAAA,MAAA,CAAA,KAAA,EAAA,CAAA,EAAA,MAAA;AACA,KAjFA;AAkFA,IAAA,QAlFA,oBAkFA,KAlFA,EAkFA;AACA,WAAA,IAAA,CAAA,WAAA,CAAA,MAAA,CAAA,KAAA,EAAA,CAAA;AACA,KApFA;AAqFA,IAAA,MAAA,EAAA,MArFA;AAsFA,IAAA,QAtFA,sBAsFA;AAAA;;AACA,UAAA,IAAA,GAAA,KAAA,IAAA,CAAA,WAAA,CAAA,GAAA,CAAA,UAAA,IAAA,EAAA;AACA,YAAA,MAAA,GAAA,EAAA;;AACA,YAAA,IAAA,CAAA,QAAA,KAAA,CAAA,CAAA,EAAA;AACA,UAAA,MAAA,CAAA,QAAA,GAAA,IAAA,CAAA,QAAA;AACA,UAAA,MAAA,CAAA,UAAA,GAAA,IAAA,CAAA,WAAA;AACA;;AACA,eAAA,MAAA;AACA,OAPA,CAAA;AAQA,MAAA,IAAA,CAAA,KAAA;AACA,UAAA,MAAA,GAAA;AACA,QAAA,QAAA,EAAA,KAAA,EADA;AAEA,QAAA,WAAA,EAAA,KAAA,WAFA;AAGA,QAAA,UAAA,EAAA;AAHA,OAAA;AAKA,WAAA,YAAA,CAAA,KAAA,CAAA,MAAA,EAAA,SAAA,CAAA,UAAA,MAAA,EAAA;AACA,QAAA,MAAA,CAAA,IAAA,GAAA,KAAA;;AACA,QAAA,MAAA,CAAA,KAAA,CAAA,SAAA;AACA,OAHA;AAIA;AAzGA;AA/CA,CAAA","sourcesContent":["<template>\n  <st-modal\n    title=\"业绩拆分\"\n    width=\"800px\"\n    v-model=\"show\"\n    :loading=\"loading.serviceInit\"\n    wrapClassName=\"modal-shop-finance-split\"\n  >\n    <div :class=\"basic('content')\">\n      <a-row :class=\"basic('info')\">\n        <a-col :span=\"12\" class=\"mg-b36\">\n          <st-info>\n            <st-info-item label=\"订单号\">{{ info.order_id }}</st-info-item>\n            <st-info-item label=\"下单人\">{{ info.operator_name }}</st-info-item>\n            <st-info-item label=\"销售\">{{ info.staff_name }}</st-info-item>\n          </st-info>\n        </a-col>\n        <a-col :span=\"12\" class=\"mg-b36\">\n          <st-info>\n            <st-info-item label=\"下单时间\">\n              {{ info.created_time }}\n            </st-info-item>\n            <st-info-item label=\"订单总额\">\n              {{ info.total_price }}元\n            </st-info-item>\n            <st-info-item label=\"实收金额\">\n              {{ info.actual_price }}元\n            </st-info-item>\n          </st-info>\n        </a-col>\n      </a-row>\n      <st-table\n        rowKey=\"staff_id\"\n        :pagination=\"false\"\n        :columns=\"columns\"\n        :dataSource=\"info.split_items\"\n      >\n        <template slot=\"staff_name\" slot-scope=\"text, record, index\">\n          <a-select\n            v-if=\"record.edit && record.staff_type !== SPLIT.STAFF_TYPE_1\"\n            v-model=\"record.staff_id\"\n            style=\"width: 150px\"\n            placeholder=\"选择销售人员\"\n          >\n            <a-select-option\n              v-for=\"(saler, salerIndex) in saleList\"\n              @click=\"changeSaleMan(saler, index)\"\n              :key=\"salerIndex\"\n              :value=\"+saler.id\"\n            >\n              {{ saler.staff_name }}\n            </a-select-option>\n          </a-select>\n          <template v-else>\n            {{ text }}\n          </template>\n        </template>\n        <template slot=\"split_ratio\" slot-scope=\"text, record\">\n          <st-input-number\n            v-if=\"record.edit\"\n            :min=\"0\"\n            :max=\"100\"\n            v-model=\"record.split_ratio\"\n            :float=\"false\"\n            placeholder=\"请输入占比\"\n            style=\"width:150px\"\n          >\n            <span slot=\"addonAfter\">%</span>\n          </st-input-number>\n          <template v-else>\n            {{ text }}\n          </template>\n        </template>\n        <div slot=\"action\" slot-scope=\"text, record, index\">\n          <st-table-actions>\n            <a\n              v-if=\"record.edit === SPLIT.EDIT_TYPE_3\"\n              @click=\"addSaleMan(record)\"\n            >\n              协助售卖人\n            </a>\n            <a\n              v-if=\"record.edit && record.edit !== SPLIT.EDIT_TYPE_3\"\n              @click=\"onSave(record, index)\"\n            >\n              确定\n            </a>\n            <a v-if=\"!record.edit\" @click=\"onEidt(record, index)\">编辑</a>\n            <a\n              v-if=\"\n                record.edit === SPLIT.EDIT_TYPE_1 ||\n                  record.edit === SPLIT.EDIT_TYPE_2\n              \"\n              @click=\"onCanel(record, index)\"\n            >\n              取消\n            </a>\n            <a\n              v-if=\"!record.edit && record.staff_type !== SPLIT.STAFF_TYPE_1\"\n              @click=\"onDelete(index)\"\n            >\n              删除\n            </a>\n          </st-table-actions>\n        </div>\n      </st-table>\n      <div :class=\"basic('descrip')\">\n        <label>备注</label>\n        <a-textarea\n          v-model=\"description\"\n          :autosize=\"{ minRows: 4, maxRows: 6 }\"\n        />\n      </div>\n    </div>\n    <template slot=\"footer\">\n      <st-button @click=\"onSubmit\" :loading=\"loading.split\" type=\"primary\">\n        确认拆分\n      </st-button>\n    </template>\n  </st-modal>\n</template>\n\n<script>\nimport moment from 'moment'\nimport { SplitService } from './split.service'\nimport { cloneDeep } from 'lodash-es'\nimport { columns } from './split.config'\nimport { SPLIT } from '@/constants/finance/split'\nimport { MessageService } from '@/services/message.service'\nexport default {\n  name: 'ModalShopFinanceOrderSplit',\n  bem: {\n    basic: 'modal-shop-finance-split'\n  },\n  serviceInject() {\n    return {\n      splitService: SplitService,\n      messageService: MessageService\n    }\n  },\n  rxState() {\n    return {\n      info: this.splitService.info$,\n      loading: this.splitService.loading$,\n      saleList: this.splitService.saleList$\n    }\n  },\n  props: ['id'],\n  data() {\n    return {\n      SPLIT,\n      form: this.$form.createForm(this),\n      show: false,\n      description: '',\n      rate: 0,\n      saleMan: ''\n    }\n  },\n  computed: {\n    columns\n  },\n  created() {\n    this.splitService.serviceInit(this.id).subscribe(result => {\n      this.description = this.info.description || ''\n      const item = {\n        edit: this.SPLIT.EDIT_TYPE_3, // 1 主销售编辑 2 协助销售编辑 3协助销售新增\n        staff_id: undefined,\n        staff_name: '',\n        staff_type: this.SPLIT.STAFF_TYPE_2,\n        staff_type_name: '协助销售',\n        split_ratio: '',\n        split_money: ''\n      }\n      return this.info.split_items.unshift(item)\n    })\n  },\n  methods: {\n    changeSaleMan(saler, index) {\n      this.info.split_items[index].staff_id = saler.staff_id\n      this.info.split_items[index].staff_name = saler.staff_name\n    },\n    validSaleMan(record) {\n      if (!this.info.split_items || this.info.split_items.length >= 7) {\n        return false\n      }\n      let percent = 0\n      for (let i = 1; i < this.info.split_items.length; i++) {\n        percent += parseInt(this.info.split_items[i].split_ratio || 0, 10)\n        if (this.info.split_items[i].staff_id === record.staff_id) {\n          this.messageService.error({\n            content: '销售人员不能重复'\n          })\n          return false\n        }\n      }\n      percent += parseInt(record.split_ratio, 10)\n      if (percent > 100) {\n        this.messageService.error({\n          content: '拆分比例总和不能超过100%'\n        })\n        return false\n      }\n      return true\n    },\n    addSaleMan(record) {\n      if (!record.staff_id || !record.split_ratio) {\n        return\n      }\n      if (!this.validSaleMan(record)) {\n        return\n      }\n      delete record.edit\n      let split_money = (+record.split_ratio / 100) * +this.info.actual_price\n      split_money = Math.floor(split_money * 10) / 10\n      record.split_money = split_money\n      this.info.split_items.splice(0, 1, record)\n      const newRecord = {\n        edit: this.SPLIT.EDIT_TYPE_3,\n        staff_id: undefined,\n        staff_name: '',\n        staff_type: this.SPLIT.STAFF_TYPE_2,\n        staff_type_name: '协助销售',\n        split_ratio: '',\n        split_money: ''\n      }\n      this.info.split_items.unshift(newRecord)\n    },\n    onSave(record, index) {\n      let percent = 0\n      const arr = cloneDeep(this.info.split_items)\n      arr.shift()\n      arr.map(item => {\n        percent += parseInt(item.split_ratio || 0, 10)\n      })\n      // percent += parseInt(record.split_ratio, 10)\n      if (percent > 100) {\n        this.messageService.error({\n          content: '拆分比例总和不能超过100%'\n        })\n        return\n      }\n      delete record.edit\n      let split_money = (+record.split_ratio / 100) * +this.info.actual_price\n      split_money = Math.floor(split_money * 10) / 10\n      record.split_money = split_money\n      this.info.split_items.splice(index, 1, record)\n      this.info.split_items[0].staff_id = undefined\n      this.info.split_items[0].split_ratio = ''\n    },\n    onEidt(record, index) {\n      record.meta = cloneDeep(record)\n      record.edit = record.staff_type\n      this.info.split_items.splice(index, 1, record)\n    },\n    onCanel(record, index) {\n      record = record.meta\n      this.info.split_items.splice(index, 1, record)\n    },\n    onDelete(index) {\n      this.info.split_items.splice(index, 1)\n    },\n    moment,\n    onSubmit() {\n      const list = this.info.split_items.map(item => {\n        const params = {}\n        if (item.staff_id !== -1) {\n          params.staff_id = item.staff_id\n          params.staff_rate = item.split_ratio\n        }\n        return params\n      })\n      list.shift()\n      const params = {\n        order_id: this.id,\n        description: this.description,\n        split_data: list\n      }\n      this.splitService.split(params).subscribe(result => {\n        this.show = false\n        this.$emit('success')\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/shop/finance"}]}