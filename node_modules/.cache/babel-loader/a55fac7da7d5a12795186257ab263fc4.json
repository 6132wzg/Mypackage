{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/coupon/add.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/coupon/add.vue","mtime":1591147717304},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { UserService } from '@/services/user.service';\nimport { TitleService } from '@/services/title.service';\nimport moment from 'moment';\nimport { cloneDeep, remove, find as lodashFind } from 'lodash-es';\nimport { AddService } from \"./add.service\";\nimport SelectShop from '@/views/fragments/shop/select-shop';\nimport H5Container from '@/views/biz-components/h5/h5-container';\nimport { ruleOptions } from \"./add.config\";\nexport default {\n  name: 'BrandMarketingPluginCouponAdd',\n  serviceInject: function serviceInject() {\n    return {\n      addService: AddService,\n      userService: UserService,\n      titleService: TitleService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.addService.loading$,\n      couponTypeOptions: this.addService.couponTypeOptions$,\n      isShopRangeOptions: this.addService.isShopRangeOptions$,\n      product_ranges: this.addService.product_ranges$\n    };\n  },\n  bem: {\n    basic: 'brand-marketing-coupon-add'\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      // isEditMode: false,\n      // form: this.$form.createForm(this),\n      // 优惠类型\n      couponType: 1,\n      // 优惠范围\n      showProductRange: '2',\n      // 门店范围\n      showShopRange: '2',\n      // 满足金额\n      fullPrice: '',\n      // 是否共享\n      isShare: false,\n      // 限领数量\n      personLimit: '',\n      // 已经选择的类目ids\n      rangeIds: [],\n      // 已经选择的门店ids\n      shopIds: [],\n      shopNames: ''\n    };\n  },\n  props: {\n    isEditMode: {\n      type: Boolean,\n      default: false\n    },\n    info: {\n      type: Object,\n      default: function _default() {}\n    }\n  },\n  created: function created() {\n    if (this.isEditMode) {\n      this.setFieldsValue();\n    }\n  },\n  methods: {\n    limitChange: function limitChange(e) {\n      this.form.resetFields(['person_limit']);\n    },\n    userTypeChange: function userTypeChange(e) {\n      this.form.resetFields(['full_price']);\n    },\n    getValidDay: function getValidDay(days) {\n      return moment().add(days, 'd').format('YYYY年MM月DD日 23:59');\n    },\n    getRange: function getRange() {\n      var _this = this;\n\n      var ranges = this.rangeIds.map(function (id) {\n        return lodashFind(_this.product_ranges, {\n          value: id\n        }).label;\n      });\n      return ranges;\n    },\n    changeProductRange: function changeProductRange(event) {\n      this.rangeIds = event;\n    },\n    onSelectShop: function onSelectShop(event) {\n      this.shopIds = event;\n    },\n    checkThisLimitRadio: function checkThisLimitRadio() {\n      this.form.setFieldsValue({\n        is_limit: 2\n      });\n    },\n    setFieldsValue: function setFieldsValue() {\n      var _this2 = this;\n\n      this.couponType = this.info.coupon_type.id;\n      this.showProductRange = this.info.is_product_range + '';\n      this.showShopRange = this.info.is_shop_range + '';\n      this.shopIds = this.info.shop_ids;\n      this.rangeIds = this.info.range_ids;\n      setTimeout(function () {\n        _this2.form.setFieldsValue({\n          coupon_name: _this2.info.coupon_name,\n          price: +_this2.info.price,\n          use_type: _this2.info.use_type,\n          full_price: +_this2.info.full_price || '',\n          number: _this2.info.number,\n          valid_days: _this2.info.valid_days,\n          is_share: _this2.info.is_share,\n          is_limit: _this2.info.is_limit,\n          person_limit: _this2.info.person_limit || ''\n        });\n      });\n    },\n    // 保存\n    onSubmit: function onSubmit() {\n      var _this3 = this;\n\n      this.form.validate().then(function (values) {\n        var params = {};\n\n        if (_this3.isEditMode) {\n          params.id = _this3.$searchQuery.id;\n          params.before_number = _this3.info.number;\n          params.after_number = values.number;\n        } else {\n          params = {\n            coupon_type: _this3.couponType,\n            coupon_name: values.coupon_name,\n            price: values.price,\n            is_product_range: _this3.showProductRange,\n            range_ids: _this3.rangeIds,\n            is_shop_range: _this3.showShopRange,\n            shop_ids: _this3.shopIds,\n            use_type: values.use_type,\n            full_price: values.full_price,\n            number: values.number,\n            valid_days: values.valid_days,\n            is_share: values.is_share,\n            is_limit: values.is_limit,\n            person_limit: values.person_limit || undefined\n          };\n        }\n\n        if (_this3.isEditMode) {\n          _this3.addService.editMarketingCoupon(params).subscribe(function (res) {\n            // 编辑成功\n            _this3.$router.push({\n              path: '/brand/marketing/plugin/coupon/list'\n            });\n          });\n        } else {\n          _this3.addService.addMarketingCoupon(params).subscribe(function (res) {\n            // 新增成功\n            _this3.$router.push({\n              path: \"/brand/marketing/plugin/coupon/list\"\n            });\n          });\n        }\n      });\n    }\n  },\n  watch: {\n    shopIds: function shopIds(val) {\n      var _this4 = this;\n\n      if (val && val.length) {\n        this.addService.getShopBasic({\n          shop_ids: val\n        }).subscribe(function (res) {\n          _this4.shopNames = res.map(function (_ref) {\n            var shop_name = _ref.shop_name;\n            return shop_name;\n          }).join('/');\n        });\n      }\n    }\n  },\n  components: {\n    SelectShop: SelectShop,\n    H5Container: H5Container\n  }\n};",null]}