{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/member/info/reserve.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/member/info/reserve.service.ts","mtime":1600926556362},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { Injectable } from 'vue-service-app';\nimport { State } from 'rx-state';\nimport { tap } from 'rxjs/operators';\nimport { MemberApi } from '@/api/v1/member';\nimport { anyAll } from '@/operators';\n\nvar ReserveService = /*#__PURE__*/function () {\n  function ReserveService(memberApi) {\n    _classCallCheck(this, ReserveService);\n\n    this.memberApi = memberApi;\n    this.memberCardList$ = new State([]);\n    this.depositCardList$ = new State([]);\n    this.personalCourseList$ = new State([]);\n    this.packageList$ = new State([]);\n    this.smallCourseList$ = new State([]);\n    this.memberCardPage$ = new State({});\n    this.depositCardPage$ = new State({});\n    this.personalCoursePage$ = new State({});\n    this.packagePage$ = new State({});\n    this.smallCoursePage$ = new State({});\n  }\n\n  _createClass(ReserveService, [{\n    key: \"SET_MEMBER_CARD_LIST\",\n    value: function SET_MEMBER_CARD_LIST(list) {\n      list = list.map(function (item) {\n        item.initAmount = \"\".concat(item.init_amount.number).concat(item.init_amount.type);\n        item.remainAmount = \"\".concat(item.remain_amount.number).concat(item.remain_amount.type);\n        item.memberList = item.member_info.members.map(function (member) {\n          if (member.is_purchaser) {\n            return \"\\u8D2D\\u4E70\\u4EBA: \".concat(member.member_info);\n          } else {\n            return \"\\u6210\\u5458: \".concat(member.member_info);\n          }\n        });\n        return item;\n      });\n      this.memberCardList$.commit(function () {\n        return list;\n      });\n    }\n  }, {\n    key: \"SET_DEPOSIT_CARD_LIST\",\n    value: function SET_DEPOSIT_CARD_LIST(list) {\n      list = list.map(function (item) {\n        item.initAmount = \"\".concat(item.init_amount.number).concat(item.init_amount.type);\n        item.remainAmount = \"\".concat(item.remain_amount.number).concat(item.remain_amount.type);\n        return item;\n      });\n      this.depositCardList$.commit(function () {\n        return list;\n      });\n    }\n  }, {\n    key: \"SET_PERSONAL_COURSE_LIST\",\n    value: function SET_PERSONAL_COURSE_LIST(list) {\n      this.personalCourseList$.commit(function () {\n        return list;\n      });\n    }\n  }, {\n    key: \"SET_PACKAGE_LIST\",\n    value: function SET_PACKAGE_LIST(list) {\n      list = list.map(function (item) {\n        item.init = \"\".concat(item.team_course_init, \"/\").concat(item.personal_course_init);\n        item.remain = \"\".concat(item.team_course_remain, \"/\").concat(item.personal_course_remain);\n        item.memberList = item.member_info.members.map(function (member) {\n          if (member.is_purchaser) {\n            return \"\\u8D2D\\u4E70\\u4EBA: \".concat(member.member_info);\n          } else {\n            return \"\\u6210\\u5458: \".concat(member.member_info);\n          }\n        });\n        return item;\n      });\n      this.packageList$.commit(function () {\n        return list;\n      });\n    }\n  }, {\n    key: \"getMemberCardList\",\n    value: function getMemberCardList(query) {\n      var _this = this;\n\n      return this.memberApi.getMemberCardList(query).pipe(tap(function (res) {\n        _this.SET_MEMBER_CARD_LIST(res.list);\n\n        _this.memberCardPage$.commit(function () {\n          return res.page;\n        });\n      }));\n    }\n  }, {\n    key: \"getDepositCardList\",\n    value: function getDepositCardList(query) {\n      var _this2 = this;\n\n      return this.memberApi.getDepositCardList(query).pipe(tap(function (res) {\n        _this2.SET_DEPOSIT_CARD_LIST(res.list);\n\n        _this2.depositCardPage$.commit(function () {\n          return res.page;\n        });\n      }));\n    }\n  }, {\n    key: \"getPersonalCourseList\",\n    value: function getPersonalCourseList(query) {\n      var _this3 = this;\n\n      return this.memberApi.getPersonalCourseList(query).pipe(tap(function (res) {\n        _this3.SET_PERSONAL_COURSE_LIST(res.list);\n\n        _this3.personalCoursePage$.commit(function () {\n          return res.page;\n        });\n      }));\n    }\n  }, {\n    key: \"getPackageList\",\n    value: function getPackageList(query) {\n      var _this4 = this;\n\n      return this.memberApi.getPackageList(query).pipe(tap(function (res) {\n        _this4.SET_PACKAGE_LIST(res.list);\n\n        _this4.packagePage$.commit(function () {\n          return res.page;\n        });\n      }));\n    }\n  }, {\n    key: \"getSmallCourseList\",\n    value: function getSmallCourseList(query) {\n      var _this5 = this;\n\n      return this.memberApi.getSmallCourseList(query).pipe(tap(function (res) {\n        _this5.smallCourseList$.commit(function () {\n          return res.list;\n        });\n\n        _this5.smallCoursePage$.commit(function () {\n          return res.page;\n        });\n      }));\n    }\n  }, {\n    key: \"changePage\",\n    value: function changePage(query) {\n      var type = query.type;\n\n      switch (type) {\n        case 'member':\n          return this.getMemberCardList(query);\n\n        case 'deposit':\n          return this.getDepositCardList(query);\n\n        case 'package':\n          return this.getPackageList(query);\n\n        case 'personal':\n          return this.getPersonalCourseList(query);\n\n        case 'small':\n          return this.getSmallCourseList(query);\n\n        default:\n          return anyAll(this.getMemberCardList(query), this.getDepositCardList(query), this.getPackageList(query), this.getPersonalCourseList(query), this.getSmallCourseList(query));\n      }\n    }\n  }, {\n    key: \"init\",\n    value: function init(query) {\n      return this.changePage(query);\n    }\n  }, {\n    key: \"beforeRouteEnter\",\n    value: function beforeRouteEnter(to, from) {\n      return this.init(to.query);\n    }\n  }]);\n\n  return ReserveService;\n}();\n\nReserveService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof MemberApi !== \"undefined\" && MemberApi) === \"function\" ? _a : Object])], ReserveService);\nexport { ReserveService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/member/info/reserve.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable, ServiceRoute, Controller } from 'vue-service-app'\nimport { State } from 'rx-state'\nimport { tap } from 'rxjs/operators'\nimport { MemberApi, CardConsumptionQuery } from '@/api/v1/member'\nimport { anyAll } from '@/operators'\n\n@Injectable()\nexport class ReserveService implements Controller {\n  memberCardList$ = new State([])\n  depositCardList$ = new State([])\n  personalCourseList$ = new State([])\n  packageList$ = new State([])\n  smallCourseList$ = new State([])\n  memberCardPage$ = new State({})\n  depositCardPage$ = new State({})\n  personalCoursePage$ = new State({})\n  packagePage$ = new State({})\n  smallCoursePage$ = new State({})\n  constructor(private memberApi: MemberApi) {}\n\n  SET_MEMBER_CARD_LIST(list) {\n    list = list.map(item => {\n      item.initAmount = `${item.init_amount.number}${item.init_amount.type}`\n      item.remainAmount = `${item.remain_amount.number}${item.remain_amount.type}`\n      item.memberList = item.member_info.members.map(member => {\n        if (member.is_purchaser) {\n          return `购买人: ${member.member_info}`\n        } else {\n          return `成员: ${member.member_info}`\n        }\n      })\n      return item\n    })\n    this.memberCardList$.commit(() => list)\n  }\n  SET_DEPOSIT_CARD_LIST(list) {\n    list = list.map(item => {\n      item.initAmount = `${item.init_amount.number}${item.init_amount.type}`\n      item.remainAmount = `${item.remain_amount.number}${item.remain_amount.type}`\n      return item\n    })\n    this.depositCardList$.commit(() => list)\n  }\n  SET_PERSONAL_COURSE_LIST(list) {\n    this.personalCourseList$.commit(() => list)\n  }\n  SET_PACKAGE_LIST(list) {\n    list = list.map(item => {\n      item.init = `${item.team_course_init}/${item.personal_course_init}`\n      item.remain = `${item.team_course_remain}/${item.personal_course_remain}`\n      item.memberList = item.member_info.members.map(member => {\n        if (member.is_purchaser) {\n          return `购买人: ${member.member_info}`\n        } else {\n          return `成员: ${member.member_info}`\n        }\n      })\n      return item\n    })\n\n    this.packageList$.commit(() => list)\n  }\n  getMemberCardList(query: CardConsumptionQuery) {\n    return this.memberApi.getMemberCardList(query).pipe(\n      tap(res => {\n        this.SET_MEMBER_CARD_LIST(res.list)\n        this.memberCardPage$.commit(() => res.page)\n      })\n    )\n  }\n  getDepositCardList(query: CardConsumptionQuery) {\n    return this.memberApi.getDepositCardList(query).pipe(\n      tap(res => {\n        this.SET_DEPOSIT_CARD_LIST(res.list)\n        this.depositCardPage$.commit(() => res.page)\n      })\n    )\n  }\n  getPersonalCourseList(query: CardConsumptionQuery) {\n    return this.memberApi.getPersonalCourseList(query).pipe(\n      tap(res => {\n        this.SET_PERSONAL_COURSE_LIST(res.list)\n        this.personalCoursePage$.commit(() => res.page)\n      })\n    )\n  }\n  getPackageList(query: CardConsumptionQuery) {\n    return this.memberApi.getPackageList(query).pipe(\n      tap(res => {\n        this.SET_PACKAGE_LIST(res.list)\n        this.packagePage$.commit(() => res.page)\n      })\n    )\n  }\n  getSmallCourseList(query: CardConsumptionQuery) {\n    return this.memberApi.getSmallCourseList(query).pipe(\n      tap(res => {\n        this.smallCourseList$.commit(() => res.list)\n        this.smallCoursePage$.commit(() => res.page)\n      })\n    )\n  }\n  changePage(query) {\n    let type: string = query.type\n    switch (type) {\n      case 'member':\n        return this.getMemberCardList(query)\n      case 'deposit':\n        return this.getDepositCardList(query)\n      case 'package':\n        return this.getPackageList(query)\n      case 'personal':\n        return this.getPersonalCourseList(query)\n      case 'small':\n        return this.getSmallCourseList(query)\n      default:\n        return anyAll(\n          this.getMemberCardList(query),\n          this.getDepositCardList(query),\n          this.getPackageList(query),\n          this.getPersonalCourseList(query),\n          this.getSmallCourseList(query)\n        )\n    }\n  }\n  init(query: any) {\n    return this.changePage(query)\n  }\n  beforeRouteEnter(to: ServiceRoute, from: ServiceRoute) {\n    return this.init(to.query)\n  }\n}\n"],"sourceRoot":""}]}