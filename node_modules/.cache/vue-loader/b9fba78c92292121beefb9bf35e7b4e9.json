{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/fragments/course/set-price.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/fragments/course/set-price.vue","mtime":1600926556068},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { remove } from 'lodash-es'\nimport SelectCoachLevel from '@/views/fragments/coach/select-coach-level'\nimport { UserService } from '@/services/user.service'\n\nexport default {\n  name: 'SetPrice',\n  serviceInject() {\n    return {\n      userService: UserService\n    }\n  },\n  rxState() {\n    return {\n      personalCourseTransferUnitOptions: this.userService.getOptions$(\n        'personal_course.transfer_unit'\n      ),\n      brand: this.userService.brand$\n    }\n  },\n  computed: {\n    /**\n     *私教课程定价模式 1、教练谈单 2、统一标价\n     */\n    saleModel() {\n      return this.brand.saleModel\n    },\n    /**\n     *定价模式 1、教练统一定价 2、教练分级定价\n     */\n    priceModel() {\n      return this.brand.priceModel\n    }\n  },\n  watch: {\n    priceGradient: {\n      handler(val) {\n        this.$emit('change', this.priceGradientFilter(val))\n      },\n      deep: true\n    },\n    value: {\n      handler(val) {\n        this.priceGradient = val\n      },\n      deep: true\n    }\n  },\n  props: {\n    value: {\n      type: Array,\n      default() {\n        return []\n      }\n    }\n  },\n  data() {\n    return {\n      priceGradient: []\n    }\n  },\n  created() {\n    // 获取定价模式\n    this.initPriceGradient()\n  },\n  methods: {\n    initPriceGradient() {\n      this.priceGradient = this.value.length\n        ? this.value\n        : [\n            {\n              level_id: 0,\n              prices: []\n            }\n          ]\n    },\n    onChange(e) {\n      this.priceSetting = e.target.value\n    },\n    del(key, rowIndex) {\n      this.priceGradient[key].prices.splice(rowIndex, 1)\n      this.priceGradient = [...this.priceGradient]\n    },\n    addRecord() {\n      const newRecord = {\n        level_id: 0,\n        single_sell: 0,\n        single_price: '',\n        prices: []\n      }\n      this.priceGradient.push(newRecord)\n    },\n    delRecord(key) {\n      let { priceGradient } = this\n      remove(priceGradient, (item, index) => {\n        return index === key\n      })\n      this.priceGradient = [...priceGradient]\n    },\n    addPriceRecord(key) {\n      const newRecord = {\n        id: 0,\n        priceGradient: '',\n        price: '',\n        serviceFee: '',\n        transfer_unit: 1\n      }\n      if (!this.priceGradient[key].prices) {\n        this.priceGradient[key].prices = []\n      }\n      this.priceGradient = [...this.priceGradient]\n      this.priceGradient[key].prices.push(newRecord)\n    },\n    onLevelChange(val, key) {\n      this.priceGradient[key].level_id = val\n    },\n    priceGradientFilter(priceGradient) {\n      const DEFAULT_MAX_NUM = 10000\n      priceGradient.map((item, index) => {\n        const prices = item.prices || []\n        const pricesLen = prices.length\n        prices.map((price, i) => {\n          delete price.serviceFee\n          delete price.priceGradient\n          delete price.price\n          if (this.saleModel === 1) {\n            // 教练谈单模式，没有固定价格\n            price.sell_price = 0\n          }\n          if (this.saleModel === 2) {\n            // 统一标价模式下，没有价格梯度，传0\n            price.min_sell_price = 0\n            price.max_sell_price = 0\n          }\n          if (pricesLen === 1) {\n            prices[0].max_sale = DEFAULT_MAX_NUM\n          }\n          if (i > 0) {\n            prices[i - 1].max_sale = price.min_sale - 1\n            if (i === pricesLen - 1) {\n              price.max_sale = DEFAULT_MAX_NUM\n            }\n          }\n          return price\n        })\n        return item\n      })\n      return priceGradient\n    }\n  },\n  components: {\n    SelectCoachLevel\n  }\n}\n",{"version":3,"sources":["set-price.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqJA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"set-price.vue","sourceRoot":"src/views/fragments/course","sourcesContent":["<template>\n  <div class=\"set-price\">\n    <div class=\"ta-c\">\n      <st-button\n        v-if=\"priceModel === 2\"\n        type=\"dashed\"\n        icon=\"add\"\n        block\n        class=\"mg-t8\"\n        @click=\"addRecord\"\n      >\n        新增{{ $c('coach') }}等级定价\n      </st-button>\n    </div>\n    <st-container\n      v-for=\"(priceGradientRecord, key) in priceGradient\"\n      :key=\"key\"\n      class=\"mg-t24 set-price__price-container\"\n    >\n      <a\n        v-if=\"priceGradient.length > 1\"\n        href=\"javascript: void(0);\"\n        class=\"set-price__del\"\n        @click=\"delRecord(key)\"\n      >\n        <st-icon type=\"delete\" color=\"#3F66F6\"></st-icon>\n        <span class=\"mg-l4 color-text-light\">删除</span>\n      </a>\n      <st-form labelWidth=\"70px\" class=\"mg-t8\">\n        <!-- 选择教练等级 如果定价方式为教练分级定价时，显示选择教练-->\n        <st-form-item\n          :label=\"`${$c('coach')}等级`\"\n          required\n          v-if=\"priceModel === 2\"\n        >\n          <select-coach-level\n            :value=\"priceGradientRecord.level_id\"\n            @change=\"val => onLevelChange(val, key)\"\n          ></select-coach-level>\n        </st-form-item>\n        <!-- 私教课程定价模式：教练平级定价；私教课程售卖模式：统一标价 -->\n        <st-form-item label=\"售卖定价\" required class=\"mg-b8\"></st-form-item>\n        <st-form-item class=\"set-price__record\">\n          <st-container>\n            <st-form-table>\n              <thead>\n                <tr>\n                  <th>购买节数</th>\n                  <th>售卖价格范围</th>\n                  <th>转让手续费</th>\n                  <th>操作</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr>\n                  <td colspan=\"4\">\n                    <st-button\n                      type=\"dashed\"\n                      icon=\"add\"\n                      block\n                      class=\"mg-t8\"\n                      @click=\"addPriceRecord(key)\"\n                    >\n                      新增梯度\n                    </st-button>\n                  </td>\n                </tr>\n                <tr\n                  v-for=\"(item, index) in priceGradientRecord.prices\"\n                  :key=\"index\"\n                >\n                  <td>\n                    <div>\n                      <a-input-number\n                        :min=\"1\"\n                        v-model=\"priceGradientRecord.prices[index].min_sale\"\n                      />\n                      <span class=\"mg-l8\">节及以上</span>\n                    </div>\n                  </td>\n                  <td>\n                    <!-- 教练谈单模式 价格为区间 -->\n                    <div v-if=\"saleModel === 1\">\n                      <st-input-number\n                        class=\"page-set-sell-price__input\"\n                        v-model=\"\n                          priceGradientRecord.prices[index].min_sell_price\n                        \"\n                        :float=\"true\"\n                      />\n                      <span class=\"page-set-sell-price__label\">元/节</span>\n                      ~\n                      <st-input-number\n                        class=\"page-set-sell-price__input\"\n                        v-model=\"\n                          priceGradientRecord.prices[index].max_sell_price\n                        \"\n                        :float=\"true\"\n                      />\n                      <span class=\"page-set-sell-price__label\">元/节</span>\n                    </div>\n                    <!-- 统一标价模式 价格为固定值 -->\n                    <div v-if=\"saleModel === 2\">\n                      <st-input-number\n                        class=\"page-set-sell-price__input\"\n                        v-model=\"priceGradientRecord.prices[index].sell_price\"\n                        :float=\"true\"\n                      />\n                      <span class=\"page-set-sell-price__label\">元/节</span>\n                    </div>\n                  </td>\n                  <td>\n                    <st-input-number\n                      style=\"width: 110px\"\n                      v-model=\"priceGradientRecord.prices[index].transfer_num\"\n                      :max=\"\n                        priceGradientRecord.prices[index].transfer_unit === 1\n                          ? 100\n                          : 9999999.9\n                      \"\n                      :float=\"true\"\n                    >\n                      <template slot=\"addonAfter\">\n                        <a-select\n                          :defaultValue=\"1\"\n                          class=\"st-form-item-unit\"\n                          v-model=\"\n                            priceGradientRecord.prices[index].transfer_unit\n                          \"\n                          :options=\"personalCourseTransferUnitOptions\"\n                        ></a-select>\n                      </template>\n                    </st-input-number>\n                  </td>\n                  <td>\n                    <st-table-actions>\n                      <a @click=\"del(key, index)\" class=\"mg-l8\">删除</a>\n                    </st-table-actions>\n                  </td>\n                </tr>\n              </tbody>\n            </st-form-table>\n          </st-container>\n        </st-form-item>\n      </st-form>\n    </st-container>\n  </div>\n</template>\n<script>\nimport { remove } from 'lodash-es'\nimport SelectCoachLevel from '@/views/fragments/coach/select-coach-level'\nimport { UserService } from '@/services/user.service'\n\nexport default {\n  name: 'SetPrice',\n  serviceInject() {\n    return {\n      userService: UserService\n    }\n  },\n  rxState() {\n    return {\n      personalCourseTransferUnitOptions: this.userService.getOptions$(\n        'personal_course.transfer_unit'\n      ),\n      brand: this.userService.brand$\n    }\n  },\n  computed: {\n    /**\n     *私教课程定价模式 1、教练谈单 2、统一标价\n     */\n    saleModel() {\n      return this.brand.saleModel\n    },\n    /**\n     *定价模式 1、教练统一定价 2、教练分级定价\n     */\n    priceModel() {\n      return this.brand.priceModel\n    }\n  },\n  watch: {\n    priceGradient: {\n      handler(val) {\n        this.$emit('change', this.priceGradientFilter(val))\n      },\n      deep: true\n    },\n    value: {\n      handler(val) {\n        this.priceGradient = val\n      },\n      deep: true\n    }\n  },\n  props: {\n    value: {\n      type: Array,\n      default() {\n        return []\n      }\n    }\n  },\n  data() {\n    return {\n      priceGradient: []\n    }\n  },\n  created() {\n    // 获取定价模式\n    this.initPriceGradient()\n  },\n  methods: {\n    initPriceGradient() {\n      this.priceGradient = this.value.length\n        ? this.value\n        : [\n            {\n              level_id: 0,\n              prices: []\n            }\n          ]\n    },\n    onChange(e) {\n      this.priceSetting = e.target.value\n    },\n    del(key, rowIndex) {\n      this.priceGradient[key].prices.splice(rowIndex, 1)\n      this.priceGradient = [...this.priceGradient]\n    },\n    addRecord() {\n      const newRecord = {\n        level_id: 0,\n        single_sell: 0,\n        single_price: '',\n        prices: []\n      }\n      this.priceGradient.push(newRecord)\n    },\n    delRecord(key) {\n      let { priceGradient } = this\n      remove(priceGradient, (item, index) => {\n        return index === key\n      })\n      this.priceGradient = [...priceGradient]\n    },\n    addPriceRecord(key) {\n      const newRecord = {\n        id: 0,\n        priceGradient: '',\n        price: '',\n        serviceFee: '',\n        transfer_unit: 1\n      }\n      if (!this.priceGradient[key].prices) {\n        this.priceGradient[key].prices = []\n      }\n      this.priceGradient = [...this.priceGradient]\n      this.priceGradient[key].prices.push(newRecord)\n    },\n    onLevelChange(val, key) {\n      this.priceGradient[key].level_id = val\n    },\n    priceGradientFilter(priceGradient) {\n      const DEFAULT_MAX_NUM = 10000\n      priceGradient.map((item, index) => {\n        const prices = item.prices || []\n        const pricesLen = prices.length\n        prices.map((price, i) => {\n          delete price.serviceFee\n          delete price.priceGradient\n          delete price.price\n          if (this.saleModel === 1) {\n            // 教练谈单模式，没有固定价格\n            price.sell_price = 0\n          }\n          if (this.saleModel === 2) {\n            // 统一标价模式下，没有价格梯度，传0\n            price.min_sell_price = 0\n            price.max_sell_price = 0\n          }\n          if (pricesLen === 1) {\n            prices[0].max_sale = DEFAULT_MAX_NUM\n          }\n          if (i > 0) {\n            prices[i - 1].max_sale = price.min_sale - 1\n            if (i === pricesLen - 1) {\n              price.max_sale = DEFAULT_MAX_NUM\n            }\n          }\n          return price\n        })\n        return item\n      })\n      return priceGradient\n    }\n  },\n  components: {\n    SelectCoachLevel\n  }\n}\n</script>\n"]}]}