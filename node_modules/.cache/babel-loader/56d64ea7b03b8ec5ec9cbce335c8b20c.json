{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/card/member/update-rights.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/card/member/update-rights.vue","mtime":1601345845229},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { UpdateRightsService } from \"./update-rights.service.ts\";\nimport { ruleOptions } from \"./update-rights.config\";\nimport { MessageService } from '@/services/message.service';\nimport AssignShop from '@/views/biz-components/shop/assign-shop/assign-shop';\nimport MemberCardCourseInterests from '@/views/biz-components/card/member-card-course-interests/member-card-course-interests';\nimport { CARD_TYPE } from '@/constants/card/member'; // import ShopHourPicker from '@/views/biz-components/shop-hour-picker/shop-hour-picker'\n// import SelectArea from '@/views/biz-components/area/select-area/select-area'\n\nimport CommonTaskSuccessTip from '@/views/biz-modals/common/task/success-tip';\nexport default {\n  components: {\n    AssignShop: AssignShop,\n    MemberCardCourseInterests: MemberCardCourseInterests // ,\n    // ShopHourPicker,\n    // SelectArea\n\n  },\n  modals: {\n    CommonTaskSuccessTip: CommonTaskSuccessTip\n  },\n  serviceInject: function serviceInject() {\n    return {\n      messageService: MessageService,\n      updateRightsService: UpdateRightsService\n    };\n  },\n  rxState: function rxState() {\n    var _this$updateRightsSer = this.updateRightsService,\n        info$ = _this$updateRightsSer.info$,\n        loading$ = _this$updateRightsSer.loading$,\n        transferUnitOptions$ = _this$updateRightsSer.transferUnitOptions$,\n        inoutTypeOptions$ = _this$updateRightsSer.inoutTypeOptions$,\n        supportMemberNumOptions$ = _this$updateRightsSer.supportMemberNumOptions$;\n    return {\n      info: info$,\n      loading: loading$,\n      transferUnitOptions: transferUnitOptions$,\n      inoutTypeOptions: inoutTypeOptions$,\n      supportMemberNumOptions: supportMemberNumOptions$\n    };\n  },\n  props: {\n    id: {\n      type: Number,\n      default: 0\n    },\n\n    /**\n     * 是否是会员卡列表的同步售出权益操作\n     */\n    isSync: {\n      type: Boolean,\n      default: false\n    },\n    isShowLink: {\n      type: Boolean,\n      default: true\n    }\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      show: false,\n      timeList: [],\n      INOUT_TYPE_CUSTOM: 2,\n      CARD_TYPE: CARD_TYPE,\n      TYPE_MULII_CARD: 2,\n      switches: {\n        entranceNum: 0,\n        givingTime: 0,\n        frozenTime: 0,\n        transferSetting: 0,\n        courseInterests: 0,\n        entranceShop: 0 // ,\n        // area: 0,\n        // entranceTime: 0\n\n      }\n    };\n  },\n  computed: {\n    title: function title() {\n      return '修改售出权益' + (this.isSync ? '-选中权益点信息会同步到已售合同' : '');\n    },\n    givingUnit: function givingUnit() {\n      return this.info.card_type === CARD_TYPE.NUMBER ? '次' : '天';\n    }\n  },\n  created: function created() {\n    var _this = this;\n\n    this.updateRightsService.getInfo(this.id, this.isSync).subscribe(function (res) {\n      _this.$nextTick(function () {\n        _this.setFieldsValue(res.info);\n      });\n    });\n  },\n  methods: {\n    onShopChange: function onShopChange(type, shopIds) {\n      this.info.admission_range.admission_range_type = type;\n      this.info.admission_range.select_shops = shopIds;\n    },\n    onCourseInterestsChange: function onCourseInterestsChange(type, courseIds) {\n      this.info.course_interests.course_interests_type = type;\n      this.info.course_interests.select_courses = courseIds;\n    },\n    setFieldsValue: function setFieldsValue(info) {\n      var gift_remain = info.gift_remain,\n          frozen_time_remain = info.frozen_time_remain;\n      var _info$transfer = info.transfer,\n          transfer_num = _info$transfer.transfer_num,\n          transfer_unit = _info$transfer.transfer_unit;\n      this.form.setFieldsValue({\n        gift_remain: gift_remain,\n        frozen_time_remain: frozen_time_remain,\n        transfer_num: transfer_num,\n        transfer_unit: transfer_unit || 1\n      });\n    },\n    onSwitchChange: function onSwitchChange() {\n      this.form.validateFields(['gift_remain', 'frozen_time_remain', 'transfer_num', 'transfer_unit'], {\n        force: true\n      });\n    },\n    checkIsChanged: function checkIsChanged() {\n      var isChanged = false;\n      var switches = this.switches;\n\n      for (var i in switches) {\n        if (switches[i]) {\n          isChanged = true;\n          return true;\n        }\n      }\n\n      return isChanged;\n    },\n    inputCheck: function inputCheck() {\n      var switches = this.switches;\n      var _this$info = this.info,\n          admission_range = _this$info.admission_range,\n          course_interests = _this$info.course_interests;\n\n      if (switches.courseInterests && course_interests.course_interests_type === -1) {\n        this.messageService.error({\n          content: '请选择约课权益'\n        });\n        return false;\n      }\n\n      if (switches.entranceShop && admission_range.admission_range_type === -1) {\n        this.messageService.error({\n          content: '请选择支持入场门店'\n        });\n        return false;\n      }\n\n      return true;\n    },\n    onSubmit: function onSubmit() {\n      var _this2 = this;\n\n      if (!this.checkIsChanged()) {\n        return this.messageService.error({\n          content: '未进行任何修改，无法确认'\n        });\n      }\n\n      this.form.validate().then(function (values) {\n        if (!_this2.inputCheck()) {\n          return;\n        }\n\n        _this2.doSubmit(values);\n      });\n    },\n    doSubmit: function doSubmit(values) {\n      var _this3 = this;\n\n      var _this$info2 = this.info,\n          transfer = _this$info2.transfer,\n          admission_range = _this$info2.admission_range,\n          support_member_num = _this$info2.support_member_num,\n          course_interests = _this$info2.course_interests,\n          description = _this$info2.description;\n      var gift_remain = values.gift_remain,\n          frozen_time_remain = values.frozen_time_remain;\n      var switches = this.switches;\n      var params = {\n        is_change_support_member_num: switches.entranceNum,\n        support_member_num: support_member_num,\n        is_change_gift_remain: switches.givingTime,\n        gift_remain: gift_remain,\n        is_change_frozen_time_remain: switches.frozenTime,\n        frozen_time_remain: frozen_time_remain,\n        is_change_transferable: switches.transferSetting,\n        is_transferable: transfer.is_transferable,\n        transfer_num: values.transfer_num,\n        transfer_unit: values.transfer_unit,\n        is_change_course_interests: switches.courseInterests,\n        course_interests: course_interests.course_interests_type,\n        select_courses: course_interests.select_courses,\n        is_change_admission_range: switches.entranceShop,\n        admission_range: admission_range.admission_range_type,\n        select_shops: admission_range.select_shops,\n        description: description\n      };\n      this.updateRightsService.updateRights(this.id, params, this.isSync).subscribe(function () {\n        if (_this3.isSync) {\n          _this3.onSyncSubmitSuccess();\n        } else {\n          _this3.onSubmitSuccess();\n        }\n      });\n    },\n    onSubmitSuccess: function onSubmitSuccess() {\n      this.messageService.success({\n        content: '提交成功'\n      });\n      this.show = false;\n      this.$emit('success');\n    },\n\n    /**\n     * 会员卡售出权益同步成功回调\n     */\n    onSyncSubmitSuccess: function onSyncSubmitSuccess() {\n      this.show = false;\n      this.successTip();\n    },\n    successTip: function successTip() {\n      var _this4 = this;\n\n      this.$modalRouter.push({\n        name: 'common-task-success-tip',\n        props: {\n          isShowLink: this.isShowLink\n        },\n        on: {\n          success: function success() {\n            _this4.$emit('success');\n          }\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["update-rights.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal :title=\"title\" v-model=\"show\">\n    <st-form :form=\"form\">\n      <st-form-item\n        v-show=\"info.card_number_type === TYPE_MULII_CARD\"\n        labelWidth=\"120px\"\n      >\n        <template slot=\"label\">\n          <st-checkbox v-model=\"switches.entranceNum\">支持入场人数</st-checkbox>\n        </template>\n        <a-select\n          :options=\"supportMemberNumOptions\"\n          v-model=\"info.support_member_num\"\n          :disabled=\"!switches.entranceNum\"\n          style=\"width: 120px\"\n        ></a-select>\n      </st-form-item>\n      <st-form-item labelWidth=\"130px\">\n        <template slot=\"label\">\n          <st-checkbox v-model=\"switches.givingTime\" @change=\"onSwitchChange\">\n            剩余可赠送额度\n          </st-checkbox>\n        </template>\n        <st-input-number\n          v-decorator=\"decorators.gift_remain\"\n          :disabled=\"!switches.givingTime\"\n          :max=\"9999\"\n          style=\"width: 120px\"\n        >\n          <template slot=\"addonAfter\">{{ givingUnit }}</template>\n        </st-input-number>\n        <span class=\"st-des mg-l8\" v-if=\"!isSync\">\n          已赠送额度{{ info.gift_amount }}{{ givingUnit }}\n        </span>\n      </st-form-item>\n      <st-form-item labelWidth=\"130px\">\n        <template slot=\"label\">\n          <st-checkbox v-model=\"switches.frozenTime\" @change=\"onSwitchChange\">\n            剩余可冻结时长\n          </st-checkbox>\n        </template>\n        <st-input-number\n          v-decorator=\"decorators.frozen_time_remain\"\n          :disabled=\"!switches.frozenTime\"\n          :max=\"9999\"\n          style=\"width: 120px\"\n        >\n          <template slot=\"addonAfter\">天</template>\n        </st-input-number>\n        <span class=\"st-des mg-l8\" v-if=\"!isSync\">\n          {{ info.frozen_time_remain_text }}\n        </span>\n      </st-form-item>\n      <st-form-item v-if=\"info.transfer\" labelWidth=\"88px\">\n        <template slot=\"label\">\n          <st-checkbox\n            v-model=\"switches.transferSetting\"\n            @change=\"onSwitchChange\"\n          >\n            转让设置\n          </st-checkbox>\n        </template>\n        <st-checkbox\n          :disabled=\"!switches.transferSetting\"\n          v-model=\"info.transfer.is_transferable\"\n        >\n          支持转让\n        </st-checkbox>\n        <st-input-number\n          v-show=\"info.transfer.is_transferable\"\n          v-decorator=\"decorators.transfer_num\"\n          style=\"width: 140px\"\n          :min=\"0\"\n          :max=\"form.getFieldValue('transfer_unit') === 1 ? 100 : 9999999.9\"\n          :disabled=\"!switches.transferSetting\"\n        >\n          <span slot=\"addonAfter\">\n            <a-select\n              v-decorator=\"decorators.transfer_unit\"\n              :options=\"transferUnitOptions\"\n              :disabled=\"!switches.transferSetting\"\n            ></a-select>\n          </span>\n        </st-input-number>\n      </st-form-item>\n      <member-card-course-interests\n        v-if=\"info.course_interests\"\n        :form=\"form\"\n        :required=\"false\"\n        :disabled=\"!switches.courseInterests\"\n        :type=\"info.course_interests.course_interests_type\"\n        :courseIds=\"info.course_interests.select_courses\"\n        @change=\"onCourseInterestsChange\"\n      >\n        <template slot=\"label\">\n          <st-checkbox v-model=\"switches.courseInterests\">约课权益</st-checkbox>\n        </template>\n      </member-card-course-interests>\n      <assign-shop\n        v-if=\"info.admission_range\"\n        :form=\"form\"\n        labelWidth=\"120px\"\n        :disabled=\"!switches.entranceShop\"\n        :required=\"false\"\n        :type=\"info.admission_range.admission_range_type\"\n        :shopIds=\"info.admission_range.select_shops\"\n        @change=\"onShopChange\"\n      >\n        <template slot=\"label\">\n          <st-checkbox v-model=\"switches.entranceShop\">\n            支持入场门店\n          </st-checkbox>\n        </template>\n      </assign-shop>\n      <!-- <st-form-item labelWidth=\"120px\">\n        <template slot=\"label\">\n          <st-checkbox v-model=\"switches.area\">VIP场地通行</st-checkbox>\n        </template>\n        <select-area type=\"tree\" :disabled=\"!switches.area\" />\n      </st-form-item>-->\n      <!-- <st-form-item>\n        <template slot=\"label\">\n          <st-checkbox v-model=\"switches.entranceTime\">入场时段</st-checkbox>\n        </template>\n        <a-radio-group\n          :options=\"inoutTypeOptions\"\n          :disabled=\"!switches.entranceTime\"\n          v-model=\"info.inout_type\"\n        ></a-radio-group>\n      </st-form-item>\n      <shop-hour-picker\n        v-if=\"info.inout_type === 'INOUT_TYPE_CUSTOM'\"\n        class=\"mg-b24\"\n        v-model=\"timeList\"\n        :isInfo=\"!switches.entranceTime\"\n      ></shop-hour-picker>-->\n      <st-form-item label=\"备注\" labelWidth=\"28px\">\n        <st-textarea\n          v-model=\"info.description\"\n          :autosize=\"{ minRows: 1, maxRows: 6 }\"\n          placeholder=\"请输入备注\"\n          maxlength=\"200\"\n        />\n      </st-form-item>\n    </st-form>\n    <template slot=\"footer\">\n      <a-popconfirm v-if=\"isSync\" @confirm=\"onSubmit\" placement=\"topRight\">\n        <template slot=\"title\">\n          <p>\n            请再次确认是否同步，同步后会覆盖\n            <br />\n            售出售出会员卡，将会有2-5s无法正常使用\n          </p>\n        </template>\n        <st-button type=\"primary\" :loading=\"loading.updateRights\">\n          确认提交\n        </st-button>\n      </a-popconfirm>\n      <st-button\n        v-else\n        type=\"primary\"\n        @click=\"onSubmit\"\n        :loading=\"loading.updateRights\"\n      >\n        确认提交\n      </st-button>\n    </template>\n  </st-modal>\n</template>\n\n<script>\nimport { UpdateRightsService } from './update-rights.service.ts'\nimport { ruleOptions } from './update-rights.config'\nimport { MessageService } from '@/services/message.service'\nimport AssignShop from '@/views/biz-components/shop/assign-shop/assign-shop'\nimport MemberCardCourseInterests from '@/views/biz-components/card/member-card-course-interests/member-card-course-interests'\nimport { CARD_TYPE } from '@/constants/card/member'\n// import ShopHourPicker from '@/views/biz-components/shop-hour-picker/shop-hour-picker'\n// import SelectArea from '@/views/biz-components/area/select-area/select-area'\nimport CommonTaskSuccessTip from '@/views/biz-modals/common/task/success-tip'\nexport default {\n  components: {\n    AssignShop,\n    MemberCardCourseInterests\n    // ,\n    // ShopHourPicker,\n    // SelectArea\n  },\n  modals: {\n    CommonTaskSuccessTip\n  },\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      updateRightsService: UpdateRightsService\n    }\n  },\n  rxState() {\n    const {\n      info$,\n      loading$,\n      transferUnitOptions$,\n      inoutTypeOptions$,\n      supportMemberNumOptions$\n    } = this.updateRightsService\n    return {\n      info: info$,\n      loading: loading$,\n      transferUnitOptions: transferUnitOptions$,\n      inoutTypeOptions: inoutTypeOptions$,\n      supportMemberNumOptions: supportMemberNumOptions$\n    }\n  },\n  props: {\n    id: {\n      type: Number,\n      default: 0\n    },\n    /**\n     * 是否是会员卡列表的同步售出权益操作\n     */\n    isSync: {\n      type: Boolean,\n      default: false\n    },\n    isShowLink: {\n      type: Boolean,\n      default: true\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      show: false,\n      timeList: [],\n      INOUT_TYPE_CUSTOM: 2,\n      CARD_TYPE,\n      TYPE_MULII_CARD: 2,\n      switches: {\n        entranceNum: 0,\n        givingTime: 0,\n        frozenTime: 0,\n        transferSetting: 0,\n        courseInterests: 0,\n        entranceShop: 0\n        // ,\n        // area: 0,\n        // entranceTime: 0\n      }\n    }\n  },\n  computed: {\n    title() {\n      return (\n        '修改售出权益' + (this.isSync ? '-选中权益点信息会同步到已售合同' : '')\n      )\n    },\n    givingUnit() {\n      return this.info.card_type === CARD_TYPE.NUMBER ? '次' : '天'\n    }\n  },\n  created() {\n    this.updateRightsService.getInfo(this.id, this.isSync).subscribe(res => {\n      this.$nextTick(() => {\n        this.setFieldsValue(res.info)\n      })\n    })\n  },\n  methods: {\n    onShopChange(type, shopIds) {\n      this.info.admission_range.admission_range_type = type\n      this.info.admission_range.select_shops = shopIds\n    },\n    onCourseInterestsChange(type, courseIds) {\n      this.info.course_interests.course_interests_type = type\n      this.info.course_interests.select_courses = courseIds\n    },\n    setFieldsValue(info) {\n      const { gift_remain, frozen_time_remain } = info\n      const { transfer_num, transfer_unit } = info.transfer\n      this.form.setFieldsValue({\n        gift_remain,\n        frozen_time_remain,\n        transfer_num,\n        transfer_unit: transfer_unit || 1\n      })\n    },\n    onSwitchChange() {\n      this.form.validateFields(\n        ['gift_remain', 'frozen_time_remain', 'transfer_num', 'transfer_unit'],\n        { force: true }\n      )\n    },\n    checkIsChanged() {\n      let isChanged = false\n      const { switches } = this\n      for (let i in switches) {\n        if (switches[i]) {\n          isChanged = true\n          return true\n        }\n      }\n      return isChanged\n    },\n    inputCheck() {\n      const { switches } = this\n      const { admission_range, course_interests } = this.info\n      if (\n        switches.courseInterests &&\n        course_interests.course_interests_type === -1\n      ) {\n        this.messageService.error({\n          content: '请选择约课权益'\n        })\n        return false\n      }\n      if (\n        switches.entranceShop &&\n        admission_range.admission_range_type === -1\n      ) {\n        this.messageService.error({\n          content: '请选择支持入场门店'\n        })\n        return false\n      }\n      return true\n    },\n    onSubmit() {\n      if (!this.checkIsChanged()) {\n        return this.messageService.error({\n          content: '未进行任何修改，无法确认'\n        })\n      }\n      this.form.validate().then(values => {\n        if (!this.inputCheck()) {\n          return\n        }\n        this.doSubmit(values)\n      })\n    },\n    doSubmit(values) {\n      const {\n        transfer,\n        admission_range,\n        support_member_num,\n        course_interests,\n        description\n      } = this.info\n      const { gift_remain, frozen_time_remain } = values\n      const { switches } = this\n      const params = {\n        is_change_support_member_num: switches.entranceNum,\n        support_member_num,\n        is_change_gift_remain: switches.givingTime,\n        gift_remain,\n        is_change_frozen_time_remain: switches.frozenTime,\n        frozen_time_remain,\n        is_change_transferable: switches.transferSetting,\n        is_transferable: transfer.is_transferable,\n        transfer_num: values.transfer_num,\n        transfer_unit: values.transfer_unit,\n        is_change_course_interests: switches.courseInterests,\n        course_interests: course_interests.course_interests_type,\n        select_courses: course_interests.select_courses,\n        is_change_admission_range: switches.entranceShop,\n        admission_range: admission_range.admission_range_type,\n        select_shops: admission_range.select_shops,\n        description\n      }\n      this.updateRightsService\n        .updateRights(this.id, params, this.isSync)\n        .subscribe(() => {\n          if (this.isSync) {\n            this.onSyncSubmitSuccess()\n          } else {\n            this.onSubmitSuccess()\n          }\n        })\n    },\n    onSubmitSuccess() {\n      this.messageService.success({\n        content: '提交成功'\n      })\n      this.show = false\n      this.$emit('success')\n    },\n    /**\n     * 会员卡售出权益同步成功回调\n     */\n    onSyncSubmitSuccess() {\n      this.show = false\n      this.successTip()\n    },\n    successTip() {\n      this.$modalRouter.push({\n        name: 'common-task-success-tip',\n        props: {\n          isShowLink: this.isShowLink\n        },\n        on: {\n          success: () => {\n            this.$emit('success')\n          }\n        }\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/sold/card/member"}]}