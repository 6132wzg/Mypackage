{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/department.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/department.vue","mtime":1600926556245},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport FilterStaff from \"./department#/filter-staff.vue\";\nimport OpreationButton from \"./department#/opreation-button.vue\";\nimport StaffTable from \"./department#/staff-table\";\nimport { DepartmentService } from \"./department.service\";\nimport { UserService } from '@/services/user.service';\nimport StOrganTree from \"./department#/tree/tree.vue\";\nimport { ShopStaffApi } from '@/api/v1/staff/staff';\nimport { cloneDeep } from 'lodash-es';\nimport StaffBatchImport from '@/views/biz-modals/staff/batch-import';\nexport default {\n  name: 'Staff',\n  modals: {\n    StaffBatchImport: StaffBatchImport\n  },\n  serviceInject: function serviceInject() {\n    return {\n      departmentService: DepartmentService,\n      userService: UserService,\n      shopStaffApi: ShopStaffApi\n    };\n  },\n  rxState: function rxState() {\n    return {\n      departmentList: this.departmentService.departmentList$,\n      departmentSearchList: this.departmentService.departmentSearchList$,\n      staffList: this.departmentService.staffList$,\n      roleOptions: this.departmentService.roleOptions$,\n      loading: this.departmentService.loading$,\n      page: this.departmentService.page$,\n      auth: this.departmentService.auth$,\n      brand: this.userService.brand$\n    };\n  },\n  components: {\n    FilterStaff: FilterStaff,\n    OpreationButton: OpreationButton,\n    StaffTable: StaffTable,\n    StOrganTree: StOrganTree\n  },\n  computed: {\n    shopList: function shopList() {\n      return [{\n        id: -1,\n        name: '  全部'\n      }].concat(_toConsumableArray(this.shopOptions));\n    },\n    treeData: function treeData() {\n      var num = 0;\n      var len = this.treeList.length; // eslint-disable-next-line\n\n      if (!len) this.treeList = this.departmentList;\n      console.log('treeData', this.treeList);\n      this.treeList.forEach(function (department) {\n        num += department.count;\n      });\n      return {\n        name: this.brand.name,\n        id: 0,\n        count: this.departmentCount,\n        children: this.treeList\n      };\n    },\n    departmentCount: function departmentCount() {\n      var num = 0;\n      this.departmentList.forEach(function (department) {\n        num += department.count;\n      });\n      return num;\n    }\n  },\n  data: function data() {\n    return {\n      ids: [],\n      treeList: []\n    };\n  },\n  methods: {\n    updateData: function updateData() {\n      var _this = this;\n\n      this.departmentService.getDepartmentList().subscribe(function (res) {\n        _this.treeList = res.department;\n      });\n    },\n    getDepartment: function getDepartment() {\n      var item = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      this.$searchQuery.shop_id = -1;\n      this.$searchQuery.work_status = -1;\n      this.$searchQuery.department_id = item;\n      this.$searchQuery.keyword = '';\n      this.$router.push({\n        query: this.$searchQuery\n      });\n    },\n    selectedRow: function selectedRow(ids) {\n      this.ids = ids;\n    },\n    // 查询\n    handleDepartmentSearch: function handleDepartmentSearch(e) {\n      console.log('搜索条件', e);\n      this.departmentService.searchDepartment(e); // this.$router.push({ name: 'brand-staff-department', query: { department_id: e } })\n    },\n    // 查询部门后点击列表某项\n    handleDepartmentSearchChange: function handleDepartmentSearchChange(e) {\n      console.log(e);\n      if (!e) this.treeList = this.departmentList;else this.treeList = this.deepSearchDepartment(this.departmentList, e);\n    },\n    // 查询部门后点击列表某项查找到对应列表\n    deepSearchDepartment: function deepSearchDepartment(departments, id) {\n      var result = [];\n      if (!departments || !Array.isArray(departments)) return result;\n\n      for (var x = 0; x < departments.length; x++) {\n        var department = departments[x];\n\n        if (result && result.length) {\n          break;\n        }\n\n        if (department.id === id) {\n          result = [department];\n        } else if (department.children && department.children.length) {\n          result = this.deepSearchDepartment(department.children, id);\n        }\n      }\n\n      return result;\n    },\n    // 编辑\n    onEditStaff: function onEditStaff(staffId) {\n      this.$router.push({\n        name: 'brand-staff-edit',\n        query: {\n          id: staffId\n        }\n      });\n    },\n    // 新增员工\n    onAddStaff: function onAddStaff() {\n      this.$router.push('/brand/staff/add');\n    },\n    // 批量导入\n    onbatchImport: function onbatchImport() {\n      var _this2 = this;\n\n      this.$modalRouter.push({\n        name: 'staff-batch-import',\n        props: {\n          ids: this.ids\n        },\n        on: {\n          ok: function ok(res) {\n            _this2.updateData();\n\n            _this2.$refs.staffTable.selectedRowKeys = [];\n\n            _this2.$router.reload();\n          }\n        }\n      });\n      console.log('批量导入');\n    },\n    // 导入员工\n    onImportStaff: function onImportStaff() {\n      console.log('导入员工');\n    }\n  }\n};",{"version":3,"sources":["department.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"page-staff\">\n    <section class=\"page-staff-lf\">\n      <header class=\"staff-lf__search\">\n        <a-select\n          allowClear\n          placeholder=\"请选择部门\"\n          style=\"width:226px\"\n          @search=\"handleDepartmentSearch\"\n          @change=\"handleDepartmentSearchChange\"\n        >\n          <a-select-option v-for=\"v in departmentSearchList\" :key=\"v.id\">\n            {{ v.name }}\n          </a-select-option>\n        </a-select>\n      </header>\n      <main class=\"staff-lf__tree\">\n        <st-organ-tree\n          ref=\"tree\"\n          :treeData=\"treeData\"\n          @updateData=\"updateData\"\n          @node-click=\"getDepartment\"\n        ></st-organ-tree>\n      </main>\n    </section>\n    <section class=\"page-staff-rg\">\n      <header class=\"staff-rg__operation\">\n        <a-row type=\"flex\" justify=\"space-between\">\n          <a-col :span=\"10\">\n            <opreation-button\n              :auth=\"auth\"\n              :rowKeys=\"ids\"\n              @add-staff=\"onAddStaff\"\n              @batch-import=\"onbatchImport\"\n              @import-staff=\"onImportStaff\"\n            ></opreation-button>\n          </a-col>\n          <a-col :span=\"14\">\n            <filter-staff :roleOptions=\"roleOptions\"></filter-staff>\n          </a-col>\n        </a-row>\n      </header>\n      <main class=\"staff-rg__table\">\n        <div style=\"width:100%\">\n          <staff-table\n            ref=\"staffTable\"\n            :page=\"page\"\n            :loading=\"loading.getStaffList\"\n            @edit-staff=\"onEditStaff\"\n            @selectedRow=\"selectedRow\"\n            :staffList=\"staffList\"\n          ></staff-table>\n        </div>\n      </main>\n    </section>\n  </div>\n</template>\n\n<script>\nimport FilterStaff from './department#/filter-staff.vue'\nimport OpreationButton from './department#/opreation-button.vue'\nimport StaffTable from './department#/staff-table'\nimport { DepartmentService } from './department.service'\nimport { UserService } from '@/services/user.service'\nimport StOrganTree from './department#/tree/tree.vue'\nimport { ShopStaffApi } from '@/api/v1/staff/staff'\nimport { cloneDeep } from 'lodash-es'\nimport StaffBatchImport from '@/views/biz-modals/staff/batch-import'\nexport default {\n  name: 'Staff',\n  modals: {\n    StaffBatchImport\n  },\n  serviceInject() {\n    return {\n      departmentService: DepartmentService,\n      userService: UserService,\n      shopStaffApi: ShopStaffApi\n    }\n  },\n  rxState() {\n    return {\n      departmentList: this.departmentService.departmentList$,\n      departmentSearchList: this.departmentService.departmentSearchList$,\n      staffList: this.departmentService.staffList$,\n      roleOptions: this.departmentService.roleOptions$,\n      loading: this.departmentService.loading$,\n      page: this.departmentService.page$,\n      auth: this.departmentService.auth$,\n      brand: this.userService.brand$\n    }\n  },\n  components: {\n    FilterStaff,\n    OpreationButton,\n    StaffTable,\n    StOrganTree\n  },\n  computed: {\n    shopList() {\n      return [{ id: -1, name: '  全部' }, ...this.shopOptions]\n    },\n    treeData() {\n      let num = 0\n      let len = this.treeList.length\n      // eslint-disable-next-line\n      if (!len) this.treeList = this.departmentList\n      console.log('treeData', this.treeList)\n      this.treeList.forEach(department => {\n        num += department.count\n      })\n      return {\n        name: this.brand.name,\n        id: 0,\n        count: this.departmentCount,\n        children: this.treeList\n      }\n    },\n    departmentCount() {\n      let num = 0\n      this.departmentList.forEach(department => {\n        num += department.count\n      })\n      return num\n    }\n  },\n  data() {\n    return {\n      ids: [],\n      treeList: []\n    }\n  },\n  methods: {\n    updateData() {\n      this.departmentService.getDepartmentList().subscribe(res => {\n        this.treeList = res.department\n      })\n    },\n    getDepartment(item = 0) {\n      this.$searchQuery.shop_id = -1\n      this.$searchQuery.work_status = -1\n      this.$searchQuery.department_id = item\n      this.$searchQuery.keyword = ''\n      this.$router.push({ query: this.$searchQuery })\n    },\n    selectedRow(ids) {\n      this.ids = ids\n    },\n    // 查询\n    handleDepartmentSearch(e) {\n      console.log('搜索条件', e)\n      this.departmentService.searchDepartment(e)\n      // this.$router.push({ name: 'brand-staff-department', query: { department_id: e } })\n    },\n    // 查询部门后点击列表某项\n    handleDepartmentSearchChange(e) {\n      console.log(e)\n      if (!e) this.treeList = this.departmentList\n      else this.treeList = this.deepSearchDepartment(this.departmentList, e)\n    },\n    // 查询部门后点击列表某项查找到对应列表\n    deepSearchDepartment(departments, id) {\n      let result = []\n      if (!departments || !Array.isArray(departments)) return result\n      for (let x = 0; x < departments.length; x++) {\n        let department = departments[x]\n        if (result && result.length) {\n          break\n        }\n        if (department.id === id) {\n          result = [department]\n        } else if (department.children && department.children.length) {\n          result = this.deepSearchDepartment(department.children, id)\n        }\n      }\n      return result\n    },\n    // 编辑\n    onEditStaff(staffId) {\n      this.$router.push({ name: 'brand-staff-edit', query: { id: staffId } })\n    },\n    // 新增员工\n    onAddStaff() {\n      this.$router.push('/brand/staff/add')\n    },\n    // 批量导入\n    onbatchImport() {\n      this.$modalRouter.push({\n        name: 'staff-batch-import',\n        props: {\n          ids: this.ids\n        },\n        on: {\n          ok: res => {\n            this.updateData()\n            this.$refs.staffTable.selectedRowKeys = []\n            this.$router.reload()\n          }\n        }\n      })\n\n      console.log('批量导入')\n    },\n    // 导入员工\n    onImportStaff() {\n      console.log('导入员工')\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/brand/staff"}]}