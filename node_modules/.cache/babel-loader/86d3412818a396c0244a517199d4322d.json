{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/app/plugin/seckill/components#/seckill-form.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/app/plugin/seckill/components#/seckill-form.vue","mtime":1600926556103},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport ProductSetting from \"../../components#/product-setting.vue\";\nimport FormMixin from \"../../components#/form.mixin\";\nimport { merge } from 'lodash';\nimport moment from 'moment';\nimport { ruleOptions } from \"./seckill-form.config\";\nexport default {\n  name: 'BrandAppPluginSeckillAdd',\n  mixins: [FormMixin],\n  bem: {\n    b: 'brand-app-plugin-seckill-add'\n  },\n  components: {\n    ProductSetting: ProductSetting\n  },\n  props: {\n    form: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    }\n  },\n  data: function data() {\n    return {};\n  },\n  // 数据源与表单数据之间格式转换\n  computed: {\n    decorators: function decorators() {\n      return this.form.decorators(ruleOptions);\n    },\n    startTime: {\n      get: function get() {\n        return this.formValue.start_time ? moment(this.formValue.start_time) : undefined;\n      },\n      set: function set(value) {\n        this.formValue.start_time = value.format('YYYY-MM-DD HH:mm:ss');\n      }\n    },\n    endTime: {\n      get: function get() {\n        return this.formValue.end_time ? moment(this.formValue.end_time) : undefined;\n      },\n      set: function set(value) {\n        this.formValue.end_time = value.format('YYYY-MM-DD HH:mm:ss');\n      }\n    },\n    spike_time: {\n      get: function get() {\n        return this.formValue.virtual_spike_time ? moment(this.formValue.virtual_spike_time) : null;\n      },\n      set: function set(value) {\n        this.formValue.virtual_spike_time = value.format('YYYY-MM-DD HH:mm:ss');\n      }\n    },\n    isLimitStock: {\n      get: function get() {\n        return this.formValue.is_limit_stock ? true : false;\n      },\n      set: function set(value) {\n        var _this = this;\n\n        this.formValue.is_limit_stock = value ? 1 : 0;\n        this.$nextTick(function () {\n          if (!value) {\n            _this.form.validateFields(['stock_num'], {\n              force: true\n            });\n\n            _this.form.setFieldsValue({\n              stock_num: 0\n            });\n          }\n        });\n      }\n    },\n    isLimitBuy: {\n      get: function get() {\n        return this.formValue.is_limit_buy ? true : false;\n      },\n      set: function set(value) {\n        var _this2 = this;\n\n        this.formValue.is_limit_buy = value ? 1 : 0;\n        this.$nextTick(function () {\n          if (!value) {\n            _this2.form.validateFields(['buy_num'], {\n              force: true\n            });\n\n            _this2.form.setFieldsValue({\n              buy_num: 0\n            });\n          }\n        });\n      }\n    },\n    isVirtualSpike: {\n      get: function get() {\n        return this.formValue.is_virtual_spike ? true : false;\n      },\n      set: function set(value) {\n        this.formValue.is_virtual_spike = value ? 1 : 0;\n        value || this.form.validateFields(['spike_time'], {\n          force: true\n        });\n      }\n    },\n    dateRange: {\n      get: function get() {\n        var start = this.formValue.start_time ? moment(this.formValue.start_time) : undefined;\n        var end = this.formValue.end_time ? moment(this.formValue.end_time) : undefined;\n        return [start, end];\n      },\n      set: function set(value) {\n        console.log(value);\n        this.formValue.start_time = value[0] ? value[0].format('YYYY-MM-DD HH:mm:ss') : undefined;\n        this.formValue.end_time = value[1] ? value[1].format('YYYY-MM-DD HH:mm:ss') : undefined;\n      }\n    }\n  },\n  mounted: function mounted() {},\n  methods: {\n    moment: moment,\n    // 自定义的数据格式校验\n    validate: function validate() {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this3.form.validateFieldsAndScroll({\n          force: true\n        }, function (err, values) {\n          resolve(!err);\n        });\n      });\n    },\n    dateRangeCheck: function dateRangeCheck() {\n      if (!this.formValue.start_time || !this.formValue.end_time) {\n        this.messageError({\n          content: '请设置活动时间'\n        });\n        return false;\n      }\n\n      return true;\n    },\n    virDateCheck: function virDateCheck() {\n      if (moment(this.formValue.virtual_spike_time).valueOf() <= moment(this.formValue.start_time).valueOf() || moment(this.formValue.virtual_spike_time).valueOf() >= moment(this.formValue.end_time).valueOf()) {\n        this.messageError({\n          content: '秒杀时间必须在活动时间范围内'\n        });\n        return false;\n      }\n\n      return true;\n    },\n    buyCheck: function buyCheck() {\n      if (this.formValue.is_limit_buy === 1 && this.formValue.buy_num <= 0) {\n        this.messageError({\n          content: '请设置单人购买笔数'\n        });\n        return false;\n      }\n\n      return true;\n    },\n    stockCheck: function stockCheck() {\n      if (this.formValue.is_limit_stock === 1 && this.formValue.stock_num <= 0) {\n        this.messageError({\n          content: '请设置活动库存'\n        });\n        return false;\n      }\n\n      return true;\n    },\n    // 以下方法为 时间范围控制\n    range: function range(start, end) {\n      var result = [];\n\n      for (var i = start; i < end; i++) {\n        result.push(i);\n      }\n\n      return result;\n    },\n    // disabledEndDate(newEndValue) {\n    //   return newEndValue.format('YYYY-MM-DD') < moment().format('YYYY-MM-DD')\n    // },\n    disabledEndTime: function disabledEndTime() {\n      var _this4 = this;\n\n      var hour = 0;\n      var min = 0;\n      var sec = 0;\n\n      if (moment(this.formValue.start_time).format('YYYY-MM-DD') === moment(this.formValue.end_time).format('YYYY-MM-DD')) {\n        hour = moment(this.formValue.start_time).hours();\n\n        if (moment(this.formValue.start_time).format('YYYY-MM-DD HH') === moment(this.formValue.end_time).format('YYYY-MM-DD HH')) {\n          min = moment(this.formValue.start_time).minutes();\n        }\n\n        if (moment(this.formValue.start_time).format('YYYY-MM-DD HH:mm') === moment(this.formValue.end_time).format('YYYY-MM-DD HH:mm')) {\n          sec = moment(this.formValue.start_time).seconds() + 1;\n        }\n      }\n\n      return {\n        disabledHours: function disabledHours() {\n          return _this4.range(0, hour);\n        },\n        disabledMinutes: function disabledMinutes() {\n          return _this4.range(0, min);\n        },\n        disabledSeconds: function disabledSeconds() {\n          return _this4.range(0, sec);\n        }\n      };\n    },\n    disabledVirDate: function disabledVirDate(current) {\n      return current.format('YYYY-MM-DD') < moment(this.formValue.start_time).format('YYYY-MM-DD') || current.format('YYYY-MM-DD') > moment(this.formValue.end_time).format('YYYY-MM-DD');\n    },\n    disabledVirTime: function disabledVirTime() {\n      var _this5 = this;\n\n      var hour = 0;\n      var min = 0;\n      var sec = 0;\n\n      if (moment(this.formValue.start_time).format('YYYY-MM-DD') === moment(this.formValue.virtual_spike_time).format('YYYY-MM-DD')) {\n        hour = moment(this.formValue.start_time).hours();\n\n        if (moment(this.formValue.start_time).format('YYYY-MM-DD HH') === moment(this.formValue.virtual_spike_time).format('YYYY-MM-DD HH')) {\n          min = moment(this.formValue.start_time).minutes();\n        }\n\n        if (moment(this.formValue.start_time).format('YYYY-MM-DD HH:mm') === moment(this.formValue.virtual_spike_time).format('YYYY-MM-DD HH:mm')) {\n          sec = moment(this.formValue.start_time).seconds() + 1;\n        }\n\n        return {\n          disabledHours: function disabledHours() {\n            return _this5.range(0, hour);\n          },\n          disabledMinutes: function disabledMinutes() {\n            return _this5.range(0, min);\n          },\n          disabledSeconds: function disabledSeconds() {\n            return _this5.range(0, sec);\n          }\n        };\n      }\n\n      if (moment(this.formValue.end_time).format('YYYY-MM-DD') === moment(this.formValue.virtual_spike_time).format('YYYY-MM-DD')) {\n        ;\n        hour = 24, min = 60, sec = 60;\n        hour = moment(this.formValue.end_time).hours() + 1;\n\n        if (moment(this.formValue.end_time).format('YYYY-MM-DD HH') === moment(this.formValue.virtual_spike_time).format('YYYY-MM-DD HH')) {\n          min = moment(this.formValue.end_time).minutes() + 1;\n        }\n\n        if (moment(this.formValue.end_time).format('YYYY-MM-DD HH:mm') === moment(this.formValue.virtual_spike_time).format('YYYY-MM-DD HH:mm')) {\n          sec = moment(this.formValue.end_time).seconds();\n        }\n\n        return {\n          disabledHours: function disabledHours() {\n            return _this5.range(hour, 24);\n          },\n          disabledMinutes: function disabledMinutes() {\n            return _this5.range(min, 60);\n          },\n          disabledSeconds: function disabledSeconds() {\n            return _this5.range(sec, 60);\n          }\n        };\n      }\n\n      return {\n        disabledHours: function disabledHours() {\n          return [];\n        },\n        disabledMinutes: function disabledMinutes() {\n          return [];\n        },\n        disabledSeconds: function disabledSeconds() {\n          return [];\n        }\n      };\n    }\n  }\n};",{"version":3,"sources":["seckill-form.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-form class=\"mg-t8\" :form=\"form\" labelWidth=\"125px\">\n    <st-form-item required label=\"活动名称\">\n      <st-input\n        v-decorator=\"decorators.activity_name\"\n        placeholder=\"请输入活动名称\"\n        style=\"width: 470px\"\n        @change=\"formValueChange('activity_name', $event, formValue)\"\n        :maxLength=\"30\"\n      ></st-input>\n    </st-form-item>\n    <!-- 商品选择、商品优惠设置 -->\n    <product-setting\n      discountPriceLabel=\"秒杀价(元)\"\n      v-model=\"formValue\"\n      :formCheck=\"formCheck\"\n      :decorators=\"decorators\"\n      :form=\"form\"\n      :isEdit=\"isEdit\"\n      :isSubmit=\"isSubmit\"\n      @submit=\"onSubmit\"\n    ></product-setting>\n    <st-form-item required label=\"活动时间\">\n      <st-range-picker\n        v-decorator=\"decorators.dateRange\"\n        :options=\"{\n          start: {\n            showTime: {\n              format: 'HH:mm:ss'\n            },\n            format: 'YYYY-MM-DD HH:mm:ss'\n          },\n          end: {\n            showTime: {\n              format: 'HH:mm:ss'\n            },\n            format: 'YYYY-MM-DD HH:mm:ss',\n            disabledDateTime: disabledEndTime\n          }\n        }\"\n        @change=\"formValueChange('dateRange', $event)\"\n      />\n    </st-form-item>\n    <st-form-item label=\"活动库存\">\n      <a-checkbox v-model=\"isLimitStock\">限制库存</a-checkbox>\n      <st-input-number\n        style=\"width: 150px\"\n        class=\"mg-l12\"\n        v-decorator=\"decorators.stock_num\"\n        :min=\"1\"\n        :max=\"99999\"\n        :disabled=\"!formValue.is_limit_stock\"\n        @change=\"formValueChange('stock_num', $event, formValue)\"\n      ></st-input-number>\n    </st-form-item>\n    <st-form-item label=\"单人购买限制\">\n      <a-checkbox v-model=\"isLimitBuy\">限制购买</a-checkbox>\n      <st-input-number\n        style=\"width: 150px;padding: 0;\"\n        class=\"mg-l12\"\n        v-decorator=\"decorators.buy_num\"\n        :min=\"1\"\n        :max=\"999\"\n        :disabled=\"!formValue.is_limit_buy\"\n        @change=\"formValueChange('buy_num', $event, formValue)\"\n      >\n        <span slot=\"addonAfter\">笔订单</span>\n      </st-input-number>\n    </st-form-item>\n    <st-form-item label=\"虚拟秒杀\">\n      <a-checkbox v-model=\"isVirtualSpike\">到点自动抢光</a-checkbox>\n      <a-date-picker\n        :style=\"{ padding: 0, marginLeft: '8px' }\"\n        placeholder=\"请选择时间\"\n        format=\"YYYY-MM-DD HH:mm:ss\"\n        v-decorator=\"decorators.spike_time\"\n        :disabledDate=\"disabledVirDate\"\n        :disabledTime=\"disabledVirTime\"\n        :showTime=\"true\"\n        :showToday=\"false\"\n        :disabled=\"!formValue.is_virtual_spike\"\n        @change=\"formValueChange('spike_time', $event)\"\n      />\n    </st-form-item>\n    <st-form-item label=\"备注\">\n      <st-textarea\n        style=\"min-width: 540px\"\n        placeholder=\"备注内容仅商家可见\"\n        v-model=\"formValue.description\"\n        :autosize=\"{ minRows: 2, maxRows: 3 }\"\n        :maxlength=\"200\"\n      ></st-textarea>\n    </st-form-item>\n    <slot></slot>\n  </st-form>\n</template>\n<script>\nimport ProductSetting from '../../components#/product-setting.vue'\nimport FormMixin from '../../components#/form.mixin'\nimport { merge } from 'lodash'\nimport moment from 'moment'\n\nimport { ruleOptions } from './seckill-form.config'\nexport default {\n  name: 'BrandAppPluginSeckillAdd',\n  mixins: [FormMixin],\n  bem: {\n    b: 'brand-app-plugin-seckill-add'\n  },\n  components: {\n    ProductSetting\n  },\n  props: {\n    form: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    }\n  },\n  data() {\n    return {}\n  },\n  // 数据源与表单数据之间格式转换\n  computed: {\n    decorators() {\n      return this.form.decorators(ruleOptions)\n    },\n    startTime: {\n      get() {\n        return this.formValue.start_time\n          ? moment(this.formValue.start_time)\n          : undefined\n      },\n      set(value) {\n        this.formValue.start_time = value.format('YYYY-MM-DD HH:mm:ss')\n      }\n    },\n    endTime: {\n      get() {\n        return this.formValue.end_time\n          ? moment(this.formValue.end_time)\n          : undefined\n      },\n      set(value) {\n        this.formValue.end_time = value.format('YYYY-MM-DD HH:mm:ss')\n      }\n    },\n    spike_time: {\n      get() {\n        return this.formValue.virtual_spike_time\n          ? moment(this.formValue.virtual_spike_time)\n          : null\n      },\n      set(value) {\n        this.formValue.virtual_spike_time = value.format('YYYY-MM-DD HH:mm:ss')\n      }\n    },\n    isLimitStock: {\n      get() {\n        return this.formValue.is_limit_stock ? true : false\n      },\n      set(value) {\n        this.formValue.is_limit_stock = value ? 1 : 0\n        this.$nextTick(() => {\n          if (!value) {\n            this.form.validateFields(['stock_num'], { force: true })\n            this.form.setFieldsValue({ stock_num: 0 })\n          }\n        })\n      }\n    },\n    isLimitBuy: {\n      get() {\n        return this.formValue.is_limit_buy ? true : false\n      },\n      set(value) {\n        this.formValue.is_limit_buy = value ? 1 : 0\n        this.$nextTick(() => {\n          if (!value) {\n            this.form.validateFields(['buy_num'], { force: true })\n            this.form.setFieldsValue({ buy_num: 0 })\n          }\n        })\n      }\n    },\n    isVirtualSpike: {\n      get() {\n        return this.formValue.is_virtual_spike ? true : false\n      },\n      set(value) {\n        this.formValue.is_virtual_spike = value ? 1 : 0\n        value || this.form.validateFields(['spike_time'], { force: true })\n      }\n    },\n    dateRange: {\n      get() {\n        const start = this.formValue.start_time\n          ? moment(this.formValue.start_time)\n          : undefined\n        const end = this.formValue.end_time\n          ? moment(this.formValue.end_time)\n          : undefined\n        return [start, end]\n      },\n      set(value) {\n        console.log(value)\n        this.formValue.start_time = value[0]\n          ? value[0].format('YYYY-MM-DD HH:mm:ss')\n          : undefined\n        this.formValue.end_time = value[1]\n          ? value[1].format('YYYY-MM-DD HH:mm:ss')\n          : undefined\n      }\n    }\n  },\n  mounted() {},\n  methods: {\n    moment,\n    // 自定义的数据格式校验\n    validate() {\n      return new Promise((resolve, reject) => {\n        this.form.validateFieldsAndScroll({ force: true }, (err, values) => {\n          resolve(!err)\n        })\n      })\n    },\n    dateRangeCheck() {\n      if (!this.formValue.start_time || !this.formValue.end_time) {\n        this.messageError({ content: '请设置活动时间' })\n        return false\n      }\n      return true\n    },\n    virDateCheck() {\n      if (\n        moment(this.formValue.virtual_spike_time).valueOf() <=\n          moment(this.formValue.start_time).valueOf() ||\n        moment(this.formValue.virtual_spike_time).valueOf() >=\n          moment(this.formValue.end_time).valueOf()\n      ) {\n        this.messageError({ content: '秒杀时间必须在活动时间范围内' })\n        return false\n      }\n      return true\n    },\n    buyCheck() {\n      if (this.formValue.is_limit_buy === 1 && this.formValue.buy_num <= 0) {\n        this.messageError({ content: '请设置单人购买笔数' })\n        return false\n      }\n      return true\n    },\n    stockCheck() {\n      if (\n        this.formValue.is_limit_stock === 1 &&\n        this.formValue.stock_num <= 0\n      ) {\n        this.messageError({ content: '请设置活动库存' })\n        return false\n      }\n      return true\n    },\n    // 以下方法为 时间范围控制\n    range(start, end) {\n      const result = []\n      for (let i = start; i < end; i++) {\n        result.push(i)\n      }\n      return result\n    },\n    // disabledEndDate(newEndValue) {\n    //   return newEndValue.format('YYYY-MM-DD') < moment().format('YYYY-MM-DD')\n    // },\n    disabledEndTime() {\n      let hour = 0\n      let min = 0\n      let sec = 0\n      if (\n        moment(this.formValue.start_time).format('YYYY-MM-DD') ===\n        moment(this.formValue.end_time).format('YYYY-MM-DD')\n      ) {\n        hour = moment(this.formValue.start_time).hours()\n        if (\n          moment(this.formValue.start_time).format('YYYY-MM-DD HH') ===\n          moment(this.formValue.end_time).format('YYYY-MM-DD HH')\n        ) {\n          min = moment(this.formValue.start_time).minutes()\n        }\n        if (\n          moment(this.formValue.start_time).format('YYYY-MM-DD HH:mm') ===\n          moment(this.formValue.end_time).format('YYYY-MM-DD HH:mm')\n        ) {\n          sec = moment(this.formValue.start_time).seconds() + 1\n        }\n      }\n      return {\n        disabledHours: () => this.range(0, hour),\n        disabledMinutes: () => this.range(0, min),\n        disabledSeconds: () => this.range(0, sec)\n      }\n    },\n    disabledVirDate(current) {\n      return (\n        current.format('YYYY-MM-DD') <\n          moment(this.formValue.start_time).format('YYYY-MM-DD') ||\n        current.format('YYYY-MM-DD') >\n          moment(this.formValue.end_time).format('YYYY-MM-DD')\n      )\n    },\n    disabledVirTime() {\n      let hour = 0\n      let min = 0\n      let sec = 0\n      if (\n        moment(this.formValue.start_time).format('YYYY-MM-DD') ===\n        moment(this.formValue.virtual_spike_time).format('YYYY-MM-DD')\n      ) {\n        hour = moment(this.formValue.start_time).hours()\n        if (\n          moment(this.formValue.start_time).format('YYYY-MM-DD HH') ===\n          moment(this.formValue.virtual_spike_time).format('YYYY-MM-DD HH')\n        ) {\n          min = moment(this.formValue.start_time).minutes()\n        }\n        if (\n          moment(this.formValue.start_time).format('YYYY-MM-DD HH:mm') ===\n          moment(this.formValue.virtual_spike_time).format('YYYY-MM-DD HH:mm')\n        ) {\n          sec = moment(this.formValue.start_time).seconds() + 1\n        }\n        return {\n          disabledHours: () => this.range(0, hour),\n          disabledMinutes: () => this.range(0, min),\n          disabledSeconds: () => this.range(0, sec)\n        }\n      }\n      if (\n        moment(this.formValue.end_time).format('YYYY-MM-DD') ===\n        moment(this.formValue.virtual_spike_time).format('YYYY-MM-DD')\n      ) {\n        ;(hour = 24), (min = 60), (sec = 60)\n        hour = moment(this.formValue.end_time).hours() + 1\n        if (\n          moment(this.formValue.end_time).format('YYYY-MM-DD HH') ===\n          moment(this.formValue.virtual_spike_time).format('YYYY-MM-DD HH')\n        ) {\n          min = moment(this.formValue.end_time).minutes() + 1\n        }\n        if (\n          moment(this.formValue.end_time).format('YYYY-MM-DD HH:mm') ===\n          moment(this.formValue.virtual_spike_time).format('YYYY-MM-DD HH:mm')\n        ) {\n          sec = moment(this.formValue.end_time).seconds()\n        }\n        return {\n          disabledHours: () => this.range(hour, 24),\n          disabledMinutes: () => this.range(min, 60),\n          disabledSeconds: () => this.range(sec, 60)\n        }\n      }\n      return {\n        disabledHours: () => [],\n        disabledMinutes: () => [],\n        disabledSeconds: () => []\n      }\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/brand/app/plugin/seckill/components#"}]}