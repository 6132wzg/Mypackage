{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/batch/add-edit-course.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/batch/add-edit-course.vue","mtime":1597396799937},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { AddEditCourseService } from \"./add-edit-course.service\";\nimport { TeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/team/service#/common.service';\nimport { PersonalTeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/personal-team/service#/common.service';\nimport { UserService } from '@/services/user.service';\nimport { ruleOptions } from \"./add-edit-course.config\";\nexport default {\n  serviceInject: function serviceInject() {\n    return {\n      addEditCourseService: AddEditCourseService,\n      teamScheduleCommonService: TeamScheduleCommonService,\n      personalTeamScheduleCommonService: PersonalTeamScheduleCommonService,\n      userService: UserService\n    };\n  },\n  rxState: function rxState() {\n    var teamService = this.teamScheduleCommonService;\n    var personalService = this.personalTeamScheduleCommonService;\n    return {\n      loading: this.addEditCourseService.loading$,\n      weekDay: this.userService.getOptions$('shop.week_day'),\n      coachOptionTeam: teamService.coachOptions$,\n      courseOptionTeam: teamService.courseOptions$,\n      courtOptionTeam: teamService.courtOptions$,\n      courseOptionSmall: personalService.courseOptions$,\n      coachOptionSmall: personalService.coachOptions$\n    };\n  },\n  filters: {\n    formatDate: function formatDate(val) {\n      return val ? moment(val) : undefined;\n    }\n  },\n  name: 'addEditCourseService',\n  bem: {\n    basic: 'modal-schedule-batch-add-edit-course'\n  },\n  props: {\n    id: {\n      type: [Number, String],\n      default: ''\n    },\n    type: {\n      type: String,\n      default: ''\n    }\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      coachOptions: [],\n      courseOptions: [],\n      courtOptions: [],\n      scheduleInfo: [],\n      show: false,\n      tableTips: '',\n      // 表单中表格提交错误提示语\n      tableErr: false // 表格是否有错\n\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    // 弹窗开启有id为编辑\n    if (this.id) {\n      // type:team为团课获取团课列表，small为私教小团课获取私教小团课列表\n      var functionName = this.type === 'team' ? 'getTeamInfo' : 'getSmallInfo';\n      this.addEditCourseService[functionName](this.id).subscribe(function (res) {\n        // 显示数据回显\n        _this.form.setFieldsValue({\n          templateName: res.info.template_name,\n          maxNumber: res.info.max_number\n        });\n\n        _this.scheduleInfo = res.info.schedule_info.map(function (item) {\n          return {\n            course_id: item.course_id,\n            coach_id: item.coach_id,\n            court_id: [item.court_id, item.court_site_id],\n            people_number: item.people_number,\n            course_fee: item.course_fee,\n            week_day: item.week_day,\n            is_support_reserve_once: item.is_support_reserve_once,\n            start_time: item.start_time ? moment(item.start_time, 'HH:mm') : undefined\n          };\n        });\n      });\n    } // 获取团课和私教小团课的课程和教练的选择项\n\n\n    if (this.type === 'team') {\n      this.coachOptions = this.coachOptionTeam; // 教练\n\n      this.courseOptions = this.courseOptionTeam; // 课程\n\n      this.courtOptions = this.courtOptionTeam; // 场地\n    } else {\n      this.coachOptions = this.coachOptionSmall; // 教练\n\n      this.courseOptions = this.courseOptionSmall; // 课程\n    }\n  },\n  methods: {\n    // 新增课表\n    addCourse: function addCourse() {\n      this.tableTips = '';\n      this.tableErr = false;\n      this.scheduleInfo.push({\n        course_id: null,\n        coach_id: null,\n        court_id: [],\n        people_number: '',\n        course_fee: '',\n        week_day: null,\n        start_time: null,\n        is_support_reserve_once: 0\n      });\n    },\n    // 排课安排删除\n    delRow: function delRow(index) {\n      this.scheduleInfo.splice(index, 1);\n      this.tableTips = '';\n      this.tableErr = false;\n    },\n    // 数据提交\n    save: function save(e) {\n      var _this2 = this;\n\n      var isOk = this.verifyData();\n      this.form.validate().then(function (values) {\n        // 对提交上课安排数据处理\n        if (isOk) {\n          return;\n        }\n\n        var scheduleInfos = _this2.scheduleInfo.map(function (item) {\n          return {\n            week_day: item.week_day,\n            course_id: item.course_id,\n            start_time: moment(item.start_time).format('HH:mm'),\n            coach_id: item.coach_id,\n            court_id: item.court_id[0] || 0,\n            court_site_id: item.court_id[1] || 0,\n            people_number: item.people_number,\n            is_support_reserve_once: item.is_support_reserve_once,\n            course_fee: item.is_support_reserve_once ? item.course_fee : undefined\n          };\n        }); // 最终提交数据\n\n\n        var params = {\n          template_name: values.templateName,\n          max_number: values.maxNumber,\n          start_time: moment(values.dateTime[0]).format('YYYY-MM-DD HH:mm'),\n          end_time: moment(values.dateTime[1]).format('YYYY-MM-DD HH:mm'),\n          schedule_info: scheduleInfos\n        };\n\n        if (_this2.id) {\n          // 有id为编辑（team为调取团课编辑接口，small为调取私教小团课编辑接口）\n          var editName = _this2.type === 'team' ? 'editTeamDetail' : 'editSmallDetail';\n\n          _this2.addEditCourseService[editName](_this2.id, params).subscribe(function (res) {\n            _this2.$emit('success', res);\n\n            _this2.show = false;\n          });\n        } else {\n          // 没id为新增（team为调取团课新增接口，small为调取私教小团课新增接口）\n          var addName = _this2.type === 'team' ? 'addTeamDetail' : 'addSmallDetail';\n\n          _this2.addEditCourseService[addName](params).subscribe(function (res) {\n            _this2.$emit('success', res);\n\n            _this2.show = false;\n          });\n        }\n      });\n    },\n    // 表格提交数据校验\n    verifyData: function verifyData(isInput) {\n      if (isInput) {\n        this.tableTips = '';\n        this.tableErr = false;\n        return;\n      }\n\n      if (!this.scheduleInfo.length) {\n        this.tableTips = '请新增上课安排';\n        this.tableErr = true;\n        return true;\n      }\n\n      for (var i = 0; i < this.scheduleInfo.length; i++) {\n        var item = this.scheduleInfo[i];\n\n        if (!item.week_day || !item.course_id || !item.start_time || !item.coach_id || !item.people_number || item.is_support_reserve_once && !item.course_fee) {\n          this.tableTips = '请正确填写表格数据';\n          this.tableErr = true;\n          return true;\n        }\n      }\n\n      this.tableTips = '';\n      this.tableErr = false;\n      return false;\n    }\n  }\n};",null]}