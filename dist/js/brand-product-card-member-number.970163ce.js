(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["brand-product-card-member-number"],{"0cd7":function(t,a,e){"use strict";e.r(a),e.d(a,"InfoService",(function(){return p}));var r,i=e("d225"),s=e("b0b4"),n=e("9ab4"),c=e("0cd5"),o=e("df29"),d=e("f80f"),l=e("c4cc"),u=e("54da"),p=function(){function t(a){Object(i["a"])(this,t),this.cardsApi=a,this.cardInfo$=new o["d"]({})}return Object(s["a"])(t,[{key:"getCardInfo",value:function(t){var a=this;return this.cardsApi.getCardInfo(t,"brand").pipe(Object(l["a"])((function(t){a.cardInfo$.commit((function(){return t.info}))})))}},{key:"init",value:function(t){return Object(u["a"])([this.getCardInfo(t)])}},{key:"beforeRouteEnter",value:function(t){return this.init(t.meta.query.id)}}]),t}();p=Object(n["b"])([Object(c["b"])(),Object(n["d"])("design:paramtypes",["function"===typeof(r="undefined"!==typeof d["f"]&&d["f"])?r:Object])],p)},"31f0":function(t,a,e){"use strict";e.r(a),e.d(a,"AddService",(function(){return f}));var r,i,s,n,c=e("d225"),o=e("b0b4"),d=e("9ab4"),l=e("0cd5"),u=e("df29"),p=e("f80f"),_=e("5afb"),m=e("1585"),h=e("2138"),f=function(){function t(a,e,r){Object(c["a"])(this,t),this.cardsApi=a,this.shopApi=e,this.userService=r,this.loading$=new u["d"]({}),this.cardBgList$=this.userService.getOptions$("member_card.card_bg_list"),this.admissionRange$=this.userService.getOptions$("member_card.admission_range"),this.priceSetting$=this.userService.getOptions$("member_card.price_setting"),this.supportSales$=this.userService.getOptions$("member_card.support_sales"),this.unit$=this.userService.getOptions$("member_card.unit"),this.sellType$=this.userService.getOptions$("member_card.sell_type"),this.supportMemberNums$=this.userService.getOptions$("member_card.support_member_num")}return Object(o["a"])(t,[{key:"addCard",value:function(t){return this.cardsApi.addCard(t,"brand")}},{key:"getShopBasic",value:function(t){return this.shopApi.getShopBasic(t).pipe(Object(m["a"])("shops"))}},{key:"beforeRouteEnter",value:function(t,a,e){1===t.meta.query.type&&(this.cardBgList$=this.userService.getOptions$("member_card.family_card_bg_list")),e()}}]),t}();Object(d["b"])([Object(u["c"])(),Object(d["d"])("design:type",Function),Object(d["d"])("design:paramtypes",["function"===typeof(r="undefined"!==typeof p["CardsInput"]&&p["CardsInput"])?r:Object]),Object(d["d"])("design:returntype",void 0)],f.prototype,"addCard",null),f=Object(d["b"])([Object(l["b"])(),Object(d["d"])("design:paramtypes",["function"===typeof(i="undefined"!==typeof p["f"]&&p["f"])?i:Object,"function"===typeof(s="undefined"!==typeof _["c"]&&_["c"])?s:Object,"function"===typeof(n="undefined"!==typeof h["a"]&&h["a"])?n:Object])],f)},"39fc":function(t,a,e){"use strict";e.d(a,"a",(function(){return s}));var r=e("0769"),i=e("716f"),s=function(t){return{"cardData.card_name":{rules:[{validator:function(a,e,r){return void 0===e||""===e?"请填写次卡名称":e&&!t.pattern.CN_EN_NUM_SPACE("1-30").test(e)?"输入的次卡名称格式错误，请重新输入":void 0}}]},"cardData.special_note":{initialValue:i["b"].NUMBER_CARD},"cardData.support_member_num":{rules:[{validator:function(t,a,e){if(!a)return"请选择支持入场人数"}}]},"cardData.admission_range":{initialValue:r["b"].ONLY_STORE,rules:[{validator:function(a,e,i){if(e===r["b"].GENERAL_STORE&&!t.cardData.admission_shop_list.length)return"请新增支持入场门店"}}]},"cardData.price_setting":{validateTrigger:"blur",initialValue:r["f"].UNIFORM_PRICE,rules:[{validator:function(t,a,e){}}]},"cardData.support_sales":{validateTrigger:"blur",initialValue:r["k"].ALL_STORE,rules:[{validator:function(a,e,i){if(e===r["k"].SPECIFIED_STORE&&!t.cardData.sell_shop_list.length)return"请新增支持售卖门店"}}]},start_time:{rules:[{validator:function(t,a,e){if(!a)return"请选择开始售卖时间"}}]},end_time:{rules:[{validator:function(t,a,e){if(!a)return"请选择结束售卖时间"}}]},"cardData.num":{rules:[{validator:function(a,e,r){if(t.cardData._is_transfer&&!e)return"请输入转让费用"}}]}}}},"4b34":function(t,a,e){"use strict";e.r(a),e.d(a,"EditService",(function(){return v}));var r,i,s,n,c=e("d225"),o=e("b0b4"),d=e("9ab4"),l=e("0cd5"),u=e("df29"),p=e("f80f"),_=e("c4cc"),m=e("1585"),h=e("5afb"),f=e("2138"),g=e("54da"),v=function(){function t(a,e,r){Object(c["a"])(this,t),this.cardsApi=a,this.shopApi=e,this.userService=r,this.cardInfo$=new u["d"]({}),this.loading$=new u["d"]({}),this.cardBgList$=this.userService.getOptions$("member_card.card_bg_list"),this.admissionRange$=this.userService.getOptions$("member_card.admission_range"),this.priceSetting$=this.userService.getOptions$("member_card.price_setting"),this.supportSales$=this.userService.getOptions$("member_card.support_sales"),this.unit$=this.userService.getOptions$("member_card.unit"),this.sellType$=this.userService.getOptions$("member_card.sell_type"),this.supportMemberNums$=this.userService.getOptions$("member_card.support_member_num"),this.isShelfCard$=Object(u["e"])((function(t){return!!t.shelf_shop_num&&t.shelf_shop_num>0}),[this.cardInfo$])}return Object(o["a"])(t,[{key:"getCardInfo",value:function(t){var a=this;return this.cardsApi.getCardInfoBack(t,"brand").pipe(Object(_["a"])((function(t){a.cardInfo$.commit((function(){return t.info}))})))}},{key:"getShopBasic",value:function(t){return this.shopApi.getShopBasic(t).pipe(Object(m["a"])("shops"))}},{key:"editCard",value:function(t){return this.cardsApi.editCard(t,"brand")}},{key:"init",value:function(t){return Object(g["a"])([this.getCardInfo(t)])}},{key:"beforeRouteEnter",value:function(t){return 1===t.meta.query.type&&(this.cardBgList$=this.userService.getOptions$("member_card.family_card_bg_list")),this.init(t.meta.query.id)}}]),t}();Object(d["b"])([Object(u["c"])(),Object(d["d"])("design:type",Function),Object(d["d"])("design:paramtypes",["function"===typeof(r="undefined"!==typeof p["CardsInput"]&&p["CardsInput"])?r:Object]),Object(d["d"])("design:returntype",void 0)],v.prototype,"editCard",null),v=Object(d["b"])([Object(l["b"])(),Object(d["d"])("design:paramtypes",["function"===typeof(i="undefined"!==typeof p["f"]&&p["f"])?i:Object,"function"===typeof(s="undefined"!==typeof h["c"]&&h["c"])?s:Object,"function"===typeof(n="undefined"!==typeof f["a"]&&f["a"])?n:Object])],v)},"4f2f":function(t,a,e){"use strict";e.r(a);var r=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("st-mina-panel",{staticClass:"page-brand-basic-card page-brand-edit-number-card",attrs:{responsivePreview:""}},[e("h5-container",{attrs:{slot:"preview",fixed:""},slot:"preview",scopedSlots:t._u([{key:"title",fn:function(){return[t._v("\n      购卡\n    ")]},proxy:!0},{key:"default",fn:function(){return[e("member-card",{attrs:{data:t.h5CardInfo,cardType:t.MEMBER_CARD.NUMBER_CARD}})]},proxy:!0}])}),e("form-banner",{attrs:{slot:"prepend","shelf-number":t.cardInfo.shelf_shop_num},slot:"prepend"}),e("div",{attrs:{slot:"actions"},slot:"actions"},[e("st-button",{attrs:{loading:t.addLoading.editCard,type:"primary"},on:{click:t.onHandleSubmit}},[t._v("\n      保 存\n    ")])],1),e("div",{staticClass:"page-content"},[e("st-form",{attrs:{form:t.form,labelWidth:"118px"}},[e("p",{staticClass:"page-content-card__card__name"},[e("st-tag",{attrs:{type:"number-card"}}),e("span",[t._v(t._s(t.cardInfo.card_name))])],1),e("st-form-item",{staticClass:"page-content-card-line",attrs:{label:"特别说明"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.special_note,expression:"decorators.cardData.special_note"}],staticClass:"page-content-card-input",attrs:{maxlength:"20",placeholder:"最多显示20个字符"},on:{change:t.syncSpecialNote}})],1),e("st-hr",{staticClass:"mg-y32"}),t.isFamilyCard?e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:23}},[e("st-form-item",{staticClass:"page-content-card-admission-range mg-t4",attrs:{required:""}},[e("template",{slot:"label"},[t._v("\n              支持入场人数\n              "),e("st-help-tooltip",{attrs:{id:"TBMCDC003"}})],1),e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.support_member_num,expression:"decorators.cardData.support_member_num"}],staticClass:"page-content-card-input",attrs:{disabled:t.isShelfCard,placeholder:"请选择入场人数"}},t._l(t.supportMemberNums,(function(a,r){return e("a-select-option",{key:r,attrs:{value:a.value}},[t._v("\n                "+t._s(a.label)+"\n              ")])})),1)],2)],1)],1):t._e(),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:23}},[e("st-form-item",{staticClass:"page-content-card-admission-range mg-t4",attrs:{label:"支持入场门店",required:""}},[e("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.admission_range,expression:"decorators.cardData.admission_range"}],attrs:{disabled:t.isShelfCard},on:{change:t.admission_range}},t._l(t.admissionRange,(function(a){return e("a-radio",{key:a.value,attrs:{value:a.value}},[t._v("\n                "+t._s(a.label)+"\n              ")])})),1),t.cardData.admission_range===t.ADMISSION_RANGE.GENERAL_STORE?e("div",{staticClass:"page-admission-range-shop"},[e("p",{staticClass:"page-admission-range-shop__describe"},[t._v("\n                设置支持此"+t._s(t.$c("member_card"))+"出入场馆范围\n              ")]),e("select-shop",{attrs:{shopIds:t.cardData.admission_shop_list},on:{change:t.admission_range_change}})],1):t._e()],1)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:23}},[e("st-form-item",{staticClass:"page-content-card-price-setting mg-t4",attrs:{label:"价格设置",required:"",help:t.priceValidatorText}},[e("a-radio-group",{directives:[{name:"show",rawName:"v-show",value:t.cardData.admission_range===t.ADMISSION_RANGE.ONLY_STORE,expression:"cardData.admission_range === ADMISSION_RANGE.ONLY_STORE"},{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.price_setting,expression:"decorators.cardData.price_setting"}],attrs:{disabled:t.isShelfCard},on:{change:t.price_range}},t._l(t.priceSetting,(function(a){return e("a-radio",{key:a.value,attrs:{value:a.value}},[t._v("\n                "+t._s(a.label)+"\n              ")])})),1),t.cardData.price_setting===t.PRICE_SETTING.UNIFORM_PRICE?e("div",{staticClass:"page-price-setting-set",class:{error:!t.priceIsOk,"brand-set":t.cardData.price_setting===t.PRICE_SETTING.UNIFORM_PRICE&&t.cardData.admission_range===t.ADMISSION_RANGE.ONLY_STORE}},[e("st-form-table",[e("colgroup",[e("col"),e("col"),e("col",{staticStyle:{width:"28%"}}),e("col"),e("col"),e("col",{staticStyle:{width:"60px"}})]),e("thead",[e("tr",[e("th",[t._v("入场次数/次")]),e("th",[t._v("售价/元")]),e("th",[t._v("有效期")]),e("th",{staticClass:"white-nowrap"},[t._v("允许冻结/天")]),e("th",[t._v("赠送上限/天")]),e("th",[t._v("操作")])])]),e("tbody",[e("tr",[e("td",{staticClass:"pd-y0 pd-x0",attrs:{colspan:"6"}},[t.isShelfCard?t._e():e("st-button",{staticClass:"page-price-setting-set__add",attrs:{disabled:t.rallyPriceList.length>=12,type:"dashed",icon:"add",block:""},on:{click:t.brand_price_add}},[t._v("\n                        新增定价规格（"+t._s(t.rallyPriceList.length)+"/12）\n                      ")])],1)]),t._l(t.rallyPriceList,(function(a,r){return e("tr",{key:r+"brand"},[e("td",[e("st-input-number",{attrs:{disabled:t.isShelfCard,min:1,max:99999,value:a.validity_times},on:{change:function(a){return t.brandPriceSettingHandleChange({value:a,key:r,col:"validity_times"})}}})],1),e("td",[e("st-input-number",{attrs:{disabled:t.isShelfCard,float:!0,min:0,max:999999.9,value:a.rally_price},on:{change:function(a){return t.brandPriceSettingHandleChange({value:a,key:r,col:"rally_price"})}}})],1),e("td",[e("st-input-number",{attrs:{min:1,max:99999,value:a.time.num,disabled:t.isShelfCard},on:{change:function(a){return t.brandPriceSettingHandleChange({value:a,key:r,col:"time",prop:"num"})}}},[e("a-select",{attrs:{slot:"addonAfter",value:a.time.unit,disabled:t.isShelfCard},on:{change:function(a){return t.brandPriceSettingHandleChange({value:a,key:r,col:"time",prop:"unit"})}},slot:"addonAfter"},t._l(t.unit_list,(function(a,r){return e("a-select-option",{key:r,attrs:{value:a.value}},[t._v("\n                            "+t._s(a.label)+"\n                          ")])})),1)],1)],1),e("td",[e("st-input-number",{attrs:{min:0,max:99999,value:a.frozen_day,disabled:t.isShelfCard},on:{change:function(a){return t.brandPriceSettingHandleChange({value:a,key:r,col:"frozen_day"})}}})],1),e("td",[e("st-input-number",{attrs:{min:0,max:99999,value:a.gift_unit,disabled:t.isShelfCard},on:{change:function(a){return t.brandPriceSettingHandleChange({value:a,key:r,col:"gift_unit"})}}})],1),e("td",[t.isShelfCard?t._e():e("a",{on:{click:function(a){return t.brand_price_delete(r)}}},[t._v("\n                        删除\n                      ")])])])}))],2)])],1):t._e(),t.cardData.price_setting===t.PRICE_SETTING.SHOP_PRICE?e("div",{staticClass:"page-price-setting-set",class:{error:!t.priceIsOk,"shop-set":t.cardData.price_setting===t.PRICE_SETTING.SHOP_PRICE&&t.cardData.admission_range===t.ADMISSION_RANGE.ONLY_STORE}},[e("st-form-table",[e("colgroup",[e("col"),e("col"),e("col"),e("col"),e("col"),e("col",{staticStyle:{width:"60px"}})]),e("thead",[e("tr",[e("th",[t._v("入场次数/次")]),e("th",[t._v("售价范围/元")]),e("th",[t._v("有效期")]),e("th",{staticClass:"white-nowrap"},[t._v("允许冻结/天")]),e("th",[t._v("赠送上限/天")]),e("th",[t._v("操作")])])]),e("tbody",[e("tr",[e("td",{staticClass:"pd-y0 pd-x0",attrs:{colspan:"6"}},[e("st-button",{staticClass:"page-price-setting-set__add",attrs:{disabled:t.shopPriceList.length>=12||t.isShelfCard,type:"dashed",icon:"add",block:""},on:{click:t.shop_price_add}},[t._v("\n                        新增定价规格（"+t._s(t.shopPriceList.length)+"/12）\n                      ")])],1)]),t._l(t.shopPriceList,(function(a,r){return e("tr",{key:r+"shop"},[e("td",[e("st-input-number",{attrs:{disabled:t.isShelfCard,min:1,max:99999,value:a.validity_times},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"validity_times"})}}})],1),e("td",[e("st-input-number",{staticStyle:{width:"40%"},attrs:{float:!0,min:0,max:999999.9,disabled:t.isShelfCard,value:a.rally_price.min_price},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"rally_price",prop:"min_price"})}}}),t._v("\n                      ~\n                      "),e("st-input-number",{staticStyle:{width:"40%"},attrs:{float:!0,disabled:t.isShelfCard,min:0,max:999999.9,value:a.rally_price.max_price},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"rally_price",prop:"max_price"})}}})],1),e("td",[e("st-input-number",{staticClass:"page-content-table-input",attrs:{min:1,max:99999,value:a.time.num,disabled:t.isShelfCard},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"time",prop:"num"})}}},[e("a-select",{attrs:{slot:"addonAfter",value:a.time.unit},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"time",prop:"unit"})}},slot:"addonAfter"},t._l(t.unit_list,(function(a,r){return e("a-select-option",{key:r,attrs:{value:a.value}},[t._v("\n                            "+t._s(a.label)+"\n                          ")])})),1)],1)],1),e("td",[e("st-input-number",{attrs:{min:1,max:99999,disabled:t.isShelfCard,value:a.frozen_day},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"frozen_day"})}}})],1),e("td",[e("st-input-number",{attrs:{min:1,max:99999,value:a.gift_unit,disabled:t.isShelfCard},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"gift_unit"})}}})],1),e("td",[t.isShelfCard?t._e():e("a",{on:{click:function(a){return t.shop_price_delete(r)}}},[t._v("\n                        删除\n                      ")])])])}))],2)])],1):t._e()],1)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:23}},[e("st-form-item",{staticClass:"page-content-card-support-sales mg-t4",attrs:{label:"支持售卖门店",required:""}},[e("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.support_sales,expression:"decorators.cardData.support_sales"}],attrs:{disabled:t.isShelfCard},on:{change:t.support_range}},t._l(t.support_sales_list,(function(a){return e("a-radio",{key:a.value,attrs:{value:a.value}},[t._v("\n                "+t._s(a.label)+"\n              ")])})),1),t.cardData.support_sales===t.SUPPORT_SALES.SPECIFIED_STORE?e("div",{staticClass:"page-support-sales-shop",class:{"page-lot-shop":t.cardData.admission_range===t.ADMISSION_RANGE.GENERAL_STORE}},[e("p",{staticClass:"page-support-sales-shop__describe"},[t._v("\n                设置支持此"+t._s(t.$c("member_card"))+"售卖场馆范围\n              ")]),e("select-shop",{attrs:{disabled:t.isShelfCard,shopIds:t.cardData.sell_shop_list},on:{change:t.sales_shop_change}})],1):t._e()],1)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:20}},[e("st-form-item",{staticClass:"page-content-card-time",attrs:{required:""}},[e("span",{attrs:{slot:"label"},slot:"label"},[t._v("\n              支持售卖时间\n              "),e("a-popover",{attrs:{trigger:"hover",placement:"bottomRight",arrowPointAtCenter:""}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n                  设置此"+t._s(t.$c("member_card"))+"可售卖的时间范围\n                ")]),e("a-icon",{staticClass:"page-content-card-time__icon",attrs:{type:"info-circle"}})],1)],1),e("a-form-item",{staticClass:"page-a-form"},[e("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.start_time,expression:"decorators.start_time"}],attrs:{disabled:t.isShelfCard,disabledDate:t.disabledStartDate,format:"YYYY-MM-DD",placeholder:"开始时间",showToday:!1},on:{openChange:t.handleStartOpenChange,change:t.start_time_change}})],1),t._v("\n            ~\n            "),e("a-form-item",{staticClass:"page-a-form"},[e("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.end_time,expression:"decorators.end_time"}],attrs:{disabledDate:t.disabledEndDate,format:"YYYY-MM-DD",placeholder:"结束时间",showToday:!1,open:t.cardData.endOpen},on:{openChange:t.handleEndOpenChange,change:t.end_time_change}})],1)],1)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:20}},[e("st-form-item",{staticClass:"page-content-card-transfer",attrs:{label:"转让设置"}},[e("div",{staticClass:"page-content-card-transfer-body"},[e("a-checkbox",{staticClass:"page-checkbox",attrs:{checked:t.cardData._is_transfer},on:{change:t.transfer}},[t._v("\n                支持转让\n              ")]),e("st-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.num,expression:"decorators.cardData.num"}],staticClass:"page-input-group page-content-card-num-input",attrs:{float:t.cardData.unit===t.UNIT.RMB,disabled:!t.cardData._is_transfer,min:t.transferMin,max:t.transferMax}},[e("a-select",{attrs:{slot:"addonAfter",disabled:!t.cardData._is_transfer},slot:"addonAfter",model:{value:t.cardData.unit,callback:function(a){t.$set(t.cardData,"unit",a)},expression:"cardData.unit"}},t._l(t.unit,(function(a){return e("a-select-option",{key:a.value,attrs:{value:a.value}},[t._v("\n                    "+t._s(a.label)+"\n                  ")])})),1)],1)],1)])],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:20}},[e("st-form-item",{staticClass:"page-content-card-sell-type",attrs:{label:"售卖方式",required:""}},[e("a-checkbox-group",{model:{value:t.cardData.sell_type,callback:function(a){t.$set(t.cardData,"sell_type",a)},expression:"cardData.sell_type"}},t._l(t.sell_type_list,(function(a){return e("a-checkbox",{key:a.value,attrs:{value:a.value}},[t._v("\n                "+t._s(a.label)+"\n              ")])})),1)],1)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:20}},[e("st-form-item",{staticClass:"page-content-card-bg",attrs:{label:"卡背景",required:"",help:t.cardBgValidatorText}},[e("card-bg-radio",{attrs:{isFamilyCard:t.isFamilyCard},on:{change:t.onCardBgChange},model:{value:t.cardData.card_bg,callback:function(a){t.$set(t.cardData,"card_bg",a)},expression:"cardData.card_bg"}})],1)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:22}},[e("st-form-item",{staticClass:"page-content-card-introduction mg-t4",attrs:{label:t.$c("member_card")+"介绍"}},[e("st-editor",{model:{value:t.cardData.card_introduction,callback:function(a){t.$set(t.cardData,"card_introduction",a)},expression:"cardData.card_introduction"}})],1)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:22}},[e("st-form-item",{staticClass:"page-content-card-contents mg-t4",attrs:{label:"备注"}},[e("st-textarea",{staticClass:"page-content-card-textarea",attrs:{maxlength:"500",placeholder:"请输入"},model:{value:t.cardData.card_contents,callback:function(a){t.$set(t.cardData,"card_contents",a)},expression:"cardData.card_contents"}})],1)],1)],1)],1)],1)],1)},i=[],s=e("75fc"),n=(e("456d"),e("28a5"),e("6b54"),e("ac6a"),e("2138")),c=e("c32d"),o=e.n(c),d=e("2527"),l=e("d2d7"),u=e("5c8a"),p=e("3a59"),_=e("4b34"),m=e("c52b"),h=e("5bfd"),f=e("9154"),g=e("716f"),v=e("f0cb"),b=e("870c"),y=e("0769"),S=e("39fc"),C=e("972a"),D={name:"BrandNumberCardEdit",mixins:[f["a"]],serviceInject:function(){return{pattern:d["a"],editService:_["EditService"],userService:n["a"]}},rxState:function(){return{addLoading:this.editService.loading$,cardInfo:this.editService.cardInfo$,cardBgList:this.editService.cardBgList$,admissionRange:this.editService.admissionRange$,priceSetting:this.editService.priceSetting$,supportSales:this.editService.supportSales$,unit:this.editService.unit$,sellType:this.editService.sellType$,isShelfCard:this.editService.isShelfCard$,supportMemberNums:this.editService.supportMemberNums$}},bem:{b:"st-help-popover"},components:{StEditor:C["a"],SelectShop:l["a"],MemberCard:m["a"],H5Container:h["a"],CardBgRadio:v["a"],FormBanner:b["a"]},data:function(){var t=this.$stForm.create(),a=t.decorators(S["a"]);return{form:t,decorators:a,ADMISSION_RANGE:y["b"],SELL_TYPE:y["i"],PRICE_SETTING:y["f"],SUPPORT_SALES:y["k"],UNIT:y["l"],cardType:g["a"].NUMBER_CARD,MEMBER_CARD:g["a"],cardData:{id:null,card_type:this.isFamilyCard?y["c"].MORE_NUMBER:y["c"].NUMBER,card_name:"",special_note:"",admission_range:y["b"].ONLY_STORE,admission_shop_list:[],price_setting:y["f"].UNIFORM_PRICE,price_gradient:[],support_sales:y["k"].ALL_STORE,sell_shop_list:[],shelf_shop_num:0,start_time:"",end_time:"",endOpen:!1,_is_transfer:!1,is_transfer:0,unit:y["l"].RMB,num:void 0,sell_type:[y["i"].OFFLINE],card_bg:{image_id:0,image_key:this.cardBgList[0].image_key,image_url:"",index:1},appConfig:!0,card_introduction:"",card_contents:""},transfer_unit_is_first:!0,rallyPriceList:[],shopPriceList:[],start_time:null,end_time:null,unit_list:[{value:2,label:"天"},{value:3,label:"月"},{value:4,label:"年"}],priceValidatorText:"",cardBgValidatorText:"",startTimeIsDisabled:!1}},mounted:function(){this.init()},methods:{init:function(){var t=this;this.form.setFieldsValue({"cardData.special_note":this.cardInfo.special_note,"cardData.admission_range":this.cardInfo.admission_range,"cardData.price_setting":this.cardInfo.price_setting,"cardData.support_sales":this.cardInfo.support_sales,start_time:o()(1e3*this.cardInfo.start_time),end_time:o()(1e3*this.cardInfo.end_time),"cardData.num":this.cardInfo.transfer_num}),this.isFamilyCard&&this.form.setFieldsValue({"cardData.support_member_num":this.cardInfo.support_member_num}),this.cardData.admission_range=this.cardInfo.admission_range,this.cardData.admission_shop_list=this.cardInfo.admission_shop_list,this.cardData.price_setting=this.cardInfo.price_setting,this.cardInfo.price_setting===y["f"].UNIFORM_PRICE?this.cardInfo.price_gradient.forEach((function(a){var e=parseInt(999999*Math.random()).toString();t.rallyPriceList.push({key:e,time:{unit:+a.unit,num:+a.num},validity_times:+a.validity_times,rally_price:+a.rally_price,frozen_day:+a.frozen_day,gift_unit:+a.gift_unit})})):this.cardInfo.price_gradient.forEach((function(a){var e=parseInt(999999*Math.random()).toString();t.shopPriceList.push({key:e,time:{unit:+a.unit,num:+a.num},validity_times:+a.validity_times,frozen_day:+a.frozen_day,gift_unit:+a.gift_unit,rally_price:{min_price:+a.min_price,max_price:+a.max_price}})})),this.cardData.support_sales=this.cardInfo.support_sales,this.cardData.sell_shop_list=this.cardData.support_sales===y["k"].SPECIFIED_STORE?Object(u["a"])(this.cardInfo.sell_shop_list):[],this.start_time=o()(1e3*this.cardInfo.start_time),this.end_time=o()(1e3*this.cardInfo.end_time),this.startTimeIsDisabled=1e3*this.cardInfo.start_time<o()().startOf("day").valueOf()&&1e3*this.cardInfo.end_time>o()().valueOf(),this.cardData._is_transfer=!!this.cardInfo.is_transfer,this.cardData.unit=this.cardInfo.transfer_unit,this.cardData.num=this.cardInfo.transfer_num,this.cardData.sell_type=this.cardInfo.sell_type,this.cardData.card_bg=Object(u["a"])(this.cardInfo.card_bg),this.cardData.card_introduction=this.cardInfo.card_introduction,this.cardData.card_contents=this.cardInfo.card_contents,this.initH5CardInfo()},onHandleSubmit:function(t){var a=this;t.preventDefault(),this.priceValidator(this.cardData.price_setting),this.cardBgValidator(),this.form.validateFieldsAndScroll((function(t,e){if(!t&&a.priceIsOk&&a.cardBgIsOk){a.cardData.admission_range!==y["b"].GENERAL_STORE&&(a.cardData.admission_shop_list=[]),a.cardData.support_sales!==y["k"].SPECIFIED_STORE&&(a.cardData.sell_shop_list=[]),a.cardData.admission_range===y["b"].GENERAL_STORE&&a.cardData.support_sales===y["k"].ENTRY_STORE&&(a.cardData.sell_shop_list=Object(u["a"])(a.cardData.admission_shop_list));var r=[];switch(a.cardData.price_setting){case y["f"].UNIFORM_PRICE:a.rallyPriceList.forEach((function(t){r.push({unit:+t.time.unit,num:+t.time.num,validity_times:+t.validity_times,rally_price:+t.rally_price,frozen_day:+t.frozen_day,gift_unit:+t.gift_unit})}));break;case y["f"].SHOP_PRICE:a.shopPriceList.forEach((function(t){r.push({unit:+t.time.unit,num:+t.time.num,validity_times:+t.validity_times,min_price:+t.rally_price.min_price,max_price:+t.rally_price.max_price,frozen_day:+t.frozen_day,gift_unit:+t.gift_unit})}));break}a.cardData.special_note=e.cardData.special_note,a.cardData.price_gradient=Object(u["a"])(r),a.cardData.start_time="".concat(a.start_time.format("YYYY-MM-DD")),a.cardData.end_time="".concat(a.end_time.format("YYYY-MM-DD")),a.cardData.id=+a.$searchQuery.id,a.cardData.num=a.cardData._is_transfer?+e.cardData.num:void 0,a.isFamilyCard?(a.cardData.support_member_num=e.cardData.support_member_num,a.cardData.card_type=y["c"].MORE_NUMBER):(a.cardData.support_member_num=1,a.cardData.card_type=y["c"].NUMBER),a.editService.editCard(a.cardData).subscribe((function(t){a.$router.push({name:"brand-product-card-member-list-all"})}))}}))},admission_range_change:function(t){this.cardData.admission_shop_list=Object(u["a"])(t),this.syncAdmissionShop()},admission_range:function(t){this.cardData.admission_range=t.target.value,this.form.setFieldsValue({"cardData.support_sales":y["k"].ALL_STORE,"cardData.price_setting":y["f"].UNIFORM_PRICE}),this.cardData.support_sales=y["k"].ALL_STORE,this.cardData.price_setting=y["f"].UNIFORM_PRICE,this.priceValidatorText="",this.syncAdmission()},price_range:function(t){this.cardData.price_setting=t.target.value},brand_price_add:function(){var t=parseInt(999999*Math.random()).toString();this.rallyPriceList.push({key:t,time:{unit:2,num:null},validity_times:null,rally_price:null,frozen_day:null,gift_unit:null})},brand_price_delete:function(t){this.rallyPriceList.splice(t,1)},brandPriceSettingHandleChange:function(t){var a=t.value,e=t.key,r=t.col,i=t.prop;void 0!==i?this.rallyPriceList[e][r][i]=a:this.rallyPriceList[e][r]=a},shop_price_add:function(){var t=parseInt(999999*Math.random()).toString();this.shopPriceList.push({key:t,time:{unit:2,num:null},rally_price:{min_price:null,max_price:null},validity_times:null,frozen_day:null,gift_unit:null})},shop_price_delete:function(t){this.shopPriceList.splice(t,1)},shopPriceSettingHandleChange:function(t){var a=t.value,e=t.key,r=t.col,i=t.prop;void 0!==i?this.shopPriceList[e][r][i]=a:this.shopPriceList[e][r]=a},support_range:function(t){this.cardData.support_sales=t.target.value},sales_shop_change:function(t){this.cardData.sell_shop_list=Object(u["a"])(t)},disabledStartDate:function(t){var a=this.end_time;if(!a)return t.valueOf()<o()().startOf("day").valueOf();var e=a.valueOf()>o()().add(30,"y").valueOf()?o()(a).subtract(30,"y").valueOf():o()().startOf("day").valueOf();return t.valueOf()<e||t.valueOf()>o()(a).valueOf()},start_time_change:function(t){this.start_time=Object(u["a"])(t)},handleStartOpenChange:function(t){t||(this.cardData.endOpen=!0)},end_time_change:function(t){this.end_time=Object(u["a"])(t)},handleEndOpenChange:function(t){this.cardData.endOpen=t},disabledEndDate:function(t){var a=this.start_time;return a&&(t.valueOf()>=o()(a).add(30,"y").valueOf()||t.valueOf()<o()(a).valueOf())||t.valueOf()<o()().startOf("day").valueOf()},moment:o.a,range:function(t,a){for(var e=[],r=t;r<a;r++)e.push(r);return e},transfer:function(t){this.cardData._is_transfer=t.target.checked,this.form.resetFields(["cardData.num"])},priceValidator:function(t){var a=this,e=t===y["f"].UNIFORM_PRICE?"brandPriceValidataArray":"shopPriceValidataArray",r=!!this[e].length&&this[e].every((function(t){return a.pattern.NUM_FLOAT(1).test(t.split("-")[1])}));this.priceValidatorText=r?"":"请输入正确的价格"},onCardBgChange:function(t){this.cardBgValidatorText=""},cardBgValidator:function(){var t=""!==this.cardData.card_bg.image_key;this.cardBgValidatorText=t?"":"请上传卡背景"}},watch:{"cardData._is_transfer":{deep:!0,handler:function(t,a){this.cardData.is_transfer=+t}},"cardData.unit":{deep:!0,handler:function(){this.transfer_unit_is_first||this.form.resetFields(["cardData.num"]),this.transfer_unit_is_first=!1}},"cardData.admission_shop_list":{deep:!0,handler:function(){var t=this.cardData.admission_range;this.cardData.admission_range=t,this.form.setFieldsValue({"cardData.admission_range":t})}},"cardData.sell_shop_list":{deep:!0,handler:function(){var t=this.cardData.support_sales;this.cardData.support_sales=t,this.form.setFieldsValue({"cardData.support_sales":t})}}},computed:{support_sales_list:function(){var t=Object(u["a"])(this.supportSales),a=this.cardData.admission_range===y["b"].GENERAL_STORE?999:2;return t.splice(a,1),t},sell_type_list:function(){var t=Object(u["a"])(this.sellType),a=[];return t.forEach((function(t){a.push({value:t.value,label:t.label})})),this.cardData.appConfig||Object(p["a"])(a,(function(t){return t.value===y["i"].CLIENT})),a},brandPriceValidataArray:function(){var t=[];return this.rallyPriceList.forEach((function(a){Object.keys(a).forEach((function(e){t.push("time"===e?"time-".concat(a.time.num):"".concat(e,"-").concat(a[e]))}))})),t},shopPriceValidataArray:function(){var t=[];return this.shopPriceList.forEach((function(a){Object.keys(a).forEach((function(e){var r=[];r="time"===e?["time-".concat(a.time.num)]:"rally_price"===e?["min_price-".concat(a.rally_price.min_price),"max_price-".concat(a.rally_price.max_price)]:["".concat(e,"-").concat(a[e])],t.push.apply(t,Object(s["a"])(r))}))})),t},priceIsOk:function(){return""===this.priceValidatorText},cardBgIsOk:function(){return""===this.cardBgValidatorText},transferMin:function(){return 0},transferMax:function(){return this.cardData.unit===y["l"].PERCENT?100:999999.9},isFamilyCard:function(){return"family-card"===this.$searchQuery.type}}},O=D,I=e("2877"),E=Object(I["a"])(O,r,i,!1,null,null,null);a["default"]=E.exports},"870c":function(t,a,e){"use strict";var r=function(){var t=this,a=t.$createElement,e=t._self._c||a;return t.isShelf?e("st-alert",{staticClass:"biz-card-form-banner"},[t._v("\n  "+t._s(t.shelfNumber)+"家门店售卖中，若需修改"+t._s(t.$c("member_card"))+"全部信息，请先统一下架该卡后进行编辑\n")]):e("st-alert",{staticClass:"biz-card-form-banner"},[t._v("\n  无门店上架\n")])},i=[],s=(e("c5f6"),{props:{shelfNumber:{type:Number,default:0,required:!0}},computed:{isShelf:function(){return this.shelfNumber>0}}}),n=s,c=e("2877"),o=Object(c["a"])(n,r,i,!1,null,null,null);a["a"]=o.exports},c6b5:function(t,a,e){"use strict";e.r(a);var r=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("st-mina-panel",{staticClass:"page-brand-card-info page-brand-period-card-info"},[e("h5-container",{attrs:{slot:"preview",fixed:""},slot:"preview",scopedSlots:t._u([{key:"title",fn:function(){return[t._v("购卡")]},proxy:!0},{key:"default",fn:function(){return[e("member-card",{attrs:{data:t.cardInfo,cardType:t.MEMBER_CARD.NUMBER_CARD}})]},proxy:!0}])}),e("div",{staticClass:"page-content"},[e("div",{staticClass:"mg-b24",class:t.item("card_name")},[e("img",{class:t.item("card_bg"),attrs:{src:t._f("imgFilter")(t.cardInfo.card_bg.image_url,{w:192,h:108}),width:"192",height:"108",alt:""}}),e("div",{class:t.item("name_time")},[e("p",{class:t.item("name")},[e("st-tag",{attrs:{type:"number-card"}}),e("span",[t._v(t._s(t.cardInfo.card_name))]),e("span",{class:{"brand-card__selling":t.cardInfo.sell_status.id===t.SELL_STATUS.CAN_SELL,"brand-card__sellstop":t.cardInfo.sell_status.id===t.SELL_STATUS.NO_SELL}},[t._v("\n            "+t._s(t.cardInfo.sell_status.name)+"\n            "),t.cardInfo.sell_status.id===t.SELL_STATUS.NO_SELL?e("a-popover",{attrs:{trigger:"hover",placement:"bottomRight",arrowPointAtCenter:""}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.cardInfo.sell_status.addition))]),e("a-icon",{attrs:{type:"info-circle"}})],1):t._e()],1)],1),e("p",{class:t.item("time")},[e("span",{staticClass:"label"},[t._v("售卖时间：")]),e("span",{staticClass:"value"},[t._v("\n            "+t._s(t.cardInfo.start_time)+" ~ "+t._s(t.cardInfo.end_time)+"\n          ")])]),e("p",{class:t.item("note")},[e("span",{staticClass:"label"},[t._v("特殊说明：")]),e("span",{staticClass:"value"},[t._v(t._s(t.cardInfo.special_note))])])])]),e("div",{staticClass:"mg-b24",class:t.item("admission_range")},[e("p",{staticClass:"mg-b24"},[e("span",{staticClass:"label"},[t._v("支持入场人数：")]),e("span",{staticClass:"value"},[t._v(t._s(t.cardInfo.support_member_num))])]),e("p",{staticClass:"mg-b8"},[e("span",{staticClass:"label"},[t._v("支持入场门店：")]),e("span",{staticClass:"value"},[t._v(t._s(t.cardInfo.admission_range.name))])]),t.cardInfo.admission_range.id===t.ADMISSION_RANGE.GENERAL_STORE?e("st-container",{class:t.item("scroll-container")},[e("st-table",{attrs:{rowKey:"shop_id",columns:t.shop_columns,dataSource:t.cardInfo.admission_shop_list,pagination:!1,scroll:{y:230}}})],1):t._e()],1),e("div",{staticClass:"mg-b24",class:t.item("support_sales")},[e("p",{staticClass:"mg-b8"},[e("span",{staticClass:"label"},[t._v("售卖门店：")]),e("span",{staticClass:"value"},[t._v("\n          "+t._s(t.cardInfo.support_sales.name)+"\n          "+t._s("（已上架"+t.cardInfo.shelf_num+"家门店/共"+t.cardInfo.sale_num+"家门店）")+"\n        ")])]),t.cardInfo.support_sales.id!==t.SUPPORT_SALES.ALL_STORE?e("st-container",{class:t.item("scroll-container")},[e("st-table",{attrs:{rowKey:"shop_id",columns:t.shop_columns,dataSource:t.cardInfo.sell_shop_list,pagination:!1,scroll:{y:230}}})],1):t._e()],1),e("div",{staticClass:"mg-b24",class:t.item("price_setting")},[e("p",{staticClass:"mg-b8"},[e("span",{staticClass:"label"},[t._v("定价方式：")]),e("span",{staticClass:"value"},[t._v(t._s(t.cardInfo.price_setting.name))])])]),e("div",{staticClass:"mg-b24",class:t.item("price_gradient")},[e("p",{staticClass:"mg-b8"},[e("span",{staticClass:"label"},[t._v("售卖定价：")])]),e("st-container",{class:t.item("scroll-container")},[t.cardInfo.price_setting.id===t.PRICE_SETTING.UNIFORM_PRICE?e("st-table",{attrs:{rowKey:"id",columns:t.price_gradient_columns.brand,dataSource:t.cardInfo.price_gradient,pagination:!1,scroll:{y:230}}}):t._e(),t.cardInfo.price_setting.id===t.PRICE_SETTING.SHOP_PRICE?e("st-table",{attrs:{rowKey:"id",columns:t.price_gradient_columns.shop,dataSource:t.cardInfo.price_gradient,pagination:!1,scroll:{y:230}}}):t._e()],1)],1),e("div",{staticClass:"mg-b24",class:t.item("transfer")},[e("p",{staticClass:"mg-b8"},[e("span",{staticClass:"label"},[t._v("转让设置：")]),e("span",{staticClass:"value"},[t._v(t._s(t.cardInfo.is_transfer.name))])])]),e("div",{staticClass:"mg-b24",class:t.item("card_introduction")},[e("p",{staticClass:"mg-b8"},[e("span",{staticClass:"label"},[t._v(t._s(t.$c("member_card"))+"介绍：")])]),e("st-container",[e("div",{domProps:{innerHTML:t._s(t.cardInfo.card_introduction)}})])],1),e("div",{staticClass:"mg-b24",class:t.item("card_contents")},[e("p",{staticClass:"mg-b8"},[e("span",{staticClass:"label"},[t._v("备注：")])]),e("st-container",[t._v(t._s(t.cardInfo.card_contents))])],1)])],1)},i=[],s=e("0cd7"),n=e("c52b"),c=e("5bfd"),o=e("716f"),d=e("0769"),l=[{title:"省",dataIndex:"province_name",width:"22%"},{title:"市",dataIndex:"city_name",width:"22%"},{title:"区",dataIndex:"district_name",width:"22%"},{title:"门店名称",dataIndex:"shop_name",width:"34%"}],u={brand:[{title:"入场次数",scopedSlots:{customRender:"validity_times"},dataIndex:"validity_times",width:"20%"},{title:"售价",scopedSlots:{customRender:"sale_price"},dataIndex:"sale_price",width:"20%"},{title:"有效期",scopedSlots:{customRender:"validity_period"},dataIndex:"validity_period",width:"20%"},{title:"允许冻结天数",scopedSlots:{customRender:"frozen_day"},dataIndex:"frozen_day",width:"20%"},{title:"赠送上限",scopedSlots:{customRender:"gift_unit"},dataIndex:"gift_unit",width:"20%"}],shop:[{title:"入场次数",scopedSlots:{customRender:"validity_times"},dataIndex:"validity_times",width:"20%"},{title:"售价",scopedSlots:{customRender:"sale_price"},dataIndex:"sale_price",width:"20%"},{title:"有效期",scopedSlots:{customRender:"validity_period"},dataIndex:"validity_period",width:"20%"},{title:"允许冻结天数",scopedSlots:{customRender:"frozen_day"},dataIndex:"frozen_day",width:"20%"},{title:"赠送上限",scopedSlots:{customRender:"gift_unit"},dataIndex:"gift_unit",width:"20%"}]},p={name:"BrandNumberCardInfo",bem:{item:"brand-card"},components:{MemberCard:n["a"],H5Container:c["a"]},serviceInject:function(){return{infoService:s["InfoService"]}},rxState:function(){return{cardInfo:this.infoService.cardInfo$}},data:function(){return{ADMISSION_RANGE:d["b"],PRICE_SETTING:d["f"],SUPPORT_SALES:d["k"],SELL_STATUS:d["h"],MEMBER_CARD:o["a"],shop_columns:l,price_gradient_columns:u}}},_=p,m=e("2877"),h=Object(m["a"])(_,r,i,!1,null,null,null);a["default"]=h.exports},f5cd:function(t,a,e){"use strict";e.r(a);var r=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("st-mina-panel",{staticClass:"page-brand-basic-card page-brand-add-number-card",attrs:{responsivePreview:""}},[e("h5-container",{attrs:{slot:"preview",fixed:""},slot:"preview",scopedSlots:t._u([{key:"title",fn:function(){return[t._v("\n      购卡\n    ")]},proxy:!0},{key:"default",fn:function(){return[e("member-card",{attrs:{data:t.h5CardInfo,cardType:t.MEMBER_CARD.NUMBER_CARD,isAdd:!0}})]},proxy:!0}])}),e("div",{attrs:{slot:"actions"},slot:"actions"},[e("st-button",{attrs:{loading:t.addLoading.addCard,type:"primary"},on:{click:t.onHandleSubmit}},[t._v("\n      保 存\n    ")])],1),e("div",{staticClass:"page-content"},[e("st-form",{attrs:{form:t.form,labelWidth:"118px"}},[e("st-form-item",{attrs:{label:"次卡名称",required:""}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.card_name,expression:"decorators.cardData.card_name"}],staticClass:"page-content-card-input",attrs:{maxlength:"30",placeholder:"请输入次卡名称"},on:{change:t.syncName}})],1),e("st-form-item",{staticClass:"page-content-card-line",attrs:{label:"特别说明"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.special_note,expression:"decorators.cardData.special_note"}],staticClass:"page-content-card-input",attrs:{maxlength:"20",placeholder:"最多显示20个字符"},on:{change:t.syncSpecialNote}})],1),e("st-hr",{staticClass:"mg-y32"}),t.isFamilyCard?e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:23}},[e("st-form-item",{staticClass:"page-content-card-admission-range mg-t4",attrs:{required:""}},[e("template",{slot:"label"},[t._v("\n              支持入场人数\n              "),e("st-help-tooltip",{attrs:{id:"TBMCDC003"}})],1),e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.support_member_num,expression:"decorators.cardData.support_member_num"}],staticClass:"page-content-card-input",attrs:{placeholder:"请选择入场人数"}},t._l(t.supportMemberNums,(function(a,r){return e("a-select-option",{key:r,attrs:{value:a.value}},[t._v("\n                "+t._s(a.label)+"\n              ")])})),1)],2)],1)],1):t._e(),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:23}},[e("st-form-item",{staticClass:"page-content-card-admission-range mg-t4",attrs:{required:""}},[e("template",{slot:"label"},[t._v("\n              支持入场范围\n              "),e("st-help-tooltip",{attrs:{id:"TBMCTC001"}})],1),e("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.admission_range,expression:"decorators.cardData.admission_range"}],on:{change:t.admission_range}},t._l(t.admissionRange,(function(a){return e("a-radio",{key:a.value,attrs:{value:a.value}},[t._v("\n                "+t._s(a.label)+"\n              ")])})),1),t.cardData.admission_range===t.ADMISSION_RANGE.GENERAL_STORE?e("div",{staticClass:"page-admission-range-shop"},[e("p",{staticClass:"page-admission-range-shop__describe"},[t._v("\n                设置支持此"+t._s(t.$c("member_card"))+"出入场馆范围\n              ")]),e("select-shop",{attrs:{shopIds:t.cardData.admission_shop_list},on:{change:t.admission_range_change}})],1):t._e()],2)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{span:24}},[e("st-form-item",{staticClass:"page-content-card-price-setting mg-t4",attrs:{required:"",help:t.priceValidatorText}},[e("template",{slot:"label"},[t._v("\n              价格设置\n              "),e("st-help-tooltip",{attrs:{id:"TBMCTC002"}})],1),e("a-radio-group",{directives:[{name:"show",rawName:"v-show",value:t.cardData.admission_range===t.ADMISSION_RANGE.ONLY_STORE,expression:"cardData.admission_range === ADMISSION_RANGE.ONLY_STORE"},{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.price_setting,expression:"decorators.cardData.price_setting"}],on:{change:t.price_range}},t._l(t.priceSetting,(function(a){return e("a-radio",{key:a.value,attrs:{value:a.value}},[t._v("\n                "+t._s(a.label)+"\n              ")])})),1),t.cardData.price_setting===t.PRICE_SETTING.UNIFORM_PRICE?e("div",{staticClass:"page-price-setting-set",class:{error:!t.priceIsOk,"brand-set":t.cardData.price_setting===t.PRICE_SETTING.UNIFORM_PRICE&&t.cardData.admission_range===t.ADMISSION_RANGE.ONLY_STORE}},[e("st-form-table",[e("colgroup",[e("col"),e("col"),e("col",{staticStyle:{width:"25%"}}),e("col"),e("col"),e("col",{staticStyle:{width:"60px"}})]),e("thead",[e("tr",[e("th",[t._v("入场次数/次")]),e("th",[t._v("售价/元")]),e("th",[t._v("有效期")]),e("th",{staticClass:"white-nowrap"},[t._v("允许冻结/天")]),e("th",{staticClass:"white-nowrap"},[t._v("赠送上限/天")]),e("th",[t._v("操作")])])]),e("tbody",[e("tr",[e("td",{staticClass:"pd-y0 pd-x0",attrs:{colspan:"6"}},[e("st-button",{staticClass:"page-price-setting-set__add",attrs:{disabled:t.rallyPriceList.length>=12,type:"dashed",icon:"add",block:""},on:{click:t.brand_price_add}},[t._v("\n                        新增定价规格（"+t._s(t.rallyPriceList.length)+"/12）\n                      ")])],1)]),t._l(t.rallyPriceList,(function(a,r){return e("tr",{key:r+"brand"},[e("td",[e("st-input-number",{attrs:{min:1,max:99999,placeholder:"入场次数"},on:{change:function(a){return t.brandPriceSettingHandleChange({value:a,key:r,col:"validity_times"})}}})],1),e("td",[e("st-input-number",{attrs:{float:!0,min:0,max:999999.9,placeholder:"售价"},on:{change:function(a){return t.brandPriceSettingHandleChange({value:a,key:r,col:"rally_price"})}}})],1),e("td",[e("st-input-number",{attrs:{min:1,max:99999,value:a.time.num,placeholder:"有效期"},on:{change:function(a){return t.brandPriceSettingHandleChange({value:a,key:r,col:"time",prop:"num"})}}},[e("a-select",{attrs:{slot:"addonAfter",value:a.time.unit},on:{change:function(a){return t.brandPriceSettingHandleChange({value:a,key:r,col:"time",prop:"unit"})}},slot:"addonAfter"},t._l(t.unit_list,(function(a,r){return e("a-select-option",{key:r,attrs:{value:a.value}},[t._v("\n                            "+t._s(a.label)+"\n                          ")])})),1)],1)],1),e("td",[e("st-input-number",{attrs:{min:0,max:99999,placeholder:"冻结天数"},on:{change:function(a){return t.brandPriceSettingHandleChange({value:a,key:r,col:"frozen_day"})}}})],1),e("td",[e("st-input-number",{attrs:{min:0,max:99999,placeholder:"赠送上限"},on:{change:function(a){return t.brandPriceSettingHandleChange({value:a,key:r,col:"gift_unit"})}}})],1),e("td",[e("a",{on:{click:function(a){return t.brand_price_delete(r)}}},[t._v("删除")])])])}))],2)])],1):t._e(),t.cardData.price_setting===t.PRICE_SETTING.SHOP_PRICE?e("div",{staticClass:"page-price-setting-set",class:{error:!t.priceIsOk,"shop-set":t.cardData.price_setting===t.PRICE_SETTING.SHOP_PRICE&&t.cardData.admission_range===t.ADMISSION_RANGE.ONLY_STORE}},[e("st-form-table",[e("colgroup",[e("col"),e("col"),e("col",{staticStyle:{width:"20%"}}),e("col"),e("col"),e("col",{staticStyle:{width:"60px"}})]),e("thead",[e("tr",[e("th",[t._v("入场次数/次")]),e("th",[t._v("售价范围/元")]),e("th",[t._v("有效期")]),e("th",{staticClass:"white-nowrap"},[t._v("冻结天数/天")]),e("th",[t._v("赠送上限/天")]),e("th",[t._v("操作")])])]),e("tbody",[e("tr",[e("td",{staticClass:"pd-y0 pd-x0",attrs:{colspan:"6"}},[e("st-button",{staticClass:"page-price-setting-set__add",attrs:{disabled:t.shopPriceList.length>=12,type:"dashed",icon:"add",block:""},on:{click:t.shop_price_add}},[t._v("\n                        新增定价规格（"+t._s(t.shopPriceList.length)+"/12）\n                      ")])],1)]),t._l(t.shopPriceList,(function(a,r){return e("tr",{key:r+"shop"},[e("td",[e("st-input-number",{attrs:{min:1,max:99999,placeholder:"入场次数"},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"validity_times"})}}})],1),e("td",[e("st-input-number",{staticStyle:{width:"45%"},attrs:{float:!0,min:0,placeholder:"售价下限",max:999999.9},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"rally_price",prop:"min_price"})}}}),t._v("\n                      ~\n                      "),e("st-input-number",{staticStyle:{width:"45%"},attrs:{placeholder:"售价上限",float:!0,min:0,max:999999.9},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"rally_price",prop:"max_price"})}}})],1),e("td",[e("st-input-number",{attrs:{min:1,max:99999,value:a.time.num,placeholder:"有效期"},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"time",prop:"num"})}}},[e("a-select",{attrs:{slot:"addonAfter",value:a.time.unit},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"time",prop:"unit"})}},slot:"addonAfter"},t._l(t.unit_list,(function(a,r){return e("a-select-option",{key:r,attrs:{value:a.value}},[t._v("\n                            "+t._s(a.label)+"\n                          ")])})),1)],1)],1),e("td",[e("st-input-number",{attrs:{min:0,max:99999,placeholder:"冻结天数"},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"frozen_day"})}}})],1),e("td",[e("st-input-number",{attrs:{min:0,max:99999,placeholder:"赠送上限"},on:{change:function(a){return t.shopPriceSettingHandleChange({value:a,key:r,col:"gift_unit"})}}})],1),e("td",[e("a",{on:{click:function(a){return t.shop_price_delete(r)}}},[t._v("删除")])])])}))],2)])],1):t._e()],2)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:23}},[e("st-form-item",{staticClass:"page-content-card-support-sales mg-t4",attrs:{label:"支持售卖门店",required:""}},[e("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.support_sales,expression:"decorators.cardData.support_sales"}],on:{change:t.support_range}},t._l(t.support_sales_list,(function(a){return e("a-radio",{key:a.value,attrs:{value:a.value}},[t._v("\n                "+t._s(a.label)+"\n              ")])})),1),t.cardData.support_sales===t.SUPPORT_SALES.SPECIFIED_STORE?e("div",{staticClass:"page-support-sales-shop",class:{"page-lot-shop":t.cardData.admission_range===t.ADMISSION_RANGE.GENERAL_STORE}},[e("p",{staticClass:"page-support-sales-shop__describe"},[t._v("\n                设置支持此"+t._s(t.$c("member_card"))+"售卖场馆范围\n              ")]),e("select-shop",{on:{change:t.sales_shop_change}})],1):t._e()],1)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:20}},[e("st-form-item",{staticClass:"page-content-card-time",attrs:{label:"支持售卖时间",required:""}},[e("a-form-item",{staticClass:"page-a-form"},[e("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.start_time,expression:"decorators.start_time"}],attrs:{disabledDate:t.disabledStartDate,format:"YYYY-MM-DD",placeholder:"开始时间",showToday:!1},on:{openChange:t.handleStartOpenChange,change:t.start_time_change}})],1),t._v("\n            ~\n            "),e("a-form-item",{staticClass:"page-a-form"},[e("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.end_time,expression:"decorators.end_time"}],attrs:{disabledDate:t.disabledEndDate,format:"YYYY-MM-DD",placeholder:"结束时间",showToday:!1,open:t.cardData.endOpen},on:{openChange:t.handleEndOpenChange,change:t.end_time_change}})],1)],1)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:20}},[e("st-form-item",{staticClass:"page-content-card-transfer",attrs:{label:"转让设置"}},[e("div",{staticClass:"page-content-card-transfer-body"},[e("a-checkbox",{staticClass:"page-checkbox",on:{change:t.transfer}},[t._v("\n                支持转让\n              ")]),e("st-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.cardData.num,expression:"decorators.cardData.num"}],staticClass:"page-input-group page-content-card-num-input",attrs:{float:t.cardData.unit===t.UNIT.RMB,disabled:!t.cardData._is_transfer,min:t.transferMin,max:t.transferMax}},[e("a-select",{attrs:{slot:"addonAfter",disabled:!t.cardData._is_transfer},slot:"addonAfter",model:{value:t.cardData.unit,callback:function(a){t.$set(t.cardData,"unit",a)},expression:"cardData.unit"}},t._l(t.unit,(function(a){return e("a-select-option",{key:a.value,attrs:{value:a.value}},[t._v("\n                    "+t._s(a.label)+"\n                  ")])})),1)],1)],1)])],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:20}},[e("st-form-item",{staticClass:"page-content-card-sell-type",attrs:{label:"售卖方式",required:""}},[e("a-checkbox-group",{model:{value:t.cardData.sell_type,callback:function(a){t.$set(t.cardData,"sell_type",a)},expression:"cardData.sell_type"}},t._l(t.sell_type_list,(function(a){return e("a-checkbox",{key:a.value,attrs:{value:a.value}},[t._v("\n                "+t._s(a.label)+"\n              ")])})),1)],1)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:20}},[e("st-form-item",{staticClass:"page-content-card-bg",attrs:{label:"卡背景",required:"",help:t.cardBgValidatorText}},[e("card-bg-radio",{attrs:{isFamilyCard:t.isFamilyCard},on:{change:t.onCardBgChange},model:{value:t.cardData.card_bg,callback:function(a){t.$set(t.cardData,"card_bg",a)},expression:"cardData.card_bg"}})],1)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:22}},[e("st-form-item",{staticClass:"page-content-card-introduction mg-t4",attrs:{label:t.$c("member_card")+"介绍"}},[e("st-editor",{model:{value:t.cardData.card_introduction,callback:function(a){t.$set(t.cardData,"card_introduction",a)},expression:"cardData.card_introduction"}})],1)],1)],1),e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{lg:22}},[e("st-form-item",{staticClass:"page-content-card-contents mg-t4",attrs:{label:"备注"}},[e("st-textarea",{staticClass:"page-content-card-textarea",attrs:{maxlength:"500",placeholder:"请输入"},model:{value:t.cardData.card_contents,callback:function(a){t.$set(t.cardData,"card_contents",a)},expression:"cardData.card_contents"}})],1)],1)],1)],1)],1)],1)},i=[],s=e("75fc"),n=(e("456d"),e("28a5"),e("6b54"),e("ac6a"),e("2138")),c=e("c32d"),o=e.n(c),d=e("2527"),l=e("d2d7"),u=e("5c8a"),p=e("3a59"),_=e("31f0"),m=e("c52b"),h=e("5bfd"),f=e("9154"),g=e("716f"),v=e("f0cb"),b=e("0769"),y=e("39fc"),S=e("972a"),C={name:"BrandNumberCardAdd",mixins:[f["a"]],serviceInject:function(){return{pattern:d["a"],addService:_["AddService"],userService:n["a"]}},rxState:function(){return{addLoading:this.addService.loading$,cardBgList:this.addService.cardBgList$,admissionRange:this.addService.admissionRange$,priceSetting:this.addService.priceSetting$,supportSales:this.addService.supportSales$,unit:this.addService.unit$,sellType:this.addService.sellType$,supportMemberNums:this.addService.supportMemberNums$}},bem:{b:"st-help-popover"},components:{StEditor:S["a"],SelectShop:l["a"],MemberCard:m["a"],H5Container:h["a"],CardBgRadio:v["a"]},data:function(){var t=this.$stForm.create(),a=t.decorators(y["a"]);return{form:t,decorators:a,ADMISSION_RANGE:b["b"],SELL_TYPE:b["i"],PRICE_SETTING:b["f"],SUPPORT_SALES:b["k"],UNIT:b["l"],cardType:g["a"].NUMBER_CARD,MEMBER_CARD:g["a"],cardData:{card_type:this.isFamilyCard?b["c"].MORE_NUMBER:b["c"].NUMBER,card_name:"",special_note:"",admission_range:b["b"].ONLY_STORE,admission_shop_list:[],price_setting:b["f"].UNIFORM_PRICE,price_gradient:[],support_sales:b["k"].ALL_STORE,sell_shop_list:[],start_time:"",end_time:"",endOpen:!1,_is_transfer:!1,is_transfer:0,unit:b["l"].RMB,num:void 0,sell_type:[b["i"].OFFLINE],card_bg:{image_id:0,image_key:this.cardBgList[0].image_key,image_url:this.cardBgList[0].image_url,index:1},appConfig:!0,card_introduction:"",card_contents:""},rallyPriceList:[],shopPriceList:[],start_time:null,end_time:null,unit_list:[{value:2,label:"天"},{value:3,label:"月"},{value:4,label:"年"}],priceValidatorText:"",cardBgValidatorText:""}},mounted:function(){this.syncAdmission()},methods:{onHandleSubmit:function(t){var a=this;t.preventDefault(),this.priceValidator(this.cardData.price_setting),this.cardBgValidator(),this.form.validateFieldsAndScroll((function(t,e){if(!t&&a.priceIsOk&&a.cardBgIsOk){a.cardData.admission_range!==b["b"].GENERAL_STORE&&(a.cardData.admission_shop_list=[]),a.cardData.support_sales!==b["k"].SPECIFIED_STORE&&(a.cardData.sell_shop_list=[]),a.cardData.admission_range===b["b"].GENERAL_STORE&&a.cardData.support_sales===b["k"].ENTRY_STORE&&(a.cardData.sell_shop_list=Object(u["a"])(a.cardData.admission_shop_list));var r=[];switch(a.cardData.price_setting){case b["f"].UNIFORM_PRICE:a.rallyPriceList.forEach((function(t){r.push({unit:+t.time.unit,num:+t.time.num,rally_price:+t.rally_price,frozen_day:+t.frozen_day,validity_times:+t.validity_times,gift_unit:+t.gift_unit})}));break;case b["f"].SHOP_PRICE:a.shopPriceList.forEach((function(t){r.push({unit:+t.time.unit,num:+t.time.num,min_price:+t.rally_price.min_price,max_price:+t.rally_price.max_price,frozen_day:+t.frozen_day,validity_times:+t.validity_times,gift_unit:+t.gift_unit})}));break}a.cardData.card_name=e.cardData.card_name,a.cardData.special_note=e.cardData.special_note,a.cardData.price_gradient=Object(u["a"])(r),a.cardData.start_time="".concat(a.start_time.format("YYYY-MM-DD")),a.cardData.end_time="".concat(a.end_time.format("YYYY-MM-DD")),a.cardData.num=a.cardData._is_transfer?+e.cardData.num:void 0,a.isFamilyCard?(a.cardData.support_member_num=e.cardData.support_member_num,a.cardData.card_type=b["c"].MORE_NUMBER):(a.cardData.support_member_num=1,a.cardData.card_type=b["c"].NUMBER),a.addService.addCard(a.cardData).subscribe((function(t){a.$router.push({name:"brand-product-card-member-list-all"})}))}}))},admission_range_change:function(t){this.cardData.admission_shop_list=Object(u["a"])(t),this.syncAdmissionShop()},admission_range:function(t){this.cardData.admission_range=t.target.value,this.form.setFieldsValue({"cardData.support_sales":b["k"].ALL_STORE,"cardData.price_setting":b["f"].UNIFORM_PRICE}),this.cardData.support_sales=b["k"].ALL_STORE,this.cardData.price_setting=b["f"].UNIFORM_PRICE,this.rallyPriceList=[],this.shopPriceList=[],this.priceValidatorText="",this.syncAdmission()},price_range:function(t){this.cardData.price_setting=t.target.value},brand_price_add:function(){var t=parseInt(999999*Math.random()).toString();this.rallyPriceList.push({key:t,validity_times:null,time:{unit:2,num:null},rally_price:null,frozen_day:null,gift_unit:null})},brand_price_delete:function(t){this.rallyPriceList.splice(t,1)},brandPriceSettingHandleChange:function(t){var a=t.value,e=t.key,r=t.col,i=t.prop;void 0!==i?this.rallyPriceList[e][r][i]=a:this.rallyPriceList[e][r]=a},shop_price_add:function(){var t=parseInt(999999*Math.random()).toString();this.shopPriceList.push({key:t,validity_times:null,time:{unit:2,num:null},rally_price:{min_price:null,max_price:null},frozen_day:null,gift_unit:null})},shop_price_delete:function(t){this.shopPriceList.splice(t,1)},shopPriceSettingHandleChange:function(t){var a=t.value,e=t.key,r=t.col,i=t.prop;void 0!==i?this.shopPriceList[e][r][i]=a:this.shopPriceList[e][r]=a},support_range:function(t){this.cardData.support_sales=t.target.value},sales_shop_change:function(t){this.cardData.sell_shop_list=Object(u["a"])(t)},start_time_change:function(t){this.start_time=Object(u["a"])(t)},handleStartOpenChange:function(t){t||(this.cardData.endOpen=!0)},disabledStartDate:function(t){var a=this.end_time;if(!a)return t.valueOf()<o()().startOf("day").valueOf();var e=a.valueOf()>o()().add(30,"y").valueOf()?o()(a).subtract(30,"y").valueOf():o()().startOf("day").valueOf();return t.valueOf()<e||t.valueOf()>o()(a).valueOf()},end_time_change:function(t){this.end_time=Object(u["a"])(t)},handleEndOpenChange:function(t){this.cardData.endOpen=t},disabledEndDate:function(t){var a=this.start_time;return a&&(t.valueOf()>=o()(a).add(30,"y").valueOf()||t.valueOf()<o()(a).valueOf())||t.valueOf()<o()().startOf("day").valueOf()},moment:o.a,transfer:function(t){this.cardData._is_transfer=t.target.checked,this.form.resetFields(["cardData.num"])},priceValidator:function(t){var a=this,e=t===b["f"].UNIFORM_PRICE?"brandPriceValidataArray":"shopPriceValidataArray",r=!!this[e].length&&this[e].every((function(t){return a.pattern.NUM_FLOAT(1).test(t.split("-")[1])}));this.priceValidatorText=r?"":"请输入正确的价格"},onCardBgChange:function(t){this.cardBgValidatorText=""},cardBgValidator:function(){var t=""!==this.cardData.card_bg.image_key;this.cardBgValidatorText=t?"":"请上传卡背景"}},watch:{"cardData._is_transfer":{deep:!0,handler:function(t,a){this.cardData.is_transfer=+t}},"cardData.unit":{deep:!0,handler:function(){this.form.resetFields(["cardData.num"])}},"cardData.admission_shop_list":{deep:!0,handler:function(){var t=this.cardData.admission_range;this.cardData.admission_range=t,this.form.setFieldsValue({"cardData.admission_range":t})}},"cardData.sell_shop_list":{deep:!0,handler:function(){var t=this.cardData.support_sales;this.cardData.support_sales=t,this.form.setFieldsValue({"cardData.support_sales":t})}}},computed:{support_sales_list:function(){var t=Object(u["a"])(this.supportSales),a=this.cardData.admission_range===b["b"].GENERAL_STORE?999:2;return t.splice(a,1),t},sell_type_list:function(){var t=Object(u["a"])(this.sellType),a=[];return t.forEach((function(t){a.push({value:t.value,label:t.label})})),this.cardData.appConfig||Object(p["a"])(a,(function(t){return t.value===b["i"].CLIENT})),a},brandPriceValidataArray:function(){var t=[];return this.rallyPriceList.forEach((function(a){Object.keys(a).forEach((function(e){t.push("time"===e?"time-".concat(a.time.num):"".concat(e,"-").concat(a[e]))}))})),t},shopPriceValidataArray:function(){var t=[];return this.shopPriceList.forEach((function(a){Object.keys(a).forEach((function(e){var r=[];r="time"===e?["time-".concat(a.time.num)]:"rally_price"===e?["min_price-".concat(a.rally_price.min_price),"max_price-".concat(a.rally_price.max_price)]:["".concat(e,"-").concat(a[e])],t.push.apply(t,Object(s["a"])(r))}))})),t},priceIsOk:function(){return""===this.priceValidatorText},cardBgIsOk:function(){return""===this.cardBgValidatorText},transferMin:function(){return 0},transferMax:function(){return this.cardData.unit===b["l"].PERCENT?100:999999.9},isFamilyCard:function(){return"family-card"===this.$searchQuery.type}}},D=C,O=e("2877"),I=Object(O["a"])(D,r,i,!1,null,null,null);a["default"]=I.exports}}]);