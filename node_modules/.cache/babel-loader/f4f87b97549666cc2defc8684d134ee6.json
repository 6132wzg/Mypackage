{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/components#/event.component.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/components#/event.component.vue","mtime":1600926382328},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue';\nimport { H5WrapperService } from '@/views/pages/brand/setting/mina/components#/h5/h5-wrapper.service';\nimport { cloneDeep } from 'lodash-es';\nimport { ActivityService } from \"../activity.service\";\nimport { Tree } from '@/utils/tree';\nexport default {\n  bem: {\n    event: 'activity-event-component'\n  },\n  components: {\n    StImageUpload: StImageUpload\n  },\n  serviceInject: function serviceInject() {\n    return {\n      h5WrapperService: H5WrapperService,\n      activityService: ActivityService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      eventInfo: this.h5WrapperService.eventInfo$,\n      activityList: this.activityService.actList$\n    };\n  },\n  data: function data() {\n    return {\n      info: {},\n      list: {\n        1: [],\n        2: [],\n        3: [],\n        4: []\n      },\n      actList: [],\n      selected: [],\n      filelist: [],\n      link: '',\n      number: 0,\n      span: 24\n    };\n  },\n  created: function created() {\n    this.initList();\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    var actList = cloneDeep(this.activityList.list);\n\n    if (this.eventInfo && this.eventInfo.length) {\n      var number = this.eventInfo.length;\n      this.number = number;\n      this.list[number] = cloneDeep(this.eventInfo);\n      this.list[number].forEach(function (item) {\n        item.activity_id = [item.activity_type, item.activity_id];\n        var tree = new Tree(actList, {\n          name: 'activity_name'\n        });\n\n        if (_this.number && !tree.findNodeById(item.activity_id[1])) {\n          // 找到对应的父节点\n          var node = actList.filter(function (act) {\n            return act.id === item.activity_type;\n          })[0] || {};\n          console.log(node, 'event====node');\n\n          if (item.activity_type === 5 && node.children) {\n            node.children.push({\n              activity_name: item.activity_name,\n              activity_type: item.activity_type,\n              id: item.activity_id[1],\n              isover: true,\n              product_type: item.product_type,\n              product_template_id: item.product_template_id\n            });\n          } else if (node.children) {\n            node.children.push({\n              activity_name: item.activity_name,\n              activity_type: item.activity_type,\n              id: item.activity_id[1],\n              isover: true\n            });\n          }\n        }\n      });\n    } else {\n      this.number = 0;\n      actList = cloneDeep(this.activityList.list);\n    }\n\n    actList.forEach(function (item) {\n      if (!item.children.length) {\n        item.disabled = true;\n      }\n    });\n    this.actList = cloneDeep(actList);\n    console.log(this.actList, actList, 'eventList');\n  },\n  watch: {\n    list: {\n      deep: true,\n      handler: function handler(newVal) {\n        var number = this.number;\n        this.h5WrapperService.SET_H5INFO(newVal[number], 3);\n      }\n    },\n    number: function number(newValue) {\n      this.h5WrapperService.SET_H5INFO(this.list[newValue], 3);\n    }\n  },\n  methods: {\n    initList: function initList() {\n      var list = {\n        1: [],\n        2: [],\n        3: [],\n        4: []\n      };\n      list[1].push({\n        image_url: '',\n        title: '',\n        link: '',\n        span: 24\n      });\n\n      for (var i = 0; i < 2; i++) {\n        list[2].push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 12\n        });\n      }\n\n      for (var _i = 0; _i < 3; _i++) {\n        if (_i === 2) {\n          list[3].push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 24\n          });\n        } else {\n          list[3].push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 12\n          });\n        }\n      }\n\n      for (var _i2 = 0; _i2 < 4; _i2++) {\n        list[4].push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 12\n        });\n      }\n\n      this.list = list;\n    },\n    onActChange: function onActChange(item, value) {\n      console.log('vlaue', value);\n      item.activity_type = value[1][1].activity_type;\n      item.activity_name = value[1][1].activity_name;\n\n      if (value[1][0].id === 5) {\n        item.product_type = value[1][1].product_type;\n        item.product_template_id = value[1][1].product_template_id;\n      } // const selecttedParent = this.actList.filter(ite => ite.id === value[0])[0]\n      // const selected = selecttedParent.children.filter(\n      //   it => it.id === value[1]\n      // )[0]\n      // item.activity_type = selected.activity_type\n      // item.activity_name = selected.activity_name\n      // if (selected.activity_type === 5) {\n      //   item.product_type = selected.product_type\n      //   item.product_template_id = selected.product_template_id\n      // }\n\n    },\n    imageUploadChange: function imageUploadChange(e, index) {\n      if (e.length) {\n        var number = this.number;\n        this.list[number][index].image_url = e[0].image_url;\n        this.list[number][index].image_key = e[0].image_key;\n      }\n    },\n    numberChange: function numberChange(e) {\n      var num = e.target.value;\n      var list = [];\n\n      if (num === 1) {\n        list.push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 24\n        });\n      } else if (num === 2 || num === 4) {\n        for (var i = 0; i < num; i++) {\n          list.push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 12\n          });\n        }\n      } else if (num === 3) {\n        for (var _i3 = 0; _i3 < num; _i3++) {\n          if (_i3 === 2) {\n            list.push({\n              image_url: '',\n              title: '',\n              link: '',\n              span: 24\n            });\n          } else {\n            list.push({\n              image_url: '',\n              title: '',\n              link: '',\n              span: 12\n            });\n          }\n        }\n      }\n\n      this.list = list;\n    },\n    calImgSize: function calImgSize(li) {\n      var w = li.span === 24 ? 670 : 327;\n      var h = 120;\n      return {\n        w: w,\n        h: h\n      };\n    },\n    generateFilteroptions: function generateFilteroptions(li) {\n      return this.calImgSize(li);\n    },\n    generateCropperOptions: function generateCropperOptions(li) {\n      var _this$calImgSize = this.calImgSize(li),\n          w = _this$calImgSize.w,\n          h = _this$calImgSize.h;\n\n      return {\n        title: '活动图片裁剪',\n        cropper: {\n          aspectRatio: w / h\n        }\n      };\n    }\n  }\n};",{"version":3,"sources":["event.component.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div :class=\"event()\">\n    <st-form labelWidth=\"71px\">\n      <st-form-item label=\"推广活动数\" :class=\"event('activity-wrapper')\">\n        <a-radio-group v-model=\"number\">\n          <a-radio :value=\"1\">1</a-radio>\n          <a-radio :value=\"2\">2</a-radio>\n          <a-radio :value=\"3\">3</a-radio>\n          <a-radio :value=\"4\">4</a-radio>\n        </a-radio-group>\n      </st-form-item>\n      <st-form-item label=\"活动展示\" :class=\"event('activity-show-title')\">\n        <div\n          v-for=\"(li, index) in list[number]\"\n          :key=\"index\"\n          :class=\"['col-' + li.span, { 'clear-float': index === 2 }]\"\n        >\n          <div :class=\"event('box')\">\n            <st-image-upload\n              @change=\"imageUploadChange($event, index)\"\n              width=\"100%\"\n              height=\"85px\"\n              :filterOptions=\"generateFilteroptions(li)\"\n              :list=\"li.image_url ? [li] : li.filelist\"\n              :sizeLimit=\"5\"\n              placeholder=\"添加活动图片\"\n              :numLimit=\"1\"\n              :cropperModal=\"generateCropperOptions(li)\"\n            >\n              <a-icon\n                type=\"plus-circle\"\n                theme=\"filled\"\n                :style=\"{\n                  fontSize: '24px',\n                  verticalAlign: 'super',\n                  marginRight: '8px',\n                  color: '#9BACB9'\n                }\"\n              />\n              <div :class=\"event('uploadtip-wrap')\">\n                <div class=\"st-image-upload__placeholder\">添加活动图片</div>\n                <span :class=\"event('uploadtip')\">\n                  {{\n                    li.span === 24\n                      ? '大小不超过5M，建议尺寸670*120'\n                      : '建议尺寸327*120'\n                  }}\n                </span>\n              </div>\n            </st-image-upload>\n            <div class=\"st-form-item-wrapper\">\n              <st-form-item labelWidth=\"46px\" label=\"标题\">\n                <a-input\n                  placeholder=\"选填\"\n                  v-model=\"li.module_name\"\n                  maxlength=\"20\"\n                ></a-input>\n              </st-form-item>\n              <st-form-item labelWidth=\"46px\" label=\"链接\">\n                <a-cascader\n                  :options=\"actList\"\n                  :allowClear=\"false\"\n                  v-model=\"li.activity_id\"\n                  placeholder=\"请输入链接的活动\"\n                  :fieldNames=\"{\n                    label: 'activity_name',\n                    value: 'id',\n                    children: 'children'\n                  }\"\n                  @change=\"onActChange(li, arguments)\"\n                />\n              </st-form-item>\n            </div>\n          </div>\n        </div>\n      </st-form-item>\n    </st-form>\n  </div>\n</template>\n<script>\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue'\nimport { H5WrapperService } from '@/views/pages/brand/setting/mina/components#/h5/h5-wrapper.service'\nimport { cloneDeep } from 'lodash-es'\nimport { ActivityService } from '../activity.service'\nimport { Tree } from '@/utils/tree'\nexport default {\n  bem: {\n    event: 'activity-event-component'\n  },\n  components: {\n    StImageUpload\n  },\n  serviceInject() {\n    return {\n      h5WrapperService: H5WrapperService,\n      activityService: ActivityService\n    }\n  },\n  rxState() {\n    return {\n      eventInfo: this.h5WrapperService.eventInfo$,\n      activityList: this.activityService.actList$\n    }\n  },\n  data() {\n    return {\n      info: {},\n      list: {\n        1: [],\n        2: [],\n        3: [],\n        4: []\n      },\n      actList: [],\n      selected: [],\n      filelist: [],\n      link: '',\n      number: 0,\n      span: 24\n    }\n  },\n  created() {\n    this.initList()\n  },\n  mounted() {\n    let actList = cloneDeep(this.activityList.list)\n    if (this.eventInfo && this.eventInfo.length) {\n      let number = this.eventInfo.length\n      this.number = number\n      this.list[number] = cloneDeep(this.eventInfo)\n      this.list[number].forEach(item => {\n        item.activity_id = [item.activity_type, item.activity_id]\n        const tree = new Tree(actList, { name: 'activity_name' })\n        if (this.number && !tree.findNodeById(item.activity_id[1])) {\n          // 找到对应的父节点\n          const node =\n            actList.filter(act => act.id === item.activity_type)[0] || {}\n          console.log(node, 'event====node')\n          if (item.activity_type === 5 && node.children) {\n            node.children.push({\n              activity_name: item.activity_name,\n              activity_type: item.activity_type,\n              id: item.activity_id[1],\n              isover: true,\n              product_type: item.product_type,\n              product_template_id: item.product_template_id\n            })\n          } else if (node.children) {\n            node.children.push({\n              activity_name: item.activity_name,\n              activity_type: item.activity_type,\n              id: item.activity_id[1],\n              isover: true\n            })\n          }\n        }\n      })\n    } else {\n      this.number = 0\n      actList = cloneDeep(this.activityList.list)\n    }\n    actList.forEach(item => {\n      if (!item.children.length) {\n        item.disabled = true\n      }\n    })\n    this.actList = cloneDeep(actList)\n    console.log(this.actList, actList, 'eventList')\n  },\n  watch: {\n    list: {\n      deep: true,\n      handler(newVal) {\n        let number = this.number\n        this.h5WrapperService.SET_H5INFO(newVal[number], 3)\n      }\n    },\n    number(newValue) {\n      this.h5WrapperService.SET_H5INFO(this.list[newValue], 3)\n    }\n  },\n  methods: {\n    initList() {\n      let list = {\n        1: [],\n        2: [],\n        3: [],\n        4: []\n      }\n      list[1].push({\n        image_url: '',\n        title: '',\n        link: '',\n        span: 24\n      })\n      for (let i = 0; i < 2; i++) {\n        list[2].push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 12\n        })\n      }\n      for (let i = 0; i < 3; i++) {\n        if (i === 2) {\n          list[3].push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 24\n          })\n        } else {\n          list[3].push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 12\n          })\n        }\n      }\n      for (let i = 0; i < 4; i++) {\n        list[4].push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 12\n        })\n      }\n      this.list = list\n    },\n    onActChange(item, value) {\n      console.log('vlaue', value)\n      item.activity_type = value[1][1].activity_type\n      item.activity_name = value[1][1].activity_name\n      if (value[1][0].id === 5) {\n        item.product_type = value[1][1].product_type\n        item.product_template_id = value[1][1].product_template_id\n      }\n      // const selecttedParent = this.actList.filter(ite => ite.id === value[0])[0]\n      // const selected = selecttedParent.children.filter(\n      //   it => it.id === value[1]\n      // )[0]\n      // item.activity_type = selected.activity_type\n      // item.activity_name = selected.activity_name\n      // if (selected.activity_type === 5) {\n      //   item.product_type = selected.product_type\n      //   item.product_template_id = selected.product_template_id\n      // }\n    },\n    imageUploadChange(e, index) {\n      if (e.length) {\n        let number = this.number\n        this.list[number][index].image_url = e[0].image_url\n        this.list[number][index].image_key = e[0].image_key\n      }\n    },\n    numberChange(e) {\n      let num = e.target.value\n      let list = []\n      if (num === 1) {\n        list.push({\n          image_url: '',\n          title: '',\n          link: '',\n          span: 24\n        })\n      } else if (num === 2 || num === 4) {\n        for (let i = 0; i < num; i++) {\n          list.push({\n            image_url: '',\n            title: '',\n            link: '',\n            span: 12\n          })\n        }\n      } else if (num === 3) {\n        for (let i = 0; i < num; i++) {\n          if (i === 2) {\n            list.push({\n              image_url: '',\n              title: '',\n              link: '',\n              span: 24\n            })\n          } else {\n            list.push({\n              image_url: '',\n              title: '',\n              link: '',\n              span: 12\n            })\n          }\n        }\n      }\n      this.list = list\n    },\n    calImgSize(li) {\n      const w = li.span === 24 ? 670 : 327\n      const h = 120\n      return {\n        w,\n        h\n      }\n    },\n    generateFilteroptions(li) {\n      return this.calImgSize(li)\n    },\n    generateCropperOptions(li) {\n      const { w, h } = this.calImgSize(li)\n      return {\n        title: '活动图片裁剪',\n        cropper: { aspectRatio: w / h }\n      }\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/brand/marketing/components#"}]}