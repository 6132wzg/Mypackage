{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/member/list/studio.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/member/list/studio.vue","mtime":1600926556370},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport { cloneDeep, filter, last } from 'lodash-es';\nimport { UserService } from '@/services/user.service';\nimport { StudioService } from \"./studio.service\";\nimport tableMixin from '@/mixins/table.mixin';\nimport { columns } from \"./studio.config\";\nimport ShopAddLable from '@/views/biz-modals/shop/add-lable';\nimport ShopBindingEntityCard from '@/views/biz-modals/shop/binding-entity-card';\nimport ShopDistributionCoach from '@/views/biz-modals/shop/distribution-coach';\nimport ShopDistributionSale from '@/views/biz-modals/shop/distribution-sale';\nimport ShopChangeUserType from '@/views/biz-modals/shop/change-user-type';\nimport ShopFrozen from '@/views/biz-modals/shop/frozen';\nimport ShopMissingCard from '@/views/biz-modals/shop/missing-card';\nimport PointsAddOrMinus from '@/views/biz-modals/brand/marketing/points/add-or-minus';\nimport { SEX } from '@/constants/member/info';\nimport { findPathWithTree } from '@/utils/find-path-with-tree';\nexport default {\n  name: 'ShopMemberListStudio',\n  mixins: [tableMixin],\n  modals: {\n    ShopAddLable: ShopAddLable,\n    ShopBindingEntityCard: ShopBindingEntityCard,\n    ShopDistributionCoach: ShopDistributionCoach,\n    ShopDistributionSale: ShopDistributionSale,\n    ShopFrozen: ShopFrozen,\n    ShopMissingCard: ShopMissingCard,\n    ShopChangeUserType: ShopChangeUserType,\n    PointsAddOrMinus: PointsAddOrMinus\n  },\n  serviceInject: function serviceInject() {\n    return {\n      studioService: StudioService,\n      userService: UserService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.studioService.loading$,\n      auth: this.studioService.auth$,\n      list: this.studioService.list$,\n      page: this.studioService.page$,\n      memberLevel: this.studioService.memberLevel$,\n      buyPersonalCourseList: this.studioService.buyPersonalCourse$,\n      saleList: this.studioService.saleList$,\n      coachList: this.studioService.coachList$,\n      labelList: this.studioService.labelLsit$\n    };\n  },\n  data: function data() {\n    return {\n      expand: false,\n      sourceRegisterList: [],\n      consumption: [],\n      selectDataList: [],\n      selectedRowKeys: [],\n      selectedRows: [],\n      SEX: SEX,\n      memberLevelOptions: [],\n      member_level: []\n    };\n  },\n  computed: {\n    columns: columns,\n    conditions: function conditions() {\n      var conditions = _objectSpread({}, this.$searchQuery, {\n        search: this.$searchQuery.keyword\n      });\n\n      return conditions;\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    this.sourceRegisters();\n    this.memberLevel.forEach(function (level) {\n      var obj = {\n        id: level.level_type,\n        name: level.level_name\n      };\n\n      if (!!level.level_condition.length) {\n        obj['children'] = [];\n        level.level_condition.forEach(function (item) {\n          obj.children.push({\n            id: item.id,\n            name: item.condition_name\n          });\n        });\n      }\n\n      _this.memberLevelOptions.push(obj);\n    });\n    this.setSearchData();\n  },\n  watch: {\n    $searchQuery: function $searchQuery(newVal) {\n      this.setSearchData();\n    }\n  },\n  methods: {\n    refeshPage: function refeshPage() {\n      this.selectedRowKeys = [];\n      this.$router.reload();\n    },\n    sourceRegisters: function sourceRegisters() {\n      var _this2 = this;\n\n      this.studioService.getMemberSourceRegisters().subscribe(function (status) {\n        _this2.sourceRegisterList = status;\n      });\n    },\n    setSearchData: function setSearchData() {\n      var memberLevel = [];\n\n      if (this.$searchQuery.member_level) {\n        memberLevel.push(this.$searchQuery.member_level);\n\n        if (this.$searchQuery.member_level_condition) {\n          memberLevel.push(this.$searchQuery.member_level_condition);\n        }\n      }\n\n      this.member_level = memberLevel;\n    },\n    // 分配教练\n    onDistributionCoach: function onDistributionCoach(record) {\n      var _this3 = this;\n\n      this.$modalRouter.push({\n        name: 'shop-distribution-coach',\n        props: {\n          memberIds: [record.member_id],\n          coachId: record.follow_coach_id\n        },\n        on: {\n          success: function success() {\n            _this3.refeshPage();\n          }\n        }\n      });\n    },\n    // 分配销售\n    onDistributionSale: function onDistributionSale(record) {\n      var _this4 = this;\n\n      this.$modalRouter.push({\n        name: 'shop-distribution-sale',\n        props: {\n          memberIds: [record.member_id],\n          saleId: record.follow_salesman_id\n        },\n        on: {\n          success: function success() {\n            _this4.refeshPage();\n          }\n        }\n      });\n    },\n    onRemoveBind: function onRemoveBind(record) {\n      var _this5 = this;\n\n      this.$confirm({\n        title: '提示信息',\n        content: \"\\u786E\\u8BA4\\u89E3\\u7ED1 \".concat(record.member_name, \" \\u4F1A\\u5458\\u7684\\u5FAE\\u4FE1\\u7ED1\\u5B9A\\u5173\\u7CFB\\uFF1F\"),\n        onOk: function onOk() {\n          _this5.studioService.removeWechatBind(record.member_id).subscribe(function () {\n            _this5.refeshPage();\n          });\n        },\n        onCancel: function onCancel() {}\n      });\n    },\n    onChangeUserType: function onChangeUserType(record) {\n      var _this6 = this;\n\n      this.$modalRouter.push({\n        name: 'shop-change-user-type',\n        props: {\n          info: record\n        },\n        on: {\n          success: function success() {\n            _this6.refeshPage();\n          }\n        }\n      });\n    },\n    // 增加、扣减积分\n    onAddOrDelIntegral: function onAddOrDelIntegral(type) {\n      var _this7 = this;\n\n      this.$modalRouter.push({\n        name: 'points-add-or-minus',\n        props: {\n          type: type,\n          query: {\n            memberName: this.info.member_name,\n            memberId: this.$searchQuery.id\n          }\n        },\n        on: {\n          done: function done() {\n            _this7.$router.reload();\n          }\n        }\n      });\n    },\n    // 清空指纹信息\n    onClearFingerprintInfo: function onClearFingerprintInfo(record) {\n      var _this8 = this;\n\n      this.$confirm({\n        title: '提示信息',\n        content: '确认清空指纹信息？',\n        onOk: function onOk() {\n          _this8.studioService.deleteMemberFinger(record.member_id).subscribe();\n        }\n      });\n    },\n    // 清空硬件密码\n    onClearHardwarePassword: function onClearHardwarePassword(record) {\n      var _this9 = this;\n\n      this.$confirm({\n        title: '提示信息',\n        content: '确认清空硬件密码吗？',\n        onOk: function onOk() {\n          _this9.studioService.deleteMemberCabinetPassword(record.member_id).subscribe();\n        }\n      });\n    },\n    changeLevel: function changeLevel(ids) {\n      ;\n      this.$searchQuery.member_level = ids[0], this.$searchQuery.member_level_condition = ids[1];\n    },\n    edit: function edit(record) {\n      this.$router.push({\n        name: 'shop-member-edit',\n        query: {\n          id: record.member_id\n        }\n      });\n    },\n    addUser: function addUser() {\n      this.$router.push({\n        name: 'shop-member-add'\n      });\n    },\n    infoFunc: function infoFunc(record) {\n      this.$router.push({\n        name: 'shop-member-info-basic',\n        query: {\n          id: record.member_id\n        }\n      });\n    },\n    moment: moment,\n    handleReset: function handleReset() {\n      var self = this;\n\n      for (var prop in self.form) {\n        self.form[prop] = '';\n      }\n\n      this.$refs.stSeleter.handleResetItem();\n      this.consumption = [];\n      this.$router.push({\n        query: {}\n      });\n    },\n    toggle: function toggle() {\n      this.expand = !this.expand;\n    },\n    onSelectionReset: function onSelectionReset() {\n      this.selectedRowKeys = [];\n      this.selectedRows = [];\n    },\n    onSelectionChange: function onSelectionChange(keys, selectedRows) {\n      this.selectedRowKeys = keys;\n      this.selectedRows = selectedRows;\n      this.selectDataList = selectedRows.map(function (item) {\n        return item.id;\n      });\n    },\n    $searchQueryFunc: function $searchQueryFunc() {\n      this.$router.push({\n        query: this.form\n      });\n    },\n    toCrowd: function toCrowd() {\n      this.$router.push({\n        name: 'shop-member-crowd-index'\n      });\n    }\n  }\n};",{"version":3,"sources":["studio.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-panel app class=\"shop-member-list\">\n    <div slot=\"title\">\n      <st-input-search\n        placeholder=\"输入手机号、姓名、卡号进行搜索\"\n        v-model=\"$searchQuery.keyword\"\n        @search=\"onKeywordsSearch('keyword', $event)\"\n      />\n    </div>\n    <div slot=\"prepend\">\n      <st-search-panel @search=\"onSearch\" @reset=\"onSearchReset\">\n        <st-search-panel-item label=\"用户级别:\">\n          <template slot=\"label\">\n            <st-help-tooltip id=\"TSUL006\" />\n          </template>\n          <a-cascader\n            changeOnSelect\n            v-model=\"member_level\"\n            placeholder=\"请选择用户级别\"\n            :fieldNames=\"{ label: 'name', value: 'id', children: 'children' }\"\n            :options=\"memberLevelOptions\"\n            @change=\"changeLevel\"\n          ></a-cascader>\n        </st-search-panel-item>\n        <st-search-panel-item label=\"用户标签：\">\n          <a-select\n            class=\" select\"\n            v-model=\"$searchQuery.tag_id\"\n            placeholder=\"请选择标签\"\n          >\n            <a-select-option\n              v-for=\"(item, index) in labelList\"\n              :key=\"index\"\n              :value=\"item.id\"\n            >\n              {{ item.tag_name }}\n            </a-select-option>\n          </a-select>\n        </st-search-panel-item>\n        <st-search-panel-item label=\"是否购买私教课：\">\n          <st-search-radio\n            v-model=\"$searchQuery.buy_personal_course\"\n            :options=\"buyPersonalCourseList\"\n          />\n        </st-search-panel-item>\n        <div slot=\"more\">\n          <st-search-panel-item label=\"跟进销售：\">\n            <a-select\n              class=\"mg-r40 select\"\n              v-model=\"$searchQuery.follow_salesman_id\"\n              placeholder=\"请选择销售\"\n            >\n              <a-select-option\n                v-for=\"(item, index) in saleList\"\n                :key=\"index\"\n                :value=\"item.id\"\n              >\n                {{ item.sale_name }}\n              </a-select-option>\n            </a-select>\n          </st-search-panel-item>\n          <st-search-panel-item :label=\"`跟进${$c('coach')}：`\">\n            <a-select\n              class=\" select\"\n              v-model=\"$searchQuery.follow_coach_id\"\n              :placeholder=\"`请选择${$c('coach')}`\"\n            >\n              <a-select-option\n                v-for=\"(item, index) in coachList\"\n                :key=\"index\"\n                :value=\"item.id\"\n              >\n                {{ item.coach_name }}\n              </a-select-option>\n            </a-select>\n          </st-search-panel-item>\n        </div>\n      </st-search-panel>\n    </div>\n    <div class=\"mg-t24 mg-b16\">\n      <st-button\n        type=\"primary\"\n        @click=\"addUser()\"\n        class=\"shop-member-list-button\"\n        v-if=\"auth.add\"\n        icon=\"add\"\n      >\n        新增用户\n      </st-button>\n      <st-button\n        v-if=\"auth.export\"\n        type=\"primary\"\n        class=\"mg-r8\"\n        v-export-excel=\"{\n          type: 'studio_member',\n          query: { conditions: conditions }\n        }\"\n      >\n        全部导出\n      </st-button>\n      <!-- NOTE: 导入 -->\n      <!-- <st-button class=\"shop-member-list-button\" v-if=\"auth.import\">导入用户</st-button> -->\n      <st-button\n        v-if=\"auth.tag\"\n        class=\"shop-member-list-button\"\n        :disabled=\"!selectedRowKeys.length\"\n        v-modal-link=\"{\n          name: 'shop-add-lable',\n          props: {\n            memberIds: selectedRowKeys\n          },\n          on: { success: refeshPage }\n        }\"\n      >\n        加标签\n      </st-button>\n      <a-popover placement=\"bottom\">\n        <template slot=\"content\">\n          <div v-if=\"auth.bindCoach\" class=\"shop-member-list-button-div\">\n            <label\n              class=\"shop-member-list-button-label\"\n              v-modal-link=\"{\n                name: 'shop-distribution-coach',\n                props: {\n                  memberIds: selectedRowKeys\n                },\n                on: { success: refeshPage }\n              }\"\n            >\n              分配{{ $c('coach') }}\n            </label>\n          </div>\n          <div v-if=\"auth.bindSalesman\" class=\"shop-member-list-button-div\">\n            <label\n              class=\"shop-member-list-button-label\"\n              v-modal-link=\"{\n                name: 'shop-distribution-sale',\n                props: {\n                  memberIds: selectedRowKeys\n                },\n                on: { success: refeshPage }\n              }\"\n            >\n              分配销售\n            </label>\n          </div>\n        </template>\n        <st-button\n          v-if=\"auth.bindCoach && auth.bindSalesman\"\n          class=\"shop-member-list-button\"\n          :disabled=\"selectedRowKeys.length > 0 ? false : true\"\n        >\n          分配员工\n        </st-button>\n      </a-popover>\n      <!-- NOTE: 导出 -->\n    </div>\n    <st-table\n      :columns=\"columns\"\n      :loading=\"loading.getListInfo\"\n      :scroll=\"{ x: 1400 }\"\n      :alertSelection=\"{ onReset: onSelectionReset }\"\n      :rowSelection=\"{ selectedRowKeys, onChange: onSelectionChange }\"\n      rowKey=\"member_id\"\n      :page=\"page\"\n      @change=\"onTableChange\"\n      :dataSource=\"list\"\n    >\n      <div slot=\"image_face\" slot-scope=\"text, record\">\n        <span class=\"st-preview-item st-preview-item--cover\" v-viewer>\n          <img\n            v-if=\"record.image_face\"\n            class=\"st-image-face\"\n            :src=\"record.image_face.url\"\n            :data-src=\"record.image_face.url\"\n          />\n        </span>\n      </div>\n      <div slot=\"member_name\" slot-scope=\"text, record\">\n        <a\n          href=\"javascript:;\"\n          v-if=\"record.auth['shop:member:member|get']\"\n          @click=\"infoFunc(record)\"\n        >\n          <st-overflow-text :value=\"text\" maxWidth=\"100px\"></st-overflow-text>\n        </a>\n        <span v-else>\n          <st-overflow-text :value=\"text\" maxWidth=\"100px\"></st-overflow-text>\n        </span>\n        <st-icon\n          v-if=\"record.is_minors\"\n          type=\"user-type\"\n          class=\"mg-l4\"\n          :color=\"record.sex === SEX.GIRL ? '#FF5E41' : '#3F66F6'\"\n        />\n      </div>\n      <div slot=\"action\" slot-scope=\"text, record\">\n        <st-table-actions>\n          <a\n            v-if=\"record.auth['shop:member:member|get']\"\n            @click=\"infoFunc(record)\"\n          >\n            详情\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|edit']\"\n            @click=\"edit(record)\"\n          >\n            编辑\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|bind_coach']\"\n            @click=\"onDistributionCoach(record)\"\n          >\n            绑定{{ $c('coach') }}\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|change_coach']\"\n            @click=\"onDistributionCoach(record)\"\n          >\n            分配{{ $c('coach') }}\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|bind_salesman']\"\n            @click=\"onDistributionSale(record)\"\n          >\n            绑定销售\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|change_salesman']\"\n            @click=\"onDistributionSale(record)\"\n          >\n            分配销售\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|bind_card']\"\n            v-modal-link=\"{\n              name: 'shop-binding-entity-card',\n              props: { record },\n              on: {\n                success: refeshPage\n              }\n            }\"\n          >\n            绑实体卡\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|rebind_card']\"\n            v-modal-link=\"{ name: 'shop-missing-card', props: { record } }\"\n          >\n            重绑实体卡\n          </a>\n          <!-- <a v-if=\"record.auth['shop:member:member|transfer']\" v-modal-link=\"{ name: 'shop-transfer-shop', props:{record}, on: {\n                 success: refeshPage\n               } }\">转店</a> -->\n          <a\n            v-if=\"record.auth['shop:member:member|frozen']\"\n            v-modal-link=\"{\n              name: 'shop-frozen',\n              props: { record },\n              on: {\n                success: refeshPage\n              }\n            }\"\n          >\n            冻结用户\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|unbind_wechat']\"\n            @click=\"onRemoveBind(record)\"\n          >\n            解除微信绑定\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|change_type']\"\n            @click=\"onChangeUserType(record)\"\n          >\n            变更用户类型\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|finger_del']\"\n            @click=\"onClearFingerprintInfo(record)\"\n          >\n            清空指纹信息\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|cabinet_pwd_del']\"\n            @click=\"onClearHardwarePassword(record)\"\n          >\n            清空硬件密码\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|add_point']\"\n            @click=\"onAddOrDelIntegral('shop-add')\"\n          >\n            增加积分\n          </a>\n          <a\n            v-if=\"record.auth['shop:member:member|reduce_point']\"\n            @click=\"onAddOrDelIntegral('shop-minus')\"\n          >\n            扣减积分\n          </a>\n        </st-table-actions>\n      </div>\n    </st-table>\n  </st-panel>\n</template>\n<script>\nimport moment from 'moment'\nimport { cloneDeep, filter, last } from 'lodash-es'\nimport { UserService } from '@/services/user.service'\nimport { StudioService } from './studio.service'\nimport tableMixin from '@/mixins/table.mixin'\nimport { columns } from './studio.config'\nimport ShopAddLable from '@/views/biz-modals/shop/add-lable'\nimport ShopBindingEntityCard from '@/views/biz-modals/shop/binding-entity-card'\nimport ShopDistributionCoach from '@/views/biz-modals/shop/distribution-coach'\nimport ShopDistributionSale from '@/views/biz-modals/shop/distribution-sale'\nimport ShopChangeUserType from '@/views/biz-modals/shop/change-user-type'\nimport ShopFrozen from '@/views/biz-modals/shop/frozen'\nimport ShopMissingCard from '@/views/biz-modals/shop/missing-card'\nimport PointsAddOrMinus from '@/views/biz-modals/brand/marketing/points/add-or-minus'\nimport { SEX } from '@/constants/member/info'\nimport { findPathWithTree } from '@/utils/find-path-with-tree'\nexport default {\n  name: 'ShopMemberListStudio',\n  mixins: [tableMixin],\n  modals: {\n    ShopAddLable,\n    ShopBindingEntityCard,\n    ShopDistributionCoach,\n    ShopDistributionSale,\n    ShopFrozen,\n    ShopMissingCard,\n    ShopChangeUserType,\n    PointsAddOrMinus\n  },\n  serviceInject() {\n    return {\n      studioService: StudioService,\n      userService: UserService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.studioService.loading$,\n      auth: this.studioService.auth$,\n      list: this.studioService.list$,\n      page: this.studioService.page$,\n      memberLevel: this.studioService.memberLevel$,\n      buyPersonalCourseList: this.studioService.buyPersonalCourse$,\n      saleList: this.studioService.saleList$,\n      coachList: this.studioService.coachList$,\n      labelList: this.studioService.labelLsit$\n    }\n  },\n  data() {\n    return {\n      expand: false,\n      sourceRegisterList: [],\n      consumption: [],\n      selectDataList: [],\n      selectedRowKeys: [],\n      selectedRows: [],\n      SEX,\n      memberLevelOptions: [],\n      member_level: []\n    }\n  },\n  computed: {\n    columns,\n    conditions() {\n      let conditions = {\n        ...this.$searchQuery,\n        search: this.$searchQuery.keyword\n      }\n      return conditions\n    }\n  },\n  mounted() {\n    this.sourceRegisters()\n    this.memberLevel.forEach(level => {\n      let obj = {\n        id: level.level_type,\n        name: level.level_name\n      }\n      if (!!level.level_condition.length) {\n        obj['children'] = []\n        level.level_condition.forEach(item => {\n          obj.children.push({\n            id: item.id,\n            name: item.condition_name\n          })\n        })\n      }\n      this.memberLevelOptions.push(obj)\n    })\n    this.setSearchData()\n  },\n  watch: {\n    $searchQuery(newVal) {\n      this.setSearchData()\n    }\n  },\n\n  methods: {\n    refeshPage() {\n      this.selectedRowKeys = []\n      this.$router.reload()\n    },\n    sourceRegisters() {\n      this.studioService.getMemberSourceRegisters().subscribe(status => {\n        this.sourceRegisterList = status\n      })\n    },\n    setSearchData() {\n      let memberLevel = []\n      if (this.$searchQuery.member_level) {\n        memberLevel.push(this.$searchQuery.member_level)\n        if (this.$searchQuery.member_level_condition) {\n          memberLevel.push(this.$searchQuery.member_level_condition)\n        }\n      }\n      this.member_level = memberLevel\n    },\n    // 分配教练\n    onDistributionCoach(record) {\n      this.$modalRouter.push({\n        name: 'shop-distribution-coach',\n        props: {\n          memberIds: [record.member_id],\n          coachId: record.follow_coach_id\n        },\n        on: {\n          success: () => {\n            this.refeshPage()\n          }\n        }\n      })\n    },\n    // 分配销售\n    onDistributionSale(record) {\n      this.$modalRouter.push({\n        name: 'shop-distribution-sale',\n        props: {\n          memberIds: [record.member_id],\n          saleId: record.follow_salesman_id\n        },\n        on: {\n          success: () => {\n            this.refeshPage()\n          }\n        }\n      })\n    },\n    onRemoveBind(record) {\n      this.$confirm({\n        title: '提示信息',\n        content: `确认解绑 ${record.member_name} 会员的微信绑定关系？`,\n        onOk: () => {\n          this.studioService\n            .removeWechatBind(record.member_id)\n            .subscribe(() => {\n              this.refeshPage()\n            })\n        },\n        onCancel() {}\n      })\n    },\n    onChangeUserType(record) {\n      this.$modalRouter.push({\n        name: 'shop-change-user-type',\n        props: {\n          info: record\n        },\n        on: {\n          success: () => {\n            this.refeshPage()\n          }\n        }\n      })\n    },\n    // 增加、扣减积分\n    onAddOrDelIntegral(type) {\n      this.$modalRouter.push({\n        name: 'points-add-or-minus',\n        props: {\n          type,\n          query: {\n            memberName: this.info.member_name,\n            memberId: this.$searchQuery.id\n          }\n        },\n        on: {\n          done: () => {\n            this.$router.reload()\n          }\n        }\n      })\n    },\n    // 清空指纹信息\n    onClearFingerprintInfo(record) {\n      this.$confirm({\n        title: '提示信息',\n        content: '确认清空指纹信息？',\n        onOk: () => {\n          this.studioService.deleteMemberFinger(record.member_id).subscribe()\n        }\n      })\n    },\n    // 清空硬件密码\n    onClearHardwarePassword(record) {\n      this.$confirm({\n        title: '提示信息',\n        content: '确认清空硬件密码吗？',\n        onOk: () => {\n          this.studioService\n            .deleteMemberCabinetPassword(record.member_id)\n            .subscribe()\n        }\n      })\n    },\n    changeLevel(ids) {\n      ;(this.$searchQuery.member_level = ids[0]),\n        (this.$searchQuery.member_level_condition = ids[1])\n    },\n    edit(record) {\n      this.$router.push({\n        name: 'shop-member-edit',\n        query: { id: record.member_id }\n      })\n    },\n    addUser() {\n      this.$router.push({ name: 'shop-member-add' })\n    },\n    infoFunc(record) {\n      this.$router.push({\n        name: 'shop-member-info-basic',\n        query: { id: record.member_id }\n      })\n    },\n    moment,\n    handleReset() {\n      let self = this\n      for (let prop in self.form) {\n        self.form[prop] = ''\n      }\n      this.$refs.stSeleter.handleResetItem()\n      this.consumption = []\n      this.$router.push({ query: {} })\n    },\n    toggle() {\n      this.expand = !this.expand\n    },\n    onSelectionReset() {\n      this.selectedRowKeys = []\n      this.selectedRows = []\n    },\n    onSelectionChange(keys, selectedRows) {\n      this.selectedRowKeys = keys\n      this.selectedRows = selectedRows\n      this.selectDataList = selectedRows.map(item => {\n        return item.id\n      })\n    },\n    $searchQueryFunc() {\n      this.$router.push({ query: this.form })\n    },\n    toCrowd() {\n      this.$router.push({\n        name: 'shop-member-crowd-index'\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/shop/member/list"}]}