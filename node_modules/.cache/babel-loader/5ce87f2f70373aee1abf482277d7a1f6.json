{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/finance/gathering/earnest/add.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/finance/gathering/earnest/add.vue","mtime":1600926555918},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { AddService } from \"./add.service\";\nimport { PatternService } from '@/services/pattern.service';\nimport { ruleOptions } from \"./add.config\";\nimport { CODE_NUMBER } from '@/constants/sold/transaction';\nimport autoContractBtn from '@/views/biz-components/contract/auto-contract-btn.vue';\nimport MemberSearch from '@/views/biz-components/member/member-search/member-search';\nexport default {\n  name: 'ModalShopFinanceGatheringEarnest',\n  bem: {\n    sale: 'modal-sold-deal-sale'\n  },\n  components: {\n    autoContractBtn: autoContractBtn,\n    MemberSearch: MemberSearch\n  },\n  modals: {},\n  serviceProviders: function serviceProviders() {\n    return [AddService];\n  },\n  serviceInject: function serviceInject() {\n    return {\n      addService: AddService,\n      pattern: PatternService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.addService.loading$,\n      memberList: this.addService.memberList$,\n      saleList: this.addService.saleList$,\n      paymentMethodList: this.addService.paymentMethodList$\n    };\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      CODE_NUMBER: CODE_NUMBER,\n      form: form,\n      decorators: decorators,\n      show: false,\n      money: 0\n    };\n  },\n  created: function created() {\n    this.init();\n  },\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      this.addService.serviceInit().subscribe(function () {\n        _this.$nextTick(function () {\n          var paymentMethodList = _this.paymentMethodList;\n          var paymentType = paymentMethodList[0] && paymentMethodList[0].payment_type;\n\n          _this.form.setFieldsValue({\n            pay_channel: paymentType\n          });\n        });\n      });\n    },\n    changeMoney: function changeMoney(event) {\n      this.money = event;\n    },\n    onCodeNumber: function onCodeNumber() {\n      var _this2 = this;\n\n      this.addService.getCodeNumber(this.CODE_NUMBER.EARNEST).subscribe(function (res) {\n        _this2.form.setFieldsValue({\n          contract_number: res.info.code\n        });\n      });\n    },\n    onCancel: function onCancel() {\n      this.addService.memberList$.commit(function () {\n        return [];\n      });\n    },\n    onSubmit: function onSubmit() {\n      var _this3 = this;\n\n      this.form.validate().then(function (values) {\n        // TODO POS机支付方式修改\n        values.pos_id = 0;\n\n        if (values.pay_channel > 32) {\n          values.pos_id = values.pay_channel;\n          values.pay_channel = 32;\n        }\n\n        _this3.addService.addEarnest(_objectSpread({}, values, {\n          mobile: values.mobile ? values.mobile.phone : undefined,\n          is_minors: values.is_minors,\n          parent_name: values.parent_name,\n          parent_mobile: values.parent_mobile ? values.parent_mobile.phone : undefined,\n          parent_country_prefix: values.parent_mobile ? values.parent_mobile.code_id : undefined,\n          parent_user_role: values.parent_user_role\n        })).subscribe(function (result) {\n          if (result.info.is_pos) {\n            _this3.$emit('success', {\n              type: 'pos',\n              orderId: result.info.order_id,\n              posInfo: {\n                order_id: result.info.order_id,\n                pos_name: result.info.pos_name,\n                expire_time: result.info.expire_time,\n                pos_serial_no: result.info.pos_serial_no\n              },\n              payInfo: {\n                order_id: result.info.order_id,\n                payment_type: values.pay_channel,\n                price: values.pay_price,\n                description: values.description\n              }\n            });\n          } else {\n            _this3.$emit('success', {\n              type: 'pay',\n              orderId: result.info.order_id\n            });\n          }\n\n          _this3.show = false;\n        });\n      });\n    }\n  }\n};",{"version":3,"sources":["add.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal\n    title=\"新增定金\"\n    size=\"small\"\n    v-model=\"show\"\n    @cancel=\"onCancel\"\n    wrapClassName=\"modal-sold-deal-sale\"\n  >\n    <div>\n      <st-form :form=\"form\" labelWidth=\"88px\">\n        <div>\n          <member-search\n            :form=\"form\"\n            :saleRangeType=\"1\"\n            isSoldDeal\n          ></member-search>\n          <st-form-item label=\"定金金额\" required>\n            <st-input-number\n              :min=\"1\"\n              :max=\"99999\"\n              :float=\"true\"\n              placeholder=\"请输入定金金额\"\n              @change=\"changeMoney\"\n              v-decorator=\"decorators.pay_price\"\n            >\n              <!-- <span slot=\"addonAfter\">元</span> -->\n            </st-input-number>\n          </st-form-item>\n          <st-form-item label=\"支付方式\" class=\"mg-b16\" required>\n            <a-radio-group v-decorator=\"decorators.pay_channel\">\n              <a-radio\n                :value=\"item.payment_type\"\n                :key=\"index\"\n                v-for=\"(item, index) in paymentMethodList\"\n              >\n                {{ item.payment_type_name }}\n              </a-radio>\n            </a-radio-group>\n          </st-form-item>\n          <st-form-item required>\n            <template slot=\"label\">\n              合同编号\n              <st-help-tooltip id=\"TSSD001\" />\n            </template>\n            <div :class=\"sale('contract')\">\n              <a-input\n                v-decorator=\"decorators.contract_number\"\n                placeholder=\"请输入合同编号\"\n              ></a-input>\n              <auto-contract-btn\n                class=\"create-button\"\n                @click=\"onCodeNumber\"\n                :loading=\"loading.getCodeNumber\"\n              >\n                自动生成\n              </auto-contract-btn>\n            </div>\n          </st-form-item>\n        </div>\n        <div>\n          <st-form-item label=\"销售人员\">\n            <a-select\n              v-decorator=\"decorators.sale_id\"\n              placeholder=\"选择签单的工作人员\"\n            >\n              <a-select-option\n                v-for=\"(item, index) in saleList\"\n                :key=\"index\"\n                :value=\"item.id\"\n              >\n                {{ item.staff_name }}\n              </a-select-option>\n            </a-select>\n          </st-form-item>\n          <st-form-item label=\"有效期\" required>\n            <st-input-number\n              placeholder=\"请输入有效期天数\"\n              :min=\"1\"\n              :max=\"3650\"\n              v-decorator=\"decorators.duration\"\n            >\n              <template slot=\"addonAfter\">天</template>\n            </st-input-number>\n          </st-form-item>\n          <st-form-item label=\"备注\" class=\"mg-b0\">\n            <st-textarea\n              v-decorator=\"decorators.description\"\n              :autosize=\"{ minRows: 4, maxRows: 6 }\"\n              :maxlength=\"200\"\n            />\n          </st-form-item>\n        </div>\n      </st-form>\n    </div>\n    <template slot=\"footer\">\n      <div :class=\"sale('footer')\">\n        <div class=\"price\">\n          <span>{{ money }}元</span>\n          <!-- <span>{{ selectedNorm.price }}元</span> -->\n        </div>\n        <div class=\"button\">\n          <st-button\n            type=\"primary\"\n            @click=\"onSubmit\"\n            :loading=\"loading.addEarnest\"\n          >\n            确认收款\n          </st-button>\n        </div>\n      </div>\n    </template>\n  </st-modal>\n</template>\n\n<script>\nimport { AddService } from './add.service'\nimport { PatternService } from '@/services/pattern.service'\nimport { ruleOptions } from './add.config'\nimport { CODE_NUMBER } from '@/constants/sold/transaction'\nimport autoContractBtn from '@/views/biz-components/contract/auto-contract-btn.vue'\nimport MemberSearch from '@/views/biz-components/member/member-search/member-search'\nexport default {\n  name: 'ModalShopFinanceGatheringEarnest',\n  bem: {\n    sale: 'modal-sold-deal-sale'\n  },\n  components: {\n    autoContractBtn,\n    MemberSearch\n  },\n  modals: {},\n  serviceProviders() {\n    return [AddService]\n  },\n  serviceInject() {\n    return {\n      addService: AddService,\n      pattern: PatternService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.addService.loading$,\n      memberList: this.addService.memberList$,\n      saleList: this.addService.saleList$,\n      paymentMethodList: this.addService.paymentMethodList$\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      CODE_NUMBER,\n      form,\n      decorators,\n      show: false,\n      money: 0\n    }\n  },\n  created() {\n    this.init()\n  },\n  methods: {\n    init() {\n      this.addService.serviceInit().subscribe(() => {\n        this.$nextTick(() => {\n          const { paymentMethodList } = this\n          const paymentType =\n            paymentMethodList[0] && paymentMethodList[0].payment_type\n          this.form.setFieldsValue({\n            pay_channel: paymentType\n          })\n        })\n      })\n    },\n    changeMoney(event) {\n      this.money = event\n    },\n    onCodeNumber() {\n      this.addService.getCodeNumber(this.CODE_NUMBER.EARNEST).subscribe(res => {\n        this.form.setFieldsValue({\n          contract_number: res.info.code\n        })\n      })\n    },\n    onCancel() {\n      this.addService.memberList$.commit(() => [])\n    },\n    onSubmit() {\n      this.form.validate().then(values => {\n        // TODO POS机支付方式修改\n        values.pos_id = 0\n        if (values.pay_channel > 32) {\n          values.pos_id = values.pay_channel\n          values.pay_channel = 32\n        }\n        this.addService\n          .addEarnest({\n            ...values,\n            mobile: values.mobile ? values.mobile.phone : undefined,\n            is_minors: values.is_minors,\n            parent_name: values.parent_name,\n            parent_mobile: values.parent_mobile\n              ? values.parent_mobile.phone\n              : undefined,\n            parent_country_prefix: values.parent_mobile\n              ? values.parent_mobile.code_id\n              : undefined,\n            parent_user_role: values.parent_user_role\n          })\n          .subscribe(result => {\n            if (result.info.is_pos) {\n              this.$emit('success', {\n                type: 'pos',\n                orderId: result.info.order_id,\n                posInfo: {\n                  order_id: result.info.order_id,\n                  pos_name: result.info.pos_name,\n                  expire_time: result.info.expire_time,\n                  pos_serial_no: result.info.pos_serial_no\n                },\n                payInfo: {\n                  order_id: result.info.order_id,\n                  payment_type: values.pay_channel,\n                  price: values.pay_price,\n                  description: values.description\n                }\n              })\n            } else {\n              this.$emit('success', {\n                type: 'pay',\n                orderId: result.info.order_id\n              })\n            }\n            this.show = false\n          })\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/shop/finance/gathering/earnest"}]}