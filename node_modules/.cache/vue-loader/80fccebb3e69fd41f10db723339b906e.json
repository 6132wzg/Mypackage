{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/setting/court/site.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/setting/court/site.vue","mtime":1597396800004},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { cloneDeep } from 'lodash-es'\nimport { imgFilter } from '@/filters/resource.filters'\nimport { MessageService } from '@/services/message.service'\nimport { SiteService } from './site.service'\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue'\nexport default {\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      siteService: SiteService\n    }\n  },\n  rxState() {\n    const siteService = this.siteService\n    return {\n      resData: siteService.resData$,\n      loading: siteService.loading$\n    }\n  },\n  components: {\n    StImageUpload\n  },\n  bem: {\n    bPage: 'page-shop-setting-court-site'\n  },\n  filters: {\n    imgFilter\n  },\n  data() {\n    return {\n      isAdd: false,\n      addInfo: {},\n      editInfo: {}\n    }\n  },\n  computed: {\n    canShowAddBtn() {\n      /**\n       * 单个场地最多可以新增20个座位模板\n       */\n      return this.list.length < 20 && !this.isAdd && !this.editInfo.id\n    },\n    list() {\n      return this.resData.list\n    }\n  },\n  methods: {\n    onAdd() {\n      this.isAdd = true\n      this.editInfo = {}\n      this.addInfo = {\n        shop_area_id: this.$searchQuery.id,\n        seat_img: {},\n        seat_name: '',\n        seat_num: ''\n      }\n    },\n    onAddSubmit() {\n      if (!this.inputCheck(this.addInfo)) {\n        return\n      }\n      this.siteService.add(this.addInfo).subscribe(() => {\n        this.onActionSuccess('add')\n      })\n    },\n    onAddCancel() {\n      this.isAdd = false\n    },\n    onEdit(record) {\n      this.isAdd = false\n      this.editInfo = cloneDeep(record)\n    },\n    onEditSubmit() {\n      if (!this.inputCheck(this.editInfo)) {\n        return\n      }\n      this.siteService.update(this.editInfo).subscribe(() => {\n        this.onActionSuccess('edit')\n      })\n    },\n    onEditCancel() {\n      this.editInfo = {}\n    },\n    onDelete(id) {\n      this.siteService.del(id).subscribe(() => {\n        this.onActionSuccess('del')\n      })\n    },\n    onActionSuccess(type) {\n      const msg = {\n        add: '新增成功',\n        edit: '编辑成功',\n        del: '删除成功'\n      }[type]\n      this.messageService.success({\n        content: msg\n      })\n      this.onListChange()\n    },\n    onListChange() {\n      this.isAdd = false\n      this.editInfo = {}\n      this.$router.push({\n        query: this.$searchQuery\n      })\n    },\n    onAddImgChange(fileList) {\n      this.addInfo.seat_img = fileList[0]\n    },\n    onEditImgChange(fileList) {\n      this.editInfo.seat_img = fileList[0]\n    },\n    inputCheck(data = {}) {\n      const seatImg = data.seat_img\n      const seatName = data.seat_name\n      const seatNum = data.seat_num.toString()\n      if (!seatImg.image_key) {\n        this.onErrorTip('请上传座位图片')\n        return false\n      }\n      if (!seatName.length) {\n        this.onErrorTip('请输入座位模板名称')\n        return false\n      }\n      if (!seatNum.length) {\n        this.onErrorTip('请输入座位数量')\n        return false\n      }\n      if (seatNum > this.resData.contain_number) {\n        this.onErrorTip('座位数量不能超过场地的最大容纳人数')\n        return false\n      }\n      return true\n    },\n    onErrorTip(msg) {\n      this.messageService.error({\n        content: msg\n      })\n    }\n  }\n}\n",{"version":3,"sources":["site.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"site.vue","sourceRoot":"src/views/pages/shop/setting/court","sourcesContent":["<template>\n  <st-panel app :class=\"bPage()\">\n    <div slot=\"title\">\n      {{ resData.area_name }}\n      <img\n        v-if=\"resData.is_vip\"\n        src=\"~@/assets/img/icon_vip.png\"\n        width=\"26px\"\n        alt\n      />\n    </div>\n    <div slot=\"actions\">\n      <span>容纳人数：{{ resData.contain_number }}人</span>\n      <span class=\"mg-l32\">座位模版：{{ resData.count }}个</span>\n    </div>\n    <st-form-table>\n      <thead>\n        <tr>\n          <th width=\"20%\">座位图</th>\n          <th width=\"30%\">座位模版名称</th>\n          <th width=\"30%\">座位数量</th>\n          <th>操作</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td colspan=\"4\" class=\"st-form-table__add\">\n            <st-button\n              :disabled=\"!canShowAddBtn\"\n              @click=\"onAdd\"\n              type=\"dashed\"\n              icon=\"add\"\n              block\n            >\n              新增座位\n            </st-button>\n          </td>\n        </tr>\n        <tr v-if=\"isAdd\">\n          <td class=\"align-items-center\">\n            <st-image-upload\n              width=\"80px\"\n              height=\"80px\"\n              :size-limit=\"5\"\n              @change=\"onAddImgChange\"\n            />\n            <span class=\"st-des mg-l8\" style=\"width: 100px\">\n              大小不超过5M，比例1:1\n            </span>\n          </td>\n          <td>\n            <a-input v-model=\"addInfo.seat_name\" placeholder=\"请输入模版名称\" />\n          </td>\n          <td>\n            <st-input-number\n              style=\"width:300px\"\n              v-model=\"addInfo.seat_num\"\n              placeholder=\"请输入座位数量\"\n            />\n          </td>\n          <td>\n            <st-table-actions>\n              <a @click=\"onAddSubmit\">保存</a>\n              <a @click=\"onAddCancel\">取消</a>\n            </st-table-actions>\n          </td>\n        </tr>\n\n        <tr v-for=\"item in list\" :key=\"item.id\">\n          <template v-if=\"editInfo.id !== item.id\">\n            <td>\n              <div\n                v-if=\"item.seat_img\"\n                class=\"st-preview-item\"\n                v-viewer=\"{ url: 'data-src', toolbar: false }\"\n              >\n                <img\n                  v-if=\"item.seat_img\"\n                  width=\"80px\"\n                  :src=\"item.seat_img.image_key | imgFilter({ w: 80 })\"\n                  :data-src=\"item.seat_img.image_key | imgFilter\"\n                  alt=\"site-img\"\n                />\n              </div>\n            </td>\n            <td>{{ item.seat_name }}</td>\n            <td>{{ item.seat_num }}</td>\n            <td>\n              <st-table-actions>\n                <a @click=\"onEdit(item)\">编辑</a>\n                <a @click=\"onDelete(item.id)\">删除</a>\n              </st-table-actions>\n            </td>\n          </template>\n          <!-- 编辑状态 -->\n          <template v-else>\n            <td>\n              <st-image-upload\n                @change=\"onEditImgChange\"\n                :list=\"[item.seat_img]\"\n                width=\"80px\"\n                height=\"80px\"\n              />\n            </td>\n            <td>\n              <a-input\n                v-model=\"editInfo.seat_name\"\n                placeholder=\"请输入模版名称\"\n              ></a-input>\n            </td>\n            <td>\n              <st-input-number\n                style=\"width:300px\"\n                v-model=\"editInfo.seat_num\"\n                placeholder=\"请输入数位数量\"\n              ></st-input-number>\n            </td>\n            <td>\n              <st-table-actions>\n                <a @click=\"onEditSubmit\">保存</a>\n                <a @click=\"onEditCancel\">取消</a>\n              </st-table-actions>\n            </td>\n          </template>\n        </tr>\n      </tbody>\n    </st-form-table>\n  </st-panel>\n</template>\n\n<script>\nimport { cloneDeep } from 'lodash-es'\nimport { imgFilter } from '@/filters/resource.filters'\nimport { MessageService } from '@/services/message.service'\nimport { SiteService } from './site.service'\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue'\nexport default {\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      siteService: SiteService\n    }\n  },\n  rxState() {\n    const siteService = this.siteService\n    return {\n      resData: siteService.resData$,\n      loading: siteService.loading$\n    }\n  },\n  components: {\n    StImageUpload\n  },\n  bem: {\n    bPage: 'page-shop-setting-court-site'\n  },\n  filters: {\n    imgFilter\n  },\n  data() {\n    return {\n      isAdd: false,\n      addInfo: {},\n      editInfo: {}\n    }\n  },\n  computed: {\n    canShowAddBtn() {\n      /**\n       * 单个场地最多可以新增20个座位模板\n       */\n      return this.list.length < 20 && !this.isAdd && !this.editInfo.id\n    },\n    list() {\n      return this.resData.list\n    }\n  },\n  methods: {\n    onAdd() {\n      this.isAdd = true\n      this.editInfo = {}\n      this.addInfo = {\n        shop_area_id: this.$searchQuery.id,\n        seat_img: {},\n        seat_name: '',\n        seat_num: ''\n      }\n    },\n    onAddSubmit() {\n      if (!this.inputCheck(this.addInfo)) {\n        return\n      }\n      this.siteService.add(this.addInfo).subscribe(() => {\n        this.onActionSuccess('add')\n      })\n    },\n    onAddCancel() {\n      this.isAdd = false\n    },\n    onEdit(record) {\n      this.isAdd = false\n      this.editInfo = cloneDeep(record)\n    },\n    onEditSubmit() {\n      if (!this.inputCheck(this.editInfo)) {\n        return\n      }\n      this.siteService.update(this.editInfo).subscribe(() => {\n        this.onActionSuccess('edit')\n      })\n    },\n    onEditCancel() {\n      this.editInfo = {}\n    },\n    onDelete(id) {\n      this.siteService.del(id).subscribe(() => {\n        this.onActionSuccess('del')\n      })\n    },\n    onActionSuccess(type) {\n      const msg = {\n        add: '新增成功',\n        edit: '编辑成功',\n        del: '删除成功'\n      }[type]\n      this.messageService.success({\n        content: msg\n      })\n      this.onListChange()\n    },\n    onListChange() {\n      this.isAdd = false\n      this.editInfo = {}\n      this.$router.push({\n        query: this.$searchQuery\n      })\n    },\n    onAddImgChange(fileList) {\n      this.addInfo.seat_img = fileList[0]\n    },\n    onEditImgChange(fileList) {\n      this.editInfo.seat_img = fileList[0]\n    },\n    inputCheck(data = {}) {\n      const seatImg = data.seat_img\n      const seatName = data.seat_name\n      const seatNum = data.seat_num.toString()\n      if (!seatImg.image_key) {\n        this.onErrorTip('请上传座位图片')\n        return false\n      }\n      if (!seatName.length) {\n        this.onErrorTip('请输入座位模板名称')\n        return false\n      }\n      if (!seatNum.length) {\n        this.onErrorTip('请输入座位数量')\n        return false\n      }\n      if (seatNum > this.resData.contain_number) {\n        this.onErrorTip('座位数量不能超过场地的最大容纳人数')\n        return false\n      }\n      return true\n    },\n    onErrorTip(msg) {\n      this.messageService.error({\n        content: msg\n      })\n    }\n  }\n}\n</script>\n"]}]}