{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/reception/entrance.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/reception/entrance.service.ts","mtime":1600926555929},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { UserService } from '@/services/user.service';\nimport { Injectable } from 'vue-service-app';\nimport { State, Effect } from 'rx-state';\nimport { FrontApi, SetEntranceInput, EditSellerInput, EditCoachInput, GetCabinetInput } from '@/api/v1/front';\nimport { OrderApi, OrderDescription } from '@/api/v1/finance/order';\nimport { MemberApi, EditFaceParams } from '@/api/v1/member';\nimport { tap } from 'rxjs/operators';\nimport { forkJoin } from 'rxjs';\nimport { AuthService } from '@/services/auth.service';\n\nvar EntranceService = /*#__PURE__*/function () {\n  function EntranceService(authService, userService, frontApi, memberApi, orderApi) {\n    _classCallCheck(this, EntranceService);\n\n    this.authService = authService;\n    this.userService = userService;\n    this.frontApi = frontApi;\n    this.memberApi = memberApi;\n    this.orderApi = orderApi;\n    this.loading$ = new State({});\n    this.page$ = new State([]);\n    this.sellerList$ = new State([]);\n    this.coachList$ = new State([]);\n    this.entranceList$ = new State([]);\n    this.cardList$ = new State([]);\n    this.courseList$ = new State([]);\n    this.cabinetList$ = new State([]);\n    this.parent_types$ = this.userService.getOptions$('small_course.parent_type');\n    this.auth$ = this.authService.authMap$({\n      checkin: 'shop:front_end:check_in_out|checkin',\n      checkout: 'shop:front_end:check_in_out|checkout',\n      bindCoach: 'shop:member:member|bind_coach',\n      bindSalesman: 'shop:member:member|bind_salesman',\n      editMember: 'shop:member:member|edit',\n      editFace: 'brand_shop:iot:face|edit',\n      delFace: 'shop:member:member|del_face',\n      editTag: 'shop:member:member|tag',\n      editCardNum: 'shop:member:member|bind_card',\n      entranceCheckin: 'shop:front_end:check_in_out|entrance_checkin' // 凭课入场直接签到\n\n    });\n  }\n  /**\n   * 获取销售列表\n   *\n   * @returns\n   * @memberof IndexService\n   */\n\n\n  _createClass(EntranceService, [{\n    key: \"getSellerList\",\n    value: function getSellerList() {\n      var _this = this;\n\n      return this.frontApi.getSellerList().pipe(tap(function (res) {\n        _this.sellerList$.commit(function () {\n          return res.list;\n        });\n      }));\n    }\n    /**\n     * 获取教练列表\n     *\n     * @returns\n     * @memberof IndexService\n     */\n\n  }, {\n    key: \"getCoachList\",\n    value: function getCoachList() {\n      var _this2 = this;\n\n      return this.frontApi.getCoachList().pipe(tap(function (res) {\n        _this2.coachList$.commit(function () {\n          return res.list;\n        });\n      }));\n    } // 获取会员详情\n\n  }, {\n    key: \"getMemberInfo\",\n    value: function getMemberInfo(id) {\n      return this.frontApi.getMemberInfo(id);\n    } // 会员入场\n\n  }, {\n    key: \"setEntrance\",\n    value: function setEntrance(params) {\n      return this.frontApi.setEntrance(params);\n    } // 获取入场凭证列表\n\n  }, {\n    key: \"getEntranceOptionList\",\n    value: function getEntranceOptionList(id) {\n      var _this3 = this;\n\n      return this.frontApi.getEntranceOptionList(id).pipe(tap(function (res) {\n        _this3.cardList$.commit(function () {\n          return res.card_list;\n        });\n\n        _this3.courseList$.commit(function () {\n          return res.course_list;\n        });\n      }));\n    } // 重置入场凭证列表\n\n  }, {\n    key: \"resetEntranceOptionList\",\n    value: function resetEntranceOptionList() {\n      this.cardList$.commit(function () {\n        return [];\n      });\n      this.courseList$.commit(function () {\n        return [];\n      });\n    } // 获取储物柜列表\n\n  }, {\n    key: \"getCabinetList\",\n    value: function getCabinetList(id, params) {\n      var _this4 = this;\n\n      return this.frontApi.getCabinetList(id, params).pipe(tap(function (res) {\n        _this4.cabinetList$.commit(function () {\n          return _toConsumableArray(res.list);\n        });\n      }));\n    }\n  }, {\n    key: \"setCabinetList\",\n    value: function setCabinetList(list) {\n      this.cabinetList$.commit(function () {\n        return list;\n      });\n    } // 重置储物柜列表\n\n  }, {\n    key: \"resetCabinetList\",\n    value: function resetCabinetList() {\n      this.cabinetList$.commit(function () {\n        return [];\n      });\n    } // 修改入场会员储物柜\n\n  }, {\n    key: \"editEntranceCabinet\",\n    value: function editEntranceCabinet(params) {\n      return this.frontApi.editEntranceCabinet(params);\n    } // 修改实体卡号\n\n  }, {\n    key: \"getMemberPhysicalBind\",\n    value: function getMemberPhysicalBind(id, data) {\n      return this.memberApi.getMemberPhysicalBind(id, data);\n    } // 编辑会员信息\n\n  }, {\n    key: \"updateMemberEdit\",\n    value: function updateMemberEdit(id, params) {\n      return this.memberApi.setBasicInfo(id, params);\n    } // 离场之前获取柜子信息进行判断是否是智能柜\n\n  }, {\n    key: \"getCabinetInfo\",\n    value: function getCabinetInfo(id) {\n      return this.frontApi.getCabinetInfo(id);\n    } // 离场\n\n  }, {\n    key: \"setEntranceLeave\",\n    value: function setEntranceLeave(id) {\n      return this.frontApi.setEntranceLeave(id);\n    } // 修改跟进销售\n\n  }, {\n    key: \"editSeller\",\n    value: function editSeller(params) {\n      return this.frontApi.editSeller(params);\n    } // 修改跟进教练\n\n  }, {\n    key: \"editCoach\",\n    value: function editCoach(params) {\n      return this.frontApi.editCoach(params);\n    } // 修改人脸图片\n\n  }, {\n    key: \"editFace\",\n    value: function editFace(id, params) {\n      return this.memberApi.updateUserFace(id, params);\n    }\n  }, {\n    key: \"addDescription\",\n    value: function addDescription(params) {\n      return this.orderApi.addOrderDescription(params);\n    } // 修改会员标签\n\n  }, {\n    key: \"getMemberLabelDelete\",\n    value: function getMemberLabelDelete(obj) {\n      return this.memberApi.getMemberLabelDelete(obj);\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      return forkJoin(this.getSellerList(), this.getCoachList());\n    }\n  }, {\n    key: \"beforeEach\",\n    value: function beforeEach() {\n      return this.init();\n    }\n  }]);\n\n  return EntranceService;\n}();\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", []), __metadata(\"design:returntype\", void 0)], EntranceService.prototype, \"getSellerList\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", []), __metadata(\"design:returntype\", void 0)], EntranceService.prototype, \"getCoachList\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [String]), __metadata(\"design:returntype\", void 0)], EntranceService.prototype, \"getMemberInfo\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_a = typeof SetEntranceInput !== \"undefined\" && SetEntranceInput) === \"function\" ? _a : Object]), __metadata(\"design:returntype\", void 0)], EntranceService.prototype, \"setEntrance\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [String]), __metadata(\"design:returntype\", void 0)], EntranceService.prototype, \"getEntranceOptionList\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [String, typeof (_b = typeof GetCabinetInput !== \"undefined\" && GetCabinetInput) === \"function\" ? _b : Object]), __metadata(\"design:returntype\", void 0)], EntranceService.prototype, \"getCabinetList\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [String]), __metadata(\"design:returntype\", void 0)], EntranceService.prototype, \"getCabinetInfo\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [String]), __metadata(\"design:returntype\", void 0)], EntranceService.prototype, \"setEntranceLeave\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_c = typeof EditSellerInput !== \"undefined\" && EditSellerInput) === \"function\" ? _c : Object]), __metadata(\"design:returntype\", void 0)], EntranceService.prototype, \"editSeller\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_d = typeof EditCoachInput !== \"undefined\" && EditCoachInput) === \"function\" ? _d : Object]), __metadata(\"design:returntype\", void 0)], EntranceService.prototype, \"editCoach\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [Number, typeof (_e = typeof EditFaceParams !== \"undefined\" && EditFaceParams) === \"function\" ? _e : Object]), __metadata(\"design:returntype\", void 0)], EntranceService.prototype, \"editFace\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_f = typeof OrderDescription !== \"undefined\" && OrderDescription) === \"function\" ? _f : Object]), __metadata(\"design:returntype\", void 0)], EntranceService.prototype, \"addDescription\", null);\n\nEntranceService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_g = typeof AuthService !== \"undefined\" && AuthService) === \"function\" ? _g : Object, typeof (_h = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _h : Object, typeof (_j = typeof FrontApi !== \"undefined\" && FrontApi) === \"function\" ? _j : Object, typeof (_k = typeof MemberApi !== \"undefined\" && MemberApi) === \"function\" ? _k : Object, typeof (_l = typeof OrderApi !== \"undefined\" && OrderApi) === \"function\" ? _l : Object])], EntranceService);\nexport { EntranceService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/reception/entrance.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { UserService } from '@/services/user.service'\nimport { Injectable, Controller } from 'vue-service-app'\nimport { State, Effect, Action } from 'rx-state'\nimport {\n  FrontApi,\n  SetEntranceInput,\n  EditEntranceCabinetInput,\n  EditSellerInput,\n  EditCoachInput,\n  GetCabinetInput\n} from '@/api/v1/front'\nimport { OrderApi, OrderDescription } from '@/api/v1/finance/order'\nimport { MemberApi, EditFaceParams } from '@/api/v1/member'\nimport { tap } from 'rxjs/operators'\nimport { forkJoin } from 'rxjs'\nimport { AuthService } from '@/services/auth.service'\n\n@Injectable()\nexport class EntranceService implements Controller {\n  loading$ = new State({})\n  page$ = new State([])\n  sellerList$ = new State([])\n  coachList$ = new State([])\n  entranceList$ = new State([])\n  cardList$ = new State([])\n  courseList$ = new State([])\n  cabinetList$ = new State([])\n  parent_types$ = this.userService.getOptions$('small_course.parent_type')\n  auth$ = this.authService.authMap$({\n    checkin: 'shop:front_end:check_in_out|checkin', // 入场\n    checkout: 'shop:front_end:check_in_out|checkout', // 离场\n    bindCoach: 'shop:member:member|bind_coach', // 编辑教练\n    bindSalesman: 'shop:member:member|bind_salesman', // 编辑销售\n    editMember: 'shop:member:member|edit', // 编辑会员信息\n    editFace: 'brand_shop:iot:face|edit',\n    delFace: 'shop:member:member|del_face',\n    editTag: 'shop:member:member|tag', // 编辑标签\n    editCardNum: 'shop:member:member|bind_card', // 编辑标签\n    entranceCheckin: 'shop:front_end:check_in_out|entrance_checkin' // 凭课入场直接签到\n  })\n  constructor(\n    private authService: AuthService,\n    private userService: UserService,\n    private frontApi: FrontApi,\n    private memberApi: MemberApi,\n    private orderApi: OrderApi\n  ) {}\n  /**\n   * 获取销售列表\n   *\n   * @returns\n   * @memberof IndexService\n   */\n  @Effect()\n  getSellerList() {\n    return this.frontApi.getSellerList().pipe(\n      tap((res: any) => {\n        this.sellerList$.commit(() => res.list)\n      })\n    )\n  }\n  /**\n   * 获取教练列表\n   *\n   * @returns\n   * @memberof IndexService\n   */\n  @Effect()\n  getCoachList() {\n    return this.frontApi.getCoachList().pipe(\n      tap((res: any) => {\n        this.coachList$.commit(() => res.list)\n      })\n    )\n  }\n  // 获取会员详情\n  @Effect()\n  getMemberInfo(id: string) {\n    return this.frontApi.getMemberInfo(id)\n  }\n  // 会员入场\n  @Effect()\n  setEntrance(params: SetEntranceInput) {\n    return this.frontApi.setEntrance(params)\n  }\n  // 获取入场凭证列表\n  @Effect()\n  getEntranceOptionList(id: string) {\n    return this.frontApi.getEntranceOptionList(id).pipe(\n      tap((res: any) => {\n        this.cardList$.commit(() => res.card_list)\n        this.courseList$.commit(() => res.course_list)\n      })\n    )\n  }\n  // 重置入场凭证列表\n  resetEntranceOptionList() {\n    this.cardList$.commit(() => [])\n    this.courseList$.commit(() => [])\n  }\n  // 获取储物柜列表\n  @Effect()\n  getCabinetList(id: string, params: GetCabinetInput) {\n    return this.frontApi.getCabinetList(id, params).pipe(\n      tap((res: any) => {\n        this.cabinetList$.commit(() => {\n          return [...res.list]\n        })\n      })\n    )\n  }\n  setCabinetList(list) {\n    this.cabinetList$.commit(() => list)\n  }\n  // 重置储物柜列表\n  resetCabinetList() {\n    this.cabinetList$.commit(() => [])\n  }\n  // 修改入场会员储物柜\n  editEntranceCabinet(params: EditEntranceCabinetInput) {\n    return this.frontApi.editEntranceCabinet(params)\n  }\n  // 修改实体卡号\n  getMemberPhysicalBind(id: any, data: any) {\n    return this.memberApi.getMemberPhysicalBind(id, data)\n  }\n  // 编辑会员信息\n  updateMemberEdit(id: string, params: any) {\n    return this.memberApi.setBasicInfo(id, params)\n  }\n  // 离场之前获取柜子信息进行判断是否是智能柜\n  @Effect()\n  getCabinetInfo(id: string) {\n    return this.frontApi.getCabinetInfo(id)\n  }\n  // 离场\n  @Effect()\n  setEntranceLeave(id: string) {\n    return this.frontApi.setEntranceLeave(id)\n  }\n  // 修改跟进销售\n  @Effect()\n  editSeller(params: EditSellerInput) {\n    return this.frontApi.editSeller(params)\n  }\n  // 修改跟进教练\n  @Effect()\n  editCoach(params: EditCoachInput) {\n    return this.frontApi.editCoach(params)\n  }\n  // 修改人脸图片\n  @Effect()\n  editFace(id: number, params: EditFaceParams) {\n    return this.memberApi.updateUserFace(id, params)\n  }\n  @Effect()\n  addDescription(params: OrderDescription) {\n    return this.orderApi.addOrderDescription(params)\n  }\n  // 修改会员标签\n  getMemberLabelDelete(obj: any) {\n    return this.memberApi.getMemberLabelDelete(obj)\n  }\n  init() {\n    return forkJoin(this.getSellerList(), this.getCoachList())\n  }\n  beforeEach() {\n    return this.init()\n  }\n}\n"],"sourceRoot":""}]}