{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-3!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/course/schedule/personal/service#/schedule.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/course/schedule/personal/service#/schedule.service.ts","mtime":1597396799997},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b, _c, _d;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { PersonalScheduleListQuery, AddScheduleInBatchInput } from '@/api/v1/schedule/personal/schedule';\nimport { Injectable } from 'vue-service-app';\nimport { State, Effect } from 'rx-state';\nimport { tap, switchMap } from 'rxjs/operators';\nimport { PersonalScheduleApi } from '@/api/v1/schedule/personal/schedule';\nimport { MessageService } from '@/services/message.service';\nimport moment from 'moment';\n\nvar PersonalScheduleScheduleService = /*#__PURE__*/function () {\n  function PersonalScheduleScheduleService(scheduleApi, msg) {\n    _classCallCheck(this, PersonalScheduleScheduleService);\n\n    this.scheduleApi = scheduleApi;\n    this.msg = msg;\n    this.scheduleTeamCourseList$ = new State([]);\n    this.scheduleTable$ = new State([]);\n    this.refresh$ = new State(0);\n    this.loading$ = new State({});\n  }\n\n  _createClass(PersonalScheduleScheduleService, [{\n    key: \"SET_SCHEDULE_TEAM_COURSE_LIST\",\n    value: function SET_SCHEDULE_TEAM_COURSE_LIST() {\n      var resList = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n      var _list = resList.map(function (item) {\n        var end_date = '';\n\n        if (moment(\"\".concat(item.start_date, \" \").concat(item.start_time)).valueOf() >= moment(\"\".concat(item.start_date, \" \").concat(item.end_time)).valueOf()) {\n          item.plusOne = '+1';\n          end_date = moment(moment(\"\".concat(item.start_date, \" \").concat(item.start_time)).valueOf() + 24 * 60 * 60 * 1000).format('YYYY-MM-DD').valueOf();\n        } else {\n          end_date = item.start_date;\n        }\n\n        return {\n          // add new event data\n          title: item.course_name,\n          groupId: JSON.stringify(item),\n          id: item.id,\n          start: \"\".concat(item.start_date, \" \").concat(item.start_time),\n          end: \"\".concat(end_date, \" \").concat(item.end_time)\n        };\n      });\n\n      this.scheduleTeamCourseList$.commit(function () {\n        return _list;\n      });\n    }\n    /**\n     *\n     * @param params\n     * 获取团体课排期列表\n     */\n\n  }, {\n    key: \"getList\",\n    value: function getList(query) {\n      var _this = this;\n\n      return this.scheduleApi.getList(query).pipe(tap(function (res) {\n        _this.SET_SCHEDULE_TEAM_COURSE_LIST(res.list);\n      }));\n    }\n    /**\n     *\n     * @param params\n     * 获取团体课排期表格\n     */\n\n  }, {\n    key: \"getTable\",\n    value: function getTable(query) {\n      var _this2 = this;\n\n      return this.scheduleApi.getTable(query).pipe(tap(function (res) {\n        _this2.scheduleTable$.commit(function () {\n          return res.list;\n        });\n      }));\n    }\n    /**\n     *\n     * @param params\n     * 新增团体课排期\n     */\n\n  }, {\n    key: \"add\",\n    value: function add(params) {\n      var _this3 = this;\n\n      return this.scheduleApi.add(params).pipe(tap(function (res) {\n        _this3.msg.success({\n          content: '新增成功'\n        });\n      }));\n    }\n  }, {\n    key: \"addScheduleInBatch\",\n    value: function addScheduleInBatch(params) {\n      var _this4 = this;\n\n      return this.scheduleApi.addScheduleInBatch(params).pipe(switchMap(function (state) {\n        return _this4.getList({});\n      }), tap(function (res) {\n        _this4.msg.success({\n          content: '批量新增成功'\n        });\n      }));\n    }\n    /**\n     *\n     * @param params\n     * 编辑课程排期\n     */\n\n  }, {\n    key: \"update\",\n    value: function update(params) {\n      var _this5 = this;\n\n      return this.scheduleApi.update(params).pipe(tap(function (res) {\n        _this5.msg.success({\n          content: '编辑成功'\n        });\n      }));\n    }\n  }, {\n    key: \"delInBatch\",\n    value: function delInBatch(ids) {\n      var _this6 = this;\n\n      return this.scheduleApi.delInBatch({\n        schedule_ids: ids\n      }).pipe(tap(function (res) {\n        _this6.msg.success({\n          content: '删除成功'\n        });\n      }));\n    }\n  }, {\n    key: \"copy\",\n    value: function copy(id, params) {\n      var _this7 = this;\n\n      return this.scheduleApi.copy(id, params).pipe(tap(function (res) {\n        _this7.msg.success({\n          content: '复制成功'\n        });\n      }));\n    }\n    /**\n     *\n     * @param params\n     * 编辑课程排期回显\n     */\n\n  }, {\n    key: \"getUpdateInfo\",\n    value: function getUpdateInfo(id) {\n      return this.scheduleApi.getUpdateInfo(id);\n    }\n  }]);\n\n  return PersonalScheduleScheduleService;\n}();\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_a = typeof PersonalScheduleListQuery !== \"undefined\" && PersonalScheduleListQuery) === \"function\" ? _a : Object]), __metadata(\"design:returntype\", void 0)], PersonalScheduleScheduleService.prototype, \"getList\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_b = typeof AddScheduleInBatchInput !== \"undefined\" && AddScheduleInBatchInput) === \"function\" ? _b : Object]), __metadata(\"design:returntype\", void 0)], PersonalScheduleScheduleService.prototype, \"addScheduleInBatch\", null);\n\nPersonalScheduleScheduleService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_c = typeof PersonalScheduleApi !== \"undefined\" && PersonalScheduleApi) === \"function\" ? _c : Object, typeof (_d = typeof MessageService !== \"undefined\" && MessageService) === \"function\" ? _d : Object])], PersonalScheduleScheduleService);\nexport { PersonalScheduleScheduleService };",null]}