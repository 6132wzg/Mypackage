{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/role/add.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/role/add.service.ts","mtime":1600926556252},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b, _c;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { UserService } from \"./../../../../../services/user.service\";\nimport { Injectable } from 'vue-service-app';\nimport { State, Effect } from 'rx-state';\nimport { tap, map } from 'rxjs/operators';\nimport { GetInitInfoPut } from '@/api/v1/staff/role';\nimport { RoleService } from \"../role.service\";\nimport { cloneDeep } from 'lodash-es';\n\nvar AddService = /*#__PURE__*/function () {\n  function AddService(roleService, userService) {\n    _classCallCheck(this, AddService);\n\n    this.roleService = roleService;\n    this.userService = userService;\n    this.loading$ = new State({});\n    this.info$ = new State({});\n    this.shopList$ = new State({});\n    this.brandList$ = new State({});\n    this.dataGrant$ = this.userService.getOptions$('data_grant.data_grant').pipe(map(function (list) {\n      var arr = cloneDeep(list);\n      var index2Value = arr[2];\n      arr[2] = arr[3];\n      arr[3] = index2Value;\n      return arr;\n    }));\n  }\n\n  _createClass(AddService, [{\n    key: \"gitInitInfo\",\n    value: function gitInitInfo() {\n      var _this = this;\n\n      // 如果是新增角色 初始化角色Id 是 0\n      return this.roleService.getInitInfo({\n        role_id: 0\n      }).pipe(tap(function (res) {\n        _this.brandList$.commit(function () {\n          return res.brand_list;\n        });\n\n        _this.shopList$.commit(function () {\n          return res.shop_list;\n        });\n      }));\n    }\n    /**\n     * 获取所有角色详情\n     */\n\n  }, {\n    key: \"getInfo\",\n    value: function getInfo(query) {\n      var _this2 = this;\n\n      return this.roleService.getInfo(query).pipe(tap(function (res) {\n        _this2.info$.commit(function () {\n          return res.role;\n        });\n      }));\n    }\n  }, {\n    key: \"beforeRouteEnter\",\n    value: function beforeRouteEnter(to, from) {\n      return this.gitInitInfo();\n    }\n  }]);\n\n  return AddService;\n}();\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_a = typeof GetInitInfoPut !== \"undefined\" && GetInitInfoPut) === \"function\" ? _a : Object]), __metadata(\"design:returntype\", void 0)], AddService.prototype, \"getInfo\", null);\n\nAddService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_b = typeof RoleService !== \"undefined\" && RoleService) === \"function\" ? _b : Object, typeof (_c = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _c : Object])], AddService);\nexport { AddService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/staff/role/add.service.ts"],"names":[],"mappings":";;;;;;AAAA,SAAS,WAAT;AACA,SAAS,UAAT,QAAyC,iBAAzC;AACA,SAAS,KAAT,EAAgB,MAAhB,QAA8B,UAA9B;AACA,SAAS,GAAT,EAAc,GAAd,QAAyB,gBAAzB;AACA,SAAS,cAAT,QAAkD,qBAAlD;AACA,SAAS,WAAT;AACA,SAAS,SAAT,QAA0B,WAA1B;;AAEA,IAAa,UAAb;AAcE,sBACU,WADV,EAEU,WAFV,EAEkC;AAAA;;AADxB,SAAA,WAAA,GAAA,WAAA;AACA,SAAA,WAAA,GAAA,WAAA;AAfV,SAAA,QAAA,GAAW,IAAI,KAAJ,CAAU,EAAV,CAAX;AACA,SAAA,KAAA,GAAQ,IAAI,KAAJ,CAAU,EAAV,CAAR;AACA,SAAA,SAAA,GAAY,IAAI,KAAJ,CAAU,EAAV,CAAZ;AACA,SAAA,UAAA,GAAa,IAAI,KAAJ,CAAU,EAAV,CAAb;AACA,SAAA,UAAA,GAAa,KAAK,WAAL,CAAiB,WAAjB,CAA6B,uBAA7B,EAAsD,IAAtD,CACX,GAAG,CAAC,UAAA,IAAI,EAAG;AACT,UAAI,GAAG,GAAG,SAAS,CAAC,IAAD,CAAnB;AACA,UAAM,WAAW,GAAG,GAAG,CAAC,CAAD,CAAvB;AACA,MAAA,GAAG,CAAC,CAAD,CAAH,GAAS,GAAG,CAAC,CAAD,CAAZ;AACA,MAAA,GAAG,CAAC,CAAD,CAAH,GAAS,WAAT;AACA,aAAO,GAAP;AACD,KANE,CADQ,CAAb;AAYI;;AAjBN;AAAA;AAAA,kCAkBa;AAAA;;AACT;AACA,aAAO,KAAK,WAAL,CAAiB,WAAjB,CAA6B;AAAE,QAAA,OAAO,EAAE;AAAX,OAA7B,EAA6C,IAA7C,CACL,GAAG,CAAC,UAAA,GAAG,EAAG;AACR,QAAA,KAAI,CAAC,UAAL,CAAgB,MAAhB,CAAuB;AAAA,iBAAM,GAAG,CAAC,UAAV;AAAA,SAAvB;;AACA,QAAA,KAAI,CAAC,SAAL,CAAe,MAAf,CAAsB;AAAA,iBAAM,GAAG,CAAC,SAAV;AAAA,SAAtB;AACD,OAHE,CADE,CAAP;AAMD;AACD;;;;AA3BF;AAAA;AAAA,4BA+BU,KA/BV,EA+B+B;AAAA;;AAC3B,aAAO,KAAK,WAAL,CAAiB,OAAjB,CAAyB,KAAzB,EAAgC,IAAhC,CACL,GAAG,CAAC,UAAA,GAAG,EAAG;AACR,QAAA,MAAI,CAAC,KAAL,CAAW,MAAX,CAAkB;AAAA,iBAAM,GAAG,CAAC,IAAV;AAAA,SAAlB;AACD,OAFE,CADE,CAAP;AAKD;AArCH;AAAA;AAAA,qCAuCmB,EAvCnB,EAuCqC,IAvCrC,EAuCuD;AACnD,aAAO,KAAK,WAAL,EAAP;AACD;AAzCH;;AAAA;AAAA,GAAA;;AA+BE,UAAA,CAAA,CADC,MAAM,EACP,E,mCAAA,E,qDAAe,c,KAAc,W,IAAd,c,MAAc,U,GAAA,E,GAAA,M,EAA7B,E,uCAAA,CAAA,E,oBAAA,E,SAAA,EAMC,IAND,CAAA;;AA/BW,UAAU,GAAA,UAAA,CAAA,CADtB,UAAU,EACY,E,qDAeE,W,KAAW,W,IAAX,W,MAAW,U,GAAA,E,GAAA,M,EAAA,QAAA,EAAA,GAAA,OACX,WADW,KACA,WADA,IACX,WADW,MACA,UADA,GACA,EADA,GACA,M,EAhBb,CAAA,EAAV,UAAU,CAAV;SAAA,U","sourcesContent":["import { UserService } from './../../../../../services/user.service'\nimport { Injectable, ServiceRoute } from 'vue-service-app'\nimport { State, Effect } from 'rx-state'\nimport { tap, map } from 'rxjs/operators'\nimport { GetInitInfoPut, RoleInfo, RoleApi } from '@/api/v1/staff/role'\nimport { RoleService } from '../role.service'\nimport { cloneDeep } from 'lodash-es'\n@Injectable()\nexport class AddService {\n  loading$ = new State({})\n  info$ = new State({})\n  shopList$ = new State({})\n  brandList$ = new State({})\n  dataGrant$ = this.userService.getOptions$('data_grant.data_grant').pipe(\n    map(list => {\n      let arr = cloneDeep(list)\n      const index2Value = arr[2]\n      arr[2] = arr[3]\n      arr[3] = index2Value\n      return arr\n    })\n  )\n  constructor(\n    private roleService: RoleService,\n    private userService: UserService\n  ) {}\n  gitInitInfo() {\n    // 如果是新增角色 初始化角色Id 是 0\n    return this.roleService.getInitInfo({ role_id: 0 }).pipe(\n      tap(res => {\n        this.brandList$.commit(() => res.brand_list)\n        this.shopList$.commit(() => res.shop_list)\n      })\n    )\n  }\n  /**\n   * 获取所有角色详情\n   */\n  @Effect()\n  getInfo(query: GetInitInfoPut) {\n    return this.roleService.getInfo(query).pipe(\n      tap(res => {\n        this.info$.commit(() => res.role)\n      })\n    )\n  }\n\n  beforeRouteEnter(to: ServiceRoute, from: ServiceRoute) {\n    return this.gitInitInfo()\n  }\n}\n"],"sourceRoot":""}]}