{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-3!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/package/info.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/package/info.service.ts","mtime":1594718340375},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b, _c;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { Injectable } from 'vue-service-app';\nimport { State } from 'rx-state';\nimport { BrandPackageApi } from '@/api/v1/package/brand';\nimport { CommonPackageApi } from '@/api/v1/package/common';\nimport { anyAll } from '@/operators';\nimport { UserService } from '@/services/user.service';\nimport { tap } from 'rxjs/operators';\n\nvar InfoService = /*#__PURE__*/function () {\n  function InfoService(userService, brandPackageApi, commonApi) {\n    _classCallCheck(this, InfoService);\n\n    this.userService = userService;\n    this.brandPackageApi = brandPackageApi;\n    this.commonApi = commonApi;\n    this.info$ = new State({});\n    this.auth$ = new State({});\n    this.page$ = new State({});\n    this.loading$ = new State({});\n    this.coachList$ = new State([]);\n    this.RANGE = 2;\n    this.FIXATION = 3;\n    this.UNLIMITED = 1; // 单门店\n\n    this.SINGLE_SHOP = 1; // 多门店\n\n    this.MANY_SHOP = 2; // 全部门店\n\n    this.ALL_SHOP = 3;\n    this.saleMode$ = this.userService.getOptions$('package_course.sale_mode');\n    this.packageType$ = this.userService.getOptions$('package_course.package_type');\n    this.validTimeUnit$ = this.userService.getOptions$('package_course.valid_time_unit'); // 是否配置了用户端\n\n    this.reserveLimitDay$ = this.userService.getOptions$('package_course.reserve_limit_day');\n    this.reserveIsLimit$ = this.userService.getOptions$('package_course.reserve_is_limit');\n  }\n\n  _createClass(InfoService, [{\n    key: \"SET_INFO\",\n    value: function SET_INFO(info) {\n      var _saleShopMap, _useShopMap;\n\n      var saleMode$ = this.saleMode$.snapshot().map(function (item) {\n        return item.label;\n      });\n      var reserveLimitDay$ = this.reserveLimitDay$.snapshot();\n      var validTimeUnit$ = this.validTimeUnit$.snapshot().map(function (item) {\n        return item.label;\n      });\n      info.validTimeUnit = \"\\u5F00\\u59CB\\u751F\\u6548\\u540E\".concat(info.valid_time).concat(validTimeUnit$[info.valid_time_unit - 1], \"\\u6709\\u6548\");\n      info.priceText = \"\".concat(info.price, \"\\u5143\");\n      var unit = '';\n      reserveLimitDay$.map(function (item) {\n        if (item.value === info.reserve_limit_day) {\n          unit = item.label;\n        }\n      });\n      var allCoachList = this.coachList$.snapshot();\n      console.log(allCoachList);\n\n      if (info.personal_range && info.personal_range.length) {\n        info.personal_range = info.personal_range.map(function (item) {\n          item.coachLevel = allCoachList.length === item.coach_level.length ? '全部等级' : \"\".concat(item.coach_level.length, \"\\u4E2A\\u7B49\\u7EA7\");\n          return item;\n        });\n      }\n\n      var saleShopMap = (_saleShopMap = {}, _defineProperty(_saleShopMap, this.SINGLE_SHOP, info.shop_name), _defineProperty(_saleShopMap, this.MANY_SHOP, \"\\u6307\\u5B9A\\u95E8\\u5E97 \\uFF08\\u5DF2\\u4E0A\\u67B6\".concat(info.up_shop_num, \"/\\u5171\").concat(info.sale_shop_list.length, \"\\u5BB6\\u95E8\\u5E97\\uFF09\")), _defineProperty(_saleShopMap, this.ALL_SHOP, '全门店'), _saleShopMap);\n      var useShopMap = (_useShopMap = {}, _defineProperty(_useShopMap, this.SINGLE_SHOP, info.shop_name), _defineProperty(_useShopMap, this.MANY_SHOP, \"\\u5171\".concat(info.use_shop_list.length, \"\\u5BB6\\u95E8\\u5E97\")), _defineProperty(_useShopMap, this.ALL_SHOP, '全门店'), _useShopMap);\n      info.saleRangeName = saleShopMap[info.sale_range];\n      info.useRangeName = useShopMap[info.use_range];\n      info.reserveIsLimit = info.reserve_is_limit === 0 ? '不限制' : \"\\u6BCF\".concat(unit, \"\\u7EA6\\u8BFE\\uFF0C\\u6700\\u591A\").concat(info.reserve_limit_times, \"\\u6B21\");\n      info.saleMode = info.sale_mode.map(function (idx) {\n        return saleMode$[idx - 1];\n      }).join('/');\n      info.isAllowTransfer = info.is_allow_transfer ? \"\".concat(info.transfer_rate).concat(info.transfer_unit === 1 ? '%' : '元') : '不支持转让'; // 允许冻结天数\n\n      info.frozenDays = \"\".concat(info.frozen_days, \"\\u5929\");\n      this.info$.commit(function () {\n        return info;\n      });\n    }\n  }, {\n    key: \"getInfo\",\n    value: function getInfo(query) {\n      var _this = this;\n\n      return this.brandPackageApi.getPackageDetailInfo(query).pipe(tap(function (res) {\n        _this.SET_INFO(res.info);\n\n        _this.auth$.commit(function () {\n          return res.auth;\n        });\n      }));\n    }\n  }, {\n    key: \"init\",\n    value: function init(query) {\n      var _map;\n\n      var map = (_map = {}, _defineProperty(_map, this.RANGE, 'range'), _defineProperty(_map, this.FIXATION, 'fixation'), _defineProperty(_map, this.UNLIMITED, 'unlimited'), _map);\n      var packageType = map[query.packageType];\n      return anyAll(this.getInfo({\n        id: +query.id,\n        packageType: packageType\n      }), this.getCoachList());\n    }\n  }, {\n    key: \"getCoachList\",\n    value: function getCoachList() {\n      var _this2 = this;\n\n      return this.commonApi.getCoachList().pipe(tap(function (res) {\n        _this2.coachList$.commit(function () {\n          return res.list;\n        });\n      }));\n    }\n  }, {\n    key: \"beforeRouteEnter\",\n    value: function beforeRouteEnter(to, from) {\n      return this.init(to.query);\n    }\n  }]);\n\n  return InfoService;\n}();\n\nInfoService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _a : Object, typeof (_b = typeof BrandPackageApi !== \"undefined\" && BrandPackageApi) === \"function\" ? _b : Object, typeof (_c = typeof CommonPackageApi !== \"undefined\" && CommonPackageApi) === \"function\" ? _c : Object])], InfoService);\nexport { InfoService };",null]}