{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/course/manage/small-course/edit#/create-group-course.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/course/manage/small-course/edit#/create-group-course.vue","mtime":1600926556391},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { EditService } from \"../edit.service\";\nimport { MessageService } from '@/services/message.service';\nimport { UserService } from '@/services/user.service';\nimport { ruleOptions } from \"../form.config\";\nimport { PatternService } from '@/services/pattern.service';\nimport CardBgRadio from '@/views/biz-components/card-bg-radio/card-bg-radio';\nimport StEditor from '@/views/components/editor#/editor.vue';\nimport { CLASS_STATUS } from '@/constants/course/small-course';\nexport default {\n  name: 'create-group-course',\n  serviceInject: function serviceInject() {\n    return {\n      editService: EditService,\n      messageService: MessageService,\n      userService: UserService,\n      pattern: PatternService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.editService.loading$,\n      rangeList: this.editService.rangeList$,\n      isAllowLeave: this.editService.isAllowLeave$\n    };\n  },\n  props: {\n    info: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    }\n  },\n  bem: {\n    b: 'create-group-course'\n  },\n  components: {\n    CardBgRadio: CardBgRadio,\n    StEditor: StEditor\n  },\n  computed: {\n    isDisabled: function isDisabled() {\n      return this.CLASS_STATUS.SIGNING_UNCLASSED === this.info.info.class_status || this.CLASS_STATUS.SIGNING_CLASSED === this.info.info.class_status || this.CLASS_STATUS.CLASSED === this.info.info.class_status;\n    }\n  },\n  mounted: function mounted() {\n    this.isShowLimitContent = this.$route.query.type === '1';\n    this.$emit('onCourseNameChange', this.info.info.course_name);\n    this.$emit('onCourseIdChange', this.info.info.course_id);\n  },\n  data: function data(vm) {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      bg_image: {\n        image_id: 0,\n        image_key: '',\n        image_url: '',\n        index: 1\n      },\n      isShowLeaveContent: false,\n      isShowLimitContent: false,\n      CLASS_STATUS: CLASS_STATUS\n    };\n  },\n  methods: {\n    onInitEditor: function onInitEditor() {\n      this.$nextTick(this.setFieldsValue());\n    },\n    setFieldsValue: function setFieldsValue() {\n      var info = this.info.info;\n      this.form.setFieldsValue({\n        course_name: info.course_name,\n        scope_application: info.scope_application,\n        date: info.course_begin_time ? [moment(info.course_begin_time), moment(info.course_end_time)] : [],\n        num_min: info.num_min,\n        num_max: info.num_max,\n        course_times: info.course_times,\n        is_leave: this.isShowLimitContent ? info.is_leave : undefined,\n        leave_hours: this.isShowLimitContent ? info.leave_hours : undefined,\n        leave_limit: this.isShowLimitContent ? info.leave_limit : undefined,\n        appointment_rights: !this.isShowLimitContent ? info.appointment_rights : undefined,\n        image: info.image\n      });\n      this.bg_image.index = info.img_type;\n\n      if (info.img_type === 3) {\n        this.bg_image = info.image;\n        this.bg_image.index = 0;\n      }\n\n      this.isShowLeaveContent = this.isShowLimitContent && info.is_leave === 1;\n    },\n    save: function save(e) {\n      var _this = this;\n\n      e.preventDefault();\n      this.form.validate().then(function (values) {\n        values.id = _this.info.info.course_id;\n        values.course_begin_time = values.date[0].format('YYYY-MM-DD');\n        values.course_end_time = values.date[1].format('YYYY-MM-DD');\n        values.small_course_type = _this.$route.query.type;\n        values.image = _this.bg_image;\n        values.img_type = _this.bg_image.index;\n\n        if (!_this.isShowLeaveContent) {\n          delete values.leave_hours;\n          delete values.leave_limit;\n        }\n\n        if (_this.bg_image.index === 0) {\n          values.img_type = 3;\n\n          if (!_this.bg_image.image_url) {\n            _this.messageService.error({\n              content: '请上传图片'\n            });\n\n            return;\n          }\n        }\n\n        delete values.date;\n\n        _this.editService.editGroup(values).subscribe(function (res) {\n          _this.messageService.success({\n            content: '提交成功'\n          });\n\n          _this.$emit('goNext', res.course_id);\n        });\n      });\n    },\n    onLimitChange: function onLimitChange(e) {\n      this.isShowLeaveContent = e.target.value === 1;\n    },\n    onCourseTypeChange: function onCourseTypeChange(category_id) {\n      this.form.setFieldsValue({\n        category_id: category_id\n      });\n    },\n    onCourseNameChange: function onCourseNameChange(e) {\n      this.$emit('onCourseNameChange', e.target.value);\n    },\n    disabledDate: function disabledDate(current) {\n      return current && current.format('YYYY-MM-DD') < moment().add(1, 'day').format('YYYY-MM-DD');\n    }\n  }\n};",{"version":3,"sources":["create-group-course.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-form :form=\"form\" class=\"page-create-container\" labelWidth=\"130px\">\n    <a-row :gutter=\"8\">\n      <a-col :lg=\"11\" :xs=\"22\">\n        <st-form-item required>\n          <template slot=\"label\">{{ $c('small_course') }}名称</template>\n          <a-input\n            placeholder=\"支持输入1~30个字的课程名称\"\n            maxlength=\"30\"\n            disabled\n            v-decorator=\"decorators.course_name\"\n            @change=\"onCourseNameChange\"\n          />\n        </st-form-item>\n      </a-col>\n    </a-row>\n    <a-row :gutter=\"8\">\n      <a-col :lg=\"11\" :xs=\"22\">\n        <st-form-item label=\"适用范围\" required>\n          <a-select\n            @change=\"onCourseTypeChange\"\n            mode=\"multiple\"\n            v-decorator=\"decorators.scope_application\"\n            placeholder=\"请选择适用范围\"\n          >\n            <a-select-option\n              v-for=\"item in rangeList\"\n              :key=\"item.id\"\n              :value=\"item.id\"\n            >\n              {{ item.setting_name }}\n            </a-select-option>\n          </a-select>\n        </st-form-item>\n      </a-col>\n    </a-row>\n    <a-row :gutter=\"8\">\n      <a-col :lg=\"11\" :xs=\"22\">\n        <st-form-item label=\"开班时间\" required>\n          <a-range-picker\n            :disabled=\"isDisabled\"\n            style=\"width: 100%;\"\n            :disabledDate=\"disabledDate\"\n            format=\"YYYY-MM-DD\"\n            v-decorator=\"decorators.date\"\n          ></a-range-picker>\n        </st-form-item>\n      </a-col>\n    </a-row>\n    <a-row :gutter=\"8\" style=\"height: 56px; overflow: hidden;\">\n      <a-col :lg=\"11\" :xs=\"22\">\n        <st-form-item required>\n          <template slot=\"label\">\n            人数限制\n            <st-help-tooltip id=\"TSXBK001\" />\n          </template>\n          <div :class=\"b('num-limit')\">\n            <a-form-item class=\"page-a-form\">\n              <st-input-number\n                placeholder=\"请输入人数下限\"\n                v-decorator=\"decorators.num_min\"\n                :disabled=\"isDisabled\"\n                :min=\"1\"\n                :max=\"49\"\n              >\n                <template slot=\"addonAfter\">\n                  人\n                </template>\n              </st-input-number>\n            </a-form-item>\n            <span>~</span>\n            <a-form-item class=\"page-a-form\">\n              <st-input-number\n                placeholder=\"请输入人数上限\"\n                v-decorator=\"decorators.num_max\"\n                :min=\"1\"\n                :max=\"50\"\n              >\n                <template slot=\"addonAfter\">\n                  人\n                </template>\n              </st-input-number>\n            </a-form-item>\n          </div>\n        </st-form-item>\n      </a-col>\n    </a-row>\n    <a-row :gutter=\"8\">\n      <a-col :lg=\"11\" :xs=\"22\">\n        <st-form-item label=\"总课时\" required>\n          <st-input-number\n            placeholder=\"请输入总课时\"\n            :disabled=\"isDisabled\"\n            v-decorator=\"decorators.course_times\"\n            :min=\"1\"\n            :max=\"99999\"\n          >\n            <template slot=\"addonAfter\">\n              节\n            </template>\n          </st-input-number>\n        </st-form-item>\n      </a-col>\n    </a-row>\n    <!-- 固定约课有的表单 -->\n    <a-row :gutter=\"8\" v-show=\"isShowLimitContent\">\n      <a-col :lg=\"11\" :xs=\"22\">\n        <st-form-item required type=\"text\">\n          <template slot=\"label\">\n            请假限制\n            <st-help-tooltip id=\"TSXBK002\" />\n          </template>\n          <a-radio-group\n            v-decorator=\"decorators.is_leave\"\n            @change=\"onLimitChange\"\n          >\n            <a-radio\n              v-for=\"(item, index) in isAllowLeave\"\n              :key=\"index\"\n              :value=\"item.value\"\n            >\n              {{ item.label }}\n            </a-radio>\n          </a-radio-group>\n          <st-pop-container\n            offset=\"122px\"\n            class=\"mg-t8\"\n            v-show=\"isShowLeaveContent\"\n          >\n            <div class=\"mg-b8\">\n              <span class=\"mg-r8\">允许请假时间,上课前</span>\n              <st-input-number\n                v-decorator=\"decorators.leave_hours\"\n                :min=\"1\"\n                :max=\"72\"\n                style=\"width: 128px;\"\n              >\n                <template slot=\"addonAfter\">\n                  h\n                </template>\n              </st-input-number>\n            </div>\n            <div>\n              <span class=\"mg-r8\">请假上限节数</span>\n              <st-input-number\n                :min=\"1\"\n                v-decorator=\"decorators.leave_limit\"\n                style=\"width: 178px;\"\n              >\n                <template slot=\"addonAfter\">\n                  节\n                </template>\n              </st-input-number>\n            </div>\n          </st-pop-container>\n        </st-form-item>\n      </a-col>\n    </a-row>\n    <!-- 自主约课有的表单内容 -->\n    <a-row :gutter=\"8\" v-show=\"!isShowLimitContent\">\n      <a-col :lg=\"11\" :xs=\"22\">\n        <st-form-item label=\"约课规则\" required type=\"text\">\n          每周最大约课节数\n          <st-input-number\n            style=\"width: 100px;\"\n            :min=\"1\"\n            v-decorator=\"decorators.appointment_rights\"\n          >\n            <template slot=\"addonAfter\">\n              节\n            </template>\n          </st-input-number>\n        </st-form-item>\n      </a-col>\n    </a-row>\n    <a-row :gutter=\"8\">\n      <a-col :lg=\"22\" :xs=\"22\">\n        <st-form-item label=\"背景图\" required type=\"text\">\n          <card-bg-radio isSmallCourse v-model=\"bg_image\" />\n        </st-form-item>\n      </a-col>\n    </a-row>\n    <a-row :gutter=\"8\">\n      <a-col :span=\"18\">\n        <st-form-item label=\"课程介绍\">\n          <st-editor\n            v-decorator=\"decorators.description\"\n            @ready=\"onInitEditor\"\n          ></st-editor>\n        </st-form-item>\n      </a-col>\n    </a-row>\n    <a-row :gutter=\"8\">\n      <a-col :lg=\"11\" :xs=\"22\">\n        <st-form-item labelFix>\n          <st-button type=\"primary\" @click=\"save\" :loading=\"loading.editGroup\">\n            保存，开始设置{{ $c('coach') }}信息\n          </st-button>\n        </st-form-item>\n      </a-col>\n    </a-row>\n  </st-form>\n</template>\n\n<script>\nimport { EditService } from '../edit.service'\nimport { MessageService } from '@/services/message.service'\nimport { UserService } from '@/services/user.service'\nimport { ruleOptions } from '../form.config'\nimport { PatternService } from '@/services/pattern.service'\nimport CardBgRadio from '@/views/biz-components/card-bg-radio/card-bg-radio'\nimport StEditor from '@/views/components/editor#/editor.vue'\nimport { CLASS_STATUS } from '@/constants/course/small-course'\n\nexport default {\n  name: 'create-group-course',\n  serviceInject() {\n    return {\n      editService: EditService,\n      messageService: MessageService,\n      userService: UserService,\n      pattern: PatternService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.editService.loading$,\n      rangeList: this.editService.rangeList$,\n      isAllowLeave: this.editService.isAllowLeave$\n    }\n  },\n  props: {\n    info: {\n      type: Object,\n      default() {\n        return {}\n      }\n    }\n  },\n  bem: {\n    b: 'create-group-course'\n  },\n  components: { CardBgRadio, StEditor },\n  computed: {\n    isDisabled() {\n      return (\n        this.CLASS_STATUS.SIGNING_UNCLASSED === this.info.info.class_status ||\n        this.CLASS_STATUS.SIGNING_CLASSED === this.info.info.class_status ||\n        this.CLASS_STATUS.CLASSED === this.info.info.class_status\n      )\n    }\n  },\n  mounted() {\n    this.isShowLimitContent = this.$route.query.type === '1'\n    this.$emit('onCourseNameChange', this.info.info.course_name)\n    this.$emit('onCourseIdChange', this.info.info.course_id)\n  },\n  data(vm) {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      bg_image: {\n        image_id: 0,\n        image_key: '',\n        image_url: '',\n        index: 1\n      },\n      isShowLeaveContent: false,\n      isShowLimitContent: false,\n      CLASS_STATUS\n    }\n  },\n  methods: {\n    onInitEditor() {\n      this.$nextTick(this.setFieldsValue())\n    },\n    setFieldsValue() {\n      const info = this.info.info\n      this.form.setFieldsValue({\n        course_name: info.course_name,\n        scope_application: info.scope_application,\n        date: info.course_begin_time\n          ? [moment(info.course_begin_time), moment(info.course_end_time)]\n          : [],\n        num_min: info.num_min,\n        num_max: info.num_max,\n        course_times: info.course_times,\n        is_leave: this.isShowLimitContent ? info.is_leave : undefined,\n        leave_hours: this.isShowLimitContent ? info.leave_hours : undefined,\n        leave_limit: this.isShowLimitContent ? info.leave_limit : undefined,\n        appointment_rights: !this.isShowLimitContent\n          ? info.appointment_rights\n          : undefined,\n        image: info.image\n      })\n      this.bg_image.index = info.img_type\n      if (info.img_type === 3) {\n        this.bg_image = info.image\n        this.bg_image.index = 0\n      }\n      this.isShowLeaveContent = this.isShowLimitContent && info.is_leave === 1\n    },\n    save(e) {\n      e.preventDefault()\n      this.form.validate().then(values => {\n        values.id = this.info.info.course_id\n        values.course_begin_time = values.date[0].format('YYYY-MM-DD')\n        values.course_end_time = values.date[1].format('YYYY-MM-DD')\n        values.small_course_type = this.$route.query.type\n        values.image = this.bg_image\n        values.img_type = this.bg_image.index\n        if (!this.isShowLeaveContent) {\n          delete values.leave_hours\n          delete values.leave_limit\n        }\n        if (this.bg_image.index === 0) {\n          values.img_type = 3\n          if (!this.bg_image.image_url) {\n            this.messageService.error({\n              content: '请上传图片'\n            })\n            return\n          }\n        }\n        delete values.date\n        this.editService.editGroup(values).subscribe(res => {\n          this.messageService.success({\n            content: '提交成功'\n          })\n          this.$emit('goNext', res.course_id)\n        })\n      })\n    },\n    onLimitChange(e) {\n      this.isShowLeaveContent = e.target.value === 1\n    },\n    onCourseTypeChange(category_id) {\n      this.form.setFieldsValue({\n        category_id\n      })\n    },\n    onCourseNameChange(e) {\n      this.$emit('onCourseNameChange', e.target.value)\n    },\n    disabledDate(current) {\n      return (\n        current &&\n        current.format('YYYY-MM-DD') <\n          moment()\n            .add(1, 'day')\n            .format('YYYY-MM-DD')\n      )\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/shop/product/course/manage/small-course/edit#"}]}