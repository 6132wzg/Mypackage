{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"brand-setting-task\"],{2639:function(t,e,n){\"use strict\";n.r(e);var i,a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"st-panel\",{attrs:{app:\"\"}},[n(\"st-refresh-btn\",{staticClass:\"mg-b16\",attrs:{date:t.last_updated_time,action:t.refresh,rangeTime:120}}),n(\"st-table\",{attrs:{page:t.page,loading:t.loading.getList,columns:t.columns,dataSource:t.list,rowKey:\"id\"},on:{change:t.onTableChange},scopedSlots:t._u([{key:\"task_status\",fn:function(e,i){return[n(\"st-text\",{attrs:{status:{default:i.task_status.code===t.TASK_STATUS.PENDING,info:i.task_status.code===t.TASK_STATUS.IN_HAND,warning:i.task_status.code===t.TASK_STATUS.PAUSE,success:i.task_status.code===t.TASK_STATUS.SUCCESS}}},[t._v(\"\\n        \"+t._s(i.task_status.status)+\"\\n      \")])]}},{key:\"task_type\",fn:function(e,n){return[t._v(\"\\n      \"+t._s(n.task_type.name)+\"\\n    \")]}},{key:\"total_num\",fn:function(e,i){return[n(\"a\",{on:{click:function(e){return t.onClickModal(i.id,\"total\")}}},[t._v(\"\\n        \"+t._s(e)+\"\\n      \")])]}},{key:\"success_num\",fn:function(e,i){return[n(\"a\",{on:{click:function(e){return t.onClickModal(i.id,\"success\")}}},[t._v(\"\\n        \"+t._s(e)+\"\\n      \")])]}},{key:\"fail_num\",fn:function(e,i){return[n(\"a\",{on:{click:function(e){return t.onClickModal(i.id,\"fail\")}}},[t._v(\"\\n        \"+t._s(e)+\"\\n      \")])]}},{key:\"action\",fn:function(e,i){return n(\"div\",{},[n(\"st-table-actions\",[i.auth[\"brand:task:task_center|end\"]?n(\"st-popconfirm\",{attrs:{title:\"确认要终止该任务么？\"},on:{confirm:function(e){return t.stopTask(i)}}},[n(\"a\",[t._v(\"\\n            终止任务\\n          \")])]):t._e()],1)],1)}}])})],1)},s=[],c=n(\"a569\"),r=function(){return[{title:\"时间\",dataIndex:\"task_time\"},{title:\"任务来源\",dataIndex:\"task_source\",scopedSlots:{customRender:\"task_source\"}},{title:\"所属模块\",dataIndex:\"task_type\",scopedSlots:{customRender:\"task_type\"}},{title:\"任务状态\",width:80,dataIndex:\"task_status\",scopedSlots:{customRender:\"task_status\"}},{title:\"任务名称\",dataIndex:\"task_name\"},{title:\"总数\",dataIndex:\"total_num\",scopedSlots:{customRender:\"total_num\"}},{title:\"成功数\",dataIndex:\"success_num\",scopedSlots:{customRender:\"success_num\"}},{title:\"失败数\",dataIndex:\"fail_num\",scopedSlots:{customRender:\"fail_num\"}},{title:\"操作人\",dataIndex:\"operator_name\"},{title:\"操作\",dataIndex:\"action\",scopedSlots:{customRender:\"action\"}}]},o=n(\"ea3e\"),u=n(\"fb96\"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"st-modal\",{attrs:{title:\"任务明细\",footer:null,wrapClassName:\"scroll-modal\"},model:{value:t.show,callback:function(e){t.show=e},expression:\"show\"}},[n(\"st-table\",{class:t.list.length>0?\"st-scroll-data\":\"\",attrs:{rowKey:\"id\",loading:t.loading.getDetailList,dataSource:t.list,columns:t.columns,simplePage:!0,page:t.page},on:{change:t.onPageChange}})],1)},l=[],p=(n(\"c5f6\"),n(\"d225\")),f=n(\"b0b4\"),_=n(\"9ab4\"),b=n(\"0cd5\"),g=n(\"df29\"),h=n(\"dc16\"),m=n(\"c4cc\"),k=function(){function t(e){Object(p[\"a\"])(this,t),this.taskApi=e,this.loading$=new g[\"d\"]({}),this.list$=new g[\"d\"]([]),this.page$=new g[\"d\"]({current_page:1,size:20,total_counts:1,total_pages:1})}return Object(f[\"a\"])(t,[{key:\"getDetailList\",value:function(t){var e=this;return this.taskApi.getDetailList(t).pipe(Object(m[\"a\"])((function(t){e.list$.commit((function(){return t.list})),e.page$.commit((function(){return t.page}))})))}}]),t}();Object(_[\"b\"])([Object(g[\"c\"])(),Object(_[\"d\"])(\"design:type\",Function),Object(_[\"d\"])(\"design:paramtypes\",[Object]),Object(_[\"d\"])(\"design:returntype\",void 0)],k.prototype,\"getDetailList\",null),k=Object(_[\"b\"])([Object(b[\"b\"])(),Object(_[\"d\"])(\"design:paramtypes\",[\"function\"===typeof(i=\"undefined\"!==typeof h[\"a\"]&&h[\"a\"])?i:Object])],k);var S=function(){return[{title:\"合同编号\",dataIndex:\"contract_number\",width:\"30%\"},{title:\"会员姓名\",dataIndex:\"member_name\",width:\"30%\"},{title:\"类型\",dataIndex:\"task_type\",width:\"10%\"},{title:\"执行时间\",dataIndex:\"task_time\",width:\"30%\"}]},y={name:\"ModalSettingTaskDetail\",serviceInject:function(){return{detailService:k}},rxState:function(){return{loading:this.detailService.loading$,list:this.detailService.list$,page:this.detailService.page$}},computed:{columns:S},props:{task_id:{type:[String,Number]},popup_type:{type:String}},data:function(){return{show:!1}},created:function(){this.getDetailList({task_id:this.task_id,popup_type:this.popup_type,size:20,current_page:1})},methods:{getDetailList:function(t){return this.detailService.getDetailList(t).subscribe()},onPageChange:function(t){this.getDetailList({task_id:this.task_id,popup_type:this.popup_type,size:t.pageSize,current_page:t.current})}}},v=y,j=n(\"2877\"),O=Object(j[\"a\"])(v,d,l,!1,null,null,null),w=O.exports,T=n(\"e69b\"),$={mixins:[o[\"a\"]],name:\"PageBrandSettingShopList\",serviceInject:function(){return{messageService:T[\"a\"],listService:c[\"ListService\"]}},rxState:function(){return{loading:this.listService.loading$,last_updated_time:this.listService.last_updated_time$,list:this.listService.list$,page:this.listService.page$}},computed:{columns:r},modals:{BrandTaskDetail:w},data:function(){return{TASK_STATUS:u[\"a\"]}},methods:{refresh:function(){return this.listService.getList(this.$searchQuery)},onClickModal:function(t,e){this.$modalRouter.push({name:\"brand-task-detail\",props:{task_id:t,popup_type:e},on:{}})},stopTask:function(t){var e=this;this.listService.stopTask(t.id).subscribe((function(t){e.messageService.success({content:\"终止任务成功!\"}),e.$router.reload()}))}}},x=$,I=Object(j[\"a\"])(x,a,s,!1,null,null,null);e[\"default\"]=I.exports},a569:function(t,e,n){\"use strict\";n.r(e),n.d(e,\"ListService\",(function(){return f}));var i,a,s=n(\"d225\"),c=n(\"b0b4\"),r=n(\"9ab4\"),o=n(\"0cd5\"),u=n(\"df29\"),d=n(\"dc16\"),l=n(\"c4cc\"),p=n(\"2cbb\"),f=function(){function t(e,n){Object(s[\"a\"])(this,t),this.taskApi=e,this.authService=n,this.loading$=new u[\"d\"]({}),this.list$=new u[\"d\"]([]),this.page$=new u[\"d\"]({}),this.last_updated_time$=new u[\"d\"](\"\")}return Object(c[\"a\"])(t,[{key:\"getList\",value:function(t){var e=this;return this.taskApi.getList(t).pipe(Object(l[\"a\"])((function(t){e.last_updated_time$.commit((function(){return t.last_updated_time})),e.list$.commit((function(){return t.list})),e.page$.commit((function(){return t.page}))})))}},{key:\"stopTask\",value:function(t){return this.taskApi.stopTask(t)}},{key:\"beforeEach\",value:function(t){return this.getList(t.meta.query)}}]),t}();Object(r[\"b\"])([Object(u[\"c\"])(),Object(r[\"d\"])(\"design:type\",Function),Object(r[\"d\"])(\"design:paramtypes\",[Object]),Object(r[\"d\"])(\"design:returntype\",void 0)],f.prototype,\"getList\",null),f=Object(r[\"b\"])([Object(o[\"b\"])(),Object(r[\"d\"])(\"design:paramtypes\",[\"function\"===typeof(i=\"undefined\"!==typeof d[\"a\"]&&d[\"a\"])?i:Object,\"function\"===typeof(a=\"undefined\"!==typeof p[\"a\"]&&p[\"a\"])?a:Object])],f)},dc16:function(t,e,n){\"use strict\";n.d(e,\"a\",(function(){return l}));n(\"6b54\"),n(\"2397\");var i=n(\"d225\"),a=n(\"b0b4\"),s=n(\"308d\"),c=n(\"6bb5\"),r=n(\"4e2b\"),o=n(\"de46\");function u(t){return function(){var e,n=Object(c[\"a\"])(t);if(d()){var i=Object(c[\"a\"])(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return Object(s[\"a\"])(this,e)}}function d(){if(\"undefined\"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var l=function(t){Object(r[\"a\"])(n,t);var e=u(n);function n(){return Object(i[\"a\"])(this,n),e.apply(this,arguments)}return Object(a[\"a\"])(n,[{key:\"getList\",value:function(t){return this.http.get(\"/v1/setting/brand/task\",{query:t})}},{key:\"getDetailList\",value:function(t){return this.http.get(\"/v1/setting/brand/task/\".concat(t.task_id),{query:t})}},{key:\"stopTask\",value:function(t){return this.http.delete(\"/v1/setting/brand/task/\".concat(t))}}]),n}(o[\"a\"])},fb96:function(t,e,n){\"use strict\";var i;n.d(e,\"a\",(function(){return i})),function(t){t[t[\"PENDING\"]=1]=\"PENDING\",t[t[\"IN_HAND\"]=2]=\"IN_HAND\",t[t[\"PAUSE\"]=3]=\"PAUSE\",t[t[\"SUCCESS\"]=4]=\"SUCCESS\"}(i||(i={}))}}]);","extractedComments":[]}