{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/brand/app/plugin/send-coupon/batch-send.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/brand/app/plugin/send-coupon/batch-send.vue","mtime":1600926555821},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.number.constructor\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { ruleOptions } from \"./batch-send.config\";\nimport { BatchSendService } from \"./batch-send.service\";\nimport { USER_TYPES } from '@/constants/plugin/send-coupon';\nimport { MessageService } from '@/services/message.service';\nimport { PatternService } from '@/services/pattern.service';\nimport AllMemberSelect from '@/views/biz-components/member/all-member-select/all-member-select.vue';\nimport CouponSelect from '@/views/biz-components/plugin/coupon-select/index.vue';\nexport default {\n  name: 'BrandAppPluginSendCouponBatchSend',\n  bem: {\n    bModal: 'brand-app-plugin-send-coupon-batch-send'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      batchSendService: BatchSendService,\n      messageService: MessageService,\n      pattern: PatternService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.batchSendService.loading$,\n      userType: this.batchSendService.userType$,\n      crowdList: this.batchSendService.crowdList$\n    };\n  },\n  components: {\n    AllMemberSelect: AllMemberSelect,\n    CouponSelect: CouponSelect\n  },\n  props: {\n    couponId: {\n      type: Number\n    },\n    crowdId: {\n      type: Number\n    },\n    title: {\n      type: String,\n      default: '定向发券'\n    }\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      USER_TYPES: USER_TYPES,\n      show: false,\n      curUser: USER_TYPES.USER,\n      tel: '',\n      selectCouponId: '',\n      selectMemberId: ''\n    };\n  },\n  mounted: function mounted() {\n    if (this.couponId) {\n      this.selectCouponId = this.couponId;\n    }\n\n    if (this.crowdId) {\n      this.curUser = USER_TYPES.CROWD;\n      this.form.setFieldsValue({\n        type: USER_TYPES.CROWD,\n        send_value: this.crowdId\n      });\n    }\n\n    this.getCrowdList();\n  },\n  methods: {\n    // 获取人群列表\n    getCrowdList: function getCrowdList() {\n      return this.batchSendService.getCrowdList().subscribe();\n    },\n    getCurPrizUserType: function getCurPrizUserType(e) {\n      this.curUser = e.target.value;\n    },\n    // 跳转到新增人群\n    goCrowd: function goCrowd() {\n      this.$router.push('/brand/marketing/plugin/crowd/index');\n      this.show = false;\n    },\n    onMemberSelect: function onMemberSelect(id) {\n      this.selectMemberId = id;\n    },\n    onCouponSelectChange: function onCouponSelectChange(val) {\n      this.selectCouponId = val;\n    },\n    save: function save() {\n      var _this = this;\n\n      var h = this.$createElement;\n      this.form.validate(function (error, values) {\n        var _types;\n\n        var errMsg = '';\n        var types = (_types = {}, _defineProperty(_types, USER_TYPES.USER, function () {\n          if (!_this.selectMemberId) {\n            errMsg = '请选择会员';\n            return;\n          }\n\n          values.send_users = [_this.selectMemberId];\n        }), _defineProperty(_types, USER_TYPES.MOBILE, function () {\n          if (!_this.tel) {\n            errMsg = '请输入手机号';\n            return;\n          }\n\n          var telArr = _this.tel.split(/[\\n]/);\n\n          for (var i = 0; i < telArr.length; i++) {\n            if (!_this.pattern.MOBILE.test(telArr[i].trim())) {\n              errMsg = '请输入正确格式手机号';\n              return;\n            }\n          }\n\n          values.send_users = _this.tel.split(/[\\n]/);\n        }), _defineProperty(_types, USER_TYPES.CROWD, function () {\n          if (!values.send_value) {\n            errMsg = '请选择人群';\n            return;\n          }\n\n          values.send_users = [values.send_value];\n        }), _defineProperty(_types, USER_TYPES.ALL, function () {}), _types); // 校验输入\n\n        types[values.type]();\n\n        if (errMsg) {\n          _this.messageService.warn({\n            content: errMsg\n          });\n\n          return;\n        }\n\n        if (!_this.selectCouponId) {\n          _this.messageService.warn({\n            content: '请选择优惠券'\n          });\n\n          return;\n        }\n\n        values.coupon_id = _this.selectCouponId;\n        return _this.batchSendService.sendCoupon(_objectSpread({}, values)).subscribe(function (res) {\n          _this.$confirm({\n            title: '发券成功',\n            content: '您可以推送短信，告知客户有新的优惠券到账哦~',\n            okText: '短信推送',\n            icon: function icon() {\n              return h(\"st-icon\", {\n                \"attrs\": {\n                  \"type\": \"anticon:check-circle\",\n                  \"size\": \"22px\",\n                  \"color\": \"#52c41a\"\n                }\n              });\n            },\n            onOk: function onOk() {\n              _this.$router.push({\n                name: 'brand-setting-sms-group'\n              });\n            }\n          });\n\n          _this.$emit('success');\n\n          _this.show = false;\n        });\n      });\n    }\n  }\n};",{"version":3,"sources":["batch-send.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal\n    :class=\"bModal()\"\n    :title=\"title\"\n    v-model=\"show\"\n    @ok=\"save\"\n    :confirmLoading=\"loading.sendCoupon\"\n  >\n    <st-form :form=\"form\">\n      <st-form-item\n        label=\"接受对象\"\n        :class=\"bModal('form')\"\n        :help=\"curUser === USER_TYPES.MOBILE ? '必须为系统内会员的手机号' : ''\"\n      >\n        <a-radio-group\n          v-decorator=\"decorators.type\"\n          @change=\"getCurPrizUserType\"\n        >\n          <a-radio\n            v-for=\"(item, index) in userType\"\n            :key=\"index\"\n            :value=\"item.value\"\n          >\n            {{ item.label }}\n          </a-radio>\n        </a-radio-group>\n\n        <all-member-select\n          style=\"width: 290px; margin-top: 12px\"\n          v-if=\"curUser === USER_TYPES.USER\"\n          type=\"brand\"\n          placeholder=\"输入手机号或会员名搜索\"\n          isNormalStyle\n          useBodyContainer\n          @change=\"onMemberSelect\"\n        ></all-member-select>\n\n        <st-textarea\n          class=\"mg-t8\"\n          v-if=\"curUser === USER_TYPES.MOBILE\"\n          v-model=\"tel\"\n          :max-rows=\"1000\"\n          :autosize=\"{ minRows: 2, maxRows: 4 }\"\n          placeholder=\"输入手机号,每行一个\"\n        ></st-textarea>\n\n        <a-radio-group\n          :class=\"bModal('scroll')\"\n          v-decorator=\"decorators.send_value\"\n          v-show=\"curUser === USER_TYPES.CROWD\"\n        >\n          <a-radio-button\n            :class=\"bModal('scroll-btn')\"\n            class=\"mg-r8\"\n            v-for=\"(item, index) in crowdList\"\n            :key=\"index\"\n            :value=\"item.crowd_id\"\n          >\n            {{ item.crowd_name }}\n          </a-radio-button>\n        </a-radio-group>\n        <span :class=\"bModal('scroll-add')\" v-if=\"curUser === USER_TYPES.CROWD\">\n          <span :class=\"bModal('scroll-not')\">不满足？</span>\n          <a @click=\"goCrowd\" class=\"cursor-pointer\">去新增人群</a>\n        </span>\n      </st-form-item>\n      <st-form-item\n        label=\"选择优惠券\"\n        help=\"定向发券不扣除优惠券剩余数量\"\n        required\n      >\n        <coupon-select\n          isInit\n          :isSelectFirst=\"!!couponId\"\n          :value=\"couponId\"\n          style=\"width: 290px\"\n          useBodyContainer\n          placeholder=\"搜索选择优惠券\"\n          @change=\"onCouponSelectChange\"\n        ></coupon-select>\n      </st-form-item>\n    </st-form>\n  </st-modal>\n</template>\n<script>\nimport { ruleOptions } from './batch-send.config'\nimport { BatchSendService } from './batch-send.service'\nimport { USER_TYPES } from '@/constants/plugin/send-coupon'\nimport { MessageService } from '@/services/message.service'\nimport { PatternService } from '@/services/pattern.service'\nimport AllMemberSelect from '@/views/biz-components/member/all-member-select/all-member-select.vue'\nimport CouponSelect from '@/views/biz-components/plugin/coupon-select/index.vue'\nexport default {\n  name: 'BrandAppPluginSendCouponBatchSend',\n  bem: {\n    bModal: 'brand-app-plugin-send-coupon-batch-send'\n  },\n  serviceInject() {\n    return {\n      batchSendService: BatchSendService,\n      messageService: MessageService,\n      pattern: PatternService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.batchSendService.loading$,\n      userType: this.batchSendService.userType$,\n      crowdList: this.batchSendService.crowdList$\n    }\n  },\n  components: {\n    AllMemberSelect,\n    CouponSelect\n  },\n  props: {\n    couponId: {\n      type: Number\n    },\n    crowdId: {\n      type: Number\n    },\n    title: {\n      type: String,\n      default: '定向发券'\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      USER_TYPES,\n      show: false,\n      curUser: USER_TYPES.USER,\n      tel: '',\n      selectCouponId: '',\n      selectMemberId: ''\n    }\n  },\n  mounted() {\n    if (this.couponId) {\n      this.selectCouponId = this.couponId\n    }\n    if (this.crowdId) {\n      this.curUser = USER_TYPES.CROWD\n      this.form.setFieldsValue({\n        type: USER_TYPES.CROWD,\n        send_value: this.crowdId\n      })\n    }\n    this.getCrowdList()\n  },\n  methods: {\n    // 获取人群列表\n    getCrowdList() {\n      return this.batchSendService.getCrowdList().subscribe()\n    },\n    getCurPrizUserType(e) {\n      this.curUser = e.target.value\n    },\n    // 跳转到新增人群\n    goCrowd() {\n      this.$router.push('/brand/marketing/plugin/crowd/index')\n      this.show = false\n    },\n    onMemberSelect(id) {\n      this.selectMemberId = id\n    },\n    onCouponSelectChange(val) {\n      this.selectCouponId = val\n    },\n    save() {\n      this.form.validate((error, values) => {\n        let errMsg = ''\n        const types = {\n          [USER_TYPES.USER]: () => {\n            if (!this.selectMemberId) {\n              errMsg = '请选择会员'\n              return\n            }\n            values.send_users = [this.selectMemberId]\n          },\n          [USER_TYPES.MOBILE]: () => {\n            if (!this.tel) {\n              errMsg = '请输入手机号'\n              return\n            }\n            let telArr = this.tel.split(/[\\n]/)\n            for (let i = 0; i < telArr.length; i++) {\n              if (!this.pattern.MOBILE.test(telArr[i].trim())) {\n                errMsg = '请输入正确格式手机号'\n                return\n              }\n            }\n            values.send_users = this.tel.split(/[\\n]/)\n          },\n          [USER_TYPES.CROWD]: () => {\n            if (!values.send_value) {\n              errMsg = '请选择人群'\n              return\n            }\n            values.send_users = [values.send_value]\n          },\n          [USER_TYPES.ALL]: () => {}\n        }\n        // 校验输入\n        types[values.type]()\n        if (errMsg) {\n          this.messageService.warn({ content: errMsg })\n          return\n        }\n\n        if (!this.selectCouponId) {\n          this.messageService.warn({\n            content: '请选择优惠券'\n          })\n          return\n        }\n        values.coupon_id = this.selectCouponId\n        return this.batchSendService\n          .sendCoupon({ ...values })\n          .subscribe(res => {\n            this.$confirm({\n              title: '发券成功',\n              content: '您可以推送短信，告知客户有新的优惠券到账哦~',\n              okText: '短信推送',\n              icon: () => (\n                <st-icon\n                  type=\"anticon:check-circle\"\n                  size=\"22px\"\n                  color=\"#52c41a\"\n                ></st-icon>\n              ),\n              onOk: () => {\n                this.$router.push({\n                  name: 'brand-setting-sms-group'\n                })\n              }\n            })\n            this.$emit('success')\n            this.show = false\n          })\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/brand/app/plugin/send-coupon"}]}