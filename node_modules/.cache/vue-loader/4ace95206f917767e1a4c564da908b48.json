{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/reception/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/reception/index.vue","mtime":1598250255901},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { IndexService } from './index.service'\nimport { cloneDeep, debounce, get } from 'lodash-es'\nimport moment from 'moment'\nimport FrontAddMember from '@/views/biz-modals/front/add-member'\nimport ShopReceptionEntrance from '@/views/biz-modals/shop/reception/entrance'\nimport TodoList from './components#/todolist'\nimport MemberOnline from './components#/member-online'\nimport ShortcutNav from './components#/shortcut-nav'\nimport ShortcutModel from './components#/shortcut-model'\nimport { enumFilter } from '../../../../filters/other.filters'\nimport { tap } from 'rxjs/operators'\nexport default {\n  name: 'PageShopReception',\n  bem: {\n    reception: 'page-shop-reception'\n  },\n  modals: {\n    FrontAddMember,\n    ShopReceptionEntrance\n  },\n  serviceInject() {\n    return {\n      indexService: IndexService\n    }\n  },\n  rxState() {\n    return {\n      auth: this.indexService.auth$,\n      memberList: this.indexService.memberList$,\n      hasNext: this.indexService.hasNext$,\n      page: this.indexService.page$,\n      loading: this.indexService.loading$,\n      parent_types: this.indexService.parent_types$\n    }\n  },\n  components: {\n    TodoList,\n    MemberOnline,\n    ShortcutNav,\n    ShortcutModel\n  },\n  data() {\n    return {\n      // 搜索会员的关键字\n      memberSearchText: '',\n      // 搜索会员的最后一次关键字\n      lastMemberSearchText: '',\n      // 选择的会员\n      selectMember: undefined,\n      // memberId\n      memberId: undefined,\n      page: {\n        current_page: 1,\n        size: 10\n      },\n      memberSearchOpen: false\n    }\n  },\n  computed: {\n    isSearchNone() {\n      return this.memberSearchText !== '' && !this.memberList.length\n    },\n    // 是否确定了会员\n    isSelectMember() {\n      return this.selectMember && this.memberId && this.memberList.length\n    }\n  },\n  mounted() {\n    if (this.auth.checkinPage) {\n      this.indexService.getMemberOnlineList().subscribe(res => {\n        setTimeout(() => {\n          this.$refs.searchSelect.$el.click()\n        }, 200)\n      })\n    }\n  },\n  methods: {\n    handleRefresh() {\n      this.indexService.getMemberOnlineList().subscribe(() => {\n        setTimeout(() => {\n          this.$refs.searchSelect.$el.click()\n        }, 200)\n      })\n    },\n    handleMemberSearch() {\n      console.log('handleMemberSearch', this.memberId)\n      this.lastMemberSearchText = ''\n      this.memberSearchText = ''\n      this.$modalRouter.push({\n        name: 'shop-reception-entrance',\n        props: {\n          member_id: this.memberId\n        },\n        on: {\n          done: () => {\n            this.selectMember = undefined\n            this.memberId = undefined\n            this.lastMemberSearchText = ''\n            this.memberSearchText = ''\n            this.indexService.setMemberList([])\n            if (this.auth.checkinPage) {\n              this.indexService.getMemberOnlineList().subscribe(res => {\n                setTimeout(() => {\n                  this.$refs.searchSelect.$el.click()\n                }, 200)\n              })\n            } else {\n              setTimeout(() => {\n                this.$refs.searchSelect.$el.click()\n              }, 200)\n            }\n          }\n        }\n      })\n    },\n    selectItemLabel(item) {\n      if (item.is_minors === 1) {\n        return `${item.member_name}(未成年) ${\n          item.parent_mobile\n        }(${this.filterParentUserRole(item)})`\n      }\n      return `${item.member_name} ${item.mobile}`\n    },\n    filterParentUserRole(item) {\n      return this.parent_types.filter(i => i.value === item.parent_user_role)[0]\n        .label\n    },\n    // 搜索会员\n    onMemberSearch(data) {\n      this.memberSearchOpen = true\n      if (!this.hasNext && this.memberSearchText === data.trim()) {\n        return\n      }\n      if (this.memberSearchText !== data.trim()) {\n        this.page.current_page = 1\n        this.indexService.setMemberList([])\n      }\n      this.memberSearchText = data.trim()\n      if (data.trim() !== '') {\n        this.lastMemberSearchText = data.trim()\n        this.indexService.memberListAction$.dispatch({\n          keyword: data,\n          current_page: this.page.current_page,\n          size: this.page.size\n        })\n      }\n    },\n    // 选择了会员\n    onMemberSelect(data) {\n      this.selectMember = data\n      this.memberId = data\n      this.handleMemberSearch()\n    },\n    // 监听回车入场\n    onMemberEnter(e) {\n      let keyCode = e.keyCode\n      if (\n        keyCode === 13 &&\n        !this.memberList.length &&\n        !this.loading.getMemberList\n      ) {\n        this.indexService\n          .getMemberList({\n            keyword: this.lastMemberSearchText\n          })\n          .subscribe(res => {\n            let list = res.list\n            let id = list.length ? list[0]['id'] : undefined\n            if (id) {\n              console.log('onMemberSelect', id)\n              this.onMemberSelect(id)\n            } else {\n              this.selectMember = undefined\n              this.memberId = undefined\n              this.lastMemberSearchText = ''\n              this.memberSearchText = ''\n              this.indexService.setMemberList([])\n            }\n          })\n      }\n    },\n    // 会员搜索框失去焦点\n    onMemberBlur() {\n      this.memberId = undefined\n      this.selectMember = undefined\n      this.lastMemberSearchText = ''\n      this.memberSearchText = ''\n      this.memberSearchOpen = false\n      this.indexService.setMemberList([])\n    },\n    onMemberFocus() {\n      if (!this.memberSearchText) {\n        this.memberSearchOpen = false\n        return\n      }\n      if (!this.memberSearchOpen) this.memberSearchOpen = true\n    },\n    // 新增会员\n    onAddUser() {\n      this.$modalRouter.push({\n        name: 'front-add-member',\n        on: {\n          success: res => {\n            this.onMemberSelect(res.id)\n            this.onMemberSearch(res.name)\n          }\n        }\n      })\n    },\n    scroll: debounce(function(e) {\n      const { target } = e\n      if (\n        Math.floor(target.scrollTop) + target.clientHeight >\n        target.scrollHeight - 20\n      ) {\n        if (this.hasNext) {\n          this.page.current_page++\n          this.onMemberSearch(this.memberSearchText)\n        }\n      }\n    }, 200)\n  }\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/pages/shop/reception","sourcesContent":["<template>\n  <div :class=\"reception()\">\n    <div :class=\"reception('wrapper')\">\n      <div :class=\"reception('main')\">\n        <shortcut-nav></shortcut-nav>\n        <div class=\"member\">\n          <div class=\"member-wrapper\">\n            <div class=\"member-title\">会员入离场</div>\n            <div class=\"member-search\">\n              <a-select\n                v-model=\"selectMember\"\n                class=\"member-search-select\"\n                showSearch\n                allowClear\n                :showArrow=\"false\"\n                placeholder=\"输入手机号码、姓名、卡号进行搜索\"\n                :defaultActiveFirstOption=\"true\"\n                :filterOption=\"false\"\n                :open=\"memberSearchOpen\"\n                @popupScroll=\"scroll\"\n                @select=\"onMemberSelect\"\n                @search=\"onMemberSearch\"\n                @inputKeydown=\"onMemberEnter\"\n                @blur=\"onMemberBlur\"\n                @focus=\"onMemberFocus\"\n                ref=\"searchSelect\"\n              >\n                <a-spin\n                  size=\"small\"\n                  v-if=\"loading.getMemberList\"\n                  slot=\"notFoundContent\"\n                ></a-spin>\n                <span slot=\"notFoundContent\" v-else-if=\"isSearchNone\">\n                  查无此用户，\n                  <a @click=\"onAddUser\">新增新用户？</a>\n                </span>\n                <span slot=\"notFoundContent\" v-else>无搜索结果</span>\n                <a-select-option v-for=\"item in memberList\" :key=\"item.id\">\n                  <span\n                    v-html=\"\n                      `${selectItemLabel(item)}`.replace(\n                        new RegExp(lastMemberSearchText, 'g'),\n                        `\\<span class='global-highlight-color'\\>${lastMemberSearchText}\\<\\/span\\>`\n                      )\n                    \"\n                  >\n                    {{ selectItemLabel(item) }}\n                  </span>\n                </a-select-option>\n                <!-- !isSearchNone && page.current_page < page.total_pages  -->\n                <!-- <a-select-option\n                  disabled\n                  :class=\"reception('member-search-tip')\"\n                  :key=\"new Date() + Math.random()\"\n                  v-if=\"!isSearchNone && page.current_page >= page.total_pages\"\n                >\n                  已经到底啦\n                </a-select-option> -->\n              </a-select>\n              <st-button\n                class=\"search\"\n                :disabled=\"!isSelectMember\"\n                @click=\"handleMemberSearch\"\n              >\n                <a-icon type=\"search\"></a-icon>\n              </st-button>\n            </div>\n          </div>\n        </div>\n        <shortcut-model></shortcut-model>\n      </div>\n      <div :class=\"reception('aside')\">\n        <member-online v-if=\"auth.checkinPage\" @refresh=\"handleRefresh\" />\n        <todo-list />\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport { IndexService } from './index.service'\nimport { cloneDeep, debounce, get } from 'lodash-es'\nimport moment from 'moment'\nimport FrontAddMember from '@/views/biz-modals/front/add-member'\nimport ShopReceptionEntrance from '@/views/biz-modals/shop/reception/entrance'\nimport TodoList from './components#/todolist'\nimport MemberOnline from './components#/member-online'\nimport ShortcutNav from './components#/shortcut-nav'\nimport ShortcutModel from './components#/shortcut-model'\nimport { enumFilter } from '../../../../filters/other.filters'\nimport { tap } from 'rxjs/operators'\nexport default {\n  name: 'PageShopReception',\n  bem: {\n    reception: 'page-shop-reception'\n  },\n  modals: {\n    FrontAddMember,\n    ShopReceptionEntrance\n  },\n  serviceInject() {\n    return {\n      indexService: IndexService\n    }\n  },\n  rxState() {\n    return {\n      auth: this.indexService.auth$,\n      memberList: this.indexService.memberList$,\n      hasNext: this.indexService.hasNext$,\n      page: this.indexService.page$,\n      loading: this.indexService.loading$,\n      parent_types: this.indexService.parent_types$\n    }\n  },\n  components: {\n    TodoList,\n    MemberOnline,\n    ShortcutNav,\n    ShortcutModel\n  },\n  data() {\n    return {\n      // 搜索会员的关键字\n      memberSearchText: '',\n      // 搜索会员的最后一次关键字\n      lastMemberSearchText: '',\n      // 选择的会员\n      selectMember: undefined,\n      // memberId\n      memberId: undefined,\n      page: {\n        current_page: 1,\n        size: 10\n      },\n      memberSearchOpen: false\n    }\n  },\n  computed: {\n    isSearchNone() {\n      return this.memberSearchText !== '' && !this.memberList.length\n    },\n    // 是否确定了会员\n    isSelectMember() {\n      return this.selectMember && this.memberId && this.memberList.length\n    }\n  },\n  mounted() {\n    if (this.auth.checkinPage) {\n      this.indexService.getMemberOnlineList().subscribe(res => {\n        setTimeout(() => {\n          this.$refs.searchSelect.$el.click()\n        }, 200)\n      })\n    }\n  },\n  methods: {\n    handleRefresh() {\n      this.indexService.getMemberOnlineList().subscribe(() => {\n        setTimeout(() => {\n          this.$refs.searchSelect.$el.click()\n        }, 200)\n      })\n    },\n    handleMemberSearch() {\n      console.log('handleMemberSearch', this.memberId)\n      this.lastMemberSearchText = ''\n      this.memberSearchText = ''\n      this.$modalRouter.push({\n        name: 'shop-reception-entrance',\n        props: {\n          member_id: this.memberId\n        },\n        on: {\n          done: () => {\n            this.selectMember = undefined\n            this.memberId = undefined\n            this.lastMemberSearchText = ''\n            this.memberSearchText = ''\n            this.indexService.setMemberList([])\n            if (this.auth.checkinPage) {\n              this.indexService.getMemberOnlineList().subscribe(res => {\n                setTimeout(() => {\n                  this.$refs.searchSelect.$el.click()\n                }, 200)\n              })\n            } else {\n              setTimeout(() => {\n                this.$refs.searchSelect.$el.click()\n              }, 200)\n            }\n          }\n        }\n      })\n    },\n    selectItemLabel(item) {\n      if (item.is_minors === 1) {\n        return `${item.member_name}(未成年) ${\n          item.parent_mobile\n        }(${this.filterParentUserRole(item)})`\n      }\n      return `${item.member_name} ${item.mobile}`\n    },\n    filterParentUserRole(item) {\n      return this.parent_types.filter(i => i.value === item.parent_user_role)[0]\n        .label\n    },\n    // 搜索会员\n    onMemberSearch(data) {\n      this.memberSearchOpen = true\n      if (!this.hasNext && this.memberSearchText === data.trim()) {\n        return\n      }\n      if (this.memberSearchText !== data.trim()) {\n        this.page.current_page = 1\n        this.indexService.setMemberList([])\n      }\n      this.memberSearchText = data.trim()\n      if (data.trim() !== '') {\n        this.lastMemberSearchText = data.trim()\n        this.indexService.memberListAction$.dispatch({\n          keyword: data,\n          current_page: this.page.current_page,\n          size: this.page.size\n        })\n      }\n    },\n    // 选择了会员\n    onMemberSelect(data) {\n      this.selectMember = data\n      this.memberId = data\n      this.handleMemberSearch()\n    },\n    // 监听回车入场\n    onMemberEnter(e) {\n      let keyCode = e.keyCode\n      if (\n        keyCode === 13 &&\n        !this.memberList.length &&\n        !this.loading.getMemberList\n      ) {\n        this.indexService\n          .getMemberList({\n            keyword: this.lastMemberSearchText\n          })\n          .subscribe(res => {\n            let list = res.list\n            let id = list.length ? list[0]['id'] : undefined\n            if (id) {\n              console.log('onMemberSelect', id)\n              this.onMemberSelect(id)\n            } else {\n              this.selectMember = undefined\n              this.memberId = undefined\n              this.lastMemberSearchText = ''\n              this.memberSearchText = ''\n              this.indexService.setMemberList([])\n            }\n          })\n      }\n    },\n    // 会员搜索框失去焦点\n    onMemberBlur() {\n      this.memberId = undefined\n      this.selectMember = undefined\n      this.lastMemberSearchText = ''\n      this.memberSearchText = ''\n      this.memberSearchOpen = false\n      this.indexService.setMemberList([])\n    },\n    onMemberFocus() {\n      if (!this.memberSearchText) {\n        this.memberSearchOpen = false\n        return\n      }\n      if (!this.memberSearchOpen) this.memberSearchOpen = true\n    },\n    // 新增会员\n    onAddUser() {\n      this.$modalRouter.push({\n        name: 'front-add-member',\n        on: {\n          success: res => {\n            this.onMemberSelect(res.id)\n            this.onMemberSearch(res.name)\n          }\n        }\n      })\n    },\n    scroll: debounce(function(e) {\n      const { target } = e\n      if (\n        Math.floor(target.scrollTop) + target.clientHeight >\n        target.scrollHeight - 20\n      ) {\n        if (this.hasNext) {\n          this.page.current_page++\n          this.onMemberSearch(this.memberSearchText)\n        }\n      }\n    }, 200)\n  }\n}\n</script>\n"]}]}