{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/shop/add.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/shop/add.vue","mtime":1597396799971},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { UserService } from '@/services/user.service'\nimport { AddService } from './add.service'\nimport { cloneDeep } from 'lodash-es'\nimport { PatternService } from '@/services/pattern.service'\nimport { MessageService } from '@/services/message.service'\nimport CheckboxFacilityGroup from '@/views/biz-components/checkbox-facility/checkbox-facility-group'\nimport CheckboxFacilityItem from '@/views/biz-components/checkbox-facility/checkbox-facility-item'\nimport MapButton from '@/views/biz-components/map-button/map-button'\nimport ShopHourPicker from '@/views/biz-components/shop-hour-picker/shop-hour-picker'\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue'\nexport default {\n  components: {\n    CheckboxFacilityGroup,\n    CheckboxFacilityItem,\n    MapButton,\n    ShopHourPicker,\n    StImageUpload\n  },\n  serviceInject() {\n    return {\n      pattern: PatternService,\n      addService: AddService,\n      userService: UserService,\n      messageService: MessageService\n    }\n  },\n  rxState() {\n    return {\n      serviceList: this.addService.serviceList$,\n      addLoading: this.addService.loading$,\n      shop_status_add: this.userService.getOptions$('shop.shop_status_add'),\n      unusedShops: this.addService.unusedShops$\n    }\n  },\n  data() {\n    return {\n      shopData: {\n        shop_name: '',\n        province_id: null,\n        city_id: null,\n        district_id: null,\n        address: '',\n        shop_phones: [],\n        shop_status: 1,\n        lat: '',\n        lng: '',\n        service_ids: [],\n        business_time: [],\n        email: '',\n        shop_cover_image: '',\n        buy_shop_id: -1\n      },\n      // 电话校验方式 1为点击新增校验，0为点击提交校验\n      phoneValidtorType: 1,\n      addMap: {\n        lat: '',\n        lng: '',\n        address: '',\n        province: {},\n        city: {},\n        district: {}\n      },\n      shopMapValidateText: '',\n      // 服务\n      serviceIcon_icon_list: {\n        1: 'WIFI',\n        2: 'park',\n        3: 'shower',\n        4: 'medical',\n        5: 'heating',\n        6: 'snow',\n        7: 'nosmoking',\n        8: 'energy'\n      },\n      fileList: [],\n      shopCoverImageValidateText: ''\n    }\n  },\n  beforeCreate() {\n    this.form = this.$form.createForm(this)\n  },\n  computed: {\n    phoneAddDisabled() {\n      return this.shopData.shop_phones.length > 2\n    },\n    shopCoverImageIsOk() {\n      return this.shopCoverImageValidateText === ''\n    },\n    shopMapIsOk() {\n      return this.shopMapValidateText === ''\n    }\n  },\n  methods: {\n    fileChange(data) {\n      if (data.length) {\n        this.shopData.shop_cover_image = data[0].image_key\n      } else {\n        this.shopData.shop_cover_image = ''\n      }\n      this.shopCoverImageValidator()\n    },\n    addMapChange(data) {\n      this.addMap = cloneDeep(data)\n      this.shopData.province_id = data.province.id\n      this.shopData.province_name = data.province.name\n      this.shopData.city_id = data.city.id\n      this.shopData.city_name = data.city.name\n      this.shopData.district_id = data.district.id\n      this.shopData.district_name = data.district.name\n      this.shopData.address = data.address\n      this.shopData.lat = data.lat\n      this.shopData.lng = data.lng\n      this.shopMapValidator()\n    },\n    // 新增电话\n    onValidtorPhone() {\n      if (this.form.getFieldValue('shop_phone') && !this.phoneAddDisabled) {\n        // input框里有值才新增\n        this.form.validateFields(['shop_phone'], {}).then(res => {\n          let arr = [...this.shopData.shop_phones]\n          arr.push(res.shop_phone)\n          this.shopData.shop_phones = [...new Set(arr)]\n        })\n      }\n    },\n    // 移除电话\n    onRemovePhone(index) {\n      this.shopData.shop_phones.splice(index, 1)\n    },\n    // 表单提交\n    onHandleSubmit(e) {\n      // 确认为提交表单校验\n      this.phoneValidtorType = 0\n      this.form.resetFields(['shop_phone'])\n      e.preventDefault()\n      this.shopCoverImageValidator()\n      this.shopMapValidator()\n      this.form.validateFieldsAndScroll((err, values) => {\n        this.phoneValidtorType = 1\n        if (!err && this.shopCoverImageIsOk && this.shopMapIsOk) {\n          this.shopData.shop_name = values.shop_name\n          this.shopData.email = values.email\n          this.shopData.buy_shop_id = values.buy_shop_id\n          this.addService.save(this.shopData).subscribe(this.onSubmitSuccess)\n        }\n      })\n    },\n    onSubmitSuccess() {\n      this.messageService.success({\n        content: '新增成功'\n      })\n      this.$router.push({\n        name: 'brand-setting-shop-list'\n      })\n    },\n    // shop_name validatorFn\n    shop_name_validator(rule, value, callback) {\n      if (value === undefined || !value) {\n        // eslint-disable-next-line\n        callback('请填写门店名称')\n      } else if (value && !this.pattern.CN_EN_NUM_SPACE('1-20').test(value)) {\n        // eslint-disable-next-line\n        callback('支持中英文、数字,不超过20个字')\n      } else {\n        // eslint-disable-next-line\n        callback()\n      }\n    },\n    // shop_phone validatorFn\n    shop_phone_validator(rule, value, callback) {\n      if (this.phoneValidtorType) {\n        callback()\n      } else {\n        if (!this.shopData.shop_phones.length) {\n          // eslint-disable-next-line\n          callback('请填写门店电话')\n        } else {\n          // eslint-disable-next-line\n          callback()\n        }\n      }\n    },\n    // 校验店招是否已上传\n    shopCoverImageValidator() {\n      this.shopCoverImageValidateText = this.shopData.shop_cover_image\n        ? ''\n        : '请上传店招'\n    },\n    // 校验地址\n    shopMapValidator() {\n      this.shopMapValidateText = this.shopData.lat ? '' : '请选择门店地址'\n    }\n  }\n}\n",null]}