{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/package/select-course.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/package/select-course.vue","mtime":1600926555875},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// TODO: 暂时是前端翻页，准备做后端翻页。\nimport tableMixin from '@/mixins/table.mixin'\nimport { columns } from './select-course.config'\nimport { SelectCourseService } from './select-course.service'\nimport { cloneDeep, uniqBy } from 'lodash'\nexport default {\n  name: 'ModalSelectCourse',\n  bem: {\n    course: 'biz-select-course'\n  },\n  serviceInject() {\n    return {\n      service: SelectCourseService\n    }\n  },\n  rxState() {\n    const { courseTypeOptions$, page$, courseList$, loading$ } = this.service\n    return { courseTypeOptions$, page$, courseList$, loading$ }\n  },\n  computed: {\n    columns\n  },\n  mixins: [tableMixin],\n  data() {\n    return {\n      show: false,\n      courseList: [],\n      selectedRowKeys: [],\n      searchData: {\n        search: '',\n        course_type: '',\n        use_range: 3,\n        use_shop_list: []\n      }\n    }\n  },\n  props: {\n    title: {\n      type: String,\n      default: '选择团课'\n    },\n    courseType: {\n      type: String,\n      default: ''\n    },\n    useRange: {\n      type: Number\n    },\n    useShopList: {\n      type: Array,\n      default: () => []\n    },\n    initDataSource: {\n      type: Array,\n      default: () => [\n        {\n          course_id: 1,\n          shop_id: 1,\n          shop_name:\n            '常青一点都不帅，银鞍照白马，更换名字测11试，更换名字测12试，kael，kael1，关店测试，超超的三体云动门店，云云的门店测试',\n          course_name: '团体课测试',\n          course_category: '团体课程',\n          course_type: '团体课'\n        },\n        {\n          course_id: 2,\n          shop_id: 1,\n          shop_name: '银鞍照白马',\n          course_name: '团体课测试1',\n          course_category: '团体课程',\n          course_type: '团体课'\n        },\n        {\n          course_id: 5,\n          shop_id: 0,\n          shop_name: '银鞍照白马，更换名字测11试',\n          course_name: '新增团体课-测试',\n          course_category: '团体课程',\n          course_type: '团体课'\n        }\n      ]\n    }\n  },\n  methods: {\n    initSelectedRowKeys() {\n      this.selectedRows = cloneDeep(this.initDataSource)\n      this.selectedRowKeys = this.initDataSource.map(item => item.course_id)\n    },\n    // 初始化搜索数据\n    initSearchData() {\n      this.searchData = {\n        type: this.courseType,\n        platform: 'brand',\n        search: '',\n        course_type: -1,\n        use_range: this.useRange,\n        use_shop_list: this.useShopList\n      }\n    },\n    init() {\n      this.initSelectedRowKeys()\n      this.initSearchData()\n      this.getCourseList()\n      this.getCourseTypeOptions()\n    },\n    onClear() {\n      console.log('onClear')\n      this.onSelectionReset()\n    },\n    onSelectionChange(selectedRowKeys, selectedRows) {\n      this.selectedRowKeys = selectedRowKeys\n      //  修复antd tablebug ，当搜索后返回的搜索之前selectedRows不会返回\n      this.selectedRows = uniqBy(\n        [...this.selectedRows, ...selectedRows],\n        'course_id'\n      )\n    },\n    // 请求课程列表\n    getCourseList() {\n      return this.service.getCourseList(this.searchData).subscribe(res => {\n        // 将已选中的数据与请求回来的列表比对，选中的默认勾上\n      })\n    },\n    getCourseTypeOptions() {\n      return this.service.getCourseTypeList().subscribe()\n    },\n    // 课程类型的选择\n    onChange() {\n      this.getCourseList()\n    },\n    // 课程的模糊搜索\n    onSearch() {\n      this.getCourseList()\n    },\n    // 选中课程提交\n    onOk() {\n      // 最后传出去的出去原来被选中的和重复应该过滤掉\n      let courseList = this.selectedRows\n      this.$emit('done', courseList)\n      this.show = false\n    }\n  },\n  created() {\n    this.init()\n  }\n}\n",{"version":3,"sources":["select-course.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"select-course.vue","sourceRoot":"src/views/biz-modals/package","sourcesContent":["<template>\n  <st-modal :title=\"title\" @ok=\"onOk\" v-model=\"show\">\n    <div :class=\"course()\">\n      <div :class=\"course('search')\">\n        <div></div>\n        <div>\n          <a-select\n            :class=\"course('search-select')\"\n            v-model=\"searchData.course_type\"\n            :options=\"courseTypeOptions$\"\n            @change=\"onChange\"\n            style=\"width:148px\"\n            class=\"mg-r16\"\n          ></a-select>\n          <st-input-search\n            @search=\"onSearch\"\n            v-model=\"searchData.search\"\n            :class=\"course('search-input')\"\n            placeholder=\"搜索课程\"\n          />\n        </div>\n      </div>\n      <st-container class=\"mg-t16\">\n        <st-table\n          :columns=\"columns\"\n          :dataSource=\"courseList$\"\n          :simplePage=\"true\"\n          rowKey=\"course_id\"\n          :page=\"page$\"\n          :alertSelection=\"{ onReset: onClear }\"\n          :rowSelection=\"{ selectedRowKeys, onChange: onSelectionChange }\"\n          :loading=\"loading$.getCourseList\"\n          pageMode=\"client\"\n        >\n          <template slot=\"shop_name\" slot-scope=\"text\">\n            <st-overflow-text\n              :value=\"text\"\n              max-width=\"180px\"\n            ></st-overflow-text>\n          </template>\n        </st-table>\n      </st-container>\n    </div>\n  </st-modal>\n</template>\n\n<script>\n// TODO: 暂时是前端翻页，准备做后端翻页。\nimport tableMixin from '@/mixins/table.mixin'\nimport { columns } from './select-course.config'\nimport { SelectCourseService } from './select-course.service'\nimport { cloneDeep, uniqBy } from 'lodash'\nexport default {\n  name: 'ModalSelectCourse',\n  bem: {\n    course: 'biz-select-course'\n  },\n  serviceInject() {\n    return {\n      service: SelectCourseService\n    }\n  },\n  rxState() {\n    const { courseTypeOptions$, page$, courseList$, loading$ } = this.service\n    return { courseTypeOptions$, page$, courseList$, loading$ }\n  },\n  computed: {\n    columns\n  },\n  mixins: [tableMixin],\n  data() {\n    return {\n      show: false,\n      courseList: [],\n      selectedRowKeys: [],\n      searchData: {\n        search: '',\n        course_type: '',\n        use_range: 3,\n        use_shop_list: []\n      }\n    }\n  },\n  props: {\n    title: {\n      type: String,\n      default: '选择团课'\n    },\n    courseType: {\n      type: String,\n      default: ''\n    },\n    useRange: {\n      type: Number\n    },\n    useShopList: {\n      type: Array,\n      default: () => []\n    },\n    initDataSource: {\n      type: Array,\n      default: () => [\n        {\n          course_id: 1,\n          shop_id: 1,\n          shop_name:\n            '常青一点都不帅，银鞍照白马，更换名字测11试，更换名字测12试，kael，kael1，关店测试，超超的三体云动门店，云云的门店测试',\n          course_name: '团体课测试',\n          course_category: '团体课程',\n          course_type: '团体课'\n        },\n        {\n          course_id: 2,\n          shop_id: 1,\n          shop_name: '银鞍照白马',\n          course_name: '团体课测试1',\n          course_category: '团体课程',\n          course_type: '团体课'\n        },\n        {\n          course_id: 5,\n          shop_id: 0,\n          shop_name: '银鞍照白马，更换名字测11试',\n          course_name: '新增团体课-测试',\n          course_category: '团体课程',\n          course_type: '团体课'\n        }\n      ]\n    }\n  },\n  methods: {\n    initSelectedRowKeys() {\n      this.selectedRows = cloneDeep(this.initDataSource)\n      this.selectedRowKeys = this.initDataSource.map(item => item.course_id)\n    },\n    // 初始化搜索数据\n    initSearchData() {\n      this.searchData = {\n        type: this.courseType,\n        platform: 'brand',\n        search: '',\n        course_type: -1,\n        use_range: this.useRange,\n        use_shop_list: this.useShopList\n      }\n    },\n    init() {\n      this.initSelectedRowKeys()\n      this.initSearchData()\n      this.getCourseList()\n      this.getCourseTypeOptions()\n    },\n    onClear() {\n      console.log('onClear')\n      this.onSelectionReset()\n    },\n    onSelectionChange(selectedRowKeys, selectedRows) {\n      this.selectedRowKeys = selectedRowKeys\n      //  修复antd tablebug ，当搜索后返回的搜索之前selectedRows不会返回\n      this.selectedRows = uniqBy(\n        [...this.selectedRows, ...selectedRows],\n        'course_id'\n      )\n    },\n    // 请求课程列表\n    getCourseList() {\n      return this.service.getCourseList(this.searchData).subscribe(res => {\n        // 将已选中的数据与请求回来的列表比对，选中的默认勾上\n      })\n    },\n    getCourseTypeOptions() {\n      return this.service.getCourseTypeList().subscribe()\n    },\n    // 课程类型的选择\n    onChange() {\n      this.getCourseList()\n    },\n    // 课程的模糊搜索\n    onSearch() {\n      this.getCourseList()\n    },\n    // 选中课程提交\n    onOk() {\n      // 最后传出去的出去原来被选中的和重复应该过滤掉\n      let courseList = this.selectedRows\n      this.$emit('done', courseList)\n      this.show = false\n    }\n  },\n  created() {\n    this.init()\n  }\n}\n</script>\n"]}]}