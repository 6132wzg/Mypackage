{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/stat/shop-course-facet-bar.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/stat/shop-course-facet-bar.vue","mtime":1594718339903},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n\nimport chartMixin from './mixin'\nimport { Chart } from '@antv/g2'\nimport { View } from 'st-data-set'\nimport Vue from 'vue'\nimport StHelpTooltip from '@/views/components/help-tooltip/help-tooltip'\nimport { debounce } from 'lodash-es'\nexport default {\n  mixins: [chartMixin],\n  props: {\n    data: {\n      type: Array,\n      default: () => []\n    },\n    fields: {\n      type: Array,\n      default: () => ['团体课', '私教课']\n    },\n    colors: {\n      type: Array,\n      default: () => ['l(0) 0:#57ABFF 1:#426BF7', 'l(0) 0:#8428FF 1:#6332D1']\n    },\n    height: {\n      type: Number,\n      default: 280\n    }\n  },\n  mounted() {\n    window.addEventListener('resize', debounce(this.mountedTooltip, 200))\n  },\n  methods: {\n    mountedTooltip() {\n      setTimeout(this.changeData, 400)\n    },\n    initDv() {\n      this.dv = new View()\n      this.dv.source(this.data)\n      this.dv\n        .transform({\n          type: 'fold',\n          fields: this.fields,\n          key: 'type',\n          value: 'value'\n        })\n        .transform({\n          type: 'map',\n          callback(row) {\n            row.value = row.value ? +row.value : 0\n            return row\n          }\n        })\n    },\n    initChart() {\n      let tooltipEl = new Vue({\n        components: {\n          StHelpTooltip\n        },\n        render: h => <st-help-tooltip />\n      }).$mount().$el\n      this.chart = new Chart({\n        container: this.$el,\n        padding: ['auto', 'auto', 'auto', 70],\n        renderer: 'svg',\n        forceFit: true,\n        height: this.height\n      })\n\n      this.chart.source(this.dv)\n      // 图例位置\n      this.chart.legend({\n        position: 'top-left',\n        marker: 'circle',\n        offsetX: 5\n      })\n      // 图表分面 相当于两个柱状图\n      this.chart.facet('mirror', {\n        fields: ['type'],\n        padding: 4,\n        showTitle: false,\n        transpose: true,\n\n        eachView: (view, facet) => {\n          const facetIndex = facet.colIndex\n          view.axis('group', {\n            position: 'top',\n            label: {\n              offset: 70,\n              textStyle: {\n                fill: '#3E4D5C',\n                fontSize: 12\n              },\n              htmlTemplate: (text, item, index) => {\n                // 增加tooltipEl.outerHTML，防止mounted未完成导致的空白闪烁\n                return `<span style=\"width:70px;display:block;\">${text}&nbsp;<span id=\"axis-${index}\">${tooltipEl.outerHTML}</span></span>`\n              }\n            },\n            tickLine: {\n              alignWithLabel: false,\n              length: 0\n            },\n            line: {\n              lineWidth: 0\n            }\n          })\n\n          const color = this.colors[facetIndex]\n          view.axis('value', false)\n\n          view.guide().region({\n            start: ['0%', '11.5%'], // 辅助框起始位置，值为原始数据值，支持 callback\n            end: ['100%', '21.5%'], // 辅助框结束位置，值为原始数据值，支持 callback\n            style: {\n              lineWidth: 0, // 辅助框的边框宽度\n              fill: '#E9EDF2', // 辅助框填充的颜色\n              fillOpacity: 1, // 辅助框的背景透明度\n              stroke: '#ccc' // 辅助框的边框颜色设置\n            }\n          })\n          view.guide().region({\n            start: ['0%', '45%'], // 辅助框起始位置，值为原始数据值，支持 callback\n            end: ['100%', '55%'], // 辅助框结束位置，值为原始数据值，支持 callback\n            style: {\n              lineWidth: 0, // 辅助框的边框宽度\n              fill: '#E9EDF2', // 辅助框填充的颜色\n              fillOpacity: 1, // 辅助框的背景透明度\n              stroke: '#ccc' // 辅助框的边框颜色设置\n            }\n          })\n          view.guide().region({\n            start: ['0%', '78.5%'], // 辅助框起始位置，值为原始数据值，支持 callback\n            end: ['100%', '88.5%'], // 辅助框结束位置，值为原始数据值，支持 callback\n            style: {\n              lineWidth: 0, // 辅助框的边框宽度\n              fill: '#E9EDF2', // 辅助框填充的颜色\n              fillOpacity: 1, // 辅助框的背景透明度\n              stroke: '#ccc' // 辅助框的边框颜色设置\n            }\n          })\n          view\n            .interval()\n            .position('group*value')\n            .tooltip('type*value', (t, v) => {\n              return { name: t, value: v + '节' }\n            })\n            .color('type', [color])\n            .size(24)\n            .opacity(1)\n            .label('value', val => {\n              const maxValue = this.dv.max('value')\n\n              let offset = -4\n              let textAlign = facetIndex === 1 ? 'end' : 'start'\n              let fill = 'white'\n              const shouldPutLeft = val / maxValue < 0.1\n              if (shouldPutLeft) {\n                offset = 4\n                textAlign = facetIndex === 1 ? 'start' : 'end'\n                fill = '#3E4D5C'\n              }\n\n              return {\n                offset: offset,\n                textStyle: {\n                  fill,\n                  textAlign: textAlign\n                }\n              }\n            })\n        }\n      })\n      this.chart.render()\n      this.changeData()\n    },\n    changeData() {\n      if (document.querySelector('#axis-0')) {\n        new Vue({\n          components: {\n            StHelpTooltip\n          },\n          render: h => <st-help-tooltip id=\"TBDAC003\" />\n        }).$mount('#axis-0')\n        new Vue({\n          components: {\n            StHelpTooltip\n          },\n          render: h => <st-help-tooltip id=\"TBDAC002\" />\n        }).$mount('#axis-1')\n        new Vue({\n          components: {\n            StHelpTooltip\n          },\n          render: h => <st-help-tooltip id=\"TBDAC001\" />\n        }).$mount('#axis-2')\n      }\n    }\n  }\n}\n",{"version":3,"sources":["shop-course-facet-bar.vue"],"names":[],"mappings":";;;;;;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"shop-course-facet-bar.vue","sourceRoot":"src/views/biz-components/stat","sourcesContent":["<template>\n  <div class=\"stat-shop-course-facet-bar\">\n    <!-- 门店售课消课分面柱状图 -->\n  </div>\n</template>\n\n<script>\nimport chartMixin from './mixin'\nimport { Chart } from '@antv/g2'\nimport { View } from 'st-data-set'\nimport Vue from 'vue'\nimport StHelpTooltip from '@/views/components/help-tooltip/help-tooltip'\nimport { debounce } from 'lodash-es'\nexport default {\n  mixins: [chartMixin],\n  props: {\n    data: {\n      type: Array,\n      default: () => []\n    },\n    fields: {\n      type: Array,\n      default: () => ['团体课', '私教课']\n    },\n    colors: {\n      type: Array,\n      default: () => ['l(0) 0:#57ABFF 1:#426BF7', 'l(0) 0:#8428FF 1:#6332D1']\n    },\n    height: {\n      type: Number,\n      default: 280\n    }\n  },\n  mounted() {\n    window.addEventListener('resize', debounce(this.mountedTooltip, 200))\n  },\n  methods: {\n    mountedTooltip() {\n      setTimeout(this.changeData, 400)\n    },\n    initDv() {\n      this.dv = new View()\n      this.dv.source(this.data)\n      this.dv\n        .transform({\n          type: 'fold',\n          fields: this.fields,\n          key: 'type',\n          value: 'value'\n        })\n        .transform({\n          type: 'map',\n          callback(row) {\n            row.value = row.value ? +row.value : 0\n            return row\n          }\n        })\n    },\n    initChart() {\n      let tooltipEl = new Vue({\n        components: {\n          StHelpTooltip\n        },\n        render: h => <st-help-tooltip />\n      }).$mount().$el\n      this.chart = new Chart({\n        container: this.$el,\n        padding: ['auto', 'auto', 'auto', 70],\n        renderer: 'svg',\n        forceFit: true,\n        height: this.height\n      })\n\n      this.chart.source(this.dv)\n      // 图例位置\n      this.chart.legend({\n        position: 'top-left',\n        marker: 'circle',\n        offsetX: 5\n      })\n      // 图表分面 相当于两个柱状图\n      this.chart.facet('mirror', {\n        fields: ['type'],\n        padding: 4,\n        showTitle: false,\n        transpose: true,\n\n        eachView: (view, facet) => {\n          const facetIndex = facet.colIndex\n          view.axis('group', {\n            position: 'top',\n            label: {\n              offset: 70,\n              textStyle: {\n                fill: '#3E4D5C',\n                fontSize: 12\n              },\n              htmlTemplate: (text, item, index) => {\n                // 增加tooltipEl.outerHTML，防止mounted未完成导致的空白闪烁\n                return `<span style=\"width:70px;display:block;\">${text}&nbsp;<span id=\"axis-${index}\">${tooltipEl.outerHTML}</span></span>`\n              }\n            },\n            tickLine: {\n              alignWithLabel: false,\n              length: 0\n            },\n            line: {\n              lineWidth: 0\n            }\n          })\n\n          const color = this.colors[facetIndex]\n          view.axis('value', false)\n\n          view.guide().region({\n            start: ['0%', '11.5%'], // 辅助框起始位置，值为原始数据值，支持 callback\n            end: ['100%', '21.5%'], // 辅助框结束位置，值为原始数据值，支持 callback\n            style: {\n              lineWidth: 0, // 辅助框的边框宽度\n              fill: '#E9EDF2', // 辅助框填充的颜色\n              fillOpacity: 1, // 辅助框的背景透明度\n              stroke: '#ccc' // 辅助框的边框颜色设置\n            }\n          })\n          view.guide().region({\n            start: ['0%', '45%'], // 辅助框起始位置，值为原始数据值，支持 callback\n            end: ['100%', '55%'], // 辅助框结束位置，值为原始数据值，支持 callback\n            style: {\n              lineWidth: 0, // 辅助框的边框宽度\n              fill: '#E9EDF2', // 辅助框填充的颜色\n              fillOpacity: 1, // 辅助框的背景透明度\n              stroke: '#ccc' // 辅助框的边框颜色设置\n            }\n          })\n          view.guide().region({\n            start: ['0%', '78.5%'], // 辅助框起始位置，值为原始数据值，支持 callback\n            end: ['100%', '88.5%'], // 辅助框结束位置，值为原始数据值，支持 callback\n            style: {\n              lineWidth: 0, // 辅助框的边框宽度\n              fill: '#E9EDF2', // 辅助框填充的颜色\n              fillOpacity: 1, // 辅助框的背景透明度\n              stroke: '#ccc' // 辅助框的边框颜色设置\n            }\n          })\n          view\n            .interval()\n            .position('group*value')\n            .tooltip('type*value', (t, v) => {\n              return { name: t, value: v + '节' }\n            })\n            .color('type', [color])\n            .size(24)\n            .opacity(1)\n            .label('value', val => {\n              const maxValue = this.dv.max('value')\n\n              let offset = -4\n              let textAlign = facetIndex === 1 ? 'end' : 'start'\n              let fill = 'white'\n              const shouldPutLeft = val / maxValue < 0.1\n              if (shouldPutLeft) {\n                offset = 4\n                textAlign = facetIndex === 1 ? 'start' : 'end'\n                fill = '#3E4D5C'\n              }\n\n              return {\n                offset: offset,\n                textStyle: {\n                  fill,\n                  textAlign: textAlign\n                }\n              }\n            })\n        }\n      })\n      this.chart.render()\n      this.changeData()\n    },\n    changeData() {\n      if (document.querySelector('#axis-0')) {\n        new Vue({\n          components: {\n            StHelpTooltip\n          },\n          render: h => <st-help-tooltip id=\"TBDAC003\" />\n        }).$mount('#axis-0')\n        new Vue({\n          components: {\n            StHelpTooltip\n          },\n          render: h => <st-help-tooltip id=\"TBDAC002\" />\n        }).$mount('#axis-1')\n        new Vue({\n          components: {\n            StHelpTooltip\n          },\n          render: h => <st-help-tooltip id=\"TBDAC001\" />\n        }).$mount('#axis-2')\n      }\n    }\n  }\n}\n</script>\n"]}]}