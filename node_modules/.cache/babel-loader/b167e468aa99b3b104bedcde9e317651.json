{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/team/reserve-info.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/team/reserve-info.vue","mtime":1600926555910},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.constructor\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.number.constructor\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { switchMap } from 'rxjs/operators';\nimport { MessageService } from '@/services/message.service';\nimport { TeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/team/service#/common.service';\nimport { TeamScheduleReserveService } from '@/views/pages/shop/product/course/schedule/team/service#/reserve.service';\nimport ScheduleTeamCancelCourse from '@/views/biz-modals/schedule/team/cancel-course';\nimport ScheduleTeamEditCourse from '@/views/biz-modals/schedule/team/edit-course';\nexport default {\n  name: 'ReserveInfo',\n  modals: {\n    ScheduleTeamCancelCourse: ScheduleTeamCancelCourse,\n    ScheduleTeamEditCourse: ScheduleTeamEditCourse\n  },\n  serviceInject: function serviceInject() {\n    return {\n      teamScheduleCommonService: TeamScheduleCommonService,\n      teamScheduleReserveService: TeamScheduleReserveService,\n      messageService: MessageService\n    };\n  },\n  rxState: function rxState() {\n    var common = this.teamScheduleCommonService;\n    return {\n      infoAuth: this.teamScheduleReserveService.infoAuth$,\n      memberOptions: common.memberOptions$,\n      consumeOptions: common.consumeOptions$,\n      unUsedSeatOptions: common.unUsedSeatOptions$\n    };\n  },\n  props: {\n    id: Number\n  },\n  filters: {\n    siteNumListFilter: function siteNumListFilter(val) {\n      return val.split(',').map(function (item) {\n        if (item === '0') {\n          return '无座位';\n        }\n\n        return item;\n      }).join(',');\n    }\n  },\n  data: function data() {\n    return {\n      isAdd: true,\n      showConsumeType: '',\n      memberId: '',\n      showSite: [],\n      consumeType: '',\n      keyword: '',\n      deductNum: 0,\n      effectiveState: 1,\n      consumeName: '',\n      consumeId: '',\n      consumeTypeId: '',\n      siteNumIds: [],\n      currentReservationNum: 0,\n      columns: [{\n        title: '会员姓名',\n        dataIndex: 'member',\n        width: 10,\n        scopedSlots: {\n          customRender: 'member'\n        }\n      }, {\n        title: '消费方式',\n        dataIndex: 'consume_type',\n        scopedSlots: {\n          customRender: 'consume_type'\n        }\n      }, {\n        title: '扣除额度',\n        dataIndex: 'deduct_num',\n        scopedSlots: {\n          customRender: 'deduct_num'\n        }\n      }, {\n        title: '座位号',\n        dataIndex: 'site_num_list',\n        scopedSlots: {\n          customRender: 'site_num_list'\n        }\n      }, {\n        title: '预约人数',\n        dataIndex: 'current_reservation_num',\n        scopedSlots: {\n          customRender: 'current_reservation_num'\n        }\n      }, {\n        title: '预约状态',\n        dataIndex: 'reserve_status',\n        scopedSlots: {\n          customRender: 'reserve_status'\n        }\n      }, {\n        title: '签到状态',\n        dataIndex: 'is_checkin'\n      }, {\n        title: '操作',\n        dataIndex: 'action',\n        scopedSlots: {\n          customRender: 'action'\n        }\n      }],\n      dataSource: [],\n      show: false,\n      info: {},\n      list: []\n    };\n  },\n  computed: {\n    courseId: function courseId() {\n      return this.info.course_id;\n    },\n    isUpRange: function isUpRange() {\n      var num = 0;\n      this.list.forEach(function (item) {\n        num += item.current_reservation_num;\n      });\n      return num < this.info.limit_num;\n    },\n    scheduleId: function scheduleId() {\n      return this.info.id;\n    },\n    courtSiteId: function courtSiteId() {\n      return this.info.court_site_id;\n    },\n    brandLimitNum: function brandLimitNum() {\n      return this.info.brand_limit_num;\n    }\n  },\n  methods: {\n    keywordFilter: function keywordFilter(item) {\n      var str;\n\n      if (item.is_minors === 1) {\n        str = \"\".concat(item.member_name, \"(\\u672A\\u6210\\u5E74) \").concat(item.parent_mobile, \"(\").concat(item.parent_user_role, \")\").replace(new RegExp(this.keyword), \"<span class=\\\"color-primary\\\">\".concat(this.keyword, \"</span>\"));\n      } else {\n        str = \"\".concat(item.member_name, \" \").concat(item.mobile).replace(new RegExp(this.keyword), \"<span class=\\\"color-primary\\\">\".concat(this.keyword, \"</span>\"));\n      }\n\n      return str;\n    },\n    onClickCancelCourse: function onClickCancelCourse() {\n      this.$modalRouter.push({\n        name: 'schedule-team-cancel-course',\n        props: {\n          id: this.info.id\n        }\n      });\n      this.show = false;\n    },\n    onClickEditCourse: function onClickEditCourse() {\n      var _this = this;\n\n      this.$modalRouter.push({\n        name: 'schedule-team-edit-course',\n        props: {\n          id: this.info.id\n        },\n        on: {\n          ok: function ok() {\n            _this.$router.reload();\n          }\n        }\n      });\n      this.show = false;\n    },\n    onSearch: function onSearch(value) {\n      this.keyword = value;\n      this.teamScheduleCommonService.getMemberList({\n        member: value\n      }).subscribe();\n    },\n    onClickCancel: function onClickCancel(id) {\n      var _this2 = this;\n\n      this.teamScheduleReserveService.del(id).subscribe(function () {\n        _this2.getReserve();\n      });\n    },\n    onClickCheckIn: function onClickCheckIn(id) {\n      var _this3 = this;\n\n      this.teamScheduleReserveService.check({\n        id: id,\n        checkin_method: 2\n      }).subscribe(function () {\n        _this3.getReserve();\n      });\n    },\n    getMemberName: function getMemberName(id) {\n      var memberName = '';\n      this.memberOptions.forEach(function (item) {\n        if (item.id === id) {\n          memberName = item.member_name;\n        }\n      });\n      return memberName;\n    },\n    onChange: function onChange(value) {\n      this.memberId = value;\n      this.showConsumeType = '';\n      this.memberName = this.getMemberName(value);\n      this.teamScheduleCommonService.getConsumeList({\n        schedule_id: this.scheduleId,\n        course_id: this.courseId,\n        member_id: value\n      }).subscribe();\n    },\n    onChangeConsumeType: function onChangeConsumeType(val) {\n      var obj = JSON.parse(val);\n      this.consumeType = obj.consume_type; //  因为会员卡，私教课，储值卡，课程包只有课程包有这个字段 没这个字段也是生效 undefined也为1\n\n      this.effectiveState = obj.effective_state === 0 ? 0 : 1;\n      this.consumeName = obj.name;\n      this.deductNum = obj.deduct_num;\n      this.consumeId = obj.id;\n    },\n    onChangeSiteNumList: function onChangeSiteNumList(val) {\n      var _this4 = this;\n\n      var tempArr = [];\n\n      if (val.length > this.brandLimitNum) {\n        this.messageService.error({\n          content: \"\\u6700\\u591A\\u9884\\u7EA6\".concat(this.brandLimitNum, \"\\u4E2A\\u5EA7\\u4F4D\")\n        });\n        var len = this.showSite.length;\n        this.showSite = this.showSite.slice(0, len - 1);\n        return;\n      }\n\n      var unSeatArr = this.unUsedSeatOptions.map(function (item) {\n        return item.name === '无座位' ? item.id : -1;\n      }).filter(function (item) {\n        return item !== -1;\n      });\n      this.siteNumIds = val.map(function (item) {\n        var value;\n\n        _this4.unUsedSeatOptions.forEach(function (ele) {\n          if (item === ele.id && ele.name !== '无座位') {\n            value = ele.name;\n          }\n        });\n\n        return unSeatArr.includes(item) ? -1 : value;\n      });\n      this.currentReservationNum = this.showSite.length;\n    },\n    resetData: function resetData() {\n      this.teamScheduleCommonService.SET_RESET_DATA();\n    },\n    add: function add() {\n      var _this5 = this;\n\n      var form = {\n        schedule_id: this.id,\n        member_id: this.memberId,\n        seat: this.siteNumIds,\n        consume_type: this.consumeType,\n        consume_id: this.consumeId\n      };\n      this.currentReservationNum = 0;\n      this.isAdd = false;\n      this.resetData();\n      this.teamScheduleReserveService.add(form).subscribe(function () {\n        _this5.isAdd = true;\n        _this5.showSite = [];\n        _this5.siteNumIds = [];\n        _this5.consumeType = '';\n        _this5.showConsumeType = '';\n        _this5.memberId = '';\n\n        _this5.getReserve();\n      }, function (err) {\n        console.log(err);\n        _this5.isAdd = true;\n        _this5.showSite = [];\n        _this5.siteNumIds = [];\n        _this5.consumeType = '';\n        _this5.showConsumeType = '';\n        _this5.memberId = '';\n      });\n    },\n    onClickReserve: function onClickReserve() {\n      var _this6 = this;\n\n      if (this.effectiveState) {\n        this.add();\n        return;\n      }\n\n      this.$confirm({\n        title: '',\n        content: \"\\u65B0\\u589E\\u9884\\u7EA6\\u540E, \".concat(this.memberName, \"\\u7684\\u8BFE\\u7A0B\\u5305\").concat(this.consumeName.split('(')[0], \"\\u4F1A\\u7ACB\\u5373\\u751F\\u6548\\uFF0C\\u786E\\u8BA4\\u65B0\\u589E?\"),\n        onOk: function onOk() {\n          _this6.add();\n\n          _this6.effectiveState = 1;\n        },\n        onCancel: function onCancel() {\n          console.log('Cancel');\n        },\n        class: 'test'\n      });\n    },\n    edit: function edit(key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (target) {\n        target.editable = true;\n        this.data = newData;\n      }\n\n      target.editable = true;\n      this.data = newData;\n    },\n    save: function save(key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (target) {\n        delete target.editable;\n        this.data = newData;\n        this.cacheData = newData.map(function (item) {\n          return _objectSpread({}, item);\n        });\n      }\n    },\n    getReserve: function getReserve() {\n      var _this7 = this;\n\n      var ss = this.teamScheduleReserveService;\n      ss.getInfo(this.id).pipe(switchMap(function (state) {\n        _this7.info = state.info;\n        _this7.list = state.list;\n        return _this7.teamScheduleCommonService.getUnusedSeatList({\n          schedule_id: state.info.id,\n          court_site_id: state.info.court_site_id\n        });\n      })).subscribe();\n    }\n  },\n  mounted: function mounted() {\n    this.getReserve();\n  }\n};",{"version":3,"sources":["reserve-info.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal\n    class=\"modal-reserved\"\n    title=\"预约详情\"\n    @ok=\"save\"\n    width=\"948px\"\n    v-model=\"show\"\n  >\n    <a-row :gutter=\"24\">\n      <a-col :lg=\"8\">\n        <st-info>\n          <st-info-item :label=\"`上课${$c('coach')}`\">\n            {{ info.coach_name }}\n          </st-info-item>\n          <st-info-item label=\"上课时间\">{{ info.start_time }}</st-info-item>\n        </st-info>\n      </a-col>\n      <a-col :lg=\"8\">\n        <st-info>\n          <st-info-item label=\"课程名称\">{{ info.course_name }}</st-info-item>\n          <st-info-item label=\"预约人数\">\n            {{ info.reserved_num }} / {{ info.limit_num }}\n          </st-info-item>\n        </st-info>\n      </a-col>\n      <a-col :lg=\"8\">\n        <st-info>\n          <st-info-item label=\"上课场地\">\n            {{ info.court_name }}\n            <span v-if=\"info.court_site_name\">\n              • {{ info.court_site_name }}\n            </span>\n          </st-info-item>\n          <st-info-item label=\"课时费\">{{ info.course_fee }}元</st-info-item>\n        </st-info>\n      </a-col>\n    </a-row>\n    <a-row :gutter=\"24\">\n      <a-col :lg=\"24\">\n        <st-info>\n          <st-info-item label=\"说明\">\n            {{ info.description }}\n            <span v-if=\"+info.is_show_description\" class=\"color-text-light\">\n              （显示在小程序）\n            </span>\n          </st-info-item>\n        </st-info>\n      </a-col>\n    </a-row>\n    <st-container class=\"modal-reserved-info__table\">\n      <st-form-table hoverable>\n        <thead>\n          <tr>\n            <th v-for=\"col in columns\" :key=\"col.dataIndex\">\n              {{ col.title }}\n              <st-help-tooltip\n                v-if=\"col.dataIndex == 'site_num_list'\"\n                id=\"TSGC002\"\n              />\n            </th>\n          </tr>\n        </thead>\n        <tbody v-if=\"isAdd\">\n          <tr v-if=\"isUpRange\">\n            <td width=\"120px\" class=\"mg-l0 st-form-table__add-td\">\n              <a-select\n                slot=\"member\"\n                showSearch\n                placeholder=\"搜索会员名\"\n                style=\"width:120px\"\n                :defaultActiveFirstOption=\"false\"\n                :dropdownMatchSelectWidth=\"false\"\n                :showArrow=\"false\"\n                :filterOption=\"false\"\n                @search=\"onSearch\"\n                @change=\"onChange\"\n                notFoundContent=\"无搜索结果\"\n              >\n                <a-select-option\n                  v-for=\"member in memberOptions\"\n                  :key=\"member.id\"\n                >\n                  <div class=\"st-form-table__add-option\">\n                    <span\n                      class=\"item-name\"\n                      v-html=\"keywordFilter(member)\"\n                    ></span>\n                  </div>\n                </a-select-option>\n              </a-select>\n            </td>\n            <td width=\"140px\" class=\"mg-l0 st-form-table__add-td\">\n              <a-select\n                slot=\"consume_type\"\n                placeholder=\"选择消费方式\"\n                style=\"width: 200px\"\n                v-model=\"showConsumeType\"\n                :dropdownMatchSelectWidth=\"false\"\n                @change=\"onChangeConsumeType\"\n              >\n                <a-select-opt-group\n                  v-for=\"consumeType in consumeOptions\"\n                  :key=\"consumeType.id\"\n                >\n                  <span slot=\"label\">\n                    <a-icon type=\"snippets\" />\n                    {{ consumeType.name }}\n                  </span>\n                  <a-select-option\n                    v-for=\"consume in consumeType.children\"\n                    :value=\"JSON.stringify(consume)\"\n                    :key=\"consume.id\"\n                  >\n                    {{ consume.name }}\n                  </a-select-option>\n                </a-select-opt-group>\n              </a-select>\n            </td>\n            <td width=\"120px\" class=\"mg-l0 st-form-table__add-td\">\n              {{ deductNum }}\n            </td>\n            <td width=\"120px\" class=\"mg-l0 st-form-table__add-td\">\n              <a-select\n                slot=\"site_num_list\"\n                mode=\"multiple\"\n                placeholder=\"选择座位\"\n                style=\"width: 100px\"\n                v-model=\"showSite\"\n                :maxTagCount=\"brandLimitNum\"\n                @change=\"onChangeSiteNumList\"\n              >\n                <a-select-option\n                  v-for=\"siteNum in unUsedSeatOptions\"\n                  :key=\"siteNum.id\"\n                >\n                  {{ siteNum.name }}\n                </a-select-option>\n              </a-select>\n            </td>\n            <td width=\"120px\">\n              <span slot=\"current_reservation_num\">\n                {{ currentReservationNum }}人\n              </span>\n            </td>\n            <td width=\"120px\">未预约</td>\n            <td width=\"120px\">未签到</td>\n            <td width=\"120px\">\n              <a\n                href=\"javascript:;\"\n                @click=\"onClickReserve\"\n                v-if=\"infoAuth['shop:reserve:team_course_reserve|add']\"\n              >\n                新增预约\n              </a>\n            </td>\n          </tr>\n          <tr v-else>\n            <td colspan=\"8\" class=\"ta-c st-form-table__add-td--disabled\">\n              预约人数已满\n            </td>\n          </tr>\n          <tr v-for=\"(item, index) in list\" :key=\"index\">\n            <td width=\"120px\">{{ item.member }}</td>\n            <td width=\"120px\">{{ item.consume_name }}</td>\n            <td width=\"120px\">{{ item.deduct_num }}</td>\n            <td width=\"120px\">{{ item.site_num_list | siteNumListFilter }}</td>\n            <td width=\"120px\">{{ item.current_reservation_num }}人</td>\n            <td width=\"120px\">{{ item.reserve_status_name }}</td>\n            <td width=\"120px\">{{ item.is_checkin_name }}</td>\n            <td width=\"120px\">\n              <div>\n                <st-popconfirm\n                  v-if=\"item.auth['shop:reserve:team_course_reserve|del']\"\n                  title=\"确认取消预约？\"\n                  @confirm=\"onClickCancel(item.reserve_id)\"\n                >\n                  <a class=\"operation\">取消预约</a>\n                </st-popconfirm>\n                <st-popconfirm\n                  v-if=\"item.auth['shop:reserve:team_course_reserve|checkin']\"\n                  title=\"确认签到消费？\"\n                  @confirm=\"onClickCheckIn(item.reserve_id)\"\n                >\n                  <a class=\"operation\">签到消费</a>\n                </st-popconfirm>\n              </div>\n            </td>\n          </tr>\n        </tbody>\n      </st-form-table>\n    </st-container>\n    <div slot=\"footer\" class=\"ta-r\">\n      <st-button\n        @click=\"onClickCancelCourse\"\n        v-if=\"infoAuth['shop:schedule:team_course_schedule|del']\"\n        class=\"mg-r8\"\n      >\n        取消课程\n      </st-button>\n      <st-button\n        @click=\"onClickEditCourse\"\n        v-if=\"infoAuth['shop:schedule:team_course_schedule|edit']\"\n        type=\"primary\"\n      >\n        修改课程\n      </st-button>\n    </div>\n  </st-modal>\n</template>\n\n<script>\nimport { switchMap } from 'rxjs/operators'\nimport { MessageService } from '@/services/message.service'\nimport { TeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/team/service#/common.service'\nimport { TeamScheduleReserveService } from '@/views/pages/shop/product/course/schedule/team/service#/reserve.service'\nimport ScheduleTeamCancelCourse from '@/views/biz-modals/schedule/team/cancel-course'\nimport ScheduleTeamEditCourse from '@/views/biz-modals/schedule/team/edit-course'\n\nexport default {\n  name: 'ReserveInfo',\n  modals: {\n    ScheduleTeamCancelCourse,\n    ScheduleTeamEditCourse\n  },\n  serviceInject() {\n    return {\n      teamScheduleCommonService: TeamScheduleCommonService,\n      teamScheduleReserveService: TeamScheduleReserveService,\n      messageService: MessageService\n    }\n  },\n  rxState() {\n    const common = this.teamScheduleCommonService\n    return {\n      infoAuth: this.teamScheduleReserveService.infoAuth$,\n      memberOptions: common.memberOptions$,\n      consumeOptions: common.consumeOptions$,\n      unUsedSeatOptions: common.unUsedSeatOptions$\n    }\n  },\n  props: {\n    id: Number\n  },\n  filters: {\n    siteNumListFilter(val) {\n      return val\n        .split(',')\n        .map(item => {\n          if (item === '0') {\n            return '无座位'\n          }\n          return item\n        })\n        .join(',')\n    }\n  },\n  data() {\n    return {\n      isAdd: true,\n      showConsumeType: '',\n      memberId: '',\n      showSite: [],\n      consumeType: '',\n      keyword: '',\n      deductNum: 0,\n      effectiveState: 1,\n      consumeName: '',\n      consumeId: '',\n      consumeTypeId: '',\n      siteNumIds: [],\n      currentReservationNum: 0,\n      columns: [\n        {\n          title: '会员姓名',\n          dataIndex: 'member',\n          width: 10,\n          scopedSlots: { customRender: 'member' }\n        },\n        {\n          title: '消费方式',\n          dataIndex: 'consume_type',\n          scopedSlots: { customRender: 'consume_type' }\n        },\n        {\n          title: '扣除额度',\n          dataIndex: 'deduct_num',\n          scopedSlots: { customRender: 'deduct_num' }\n        },\n        {\n          title: '座位号',\n          dataIndex: 'site_num_list',\n          scopedSlots: { customRender: 'site_num_list' }\n        },\n        {\n          title: '预约人数',\n          dataIndex: 'current_reservation_num',\n          scopedSlots: { customRender: 'current_reservation_num' }\n        },\n        {\n          title: '预约状态',\n          dataIndex: 'reserve_status',\n          scopedSlots: { customRender: 'reserve_status' }\n        },\n        {\n          title: '签到状态',\n          dataIndex: 'is_checkin'\n        },\n        {\n          title: '操作',\n          dataIndex: 'action',\n          scopedSlots: { customRender: 'action' }\n        }\n      ],\n      dataSource: [],\n      show: false,\n      info: {},\n      list: []\n    }\n  },\n  computed: {\n    courseId() {\n      return this.info.course_id\n    },\n    isUpRange() {\n      let num = 0\n      this.list.forEach(item => {\n        num += item.current_reservation_num\n      })\n      return num < this.info.limit_num\n    },\n\n    scheduleId() {\n      return this.info.id\n    },\n    courtSiteId() {\n      return this.info.court_site_id\n    },\n    brandLimitNum() {\n      return this.info.brand_limit_num\n    }\n  },\n  methods: {\n    keywordFilter(item) {\n      let str\n      if (item.is_minors === 1) {\n        str = `${item.member_name}(未成年) ${item.parent_mobile}(${item.parent_user_role})`.replace(\n          new RegExp(this.keyword),\n          `<span class=\"color-primary\">${this.keyword}</span>`\n        )\n      } else {\n        str = `${item.member_name} ${item.mobile}`.replace(\n          new RegExp(this.keyword),\n          `<span class=\"color-primary\">${this.keyword}</span>`\n        )\n      }\n      return str\n    },\n    onClickCancelCourse() {\n      this.$modalRouter.push({\n        name: 'schedule-team-cancel-course',\n        props: { id: this.info.id }\n      })\n      this.show = false\n    },\n    onClickEditCourse() {\n      this.$modalRouter.push({\n        name: 'schedule-team-edit-course',\n        props: { id: this.info.id },\n        on: {\n          ok: () => {\n            this.$router.reload()\n          }\n        }\n      })\n      this.show = false\n    },\n    onSearch(value) {\n      this.keyword = value\n      this.teamScheduleCommonService\n        .getMemberList({ member: value })\n        .subscribe()\n    },\n    onClickCancel(id) {\n      this.teamScheduleReserveService.del(id).subscribe(() => {\n        this.getReserve()\n      })\n    },\n    onClickCheckIn(id) {\n      this.teamScheduleReserveService\n        .check({ id, checkin_method: 2 })\n        .subscribe(() => {\n          this.getReserve()\n        })\n    },\n    getMemberName(id) {\n      let memberName = ''\n      this.memberOptions.forEach(item => {\n        if (item.id === id) {\n          memberName = item.member_name\n        }\n      })\n      return memberName\n    },\n    onChange(value) {\n      this.memberId = value\n      this.showConsumeType = ''\n      this.memberName = this.getMemberName(value)\n      this.teamScheduleCommonService\n        .getConsumeList({\n          schedule_id: this.scheduleId,\n          course_id: this.courseId,\n          member_id: value\n        })\n        .subscribe()\n    },\n    onChangeConsumeType(val) {\n      const obj = JSON.parse(val)\n      this.consumeType = obj.consume_type\n      //  因为会员卡，私教课，储值卡，课程包只有课程包有这个字段 没这个字段也是生效 undefined也为1\n      this.effectiveState = obj.effective_state === 0 ? 0 : 1\n      this.consumeName = obj.name\n      this.deductNum = obj.deduct_num\n      this.consumeId = obj.id\n    },\n    onChangeSiteNumList(val) {\n      let tempArr = []\n      if (val.length > this.brandLimitNum) {\n        this.messageService.error({\n          content: `最多预约${this.brandLimitNum}个座位`\n        })\n        let len = this.showSite.length\n        this.showSite = this.showSite.slice(0, len - 1)\n        return\n      }\n      const unSeatArr = this.unUsedSeatOptions\n        .map(item => (item.name === '无座位' ? item.id : -1))\n        .filter(item => item !== -1)\n      this.siteNumIds = val.map(item => {\n        let value\n        this.unUsedSeatOptions.forEach(ele => {\n          if (item === ele.id && ele.name !== '无座位') {\n            value = ele.name\n          }\n        })\n        return unSeatArr.includes(item) ? -1 : value\n      })\n      this.currentReservationNum = this.showSite.length\n    },\n    resetData() {\n      this.teamScheduleCommonService.SET_RESET_DATA()\n    },\n    add() {\n      const form = {\n        schedule_id: this.id,\n        member_id: this.memberId,\n        seat: this.siteNumIds,\n        consume_type: this.consumeType,\n        consume_id: this.consumeId\n      }\n      this.currentReservationNum = 0\n      this.isAdd = false\n      this.resetData()\n      this.teamScheduleReserveService.add(form).subscribe(\n        () => {\n          this.isAdd = true\n          this.showSite = []\n          this.siteNumIds = []\n          this.consumeType = ''\n          this.showConsumeType = ''\n          this.memberId = ''\n          this.getReserve()\n        },\n        err => {\n          console.log(err)\n          this.isAdd = true\n          this.showSite = []\n          this.siteNumIds = []\n          this.consumeType = ''\n          this.showConsumeType = ''\n          this.memberId = ''\n        }\n      )\n    },\n    onClickReserve() {\n      if (this.effectiveState) {\n        this.add()\n        return\n      }\n      this.$confirm({\n        title: '',\n        content: `新增预约后, ${this.memberName}的课程包${\n          this.consumeName.split('(')[0]\n        }会立即生效，确认新增?`,\n        onOk: () => {\n          this.add()\n          this.effectiveState = 1\n        },\n        onCancel() {\n          console.log('Cancel')\n        },\n        class: 'test'\n      })\n    },\n    edit(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        target.editable = true\n        this.data = newData\n      }\n      target.editable = true\n      this.data = newData\n    },\n    save(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        delete target.editable\n        this.data = newData\n        this.cacheData = newData.map(item => ({ ...item }))\n      }\n    },\n    getReserve() {\n      const ss = this.teamScheduleReserveService\n      ss.getInfo(this.id)\n        .pipe(\n          switchMap(state => {\n            this.info = state.info\n            this.list = state.list\n            return this.teamScheduleCommonService.getUnusedSeatList({\n              schedule_id: state.info.id,\n              court_site_id: state.info.court_site_id\n            })\n          })\n        )\n        .subscribe()\n    }\n  },\n  mounted() {\n    this.getReserve()\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/schedule/team"}]}