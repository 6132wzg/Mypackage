{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/sold/cabinet/list.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/sold/cabinet/list.vue","mtime":1597053439398},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport moment from 'moment'\nimport { cloneDeep, filter } from 'lodash-es'\nimport { UserService } from '@/services/user.service'\nimport { ListService } from './list.service'\nimport tableMixin from '@/mixins/table.mixin'\nimport { columns } from './list.config'\nimport SoldDealGatheringTip from '@/views/biz-modals/sold/deal/gathering-tip'\nimport SoldDealGathering from '@/views/biz-modals/sold/deal/gathering'\nimport SoldLeaseRefund from '@/views/biz-modals/sold/lease/refund'\nimport SoldLeaseRelet from '@/views/biz-modals/sold/lease/relet'\nimport SoldLeaseTransfer from '@/views/biz-modals/sold/lease/transfer'\nimport useInternalNoteActions from '@/hooks/shop/sold-internal-note-actions.hook'\n\nexport default {\n  name: 'PageShopSoldLease',\n  mixins: [tableMixin],\n  bem: {\n    basic: 'page-shop-sold'\n  },\n  modals: {\n    SoldDealGatheringTip,\n    SoldDealGathering,\n    SoldLeaseRefund,\n    SoldLeaseRelet,\n    SoldLeaseTransfer\n  },\n  serviceInject() {\n    return {\n      userService: UserService,\n      listService: ListService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.listService.loading$,\n      cabinetStatus: this.listService.cabinetStatus$,\n      page: this.listService.page$,\n      list: this.listService.list$,\n      auth: this.listService.auth$\n    }\n  },\n  computed: {\n    columns,\n    leaseList() {\n      let list = [{ value: -1, label: '全部' }]\n      if (!this.cabinetStatus.length) return list\n      this.cabinetStatus.forEach(o => {\n        list.push({ value: +o.value, label: o.label })\n      })\n      return list\n    }\n  },\n  hooks() {\n    return {\n      internalNoteActions: useInternalNoteActions()\n    }\n  },\n  data() {\n    return {\n      date: []\n    }\n  },\n  mounted() {\n    this.setSearchData()\n  },\n  watch: {\n    query(newVal) {\n      this.setSearchData()\n    }\n  },\n  methods: {\n    // 查询\n    onSearchNative() {\n      this.$searchQuery.start_time = this.date[0]\n        ? `${this.date[0].format('YYYY-MM-DD')} 00:00:00`\n        : ''\n      this.$searchQuery.end_time = this.date[1]\n        ? `${this.date[1].format('YYYY-MM-DD')} 23:59:59`\n        : ''\n      this.onSearch()\n    },\n    // 设置searchData\n    setSearchData() {\n      const start = this.$searchQuery.start_time\n        ? cloneDeep(moment(this.$searchQuery.start_time))\n        : null\n      const end = this.$searchQuery.end_time\n        ? cloneDeep(moment(this.$searchQuery.end_time))\n        : null\n      this.date = [start, end]\n    },\n    // 跳转合同\n    toContract(record) {\n      const order_id = record.order_id\n      let url = `${window.location.origin}/common/contract-preview?id=${order_id}`\n      window.open(url)\n    },\n    // 查看订单\n    createdOrderViewOrder(order_id) {\n      console.log('查看订单')\n      this.$router.push({\n        name: 'shop-finance-order-info-collection-details',\n        query: {\n          id: order_id\n        }\n      })\n    },\n    // 续租\n    onRelet(record) {\n      this.$modalRouter.push({\n        name: 'sold-lease-relet',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: result => {\n            if (result.type === 'create') {\n              // 创建订单成功\n              this.$modalRouter.push({\n                name: 'sold-deal-gathering-tip',\n                props: {\n                  order_id: result.order_id,\n                  type: 'cabinet_order',\n                  message: '订单创建成功',\n                  needPay: true\n                },\n                on: {\n                  success: res => {\n                    this.$router.reload()\n                    this.tipCallBack(res.orderId, 'cabinet_order', res.type)\n                  }\n                }\n              })\n            } else if (result.type === 'createPay') {\n              // 创建订单成功 并且到支付页面\n              this.$modalRouter.push({\n                name: 'sold-deal-gathering',\n                props: {\n                  order_id: result.order_id,\n                  type: 'cabinet_order'\n                },\n                on: {\n                  success: () => {\n                    this.$modalRouter.push({\n                      name: 'sold-deal-gathering-tip',\n                      props: {\n                        orderId: result.order_id,\n                        type: 'cabinet_order',\n                        message: '收款成功'\n                      },\n                      on: {\n                        success: res => {\n                          this.$router.reload()\n                          this.tipCallBack(\n                            result.order_id,\n                            'cabinet_order',\n                            res.type\n                          )\n                        }\n                      }\n                    })\n                  }\n                }\n              })\n            }\n          }\n        }\n      })\n    },\n    // 订单收款modal\n    createdOrderPay(props) {\n      return new Promise((resolve, reject) => {\n        this.$modalRouter.push({\n          name: 'sold-deal-gathering',\n          props,\n          on: {\n            success: resolve\n          }\n        })\n      })\n    },\n    // 订单收款回调\n    payCallBack(orderId, modalType, callBackType) {\n      switch (callBackType) {\n        case 'cancel':\n          this.onSearch()\n          break\n        case 'pay':\n          this.createdGatheringTip({\n            message: '收款成功',\n            order_id: orderId\n          }).then(res => {\n            this.tipCallBack(orderId, modalType, res.type)\n          })\n          break\n      }\n    },\n    // 提示框回调，gathering-tip\n    tipCallBack(orderId, modalType, callBackType) {\n      switch (callBackType) {\n        case 'cancel':\n          this.$router.reload()\n          break\n        case 'Print':\n          this.toContract({ order_id: orderId })\n          break\n        case 'PrintOrder':\n          this.printOrder(orderId)\n          break\n        case 'ViewOrder':\n          this.createdOrderViewOrder(orderId)\n          break\n        case 'Pay':\n          this.createdOrderPay({ order_id: orderId, type: modalType }).then(\n            res => {\n              this.payCallBack(orderId, modalType, res.type)\n            }\n          )\n          break\n      }\n    },\n    // 打印小票\n    printOrder(order_id) {\n      window.open(\n        '/ticket/gathering-print?id=' + order_id,\n        '_blank',\n        'width=800,height=600'\n      )\n    },\n    // 转让\n    onTransfer(record) {\n      this.$modalRouter.push({\n        name: 'sold-lease-transfer',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: result => {\n            this.$router.reload()\n          }\n        }\n      })\n    },\n    // 退款\n    onRefund(record) {\n      this.$modalRouter.push({\n        name: 'sold-lease-refund',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: result => {\n            this.$router.reload()\n          }\n        }\n      })\n    }\n  }\n}\n",{"version":3,"sources":["list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"list.vue","sourceRoot":"src/views/pages/shop/sold/cabinet","sourcesContent":["<template>\n  <st-panel app initial :class=\"basic()\">\n    <st-input-search\n      slot=\"title\"\n      placeholder=\"请输入租赁柜号、合同编号、会员姓名或手机号查找\"\n      v-model=\"$searchQuery.search\"\n      @search=\"onKeywordsSearch('search', $event)\"\n      style=\"width:400px\"\n    />\n    <st-search-panel @search=\"onSearchNative\" @reset=\"onSearchReset\">\n      <st-search-panel-item label=\"租赁状态：\">\n        <st-search-radio\n          v-model=\"$searchQuery.lease_status\"\n          :options=\"leaseList\"\n        />\n      </st-search-panel-item>\n      <st-search-panel-item label=\"起租时间：\">\n        <st-range-picker :disabledDays=\"180\" v-model=\"date\" />\n      </st-search-panel-item>\n    </st-search-panel>\n\n    <div :class=\"basic('content')\">\n      <div :class=\"basic('content-batch')\">\n        <!-- NOTE: 导出 -->\n        <!-- <st-button v-if=\"auth.export\"  type=\"primary\">批量导出</st-button> -->\n      </div>\n      <st-table\n        :page=\"page\"\n        :loading=\"loading.getList\"\n        rowKey=\"id\"\n        :columns=\"columns\"\n        @change=\"onTableChange\"\n        :dataSource=\"list\"\n      >\n        <template slot=\"lease_status\" slot-scope=\"record\">\n          <st-text\n            class=\"white-nowrap\"\n            :status=\"{\n              success: record.id === 1,\n              error: record.id === 2,\n              warning: record.id === 3\n            }\"\n          >\n            {{ record.name }}\n          </st-text>\n        </template>\n        <template slot=\"member_name\" slot-scope=\"text, record\">\n          <template v-if=\"record.is_minors\">\n            <span class=\"word-break\">{{ record.member_name }}(未成年)</span>\n          </template>\n          <template v-else>\n            <span class=\"word-break\">{{ record.member_name }}</span>\n          </template>\n        </template>\n        <template slot=\"member_mobile\" slot-scope=\"text, record\">\n          <template v-if=\"record.is_minors\">\n            {{ record.parent_mobile }}({{ record.parent_user_role }})\n          </template>\n          <template v-else>\n            {{ record.member_mobile }}\n          </template>\n        </template>\n        <template slot=\"sell_time\" slot-scope=\"text, record\">\n          <span class=\"word-break\">\n            {{ record.start_time }} ~ {{ record.end_time }}\n          </span>\n        </template>\n        <div slot=\"action\" slot-scope=\"text, record\">\n          <st-table-actions>\n            <a\n              v-if=\"record.auth['shop:sold:sold_cabinet|renew']\"\n              @click=\"onRelet(record)\"\n            >\n              续租\n            </a>\n            <a\n              v-if=\"record.auth['shop:sold:sold_cabinet|export_contract']\"\n              @click=\"toContract(record)\"\n            >\n              查看合同\n            </a>\n            <a\n              v-if=\"record.auth['shop:sold:sold_cabinet|transfer']\"\n              @click=\"onTransfer(record)\"\n            >\n              转让\n            </a>\n            <a\n              v-if=\"record.auth['brand_shop:order:order|refund']\"\n              @click=\"onRefund(record)\"\n            >\n              退款\n            </a>\n            <a\n              v-if=\"record.auth['shop:sold:sold_cabinet|internal_description']\"\n              @click=\"internalNoteActions.onOpenModal(record)\"\n            >\n              对内备注\n            </a>\n          </st-table-actions>\n        </div>\n      </st-table>\n    </div>\n  </st-panel>\n</template>\n\n<script>\nimport moment from 'moment'\nimport { cloneDeep, filter } from 'lodash-es'\nimport { UserService } from '@/services/user.service'\nimport { ListService } from './list.service'\nimport tableMixin from '@/mixins/table.mixin'\nimport { columns } from './list.config'\nimport SoldDealGatheringTip from '@/views/biz-modals/sold/deal/gathering-tip'\nimport SoldDealGathering from '@/views/biz-modals/sold/deal/gathering'\nimport SoldLeaseRefund from '@/views/biz-modals/sold/lease/refund'\nimport SoldLeaseRelet from '@/views/biz-modals/sold/lease/relet'\nimport SoldLeaseTransfer from '@/views/biz-modals/sold/lease/transfer'\nimport useInternalNoteActions from '@/hooks/shop/sold-internal-note-actions.hook'\n\nexport default {\n  name: 'PageShopSoldLease',\n  mixins: [tableMixin],\n  bem: {\n    basic: 'page-shop-sold'\n  },\n  modals: {\n    SoldDealGatheringTip,\n    SoldDealGathering,\n    SoldLeaseRefund,\n    SoldLeaseRelet,\n    SoldLeaseTransfer\n  },\n  serviceInject() {\n    return {\n      userService: UserService,\n      listService: ListService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.listService.loading$,\n      cabinetStatus: this.listService.cabinetStatus$,\n      page: this.listService.page$,\n      list: this.listService.list$,\n      auth: this.listService.auth$\n    }\n  },\n  computed: {\n    columns,\n    leaseList() {\n      let list = [{ value: -1, label: '全部' }]\n      if (!this.cabinetStatus.length) return list\n      this.cabinetStatus.forEach(o => {\n        list.push({ value: +o.value, label: o.label })\n      })\n      return list\n    }\n  },\n  hooks() {\n    return {\n      internalNoteActions: useInternalNoteActions()\n    }\n  },\n  data() {\n    return {\n      date: []\n    }\n  },\n  mounted() {\n    this.setSearchData()\n  },\n  watch: {\n    query(newVal) {\n      this.setSearchData()\n    }\n  },\n  methods: {\n    // 查询\n    onSearchNative() {\n      this.$searchQuery.start_time = this.date[0]\n        ? `${this.date[0].format('YYYY-MM-DD')} 00:00:00`\n        : ''\n      this.$searchQuery.end_time = this.date[1]\n        ? `${this.date[1].format('YYYY-MM-DD')} 23:59:59`\n        : ''\n      this.onSearch()\n    },\n    // 设置searchData\n    setSearchData() {\n      const start = this.$searchQuery.start_time\n        ? cloneDeep(moment(this.$searchQuery.start_time))\n        : null\n      const end = this.$searchQuery.end_time\n        ? cloneDeep(moment(this.$searchQuery.end_time))\n        : null\n      this.date = [start, end]\n    },\n    // 跳转合同\n    toContract(record) {\n      const order_id = record.order_id\n      let url = `${window.location.origin}/common/contract-preview?id=${order_id}`\n      window.open(url)\n    },\n    // 查看订单\n    createdOrderViewOrder(order_id) {\n      console.log('查看订单')\n      this.$router.push({\n        name: 'shop-finance-order-info-collection-details',\n        query: {\n          id: order_id\n        }\n      })\n    },\n    // 续租\n    onRelet(record) {\n      this.$modalRouter.push({\n        name: 'sold-lease-relet',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: result => {\n            if (result.type === 'create') {\n              // 创建订单成功\n              this.$modalRouter.push({\n                name: 'sold-deal-gathering-tip',\n                props: {\n                  order_id: result.order_id,\n                  type: 'cabinet_order',\n                  message: '订单创建成功',\n                  needPay: true\n                },\n                on: {\n                  success: res => {\n                    this.$router.reload()\n                    this.tipCallBack(res.orderId, 'cabinet_order', res.type)\n                  }\n                }\n              })\n            } else if (result.type === 'createPay') {\n              // 创建订单成功 并且到支付页面\n              this.$modalRouter.push({\n                name: 'sold-deal-gathering',\n                props: {\n                  order_id: result.order_id,\n                  type: 'cabinet_order'\n                },\n                on: {\n                  success: () => {\n                    this.$modalRouter.push({\n                      name: 'sold-deal-gathering-tip',\n                      props: {\n                        orderId: result.order_id,\n                        type: 'cabinet_order',\n                        message: '收款成功'\n                      },\n                      on: {\n                        success: res => {\n                          this.$router.reload()\n                          this.tipCallBack(\n                            result.order_id,\n                            'cabinet_order',\n                            res.type\n                          )\n                        }\n                      }\n                    })\n                  }\n                }\n              })\n            }\n          }\n        }\n      })\n    },\n    // 订单收款modal\n    createdOrderPay(props) {\n      return new Promise((resolve, reject) => {\n        this.$modalRouter.push({\n          name: 'sold-deal-gathering',\n          props,\n          on: {\n            success: resolve\n          }\n        })\n      })\n    },\n    // 订单收款回调\n    payCallBack(orderId, modalType, callBackType) {\n      switch (callBackType) {\n        case 'cancel':\n          this.onSearch()\n          break\n        case 'pay':\n          this.createdGatheringTip({\n            message: '收款成功',\n            order_id: orderId\n          }).then(res => {\n            this.tipCallBack(orderId, modalType, res.type)\n          })\n          break\n      }\n    },\n    // 提示框回调，gathering-tip\n    tipCallBack(orderId, modalType, callBackType) {\n      switch (callBackType) {\n        case 'cancel':\n          this.$router.reload()\n          break\n        case 'Print':\n          this.toContract({ order_id: orderId })\n          break\n        case 'PrintOrder':\n          this.printOrder(orderId)\n          break\n        case 'ViewOrder':\n          this.createdOrderViewOrder(orderId)\n          break\n        case 'Pay':\n          this.createdOrderPay({ order_id: orderId, type: modalType }).then(\n            res => {\n              this.payCallBack(orderId, modalType, res.type)\n            }\n          )\n          break\n      }\n    },\n    // 打印小票\n    printOrder(order_id) {\n      window.open(\n        '/ticket/gathering-print?id=' + order_id,\n        '_blank',\n        'width=800,height=600'\n      )\n    },\n    // 转让\n    onTransfer(record) {\n      this.$modalRouter.push({\n        name: 'sold-lease-transfer',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: result => {\n            this.$router.reload()\n          }\n        }\n      })\n    },\n    // 退款\n    onRefund(record) {\n      this.$modalRouter.push({\n        name: 'sold-lease-refund',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: result => {\n            this.$router.reload()\n          }\n        }\n      })\n    }\n  }\n}\n</script>\n"]}]}