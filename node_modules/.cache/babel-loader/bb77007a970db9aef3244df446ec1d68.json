{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/personal/add-reserve.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/personal/add-reserve.vue","mtime":1597396799938},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.regexp.split\";\nimport _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.constructor\";\nimport \"core-js/modules/es6.regexp.replace\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { PersonalScheduleCommonService as CommonService } from '@/views/pages/shop/product/course/schedule/personal/service#/common.service';\nimport { difference, cloneDeep } from 'lodash-es';\nimport { PersonalScheduleReserveService as ReserveService } from '@/views/pages/shop/product/course/schedule/personal/service#/reserve.service';\nimport { ruleOptions } from \"./add-reserve.config\";\nexport default {\n  name: 'AddReserve',\n  serviceInject: function serviceInject() {\n    return {\n      commonService: CommonService,\n      reserveService: ReserveService\n    };\n  },\n  rxState: function rxState() {\n    var cs = this.commonService;\n    return {\n      loading: this.reserveService.loading$,\n      courseCoachOptions: cs.courseCoachOptions$,\n      consumeOptions: cs.consumeOptions$,\n      memberOptions: cs.memberOptions$,\n      courseOptions: cs.courseOptions$,\n      dateOptions: cs.dateOptions$,\n      timeOptions: cs.timeOptions$\n    };\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      memberName: '',\n      consumeName: '',\n      form: form,\n      decorators: decorators,\n      member_id: '',\n      show: false,\n      effectiveState: 1,\n      keyword: '',\n      value: '',\n      fetching: false,\n      formKeyFlag: ['consume_type', 'course_id', 'coach_id', 'scheduling_id', 'reserve_start_time'],\n      reserveDate: ''\n    };\n  },\n  methods: {\n    keywordFilter: function keywordFilter(str) {\n      if (!this.keyword) return str;\n      str = str.replace(new RegExp(this.keyword), \"<span class=\\\"color-primary\\\">\".concat(this.keyword, \"</span>\"));\n      return str;\n    },\n    // 获取消费方式 权重2\n    onChangeConsume: function onChangeConsume(val) {\n      if (!val) return;\n      var v = JSON.parse(val); //  因为会员卡，私教课，储值卡，课程包只有课程包有这个字段 没这个字段也是生效 undefined也为1\n\n      this.effectiveState = v.effective_state === 0 ? 0 : 1;\n      this.consumeName = v.name;\n      this.form.setFieldsValue({\n        course_id: '',\n        coach_id: '',\n        scheduling_id: undefined,\n        'reserve_start_time:': undefined\n      });\n      this.commonService.getCourseList({\n        id: +v.id,\n        consume_type: +v.consume_type\n      }).subscribe();\n    },\n    // 获取会员 权重1\n    onSearchMember: function onSearchMember(val) {\n      var _this = this;\n\n      this.fetching = true;\n      this.keyword = val;\n      this.commonService.getOptions('getMemberList', {\n        member: val\n      }, function () {\n        _this.fetching = false;\n      });\n    },\n    // 获取上课课程 权重4\n    onChangeCourse: function onChangeCourse(val) {\n      this.form.setFieldsValue({\n        coach_id: '',\n        scheduling_id: undefined,\n        reserve_start_time: undefined\n      });\n      this.getCoachList(val);\n    },\n    getCoachList: function getCoachList(id) {\n      var consume = JSON.parse(this.form.getFieldValue('consume_type'));\n      var consume_id = consume.id,\n          consume_type = consume.consume_type;\n      var query = {\n        consume_id: consume_id,\n        consume_type: consume_type\n      };\n      this.commonService.getCourseCoachList(id, query).subscribe();\n    },\n    // 获取时期\n    onChangeDatePick: function onChangeDatePick(val) {\n      var course_id = this.form.getFieldValue('course_id');\n      var reserveDate = {\n        id: '',\n        course_id: course_id\n      };\n      this.form.setFieldsValue({\n        reserve_start_time: undefined\n      });\n      this.dateOptions.forEach(function (item) {\n        val.format('YYYY-MM-DD') === item.schedule_date && (reserveDate.id = item.id);\n      });\n\n      var query = _objectSpread({}, reserveDate, {\n        member_id: this.member_id\n      });\n\n      this.commonService.getOptions('getTimeList', query, function () {});\n    },\n    onChangeCourseCoach: function onChangeCourseCoach(val) {\n      this.form.setFieldsValue({\n        scheduling_id: undefined,\n        reserve_start_time: undefined\n      });\n      this.commonService.getOptions('getDateList', {\n        id: val,\n        member_id: this.member_id\n      }, function () {});\n    },\n    range: function range(start, end) {\n      var result = [];\n\n      for (var i = start; i <= end; i++) {\n        result.push(i);\n      }\n\n      return result;\n    },\n    disabledDate: function disabledDate(current) {\n      return current && !this.dateOptions.map(function (item) {\n        return item.schedule_date;\n      }).includes(current.format('YYYY-MM-DD').valueOf());\n    },\n    disabledMinutes: function disabledMinutes(selectedHour) {\n      if (!this.timeOptions.timing) return;\n      var disabledMinutes = [];\n      var allTime = this.range(0, 60);\n\n      for (var i = 0; i < this.timeOptions.timing.length; i++) {\n        var startHour = +moment(\"\".concat(this.timeOptions.schedule_date, \" \").concat(this.timeOptions.timing[i].start_time)).format('H').valueOf();\n        var endHour = +moment(\"\".concat(this.timeOptions.schedule_date, \" \").concat(this.timeOptions.timing[i].end_time)).format('H').valueOf();\n        var start = +moment(\"\".concat(this.timeOptions.schedule_date, \" \").concat(this.timeOptions.timing[i].start_time)).format('mm').valueOf();\n        var end = +moment(\"\".concat(this.timeOptions.schedule_date, \" \").concat(this.timeOptions.timing[i].end_time)).format('mm').valueOf();\n\n        if (+selectedHour === startHour && +selectedHour === endHour) {\n          disabledMinutes = [].concat(_toConsumableArray(disabledMinutes), _toConsumableArray(this.range(start, end)));\n        } else {\n          if (+selectedHour === startHour) {\n            disabledMinutes = [].concat(_toConsumableArray(disabledMinutes), _toConsumableArray(this.range(start, 60)));\n          } else if (+selectedHour === endHour) {\n            disabledMinutes = [].concat(_toConsumableArray(disabledMinutes), _toConsumableArray(this.range(0, end)));\n          } else if (+selectedHour > startHour && endHour > +selectedHour) {\n            disabledMinutes = [].concat(_toConsumableArray(disabledMinutes), _toConsumableArray(this.range(0, 60)));\n          }\n        }\n      }\n\n      return difference(allTime, disabledMinutes);\n    },\n    disabledHours: function disabledHours() {\n      if (!this.timeOptions.timing) return;\n      var disabledHours = [];\n      var allTime = this.range(0, 24);\n\n      for (var i = 0; i < this.timeOptions.timing.length; i++) {\n        var start = +moment(\"\".concat(this.timeOptions.schedule_date, \" \").concat(this.timeOptions.timing[i].start_time)).format('H').valueOf();\n        var end = +moment(\"\".concat(this.timeOptions.schedule_date, \" \").concat(this.timeOptions.timing[i].end_time)).format('H').valueOf();\n\n        if (!end && this.timeOptions.timing[i].end_time.includes('24')) {\n          end = 24;\n        }\n\n        disabledHours = [].concat(_toConsumableArray(disabledHours), _toConsumableArray(this.range(start, end)));\n      }\n\n      return difference(allTime, disabledHours) || null;\n    },\n    add: function add() {\n      var _this2 = this;\n\n      this.form.validate().then(function (values) {\n        var consume = JSON.parse(values.consume_type);\n        var form = cloneDeep(values);\n        form.member_id = values.member_id;\n        form.consume_type = consume.consume_type;\n        form.consume_id = consume.id;\n        form.reserve_start_time = values.reserve_start_time.format('HH:mm').valueOf();\n\n        _this2.dateOptions.forEach(function (item) {\n          if (item.schedule_date === values.scheduling_id.format('YYYY-MM-DD').valueOf()) {\n            form.scheduling_id = item.id;\n          }\n        });\n\n        _this2.reserveService.add(form).subscribe(function (res) {\n          _this2.show = false;\n\n          _this2.$router.reload();\n        });\n      });\n    },\n    save: function save() {\n      var _this3 = this;\n\n      if (this.effectiveState) {\n        this.add();\n        return;\n      }\n\n      this.$confirm({\n        title: '',\n        content: \"\\u65B0\\u589E\\u9884\\u7EA6\\u540E, \".concat(this.memberName, \"\\u7684\\u8BFE\\u7A0B\\u5305\").concat(this.consumeName.split('(')[0], \"\\u4F1A\\u7ACB\\u5373\\u751F\\u6548\\uFF0C\\u786E\\u8BA4\\u65B0\\u589E?\"),\n        onOk: function onOk() {\n          _this3.add();\n\n          _this3.effectiveState = 1;\n        },\n        onCancel: function onCancel() {\n          console.log('Cancel');\n        }\n      });\n    },\n    getMemberName: function getMemberName(id) {\n      var memberName = '';\n      this.memberOptions.forEach(function (item) {\n        if (item.member_id === id) {\n          memberName = item.member_name;\n        }\n      });\n      return memberName;\n    },\n    onChangeMember: function onChangeMember(val) {\n      this.form.resetFields();\n      this.member_id = val;\n      this.memberName = this.getMemberName(val);\n      this.commonService.getOptions('getConsumeList', val, function () {});\n    }\n  }\n};",null]}