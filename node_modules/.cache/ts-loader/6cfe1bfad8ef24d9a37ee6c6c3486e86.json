{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/package/list.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/package/list.service.ts","mtime":1600926556181},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b, _c, _d, _e;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { Injectable } from 'vue-service-app';\nimport { State } from 'rx-state';\nimport { BrandPackageApi } from '@/api/v1/package/brand';\nimport { anyAll } from '@/operators';\nimport { UserService } from '@/services/user.service';\nimport { tap } from 'rxjs/operators';\nimport { MessageService } from '@/services/message.service';\nimport { AuthService } from '@/services/auth.service';\nimport { PackageCommit } from '@/views/biz-service/product/package.commit';\n\nvar ListService = /*#__PURE__*/function () {\n  function ListService(userService, msg, brandPackageApi, authService, commit) {\n    _classCallCheck(this, ListService);\n\n    this.userService = userService;\n    this.msg = msg;\n    this.brandPackageApi = brandPackageApi;\n    this.authService = authService;\n    this.commit = commit;\n    this.list$ = new State([]);\n    this.page$ = new State({});\n    this.upShelfInfo$ = new State({});\n    this.downShelfInfo$ = new State({});\n    this.loading$ = new State({});\n    this.packageType$ = this.userService.getOptions$('package_course.package_type', {\n      addAll: '全部属性'\n    });\n    this.supportNum$ = this.userService.getOptions$('package_course.support_num', {\n      addAll: '支持使用人数'\n    });\n    this.auth$ = this.authService.authMap$({\n      add: 'brand:product:package_course|add'\n    });\n    this.publicChannel$ = this.userService.getOptions$('package_course.publish_channel', {\n      addAll: '全部发布渠道'\n    });\n  }\n\n  _createClass(ListService, [{\n    key: \"getList\",\n    value: function getList(query) {\n      var _this = this;\n\n      return this.brandPackageApi.getList(query).pipe(tap(function (res) {\n        // this.SET_PACKAGE_LIST(res.list)\n        _this.list$.commit(function () {\n          return _this.commit.SET_PACKAGE_LIST(res.list);\n        });\n\n        _this.page$.commit(function () {\n          return res.page;\n        });\n      }));\n    }\n  }, {\n    key: \"deletePackage\",\n    value: function deletePackage(id) {\n      var _this2 = this;\n\n      return this.brandPackageApi.deletePackage(id).pipe(tap(function (res) {\n        _this2.msg.success({\n          content: '删除课程包成功'\n        });\n      }));\n    }\n  }, {\n    key: \"setSyncSold\",\n    value: function setSyncSold(id) {\n      var _this3 = this;\n\n      return this.brandPackageApi.setSyncSold(id).pipe(tap(function () {\n        _this3.msg.success({\n          content: '同步至售出成功'\n        });\n      }));\n    }\n  }, {\n    key: \"init\",\n    value: function init(query) {\n      return anyAll(this.getList(query));\n    }\n  }, {\n    key: \"beforeEach\",\n    value: function beforeEach(to, from) {\n      return this.init(to.meta.query);\n    }\n  }]);\n\n  return ListService;\n}();\n\nListService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _a : Object, typeof (_b = typeof MessageService !== \"undefined\" && MessageService) === \"function\" ? _b : Object, typeof (_c = typeof BrandPackageApi !== \"undefined\" && BrandPackageApi) === \"function\" ? _c : Object, typeof (_d = typeof AuthService !== \"undefined\" && AuthService) === \"function\" ? _d : Object, typeof (_e = typeof PackageCommit !== \"undefined\" && PackageCommit) === \"function\" ? _e : Object])], ListService);\nexport { ListService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/package/list.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Query } from '@/api/v1/app/venue/data'\nimport { Controller, ServiceRoute, Injectable } from 'vue-service-app'\nimport { State } from 'rx-state'\nimport { BrandPackageApi, QueryInfo, QueryInput } from '@/api/v1/package/brand'\nimport { RedirectService } from '@/services/redirect.service'\nimport { anyAll } from '@/operators'\nimport { UserService } from '@/services/user.service'\nimport { tap } from 'rxjs/operators'\nimport { MessageService } from '@/services/message.service'\nimport { AuthService } from '@/services/auth.service'\nimport { PackageCommit } from '@/views/biz-service/product/package.commit'\n\n@Injectable()\nexport class ListService implements Controller {\n  list$ = new State([])\n  page$ = new State({})\n  upShelfInfo$ = new State({})\n  downShelfInfo$ = new State({})\n  loading$ = new State({})\n  packageType$ = this.userService.getOptions$('package_course.package_type', {\n    addAll: '全部属性'\n  })\n  supportNum$ = this.userService.getOptions$('package_course.support_num', {\n    addAll: '支持使用人数'\n  })\n  auth$ = this.authService.authMap$({\n    add: 'brand:product:package_course|add'\n  })\n  publicChannel$ = this.userService.getOptions$(\n    'package_course.publish_channel',\n    {\n      addAll: '全部发布渠道'\n    }\n  )\n  constructor(\n    private userService: UserService,\n    private msg: MessageService,\n    private brandPackageApi: BrandPackageApi,\n    private authService: AuthService,\n    private commit: PackageCommit\n  ) {}\n  getList(query: QueryInfo) {\n    return this.brandPackageApi.getList(query).pipe(\n      tap(res => {\n        // this.SET_PACKAGE_LIST(res.list)\n        this.list$.commit(() => this.commit.SET_PACKAGE_LIST(res.list))\n        this.page$.commit(() => res.page)\n      })\n    )\n  }\n  deletePackage(id: string | number) {\n    return this.brandPackageApi.deletePackage(id).pipe(\n      tap(res => {\n        this.msg.success({ content: '删除课程包成功' })\n      })\n    )\n  }\n  setSyncSold(id: string | number) {\n    return this.brandPackageApi.setSyncSold(id).pipe(\n      tap(() => {\n        this.msg.success({ content: '同步至售出成功' })\n      })\n    )\n  }\n  init(query: QueryInfo) {\n    return anyAll(this.getList(query))\n  }\n  beforeEach(to: ServiceRoute, from: ServiceRoute) {\n    return this.init(to.meta.query)\n  }\n}\n"],"sourceRoot":""}]}