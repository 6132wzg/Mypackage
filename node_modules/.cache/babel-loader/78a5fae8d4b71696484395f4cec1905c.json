{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/card/renewal-member.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/card/renewal-member.vue","mtime":1600926382262},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { RenewalMemberService } from \"./renewal-member.service\";\nimport moment from 'moment';\nimport { cloneDeep } from 'lodash-es';\nimport { timer } from 'rxjs';\nimport { ruleOptions } from \"./renewal-member.config\";\nimport autoContractBtn from '@/views/biz-components/contract/auto-contract-btn.vue';\nexport default {\n  name: 'ModalSoldRenewalMemberCard',\n  bem: {\n    sale: 'modal-sold-deal-sale'\n  },\n  serviceProviders: function serviceProviders() {\n    return [RenewalMemberService];\n  },\n  serviceInject: function serviceInject() {\n    return {\n      renewalMemberService: RenewalMemberService\n    };\n  },\n  components: {\n    autoContractBtn: autoContractBtn\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.renewalMemberService.loading$,\n      couponList: this.renewalMemberService.couponList$,\n      advanceList: this.renewalMemberService.advanceList$,\n      priceInfo: this.renewalMemberService.priceInfo$,\n      saleList: this.renewalMemberService.saleList$,\n      info: this.renewalMemberService.info$\n    };\n  },\n  props: ['id'],\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      show: false,\n      // 规格\n      selectSpecs: 1,\n      // 时间\n      startTime: null,\n      endTime: '',\n      // 赠送\n      giftAmount: null,\n      // 优惠\n      couponDropdownVisible: false,\n      couponText: '未选择优惠券',\n      couponAmount: '',\n      selectCoupon: '',\n      // 定金\n      advanceDropdownVisible: false,\n      advanceText: '未选择定金',\n      advanceAmount: '',\n      selectAdvance: '',\n      // 减免金额\n      reduceAmount: null,\n      // 描述\n      description: ''\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    this.renewalMemberService.serviceInit(this.id).subscribe(function (res) {\n      // 获取优惠券\n      _this.renewalMemberService.getCouponList({\n        member_id: res[0].info.member_id,\n        card_id: res[0].info.card_id,\n        specs_id: res[0].info.specs[0].id\n      }).subscribe(); // 获取定金\n\n\n      _this.renewalMemberService.getAdvanceList(res[0].info.member_id).subscribe(); // 规格\n\n\n      _this.selectSpecs = res[0].info.specs[0].id;\n\n      _this.form.setFieldsValue({\n        startTime: moment(res[0].info.default_start_time * 1000)\n      }); // 实付金额\n\n\n      _this.getPrice('', 0, '', res[0].info.specs[0].id);\n\n      _this.startTime = cloneDeep(moment(res[0].info.default_start_time * 1000));\n      _this.endTime = moment(res[0].info.default_start_time * 1000).add(res[0].info.specs[0].valid_time, 'd').format('YYYY-MM-DD HH:mm');\n    });\n  },\n  watch: {\n    selectSpecs: function selectSpecs(newVal, oldVal) {\n      this.getPrice(this.selectAdvance, +this.reduceAmount, this.selectCoupon, newVal);\n    },\n    selectAdvance: {\n      deep: true,\n      handler: function handler(newVal, oldVal) {\n        this.getPrice(newVal, +this.reduceAmount, this.selectCoupon, this.selectSpecs);\n      }\n    },\n    selectCoupon: {\n      deep: true,\n      handler: function handler(newVal, oldVal) {\n        this.getPrice(this.selectAdvance, +this.reduceAmount, newVal, this.selectSpecs);\n      }\n    },\n    reduceAmount: function reduceAmount(newVal, oldVal) {\n      this.getPrice(this.selectAdvance, +newVal, this.selectCoupon, this.selectSpecs);\n    }\n  },\n  computed: {\n    // 商品价格\n    cardPrice: function cardPrice() {\n      var _this2 = this;\n\n      if (this.info.specs) {\n        var arr = this.info.specs.filter(function (i) {\n          return i.id === _this2.selectSpecs;\n        });\n\n        if (arr.length > 0) {\n          return arr[0].price;\n        }\n\n        return '0';\n      }\n\n      return '0';\n    },\n    orderAmountText: function orderAmountText() {\n      return this.priceInfo < 0 ? '小计不能为负' : '';\n    },\n    isFamilyCard: function isFamilyCard() {\n      return this.info.card_number_type === 2;\n    }\n  },\n  methods: {\n    moment: moment,\n    // 规格\n    onSpecsChange: function onSpecsChange(data) {\n      var _this3 = this;\n\n      var item = this.info.specs.filter(function (i) {\n        return i.id === data.target.value;\n      })[0];\n      var s = cloneDeep(this.startTime);\n      var dayScope = item.valid_time;\n      this.endTime = s.add(dayScope, 'd').format('YYYY-MM-DD HH:mm'); // 获取优惠券\n\n      this.renewalMemberService.getCouponList({\n        member_id: this.info.member_id,\n        card_id: this.info.card_id,\n        specs_id: item.id\n      }).subscribe(function (res) {\n        _this3.resetCoupon();\n      });\n    },\n    // 时间\n    disabledStartDate: function disabledStartDate(startTime) {\n      return startTime.valueOf() < this.info.default_start_time * 1000;\n    },\n    onStartTimeChange: function onStartTimeChange(data) {\n      var _this4 = this;\n\n      this.startTime = cloneDeep(data);\n      var s = cloneDeep(data);\n      var dayScope = this.info.specs.filter(function (i) {\n        return i.id === _this4.selectSpecs;\n      })[0].valid_time;\n      this.endTime = s.add(dayScope, 'd').format('YYYY-MM-DD HH:mm');\n    },\n    // 合同\n    onCodeNumber: function onCodeNumber() {\n      var _this5 = this;\n\n      this.renewalMemberService.getCodeNumber(this.info.contract_type).subscribe(function (res) {\n        _this5.form.setFieldsValue({\n          contractNumber: res.info.code\n        });\n      });\n    },\n    // 优惠\n    onSelectCouponChange: function onSelectCouponChange(data) {\n      if (data.target.value === -1) {\n        this.couponAmount = '';\n        this.couponText = '未选择优惠券';\n        return;\n      }\n\n      var price = this.couponList.filter(function (o) {\n        return o.id === data.target.value;\n      })[0].price;\n      this.couponAmount = price;\n      this.couponText = \"\".concat(price, \"\\u5143\");\n    },\n    onSelectCoupon: function onSelectCoupon() {\n      var _this6 = this;\n\n      timer(200).subscribe(function () {\n        _this6.couponDropdownVisible = false;\n      });\n    },\n    resetCoupon: function resetCoupon() {\n      this.renewalMemberService.resetCouponList();\n      this.couponText = '未选择优惠券';\n      this.couponAmount = '';\n      this.selectcoupon = '';\n    },\n    // 定金\n    onSelectAdvanceChange: function onSelectAdvanceChange(data) {\n      if (data.target.value === -1) {\n        this.advanceAmount = '';\n        this.advanceText = '未选择定金';\n        return;\n      }\n\n      var price = this.advanceList.filter(function (o) {\n        return o.id === data.target.value;\n      })[0].price;\n      this.advanceAmount = price;\n      this.advanceText = \"\".concat(price, \"\\u5143\");\n    },\n    onSelectAdvance: function onSelectAdvance() {\n      var _this7 = this;\n\n      timer(200).subscribe(function () {\n        _this7.advanceDropdownVisible = false;\n      });\n    },\n    resetAdvance: function resetAdvance() {\n      this.renewalMemberService.resetAdvanceList();\n      this.advanceText = '未选择定金';\n      this.advanceAmount = '';\n      this.selectAdvance = '';\n    },\n    // 计算实付金额\n    getPrice: function getPrice(advance, reduce, coupon, specs_id) {\n      var advanceId = advance === -1 ? '' : advance;\n      var couponId = coupon === -1 ? '' : coupon;\n      this.renewalMemberService.priceAction$.dispatch({\n        id: this.id,\n        product_id: this.info.card_id,\n        product_type: this.info.contract_type,\n        specs_id: specs_id,\n        advance_id: advanceId,\n        reduce_amount: reduce,\n        coupon_id: couponId,\n        member_id: this.info.member_id\n      });\n    },\n    onCreateOrder: function onCreateOrder() {\n      var _this8 = this;\n\n      this.form.validate().then(function (values) {\n        var reduce_amount = _this8.reduceAmount ? +_this8.reduceAmount : undefined;\n\n        _this8.renewalMemberService.renewal({\n          contract_number: values.contractNumber,\n          rule_id: _this8.selectSpecs,\n          valid_start_time: moment(values.startTime).format('YYYY-MM-DD HH:mm'),\n          gift_amount: +_this8.giftAmount,\n          user_coupon_id: _this8.selectCoupon === -1 ? undefined : +_this8.selectCoupon,\n          advance_id: _this8.selectAdvance === -1 ? undefined : _this8.selectAdvance,\n          reduce_price: reduce_amount,\n          description: _this8.description,\n          staff_sale_id: +values.saleName,\n          contract_type: _this8.info.contract_type,\n          discounts_price: +_this8.info.specs.filter(function (i) {\n            return i.id === _this8.selectSpecs;\n          })[0].price\n        }, _this8.id).subscribe(function (res) {\n          _this8.show = false;\n\n          _this8.$emit('success', {\n            type: 'create',\n            orderId: res.info.order_id,\n            soldId: res.info.sold_id,\n            isFamilyCard: _this8.isFamilyCard\n          });\n        });\n      });\n    },\n    onPay: function onPay() {\n      var _this9 = this;\n\n      this.form.validate().then(function (values) {\n        var reduce_amount = _this9.reduceAmount ? +_this9.reduceAmount : undefined;\n\n        _this9.renewalMemberService.renewalPay({\n          contract_number: values.contractNumber,\n          rule_id: _this9.selectSpecs,\n          valid_start_time: moment(values.startTime).format('YYYY-MM-DD HH:mm'),\n          gift_amount: +_this9.giftAmount,\n          user_coupon_id: _this9.selectCoupon === -1 ? undefined : +_this9.selectCoupon,\n          advance_id: _this9.selectAdvance === -1 ? undefined : _this9.selectAdvance,\n          reduce_price: reduce_amount,\n          description: _this9.description,\n          staff_sale_id: +values.saleName,\n          contract_type: _this9.info.contract_type,\n          discounts_price: +_this9.info.specs.filter(function (i) {\n            return i.id === _this9.selectSpecs;\n          })[0].price\n        }, _this9.id).subscribe(function (res) {\n          _this9.show = false;\n\n          _this9.$emit('success', {\n            type: 'createPay',\n            orderId: res.info.order_id,\n            soldId: res.info.sold_id,\n            isFamilyCard: _this9.isFamilyCard\n          });\n        });\n      });\n    }\n  }\n};",{"version":3,"sources":["renewal-member.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal v-model=\"show\" wrapClassName=\"modal-sold-deal-sale\">\n    <div slot=\"title\">\n      续卡\n      <st-help-tooltip id=\"TSMC001\" placement=\"right\" />\n    </div>\n    <div :class=\"sale('content')\">\n      <st-form :form=\"form\" labelWidth=\"88px\">\n        <div :class=\"sale('sale')\" class=\"modal-sold-renewal-member-card\">\n          <st-form-item labelGutter=\"12px\" label=\"续卡会员\" class=\"mg-b16\">\n            {{ info.member_name }}\n          </st-form-item>\n          <st-form-item labelGutter=\"12px\" label=\"卡名\" class=\"mg-b16\">\n            {{ info.card_name }}\n          </st-form-item>\n          <st-form-item\n            labelGutter=\"12px\"\n            label=\"卡成员\"\n            class=\"mg-b16\"\n            v-if=\"isFamilyCard\"\n          >\n            {{ info.card_member }}\n          </st-form-item>\n\n          <st-form-item\n            labelGutter=\"12px\"\n            label=\"规格\"\n            class=\"mg-b16\"\n            required\n            v-if=\"info.specs\"\n          >\n            <a-radio-group v-model=\"selectSpecs\" @change=\"onSpecsChange\">\n              <a-radio\n                v-for=\"(item, index) in info.specs\"\n                :value=\"item.id\"\n                :key=\"index\"\n              >\n                {{ item.specs_name }}/{{ item.price }}元\n              </a-radio>\n            </a-radio-group>\n          </st-form-item>\n          <st-form-item\n            labelGutter=\"12px\"\n            class=\"mg-b0\"\n            label=\"有效时间\"\n            required\n          >\n            <div :class=\"sale('time')\">\n              <a-form-item class=\"page-a-form\">\n                <a-date-picker\n                  :disabledDate=\"disabledStartDate\"\n                  v-decorator=\"decorators.startTime\"\n                  @change=\"onStartTimeChange\"\n                  style=\"width: 188px;\"\n                  format=\"YYYY-MM-DD HH:mm\"\n                  :showTime=\"{ format: 'HH:mm' }\"\n                  placeholder=\"开始时间\"\n                  :allowClear=\"false\"\n                  :showToday=\"false\"\n                />\n                <span style=\"width:158px;\">\n                  &nbsp;&nbsp;至&nbsp;&nbsp;{{ endTime }}\n                </span>\n              </a-form-item>\n            </div>\n          </st-form-item>\n          <st-form-item labelGutter=\"12px\" label=\"购买赠送\">\n            <st-input-number\n              v-model=\"giftAmount\"\n              :placeholder=\"\n                `请输入赠送的${info.card_type !== 1 ? '天数' : '次数'}`\n              \"\n            >\n              <span slot=\"addonAfter\">\n                {{ info.card_type !== 1 ? '天' : '次' }}\n              </span>\n            </st-input-number>\n          </st-form-item>\n          <st-form-item labelGutter=\"12px\" required>\n            <template slot=\"label\">\n              合同编号\n              <st-help-tooltip id=\"TSSD001\" />\n            </template>\n            <div :class=\"sale('contract')\">\n              <a-input\n                v-decorator=\"decorators.contractNumber\"\n                placeholder=\"请输入合同编号\"\n              ></a-input>\n              <auto-contract-btn\n                class=\"create-button\"\n                @click=\"onCodeNumber\"\n                :loading=\"loading.getCodeNumber\"\n              >\n                自动生成\n              </auto-contract-btn>\n            </div>\n          </st-form-item>\n          <st-form-item labelGutter=\"12px\" class=\"mg-b12\" label=\"商品价格\">\n            {{ cardPrice }}元\n          </st-form-item>\n          <st-form-item\n            labelGutter=\"12px\"\n            :class=\"sale('discounts')\"\n            label=\"优惠金额\"\n          >\n            <div>\n              <div :class=\"sale('discounts-total')\">\n                <span>{{ couponText }}</span>\n                <a-dropdown\n                  v-model=\"couponDropdownVisible\"\n                  :disabled=\"couponList.length === 0\"\n                  :class=\"sale({ disabled: couponList.length === 0 })\"\n                  placement=\"bottomRight\"\n                  :getPopupContainer=\"trigger => trigger.parentNode\"\n                  :trigger=\"['click']\"\n                >\n                  <div :class=\"sale('discounts-promotion')\">\n                    <span>\n                      {{ couponList.length === 0 ? '无优惠券' : '优惠券选择' }}\n                    </span>\n                    <a-icon type=\"right\" />\n                  </div>\n                  <a-radio-group\n                    v-model=\"selectCoupon\"\n                    @change=\"onSelectCouponChange\"\n                    :class=\"sale('dropdown')\"\n                    slot=\"overlay\"\n                  >\n                    <a-menu>\n                      <a-menu-item @click=\"onSelectCoupon\">\n                        <a-radio :value=\"-1\">不使用</a-radio>\n                      </a-menu-item>\n                      <a-menu-item\n                        @click=\"onSelectCoupon\"\n                        :key=\"index\"\n                        v-for=\"(item, index) in couponList\"\n                      >\n                        <a-radio :value=\"item.id\">\n                          {{ item.name }} {{ item.price }}\n                        </a-radio>\n                      </a-menu-item>\n                    </a-menu>\n                  </a-radio-group>\n                </a-dropdown>\n              </div>\n            </div>\n          </st-form-item>\n          <st-form-item\n            labelGutter=\"12px\"\n            :class=\"sale('discounts')\"\n            label=\"定金抵扣\"\n          >\n            <div>\n              <div :class=\"sale('discounts-total')\">\n                <span>{{ advanceText }}</span>\n                <a-dropdown\n                  v-model=\"advanceDropdownVisible\"\n                  :disabled=\"advanceList.length === 0\"\n                  :class=\"sale({ disabled: advanceList.length === 0 })\"\n                  placement=\"bottomRight\"\n                  :getPopupContainer=\"trigger => trigger.parentNode\"\n                  :trigger=\"['click']\"\n                >\n                  <div :class=\"sale('discounts-promotion')\">\n                    <span>\n                      {{ advanceList.length === 0 ? '无定金' : '定金选择' }}\n                    </span>\n                    <a-icon type=\"right\" />\n                  </div>\n                  <a-radio-group\n                    v-model=\"selectAdvance\"\n                    @change=\"onSelectAdvanceChange\"\n                    :class=\"sale('dropdown')\"\n                    slot=\"overlay\"\n                  >\n                    <a-menu>\n                      <a-menu-item @click=\"onSelectAdvance\">\n                        <a-radio :value=\"-1\">不使用</a-radio>\n                      </a-menu-item>\n                      <a-menu-item\n                        @click=\"onSelectAdvance\"\n                        :key=\"index\"\n                        v-for=\"(item, index) in advanceList\"\n                      >\n                        <a-radio :value=\"item.id\">\n                          定金 {{ item.price }}\n                        </a-radio>\n                      </a-menu-item>\n                    </a-menu>\n                  </a-radio-group>\n                </a-dropdown>\n              </div>\n            </div>\n          </st-form-item>\n          <st-form-item labelGutter=\"12px\" label=\"减免金额\">\n            <st-input-number\n              v-model=\"reduceAmount\"\n              :float=\"true\"\n              placeholder=\"请输入\"\n            >\n              <span slot=\"addonAfter\">元</span>\n            </st-input-number>\n          </st-form-item>\n          <st-form-item\n            labelGutter=\"12px\"\n            validateStatus=\"error\"\n            :help=\"orderAmountText\"\n            class=\"mg-b0\"\n            label=\"小计\"\n          >\n            <span class=\"total\">{{ priceInfo }}元</span>\n          </st-form-item>\n        </div>\n        <div :class=\"sale('remarks')\">\n          <st-form-item labelGutter=\"12px\" label=\"销售人员\" required>\n            <a-select\n              v-decorator=\"decorators.saleName\"\n              placeholder=\"选择签单的工作人员\"\n            >\n              <a-select-option\n                v-for=\"(item, index) in saleList\"\n                :key=\"index\"\n                :value=\"item.id\"\n              >\n                {{ item.staff_name }}\n              </a-select-option>\n            </a-select>\n          </st-form-item>\n          <st-form-item labelGutter=\"12px\" label=\"备注\" class=\"mg-b0\">\n            <a-textarea\n              v-model=\"description\"\n              :autosize=\"{ minRows: 4, maxRows: 6 }\"\n            />\n          </st-form-item>\n        </div>\n      </st-form>\n    </div>\n    <template slot=\"footer\">\n      <div :class=\"sale('footer')\">\n        <div class=\"price\">\n          <span>{{ priceInfo }}元</span>\n          <span>订单总额：{{ cardPrice }}元</span>\n        </div>\n        <div class=\"button\">\n          <st-button @click=\"onCreateOrder\" :loading=\"loading.renewal\">\n            创建订单\n          </st-button>\n          <st-button\n            @click=\"onPay\"\n            :loading=\"loading.renewalPay\"\n            type=\"primary\"\n          >\n            立即支付\n          </st-button>\n        </div>\n      </div>\n    </template>\n  </st-modal>\n</template>\n\n<script>\nimport { RenewalMemberService } from './renewal-member.service'\nimport moment from 'moment'\nimport { cloneDeep } from 'lodash-es'\nimport { timer } from 'rxjs'\nimport { ruleOptions } from './renewal-member.config'\nimport autoContractBtn from '@/views/biz-components/contract/auto-contract-btn.vue'\nexport default {\n  name: 'ModalSoldRenewalMemberCard',\n  bem: {\n    sale: 'modal-sold-deal-sale'\n  },\n  serviceProviders() {\n    return [RenewalMemberService]\n  },\n  serviceInject() {\n    return {\n      renewalMemberService: RenewalMemberService\n    }\n  },\n  components: {\n    autoContractBtn\n  },\n  rxState() {\n    return {\n      loading: this.renewalMemberService.loading$,\n      couponList: this.renewalMemberService.couponList$,\n      advanceList: this.renewalMemberService.advanceList$,\n      priceInfo: this.renewalMemberService.priceInfo$,\n      saleList: this.renewalMemberService.saleList$,\n      info: this.renewalMemberService.info$\n    }\n  },\n  props: ['id'],\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      show: false,\n      // 规格\n      selectSpecs: 1,\n      // 时间\n      startTime: null,\n      endTime: '',\n      // 赠送\n      giftAmount: null,\n      // 优惠\n      couponDropdownVisible: false,\n      couponText: '未选择优惠券',\n      couponAmount: '',\n      selectCoupon: '',\n      // 定金\n      advanceDropdownVisible: false,\n      advanceText: '未选择定金',\n      advanceAmount: '',\n      selectAdvance: '',\n      // 减免金额\n      reduceAmount: null,\n      // 描述\n      description: ''\n    }\n  },\n  created() {\n    this.renewalMemberService.serviceInit(this.id).subscribe(res => {\n      // 获取优惠券\n      this.renewalMemberService\n        .getCouponList({\n          member_id: res[0].info.member_id,\n          card_id: res[0].info.card_id,\n          specs_id: res[0].info.specs[0].id\n        })\n        .subscribe()\n      // 获取定金\n      this.renewalMemberService\n        .getAdvanceList(res[0].info.member_id)\n        .subscribe()\n      // 规格\n      this.selectSpecs = res[0].info.specs[0].id\n      this.form.setFieldsValue({\n        startTime: moment(res[0].info.default_start_time * 1000)\n      })\n      // 实付金额\n      this.getPrice('', 0, '', res[0].info.specs[0].id)\n      this.startTime = cloneDeep(moment(res[0].info.default_start_time * 1000))\n      this.endTime = moment(res[0].info.default_start_time * 1000)\n        .add(res[0].info.specs[0].valid_time, 'd')\n        .format('YYYY-MM-DD HH:mm')\n    })\n  },\n  watch: {\n    selectSpecs(newVal, oldVal) {\n      this.getPrice(\n        this.selectAdvance,\n        +this.reduceAmount,\n        this.selectCoupon,\n        newVal\n      )\n    },\n    selectAdvance: {\n      deep: true,\n      handler(newVal, oldVal) {\n        this.getPrice(\n          newVal,\n          +this.reduceAmount,\n          this.selectCoupon,\n          this.selectSpecs\n        )\n      }\n    },\n    selectCoupon: {\n      deep: true,\n      handler(newVal, oldVal) {\n        this.getPrice(\n          this.selectAdvance,\n          +this.reduceAmount,\n          newVal,\n          this.selectSpecs\n        )\n      }\n    },\n    reduceAmount(newVal, oldVal) {\n      this.getPrice(\n        this.selectAdvance,\n        +newVal,\n        this.selectCoupon,\n        this.selectSpecs\n      )\n    }\n  },\n  computed: {\n    // 商品价格\n    cardPrice() {\n      if (this.info.specs) {\n        const arr = this.info.specs.filter(i => i.id === this.selectSpecs)\n        if (arr.length > 0) {\n          return arr[0].price\n        }\n        return '0'\n      }\n      return '0'\n    },\n    orderAmountText() {\n      return this.priceInfo < 0 ? '小计不能为负' : ''\n    },\n    isFamilyCard() {\n      return this.info.card_number_type === 2\n    }\n  },\n  methods: {\n    moment,\n    // 规格\n    onSpecsChange(data) {\n      let item = this.info.specs.filter(i => i.id === data.target.value)[0]\n      let s = cloneDeep(this.startTime)\n      let dayScope = item.valid_time\n      this.endTime = s.add(dayScope, 'd').format('YYYY-MM-DD HH:mm')\n      // 获取优惠券\n      this.renewalMemberService\n        .getCouponList({\n          member_id: this.info.member_id,\n          card_id: this.info.card_id,\n          specs_id: item.id\n        })\n        .subscribe(res => {\n          this.resetCoupon()\n        })\n    },\n    // 时间\n    disabledStartDate(startTime) {\n      return startTime.valueOf() < this.info.default_start_time * 1000\n    },\n    onStartTimeChange(data) {\n      this.startTime = cloneDeep(data)\n      let s = cloneDeep(data)\n      let dayScope = this.info.specs.filter(i => i.id === this.selectSpecs)[0]\n        .valid_time\n      this.endTime = s.add(dayScope, 'd').format('YYYY-MM-DD HH:mm')\n    },\n    // 合同\n    onCodeNumber() {\n      this.renewalMemberService\n        .getCodeNumber(this.info.contract_type)\n        .subscribe(res => {\n          this.form.setFieldsValue({\n            contractNumber: res.info.code\n          })\n        })\n    },\n    // 优惠\n    onSelectCouponChange(data) {\n      if (data.target.value === -1) {\n        this.couponAmount = ''\n        this.couponText = '未选择优惠券'\n        return\n      }\n      let price = this.couponList.filter(o => o.id === data.target.value)[0]\n        .price\n      this.couponAmount = price\n      this.couponText = `${price}元`\n    },\n    onSelectCoupon() {\n      timer(200).subscribe(() => {\n        this.couponDropdownVisible = false\n      })\n    },\n    resetCoupon() {\n      this.renewalMemberService.resetCouponList()\n      this.couponText = '未选择优惠券'\n      this.couponAmount = ''\n      this.selectcoupon = ''\n    },\n    // 定金\n    onSelectAdvanceChange(data) {\n      if (data.target.value === -1) {\n        this.advanceAmount = ''\n        this.advanceText = '未选择定金'\n        return\n      }\n      let price = this.advanceList.filter(o => o.id === data.target.value)[0]\n        .price\n      this.advanceAmount = price\n      this.advanceText = `${price}元`\n    },\n    onSelectAdvance() {\n      timer(200).subscribe(() => {\n        this.advanceDropdownVisible = false\n      })\n    },\n    resetAdvance() {\n      this.renewalMemberService.resetAdvanceList()\n      this.advanceText = '未选择定金'\n      this.advanceAmount = ''\n      this.selectAdvance = ''\n    },\n    // 计算实付金额\n    getPrice(advance, reduce, coupon, specs_id) {\n      let advanceId = advance === -1 ? '' : advance\n      let couponId = coupon === -1 ? '' : coupon\n      this.renewalMemberService.priceAction$.dispatch({\n        id: this.id,\n        product_id: this.info.card_id,\n        product_type: this.info.contract_type,\n        specs_id,\n        advance_id: advanceId,\n        reduce_amount: reduce,\n        coupon_id: couponId,\n        member_id: this.info.member_id\n      })\n    },\n    onCreateOrder() {\n      this.form.validate().then(values => {\n        let reduce_amount = this.reduceAmount ? +this.reduceAmount : undefined\n        this.renewalMemberService\n          .renewal(\n            {\n              contract_number: values.contractNumber,\n              rule_id: this.selectSpecs,\n              valid_start_time: moment(values.startTime).format(\n                'YYYY-MM-DD HH:mm'\n              ),\n              gift_amount: +this.giftAmount,\n              user_coupon_id:\n                this.selectCoupon === -1 ? undefined : +this.selectCoupon,\n              advance_id:\n                this.selectAdvance === -1 ? undefined : this.selectAdvance,\n              reduce_price: reduce_amount,\n              description: this.description,\n              staff_sale_id: +values.saleName,\n              contract_type: this.info.contract_type,\n              discounts_price: +this.info.specs.filter(\n                i => i.id === this.selectSpecs\n              )[0].price\n            },\n            this.id\n          )\n          .subscribe(res => {\n            this.show = false\n            this.$emit('success', {\n              type: 'create',\n              orderId: res.info.order_id,\n              soldId: res.info.sold_id,\n              isFamilyCard: this.isFamilyCard\n            })\n          })\n      })\n    },\n    onPay() {\n      this.form.validate().then(values => {\n        let reduce_amount = this.reduceAmount ? +this.reduceAmount : undefined\n        this.renewalMemberService\n          .renewalPay(\n            {\n              contract_number: values.contractNumber,\n              rule_id: this.selectSpecs,\n              valid_start_time: moment(values.startTime).format(\n                'YYYY-MM-DD HH:mm'\n              ),\n              gift_amount: +this.giftAmount,\n              user_coupon_id:\n                this.selectCoupon === -1 ? undefined : +this.selectCoupon,\n              advance_id:\n                this.selectAdvance === -1 ? undefined : this.selectAdvance,\n              reduce_price: reduce_amount,\n              description: this.description,\n              staff_sale_id: +values.saleName,\n              contract_type: this.info.contract_type,\n              discounts_price: +this.info.specs.filter(\n                i => i.id === this.selectSpecs\n              )[0].price\n            },\n            this.id\n          )\n          .subscribe(res => {\n            this.show = false\n            this.$emit('success', {\n              type: 'createPay',\n              orderId: res.info.order_id,\n              soldId: res.info.sold_id,\n              isFamilyCard: this.isFamilyCard\n            })\n          })\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/sold/card"}]}