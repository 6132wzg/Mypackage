{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/dashboard/studio.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/dashboard/studio.service.ts","mtime":1600912107082},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { Injectable } from 'vue-service-app';\nimport { State } from 'rx-state/src';\nimport { tap } from 'rxjs/operators';\nimport { OverviewApi } from '@/api/v1/stat/overview/shop';\nimport { anyAll } from '@/operators';\nimport { UserService } from '@/services/user.service';\n\nvar StudioService = /*#__PURE__*/function () {\n  function StudioService(overviewApi, userService) {\n    _classCallCheck(this, StudioService);\n\n    this.overviewApi = overviewApi;\n    this.userService = userService;\n    this.top$ = new State({\n      revenue_amount: {\n        today: '0.0/0.0',\n        yesterday: '0.0/0.0',\n        nearly_seven_days: '0.0/0.0',\n        nearly_thirty_days: '0.0/0.0'\n      },\n      course_checkin_num: {},\n      passenger_flow: {},\n      be_member_num: {},\n      buy_personal_course_num: {}\n    });\n    this.revenueDaily$ = new State({});\n    this.revenueSummary$ = new State({});\n    this.revenueSum$ = new State('');\n    this.courseDaily$ = new State([]);\n    this.courseSummary$ = new State([]);\n    this.inoutNum$ = new State([]);\n    this.inoutTime$ = new State([]);\n    this.member$ = new State({\n      member: {},\n      marketing: {}\n    });\n    this.newMember$ = new State([]);\n  }\n\n  _createClass(StudioService, [{\n    key: \"getTop\",\n    value: function getTop(query) {\n      var _this = this;\n\n      return this.overviewApi.getTop(query).pipe(tap(function (res) {\n        console.log('top', res);\n\n        _this.top$.commit(function () {\n          return res.info;\n        });\n      }));\n    }\n  }, {\n    key: \"getRevenue\",\n    value: function getRevenue(params) {\n      var _this2 = this;\n\n      return this.overviewApi.getRevenue(params).pipe(tap(function (res) {\n        var data = res.info;\n        var lineData = [];\n\n        var member_card = _this2.userService.c('member_card');\n\n        var small_course = _this2.userService.c('small_course');\n\n        _this2.revenueSummary$.commit(function () {\n          return [{\n            name: member_card,\n            value: data.summary.member_card_amount\n          }, {\n            name: '私教课',\n            value: data.summary.personal_course_amount\n          }, {\n            name: '团体课',\n            value: data.summary.team_course_amount\n          }, {\n            name: '课程包',\n            value: data.summary.package_course_amount\n          }, {\n            name: small_course,\n            value: data.summary.small_course_amount\n          }, {\n            name: '云店',\n            value: data.summary.shop_amount\n          }, {\n            name: '其他',\n            value: data.summary.other_amount\n          }];\n        });\n\n        _this2.revenueSum$.commit(function () {\n          return data.summary.total_amount;\n        });\n\n        for (var key in data.daily.member_card_amount) {\n          var chartItem = {\n            date: key,\n            // 会员卡: Number(data.daily.member_card_amount[key]),\n            私教课: Number(data.daily.personal_course_amount[key]),\n            团体课: Number(data.daily.team_course_amount[key]),\n            课程包: Number(data.daily.package_course_amount[key]),\n            云店: Number(data.daily.shop_amount[key]),\n            其他: Number(data.daily.other_amount[key]),\n            总营收: Number(data.daily.total_amount[key])\n          };\n          chartItem[member_card] = Number(data.daily.member_card_amount[key]);\n          chartItem[small_course] = Number(data.daily.small_course_amount[key]);\n          lineData.push(chartItem);\n        }\n\n        console.log('营收', lineData);\n\n        _this2.revenueDaily$.commit(function () {\n          return lineData;\n        });\n      }));\n    }\n  }, {\n    key: \"getCourse\",\n    value: function getCourse(params) {\n      var _this3 = this;\n\n      var small_course = this.userService.c('small_course');\n      return this.overviewApi.getCourse(params).pipe(tap(function (res) {\n        var data = res.info;\n        var lineData = [];\n        var courseSummary = [{\n          group: '未消课',\n          团体课: data.summary.team_uncheckin_num,\n          私教课: data.summary.personal_uncheckin_num\n        }, {\n          group: '总消课',\n          团体课: data.summary.team_checkin_num,\n          私教课: data.summary.personal_checkin_num\n        }, {\n          group: '总售课',\n          团体课: data.summary.sale_team_num,\n          私教课: data.summary.sale_personal_num\n        }];\n        courseSummary[0][small_course] = data.summary.sale_personal_num;\n        courseSummary[1][small_course] = data.summary.sale_personal_num;\n        courseSummary[2][small_course] = data.summary.sale_personal_num;\n\n        _this3.courseSummary$.commit(function () {\n          return courseSummary;\n        });\n\n        for (var key in data.daily.personal_reserved_num) {\n          var chartItem = {\n            date: key,\n            私教课预约人数: data.daily.personal_reserved_num[key],\n            私教课签到人数: data.daily.personal_checkin_num[key],\n            团体课可预约人数: data.daily.team_can_reserve_num[key],\n            团体课预约人数: data.daily.team_reserved_num[key],\n            团体课签到人数: data.daily.team_sigin_num[key]\n          };\n          chartItem[\"\".concat(small_course, \"\\u9884\\u7EA6\\u4EBA\\u6570\")] = data.daily.small_reserved_num[key];\n          chartItem[\"\".concat(small_course, \"\\u7B7E\\u5230\\u4EBA\\u6570\")] = data.daily.small_sigin_num[key];\n          lineData.push(chartItem);\n        }\n\n        _this3.courseDaily$.commit(function () {\n          return lineData;\n        });\n      }));\n    }\n  }, {\n    key: \"getInout\",\n    value: function getInout(params) {\n      var _this4 = this;\n\n      return this.overviewApi.getInout(params).pipe(tap(function (res) {\n        var data = res;\n        var lineData = [];\n\n        for (var key in data.inout_num) {\n          var chartItem = {\n            date: key,\n            value: data.inout_num[key]\n          };\n          lineData.push(chartItem);\n        }\n\n        _this4.inoutNum$.commit(function () {\n          return lineData;\n        });\n\n        _this4.inoutTime$.commit(function () {\n          return [{\n            name: '08:00之前',\n            value: data.inout_time.level0_num\n          }, {\n            name: '08:00~12:00',\n            value: data.inout_time.level1_num\n          }, {\n            name: '12:00~16:00',\n            value: data.inout_time.level2_num\n          }, {\n            name: '16:00~20:00',\n            value: data.inout_time.level3_num\n          }, {\n            name: '20:00~24:00',\n            value: data.inout_time.level4_num\n          }];\n        });\n      }));\n    }\n  }, {\n    key: \"getMember\",\n    value: function getMember(query) {\n      var _this5 = this;\n\n      return this.overviewApi.getMember(query).pipe(tap(function (res) {\n        var data = res.info;\n\n        _this5.member$.commit(function () {\n          return {\n            member: [{\n              name: '消费用户',\n              value: data.member.consume_num\n            }, {\n              name: '购买私教',\n              value: data.member.buy_person_course_num\n            }, {\n              name: '私教消课',\n              value: data.member.personal_course_checkin_num\n            }],\n            marketing: [{\n              name: '消费用户',\n              value: data.marketing.consume_num\n            }, {\n              name: '购买私教',\n              value: data.marketing.buy_person_course_num\n            }, {\n              name: '私教消课',\n              value: data.marketing.personal_course_checkin_num\n            }]\n          };\n        });\n      }));\n    }\n  }, {\n    key: \"getBuyCourse\",\n    value: function getBuyCourse(params) {\n      var _this6 = this;\n\n      return this.overviewApi.getBuyCourse(params).pipe(tap(function (res) {\n        var data = res.info.today_buy_person_course_num;\n        var lineData = [];\n\n        for (var key in data) {\n          var chartItem = {\n            date: key,\n            value: data[key]\n          };\n          lineData.push(chartItem);\n        }\n\n        _this6.newMember$.commit(function () {\n          return lineData;\n        });\n      }));\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      return anyAll(this.getTop({\n        version: 'studio'\n      }), this.getRevenue({\n        recently_day: 7\n      }), this.getCourse({\n        recently_day: 7\n      }), this.getInout({\n        recently_day: 7\n      }), this.getMember({\n        version: 'studio'\n      }), this.getBuyCourse({\n        recently_day: 7\n      }));\n    }\n  }, {\n    key: \"beforeCreate\",\n    value: function beforeCreate() {\n      return this.init();\n    }\n  }]);\n\n  return StudioService;\n}();\n\nStudioService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof OverviewApi !== \"undefined\" && OverviewApi) === \"function\" ? _a : Object, typeof (_b = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _b : Object])], StudioService);\nexport { StudioService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/dashboard/studio.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable, Controller } from 'vue-service-app'\nimport { State } from 'rx-state/src'\nimport { tap } from 'rxjs/operators'\nimport {\n  OverviewApi,\n  Version,\n  RevenueParams\n} from '@/api/v1/stat/overview/shop'\nimport { anyAll } from '@/operators'\nimport { UserService } from '@/services/user.service'\n@Injectable()\nexport class StudioService implements Controller {\n  top$ = new State({\n    revenue_amount: {\n      today: '0.0/0.0',\n      yesterday: '0.0/0.0',\n      nearly_seven_days: '0.0/0.0',\n      nearly_thirty_days: '0.0/0.0'\n    },\n    course_checkin_num: {},\n    passenger_flow: {},\n    be_member_num: {},\n    buy_personal_course_num: {}\n  })\n  revenueDaily$ = new State({})\n  revenueSummary$ = new State({})\n  revenueSum$ = new State('')\n  courseDaily$ = new State([])\n  courseSummary$ = new State([])\n  inoutNum$ = new State([])\n  inoutTime$ = new State([])\n  member$ = new State({\n    member: {},\n    marketing: {}\n  })\n  newMember$ = new State([])\n\n  constructor(\n    private overviewApi: OverviewApi,\n    private userService: UserService\n  ) {}\n  getTop(query: Version) {\n    return this.overviewApi.getTop(query).pipe(\n      tap(res => {\n        console.log('top', res)\n        this.top$.commit(() => res.info)\n      })\n    )\n  }\n  getRevenue(params: RevenueParams) {\n    return this.overviewApi.getRevenue(params).pipe(\n      tap(res => {\n        const data = res.info\n        let lineData: any = []\n        const member_card = this.userService.c('member_card')\n        const small_course = this.userService.c('small_course')\n        this.revenueSummary$.commit(() => [\n          { name: member_card, value: data.summary.member_card_amount },\n          { name: '私教课', value: data.summary.personal_course_amount },\n          { name: '团体课', value: data.summary.team_course_amount },\n          { name: '课程包', value: data.summary.package_course_amount },\n          { name: small_course, value: data.summary.small_course_amount },\n          { name: '云店', value: data.summary.shop_amount },\n          { name: '其他', value: data.summary.other_amount }\n        ])\n        this.revenueSum$.commit(() => data.summary.total_amount)\n        for (let key in data.daily.member_card_amount) {\n          let chartItem: any = {\n            date: key,\n            // 会员卡: Number(data.daily.member_card_amount[key]),\n            私教课: Number(data.daily.personal_course_amount[key]),\n            团体课: Number(data.daily.team_course_amount[key]),\n            课程包: Number(data.daily.package_course_amount[key]),\n            云店: Number(data.daily.shop_amount[key]),\n            其他: Number(data.daily.other_amount[key]),\n            总营收: Number(data.daily.total_amount[key])\n          }\n          chartItem[member_card] = Number(data.daily.member_card_amount[key])\n          chartItem[small_course] = Number(data.daily.small_course_amount[key])\n          lineData.push(chartItem)\n        }\n        console.log('营收', lineData)\n        this.revenueDaily$.commit(() => lineData)\n      })\n    )\n  }\n  getCourse(params: RevenueParams) {\n    const small_course = this.userService.c('small_course')\n    return this.overviewApi.getCourse(params).pipe(\n      tap(res => {\n        const data = res.info\n        let lineData: any = []\n        let courseSummary: any = [\n          {\n            group: '未消课',\n            团体课: data.summary.team_uncheckin_num,\n            私教课: data.summary.personal_uncheckin_num\n          },\n          {\n            group: '总消课',\n            团体课: data.summary.team_checkin_num,\n            私教课: data.summary.personal_checkin_num\n          },\n          {\n            group: '总售课',\n            团体课: data.summary.sale_team_num,\n            私教课: data.summary.sale_personal_num\n          }\n        ]\n        courseSummary[0][small_course] = data.summary.sale_personal_num\n        courseSummary[1][small_course] = data.summary.sale_personal_num\n        courseSummary[2][small_course] = data.summary.sale_personal_num\n        this.courseSummary$.commit(() => courseSummary)\n        for (let key in data.daily.personal_reserved_num) {\n          let chartItem: any = {\n            date: key,\n            私教课预约人数: data.daily.personal_reserved_num[key],\n            私教课签到人数: data.daily.personal_checkin_num[key],\n            团体课可预约人数: data.daily.team_can_reserve_num[key],\n            团体课预约人数: data.daily.team_reserved_num[key],\n            团体课签到人数: data.daily.team_sigin_num[key]\n          }\n          chartItem[`${small_course}预约人数`] =\n            data.daily.small_reserved_num[key]\n          chartItem[`${small_course}签到人数`] = data.daily.small_sigin_num[key]\n          lineData.push(chartItem)\n        }\n        this.courseDaily$.commit(() => lineData)\n      })\n    )\n  }\n  getInout(params: RevenueParams) {\n    return this.overviewApi.getInout(params).pipe(\n      tap(res => {\n        const data = res\n        let lineData: any = []\n        for (let key in data.inout_num) {\n          let chartItem = {\n            date: key,\n            value: data.inout_num[key]\n          }\n          lineData.push(chartItem)\n        }\n        this.inoutNum$.commit(() => lineData)\n        this.inoutTime$.commit(() => [\n          {\n            name: '08:00之前',\n            value: data.inout_time.level0_num\n          },\n          {\n            name: '08:00~12:00',\n            value: data.inout_time.level1_num\n          },\n          {\n            name: '12:00~16:00',\n            value: data.inout_time.level2_num\n          },\n          {\n            name: '16:00~20:00',\n            value: data.inout_time.level3_num\n          },\n          {\n            name: '20:00~24:00',\n            value: data.inout_time.level4_num\n          }\n        ])\n      })\n    )\n  }\n  getMember(query: Version) {\n    return this.overviewApi.getMember(query).pipe(\n      tap(res => {\n        const data = res.info\n        this.member$.commit(() => {\n          return {\n            member: [\n              { name: '消费用户', value: data.member.consume_num },\n              { name: '购买私教', value: data.member.buy_person_course_num },\n              {\n                name: '私教消课',\n                value: data.member.personal_course_checkin_num\n              }\n            ],\n            marketing: [\n              { name: '消费用户', value: data.marketing.consume_num },\n              { name: '购买私教', value: data.marketing.buy_person_course_num },\n              {\n                name: '私教消课',\n                value: data.marketing.personal_course_checkin_num\n              }\n            ]\n          }\n        })\n      })\n    )\n  }\n  getBuyCourse(params: RevenueParams) {\n    return this.overviewApi.getBuyCourse(params).pipe(\n      tap(res => {\n        const data = res.info.today_buy_person_course_num\n        let lineData: any = []\n        for (let key in data) {\n          let chartItem = {\n            date: key,\n            value: data[key]\n          }\n          lineData.push(chartItem)\n        }\n        this.newMember$.commit(() => lineData)\n      })\n    )\n  }\n  init() {\n    return anyAll(\n      this.getTop({ version: 'studio' }),\n      this.getRevenue({ recently_day: 7 }),\n      this.getCourse({ recently_day: 7 }),\n      this.getInout({ recently_day: 7 }),\n      this.getMember({ version: 'studio' }),\n      this.getBuyCourse({ recently_day: 7 })\n    )\n  }\n  beforeCreate() {\n    return this.init()\n  }\n}\n"],"sourceRoot":""}]}