{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/general/user-level.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/general/user-level.vue","mtime":1591147717348},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { UserLevelService } from './user-level.service'\nimport { MessageService } from '@/services/message.service'\nimport SelectCondition from './components#/select-condition'\nimport SelectRights from './components#/select-rights'\nexport default {\n  bem: {\n    b: 'page-user-level'\n  },\n  serviceInject() {\n    return {\n      userLevelService: UserLevelService,\n      messageService: MessageService\n    }\n  },\n  rxState() {\n    const { userLevelService } = this\n    return {\n      list: userLevelService.list$,\n      info: userLevelService.info$,\n      loading: userLevelService.loading$,\n      auth: userLevelService.auth$\n    }\n  },\n  data() {\n    return {\n      condition: [],\n      rights: []\n    }\n  },\n  filters: {\n    textFilter(text, list, index) {\n      return text + (index < list.length - 1 ? '、' : '')\n    }\n  },\n  components: {\n    SelectCondition,\n    SelectRights\n  },\n  computed: {\n    isEdit() {\n      return this.$searchQuery.type === 'edit'\n    },\n    /**\n     * 潜在会员\n     */\n    potential() {\n      return this.list[0]\n    },\n    /**\n     * 正式会员\n     */\n    member() {\n      return this.list[1]\n    },\n    /**\n     * 流失会员\n     */\n    lost() {\n      return this.list[2]\n    }\n  },\n  methods: {\n    onEdit() {\n      this.$router.push({\n        query: {\n          type: 'edit'\n        }\n      })\n    },\n    onSave() {\n      const params = this.getData()\n      if (!this.inputCheck(params)) {\n        this.messageService.error({\n          content: '请至少选择一个升级到正式会员所需条件'\n        })\n        return\n      }\n      this.userLevelService.update(params).subscribe(() => {\n        this.messageService.success({\n          content: '保存成功'\n        })\n        this.$router.push({\n          query: {}\n        })\n      })\n    },\n    onCancel() {\n      this.$router.push({\n        query: {}\n      })\n    },\n    onConditionChange(val) {\n      this.condition = val\n    },\n    onRightsChange(val) {\n      this.rights = val\n    },\n    getData() {\n      return {\n        condition: this.condition,\n        rights: this.rights\n      }\n    },\n    inputCheck(params) {\n      const { condition } = params\n      if (!condition.length) {\n        return false\n      }\n      return true\n    }\n  }\n}\n",{"version":3,"sources":["user-level.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"user-level.vue","sourceRoot":"src/views/pages/brand/setting/general","sourcesContent":["<template>\n  <st-panel app v-if=\"auth.get\">\n    <div :class=\"b()\">\n      <st-t2>用户等级设置</st-t2>\n      <a-row :gutter=\"12\" class=\"mg-t24 ta-c\">\n        <!-- 潜在会员 -->\n        <a-col :span=\"7\">\n          <div :class=\"b('item')\">\n            <st-t2>{{ potential.level_name }}</st-t2>\n            <div>\n              <img\n                :class=\"b('item-icon')\"\n                src=\"~@/assets/img/member_potential.png\"\n                alt=\"潜在会员\"\n              />\n            </div>\n            <div :class=\"b('sub-title')\">条件</div>\n            <ul>\n              <li v-if=\"potential.condition.length\" :class=\"b('list-item')\">\n                <i\n                  class=\"icon-member-checked icon-member-checked--potential\"\n                ></i>\n                <span v-for=\"(item, index) in potential.condition\" :key=\"index\">\n                  {{\n                    item.condition_name | textFilter(potential.condition, index)\n                  }}\n                </span>\n              </li>\n            </ul>\n          </div>\n        </a-col>\n        <!-- 正式会员 -->\n        <a-col :span=\"10\">\n          <div :class=\"b('item')\">\n            <st-t2>{{ member.level_name }}</st-t2>\n            <st-info-action\n              icon=\"edit\"\n              text=\"编辑\"\n              :class=\"b('item-edit')\"\n              v-if=\"auth.edit && !isEdit\"\n              @click=\"onEdit\"\n            />\n            <div>\n              <img\n                :class=\"b('item-icon')\"\n                src=\"~@/assets/img/member.png\"\n                alt=\"正式会员\"\n              />\n            </div>\n            <div :class=\"b('sub-title')\">\n              条件\n              <st-help-tooltip id=\"TBYHDJ001\" />\n            </div>\n            <select-condition\n              v-if=\"isEdit && info.condition\"\n              v-model=\"info.condition\"\n              @change=\"onConditionChange\"\n            />\n            <ul v-else>\n              <li v-if=\"member.condition.length\" :class=\"b('list-item')\">\n                <i\n                  class=\"icon-member-checked icon-member-checked--potential\"\n                ></i>\n                <span v-for=\"(item, index) in member.condition\" :key=\"index\">\n                  {{\n                    item.condition_name | textFilter(member.condition, index)\n                  }}\n                </span>\n              </li>\n            </ul>\n            <div :class=\"b('sub-title')\">\n              特权类目\n              <st-help-tooltip id=\"TBYHDJ002\" />\n            </div>\n            <select-rights\n              v-if=\"isEdit && info.rights\"\n              v-model=\"info.rights\"\n              @change=\"onRightsChange\"\n            />\n            <ul v-else>\n              <li :class=\"b('list-item')\" v-if=\"member.rights.length\">\n                <i class=\"icon-member-checked\"></i>\n                <span v-for=\"(item, index) in member.rights\" :key=\"index\">\n                  {{ item.rights_name | textFilter(member.rights, index) }}\n                </span>\n              </li>\n              <li v-else class=\"st-des mg-t8\">暂无特权类目～</li>\n            </ul>\n          </div>\n        </a-col>\n        <!-- 流失会员 -->\n        <a-col :span=\"7\">\n          <div :class=\"b('item')\">\n            <st-t2>{{ lost.level_name }}</st-t2>\n            <div>\n              <img\n                :class=\"b('item-icon')\"\n                src=\"~@/assets/img/member_lost.png\"\n                alt=\"流失会员\"\n              />\n            </div>\n            <div :class=\"b('sub-title')\">条件</div>\n            <ul>\n              <li v-if=\"lost.condition.length\" :class=\"b('list-item')\">\n                <i\n                  class=\"icon-member-checked icon-member-checked--potential\"\n                ></i>\n                <span v-for=\"(item, index) in lost.condition\" :key=\"index\">\n                  {{ item.condition_name | textFilter(lost.condition, index) }}\n                </span>\n              </li>\n            </ul>\n          </div>\n        </a-col>\n      </a-row>\n      <div class=\"ta-c mg-t24\" v-if=\"isEdit\">\n        <st-button type=\"primary\" @click=\"onSave\" :loading=\"loading.update\">\n          保存\n        </st-button>\n        <st-button class=\"mg-l8\" @click=\"onCancel\">取消</st-button>\n      </div>\n    </div>\n  </st-panel>\n</template>\n<script>\nimport { UserLevelService } from './user-level.service'\nimport { MessageService } from '@/services/message.service'\nimport SelectCondition from './components#/select-condition'\nimport SelectRights from './components#/select-rights'\nexport default {\n  bem: {\n    b: 'page-user-level'\n  },\n  serviceInject() {\n    return {\n      userLevelService: UserLevelService,\n      messageService: MessageService\n    }\n  },\n  rxState() {\n    const { userLevelService } = this\n    return {\n      list: userLevelService.list$,\n      info: userLevelService.info$,\n      loading: userLevelService.loading$,\n      auth: userLevelService.auth$\n    }\n  },\n  data() {\n    return {\n      condition: [],\n      rights: []\n    }\n  },\n  filters: {\n    textFilter(text, list, index) {\n      return text + (index < list.length - 1 ? '、' : '')\n    }\n  },\n  components: {\n    SelectCondition,\n    SelectRights\n  },\n  computed: {\n    isEdit() {\n      return this.$searchQuery.type === 'edit'\n    },\n    /**\n     * 潜在会员\n     */\n    potential() {\n      return this.list[0]\n    },\n    /**\n     * 正式会员\n     */\n    member() {\n      return this.list[1]\n    },\n    /**\n     * 流失会员\n     */\n    lost() {\n      return this.list[2]\n    }\n  },\n  methods: {\n    onEdit() {\n      this.$router.push({\n        query: {\n          type: 'edit'\n        }\n      })\n    },\n    onSave() {\n      const params = this.getData()\n      if (!this.inputCheck(params)) {\n        this.messageService.error({\n          content: '请至少选择一个升级到正式会员所需条件'\n        })\n        return\n      }\n      this.userLevelService.update(params).subscribe(() => {\n        this.messageService.success({\n          content: '保存成功'\n        })\n        this.$router.push({\n          query: {}\n        })\n      })\n    },\n    onCancel() {\n      this.$router.push({\n        query: {}\n      })\n    },\n    onConditionChange(val) {\n      this.condition = val\n    },\n    onRightsChange(val) {\n      this.rights = val\n    },\n    getData() {\n      return {\n        condition: this.condition,\n        rights: this.rights\n      }\n    },\n    inputCheck(params) {\n      const { condition } = params\n      if (!condition.length) {\n        return false\n      }\n      return true\n    }\n  }\n}\n</script>\n"]}]}