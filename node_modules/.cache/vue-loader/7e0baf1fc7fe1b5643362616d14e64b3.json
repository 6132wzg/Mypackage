{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/coupon/add.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/coupon/add.vue","mtime":1600926556122},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { UserService } from '@/services/user.service'\nimport { TitleService } from '@/services/title.service'\nimport moment from 'moment'\nimport { cloneDeep, remove, find as lodashFind } from 'lodash-es'\nimport { AddService } from './add.service'\nimport SelectShop from '@/views/fragments/shop/select-shop'\nimport H5Container from '@/views/biz-components/h5/h5-container'\nimport { ruleOptions } from './add.config'\nexport default {\n  name: 'BrandMarketingPluginCouponAdd',\n  serviceInject() {\n    return {\n      addService: AddService,\n      userService: UserService,\n      titleService: TitleService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.addService.loading$,\n      couponTypeOptions: this.addService.couponTypeOptions$,\n      isShopRangeOptions: this.addService.isShopRangeOptions$,\n      product_ranges: this.addService.product_ranges$\n    }\n  },\n  bem: {\n    basic: 'brand-marketing-coupon-add'\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      // isEditMode: false,\n      // form: this.$form.createForm(this),\n      // 优惠类型\n      couponType: 1,\n      // 优惠范围\n      showProductRange: '2',\n      // 门店范围\n      showShopRange: '2',\n      // 满足金额\n      fullPrice: '',\n      // 是否共享\n      isShare: false,\n      // 限领数量\n      personLimit: '',\n      // 已经选择的类目ids\n      rangeIds: [],\n      // 已经选择的门店ids\n      shopIds: [],\n      shopNames: ''\n    }\n  },\n  props: {\n    isEditMode: {\n      type: Boolean,\n      default: false\n    },\n    info: {\n      type: Object,\n      default: () => {}\n    }\n  },\n  created() {\n    if (this.isEditMode) {\n      this.setFieldsValue()\n    }\n  },\n  methods: {\n    limitChange(e) {\n      this.form.resetFields(['person_limit'])\n    },\n    userTypeChange(e) {\n      this.form.resetFields(['full_price'])\n    },\n    getValidDay(days) {\n      return moment()\n        .add(days, 'd')\n        .format('YYYY年MM月DD日 23:59')\n    },\n    getRange() {\n      let ranges = this.rangeIds.map(id => {\n        return lodashFind(this.product_ranges, { value: id }).label\n      })\n      return ranges\n    },\n    changeProductRange(event) {\n      this.rangeIds = event\n    },\n    onSelectShop(event) {\n      this.shopIds = event\n    },\n    checkThisLimitRadio() {\n      this.form.setFieldsValue({ is_limit: 2 })\n    },\n    setFieldsValue() {\n      this.couponType = this.info.coupon_type.id\n      this.showProductRange = this.info.is_product_range + ''\n      this.showShopRange = this.info.is_shop_range + ''\n      this.shopIds = this.info.shop_ids\n      this.rangeIds = this.info.range_ids\n      setTimeout(() => {\n        this.form.setFieldsValue({\n          coupon_name: this.info.coupon_name,\n          price: +this.info.price,\n          use_type: this.info.use_type,\n          full_price: +this.info.full_price || '',\n          number: this.info.number,\n          valid_days: this.info.valid_days,\n          is_share: this.info.is_share,\n          is_limit: this.info.is_limit,\n          person_limit: this.info.person_limit || ''\n        })\n      })\n    },\n    // 保存\n    onSubmit() {\n      this.form.validate().then(values => {\n        let params = {}\n        if (this.isEditMode) {\n          params.id = this.$searchQuery.id\n          params.before_number = this.info.number\n          params.after_number = values.number\n        } else {\n          params = {\n            coupon_type: this.couponType,\n            coupon_name: values.coupon_name,\n            price: values.price,\n            is_product_range: this.showProductRange,\n            range_ids: this.rangeIds,\n            is_shop_range: this.showShopRange,\n            shop_ids: this.shopIds,\n            use_type: values.use_type,\n            full_price: values.full_price,\n            number: values.number,\n            valid_days: values.valid_days,\n            is_share: values.is_share,\n            is_limit: values.is_limit,\n            person_limit: values.person_limit || undefined\n          }\n        }\n        if (this.isEditMode) {\n          this.addService.editMarketingCoupon(params).subscribe(res => {\n            // 编辑成功\n            this.$router.push({\n              path: '/brand/marketing/plugin/coupon/list'\n            })\n          })\n        } else {\n          this.addService.addMarketingCoupon(params).subscribe(res => {\n            // 新增成功\n            this.$router.push({\n              path: `/brand/marketing/plugin/coupon/list`\n            })\n          })\n        }\n      })\n    }\n  },\n  watch: {\n    shopIds(val) {\n      if (val && val.length) {\n        this.addService.getShopBasic({ shop_ids: val }).subscribe(res => {\n          this.shopNames = res.map(({ shop_name }) => shop_name).join('/')\n        })\n      }\n    }\n  },\n  components: {\n    SelectShop,\n    H5Container\n  }\n}\n",{"version":3,"sources":["add.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add.vue","sourceRoot":"src/views/pages/brand/marketing/plugin/coupon","sourcesContent":["<template>\n  <st-mina-panel>\n    <h5-container slot=\"preview\" fixed>\n      <template v-slot:title>\n        我的优惠券\n      </template>\n      <div :class=\"basic('left-coupon')\">\n        <div :class=\"basic('left-coupon-top')\">\n          <div :class=\"basic('left-coupon-top-left')\">\n            <span :class=\"basic('left-coupon-top-left-number')\">\n              {{ form.getFieldValue('price') }}\n            </span>\n            元\n            <br />\n            {{ form.getFieldValue('use_type') === 1 ? '无门槛使用' : '' }}\n            {{\n              form.getFieldValue('use_type') === 2\n                ? `满${form.getFieldValue('full_price') || ''}元使用`\n                : ''\n            }}\n          </div>\n          <div :class=\"basic('left-coupon-top-right')\">\n            有效期：{{ getValidDay(form.getFieldValue('valid_days')) }}\n            <br />\n            可用类目：{{ getRange().join('、') }}\n          </div>\n        </div>\n        <div :class=\"basic('left-coupon-bottom')\">\n          可用门店：{{ shopNames }}\n        </div>\n      </div>\n    </h5-container>\n    <div slot=\"actions\">\n      <st-button\n        :loading=\"loading.addMarketingCoupon || loading.editMarketingCoupon\"\n        type=\"primary\"\n        @click=\"onSubmit\"\n      >\n        保 存\n      </st-button>\n    </div>\n\n    <div>\n      <st-form :form=\"form\" labelWidth=\"118px\">\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"24\">\n            <st-form-item required v-if=\"couponTypeOptions.length\">\n              <template slot=\"label\">\n                优惠券类型\n                <st-help-tooltip id=\"TBYHQ001\" />\n              </template>\n              <a-radio-group v-model=\"couponType\" :disabled=\"isEditMode\">\n                <a-radio-button\n                  v-for=\"item in couponTypeOptions\"\n                  :value=\"item.value\"\n                  :key=\"item.value\"\n                >\n                  {{ item.label }}\n                </a-radio-button>\n              </a-radio-group>\n            </st-form-item>\n            <st-form-item label=\"优惠券名称\" required>\n              <a-input\n                :disabled=\"isEditMode\"\n                v-decorator=\"decorators.coupon_name\"\n                maxlength=\"10\"\n                placeholder=\"请输入优惠券名称\"\n                :class=\"basic('input')\"\n              ></a-input>\n            </st-form-item>\n            <st-form-item label=\"面额\" required>\n              <st-input-number\n                :float=\"true\"\n                :min=\"1\"\n                :max=\"99999\"\n                :disabled=\"isEditMode\"\n                style=\"top:0;\"\n                placeholder=\"请输入面额\"\n                :class=\"basic('input')\"\n                v-decorator=\"decorators.price\"\n              >\n                <template slot=\"addonAfter\">\n                  元\n                </template>\n              </st-input-number>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-divider :class=\"basic('line')\"></a-divider>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"23\">\n            <st-form-item label=\"优惠范围\" required>\n              <a-select\n                :disabled=\"isEditMode\"\n                :value=\"rangeIds\"\n                style=\"width: 360px\"\n                @change=\"changeProductRange\"\n                mode=\"multiple\"\n                placeholder=\"请选择类目\"\n                :class=\"basic('select')\"\n                :options=\"product_ranges\"\n              ></a-select>\n            </st-form-item>\n            <st-form-item label=\"可用门店\" required>\n              <a-radio-group\n                v-model=\"showShopRange\"\n                :disabled=\"isEditMode\"\n                v-if=\"isShopRangeOptions.length > 1\"\n              >\n                <a-radio\n                  v-for=\"item in isShopRangeOptions\"\n                  :value=\"item.value\"\n                  :key=\"item.value\"\n                >\n                  {{ item.label }}\n                </a-radio>\n              </a-radio-group>\n              <select-shop\n                style=\"border:1px solid #CDD4DF;padding:8px 12px;border-radius:4px\"\n                v-if=\"showShopRange == '2'\"\n                @change=\"onSelectShop\"\n                :shopIds=\"shopIds\"\n                :disabled=\"isEditMode\"\n              ></select-shop>\n            </st-form-item>\n            <st-form-item label=\"使用条件\" required>\n              <a-radio-group\n                :disabled=\"isEditMode\"\n                v-decorator=\"decorators.use_type\"\n                @change=\"userTypeChange\"\n              >\n                <a-radio :value=\"1\">无门槛使用</a-radio>\n                <a-form-item :class=\"basic('wrap-input')\">\n                  <a-radio :value=\"2\">\n                    满\n                    <st-input-number\n                      :float=\"true\"\n                      :class=\"basic('radio-input')\"\n                      :disabled=\"isEditMode\"\n                      v-decorator=\"decorators.full_price\"\n                    ></st-input-number>\n                    元使用\n                  </a-radio>\n                </a-form-item>\n              </a-radio-group>\n            </st-form-item>\n            <st-form-item label=\"发放数量\" required>\n              <st-input-number\n                :class=\"basic('input')\"\n                style=\"top:0;\"\n                placeholder=\"请输入数量\"\n                :min=\"isEditMode ? +info.number : 0\"\n                v-decorator=\"decorators.number\"\n              >\n                <template slot=\"addonAfter\">\n                  张\n                </template>\n              </st-input-number>\n              <span :class=\"basic('tip')\">保存后只可增加不可减少</span>\n            </st-form-item>\n            <st-form-item label=\"使用有效期\" required>\n              领券当日起\n              <st-input-number\n                :disabled=\"isEditMode\"\n                :class=\"basic('radio-input')\"\n                v-decorator=\"decorators.valid_days\"\n              ></st-input-number>\n              天内有效\n            </st-form-item>\n            <st-form-item>\n              <template slot=\"label\">\n                优惠共享\n                <st-help-tooltip id=\"TBYHQ002\" />\n              </template>\n              <st-checkbox\n                v-decorator=\"decorators.is_share\"\n                :disabled=\"isEditMode\"\n              >\n                不可与其它优惠同享\n              </st-checkbox>\n            </st-form-item>\n            <st-form-item label=\"每人限领\" required v-if=\"couponType === 1\">\n              <a-radio-group\n                :disabled=\"isEditMode\"\n                v-decorator=\"decorators.is_limit\"\n                @change=\"limitChange\"\n              >\n                <a-radio :value=\"1\">不限</a-radio>\n                <a-form-item :class=\"basic('wrap-input')\">\n                  <a-radio :value=\"2\">\n                    每人限领\n                    <a-input-number\n                      @focus=\"checkThisLimitRadio\"\n                      :disabled=\"isEditMode\"\n                      :class=\"basic('radio-input')\"\n                      v-decorator=\"decorators.person_limit\"\n                    ></a-input-number>\n                    次\n                  </a-radio>\n                </a-form-item>\n              </a-radio-group>\n            </st-form-item>\n          </a-col>\n        </a-row>\n      </st-form>\n    </div>\n  </st-mina-panel>\n</template>\n<script>\nimport { UserService } from '@/services/user.service'\nimport { TitleService } from '@/services/title.service'\nimport moment from 'moment'\nimport { cloneDeep, remove, find as lodashFind } from 'lodash-es'\nimport { AddService } from './add.service'\nimport SelectShop from '@/views/fragments/shop/select-shop'\nimport H5Container from '@/views/biz-components/h5/h5-container'\nimport { ruleOptions } from './add.config'\nexport default {\n  name: 'BrandMarketingPluginCouponAdd',\n  serviceInject() {\n    return {\n      addService: AddService,\n      userService: UserService,\n      titleService: TitleService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.addService.loading$,\n      couponTypeOptions: this.addService.couponTypeOptions$,\n      isShopRangeOptions: this.addService.isShopRangeOptions$,\n      product_ranges: this.addService.product_ranges$\n    }\n  },\n  bem: {\n    basic: 'brand-marketing-coupon-add'\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      // isEditMode: false,\n      // form: this.$form.createForm(this),\n      // 优惠类型\n      couponType: 1,\n      // 优惠范围\n      showProductRange: '2',\n      // 门店范围\n      showShopRange: '2',\n      // 满足金额\n      fullPrice: '',\n      // 是否共享\n      isShare: false,\n      // 限领数量\n      personLimit: '',\n      // 已经选择的类目ids\n      rangeIds: [],\n      // 已经选择的门店ids\n      shopIds: [],\n      shopNames: ''\n    }\n  },\n  props: {\n    isEditMode: {\n      type: Boolean,\n      default: false\n    },\n    info: {\n      type: Object,\n      default: () => {}\n    }\n  },\n  created() {\n    if (this.isEditMode) {\n      this.setFieldsValue()\n    }\n  },\n  methods: {\n    limitChange(e) {\n      this.form.resetFields(['person_limit'])\n    },\n    userTypeChange(e) {\n      this.form.resetFields(['full_price'])\n    },\n    getValidDay(days) {\n      return moment()\n        .add(days, 'd')\n        .format('YYYY年MM月DD日 23:59')\n    },\n    getRange() {\n      let ranges = this.rangeIds.map(id => {\n        return lodashFind(this.product_ranges, { value: id }).label\n      })\n      return ranges\n    },\n    changeProductRange(event) {\n      this.rangeIds = event\n    },\n    onSelectShop(event) {\n      this.shopIds = event\n    },\n    checkThisLimitRadio() {\n      this.form.setFieldsValue({ is_limit: 2 })\n    },\n    setFieldsValue() {\n      this.couponType = this.info.coupon_type.id\n      this.showProductRange = this.info.is_product_range + ''\n      this.showShopRange = this.info.is_shop_range + ''\n      this.shopIds = this.info.shop_ids\n      this.rangeIds = this.info.range_ids\n      setTimeout(() => {\n        this.form.setFieldsValue({\n          coupon_name: this.info.coupon_name,\n          price: +this.info.price,\n          use_type: this.info.use_type,\n          full_price: +this.info.full_price || '',\n          number: this.info.number,\n          valid_days: this.info.valid_days,\n          is_share: this.info.is_share,\n          is_limit: this.info.is_limit,\n          person_limit: this.info.person_limit || ''\n        })\n      })\n    },\n    // 保存\n    onSubmit() {\n      this.form.validate().then(values => {\n        let params = {}\n        if (this.isEditMode) {\n          params.id = this.$searchQuery.id\n          params.before_number = this.info.number\n          params.after_number = values.number\n        } else {\n          params = {\n            coupon_type: this.couponType,\n            coupon_name: values.coupon_name,\n            price: values.price,\n            is_product_range: this.showProductRange,\n            range_ids: this.rangeIds,\n            is_shop_range: this.showShopRange,\n            shop_ids: this.shopIds,\n            use_type: values.use_type,\n            full_price: values.full_price,\n            number: values.number,\n            valid_days: values.valid_days,\n            is_share: values.is_share,\n            is_limit: values.is_limit,\n            person_limit: values.person_limit || undefined\n          }\n        }\n        if (this.isEditMode) {\n          this.addService.editMarketingCoupon(params).subscribe(res => {\n            // 编辑成功\n            this.$router.push({\n              path: '/brand/marketing/plugin/coupon/list'\n            })\n          })\n        } else {\n          this.addService.addMarketingCoupon(params).subscribe(res => {\n            // 新增成功\n            this.$router.push({\n              path: `/brand/marketing/plugin/coupon/list`\n            })\n          })\n        }\n      })\n    }\n  },\n  watch: {\n    shopIds(val) {\n      if (val && val.length) {\n        this.addService.getShopBasic({ shop_ids: val }).subscribe(res => {\n          this.shopNames = res.map(({ shop_name }) => shop_name).join('/')\n        })\n      }\n    }\n  },\n  components: {\n    SelectShop,\n    H5Container\n  }\n}\n</script>\n"]}]}