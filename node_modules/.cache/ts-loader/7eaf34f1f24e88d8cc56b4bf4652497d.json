{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/store/data/data.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/store/data/data.service.ts","mtime":1591147717472},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b, _c, _d, _e;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { Injectable } from 'vue-service-app';\nimport { State, Effect } from 'rx-state';\nimport { tap } from 'rxjs/operators';\nimport { StoreApi, DtoreBoard, MemberAnalysis } from '@/api/v1/shop/store/store';\nimport { anyAll } from '@/operators';\nimport moment from 'moment';\nvar setObj = {\n  date_type: 1,\n  date: moment().subtract(1, 'days').format('YYYY-MM-DD') + ''\n};\n\nvar DataService = /*#__PURE__*/function () {\n  function DataService(stockApi) {\n    _classCallCheck(this, DataService);\n\n    this.stockApi = stockApi;\n    this.dataProfile$ = new State({});\n    this.storeBoard$ = new State({});\n    this.storeSaleList$ = new State({});\n    this.storeCategoryRank$ = new State({});\n    this.storeMemberAnalysis$ = new State({});\n  } // 数据概况\n\n\n  _createClass(DataService, [{\n    key: \"getDataProfile\",\n    value: function getDataProfile() {\n      var _this = this;\n\n      return this.stockApi.dataProfile().pipe(tap(function (res) {\n        _this.dataProfile$.commit(function () {\n          return res;\n        });\n      }));\n    } // 整体看板\n\n  }, {\n    key: \"getStoreBoard\",\n    value: function getStoreBoard(query) {\n      var _this2 = this;\n\n      return this.stockApi.storeBoard(query).pipe(tap(function (res) {\n        _this2.storeBoard$.commit(function () {\n          return res;\n        });\n      }));\n    } // 类目支付排行\n\n  }, {\n    key: \"getStoreSaleList\",\n    value: function getStoreSaleList(query) {\n      var _this3 = this;\n\n      return this.stockApi.storeSaleList(query).pipe(tap(function (res) {\n        _this3.storeSaleList$.commit(function () {\n          return res;\n        });\n      }));\n    } // 商品销售榜\n\n  }, {\n    key: \"getStoreCategoryRank\",\n    value: function getStoreCategoryRank(query) {\n      var _this4 = this;\n\n      return this.stockApi.storeCategoryRank(query).pipe(tap(function (res) {\n        res.category_list = _this4.storeCategoryRankFilter(res);\n        console.log('商品销售榜', res);\n\n        _this4.storeCategoryRank$.commit(function () {\n          return res;\n        });\n      }));\n    } // 【门店】用户分析\n\n  }, {\n    key: \"getStoreMemberAnalysis\",\n    value: function getStoreMemberAnalysis(query) {\n      var _this5 = this;\n\n      return this.stockApi.storeMemberAnalysis(query).pipe(tap(function (res) {\n        _this5.storeMemberAnalysis$.commit(function () {\n          return res;\n        });\n      }));\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      return anyAll(this.getDataProfile(), this.getStoreBoard(setObj), this.getStoreSaleList(setObj), this.getStoreCategoryRank(setObj), this.getStoreMemberAnalysis(Object.assign(setObj, {\n        choose_type: 1\n      })));\n    }\n  }, {\n    key: \"beforeRouteEnter\",\n    value: function beforeRouteEnter(to, from) {\n      return this.init();\n    } // 数据处理\n    // 类目分析数据处理\n\n  }, {\n    key: \"storeCategoryRankFilter\",\n    value: function storeCategoryRankFilter(data) {\n      return data.category_list.map(function (item) {\n        return {\n          name: item.category_name,\n          value: item.amount\n        };\n      });\n    }\n  }]);\n\n  return DataService;\n}();\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", []), __metadata(\"design:returntype\", void 0)], DataService.prototype, \"getDataProfile\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_a = typeof DtoreBoard !== \"undefined\" && DtoreBoard) === \"function\" ? _a : Object]), __metadata(\"design:returntype\", void 0)], DataService.prototype, \"getStoreBoard\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_b = typeof DtoreBoard !== \"undefined\" && DtoreBoard) === \"function\" ? _b : Object]), __metadata(\"design:returntype\", void 0)], DataService.prototype, \"getStoreSaleList\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_c = typeof DtoreBoard !== \"undefined\" && DtoreBoard) === \"function\" ? _c : Object]), __metadata(\"design:returntype\", void 0)], DataService.prototype, \"getStoreCategoryRank\", null);\n\n__decorate([Effect(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_d = typeof MemberAnalysis !== \"undefined\" && MemberAnalysis) === \"function\" ? _d : Object]), __metadata(\"design:returntype\", void 0)], DataService.prototype, \"getStoreMemberAnalysis\", null);\n\nDataService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_e = typeof StoreApi !== \"undefined\" && StoreApi) === \"function\" ? _e : Object])], DataService);\nexport { DataService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/store/data/data.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable, Controller, ServiceRoute } from 'vue-service-app'\nimport { State, Effect } from 'rx-state'\nimport { tap } from 'rxjs/operators'\nimport { StoreApi, DtoreBoard, MemberAnalysis } from '@/api/v1/shop/store/store'\nimport { anyAll } from '@/operators'\nimport moment from 'moment'\nlet setObj = {\n  date_type: 1,\n  date:\n    moment()\n      .subtract(1, 'days')\n      .format('YYYY-MM-DD') + ''\n}\n@Injectable()\nexport class DataService implements Controller {\n  dataProfile$ = new State({})\n  storeBoard$ = new State({})\n  storeSaleList$ = new State({})\n  storeCategoryRank$ = new State({})\n  storeMemberAnalysis$ = new State({})\n  constructor(private stockApi: StoreApi) {}\n  @Effect()\n  // 数据概况\n  getDataProfile() {\n    return this.stockApi.dataProfile().pipe(\n      tap((res: any) => {\n        this.dataProfile$.commit(() => res)\n      })\n    )\n  }\n  @Effect()\n  // 整体看板\n  getStoreBoard(query: DtoreBoard) {\n    return this.stockApi.storeBoard(query).pipe(\n      tap((res: any) => {\n        this.storeBoard$.commit(() => res)\n      })\n    )\n  }\n  @Effect()\n  // 类目支付排行\n  getStoreSaleList(query: DtoreBoard) {\n    return this.stockApi.storeSaleList(query).pipe(\n      tap((res: any) => {\n        this.storeSaleList$.commit(() => res)\n      })\n    )\n  }\n  @Effect()\n  // 商品销售榜\n  getStoreCategoryRank(query: DtoreBoard) {\n    return this.stockApi.storeCategoryRank(query).pipe(\n      tap((res: any) => {\n        res.category_list = this.storeCategoryRankFilter(res)\n        console.log('商品销售榜', res)\n        this.storeCategoryRank$.commit(() => res)\n      })\n    )\n  }\n  @Effect()\n  // 【门店】用户分析\n  getStoreMemberAnalysis(query: MemberAnalysis) {\n    return this.stockApi.storeMemberAnalysis(query).pipe(\n      tap((res: any) => {\n        this.storeMemberAnalysis$.commit(() => res)\n      })\n    )\n  }\n  init() {\n    return anyAll(\n      this.getDataProfile(),\n      this.getStoreBoard(setObj),\n      this.getStoreSaleList(setObj),\n      this.getStoreCategoryRank(setObj),\n      this.getStoreMemberAnalysis(Object.assign(setObj, { choose_type: 1 }))\n    )\n  }\n  beforeRouteEnter(to: ServiceRoute, from: ServiceRoute) {\n    return this.init()\n  }\n  // 数据处理\n  // 类目分析数据处理\n  storeCategoryRankFilter(data: any) {\n    return data.category_list.map((item: any) => {\n      return {\n        name: item.category_name,\n        value: item.amount\n      }\n    })\n  }\n}\n"],"sourceRoot":""}]}