{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/package/form/form.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/package/form/form.vue","mtime":1600926555706},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _typeof from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/typeof\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { FormService } from \"./form.service\";\nimport { ruleOptions as _ruleOptions } from \"./form.config\";\nimport TransferSettingFormItem from \"./form-item#/transfer-setting-form-item.vue\";\nimport ReserveCourse from \"./form-item#/reserve-course.vue\";\nimport ReserveIsLimitFormItem from \"./form-item#/reserve-is-limit-form-item.vue\";\nimport ReserveCourseSpeciesFormItem from \"./form-item#/reserve-course-species-form-item.vue\";\nimport FreezeSettingFormItem from \"./form-item#/freeze-setting-form-item.vue\";\nimport SlodPriceSettingFormItem from \"./form-item#/slod-price-setting-form-item\";\nimport BuyTimeFormItem from '@/views/biz-components/sold/sold-time-form-item/sold-time-form-item.vue';\nimport BizAssignShop from '@/views/biz-components/shop/assign-shop/assign-shop.vue';\nimport BizCardBgRadio from '@/views/biz-components/card-bg-radio/card-bg-radio.vue';\nimport StEditor from '@/views/components/editor#/editor.vue';\nimport { PatternService } from '@/services/pattern.service';\nimport { cloneDeep, intersection, intersectionWith } from 'lodash';\nexport default {\n  name: 'BizPackageForm',\n  bem: {\n    b: 'biz-package-form'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      pattern: PatternService,\n      service: FormService\n    };\n  },\n  rxState: function rxState() {\n    var _this$service = this.service,\n        packageTypeOptions$ = _this$service.packageTypeOptions$,\n        packageAttrOptions$ = _this$service.packageAttrOptions$,\n        freezeUnitOptions$ = _this$service.freezeUnitOptions$,\n        shop$ = _this$service.shop$,\n        isShop$ = _this$service.isShop$,\n        coachList$ = _this$service.coachList$,\n        cardBgList$ = _this$service.cardBgList$,\n        sellTypeOptions$ = _this$service.sellTypeOptions$;\n    return {\n      cardBgList$: cardBgList$,\n      packageTypeOptions$: packageTypeOptions$,\n      packageAttrOptions$: packageAttrOptions$,\n      freezeUnitOptions$: freezeUnitOptions$,\n      coachList$: coachList$,\n      shop$: shop$,\n      isShop$: isShop$,\n      sellTypeOptions$: sellTypeOptions$\n    };\n  },\n  provide: function provide() {\n    return {\n      form: this\n    };\n  },\n  props: {\n    initInfo: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    isEdit: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    return {\n      courses: ['', '团体课', '私教课', '团体课和私教课'],\n      form: form,\n      isFreeze: false,\n      FORMAT_DATE: 'YYYY-MM-DD',\n      isTransfer: false,\n      courseSetting: {},\n      useRange: 3,\n      isReset: true,\n      resetPrice: true,\n      cardBgValidatorText: '',\n      courseValidatorText: '',\n      useShopIds: [],\n      validTime: {\n        min: 0,\n        max: 999\n      },\n      image: {\n        image_id: 0,\n        image_key: this.cardBgList$[0].image_key,\n        image_url: '',\n        index: 1\n      },\n      personalCourse: [],\n      teamCourse: [],\n      saleRange: 3,\n      saleShopIds: [],\n      autosize: {\n        minRows: 4,\n        maxRow: 20\n      },\n      unLimited: false,\n      courseName: '我是课程包',\n      packageAttr: 1\n    };\n  },\n  components: {\n    BizCardBgRadio: BizCardBgRadio,\n    BuyTimeFormItem: BuyTimeFormItem,\n    TransferSettingFormItem: TransferSettingFormItem,\n    ReserveIsLimitFormItem: ReserveIsLimitFormItem,\n    ReserveCourseSpeciesFormItem: ReserveCourseSpeciesFormItem,\n    FreezeSettingFormItem: FreezeSettingFormItem,\n    SlodPriceSettingFormItem: SlodPriceSettingFormItem,\n    BizAssignShop: BizAssignShop,\n    StEditor: StEditor,\n    ReserveCourse: ReserveCourse\n  },\n  methods: {\n    resetCourse: function resetCourse() {\n      var _this = this;\n\n      var useShopList = this.form.getFieldValue('use_shop_list');\n      if (intersection(this.useShopIds, useShopList).length === this.useShopIds.length) return;\n      if (!this.personalCourse.length && !this.teamCourse.length) return;\n      this.isReset = false;\n      var timer = setTimeout(function () {\n        _this.teamCourse = [];\n        _this.personalCourse = [];\n        _this.isReset = !_this.isReset;\n      }, 16);\n    },\n    onChangeValidTimeUnit: function onChangeValidTimeUnit(value) {\n      if (value === 3) {\n        this.validTime = {\n          min: 1,\n          max: 50\n        };\n      }\n    },\n    onChangePersonalCourse: function onChangePersonalCourse(course) {\n      this.courseValidatorText = '';\n      this.personalCourse = course;\n    },\n    onChangeTeamCourse: function onChangeTeamCourse(course) {\n      this.courseValidatorText = '';\n      this.teamCourse = course;\n    },\n    onChangeUseRange: function onChangeUseRange(value, shopIds) {\n      this.resetCourse();\n      this.useRange = value;\n      this.useShopIds = shopIds;\n    },\n    onChangeSaleRange: function onChangeSaleRange(value) {\n      this.saleRange = value;\n    },\n    onCardBgChange: function onCardBgChange() {\n      this.cardBgValidatorText = '';\n    },\n    // 卡背景校验\n    cardBgValidator: function cardBgValidator() {\n      var validata = this.image.image_key !== '';\n      this.cardBgValidatorText = validata ? '' : '请上传卡背景';\n    },\n    // 课程自定义校验\n    courseValidator: function courseValidator() {\n      var validata = true;\n      var course = [].concat(_toConsumableArray(this.personalCourse), _toConsumableArray(this.teamCourse));\n      course.forEach(function (item) {\n        validata = item.course_times && item.course_unit_price || item.reduce_times;\n      });\n\n      if (this.packageAttr === 2 && this.unLimited) {\n        validata = this.unLimited;\n      }\n\n      this.courseValidatorText = validata ? '' : '请填写上课次数或者额度';\n    },\n    getShopIds: function getShopIds(type) {\n      return this.initInfo[\"\".concat(type, \"_shop_list\")] && this.initInfo[\"\".concat(type, \"_shop_list\")].map(function (item) {\n        return item.shop_id;\n      }) || [];\n    },\n    // 获取可约课程种类数据\n    onChangeReserveSpec: function onChangeReserveSpec(courseSetting) {\n      this.courseSetting = courseSetting;\n    },\n    // 选择课程包类型，当选择不限次约课只能选择范围课程\n    onChangePackageType: function onChangePackageType(event) {\n      this.unLimited = event.target.value === 0; // 当为不限次课程式，只允许是范围内课程 设置级联值和表单值\n\n      this.packageAttr = this.unLimited ? 2 : 1;\n      this.form.setFieldsValue({\n        course_range: this.unLimited ? 2 : 1\n      });\n    },\n\n    /**\n     *  选择任意课程： 可约课程不可选。显示一行文本\n     */\n    onChangePackageAttr: function onChangePackageAttr(event) {\n      this.packageAttr = event.target.value;\n    },\n    formDataFormat: function formDataFormat(saveType) {\n      var _this2 = this;\n\n      var useRange = this.useRange,\n          saleRange = this.saleRange,\n          image = this.image,\n          courseSetting = this.courseSetting,\n          personalCourse = this.personalCourse,\n          teamCourse = this.teamCourse,\n          FORMAT_DATE = this.FORMAT_DATE;\n      var form = {\n        image: image,\n        use_range: useRange,\n        sale_range: saleRange,\n        course_setting: courseSetting\n      };\n\n      if (personalCourse.length) {\n        var p = cloneDeep(personalCourse);\n        form.support_course_personal_range = p.map(function (item) {\n          item.coach_level_ids = item.coach_level_ids.map(function (ele) {\n            return _typeof(ele) === 'object' ? ele.id : ele;\n          });\n          return item;\n        });\n      }\n\n      if (teamCourse.length) {\n        form.support_course_team_range = teamCourse;\n      }\n\n      this.form.getFieldValue('use_shop_list');\n      this.form.getFieldValue('sale_shop_list');\n      this.cardBgValidator();\n      this.courseValidator();\n      this.form.validate().then(function (values) {\n        if (!_this2.cardBgIsOk || !_this2.courseIsOk) return;\n        var v = cloneDeep(values);\n        var _v$team_total_price = v.team_total_price,\n            team_total_price = _v$team_total_price === void 0 ? 0 : _v$team_total_price,\n            _v$personal_total_pri = v.personal_total_price,\n            personal_total_price = _v$personal_total_pri === void 0 ? 0 : _v$personal_total_pri;\n        v.price = v.price ? v.price : +team_total_price + +personal_total_price;\n        v.reserve_is_limit = v.reserve_is_limit[0] || 0;\n        v.is_allow_transfer = v.is_allow_transfer[0] || 0;\n        v.is_allow_frozen = v.is_allow_frozen[0] || 0;\n\n        if (v.sale_time && v.sale_time.length) {\n          v.start_time = moment(v.sale_time[0]).format(FORMAT_DATE).valueOf();\n          v.end_time = moment(v.sale_time[1]).format(FORMAT_DATE).valueOf();\n          delete v.sale_time;\n        }\n\n        form = _objectSpread({}, v, {}, form);\n\n        _this2.$emit(saveType, form);\n      });\n    },\n    onSave: function onSave() {\n      this.formDataFormat('save');\n    },\n    onSaveAndOnShelf: function onSaveAndOnShelf() {\n      this.formDataFormat('shelf');\n    }\n  },\n  watch: {\n    courseSpec: function courseSpec() {\n      var _this3 = this;\n\n      this.resetPrice = false;\n      var timer = setTimeout(function () {\n        _this3.resetPrice = true;\n        clearTimeout(timer);\n      });\n    }\n  },\n  computed: {\n    ruleOptions: function ruleOptions() {\n      return _ruleOptions;\n    },\n    decorators: function decorators() {\n      return this.form.decorators(this.ruleOptions);\n    },\n    // 约课种类\n    courseSpec: function courseSpec() {\n      return this.courseSetting.spec;\n    },\n    teamCourseList: function teamCourseList() {\n      return this.initInfo.support_course_team_range || [];\n    },\n    personalCourseList: function personalCourseList() {\n      var courseList = cloneDeep(this.initInfo.support_course_personal_range) || [];\n      return courseList.map(function (item) {\n        item.coach_level_ids = item.coach_level_ids.map(function (ele) {\n          return ele.id;\n        });\n        return item;\n      });\n    },\n    coachList: function coachList() {\n      return this.coachList$;\n    },\n    // 卡背景是否校验通过\n    cardBgIsOk: function cardBgIsOk() {\n      return this.cardBgValidatorText === '';\n    },\n    courseIsOk: function courseIsOk() {\n      return this.courseValidatorText === '';\n    },\n    packageAttrOptions: function packageAttrOptions() {\n      var _this4 = this;\n\n      return this.packageAttrOptions$.map(function (item) {\n        _this4.$set(item, 'disabled', _this4.unLimited && item.value !== 2);\n\n        return item;\n      });\n    }\n  },\n  created: function created() {\n    this.service.getCoachList().subscribe();\n  },\n  mounted: function mounted() {\n    if (!this.isEdit) return;\n    var _this$initInfo = this.initInfo,\n        _this$initInfo$course = _this$initInfo.course_range,\n        course_range = _this$initInfo$course === void 0 ? 1 : _this$initInfo$course,\n        _this$initInfo$use_ra = _this$initInfo.use_range,\n        use_range = _this$initInfo$use_ra === void 0 ? 3 : _this$initInfo$use_ra,\n        _this$initInfo$sale_r = _this$initInfo.sale_range,\n        sale_range = _this$initInfo$sale_r === void 0 ? 3 : _this$initInfo$sale_r,\n        is_limit = _this$initInfo.is_limit,\n        image = _this$initInfo.image; // 编辑时，判断课程包是否限次\n\n    this.unLimited = is_limit === 0; // 编辑时判断是 范围 不限次 固定\n\n    this.packageAttr = course_range;\n    this.saleRange = sale_range;\n    this.useRange = use_range;\n    this.useShopIds = this.getShopIds('use');\n    this.saleShopIds = this.getShopIds('sale');\n    this.image = image;\n  }\n};",{"version":3,"sources":["form.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-panel app initial :class=\"b()\">\n    <st-form :form=\"form\" class=\"pd-y12\">\n      <!-- 基本信息 start -->\n      <div :class=\"b('base-info')\">\n        <block-title title-name=\"基本信息\" class=\"mg-b32\"></block-title>\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"24\">\n            <st-form-item label=\"课程名称\" labelWidth=\"148px\" required>\n              <st-input\n                :disabled=\"isEdit\"\n                :maxLength=\"30\"\n                style=\"width: 320px\"\n                v-decorator=\"decorators.course_name\"\n                placeholder=\"请输入课程包名称\"\n                allowClear\n              ></st-input>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"24\">\n            <st-form-item label=\"课程包类型\" labelWidth=\"148px\">\n              <a-radio-group\n                @change=\"onChangePackageType\"\n                :disabled=\"isEdit\"\n                v-decorator=\"decorators.is_limit\"\n                :options=\"packageTypeOptions$\"\n              />\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"14\">\n            <st-form-item label=\"课程包属性\" labelWidth=\"148px\">\n              <a-radio-group\n                :disabled=\"isEdit\"\n                v-decorator=\"decorators.course_range\"\n                @change=\"onChangePackageAttr\"\n              >\n                <a-radio\n                  v-for=\"item in packageAttrOptions\"\n                  :key=\"item.value\"\n                  :disabled=\"item.disabled\"\n                  :value=\"item.value\"\n                >\n                  <span>{{ item.label }}</span>\n                  <st-help-tooltip class=\"mg-l4\" :id=\"item.tooltip\" />\n                </a-radio>\n              </a-radio-group>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"24\">\n            <st-form-item\n              v-if=\"isShop$\"\n              label=\"支持上课门店\"\n              labelWidth=\"148px\"\n              required\n            >\n              <a-input\n                style=\"width: 320px\"\n                disabled\n                :value=\"shop$.name\"\n              ></a-input>\n            </st-form-item>\n\n            <biz-assign-shop\n              v-else\n              label=\"支持上课门店\"\n              labelWidth=\"148px\"\n              formItemKey=\"use_shop_list\"\n              :form=\"form\"\n              :shopIds=\"useShopIds\"\n              :type=\"useRange\"\n              @change=\"onChangeUseRange\"\n              required\n            ></biz-assign-shop>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"2\" v-if=\"packageAttr !== 3\">\n          <a-col :lg=\"12\" :xs=\"16\">\n            <!-- 可约课程种类固定课程没有此选项 -->\n            <reserve-course-species-form-item @change=\"onChangeReserveSpec\" />\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"22\">\n            <st-form-item\n              label=\"可约课程\"\n              :validateStatus=\"courseValidatorText ? 'error' : ''\"\n              :help=\"courseValidatorText\"\n              labelWidth=\"148px\"\n              required\n            >\n              <span v-if=\"packageAttr === 1\">\n                <span>支持上课门店的全部{{ courses[courseSpec] }}</span>\n              </span>\n              <div v-else-if=\"packageAttr === 2\">\n                <reserve-course\n                  v-if=\"isReset && [1, 3, 4].includes(courseSpec)\"\n                  key=\"team\"\n                  :initDataSource=\"teamCourseList\"\n                  @change=\"onChangeTeamCourse\"\n                  courseType=\"team\"\n                ></reserve-course>\n                <reserve-course\n                  v-if=\"isReset && [2, 3, 4].includes(courseSpec)\"\n                  courseType=\"personal\"\n                  @change=\"onChangePersonalCourse\"\n                  key=\"personal\"\n                  :initDataSource=\"personalCourseList\"\n                  class=\"mg-t16\"\n                ></reserve-course>\n              </div>\n              <div v-else-if=\"packageAttr === 3\">\n                <reserve-course\n                  v-if=\"isReset\"\n                  key=\"team\"\n                  @change=\"onChangeTeamCourse\"\n                  :initDataSource=\"teamCourseList\"\n                  courseType=\"team\"\n                ></reserve-course>\n                <reserve-course\n                  v-if=\"isReset\"\n                  courseType=\"personal\"\n                  :initDataSource=\"personalCourseList\"\n                  @change=\"onChangePersonalCourse\"\n                  key=\"personal\"\n                  class=\"mg-t16\"\n                ></reserve-course>\n              </div>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"24\">\n            <reserve-is-limit-form-item></reserve-is-limit-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"24\">\n            <st-form-item labelWidth=\"148px\" required>\n              <template slot=\"label\">\n                支持使用人数\n                <st-help-tooltip id=\"TBMCDC003\" />\n              </template>\n              <st-input-number\n                v-decorator=\"decorators.support_num\"\n                style=\"width: 121px\"\n                :min=\"1\"\n                :max=\"20\"\n              >\n                <template slot=\"addonAfter\">人</template>\n              </st-input-number>\n              <span class=\"mg-l20 tip\">上限20人</span>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"8\" :xs=\"11\">\n            <st-form-item labelWidth=\"148px\" label=\"有效期\" required>\n              <st-input-number\n                v-decorator=\"decorators.valid_time\"\n                :max=\"validTime.max\"\n                :min=\"validTime.min\"\n                style=\"width: 141px\"\n              >\n                <a-select\n                  slot=\"addonAfter\"\n                  v-decorator=\"decorators.valid_time_unit\"\n                  @change=\"onChangeValidTimeUnit\"\n                  :options=\"freezeUnitOptions$\"\n                ></a-select>\n              </st-input-number>\n            </st-form-item>\n          </a-col>\n        </a-row>\n      </div>\n      <!-- 基本信息 end -->\n\n      <!-- 售卖信息 start -->\n      <div :class=\"b('buy-info')\">\n        <block-title title-name=\"售卖信息\" class=\"mg-b32\"></block-title>\n        <slod-price-setting-form-item\n          v-if=\"resetPrice\"\n        ></slod-price-setting-form-item>\n        <!-- 支持售卖时间 start-->\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"24\">\n            <buy-time-form-item :decorators=\"decorators\" />\n          </a-col>\n        </a-row>\n        <!-- 支持售卖时间 end-->\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"24\" :xs=\"11\">\n            <st-form-item\n              v-if=\"isShop$\"\n              label=\"支持售卖门店\"\n              labelWidth=\"148px\"\n              required\n            >\n              <a-input\n                disabled\n                style=\"width: 320px\"\n                :value=\"shop$.name\"\n              ></a-input>\n            </st-form-item>\n            <biz-assign-shop\n              v-else\n              label=\"支持售卖门店\"\n              labelWidth=\"148px\"\n              formItemKey=\"sale_shop_list\"\n              :form=\"form\"\n              :shopIds=\"saleShopIds\"\n              @change=\"onChangeSaleRange\"\n              :type=\"saleRange\"\n              required\n            ></biz-assign-shop>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"24\">\n            <st-form-item label=\"售卖方式\" labelWidth=\"148px\" required>\n              <a-checkbox-group v-decorator=\"decorators.sale_mode\">\n                <a-checkbox\n                  v-for=\"item in sellTypeOptions$\"\n                  :key=\"item.value\"\n                  class=\"mg-r40\"\n                  :value=\"item.value\"\n                >\n                  <span>{{ item.label }}</span>\n                </a-checkbox>\n              </a-checkbox-group>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <!-- 转让设置 start -->\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"12\" :xs=\"16\">\n            <transfer-setting-form-item></transfer-setting-form-item>\n          </a-col>\n        </a-row>\n        <!-- 转让设置 end -->\n        <!-- 冻结设置 start -->\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"24\">\n            <freeze-setting-form-item></freeze-setting-form-item>\n          </a-col>\n        </a-row>\n        <!-- 冻结设置 end -->\n      </div>\n      <!-- 售卖信息 end -->\n\n      <!-- 其他信息 start -->\n      <div :class=\"b('other-info')\">\n        <block-title title-name=\"其他信息\" class=\"mg-b32\"></block-title>\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"11\" :xs=\"11\">\n            <st-form-item\n              label=\"封面\"\n              labelWidth=\"148px\"\n              validateStatus=\"error\"\n              :help=\"cardBgValidatorText\"\n              required\n            >\n              <biz-card-bg-radio\n                v-model=\"image\"\n                @change=\"onCardBgChange\"\n                isPackage\n              ></biz-card-bg-radio>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"22\" :xs=\"24\">\n            <st-form-item label=\"课程包介绍\" labelWidth=\"148px\">\n              <st-editor v-decorator=\"decorators.intro\"></st-editor>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"2\">\n          <a-col :lg=\"22\" :xs=\"24\">\n            <st-form-item label=\"内部备注\" labelWidth=\"148px\">\n              <st-textarea\n                allow-clear\n                placeholder=\"备注内容仅商家可见\"\n                v-decorator=\"decorators.remarks\"\n                :autosize=\"autosize\"\n              ></st-textarea>\n            </st-form-item>\n          </a-col>\n        </a-row>\n      </div>\n      <!-- 其他信息 end -->\n      <a-row :gutter=\"2\">\n        <a-col :lg=\"11\" :xs=\"11\">\n          <st-form-item labelFix labelWidth=\"148px\">\n            <st-button type=\"primary\" @click=\"onSave\">保存</st-button>\n            <st-button v-if=\"!isEdit\" class=\"mg-l16\" @click=\"onSaveAndOnShelf\">\n              保存并上架\n            </st-button>\n          </st-form-item>\n        </a-col>\n      </a-row>\n    </st-form>\n  </st-panel>\n</template>\n\n<script>\nimport { FormService } from './form.service'\nimport { ruleOptions } from './form.config'\nimport TransferSettingFormItem from './form-item#/transfer-setting-form-item.vue'\nimport ReserveCourse from './form-item#/reserve-course.vue'\nimport ReserveIsLimitFormItem from './form-item#/reserve-is-limit-form-item.vue'\nimport ReserveCourseSpeciesFormItem from './form-item#/reserve-course-species-form-item.vue'\nimport FreezeSettingFormItem from './form-item#/freeze-setting-form-item.vue'\nimport SlodPriceSettingFormItem from './form-item#/slod-price-setting-form-item'\nimport BuyTimeFormItem from '@/views/biz-components/sold/sold-time-form-item/sold-time-form-item.vue'\nimport BizAssignShop from '@/views/biz-components/shop/assign-shop/assign-shop.vue'\nimport BizCardBgRadio from '@/views/biz-components/card-bg-radio/card-bg-radio.vue'\nimport StEditor from '@/views/components/editor#/editor.vue'\nimport { PatternService } from '@/services/pattern.service'\nimport { cloneDeep, intersection, intersectionWith } from 'lodash'\nexport default {\n  name: 'BizPackageForm',\n  bem: {\n    b: 'biz-package-form'\n  },\n  serviceInject() {\n    return {\n      pattern: PatternService,\n      service: FormService\n    }\n  },\n  rxState() {\n    const {\n      packageTypeOptions$,\n      packageAttrOptions$,\n      freezeUnitOptions$,\n      shop$,\n      isShop$,\n      coachList$,\n      cardBgList$,\n      sellTypeOptions$\n    } = this.service\n    return {\n      cardBgList$,\n      packageTypeOptions$,\n      packageAttrOptions$,\n      freezeUnitOptions$,\n      coachList$,\n      shop$,\n      isShop$,\n      sellTypeOptions$\n    }\n  },\n  provide() {\n    return {\n      form: this\n    }\n  },\n  props: {\n    initInfo: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    },\n    isEdit: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    return {\n      courses: ['', '团体课', '私教课', '团体课和私教课'],\n      form,\n      isFreeze: false,\n      FORMAT_DATE: 'YYYY-MM-DD',\n      isTransfer: false,\n      courseSetting: {},\n      useRange: 3,\n      isReset: true,\n      resetPrice: true,\n      cardBgValidatorText: '',\n      courseValidatorText: '',\n      useShopIds: [],\n      validTime: {\n        min: 0,\n        max: 999\n      },\n      image: {\n        image_id: 0,\n        image_key: this.cardBgList$[0].image_key,\n        image_url: '',\n        index: 1\n      },\n      personalCourse: [],\n      teamCourse: [],\n      saleRange: 3,\n      saleShopIds: [],\n      autosize: { minRows: 4, maxRow: 20 },\n      unLimited: false,\n      courseName: '我是课程包',\n      packageAttr: 1\n    }\n  },\n  components: {\n    BizCardBgRadio,\n    BuyTimeFormItem,\n    TransferSettingFormItem,\n    ReserveIsLimitFormItem,\n    ReserveCourseSpeciesFormItem,\n    FreezeSettingFormItem,\n    SlodPriceSettingFormItem,\n    BizAssignShop,\n    StEditor,\n    ReserveCourse\n  },\n  methods: {\n    resetCourse() {\n      let useShopList = this.form.getFieldValue('use_shop_list')\n      if (\n        intersection(this.useShopIds, useShopList).length ===\n        this.useShopIds.length\n      )\n        return\n      if (!this.personalCourse.length && !this.teamCourse.length) return\n\n      this.isReset = false\n      let timer = setTimeout(() => {\n        this.teamCourse = []\n        this.personalCourse = []\n        this.isReset = !this.isReset\n      }, 16)\n    },\n    onChangeValidTimeUnit(value) {\n      if (value === 3) {\n        this.validTime = {\n          min: 1,\n          max: 50\n        }\n      }\n    },\n    onChangePersonalCourse(course) {\n      this.courseValidatorText = ''\n      this.personalCourse = course\n    },\n    onChangeTeamCourse(course) {\n      this.courseValidatorText = ''\n      this.teamCourse = course\n    },\n    onChangeUseRange(value, shopIds) {\n      this.resetCourse()\n      this.useRange = value\n      this.useShopIds = shopIds\n    },\n    onChangeSaleRange(value) {\n      this.saleRange = value\n    },\n    onCardBgChange() {\n      this.cardBgValidatorText = ''\n    },\n    // 卡背景校验\n    cardBgValidator() {\n      let validata = this.image.image_key !== ''\n      this.cardBgValidatorText = validata ? '' : '请上传卡背景'\n    },\n    // 课程自定义校验\n    courseValidator() {\n      let validata = true\n      let course = [...this.personalCourse, ...this.teamCourse]\n      course.forEach(item => {\n        validata =\n          (item.course_times && item.course_unit_price) || item.reduce_times\n      })\n      if (this.packageAttr === 2 && this.unLimited) {\n        validata = this.unLimited\n      }\n\n      this.courseValidatorText = validata ? '' : '请填写上课次数或者额度'\n    },\n    getShopIds(type) {\n      return (\n        (this.initInfo[`${type}_shop_list`] &&\n          this.initInfo[`${type}_shop_list`].map(item => item.shop_id)) ||\n        []\n      )\n    },\n    // 获取可约课程种类数据\n    onChangeReserveSpec(courseSetting) {\n      this.courseSetting = courseSetting\n    },\n    // 选择课程包类型，当选择不限次约课只能选择范围课程\n    onChangePackageType(event) {\n      this.unLimited = event.target.value === 0\n      // 当为不限次课程式，只允许是范围内课程 设置级联值和表单值\n      this.packageAttr = this.unLimited ? 2 : 1\n      this.form.setFieldsValue({ course_range: this.unLimited ? 2 : 1 })\n    },\n    /**\n     *  选择任意课程： 可约课程不可选。显示一行文本\n     */\n\n    onChangePackageAttr(event) {\n      this.packageAttr = event.target.value\n    },\n    formDataFormat(saveType) {\n      let {\n        useRange,\n        saleRange,\n        image,\n        courseSetting,\n        personalCourse,\n        teamCourse,\n        FORMAT_DATE\n      } = this\n      let form = {\n        image,\n        use_range: useRange,\n        sale_range: saleRange,\n        course_setting: courseSetting\n      }\n      if (personalCourse.length) {\n        let p = cloneDeep(personalCourse)\n        form.support_course_personal_range = p.map(item => {\n          item.coach_level_ids = item.coach_level_ids.map(ele =>\n            typeof ele === 'object' ? ele.id : ele\n          )\n          return item\n        })\n      }\n      if (teamCourse.length) {\n        form.support_course_team_range = teamCourse\n      }\n      this.form.getFieldValue('use_shop_list')\n      this.form.getFieldValue('sale_shop_list')\n      this.cardBgValidator()\n      this.courseValidator()\n      this.form.validate().then(values => {\n        if (!this.cardBgIsOk || !this.courseIsOk) return\n        let v = cloneDeep(values)\n        let { team_total_price = 0, personal_total_price = 0 } = v\n        v.price = v.price ? v.price : +team_total_price + +personal_total_price\n        v.reserve_is_limit = v.reserve_is_limit[0] || 0\n        v.is_allow_transfer = v.is_allow_transfer[0] || 0\n        v.is_allow_frozen = v.is_allow_frozen[0] || 0\n        if (v.sale_time && v.sale_time.length) {\n          v.start_time = moment(v.sale_time[0])\n            .format(FORMAT_DATE)\n            .valueOf()\n          v.end_time = moment(v.sale_time[1])\n            .format(FORMAT_DATE)\n            .valueOf()\n          delete v.sale_time\n        }\n        form = {\n          ...v,\n          ...form\n        }\n        this.$emit(saveType, form)\n      })\n    },\n    onSave() {\n      this.formDataFormat('save')\n    },\n    onSaveAndOnShelf() {\n      this.formDataFormat('shelf')\n    }\n  },\n  watch: {\n    courseSpec() {\n      this.resetPrice = false\n      let timer = setTimeout(() => {\n        this.resetPrice = true\n        clearTimeout(timer)\n      })\n    }\n  },\n  computed: {\n    ruleOptions() {\n      return ruleOptions\n    },\n    decorators() {\n      return this.form.decorators(this.ruleOptions)\n    },\n    // 约课种类\n    courseSpec() {\n      return this.courseSetting.spec\n    },\n    teamCourseList() {\n      return this.initInfo.support_course_team_range || []\n    },\n    personalCourseList() {\n      let courseList =\n        cloneDeep(this.initInfo.support_course_personal_range) || []\n      return courseList.map(item => {\n        item.coach_level_ids = item.coach_level_ids.map(ele => ele.id)\n        return item\n      })\n    },\n    coachList() {\n      return this.coachList$\n    },\n    // 卡背景是否校验通过\n    cardBgIsOk() {\n      return this.cardBgValidatorText === ''\n    },\n    courseIsOk() {\n      return this.courseValidatorText === ''\n    },\n    packageAttrOptions() {\n      return this.packageAttrOptions$.map(item => {\n        this.$set(item, 'disabled', this.unLimited && item.value !== 2)\n        return item\n      })\n    }\n  },\n  created() {\n    this.service.getCoachList().subscribe()\n  },\n  mounted() {\n    if (!this.isEdit) return\n    let {\n      course_range = 1,\n      use_range = 3,\n      sale_range = 3,\n      is_limit,\n      image\n    } = this.initInfo\n    // 编辑时，判断课程包是否限次\n    this.unLimited = is_limit === 0\n    // 编辑时判断是 范围 不限次 固定\n    this.packageAttr = course_range\n    this.saleRange = sale_range\n    this.useRange = use_range\n    this.useShopIds = this.getShopIds('use')\n    this.saleShopIds = this.getShopIds('sale')\n    this.image = image\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-components/package/form"}]}