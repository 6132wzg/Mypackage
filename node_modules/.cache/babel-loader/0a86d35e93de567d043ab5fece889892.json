{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/sold/cabinet/list.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/sold/cabinet/list.vue","mtime":1597053439398},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport { cloneDeep, filter } from 'lodash-es';\nimport { UserService } from '@/services/user.service';\nimport { ListService } from \"./list.service\";\nimport tableMixin from '@/mixins/table.mixin';\nimport { columns } from \"./list.config\";\nimport SoldDealGatheringTip from '@/views/biz-modals/sold/deal/gathering-tip';\nimport SoldDealGathering from '@/views/biz-modals/sold/deal/gathering';\nimport SoldLeaseRefund from '@/views/biz-modals/sold/lease/refund';\nimport SoldLeaseRelet from '@/views/biz-modals/sold/lease/relet';\nimport SoldLeaseTransfer from '@/views/biz-modals/sold/lease/transfer';\nimport useInternalNoteActions from '@/hooks/shop/sold-internal-note-actions.hook';\nexport default {\n  name: 'PageShopSoldLease',\n  mixins: [tableMixin],\n  bem: {\n    basic: 'page-shop-sold'\n  },\n  modals: {\n    SoldDealGatheringTip: SoldDealGatheringTip,\n    SoldDealGathering: SoldDealGathering,\n    SoldLeaseRefund: SoldLeaseRefund,\n    SoldLeaseRelet: SoldLeaseRelet,\n    SoldLeaseTransfer: SoldLeaseTransfer\n  },\n  serviceInject: function serviceInject() {\n    return {\n      userService: UserService,\n      listService: ListService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.listService.loading$,\n      cabinetStatus: this.listService.cabinetStatus$,\n      page: this.listService.page$,\n      list: this.listService.list$,\n      auth: this.listService.auth$\n    };\n  },\n  computed: {\n    columns: columns,\n    leaseList: function leaseList() {\n      var list = [{\n        value: -1,\n        label: '全部'\n      }];\n      if (!this.cabinetStatus.length) return list;\n      this.cabinetStatus.forEach(function (o) {\n        list.push({\n          value: +o.value,\n          label: o.label\n        });\n      });\n      return list;\n    }\n  },\n  hooks: function hooks() {\n    return {\n      internalNoteActions: useInternalNoteActions()\n    };\n  },\n  data: function data() {\n    return {\n      date: []\n    };\n  },\n  mounted: function mounted() {\n    this.setSearchData();\n  },\n  watch: {\n    query: function query(newVal) {\n      this.setSearchData();\n    }\n  },\n  methods: {\n    // 查询\n    onSearchNative: function onSearchNative() {\n      this.$searchQuery.start_time = this.date[0] ? \"\".concat(this.date[0].format('YYYY-MM-DD'), \" 00:00:00\") : '';\n      this.$searchQuery.end_time = this.date[1] ? \"\".concat(this.date[1].format('YYYY-MM-DD'), \" 23:59:59\") : '';\n      this.onSearch();\n    },\n    // 设置searchData\n    setSearchData: function setSearchData() {\n      var start = this.$searchQuery.start_time ? cloneDeep(moment(this.$searchQuery.start_time)) : null;\n      var end = this.$searchQuery.end_time ? cloneDeep(moment(this.$searchQuery.end_time)) : null;\n      this.date = [start, end];\n    },\n    // 跳转合同\n    toContract: function toContract(record) {\n      var order_id = record.order_id;\n      var url = \"\".concat(window.location.origin, \"/common/contract-preview?id=\").concat(order_id);\n      window.open(url);\n    },\n    // 查看订单\n    createdOrderViewOrder: function createdOrderViewOrder(order_id) {\n      console.log('查看订单');\n      this.$router.push({\n        name: 'shop-finance-order-info-collection-details',\n        query: {\n          id: order_id\n        }\n      });\n    },\n    // 续租\n    onRelet: function onRelet(record) {\n      var _this = this;\n\n      this.$modalRouter.push({\n        name: 'sold-lease-relet',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: function success(result) {\n            if (result.type === 'create') {\n              // 创建订单成功\n              _this.$modalRouter.push({\n                name: 'sold-deal-gathering-tip',\n                props: {\n                  order_id: result.order_id,\n                  type: 'cabinet_order',\n                  message: '订单创建成功',\n                  needPay: true\n                },\n                on: {\n                  success: function success(res) {\n                    _this.$router.reload();\n\n                    _this.tipCallBack(res.orderId, 'cabinet_order', res.type);\n                  }\n                }\n              });\n            } else if (result.type === 'createPay') {\n              // 创建订单成功 并且到支付页面\n              _this.$modalRouter.push({\n                name: 'sold-deal-gathering',\n                props: {\n                  order_id: result.order_id,\n                  type: 'cabinet_order'\n                },\n                on: {\n                  success: function success() {\n                    _this.$modalRouter.push({\n                      name: 'sold-deal-gathering-tip',\n                      props: {\n                        orderId: result.order_id,\n                        type: 'cabinet_order',\n                        message: '收款成功'\n                      },\n                      on: {\n                        success: function success(res) {\n                          _this.$router.reload();\n\n                          _this.tipCallBack(result.order_id, 'cabinet_order', res.type);\n                        }\n                      }\n                    });\n                  }\n                }\n              });\n            }\n          }\n        }\n      });\n    },\n    // 订单收款modal\n    createdOrderPay: function createdOrderPay(props) {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this2.$modalRouter.push({\n          name: 'sold-deal-gathering',\n          props: props,\n          on: {\n            success: resolve\n          }\n        });\n      });\n    },\n    // 订单收款回调\n    payCallBack: function payCallBack(orderId, modalType, callBackType) {\n      var _this3 = this;\n\n      switch (callBackType) {\n        case 'cancel':\n          this.onSearch();\n          break;\n\n        case 'pay':\n          this.createdGatheringTip({\n            message: '收款成功',\n            order_id: orderId\n          }).then(function (res) {\n            _this3.tipCallBack(orderId, modalType, res.type);\n          });\n          break;\n      }\n    },\n    // 提示框回调，gathering-tip\n    tipCallBack: function tipCallBack(orderId, modalType, callBackType) {\n      var _this4 = this;\n\n      switch (callBackType) {\n        case 'cancel':\n          this.$router.reload();\n          break;\n\n        case 'Print':\n          this.toContract({\n            order_id: orderId\n          });\n          break;\n\n        case 'PrintOrder':\n          this.printOrder(orderId);\n          break;\n\n        case 'ViewOrder':\n          this.createdOrderViewOrder(orderId);\n          break;\n\n        case 'Pay':\n          this.createdOrderPay({\n            order_id: orderId,\n            type: modalType\n          }).then(function (res) {\n            _this4.payCallBack(orderId, modalType, res.type);\n          });\n          break;\n      }\n    },\n    // 打印小票\n    printOrder: function printOrder(order_id) {\n      window.open('/ticket/gathering-print?id=' + order_id, '_blank', 'width=800,height=600');\n    },\n    // 转让\n    onTransfer: function onTransfer(record) {\n      var _this5 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-lease-transfer',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: function success(result) {\n            _this5.$router.reload();\n          }\n        }\n      });\n    },\n    // 退款\n    onRefund: function onRefund(record) {\n      var _this6 = this;\n\n      this.$modalRouter.push({\n        name: 'sold-lease-refund',\n        props: {\n          id: record.id\n        },\n        on: {\n          success: function success(result) {\n            _this6.$router.reload();\n          }\n        }\n      });\n    }\n  }\n};",null]}