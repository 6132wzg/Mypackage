{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/card/deposit/edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/product/card/deposit/edit.vue","mtime":1600926556154},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport { PatternService } from '@/services/pattern.service';\nimport SelectShop from '@/views/fragments/shop/select-shop';\nimport { cloneDeep, remove } from 'lodash-es';\nimport { EditService } from \"./edit.service\";\nimport { AppConfig } from '@/constants/config';\nimport { MessageService } from '@/services/message.service';\nimport MemberCard from '@/views/biz-components/h5/pages/member-card';\nimport H5Container from '@/views/biz-components/h5/h5-container';\nimport h5mixin from \"../member/period/h5mixin\";\nimport { MEMBER_CARD } from '@/views/biz-components/h5/pages/member-card.config';\nimport CardBgRadio from '@/views/biz-components/card-bg-radio/card-bg-radio';\nimport { CONSUMPTION_RANGE, SUPPORT_SALES, UNIT, SELL_TYPE, TRANSFER_UNIT } from '@/constants/card/deposit';\nimport { ruleOptions } from \"./deposit.config\";\nimport StEditor from '@/views/components/editor#/editor.vue';\nexport default {\n  name: 'BrandDepositCardEdit',\n  mixins: [h5mixin],\n  serviceInject: function serviceInject() {\n    return {\n      pattern: PatternService,\n      addService: EditService,\n      appConfig: AppConfig,\n      messageService: MessageService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      addLoading: this.addService.loading$,\n      cardInfo: this.addService.cardInfo$,\n      cardBgList: this.addService.cardBgList$,\n      unit: this.addService.unit$,\n      consumerType: this.addService.consumerType$,\n      consumptionRange: this.addService.consumptionRange$,\n      transferUnit: this.addService.transferUnit$,\n      supportSales: this.addService.supportSales$,\n      sellType: this.addService.sellType$\n    };\n  },\n  bem: {\n    b: 'st-help-popover'\n  },\n  components: {\n    StEditor: StEditor,\n    SelectShop: SelectShop,\n    MemberCard: MemberCard,\n    H5Container: H5Container,\n    CardBgRadio: CardBgRadio\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      // cardData\n      form: form,\n      decorators: decorators,\n      CONSUMPTION_RANGE: CONSUMPTION_RANGE,\n      SUPPORT_SALES: SUPPORT_SALES,\n      UNIT: UNIT,\n      SELL_TYPE: SELL_TYPE,\n      TRANSFER_UNIT: TRANSFER_UNIT,\n      cardType: MEMBER_CARD.DEPOSIT_CARD,\n      MEMBER_CARD: MEMBER_CARD,\n      cardData: {\n        // 卡id\n        card_id: null,\n        // 会员卡名称\n        card_name: '',\n        // 特殊说明\n        special_note: '',\n        // 储值金额\n        card_price: null,\n        // 售卖价格\n        sell_price: null,\n        // 期限\n        num: null,\n        // 期限单位\n        unit: UNIT.DAY,\n        // 消费类目\n        card_consumer_id: [],\n        // 支持入场范围 1-单店 2-多店 3-全店\n        consumption_range: CONSUMPTION_RANGE.ONLY_STORE,\n        // 支持入场门店\n        consumer_shop_list: [],\n        // 支持售卖场馆类型 1-全部门店 2-指定门店\n        support_sales: SUPPORT_SALES.ALL_STORE,\n        // 支持售卖门店\n        sell_shop_list: [],\n        // 支持售卖时间\n        start_time: '',\n        end_time: '',\n        // 结束时间面板是否显示\n        endOpen: false,\n        // 卡背景\n        bg_image: {\n          image_id: 0,\n          image_key: this.cardBgList[0].image_key,\n          image_url: '',\n          index: 1\n        },\n        // 是否配置了用户端\n        appConfig: true,\n        // 卡介绍\n        card_contents: '',\n        // 备注\n        description: '',\n        // 是否支持转让\n        _is_transfer: false,\n        is_transfer: 0,\n        // 转让单位\n        transfer_unit: TRANSFER_UNIT.RMB,\n        // 转让手续费\n        transfer_num: 0,\n        // 售卖方式\n        card_sell_type: [SELL_TYPE.OFFLINE]\n      },\n      // 卡背景的help文本\n      cardBgValidatorText: '',\n      transfer_unit_is_first: true,\n      // 售卖时间\n      start_time: null,\n      end_time: null,\n      // 是否禁止选择开始时间,如果卡状态是可售卖，则需要禁止修改开始时间\n      startTimeIsDisabled: false\n    };\n  },\n  mounted: function mounted() {\n    this.init();\n  },\n  methods: {\n    init: function init() {\n      this.form.setFieldsValue({\n        'cardData.special_note': this.cardInfo.special_note,\n        'cardData.card_price': this.cardInfo.card_price,\n        'cardData.sell_price': this.cardInfo.sell_price,\n        'cardData.num': this.cardInfo.num,\n        'cardData.card_consumer_id': this.cardInfo.card_consumer_id,\n        'cardData.consumption_range': this.cardInfo.consumption_range,\n        'cardData.support_sales': this.cardInfo.support_sales,\n        start_time: moment(this.cardInfo.start_time),\n        end_time: moment(this.cardInfo.end_time),\n        'cardData.transfer_num': this.cardInfo.transfer_num\n      }); // 储值金额\n\n      this.cardData.card_price = this.cardInfo.card_price; // 售卖价格\n\n      this.cardData.sell_price = this.cardInfo.sell_price; // 期限\n\n      this.cardData.num = this.cardInfo.num;\n      this.cardData.unit = this.cardInfo.unit; // 消费类目\n\n      this.cardData.card_consumer_id = this.cardInfo.card_consumer_id; // 消费门店\n\n      this.cardData.consumption_range = this.cardInfo.consumption_range;\n      this.cardData.consumer_shop_list = this.cardInfo.consumer_shop_list; // 售卖门店\n\n      this.cardData.support_sales = this.cardInfo.support_sales;\n      this.cardData.sell_shop_list = this.cardData.support_sales === this.SUPPORT_SALES.SPECIFIED_STORE ? cloneDeep(this.cardInfo.sell_shop_list) : []; // 支持售卖时间\n\n      this.start_time = moment(this.cardInfo.start_time);\n      this.end_time = moment(this.cardInfo.end_time);\n      this.startTimeIsDisabled = moment(this.cardInfo.start_time).valueOf() < moment().startOf('day').valueOf() && moment(this.cardInfo.end_time).valueOf() > moment().valueOf(); // 转让设置\n\n      this.cardData._is_transfer = !!this.cardInfo.is_transfer;\n      this.cardData.transfer_unit = this.cardInfo.transfer_unit;\n      this.cardData.transfer_num = this.cardInfo.transfer_num; // 售卖方式\n\n      this.cardData.card_sell_type = this.cardInfo.card_sell_type; // 卡背景\n\n      this.cardData.bg_image = cloneDeep(this.cardInfo.bg_image); // 卡介绍\n\n      this.cardData.card_contents = this.cardInfo.card_contents; // 卡备注\n\n      this.cardData.description = this.cardInfo.description;\n      this.initH5CardInfo();\n      this.syncAdmissionShop();\n    },\n    // 保存\n    onHandleSubmit: function onHandleSubmit(e) {\n      var _this = this;\n\n      e.preventDefault(); // 校验卡背景\n\n      this.cardBgValidator();\n      this.form.validate().then(function (values) {\n        if (_this.cardBgIsOk) {\n          // 卡名称\n          _this.cardData.card_name = values.cardData.card_name; // 特殊说明\n\n          _this.cardData.special_note = values.cardData.special_note; // 储值金额\n\n          _this.cardData.card_price = values.cardData.card_price; // 售卖价格\n\n          _this.cardData.sell_price = values.cardData.sell_price; // 期限\n\n          _this.cardData.num = values.cardData.num; // 消费类目\n\n          _this.cardData.card_consumer_id = cloneDeep(values.cardData.card_consumer_id); // 消费门店\n\n          if (_this.cardData.consumption_range !== _this.CONSUMPTION_RANGE.GENERAL_STORE) {\n            // 不是多门店\n            _this.cardData.consumer_shop_list = [];\n          } // 售卖门店\n\n\n          if (_this.cardData.support_sales !== _this.SUPPORT_SALES.SPECIFIED_STORE) {\n            // 不是多门店\n            _this.cardData.sell_shop_list = [];\n          } // 售卖门店\n\n\n          if (_this.cardData.consumption_range === _this.CONSUMPTION_RANGE.GENERAL_STORE && _this.cardData.support_sales === _this.SUPPORT_SALES.CONSUMER_STORE) {\n            // 多门店 && 支持入场门店\n            _this.cardData.sell_shop_list = cloneDeep(_this.cardData.consumer_shop_list);\n          } // 时间\n\n\n          var dateFormat = _this.appConfig.DATE_FORMAT.date;\n          _this.cardData.start_time = moment(_this.start_time).format(dateFormat);\n          _this.cardData.end_time = moment(_this.end_time).format(dateFormat); // 卡id\n\n          _this.cardData.card_id = +_this.$searchQuery.id;\n\n          _this.addService.editCard(_this.cardData).subscribe(_this.onSubmitSuccess);\n        }\n      });\n    },\n    onSubmitSuccess: function onSubmitSuccess() {\n      this.messageService.success({\n        content: '修改成功'\n      });\n      this.$router.push({\n        name: 'brand-product-card-deposit-list-all'\n      });\n    },\n    // 增加入场门店\n    admission_range_change: function admission_range_change(data) {\n      this.cardData.consumer_shop_list = cloneDeep(data);\n      this.syncAdmissionShop();\n    },\n    // 入场门店支持方式change\n    consumption_range: function consumption_range(data) {\n      this.cardData.consumption_range = data.target.value; // 入场门店变化时，售卖门店同时变化\n\n      this.form.setFieldsValue({\n        'cardData.support_sales': SUPPORT_SALES.ALL_STORE\n      });\n      this.cardData.support_sales = SUPPORT_SALES.ALL_STORE;\n      this.syncAdmission();\n    },\n    // 支持售卖门店change\n    support_range: function support_range(data) {\n      this.cardData.support_sales = data.target.value;\n    },\n    // 增加售卖门店\n    sales_shop_change: function sales_shop_change(data) {\n      this.cardData.sell_shop_list = cloneDeep(data);\n    },\n    // 售卖时间-start\n    disabledStartDate: function disabledStartDate(startValue) {\n      var endValue = this.end_time;\n\n      if (!endValue) {\n        // 结束时间未选择\n        return startValue.valueOf() < moment().startOf('day').valueOf();\n      }\n\n      var start = endValue.valueOf() > moment().add(30, 'y').valueOf() ? moment(endValue).subtract(30, 'y').valueOf() : moment().startOf('day').valueOf();\n      return startValue.valueOf() < start || startValue.valueOf() > moment(endValue).valueOf();\n    },\n    start_time_change: function start_time_change(data) {\n      this.start_time = cloneDeep(data);\n    },\n    handleStartOpenChange: function handleStartOpenChange(open) {\n      if (!open) {\n        this.cardData.endOpen = true;\n      }\n    },\n    // 售卖时间-end\n    end_time_change: function end_time_change(data) {\n      this.end_time = cloneDeep(data);\n    },\n    handleEndOpenChange: function handleEndOpenChange(open) {\n      this.cardData.endOpen = open;\n    },\n    disabledEndDate: function disabledEndDate(endValue) {\n      var startValue = this.start_time;\n\n      if (!startValue) {\n        // 开始时间未选择\n        return endValue.valueOf() < moment().startOf('day').valueOf();\n      }\n\n      return endValue.valueOf() >= moment(startValue).add(30, 'y').valueOf() || endValue.valueOf() < moment(startValue).valueOf() || endValue.valueOf() < moment().startOf('day').valueOf();\n    },\n    // moment\n    moment: moment,\n    // 转让\n    transfer: function transfer(e) {\n      this.cardData._is_transfer = e.target.checked; // 重置转让费用的校验\n\n      this.form.resetFields(['cardData.transfer_num']);\n    },\n    transfter_change: function transfter_change(data) {\n      this.cardData.transfer_num = data;\n    },\n    onCardBgChange: function onCardBgChange(e) {\n      this.cardBgValidatorText = '';\n    },\n    // 卡背景校验\n    cardBgValidator: function cardBgValidator() {\n      var validata = this.cardData.bg_image.image_key !== '';\n      this.cardBgValidatorText = validata ? '' : '请上传卡背景';\n    }\n  },\n  watch: {\n    'cardData._is_transfer': {\n      deep: true,\n      handler: function handler(newVal, oldVal) {\n        this.cardData.is_transfer = +newVal;\n      }\n    },\n    'cardData.transfer_unit': {\n      deep: true,\n      handler: function handler() {\n        if (!this.transfer_unit_is_first) {\n          this.form.resetFields(['cardData.transfer_num']);\n        }\n\n        this.transfer_unit_is_first = false;\n      }\n    },\n    'cardData.consumer_shop_list': {\n      deep: true,\n      handler: function handler() {\n        var v = this.cardData.consumption_range;\n        this.cardData.consumption_range = v;\n        this.form.setFieldsValue({\n          'cardData.consumption_range': v\n        });\n      }\n    },\n    'cardData.sell_shop_list': {\n      deep: true,\n      handler: function handler() {\n        var v = this.cardData.support_sales;\n        this.cardData.support_sales = v;\n        this.form.setFieldsValue({\n          'cardData.support_sales': v\n        });\n      }\n    }\n  },\n  computed: {\n    // 支持售卖门店\n    support_sales_list: function support_sales_list() {\n      var arr = cloneDeep(this.supportSales);\n      var index = this.cardData.consumption_range === this.CONSUMPTION_RANGE.GENERAL_STORE ? 999 : 2;\n      arr.splice(index, 1);\n      return arr;\n    },\n    // 售卖方式\n    sell_type_list: function sell_type_list() {\n      var sell_type = cloneDeep(this.sellType);\n      var arr = [];\n      sell_type.forEach(function (i) {\n        arr.push({\n          value: i.value,\n          label: i.label\n        });\n      });\n\n      if (!this.cardData.appConfig) {\n        remove(arr, function (i) {\n          return i.value === SELL_TYPE.CLIENT;\n        });\n      }\n\n      return arr;\n    },\n    // 卡背景是否校验通过\n    cardBgIsOk: function cardBgIsOk() {\n      return this.cardBgValidatorText === '';\n    },\n    // 转让设置的min\n    transferMin: function transferMin() {\n      return 0;\n    },\n    // 转让设置的max\n    transferMax: function transferMax() {\n      return this.cardData.transfer_unit === TRANSFER_UNIT.PERCENT ? 100 : 999999.9;\n    }\n  }\n};",{"version":3,"sources":["edit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-mina-panel class=\"page-brand-basic-card page-brand-edit-deposit-card\">\n    <h5-container slot=\"preview\" fixed>\n      <template v-slot:title>\n        购卡\n      </template>\n      <template v-slot:default>\n        <member-card\n          :data=\"h5CardInfo\"\n          :cardType=\"MEMBER_CARD.DEPOSIT_CARD\"\n        ></member-card>\n      </template>\n    </h5-container>\n\n    <div slot=\"actions\">\n      <st-button\n        :loading=\"addLoading.editCard\"\n        type=\"primary\"\n        @click=\"onHandleSubmit\"\n      >\n        保 存\n      </st-button>\n    </div>\n\n    <div class=\"page-content\">\n      <st-form :form=\"form\" labelWidth=\"118px\">\n        <a-row :gutter=\"8\" class=\"page-content-card-line__row\">\n          <a-col :lg=\"22\">\n            <p class=\"page-content-card__card__name\">\n              <st-tag type=\"deposit-card\" />\n              <span>{{ cardInfo.card_name }}</span>\n            </p>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"22\">\n            <st-form-item class=\"page-content-card-line\" label=\"特别说明\">\n              <a-input\n                class=\"page-content-card-input\"\n                v-decorator=\"decorators.cardData.special_note\"\n                maxlength=\"20\"\n                placeholder=\"最多显示20个字符\"\n                @change=\"syncSpecialNote\"\n              ></a-input>\n            </st-form-item>\n            <st-form-item label=\"储值金额\" required>\n              <st-input-number\n                :float=\"true\"\n                :min=\"1\"\n                :max=\"9999999.9\"\n                v-decorator=\"decorators.cardData.card_price\"\n                class=\"page-content-card-input\"\n                placeholder=\"请输入储值金额\"\n                @change=\"syncDepositPrice\"\n              >\n                <span slot=\"addonAfter\">元</span>\n              </st-input-number>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"22\">\n            <st-form-item label=\"售卖价格\" required>\n              <st-input-number\n                :float=\"true\"\n                :min=\"0\"\n                :max=\"9999999.9\"\n                v-decorator=\"decorators.cardData.sell_price\"\n                class=\"page-content-card-input\"\n                placeholder=\"请输入售卖价格\"\n              >\n                <span slot=\"addonAfter\">元</span>\n              </st-input-number>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"22\">\n            <st-form-item label=\"期限\" required>\n              <st-input-number\n                :min=\"1\"\n                :max=\"99999\"\n                v-decorator=\"decorators.cardData.num\"\n                class=\"page-content-card-input\"\n                placeholder=\"请输入期限\"\n                @change=\"syncDeadlineNum\"\n              >\n                <a-select\n                  v-model=\"cardData.unit\"\n                  slot=\"addonAfter\"\n                  class=\"page-content-card-small-select\"\n                >\n                  <a-select-option\n                    v-for=\"(item, index) in unit\"\n                    :value=\"item.value\"\n                    :key=\"index\"\n                  >\n                    {{ item.label }}\n                  </a-select-option>\n                </a-select>\n              </st-input-number>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"22\">\n            <st-form-item label=\"支持消费类目\" required>\n              <a-checkbox-group\n                v-decorator=\"decorators.cardData.card_consumer_id\"\n                @change=\"syncConsumer\"\n              >\n                <a-checkbox\n                  v-for=\"item in consumerType\"\n                  :key=\"item.value\"\n                  :value=\"item.value\"\n                >\n                  {{ item.label }}\n                </a-checkbox>\n              </a-checkbox-group>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"23\">\n            <st-form-item\n              class=\"page-content-card-admission-range\"\n              label=\"支持消费门店\"\n              required\n            >\n              <a-radio-group\n                @change=\"consumption_range\"\n                v-decorator=\"decorators.cardData.consumption_range\"\n              >\n                <a-radio\n                  v-for=\"item in consumptionRange\"\n                  :key=\"item.value\"\n                  :value=\"item.value\"\n                >\n                  {{ item.label }}\n                </a-radio>\n              </a-radio-group>\n              <div\n                class=\"page-admission-range-shop\"\n                v-if=\"\n                  cardData.consumption_range === CONSUMPTION_RANGE.GENERAL_STORE\n                \"\n              >\n                <p class=\"page-admission-range-shop__describe\">\n                  设置支持此{{ $c('member_card') }}出入场馆范围\n                </p>\n                <select-shop\n                  :shopIds=\"cardData.consumer_shop_list\"\n                  @change=\"admission_range_change\"\n                ></select-shop>\n              </div>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"23\">\n            <st-form-item\n              class=\"page-content-card-support-sales\"\n              label=\"支持售卖门店\"\n              required\n            >\n              <a-radio-group\n                @change=\"support_range\"\n                v-decorator=\"decorators.cardData.support_sales\"\n              >\n                <a-radio\n                  v-for=\"item in support_sales_list\"\n                  :key=\"item.value\"\n                  :value=\"item.value\"\n                >\n                  {{ item.label }}\n                </a-radio>\n              </a-radio-group>\n              <div\n                class=\"page-support-sales-shop\"\n                :class=\"{\n                  'page-lot-shop':\n                    cardData.consumption_range ===\n                    CONSUMPTION_RANGE.GENERAL_STORE\n                }\"\n                v-if=\"cardData.support_sales === SUPPORT_SALES.SPECIFIED_STORE\"\n              >\n                <p class=\"page-support-sales-shop__describe\">\n                  设置支持此{{ $c('member_card') }}售卖场馆范围\n                </p>\n                <select-shop\n                  :shopIds=\"cardData.sell_shop_list\"\n                  @change=\"sales_shop_change\"\n                ></select-shop>\n              </div>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"20\">\n            <st-form-item class=\"page-content-card-time mg-b0\" required>\n              <span slot=\"label\">\n                支持售卖时间\n                <a-popover\n                  trigger=\"hover\"\n                  placement=\"bottomRight\"\n                  arrowPointAtCenter\n                >\n                  <div slot=\"content\">\n                    设置此{{ $c('member_card') }}可售卖的时间范围\n                  </div>\n                  <a-icon\n                    class=\"page-content-card-time__icon\"\n                    type=\"info-circle\"\n                  ></a-icon>\n                </a-popover>\n              </span>\n              <a-form-item class=\"page-a-form\">\n                <a-date-picker\n                  :disabled=\"startTimeIsDisabled\"\n                  :disabledDate=\"disabledStartDate\"\n                  v-decorator=\"decorators.start_time\"\n                  format=\"YYYY-MM-DD\"\n                  placeholder=\"开始时间\"\n                  :showToday=\"false\"\n                  @openChange=\"handleStartOpenChange\"\n                  @change=\"start_time_change\"\n                />\n              </a-form-item>\n              ~\n              <a-form-item class=\"page-a-form\">\n                <a-date-picker\n                  :disabledDate=\"disabledEndDate\"\n                  v-decorator=\"decorators.end_time\"\n                  format=\"YYYY-MM-DD\"\n                  placeholder=\"结束时间\"\n                  :showToday=\"false\"\n                  :open=\"cardData.endOpen\"\n                  @openChange=\"handleEndOpenChange\"\n                  @change=\"end_time_change\"\n                />\n              </a-form-item>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"20\">\n            <st-form-item class=\"page-content-card-transfer\" label=\"转让设置\">\n              <div class=\"page-content-card-transfer-body\">\n                <a-checkbox\n                  class=\"page-checkbox\"\n                  :checked=\"cardData._is_transfer\"\n                  @change=\"transfer\"\n                >\n                  支持转让\n                </a-checkbox>\n                <st-input-number\n                  class=\"page-content-card-num-input page-input-group\"\n                  v-decorator=\"decorators.cardData.transfer_num\"\n                  :float=\"cardData.transfer_unit === TRANSFER_UNIT.RMB\"\n                  @change=\"transfter_change\"\n                  :disabled=\"!cardData._is_transfer\"\n                  :min=\"transferMin\"\n                  :max=\"transferMax\"\n                >\n                  <a-select\n                    slot=\"addonAfter\"\n                    v-model=\"cardData.transfer_unit\"\n                    :disabled=\"!cardData._is_transfer\"\n                  >\n                    <a-select-option\n                      v-for=\"item in transferUnit\"\n                      :key=\"item.value\"\n                      :value=\"item.value\"\n                    >\n                      {{ item.label }}\n                    </a-select-option>\n                  </a-select>\n                </st-input-number>\n              </div>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"20\">\n            <st-form-item\n              class=\"page-content-card-sell-type\"\n              label=\"售卖方式\"\n              required\n            >\n              <a-checkbox-group v-model=\"cardData.card_sell_type\">\n                <a-checkbox\n                  v-for=\"item in sell_type_list\"\n                  :key=\"item.value\"\n                  :disabled=\"item.value === SELL_TYPE.OFFLINE\"\n                  :value=\"item.value\"\n                >\n                  {{ item.label }}\n                </a-checkbox>\n              </a-checkbox-group>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"20\">\n            <st-form-item\n              class=\"page-content-card-bg\"\n              label=\"卡背景\"\n              required\n              :help=\"cardBgValidatorText\"\n            >\n              <card-bg-radio\n                @change=\"onCardBgChange\"\n                v-model=\"cardData.bg_image\"\n              />\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"22\">\n            <st-form-item\n              class=\"page-content-card-introduction mg-t4\"\n              label=\"储值卡介绍\"\n            >\n              <st-editor v-model=\"cardData.card_contents\"></st-editor>\n            </st-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"8\">\n          <a-col :lg=\"22\">\n            <st-form-item\n              class=\"page-content-card-contents mg-t4\"\n              label=\"内部备注\"\n            >\n              <st-textarea\n                v-model=\"cardData.description\"\n                maxlength=\"500\"\n                class=\"page-content-card-textarea\"\n                placeholder=\"请输入\"\n              />\n            </st-form-item>\n          </a-col>\n        </a-row>\n      </st-form>\n    </div>\n  </st-mina-panel>\n</template>\n<script>\nimport moment from 'moment'\nimport { PatternService } from '@/services/pattern.service'\nimport SelectShop from '@/views/fragments/shop/select-shop'\nimport { cloneDeep, remove } from 'lodash-es'\nimport { EditService } from './edit.service'\nimport { AppConfig } from '@/constants/config'\nimport { MessageService } from '@/services/message.service'\nimport MemberCard from '@/views/biz-components/h5/pages/member-card'\nimport H5Container from '@/views/biz-components/h5/h5-container'\nimport h5mixin from '../member/period/h5mixin'\nimport { MEMBER_CARD } from '@/views/biz-components/h5/pages/member-card.config'\nimport CardBgRadio from '@/views/biz-components/card-bg-radio/card-bg-radio'\nimport {\n  CONSUMPTION_RANGE,\n  SUPPORT_SALES,\n  UNIT,\n  SELL_TYPE,\n  TRANSFER_UNIT\n} from '@/constants/card/deposit'\nimport { ruleOptions } from './deposit.config'\nimport StEditor from '@/views/components/editor#/editor.vue'\nexport default {\n  name: 'BrandDepositCardEdit',\n  mixins: [h5mixin],\n  serviceInject() {\n    return {\n      pattern: PatternService,\n      addService: EditService,\n      appConfig: AppConfig,\n      messageService: MessageService\n    }\n  },\n  rxState() {\n    return {\n      addLoading: this.addService.loading$,\n      cardInfo: this.addService.cardInfo$,\n      cardBgList: this.addService.cardBgList$,\n      unit: this.addService.unit$,\n      consumerType: this.addService.consumerType$,\n      consumptionRange: this.addService.consumptionRange$,\n      transferUnit: this.addService.transferUnit$,\n      supportSales: this.addService.supportSales$,\n      sellType: this.addService.sellType$\n    }\n  },\n  bem: {\n    b: 'st-help-popover'\n  },\n  components: {\n    StEditor,\n    SelectShop,\n    MemberCard,\n    H5Container,\n    CardBgRadio\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      // cardData\n      form,\n      decorators,\n      CONSUMPTION_RANGE,\n      SUPPORT_SALES,\n      UNIT: UNIT,\n      SELL_TYPE,\n      TRANSFER_UNIT,\n      cardType: MEMBER_CARD.DEPOSIT_CARD,\n      MEMBER_CARD,\n      cardData: {\n        // 卡id\n        card_id: null,\n        // 会员卡名称\n        card_name: '',\n        // 特殊说明\n        special_note: '',\n        // 储值金额\n        card_price: null,\n        // 售卖价格\n        sell_price: null,\n        // 期限\n        num: null,\n        // 期限单位\n        unit: UNIT.DAY,\n        // 消费类目\n        card_consumer_id: [],\n        // 支持入场范围 1-单店 2-多店 3-全店\n        consumption_range: CONSUMPTION_RANGE.ONLY_STORE,\n        // 支持入场门店\n        consumer_shop_list: [],\n        // 支持售卖场馆类型 1-全部门店 2-指定门店\n        support_sales: SUPPORT_SALES.ALL_STORE,\n        // 支持售卖门店\n        sell_shop_list: [],\n        // 支持售卖时间\n        start_time: '',\n        end_time: '',\n        // 结束时间面板是否显示\n        endOpen: false,\n        // 卡背景\n        bg_image: {\n          image_id: 0,\n          image_key: this.cardBgList[0].image_key,\n          image_url: '',\n          index: 1\n        },\n        // 是否配置了用户端\n        appConfig: true,\n        // 卡介绍\n        card_contents: '',\n        // 备注\n        description: '',\n        // 是否支持转让\n        _is_transfer: false,\n        is_transfer: 0,\n        // 转让单位\n        transfer_unit: TRANSFER_UNIT.RMB,\n        // 转让手续费\n        transfer_num: 0,\n        // 售卖方式\n        card_sell_type: [SELL_TYPE.OFFLINE]\n      },\n      // 卡背景的help文本\n      cardBgValidatorText: '',\n      transfer_unit_is_first: true,\n      // 售卖时间\n      start_time: null,\n      end_time: null,\n      // 是否禁止选择开始时间,如果卡状态是可售卖，则需要禁止修改开始时间\n      startTimeIsDisabled: false\n    }\n  },\n  mounted() {\n    this.init()\n  },\n  methods: {\n    init() {\n      this.form.setFieldsValue({\n        'cardData.special_note': this.cardInfo.special_note,\n        'cardData.card_price': this.cardInfo.card_price,\n        'cardData.sell_price': this.cardInfo.sell_price,\n        'cardData.num': this.cardInfo.num,\n        'cardData.card_consumer_id': this.cardInfo.card_consumer_id,\n        'cardData.consumption_range': this.cardInfo.consumption_range,\n        'cardData.support_sales': this.cardInfo.support_sales,\n        start_time: moment(this.cardInfo.start_time),\n        end_time: moment(this.cardInfo.end_time),\n        'cardData.transfer_num': this.cardInfo.transfer_num\n      })\n      // 储值金额\n      this.cardData.card_price = this.cardInfo.card_price\n      // 售卖价格\n      this.cardData.sell_price = this.cardInfo.sell_price\n      // 期限\n      this.cardData.num = this.cardInfo.num\n      this.cardData.unit = this.cardInfo.unit\n      // 消费类目\n      this.cardData.card_consumer_id = this.cardInfo.card_consumer_id\n      // 消费门店\n      this.cardData.consumption_range = this.cardInfo.consumption_range\n      this.cardData.consumer_shop_list = this.cardInfo.consumer_shop_list\n      // 售卖门店\n      this.cardData.support_sales = this.cardInfo.support_sales\n      this.cardData.sell_shop_list =\n        this.cardData.support_sales === this.SUPPORT_SALES.SPECIFIED_STORE\n          ? cloneDeep(this.cardInfo.sell_shop_list)\n          : []\n      // 支持售卖时间\n      this.start_time = moment(this.cardInfo.start_time)\n      this.end_time = moment(this.cardInfo.end_time)\n      this.startTimeIsDisabled =\n        moment(this.cardInfo.start_time).valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf() &&\n        moment(this.cardInfo.end_time).valueOf() > moment().valueOf()\n      // 转让设置\n      this.cardData._is_transfer = !!this.cardInfo.is_transfer\n      this.cardData.transfer_unit = this.cardInfo.transfer_unit\n      this.cardData.transfer_num = this.cardInfo.transfer_num\n      // 售卖方式\n      this.cardData.card_sell_type = this.cardInfo.card_sell_type\n      // 卡背景\n      this.cardData.bg_image = cloneDeep(this.cardInfo.bg_image)\n      // 卡介绍\n      this.cardData.card_contents = this.cardInfo.card_contents\n      // 卡备注\n      this.cardData.description = this.cardInfo.description\n      this.initH5CardInfo()\n      this.syncAdmissionShop()\n    },\n    // 保存\n    onHandleSubmit(e) {\n      e.preventDefault()\n      // 校验卡背景\n      this.cardBgValidator()\n      this.form.validate().then(values => {\n        if (this.cardBgIsOk) {\n          // 卡名称\n          this.cardData.card_name = values.cardData.card_name\n          // 特殊说明\n          this.cardData.special_note = values.cardData.special_note\n          // 储值金额\n          this.cardData.card_price = values.cardData.card_price\n          // 售卖价格\n          this.cardData.sell_price = values.cardData.sell_price\n          // 期限\n          this.cardData.num = values.cardData.num\n          // 消费类目\n          this.cardData.card_consumer_id = cloneDeep(\n            values.cardData.card_consumer_id\n          )\n          // 消费门店\n          if (\n            this.cardData.consumption_range !==\n            this.CONSUMPTION_RANGE.GENERAL_STORE\n          ) {\n            // 不是多门店\n            this.cardData.consumer_shop_list = []\n          }\n          // 售卖门店\n          if (\n            this.cardData.support_sales !== this.SUPPORT_SALES.SPECIFIED_STORE\n          ) {\n            // 不是多门店\n            this.cardData.sell_shop_list = []\n          }\n          // 售卖门店\n          if (\n            this.cardData.consumption_range ===\n              this.CONSUMPTION_RANGE.GENERAL_STORE &&\n            this.cardData.support_sales === this.SUPPORT_SALES.CONSUMER_STORE\n          ) {\n            // 多门店 && 支持入场门店\n            this.cardData.sell_shop_list = cloneDeep(\n              this.cardData.consumer_shop_list\n            )\n          }\n          // 时间\n          const dateFormat = this.appConfig.DATE_FORMAT.date\n          this.cardData.start_time = moment(this.start_time).format(dateFormat)\n          this.cardData.end_time = moment(this.end_time).format(dateFormat)\n          // 卡id\n          this.cardData.card_id = +this.$searchQuery.id\n          this.addService\n            .editCard(this.cardData)\n            .subscribe(this.onSubmitSuccess)\n        }\n      })\n    },\n    onSubmitSuccess() {\n      this.messageService.success({\n        content: '修改成功'\n      })\n      this.$router.push({\n        name: 'brand-product-card-deposit-list-all'\n      })\n    },\n    // 增加入场门店\n    admission_range_change(data) {\n      this.cardData.consumer_shop_list = cloneDeep(data)\n      this.syncAdmissionShop()\n    },\n    // 入场门店支持方式change\n    consumption_range(data) {\n      this.cardData.consumption_range = data.target.value\n      // 入场门店变化时，售卖门店同时变化\n      this.form.setFieldsValue({\n        'cardData.support_sales': SUPPORT_SALES.ALL_STORE\n      })\n      this.cardData.support_sales = SUPPORT_SALES.ALL_STORE\n      this.syncAdmission()\n    },\n    // 支持售卖门店change\n    support_range(data) {\n      this.cardData.support_sales = data.target.value\n    },\n    // 增加售卖门店\n    sales_shop_change(data) {\n      this.cardData.sell_shop_list = cloneDeep(data)\n    },\n    // 售卖时间-start\n    disabledStartDate(startValue) {\n      const endValue = this.end_time\n      if (!endValue) {\n        // 结束时间未选择\n        return (\n          startValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n        )\n      }\n      let start =\n        endValue.valueOf() >\n        moment()\n          .add(30, 'y')\n          .valueOf()\n          ? moment(endValue)\n              .subtract(30, 'y')\n              .valueOf()\n          : moment()\n              .startOf('day')\n              .valueOf()\n      return (\n        startValue.valueOf() < start ||\n        startValue.valueOf() > moment(endValue).valueOf()\n      )\n    },\n    start_time_change(data) {\n      this.start_time = cloneDeep(data)\n    },\n    handleStartOpenChange(open) {\n      if (!open) {\n        this.cardData.endOpen = true\n      }\n    },\n    // 售卖时间-end\n    end_time_change(data) {\n      this.end_time = cloneDeep(data)\n    },\n    handleEndOpenChange(open) {\n      this.cardData.endOpen = open\n    },\n    disabledEndDate(endValue) {\n      const startValue = this.start_time\n      if (!startValue) {\n        // 开始时间未选择\n        return (\n          endValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n        )\n      }\n      return (\n        endValue.valueOf() >=\n          moment(startValue)\n            .add(30, 'y')\n            .valueOf() ||\n        endValue.valueOf() < moment(startValue).valueOf() ||\n        endValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n      )\n    },\n    // moment\n    moment,\n    // 转让\n    transfer(e) {\n      this.cardData._is_transfer = e.target.checked\n      // 重置转让费用的校验\n      this.form.resetFields(['cardData.transfer_num'])\n    },\n    transfter_change(data) {\n      this.cardData.transfer_num = data\n    },\n    onCardBgChange(e) {\n      this.cardBgValidatorText = ''\n    },\n    // 卡背景校验\n    cardBgValidator() {\n      let validata = this.cardData.bg_image.image_key !== ''\n      this.cardBgValidatorText = validata ? '' : '请上传卡背景'\n    }\n  },\n  watch: {\n    'cardData._is_transfer': {\n      deep: true,\n      handler(newVal, oldVal) {\n        this.cardData.is_transfer = +newVal\n      }\n    },\n    'cardData.transfer_unit': {\n      deep: true,\n      handler() {\n        if (!this.transfer_unit_is_first) {\n          this.form.resetFields(['cardData.transfer_num'])\n        }\n        this.transfer_unit_is_first = false\n      }\n    },\n    'cardData.consumer_shop_list': {\n      deep: true,\n      handler() {\n        let v = this.cardData.consumption_range\n        this.cardData.consumption_range = v\n        this.form.setFieldsValue({\n          'cardData.consumption_range': v\n        })\n      }\n    },\n    'cardData.sell_shop_list': {\n      deep: true,\n      handler() {\n        let v = this.cardData.support_sales\n        this.cardData.support_sales = v\n        this.form.setFieldsValue({\n          'cardData.support_sales': v\n        })\n      }\n    }\n  },\n  computed: {\n    // 支持售卖门店\n    support_sales_list() {\n      let arr = cloneDeep(this.supportSales)\n      let index =\n        this.cardData.consumption_range === this.CONSUMPTION_RANGE.GENERAL_STORE\n          ? 999\n          : 2\n      arr.splice(index, 1)\n      return arr\n    },\n    // 售卖方式\n    sell_type_list() {\n      let sell_type = cloneDeep(this.sellType)\n      let arr = []\n      sell_type.forEach(i => {\n        arr.push({\n          value: i.value,\n          label: i.label\n        })\n      })\n      if (!this.cardData.appConfig) {\n        remove(arr, i => i.value === SELL_TYPE.CLIENT)\n      }\n      return arr\n    },\n    // 卡背景是否校验通过\n    cardBgIsOk() {\n      return this.cardBgValidatorText === ''\n    },\n    // 转让设置的min\n    transferMin() {\n      return 0\n    },\n    // 转让设置的max\n    transferMax() {\n      return this.cardData.transfer_unit === TRANSFER_UNIT.PERCENT\n        ? 100\n        : 999999.9\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/brand/product/card/deposit"}]}