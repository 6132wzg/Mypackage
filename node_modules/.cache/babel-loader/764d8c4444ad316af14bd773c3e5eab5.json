{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/reception/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/reception/index.vue","mtime":1598250255901},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { IndexService } from \"./index.service\";\nimport { cloneDeep, debounce, get } from 'lodash-es';\nimport moment from 'moment';\nimport FrontAddMember from '@/views/biz-modals/front/add-member';\nimport ShopReceptionEntrance from '@/views/biz-modals/shop/reception/entrance';\nimport TodoList from \"./components#/todolist\";\nimport MemberOnline from \"./components#/member-online\";\nimport ShortcutNav from \"./components#/shortcut-nav\";\nimport ShortcutModel from \"./components#/shortcut-model\";\nimport { enumFilter } from \"../../../../filters/other.filters\";\nimport { tap } from 'rxjs/operators';\nexport default {\n  name: 'PageShopReception',\n  bem: {\n    reception: 'page-shop-reception'\n  },\n  modals: {\n    FrontAddMember: FrontAddMember,\n    ShopReceptionEntrance: ShopReceptionEntrance\n  },\n  serviceInject: function serviceInject() {\n    return {\n      indexService: IndexService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      auth: this.indexService.auth$,\n      memberList: this.indexService.memberList$,\n      hasNext: this.indexService.hasNext$,\n      page: this.indexService.page$,\n      loading: this.indexService.loading$,\n      parent_types: this.indexService.parent_types$\n    };\n  },\n  components: {\n    TodoList: TodoList,\n    MemberOnline: MemberOnline,\n    ShortcutNav: ShortcutNav,\n    ShortcutModel: ShortcutModel\n  },\n  data: function data() {\n    return {\n      // 搜索会员的关键字\n      memberSearchText: '',\n      // 搜索会员的最后一次关键字\n      lastMemberSearchText: '',\n      // 选择的会员\n      selectMember: undefined,\n      // memberId\n      memberId: undefined,\n      page: {\n        current_page: 1,\n        size: 10\n      },\n      memberSearchOpen: false\n    };\n  },\n  computed: {\n    isSearchNone: function isSearchNone() {\n      return this.memberSearchText !== '' && !this.memberList.length;\n    },\n    // 是否确定了会员\n    isSelectMember: function isSelectMember() {\n      return this.selectMember && this.memberId && this.memberList.length;\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    if (this.auth.checkinPage) {\n      this.indexService.getMemberOnlineList().subscribe(function (res) {\n        setTimeout(function () {\n          _this.$refs.searchSelect.$el.click();\n        }, 200);\n      });\n    }\n  },\n  methods: {\n    handleRefresh: function handleRefresh() {\n      var _this2 = this;\n\n      this.indexService.getMemberOnlineList().subscribe(function () {\n        setTimeout(function () {\n          _this2.$refs.searchSelect.$el.click();\n        }, 200);\n      });\n    },\n    handleMemberSearch: function handleMemberSearch() {\n      var _this3 = this;\n\n      console.log('handleMemberSearch', this.memberId);\n      this.lastMemberSearchText = '';\n      this.memberSearchText = '';\n      this.$modalRouter.push({\n        name: 'shop-reception-entrance',\n        props: {\n          member_id: this.memberId\n        },\n        on: {\n          done: function done() {\n            _this3.selectMember = undefined;\n            _this3.memberId = undefined;\n            _this3.lastMemberSearchText = '';\n            _this3.memberSearchText = '';\n\n            _this3.indexService.setMemberList([]);\n\n            if (_this3.auth.checkinPage) {\n              _this3.indexService.getMemberOnlineList().subscribe(function (res) {\n                setTimeout(function () {\n                  _this3.$refs.searchSelect.$el.click();\n                }, 200);\n              });\n            } else {\n              setTimeout(function () {\n                _this3.$refs.searchSelect.$el.click();\n              }, 200);\n            }\n          }\n        }\n      });\n    },\n    selectItemLabel: function selectItemLabel(item) {\n      if (item.is_minors === 1) {\n        return \"\".concat(item.member_name, \"(\\u672A\\u6210\\u5E74) \").concat(item.parent_mobile, \"(\").concat(this.filterParentUserRole(item), \")\");\n      }\n\n      return \"\".concat(item.member_name, \" \").concat(item.mobile);\n    },\n    filterParentUserRole: function filterParentUserRole(item) {\n      return this.parent_types.filter(function (i) {\n        return i.value === item.parent_user_role;\n      })[0].label;\n    },\n    // 搜索会员\n    onMemberSearch: function onMemberSearch(data) {\n      this.memberSearchOpen = true;\n\n      if (!this.hasNext && this.memberSearchText === data.trim()) {\n        return;\n      }\n\n      if (this.memberSearchText !== data.trim()) {\n        this.page.current_page = 1;\n        this.indexService.setMemberList([]);\n      }\n\n      this.memberSearchText = data.trim();\n\n      if (data.trim() !== '') {\n        this.lastMemberSearchText = data.trim();\n        this.indexService.memberListAction$.dispatch({\n          keyword: data,\n          current_page: this.page.current_page,\n          size: this.page.size\n        });\n      }\n    },\n    // 选择了会员\n    onMemberSelect: function onMemberSelect(data) {\n      this.selectMember = data;\n      this.memberId = data;\n      this.handleMemberSearch();\n    },\n    // 监听回车入场\n    onMemberEnter: function onMemberEnter(e) {\n      var _this4 = this;\n\n      var keyCode = e.keyCode;\n\n      if (keyCode === 13 && !this.memberList.length && !this.loading.getMemberList) {\n        this.indexService.getMemberList({\n          keyword: this.lastMemberSearchText\n        }).subscribe(function (res) {\n          var list = res.list;\n          var id = list.length ? list[0]['id'] : undefined;\n\n          if (id) {\n            console.log('onMemberSelect', id);\n\n            _this4.onMemberSelect(id);\n          } else {\n            _this4.selectMember = undefined;\n            _this4.memberId = undefined;\n            _this4.lastMemberSearchText = '';\n            _this4.memberSearchText = '';\n\n            _this4.indexService.setMemberList([]);\n          }\n        });\n      }\n    },\n    // 会员搜索框失去焦点\n    onMemberBlur: function onMemberBlur() {\n      this.memberId = undefined;\n      this.selectMember = undefined;\n      this.lastMemberSearchText = '';\n      this.memberSearchText = '';\n      this.memberSearchOpen = false;\n      this.indexService.setMemberList([]);\n    },\n    onMemberFocus: function onMemberFocus() {\n      if (!this.memberSearchText) {\n        this.memberSearchOpen = false;\n        return;\n      }\n\n      if (!this.memberSearchOpen) this.memberSearchOpen = true;\n    },\n    // 新增会员\n    onAddUser: function onAddUser() {\n      var _this5 = this;\n\n      this.$modalRouter.push({\n        name: 'front-add-member',\n        on: {\n          success: function success(res) {\n            _this5.onMemberSelect(res.id);\n\n            _this5.onMemberSearch(res.name);\n          }\n        }\n      });\n    },\n    scroll: debounce(function (e) {\n      var target = e.target;\n\n      if (Math.floor(target.scrollTop) + target.clientHeight > target.scrollHeight - 20) {\n        if (this.hasNext) {\n          this.page.current_page++;\n          this.onMemberSearch(this.memberSearchText);\n        }\n      }\n    }, 200)\n  }\n};",null]}