{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/member-search/member-search.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/member-search/member-search.vue","mtime":1600926382175},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { MemberSearchService } from \"./member-search.service\";\nimport { merge } from 'lodash-es';\nimport { ruleOptions } from \"./member-search.config\";\nimport { PatternService } from '@/services/pattern.service';\nimport InputPhone from '@/views/biz-components/input-phone/input-phone';\nexport default {\n  model: {\n    event: 'change'\n  },\n  props: {\n    value: {\n      type: String\n    },\n    id: {\n      type: String\n    },\n    label: {\n      type: String,\n      default: '购买会员'\n    },\n\n    /**\n     * 会员查询类型 transaction | transfer\n     */\n    type: {\n      type: String,\n      default: 'transaction' // required: true\n\n    },\n    placeholder: {\n      type: String,\n      default: '输入手机号或会员名搜索'\n    },\n    // 外部 form 表单 必传\n    form: {\n      type: Object,\n      required: true\n    },\n    fields: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    // 回填会员填写信息\n    memberInfo: {\n      type: Object // default: () => {\n      //   return {\n      //     member_id: 110676207534127,\n      //     member_name: '张飞123222',\n      //     member_mobile: 19134752085\n      //   }\n      // }\n\n    },\n    saleRangeType: {\n      type: Number,\n      default: 1\n    }\n  },\n  serviceInject: function serviceInject() {\n    return {\n      memberSearchService: MemberSearchService,\n      pattern: PatternService\n    };\n  },\n  rxState: function rxState() {\n    var _this$memberSearchSer = this.memberSearchService,\n        memberList$ = _this$memberSearchSer.memberList$,\n        loading$ = _this$memberSearchSer.loading$;\n    return {\n      memberList$: memberList$,\n      loading$: loading$,\n      parent_types: this.memberSearchService.parent_types$\n    };\n  },\n  data: function data() {\n    return {\n      memberSearchText: '',\n      searchMemberIsShow: true,\n      personModel: 0,\n      selectInfo: {},\n      disabledParentMobile: false\n    };\n  },\n  computed: {\n    ruleOptions: ruleOptions,\n    decorators: function decorators() {\n      return this.form.addDecorators(this.ruleOptions);\n    },\n    usedFields: function usedFields() {\n      return merge({\n        member_id: 'member_id',\n        mobile: 'mobile',\n        member_name: 'member_name',\n        parent_name: 'parent_name',\n        is_minors: 'is_minors',\n        parent_mobile: 'parent_mobile',\n        parent_user_role: 'parent_user_role'\n      }, this.fields);\n    },\n    memberId: function memberId() {\n      return this.usedFields.member_id;\n    },\n    memberMobile: function memberMobile() {\n      return this.usedFields.mobile;\n    },\n    memberName: function memberName() {\n      return this.usedFields.member_name;\n    },\n    parentName: function parentName() {\n      return this.usedFields.parent_name;\n    },\n    isMinors: function isMinors() {\n      return this.usedFields.is_minors;\n    },\n    parentMobile: function parentMobile() {\n      return this.usedFields.parent_mobile;\n    },\n    parentUserRole: function parentUserRole() {\n      return this.usedFields.parent_user_role;\n    }\n  },\n  methods: {\n    onChangeParentMobile: function onChangeParentMobile(val) {\n      var _this = this;\n\n      setTimeout(function () {\n        _this.form.validate(['parent_mobile']).then(function (values) {\n          val.mobile = val.phone;\n\n          _this.memberSearchService.getParentInfoByPhone(val).subscribe(function (res) {\n            if (res.exists) {\n              _this.disabledParentMobile = true;\n\n              _this.form.setFieldsValue({\n                parent_name: res.info.member_name\n              });\n            } else {\n              _this.disabledParentMobile = false;\n\n              _this.form.setFieldsValue({\n                parent_name: ''\n              });\n            }\n          });\n        });\n      });\n    },\n    selectItemLabel: function selectItemLabel(item) {\n      if (item.is_minors === 1) {\n        return \"\".concat(item.member_name, \"(\\u672A\\u6210\\u5E74) \").concat(item.parent_mobile, \"(\").concat(item.parent_user_role, \")\");\n      }\n\n      return \"\".concat(item.member_name, \" \").concat(item.mobile);\n    },\n    onSelectMember: function onSelectMember(val) {\n      this.selectInfo = this.memberList$.filter(function (item) {\n        return item.id === val;\n      })[0];\n      this.$emit('change', val);\n    },\n    onChangeMember: function onChangeMember(val) {\n      // TODO: b254dd12 fix: 购买会员change事件 三个月前\n      this.$emit('change', val);\n    },\n    onChangeModel: function onChangeModel(val) {\n      this.personModel = val;\n    },\n    // 搜索会员\n    onMemberSearch: function onMemberSearch(data) {\n      var _this2 = this;\n\n      this.memberSearchText = data;\n\n      if (data === '') {\n        this.memberSearchService.RESET_LIST();\n        this.form.resetFields([this.memberId]);\n        this.$emit('change:list', []);\n      } else {\n        this.memberSearchService.getMember(data, this.saleRangeType);\n        this.memberSearchService.getMemberAction$.subscribe(function (list) {\n          if (!list.length) {\n            _this2.form.resetFields([_this2.memberId]);\n\n            _this2.onChangeMember('');\n          } else {\n            if (_this2.memberInfo) {\n              _this2.form.setFieldsValue(_defineProperty({}, _this2.memberId, _this2.memberInfo.member_id));\n\n              _this2.onChangeMember(_this2.memberInfo.member_id);\n            }\n          }\n        });\n      }\n    },\n    // 切换添加会员\n    onAddMember: function onAddMember() {\n      this.searchMemberIsShow = false;\n    },\n    onCancelMember: function onCancelMember() {\n      this.searchMemberIsShow = true;\n      this.form.resetFields([this.memberId, this.memberName, this.memberMobile]);\n    }\n  },\n  mounted: function mounted() {\n    var _this3 = this;\n\n    this.memberSearchService.SET_TYPE(this.type);\n\n    if (this.memberInfo) {\n      this.onMemberSearch(this.memberInfo.member_name);\n    } else {\n      this.memberSearchService.getMemberAction$.subscribe(function (list) {\n        if (!list.length) {\n          _this3.form.resetFields([_this3.memberId]);\n        }\n      });\n    }\n  },\n  components: {\n    InputPhone: InputPhone\n  }\n};",{"version":3,"sources":["member-search.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <st-form-item\n      v-if=\"searchMemberIsShow\"\n      :label=\"label\"\n      required\n      v-bind=\"$attrs\"\n    >\n      <a-select\n        style=\"width:100%\"\n        showSearch\n        allowClear\n        v-decorator=\"decorators[memberId]\"\n        :placeholder=\"placeholder\"\n        :defaultActiveFirstOption=\"false\"\n        :filterOption=\"false\"\n        :showArrow=\"false\"\n        suffixIcon=\"add\"\n        @search=\"onMemberSearch\"\n        @select=\"onSelectMember\"\n        @change=\"onChangeMember\"\n        notFoundContent=\"无搜索结果\"\n      >\n        <a-select-option\n          v-for=\"(item, index) in memberList$\"\n          :value=\"item.id\"\n          :key=\"index\"\n        >\n          <span\n            v-html=\"\n              `${selectItemLabel(item)}`.replace(\n                new RegExp(memberSearchText, 'g'),\n                `\\<span class='global-highlight-color'\\>${memberSearchText}\\<\\/span\\>`\n              )\n            \"\n          >\n            {{ selectItemLabel(item) }}\n          </span>\n        </a-select-option>\n        <a-select-option\n          :key=\"-1\"\n          disabled\n          v-if=\"\n            saleRangeType === 1 &&\n              !memberList$.length &&\n              memberSearchText !== ''\n          \"\n        >\n          查无此会员，\n          <a @click=\"onAddMember\">添加新会员？</a>\n        </a-select-option>\n        <span slot=\"suffixIcon\">未成年</span>\n      </a-select>\n    </st-form-item>\n    <template v-if=\"selectInfo && selectInfo.is_minors === 1\">\n      <st-form-item label=\"家长手机号\" required v-bind=\"$attrs\">\n        <label>{{ selectInfo.parent_mobile }}</label>\n      </st-form-item>\n      <st-form-item label=\"家长姓名\" required v-bind=\"$attrs\">\n        <label>\n          {{ selectInfo.parent_name }}({{ selectInfo.parent_user_role }})\n        </label>\n      </st-form-item>\n    </template>\n\n    <template v-if=\"!searchMemberIsShow\">\n      <st-form-item label=\"姓名\" required v-bind=\"$attrs\">\n        <a-input v-decorator=\"decorators[memberName]\" placeholder=\"请输入姓名\">\n          <a-select\n            slot=\"addonAfter\"\n            style=\"width: 100px\"\n            v-decorator=\"decorators[isMinors]\"\n            @change=\"onChangeModel\"\n          >\n            <a-select-option :value=\"0\">成年人</a-select-option>\n            <a-select-option :value=\"1\">未成年人</a-select-option>\n          </a-select>\n        </a-input>\n      </st-form-item>\n      <st-form-item\n        label=\"手机号\"\n        required\n        v-if=\"personModel === 0\"\n        v-bind=\"$attrs\"\n      >\n        <input-phone\n          size=\"default\"\n          v-decorator=\"decorators[memberMobile]\"\n          placeholder=\"请输入手机号\"\n        ></input-phone>\n        <p class=\"mg-b0\">\n          <a @click=\"onCancelMember\">取消添加</a>\n        </p>\n      </st-form-item>\n      <st-form-item\n        label=\"家长手机号\"\n        required\n        v-if=\"personModel === 1\"\n        v-bind=\"$attrs\"\n      >\n        <input-phone\n          size=\"default\"\n          v-decorator=\"decorators[parentMobile]\"\n          placeholder=\"请输入手机号\"\n          @change=\"onChangeParentMobile\"\n        ></input-phone>\n      </st-form-item>\n      <st-form-item\n        label=\"家长姓名\"\n        required\n        v-if=\"personModel === 1\"\n        v-bind=\"$attrs\"\n      >\n        <a-input\n          v-decorator=\"decorators[parentName]\"\n          placeholder=\"请输入家长姓名\"\n          :disabled=\"disabledParentMobile\"\n        >\n          <a-select\n            slot=\"addonAfter\"\n            style=\"width: 80px\"\n            v-decorator=\"decorators[parentUserRole]\"\n          >\n            <a-select-option\n              :value=\"item.value\"\n              v-for=\"(item, index) in parent_types\"\n              :key=\"index\"\n            >\n              {{ item.label }}\n            </a-select-option>\n          </a-select>\n        </a-input>\n        <p class=\"mg-b0\">\n          <a @click=\"onCancelMember\">取消添加</a>\n        </p>\n      </st-form-item>\n    </template>\n  </div>\n</template>\n\n<script>\nimport { MemberSearchService } from './member-search.service'\nimport { merge } from 'lodash-es'\nimport { ruleOptions } from './member-search.config'\nimport { PatternService } from '@/services/pattern.service'\nimport InputPhone from '@/views/biz-components/input-phone/input-phone'\nexport default {\n  model: {\n    event: 'change'\n  },\n  props: {\n    value: {\n      type: String\n    },\n    id: {\n      type: String\n    },\n    label: {\n      type: String,\n      default: '购买会员'\n    },\n    /**\n     * 会员查询类型 transaction | transfer\n     */\n    type: {\n      type: String,\n      default: 'transaction'\n      // required: true\n    },\n    placeholder: {\n      type: String,\n      default: '输入手机号或会员名搜索'\n    },\n    // 外部 form 表单 必传\n    form: {\n      type: Object,\n      required: true\n    },\n    fields: {\n      type: Object,\n      default: () => ({})\n    },\n    // 回填会员填写信息\n    memberInfo: {\n      type: Object\n      // default: () => {\n      //   return {\n      //     member_id: 110676207534127,\n      //     member_name: '张飞123222',\n      //     member_mobile: 19134752085\n      //   }\n      // }\n    },\n    saleRangeType: {\n      type: Number,\n      default: 1\n    }\n  },\n  serviceInject() {\n    return {\n      memberSearchService: MemberSearchService,\n      pattern: PatternService\n    }\n  },\n  rxState() {\n    const { memberList$, loading$ } = this.memberSearchService\n    return {\n      memberList$,\n      loading$,\n      parent_types: this.memberSearchService.parent_types$\n    }\n  },\n\n  data() {\n    return {\n      memberSearchText: '',\n      searchMemberIsShow: true,\n      personModel: 0,\n      selectInfo: {},\n      disabledParentMobile: false\n    }\n  },\n  computed: {\n    ruleOptions,\n    decorators() {\n      return this.form.addDecorators(this.ruleOptions)\n    },\n    usedFields() {\n      return merge(\n        {\n          member_id: 'member_id',\n          mobile: 'mobile',\n          member_name: 'member_name',\n          parent_name: 'parent_name',\n          is_minors: 'is_minors',\n          parent_mobile: 'parent_mobile',\n          parent_user_role: 'parent_user_role'\n        },\n        this.fields\n      )\n    },\n    memberId() {\n      return this.usedFields.member_id\n    },\n    memberMobile() {\n      return this.usedFields.mobile\n    },\n    memberName() {\n      return this.usedFields.member_name\n    },\n    parentName() {\n      return this.usedFields.parent_name\n    },\n    isMinors() {\n      return this.usedFields.is_minors\n    },\n    parentMobile() {\n      return this.usedFields.parent_mobile\n    },\n    parentUserRole() {\n      return this.usedFields.parent_user_role\n    }\n  },\n  methods: {\n    onChangeParentMobile(val) {\n      setTimeout(() => {\n        this.form.validate(['parent_mobile']).then(values => {\n          val.mobile = val.phone\n          this.memberSearchService.getParentInfoByPhone(val).subscribe(res => {\n            if (res.exists) {\n              this.disabledParentMobile = true\n              this.form.setFieldsValue({\n                parent_name: res.info.member_name\n              })\n            } else {\n              this.disabledParentMobile = false\n              this.form.setFieldsValue({\n                parent_name: ''\n              })\n            }\n          })\n        })\n      })\n    },\n    selectItemLabel(item) {\n      if (item.is_minors === 1) {\n        return `${item.member_name}(未成年) ${item.parent_mobile}(${item.parent_user_role})`\n      }\n      return `${item.member_name} ${item.mobile}`\n    },\n    onSelectMember(val) {\n      this.selectInfo = this.memberList$.filter(item => item.id === val)[0]\n      this.$emit('change', val)\n    },\n    onChangeMember(val) {\n      // TODO: b254dd12 fix: 购买会员change事件 三个月前\n      this.$emit('change', val)\n    },\n    onChangeModel(val) {\n      this.personModel = val\n    },\n    // 搜索会员\n    onMemberSearch(data) {\n      this.memberSearchText = data\n      if (data === '') {\n        this.memberSearchService.RESET_LIST()\n        this.form.resetFields([this.memberId])\n        this.$emit('change:list', [])\n      } else {\n        this.memberSearchService.getMember(data, this.saleRangeType)\n        this.memberSearchService.getMemberAction$.subscribe(list => {\n          if (!list.length) {\n            this.form.resetFields([this.memberId])\n            this.onChangeMember('')\n          } else {\n            if (this.memberInfo) {\n              this.form.setFieldsValue({\n                [this.memberId]: this.memberInfo.member_id\n              })\n              this.onChangeMember(this.memberInfo.member_id)\n            }\n          }\n        })\n      }\n    },\n    // 切换添加会员\n    onAddMember() {\n      this.searchMemberIsShow = false\n    },\n    onCancelMember() {\n      this.searchMemberIsShow = true\n      this.form.resetFields([this.memberId, this.memberName, this.memberMobile])\n    }\n  },\n  mounted() {\n    this.memberSearchService.SET_TYPE(this.type)\n    if (this.memberInfo) {\n      this.onMemberSearch(this.memberInfo.member_name)\n    } else {\n      this.memberSearchService.getMemberAction$.subscribe(list => {\n        if (!list.length) {\n          this.form.resetFields([this.memberId])\n        }\n      })\n    }\n  },\n  components: {\n    InputPhone\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-components/member-search"}]}