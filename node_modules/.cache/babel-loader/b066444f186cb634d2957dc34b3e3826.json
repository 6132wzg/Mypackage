{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/course/select-course.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/course/select-course.vue","mtime":1597396799932},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.regexp.search\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { MessageService } from '@/services/message.service';\nimport { SelectCourseService } from \"./select-course.service\";\nimport { cloneDeep, filter, remove } from 'lodash-es';\nimport { FIX_PACKAGE_LIMIT } from '@/constants/course/package';\nimport infiniteScroll from 'vue-infinite-scroll';\nexport default {\n  name: 'SelectCourse',\n  serviceInject: function serviceInject() {\n    return {\n      messageService: MessageService,\n      selectCourseService: SelectCourseService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      addLoading: this.selectCourseService.loading$\n    };\n  },\n  bem: {\n    course: 'st-select-course'\n  },\n  directives: {\n    infiniteScroll: infiniteScroll\n  },\n  props: {\n    type: {\n      type: String,\n      default: function _default() {\n        return 'team';\n      }\n    },\n    platform: {\n      type: String,\n      default: function _default() {\n        return '';\n      }\n    },\n    useShopInfo: {\n      type: Object,\n      default: function _default() {}\n    },\n    courses: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n\n    /**\n     * 是否限定选择课程数量，可传入限制数量（比如固定课程包限定选择10种）,0代表不限制\n     */\n    isLimit: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: function data() {\n    return {\n      FIX_PACKAGE_LIMIT: FIX_PACKAGE_LIMIT,\n      show: false,\n      courseTypeList: [],\n\n      /**\n       * 最多选择团课数量\n       */\n      titleList: {\n        team: '选择团课',\n        personal: '选择私教课'\n      },\n      searchData: {\n        course_type: null,\n        search: ''\n      },\n      TABEL_LOAD_TIME: 200,\n      TABEL_LOAD_SIZE: 20,\n      courseList: [],\n      total: 0,\n      busy: true,\n      i: 10,\n      selectCourseList: [],\n      loadCourseList: []\n    };\n  },\n  computed: {\n    /**\n     * 新增按钮是否可用\n     */\n    isAddDisabled: function isAddDisabled() {\n      return !!this.isLimit && (!this.courseList.length || this.selectCourseList.length >= this.FIX_PACKAGE_LIMIT);\n    }\n  },\n  methods: {\n    // loadMore(baseSize) {\n    //   console.log(this.i)\n    //   this.busy = false\n    //   this.i += baseSize\n    //   let start = this.i\n    //   let end = this.TABEL_LOAD_SIZE + this.i\n    //   if (baseSize < 0) {\n    //     start = this.i + baseSize\n    //     end = this.i\n    //   }\n    //   console.log(end)\n    //   let timer = setTimeout(() => {\n    //     this.busy = true\n    //     this.loadCourseList = this.$set(this, 'loadCourseList', [\n    //       ...this.courseList.slice(start, end)\n    //     ])\n    //     document.querySelector(\n    //       '.st-select-course__scroll-content'\n    //     ).scrollTop = 2\n    //     if (this.i > this.total) {\n    //       clearTimeout(timer)\n    //     }\n    //   }, this.TABEL_LOAD_TIME)\n    // },\n    onCourseTypeChange: function onCourseTypeChange(data) {\n      this.searchData.search = '';\n      this.searchData.course_type = data;\n      this.getCourseList();\n    },\n    onAdd: function onAdd(id) {\n      var _this$selectCourseLis;\n\n      if (this.isAddDisabled) {\n        return;\n      }\n\n      var arr = filter(this.courseList, function (o) {\n        return o.course_id === id;\n      });\n\n      (_this$selectCourseLis = this.selectCourseList).push.apply(_this$selectCourseLis, _toConsumableArray(arr));\n\n      this.filterCourse();\n    },\n    onAllAdd: function onAllAdd() {\n      var _this$selectCourseLis2;\n\n      if (!this.validate()) {\n        return;\n      }\n\n      (_this$selectCourseLis2 = this.selectCourseList).push.apply(_this$selectCourseLis2, _toConsumableArray(cloneDeep(this.courseList)));\n\n      this.courseList = [];\n    },\n\n    /**\n     * 判断新增课程数量是否超出上限\n     */\n    validate: function validate() {\n      if (this.isLimit && this.selectCourseList.length + this.courseList.length > FIX_PACKAGE_LIMIT) {\n        this.messageService.error({\n          content: \"\\u6700\\u591A\\u65B0\\u589E\".concat(this.FIX_PACKAGE_LIMIT, \"\\u79CD\\u8BFE\\u7A0B\\uFF0C\\u65B0\\u589E\\u5931\\u8D25\")\n        });\n        return false;\n      }\n\n      return true;\n    },\n    onRemove: function onRemove(id) {\n      var arr = cloneDeep(this.selectCourseList);\n      remove(arr, function (o) {\n        return o.course_id === id;\n      });\n      this.selectCourseList = arr;\n      this.getCourseList();\n    },\n    onOk: function onOk() {\n      this.$emit('ok', {\n        list: cloneDeep(this.selectCourseList)\n      });\n      this.show = false;\n    },\n    // 根据已选课程，过滤可选课程\n    filterCourse: function filterCourse() {\n      var arr = cloneDeep(this.courseList);\n      this.selectCourseList.forEach(function (i) {\n        remove(arr, function (o) {\n          return o.course_id === i.course_id;\n        });\n      });\n      this.courseList = arr;\n    },\n    getCourseType: function getCourseType() {\n      var _this = this;\n\n      this.selectCourseService.getCourseTypeList().subscribe(function (res) {\n        _this.courseTypeList = cloneDeep(res.list);\n        _this.searchData.course_type = res.list[0].id;\n\n        _this.getCourseList();\n      });\n    },\n    // handleScroll() {\n    //   let height = document.querySelector('.st-select-course__scroll-content')\n    //     .clientHeight\n    //   let liHeight = document.querySelector(\n    //     '.st-select-course__scroll-content .table-item'\n    //   ).clientHeight\n    //   let scrollTop = document.querySelector(\n    //     '.st-select-course__scroll-content'\n    //   ).scrollTop\n    //   //滚动条到底部的条件\n    //   if (scrollTop === liHeight * this.TABEL_LOAD_SIZE - height) {\n    //     console.log(\n    //       '1-' +\n    //         '距顶部' +\n    //         scrollTop +\n    //         '可视区高度' +\n    //         height +\n    //         'li总高度' +\n    //         liHeight * this.TABEL_LOAD_SIZE\n    //     )\n    //     this.loadMore(10)\n    //   } else {\n    //     console.log('0-' + '距顶部' + scrollTop + '可视区高度' + height)\n    //   }\n    //   if (scrollTop === 0 && this.i >= 20) {\n    //     this.loadMore(-10)\n    //   }\n    // },\n    getCourseList: function getCourseList() {\n      var _this2 = this;\n\n      var form = {\n        platform: this.platform,\n        type: this.type,\n        search: this.searchData.search,\n        course_type: this.searchData.course_type\n      };\n\n      if (this.platform === 'brand') {\n        form = _objectSpread({}, form, {}, this.useShopInfo);\n      }\n\n      this.selectCourseService.getCourseList(form).subscribe(function (res) {\n        // TODO: 上线一定优化\n        _this2.total = res.list.length;\n        _this2.courseList = cloneDeep(res.list); // this.loadCourseList = this.$set(this, 'loadCourseList', [\n        //   this.courseList.slice(0, this.i)\n        // ])\n\n        _this2.filterCourse();\n      });\n    }\n  },\n  created: function created() {\n    var _this$selectCourseLis3;\n\n    this.getCourseType();\n\n    (_this$selectCourseLis3 = this.selectCourseList).push.apply(_this$selectCourseLis3, _toConsumableArray(this.courses));\n  }\n};",null]}