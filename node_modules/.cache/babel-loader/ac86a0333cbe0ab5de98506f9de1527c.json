{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/brand/marketing/plugin/add-prize.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/brand/marketing/plugin/add-prize.vue","mtime":1600926555829},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { AddPrizeService } from \"./add-prize.service\";\nimport { ruleOptions } from \"./add-prize.config.ts\";\nimport { PatternService } from '@/services/pattern.service';\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue';\nimport { cloneDeep } from 'lodash-es';\nimport SelectShop from '@/views/fragments/shop/select-shop.vue';\nimport { IMG_TYPE, SHOP_TYPE, PRIZE_TYPE } from '@/constants/marketing/lottery';\nimport { MessageService } from '@/services/message.service';\nexport default {\n  name: 'BrandMarketingPoster',\n  bem: {\n    basic: 'brand-marketing-prize'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      addPrizeService: AddPrizeService,\n      pattern: PatternService,\n      messageService: MessageService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      shops: this.addPrizeService.shops$,\n      prizeType: this.addPrizeService.prizeType$,\n      imgType: this.addPrizeService.imgType$,\n      prize: this.addPrizeService.prize$,\n      pluginStatus: this.addPrizeService.pluginStatus$\n    };\n  },\n  props: {\n    info: {\n      type: Object\n    },\n    id: {\n      type: String\n    },\n    status: {\n      type: Number\n    }\n  },\n  computed: {\n    defaultPrizeImg: function defaultPrizeImg() {\n      if (this.curPrizeType === this.PRIZE_TYPE.POINTS && this.prize[1] && this.prize[1].image_url) {\n        return this.prize[1];\n      }\n\n      return this.prize[0];\n    }\n  },\n  data: function data(vm) {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      IMG_TYPE: IMG_TYPE,\n      PRIZE_TYPE: PRIZE_TYPE,\n      SHOP_TYPE: SHOP_TYPE,\n      show: false,\n      shopIds: [],\n      shopNum: 0,\n      fileList: [],\n      couponList: [],\n      curPrizeType: PRIZE_TYPE.CUSTOM,\n      curImgType: IMG_TYPE.DEFAULT,\n      curShopType: SHOP_TYPE.CUSTOM\n    };\n  },\n  mounted: function mounted() {\n    if (this.info) {\n      this.form.setFieldsValue({\n        prize_name: this.info.prize_name,\n        prize_type: this.info.prize_type,\n        coupon_id: this.info.coupon_id,\n        prize_id: this.info.prize_id,\n        activity_prize_id: this.info.activity_prize_id,\n        is_shop_range: this.info.is_shop_range,\n        support_shop_ids: this.info.support_shop_ids,\n        rate: this.info.rate,\n        number: this.info.number,\n        image: this.info.image,\n        image_default: this.info.image_default\n      });\n    }\n  },\n  created: function created() {\n    this.getCouponList();\n\n    if (this.info) {\n      this.curImgType = this.info.image_default;\n      this.curPrizeType = this.info.prize_type;\n      this.fileList[0] = this.info.prize;\n      this.shopIds = this.info.support_shop_ids;\n    }\n\n    this.addPrizeService.getPluginList().subscribe();\n  },\n  components: {\n    SelectShop: SelectShop,\n    StImageUpload: StImageUpload\n  },\n  methods: {\n    getCurCouponShops: function getCurCouponShops(e) {\n      var _this = this;\n\n      this.couponList.filter(function (item) {\n        if (item.id === e) {\n          _this.shopNum = item.shop_num;\n        }\n      });\n    },\n    onChangeShopSetting: function onChangeShopSetting(val) {\n      this.shopIds = val;\n    },\n    getCouponList: function getCouponList() {\n      var _this2 = this;\n\n      var coupon_id = this.info ? this.info.coupon_id : 0;\n      return this.addPrizeService.getCouponList(coupon_id).subscribe(function (res) {\n        _this2.couponList = res.list;\n      });\n    },\n    onChangeGetAvatar: function onChangeGetAvatar(imageFiles) {\n      this.fileList = cloneDeep(imageFiles);\n    },\n    getCurPrizeType: function getCurPrizeType(e) {\n      this.curPrizeType = e.target.value;\n    },\n    getCurShopType: function getCurShopType(e) {\n      this.curShopType = e.target.value;\n    },\n    getCurImgType: function getCurImgType(e) {\n      this.curImgType = e.target.value;\n    },\n    onSubmit: function onSubmit() {\n      var _this3 = this;\n\n      if (this.curPrizeType === this.PRIZE_TYPE.CUSTOM && this.shopIds.length === 0) {\n        this.messageService.warn({\n          content: '请选择门店'\n        });\n        return;\n      }\n\n      this.form.validate().then(function (value) {\n        value.prize = _this3.curImgType === _this3.IMG_TYPE.CUSTOM ? _this3.fileList[0] || _this3.defaultPrizeImg : _this3.defaultPrizeImg;\n        value.support_shop_ids = _this3.shopIds;\n        value.shop_num = _this3.shopNum;\n        value.prize_id = _this3.info ? _this3.info.prize_id : 0;\n        value.activity_prize_id = _this3.info ? _this3.info.activity_prize_id : 0;\n\n        if (_this3.curPrizeType === _this3.PRIZE_TYPE.DEFAULT && !value.coupon_id) {\n          _this3.messageService.warn({\n            content: '请选择优惠券'\n          });\n\n          return;\n        }\n\n        if (_this3.curPrizeType === _this3.PRIZE_TYPE.POINTS && !value.prize_points) {\n          _this3.messageService.warn({\n            content: '请输入积分数量'\n          });\n\n          return;\n        }\n\n        _this3.$emit('change', value);\n\n        _this3.show = false;\n      });\n    }\n  }\n};",{"version":3,"sources":["add-prize.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal title=\"奖品设置\" v-model=\"show\" @ok=\"onSubmit\">\n    <st-form :form=\"form\" labelGutter=\"0\" labelWidth=\"84px\">\n      <st-form-item label=\"奖品名称\" required>\n        <a-input\n          placeholder=\"请输入奖品名称\"\n          :disabled=\"id && status === 1\"\n          v-decorator=\"decorators.prize_name\"\n        ></a-input>\n      </st-form-item>\n      <st-form-item label=\"奖品类型\" required>\n        <a-radio-group\n          v-decorator=\"decorators.prize_type\"\n          @change=\"getCurPrizeType\"\n        >\n          <template v-for=\"(item, index) in prizeType\">\n            <a-radio\n              :key=\"index\"\n              :value=\"item.value\"\n              :disabled=\"\n                item.value === 4 && pluginStatus.pointActivityAtatus !== 1\n              \"\n            >\n              {{ item.label }}\n              <template\n                v-if=\"\n                  item.value === 4 && pluginStatus.pointActivityAtatus !== 1\n                \"\n              >\n                <span :class=\"basic('point-condition-tips')\">\n                  请先开启会员积分功能，\n                </span>\n                <st-link\n                  _blank\n                  :class=\"basic('integral-condition-link')\"\n                  value=\"去开启\"\n                  :to=\"{\n                    path: '/brand/marketing/plugin/member-points/list/setting'\n                  }\"\n                ></st-link>\n              </template>\n            </a-radio>\n          </template>\n        </a-radio-group>\n        <div class=\"mg-t12\">\n          <a-select\n            @select=\"getCurCouponShops\"\n            v-if=\"curPrizeType === PRIZE_TYPE.DEFAULT\"\n            placeholder=\"请选择优惠券\"\n            v-decorator=\"decorators.coupon_id\"\n          >\n            <a-select-option\n              v-for=\"(item, index) in couponList\"\n              :key=\"index\"\n              :value=\"item.id\"\n            >\n              {{ item.name }}\n            </a-select-option>\n          </a-select>\n          <span v-else-if=\"curPrizeType === PRIZE_TYPE.POINTS\">\n            获得\n            <st-input-number\n              type=\"number\"\n              :min=\"1\"\n              :max=\"99999\"\n              :step=\"1\"\n              :precision=\"0\"\n              style=\"width: 150px\"\n              placeholder=\"请输入\"\n              v-decorator=\"decorators.prize_points\"\n            >\n              <template slot=\"addonAfter\">\n                积分\n              </template>\n            </st-input-number>\n          </span>\n          <span v-else>\n            获得当日起\n            <a-input-number\n              :min=\"1\"\n              :max=\"999\"\n              :step=\"1\"\n              :precision=\"0\"\n              class=\"width100px\"\n              placeholder=\"输入天数\"\n              v-decorator=\"decorators.valid_days\"\n            ></a-input-number>\n\n            天内有效\n          </span>\n        </div>\n      </st-form-item>\n      <st-form-item\n        label=\"兑换门店\"\n        v-if=\"curPrizeType === PRIZE_TYPE.CUSTOM\"\n        required\n      >\n        <a-radio-group\n          v-decorator=\"decorators.is_shop_range\"\n          @change=\"getCurShopType\"\n        >\n          <a-radio v-for=\"item in shops\" :key=\"item.value\" :value=\"item.value\">\n            {{ item.label }}\n          </a-radio>\n        </a-radio-group>\n        <select-shop\n          :shopIds=\"shopIds\"\n          v-if=\"curShopType === 2\"\n          @change=\"onChangeShopSetting\"\n        ></select-shop>\n      </st-form-item>\n      <st-form-item label=\"奖品数量\" required>\n        <st-input-number\n          :min=\"1\"\n          :max=\"999999\"\n          :step=\"1\"\n          :precision=\"0\"\n          placeholder=\"请输入奖品数量\"\n          v-decorator=\"decorators.number\"\n        >\n          <span slot=\"addonAfter\">个</span>\n        </st-input-number>\n      </st-form-item>\n      <st-form-item label=\"中奖概率\" required>\n        <st-input-number\n          :min=\"0\"\n          :max=\"100\"\n          :float=\"true\"\n          placeholder=\"请输入中奖概率\"\n          v-decorator=\"decorators.rate\"\n        >\n          <span slot=\"addonAfter\">%</span>\n        </st-input-number>\n      </st-form-item>\n      <st-form-item label=\"奖品图片\">\n        <a-radio-group\n          v-decorator=\"decorators.image_default\"\n          @change=\"getCurImgType\"\n        >\n          <a-radio\n            v-for=\"(item, index) in imgType\"\n            :key=\"index\"\n            :value=\"item.value\"\n          >\n            {{ item.label }}\n          </a-radio>\n        </a-radio-group>\n        <div v-if=\"curImgType === 2\" class=\"prize-upload\">\n          <st-image-upload\n            :list=\"fileList\"\n            width=\"96px\"\n            height=\"96px\"\n            @change=\"onChangeGetAvatar\"\n            :sizeLimit=\"2\"\n            placeholder=\"上传图片\"\n          ></st-image-upload>\n          <div class=\"prize-upload-text\">请上传jpg、png格式的图片</div>\n        </div>\n        <div v-else>\n          <img\n            :src=\"defaultPrizeImg.image_url\"\n            alt=\"默认图片\"\n            class=\"default-img\"\n          />\n        </div>\n      </st-form-item>\n    </st-form>\n  </st-modal>\n</template>\n<script>\nimport { AddPrizeService } from './add-prize.service'\nimport { ruleOptions } from './add-prize.config.ts'\nimport { PatternService } from '@/services/pattern.service'\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue'\nimport { cloneDeep } from 'lodash-es'\nimport SelectShop from '@/views/fragments/shop/select-shop.vue'\nimport { IMG_TYPE, SHOP_TYPE, PRIZE_TYPE } from '@/constants/marketing/lottery'\nimport { MessageService } from '@/services/message.service'\nexport default {\n  name: 'BrandMarketingPoster',\n  bem: {\n    basic: 'brand-marketing-prize'\n  },\n  serviceInject() {\n    return {\n      addPrizeService: AddPrizeService,\n      pattern: PatternService,\n      messageService: MessageService\n    }\n  },\n\n  rxState() {\n    return {\n      shops: this.addPrizeService.shops$,\n      prizeType: this.addPrizeService.prizeType$,\n      imgType: this.addPrizeService.imgType$,\n      prize: this.addPrizeService.prize$,\n      pluginStatus: this.addPrizeService.pluginStatus$\n    }\n  },\n  props: {\n    info: {\n      type: Object\n    },\n    id: {\n      type: String\n    },\n    status: {\n      type: Number\n    }\n  },\n  computed: {\n    defaultPrizeImg() {\n      if (\n        this.curPrizeType === this.PRIZE_TYPE.POINTS &&\n        this.prize[1] &&\n        this.prize[1].image_url\n      ) {\n        return this.prize[1]\n      }\n      return this.prize[0]\n    }\n  },\n  data(vm) {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      IMG_TYPE,\n      PRIZE_TYPE,\n      SHOP_TYPE,\n      show: false,\n      shopIds: [],\n      shopNum: 0,\n      fileList: [],\n      couponList: [],\n      curPrizeType: PRIZE_TYPE.CUSTOM,\n      curImgType: IMG_TYPE.DEFAULT,\n      curShopType: SHOP_TYPE.CUSTOM\n    }\n  },\n  mounted() {\n    if (this.info) {\n      this.form.setFieldsValue({\n        prize_name: this.info.prize_name,\n        prize_type: this.info.prize_type,\n        coupon_id: this.info.coupon_id,\n        prize_id: this.info.prize_id,\n        activity_prize_id: this.info.activity_prize_id,\n        is_shop_range: this.info.is_shop_range,\n        support_shop_ids: this.info.support_shop_ids,\n        rate: this.info.rate,\n        number: this.info.number,\n        image: this.info.image,\n        image_default: this.info.image_default\n      })\n    }\n  },\n  created() {\n    this.getCouponList()\n    if (this.info) {\n      this.curImgType = this.info.image_default\n      this.curPrizeType = this.info.prize_type\n      this.fileList[0] = this.info.prize\n      this.shopIds = this.info.support_shop_ids\n    }\n    this.addPrizeService.getPluginList().subscribe()\n  },\n  components: { SelectShop, StImageUpload },\n  methods: {\n    getCurCouponShops(e) {\n      this.couponList.filter(item => {\n        if (item.id === e) {\n          this.shopNum = item.shop_num\n        }\n      })\n    },\n    onChangeShopSetting(val) {\n      this.shopIds = val\n    },\n    getCouponList() {\n      let coupon_id = this.info ? this.info.coupon_id : 0\n      return this.addPrizeService.getCouponList(coupon_id).subscribe(res => {\n        this.couponList = res.list\n      })\n    },\n    onChangeGetAvatar(imageFiles) {\n      this.fileList = cloneDeep(imageFiles)\n    },\n    getCurPrizeType(e) {\n      this.curPrizeType = e.target.value\n    },\n    getCurShopType(e) {\n      this.curShopType = e.target.value\n    },\n    getCurImgType(e) {\n      this.curImgType = e.target.value\n    },\n    onSubmit() {\n      if (\n        this.curPrizeType === this.PRIZE_TYPE.CUSTOM &&\n        this.shopIds.length === 0\n      ) {\n        this.messageService.warn({\n          content: '请选择门店'\n        })\n        return\n      }\n      this.form.validate().then(value => {\n        value.prize =\n          this.curImgType === this.IMG_TYPE.CUSTOM\n            ? this.fileList[0] || this.defaultPrizeImg\n            : this.defaultPrizeImg\n        value.support_shop_ids = this.shopIds\n        value.shop_num = this.shopNum\n        value.prize_id = this.info ? this.info.prize_id : 0\n        value.activity_prize_id = this.info ? this.info.activity_prize_id : 0\n        if (this.curPrizeType === this.PRIZE_TYPE.DEFAULT && !value.coupon_id) {\n          this.messageService.warn({\n            content: '请选择优惠券'\n          })\n          return\n        }\n        if (\n          this.curPrizeType === this.PRIZE_TYPE.POINTS &&\n          !value.prize_points\n        ) {\n          this.messageService.warn({\n            content: '请输入积分数量'\n          })\n          return\n        }\n        this.$emit('change', value)\n        this.show = false\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/brand/marketing/plugin"}]}