{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/shop/edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/shop/edit.vue","mtime":1600926556238},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { UserService } from '@/services/user.service';\nimport { EditService } from \"./edit.service\";\nimport { PatternService } from '@/services/pattern.service';\nimport { cloneDeep } from 'lodash-es';\nimport CheckboxFacilityGroup from '@/views/biz-components/checkbox-facility/checkbox-facility-group';\nimport CheckboxFacilityItem from '@/views/biz-components/checkbox-facility/checkbox-facility-item';\nimport MapButton from '@/views/components/map-button#/map-button';\nimport ShopHourPicker from '@/views/components/hour-picker#/hour-picker';\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue';\nimport MoreInput from '@/views/components/more-input#/more-input.vue';\nexport default {\n  name: 'EditShopSetting',\n  components: {\n    CheckboxFacilityGroup: CheckboxFacilityGroup,\n    CheckboxFacilityItem: CheckboxFacilityItem,\n    MapButton: MapButton,\n    ShopHourPicker: ShopHourPicker,\n    StImageUpload: StImageUpload,\n    MoreInput: MoreInput\n  },\n  serviceInject: function serviceInject() {\n    return {\n      pattern: PatternService,\n      editService: EditService,\n      userService: UserService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      serviceList: this.editService.serviceList$,\n      shopInfo: this.editService.shopInfo$,\n      editLoading: this.editService.loading$\n    };\n  },\n  mounted: function mounted() {\n    this.init(this.shopInfo);\n  },\n  data: function data() {\n    return {\n      editMap: {\n        lat: '',\n        lng: '',\n        address: '',\n        province: {},\n        city: {},\n        district: {}\n      },\n      fileList: [],\n      fileListHostiry: [],\n      cropperModal: {},\n      shopData: {\n        shop_name: '',\n        province_id: null,\n        city_id: null,\n        district_id: null,\n        address: '',\n        shop_phones: [],\n        shop_status: 1,\n        lat: '',\n        lng: '',\n        service_ids: [],\n        business_time: [],\n        email: '',\n        shop_images: []\n      },\n      shopCoverImageValidateText: '',\n      shopPhoneValidateText: '',\n      serviceIcon_icon_list: {\n        1: 'WIFI',\n        2: 'park',\n        3: 'shower',\n        4: 'medical',\n        5: 'heating',\n        6: 'snow',\n        7: 'nosmoking',\n        8: 'energy'\n      }\n    };\n  },\n  beforeCreate: function beforeCreate() {\n    this.form = this.$form.createForm(this);\n  },\n  computed: {\n    shopCoverImageIsOk: function shopCoverImageIsOk() {\n      return this.shopCoverImageValidateText === '';\n    }\n  },\n  methods: {\n    // 获取门店信息\n    init: function init(data) {\n      var _this = this;\n\n      this.form.setFieldsValue({\n        shop_name: data.shop_name,\n        email: data.email\n      }); // 门店电话\n\n      this.shopData.shop_phones = cloneDeep(data.shop_phones); // 门店地址\n\n      this.editMap.lat = data.lat;\n      this.editMap.lng = data.lng;\n      this.editMap.address = data.shop_position.address;\n      this.editMap.province.id = data.shop_position.province_id;\n      this.editMap.province.name = data.shop_position.province_name;\n      this.editMap.city.id = data.shop_position.city_id;\n      this.editMap.city.name = data.shop_position.city_name;\n      this.editMap.district.id = data.shop_position.district_id;\n      this.editMap.district.name = data.shop_position.district_name; // 服务设施\n\n      data.shop_services.forEach(function (i) {\n        _this.shopData.service_ids.push(i.service_id);\n      }); // 店招\n\n      this.fileListHostiry = cloneDeep(data.shop_images);\n      this.fileList = cloneDeep(data.shop_images.filter(function (i) {\n        return i.is_cover;\n      }));\n      this.shopData.shop_images = cloneDeep(data.shop_images.filter(function (i) {\n        return i.is_cover;\n      })); // 营业状态\n\n      this.shopData.shop_status = data.shop_status; // 营业时间\n\n      this.shopData.business_time = data.business_time;\n    },\n    // 校验店招是否已上传\n    shopCoverImageValidator: function shopCoverImageValidator() {\n      this.shopCoverImageValidateText = this.shopData.shop_images.length ? '' : '请上传店招';\n    },\n    // 校验门店电话是否输入\n    shopPhoneValidator: function shopPhoneValidator() {\n      var length = this.shopData.shop_phones.filter(function (i) {\n        return i;\n      }).length;\n      this.shopPhoneValidateText = length ? '' : '请输入门店电话';\n      return this.shopPhoneValidateText;\n    },\n    fileChange: function fileChange(data) {\n      if (data.length) {\n        this.shopData.shop_images = cloneDeep(data);\n        this.shopData.shop_images[0].is_cover = 1;\n      } else {\n        this.shopData.shop_images = [];\n      }\n\n      this.shopCoverImageValidator();\n    },\n    editMapChange: function editMapChange(data) {\n      this.editMap = cloneDeep(data);\n    },\n    onShopPhoneChange: function onShopPhoneChange(list) {\n      this.shopData.shop_phones = list;\n      this.shopPhoneValidator();\n    },\n    // 表单提交\n    onHandleSubmit: function onHandleSubmit(e) {\n      var _this2 = this;\n\n      // 确认为提交表单校验\n      e.preventDefault();\n      this.shopCoverImageValidator();\n      this.form.validateFieldsAndScroll(function (err, values) {\n        if (_this2.shopPhoneValidator()) {\n          return;\n        }\n\n        if (!err && _this2.shopCoverImageIsOk) {\n          var _this2$fileListHostir;\n\n          // 过滤空数据\n          _this2.shopData.shop_phones = _this2.shopData.shop_phones.filter(function (i) {\n            return i;\n          });\n          _this2.shopData.shop_name = values.shop_name;\n          _this2.shopData.province_id = _this2.editMap.province.id;\n          _this2.shopData.province_name = _this2.editMap.province.name;\n          _this2.shopData.city_id = _this2.editMap.city.id;\n          _this2.shopData.city_name = _this2.editMap.city.name;\n          _this2.shopData.district_id = _this2.editMap.district.id;\n          _this2.shopData.district_name = _this2.editMap.district.name;\n          _this2.shopData.address = _this2.editMap.address;\n          _this2.shopData.lat = _this2.editMap.lat;\n          _this2.shopData.lng = _this2.editMap.lng;\n          _this2.shopData.email = values.email; // 替换店招\n\n          var i = 0;\n\n          _this2.fileListHostiry.some(function (item, index) {\n            if (item.is_cover) {\n              i = index;\n            }\n          });\n\n          _this2.fileListHostiry.splice(i, 1);\n\n          (_this2$fileListHostir = _this2.fileListHostiry).unshift.apply(_this2$fileListHostir, _toConsumableArray(_this2.shopData.shop_images));\n\n          _this2.shopData.shop_images = cloneDeep(_this2.fileListHostiry);\n\n          _this2.editService.edit(_this2.$searchQuery.id, _this2.shopData).subscribe(function () {\n            _this2.$router.push({\n              name: 'brand-setting-shop-list'\n            });\n          });\n        } else {}\n      });\n    },\n    // shop_name validatorFn\n    shop_name_validator: function shop_name_validator(rule, value, callback) {\n      if (value === undefined || !value) {\n        // eslint-disable-next-line\n        callback('请填写门店名称');\n      } else if (value && !this.pattern.CN_EN_NUM_SPACE('1-20').test(value)) {\n        // eslint-disable-next-line\n        callback('支持中英文、数字,不超过20个字');\n      } else {\n        // eslint-disable-next-line\n        callback();\n      }\n    }\n  }\n};",{"version":3,"sources":["edit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-panel app class=\"page-brand-shop-edit\">\n    <st-form :form=\"form\">\n      <a-row :gutter=\"8\" class=\"page-edit-shop-name-row\">\n        <a-col offset=\"1\" :lg=\"10\">\n          <st-form-item label=\"门店名称\" required>\n            <a-input\n              v-decorator=\"[\n                'shop_name',\n                { rules: [{ validator: shop_name_validator }] }\n              ]\"\n              maxlength=\"20\"\n              placeholder=\"支持中英文、数字,不超过20个字\"\n            ></a-input>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item\n            label=\"门店电话\"\n            required\n            :help=\"shopPhoneValidateText\"\n            :validateStatus=\"shopPhoneValidateText ? 'error' : ''\"\n          >\n            <more-input\n              :length=\"3\"\n              :list=\"shopData.shop_phones\"\n              @change=\"onShopPhoneChange\"\n              placeholder=\"请输入门店电话\"\n            ></more-input>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"门店地址\" required>\n            <map-button\n              :lat=\"editMap.lat\"\n              :lng=\"editMap.lng\"\n              :address=\"editMap.address\"\n              :province=\"editMap.province\"\n              :city=\"editMap.city\"\n              :district=\"editMap.district\"\n              @select=\"editMapChange\"\n            ></map-button>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"邮箱\">\n            <a-input\n              v-decorator=\"[\n                'email',\n                {\n                  rules: [\n                    {\n                      type: 'email',\n                      message: '输入的邮箱格式错误，请重新输入!'\n                    }\n                  ]\n                }\n              ]\"\n              placeholder=\"请输入门店邮箱\"\n            ></a-input>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"23\">\n          <st-form-item label=\"服务设施\">\n            <checkbox-facility-group v-model=\"shopData.service_ids\">\n              <checkbox-facility-item\n                style=\"margin-right:24px\"\n                v-for=\"item in serviceList\"\n                :label=\"item.service_name\"\n                :icon=\"serviceIcon_icon_list[item.service_id]\"\n                :key=\"item.service_id\"\n                :value=\"item.service_id\"\n              ></checkbox-facility-item>\n            </checkbox-facility-group>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"23\">\n          <st-form-item\n            label=\"店招\"\n            v-viewer=\"{ url: 'data-src', toolbar: false }\"\n            required\n            validateStatus=\"error\"\n            :help=\"shopCoverImageValidateText\"\n          >\n            <st-image-upload\n              :cropperModal=\"cropperModal\"\n              :sizeLimit=\"5\"\n              :list=\"fileList\"\n              @change=\"fileChange\"\n              width=\"240px\"\n              height=\"135px\"\n            >\n              <a-icon type=\"plus\" />\n              <div class=\"page-upload-text\">上传店招</div>\n              <div class=\"page-upload-text\">大小不超过5M，建议尺寸16:9</div>\n            </st-image-upload>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"22\">\n          <st-form-item label=\"营业时间\">\n            <shop-hour-picker\n              v-model=\"shopData.business_time\"\n            ></shop-hour-picker>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col offset=\"1\" :lg=\"22\">\n          <st-form-item label=\" \">\n            <st-button\n              type=\"primary\"\n              @click=\"onHandleSubmit\"\n              :loading=\"editLoading.edit\"\n            >\n              提交\n            </st-button>\n          </st-form-item>\n        </a-col>\n      </a-row>\n    </st-form>\n  </st-panel>\n</template>\n<script>\nimport { UserService } from '@/services/user.service'\nimport { EditService } from './edit.service'\nimport { PatternService } from '@/services/pattern.service'\nimport { cloneDeep } from 'lodash-es'\nimport CheckboxFacilityGroup from '@/views/biz-components/checkbox-facility/checkbox-facility-group'\nimport CheckboxFacilityItem from '@/views/biz-components/checkbox-facility/checkbox-facility-item'\nimport MapButton from '@/views/components/map-button#/map-button'\nimport ShopHourPicker from '@/views/components/hour-picker#/hour-picker'\nimport StImageUpload from '@/views/components/image-upload#/image-upload.vue'\nimport MoreInput from '@/views/components/more-input#/more-input.vue'\n\nexport default {\n  name: 'EditShopSetting',\n  components: {\n    CheckboxFacilityGroup,\n    CheckboxFacilityItem,\n    MapButton,\n    ShopHourPicker,\n    StImageUpload,\n    MoreInput\n  },\n  serviceInject() {\n    return {\n      pattern: PatternService,\n      editService: EditService,\n      userService: UserService\n    }\n  },\n  rxState() {\n    return {\n      serviceList: this.editService.serviceList$,\n      shopInfo: this.editService.shopInfo$,\n      editLoading: this.editService.loading$\n    }\n  },\n  mounted() {\n    this.init(this.shopInfo)\n  },\n  data() {\n    return {\n      editMap: {\n        lat: '',\n        lng: '',\n        address: '',\n        province: {},\n        city: {},\n        district: {}\n      },\n      fileList: [],\n      fileListHostiry: [],\n      cropperModal: {},\n      shopData: {\n        shop_name: '',\n        province_id: null,\n        city_id: null,\n        district_id: null,\n        address: '',\n        shop_phones: [],\n        shop_status: 1,\n        lat: '',\n        lng: '',\n        service_ids: [],\n        business_time: [],\n        email: '',\n        shop_images: []\n      },\n      shopCoverImageValidateText: '',\n      shopPhoneValidateText: '',\n      serviceIcon_icon_list: {\n        1: 'WIFI',\n        2: 'park',\n        3: 'shower',\n        4: 'medical',\n        5: 'heating',\n        6: 'snow',\n        7: 'nosmoking',\n        8: 'energy'\n      }\n    }\n  },\n  beforeCreate() {\n    this.form = this.$form.createForm(this)\n  },\n  computed: {\n    shopCoverImageIsOk() {\n      return this.shopCoverImageValidateText === ''\n    }\n  },\n  methods: {\n    // 获取门店信息\n    init(data) {\n      this.form.setFieldsValue({\n        shop_name: data.shop_name,\n        email: data.email\n      })\n      // 门店电话\n      this.shopData.shop_phones = cloneDeep(data.shop_phones)\n      // 门店地址\n      this.editMap.lat = data.lat\n      this.editMap.lng = data.lng\n      this.editMap.address = data.shop_position.address\n      this.editMap.province.id = data.shop_position.province_id\n      this.editMap.province.name = data.shop_position.province_name\n      this.editMap.city.id = data.shop_position.city_id\n      this.editMap.city.name = data.shop_position.city_name\n      this.editMap.district.id = data.shop_position.district_id\n      this.editMap.district.name = data.shop_position.district_name\n      // 服务设施\n      data.shop_services.forEach(i => {\n        this.shopData.service_ids.push(i.service_id)\n      })\n      // 店招\n      this.fileListHostiry = cloneDeep(data.shop_images)\n      this.fileList = cloneDeep(data.shop_images.filter(i => i.is_cover))\n      this.shopData.shop_images = cloneDeep(\n        data.shop_images.filter(i => i.is_cover)\n      )\n      // 营业状态\n      this.shopData.shop_status = data.shop_status\n      // 营业时间\n      this.shopData.business_time = data.business_time\n    },\n    // 校验店招是否已上传\n    shopCoverImageValidator() {\n      this.shopCoverImageValidateText = this.shopData.shop_images.length\n        ? ''\n        : '请上传店招'\n    },\n    // 校验门店电话是否输入\n    shopPhoneValidator() {\n      const length = this.shopData.shop_phones.filter(i => i).length\n      this.shopPhoneValidateText = length ? '' : '请输入门店电话'\n      return this.shopPhoneValidateText\n    },\n    fileChange(data) {\n      if (data.length) {\n        this.shopData.shop_images = cloneDeep(data)\n        this.shopData.shop_images[0].is_cover = 1\n      } else {\n        this.shopData.shop_images = []\n      }\n      this.shopCoverImageValidator()\n    },\n    editMapChange(data) {\n      this.editMap = cloneDeep(data)\n    },\n    onShopPhoneChange(list) {\n      this.shopData.shop_phones = list\n      this.shopPhoneValidator()\n    },\n    // 表单提交\n    onHandleSubmit(e) {\n      // 确认为提交表单校验\n      e.preventDefault()\n      this.shopCoverImageValidator()\n      this.form.validateFieldsAndScroll((err, values) => {\n        if (this.shopPhoneValidator()) {\n          return\n        }\n        if (!err && this.shopCoverImageIsOk) {\n          // 过滤空数据\n          this.shopData.shop_phones = this.shopData.shop_phones.filter(i => i)\n          this.shopData.shop_name = values.shop_name\n          this.shopData.province_id = this.editMap.province.id\n          this.shopData.province_name = this.editMap.province.name\n          this.shopData.city_id = this.editMap.city.id\n          this.shopData.city_name = this.editMap.city.name\n          this.shopData.district_id = this.editMap.district.id\n          this.shopData.district_name = this.editMap.district.name\n          this.shopData.address = this.editMap.address\n          this.shopData.lat = this.editMap.lat\n          this.shopData.lng = this.editMap.lng\n          this.shopData.email = values.email\n          // 替换店招\n          let i = 0\n          this.fileListHostiry.some((item, index) => {\n            if (item.is_cover) {\n              i = index\n            }\n          })\n          this.fileListHostiry.splice(i, 1)\n          this.fileListHostiry.unshift(...this.shopData.shop_images)\n          this.shopData.shop_images = cloneDeep(this.fileListHostiry)\n          this.editService\n            .edit(this.$searchQuery.id, this.shopData)\n            .subscribe(() => {\n              this.$router.push({\n                name: 'brand-setting-shop-list'\n              })\n            })\n        } else {\n        }\n      })\n    },\n    // shop_name validatorFn\n    shop_name_validator(rule, value, callback) {\n      if (value === undefined || !value) {\n        // eslint-disable-next-line\n        callback('请填写门店名称')\n      } else if (value && !this.pattern.CN_EN_NUM_SPACE('1-20').test(value)) {\n        // eslint-disable-next-line\n        callback('支持中英文、数字,不超过20个字')\n      } else {\n        // eslint-disable-next-line\n        callback()\n      }\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/brand/setting/shop"}]}