{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/batch/add-edit-course.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/batch/add-edit-course.vue","mtime":1600926555894},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { AddEditCourseService } from \"./add-edit-course.service\";\nimport { TeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/team/service#/common.service';\nimport { PersonalTeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/personal-team/service#/common.service';\nimport { UserService } from '@/services/user.service';\nimport { ruleOptions } from \"./add-edit-course.config\";\nimport { RESERVE_LIMIT_TYPE } from '@/constants/course/team';\nexport default {\n  serviceInject: function serviceInject() {\n    return {\n      addEditCourseService: AddEditCourseService,\n      teamScheduleCommonService: TeamScheduleCommonService,\n      personalTeamScheduleCommonService: PersonalTeamScheduleCommonService,\n      userService: UserService\n    };\n  },\n  rxState: function rxState() {\n    var teamService = this.teamScheduleCommonService;\n    var personalService = this.personalTeamScheduleCommonService;\n    return {\n      loading: this.addEditCourseService.loading$,\n      weekDay: this.userService.getOptions$('shop.week_day'),\n      coachOptionTeam: teamService.coachOptions$,\n      courseOptionTeam: teamService.courseOptions$,\n      courtOptionTeam: teamService.courtOptions$,\n      courseOptionSmall: personalService.courseOptions$,\n      coachOptionSmall: personalService.coachOptions$\n    };\n  },\n  filters: {\n    formatDate: function formatDate(val) {\n      return val ? moment(val) : undefined;\n    }\n  },\n  name: 'addEditCourseService',\n  bem: {\n    basic: 'modal-schedule-batch-add-edit-course'\n  },\n  props: {\n    id: {\n      type: [Number, String],\n      default: ''\n    },\n    type: {\n      type: String,\n      default: ''\n    }\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      coachOptions: [],\n      courseOptions: [],\n      courtOptions: [],\n      scheduleInfo: [],\n      show: false,\n      tableTips: '',\n      // 表单中表格提交错误提示语\n      tableErr: false,\n      // 表格是否有错\n      RESERVE_LIMIT_TYPE: RESERVE_LIMIT_TYPE\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    // 弹窗开启有id为编辑\n    if (this.id) {\n      // type:team为团课获取团课列表，small为私教小团课获取私教小团课列表\n      var functionName = this.type === 'team' ? 'getTeamInfo' : 'getSmallInfo';\n      this.addEditCourseService[functionName](this.id).subscribe(function (res) {\n        // 显示数据回显\n        _this.form.setFieldsValue({\n          templateName: res.info.template_name,\n          maxNumber: res.info.max_number\n        });\n\n        if (_this.type === 'team' && res.info.reserve_limit_type) {\n          // 预约高级设置初始化\n          switch (res.info.reserve_limit_type) {\n            case RESERVE_LIMIT_TYPE.DATE:\n              _this.form.setFieldsValue({\n                reserve_limit_type: res.info.reserve_limit_type,\n                reserve_limit_date: moment(res.info.reserve_limit_time)\n              });\n\n              break;\n\n            case RESERVE_LIMIT_TYPE.TIME:\n              _this.form.setFieldsValue({\n                reserve_limit_type: res.info.reserve_limit_type,\n                reserve_limit_time: res.info.reserve_limit_time\n              });\n\n              break;\n          }\n        }\n\n        _this.scheduleInfo = res.info.schedule_info.map(function (item) {\n          return {\n            course_id: item.course_id,\n            coach_id: item.coach_id,\n            court_id: [item.court_id, item.court_site_id],\n            people_number: item.people_number,\n            course_fee: item.course_fee,\n            week_day: item.week_day,\n            is_support_reserve_once: item.is_support_reserve_once,\n            start_time: item.start_time ? moment(item.start_time, 'HH:mm') : undefined\n          };\n        });\n      });\n    } // 获取团课和私教小团课的课程和教练的选择项\n\n\n    if (this.type === 'team') {\n      this.coachOptions = this.coachOptionTeam; // 教练\n\n      this.courseOptions = this.courseOptionTeam; // 课程\n\n      this.courtOptions = this.courtOptionTeam; // 场地\n    } else {\n      this.coachOptions = this.coachOptionSmall; // 教练\n\n      this.courseOptions = this.courseOptionSmall; // 课程\n    }\n  },\n  methods: {\n    // 新增课表\n    addCourse: function addCourse() {\n      this.tableTips = '';\n      this.tableErr = false;\n      this.scheduleInfo.push({\n        course_id: null,\n        coach_id: null,\n        court_id: [],\n        people_number: '',\n        course_fee: '',\n        week_day: null,\n        start_time: null,\n        is_support_reserve_once: 0\n      });\n    },\n    // 排课安排删除\n    delRow: function delRow(index) {\n      this.scheduleInfo.splice(index, 1);\n      this.tableTips = '';\n      this.tableErr = false;\n    },\n    // 数据提交\n    save: function save(e) {\n      var _this2 = this;\n\n      var isOk = this.verifyData();\n      this.form.validate().then(function (values) {\n        // 对提交上课安排数据处理\n        if (isOk) {\n          return;\n        }\n\n        var scheduleInfos = _this2.scheduleInfo.map(function (item) {\n          return {\n            week_day: item.week_day,\n            course_id: item.course_id,\n            start_time: moment(item.start_time).format('HH:mm'),\n            coach_id: item.coach_id,\n            court_id: item.court_id[0] || 0,\n            court_site_id: item.court_id[1] || 0,\n            people_number: item.people_number,\n            is_support_reserve_once: item.is_support_reserve_once,\n            course_fee: item.is_support_reserve_once ? item.course_fee : undefined\n          };\n        }); // 最终提交数据\n\n\n        var params = {\n          template_name: values.templateName,\n          max_number: values.maxNumber,\n          start_time: moment(values.dateTime[0]).format('YYYY-MM-DD HH:mm'),\n          end_time: moment(values.dateTime[1]).format('YYYY-MM-DD HH:mm'),\n          schedule_info: scheduleInfos\n        }; // 团课预约高级设置\n\n        if (_this2.type === 'team') {\n          switch (values.reserve_limit_type) {\n            case RESERVE_LIMIT_TYPE.DATE:\n              params.reserve_limit_time = values.reserve_limit_date.format('YYYY-MM-DD HH:mm');\n              params.reserve_limit_type = values.reserve_limit_type;\n              break;\n\n            case RESERVE_LIMIT_TYPE.TIME:\n              params.reserve_limit_time = +values.reserve_limit_time;\n              params.reserve_limit_type = values.reserve_limit_type;\n              break;\n\n            default:\n              params.reserve_limit_type = RESERVE_LIMIT_TYPE.NOT_LIMIT;\n              break;\n          }\n        }\n\n        if (_this2.id) {\n          // 有id为编辑（team为调取团课编辑接口，small为调取私教小团课编辑接口）\n          var editName = _this2.type === 'team' ? 'editTeamDetail' : 'editSmallDetail';\n\n          _this2.addEditCourseService[editName](_this2.id, params).subscribe(function (res) {\n            _this2.$emit('success', res);\n\n            _this2.show = false;\n          });\n        } else {\n          // 没id为新增（team为调取团课新增接口，small为调取私教小团课新增接口）\n          var addName = _this2.type === 'team' ? 'addTeamDetail' : 'addSmallDetail';\n\n          _this2.addEditCourseService[addName](params).subscribe(function (res) {\n            _this2.$emit('success', res);\n\n            _this2.show = false;\n          });\n        }\n      });\n    },\n    // 表格提交数据校验\n    verifyData: function verifyData(isInput) {\n      if (isInput) {\n        this.tableTips = '';\n        this.tableErr = false;\n        return;\n      }\n\n      if (!this.scheduleInfo.length) {\n        this.tableTips = '请新增上课安排';\n        this.tableErr = true;\n        return true;\n      }\n\n      for (var i = 0; i < this.scheduleInfo.length; i++) {\n        var item = this.scheduleInfo[i];\n\n        if (!item.week_day || !item.course_id || !item.start_time || !item.coach_id || !item.people_number || item.is_support_reserve_once && !item.course_fee) {\n          this.tableTips = '请正确填写表格数据';\n          this.tableErr = true;\n          return true;\n        }\n      }\n\n      this.tableTips = '';\n      this.tableErr = false;\n      return false;\n    },\n    onLimitTypeChange: function onLimitTypeChange() {\n      this.form.setFieldsValue({\n        reserve_limit_time: '',\n        reserve_limit_date: null\n      });\n    }\n  }\n};",{"version":3,"sources":["add-edit-course.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal\n    :title=\"\n      id\n        ? `编辑${type === 'small' ? '私教小' : ''}团课周课表`\n        : `新增${type === 'small' ? '私教小' : ''}团课周课表`\n    \"\n    @ok=\"save\"\n    okText=\"确定\"\n    v-model=\"show\"\n    :loading=\"\n      id\n        ? type === 'team'\n          ? loading.editTeamDetail\n          : loading.editSmallDetail\n        : type === 'team'\n        ? loading.addTeamDetail\n        : loading.addSmallDetail\n    \"\n    width=\"1200px\"\n    :class=\"basic()\"\n  >\n    <div :class=\"basic('form')\">\n      <st-form :form=\"form\" labelWidth=\"96px\">\n        <st-form-item label=\"课表名称\" required>\n          <a-input\n            placeholder=\"请输入课表名称\"\n            v-decorator=\"decorators.templateName\"\n            :class=\"basic('form-name')\"\n            maxlength=\"30\"\n          />\n        </st-form-item>\n        <st-form-item label=\"排期起止时间\" required>\n          <a-range-picker\n            v-decorator=\"decorators.dateTime\"\n            :disabledDays=\"180\"\n            :showTime=\"{ format: 'HH:mm' }\"\n            format=\"YYYY-MM-DD HH:mm\"\n          />\n        </st-form-item>\n        <st-form-item label=\"排课限制\">\n          最多排\n          <st-input-number\n            placeholder=\"不填则默认排满\"\n            :class=\"basic('form-number')\"\n            v-decorator=\"decorators.maxNumber\"\n          >\n            <span slot=\"addonAfter\">节</span>\n          </st-input-number>\n        </st-form-item>\n        <st-form-item\n          label=\"每周上课安排\"\n          :help=\"tableTips\"\n          :validateStatus=\"tableErr ? 'error' : ''\"\n          required\n        >\n          <div :class=\"basic('border-box')\">\n            <st-form-table hoverable :isEmpty=\"false\">\n              <thead>\n                <tr>\n                  <th>\n                    <label class=\"color-danger\">*</label>\n                    星期\n                  </th>\n                  <th>\n                    <label class=\"color-danger\">*</label>\n                    课程\n                  </th>\n                  <th>\n                    <label class=\"color-danger\">*</label>\n                    开始时间\n                  </th>\n                  <th>\n                    <label class=\"color-danger\">*</label>\n                    上课{{ $c('coach') }}\n                  </th>\n                  <th v-if=\"type === 'team'\">场地</th>\n                  <th>\n                    <label class=\"color-danger\">*</label>\n                    人数\n                  </th>\n                  <th style=\"width: 120px\">\n                    单节预约\n                    <st-help-tooltip id=\"TBCPC005\" />\n                  </th>\n                  <th style=\"width:60px\">操作</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr>\n                  <td colspan=\"8\" class=\"st-form-table__add\">\n                    <st-button\n                      type=\"dashed\"\n                      icon=\"add\"\n                      block\n                      @click=\"addCourse\"\n                    >\n                      新增\n                    </st-button>\n                  </td>\n                </tr>\n                <template v-for=\"(item, index) in scheduleInfo\">\n                  <tr :key=\"index\">\n                    <td>\n                      <a-select\n                        placeholder=\"请选择星期\"\n                        style=\"width: 86px\"\n                        v-model=\"item.week_day\"\n                        @change=\"verifyData(true)\"\n                      >\n                        <a-select-option\n                          v-for=\"week in weekDay\"\n                          :key=\"week.value\"\n                        >\n                          {{ week.label }}\n                        </a-select-option>\n                      </a-select>\n                    </td>\n                    <td>\n                      <a-select\n                        placeholder=\"请选择课程\"\n                        style=\"width: 112px\"\n                        v-model=\"item.course_id\"\n                        @change=\"verifyData(true)\"\n                      >\n                        <a-select-option\n                          v-for=\"course in courseOptions\"\n                          :key=\"course.id\"\n                        >\n                          {{\n                            type === 'team' ? course.course_name : course.name\n                          }}\n                        </a-select-option>\n                      </a-select>\n                    </td>\n                    <td>\n                      <a-time-picker\n                        style=\"width: 108px\"\n                        placeholder=\"选择时间\"\n                        format=\"HH:mm\"\n                        v-model=\"item.start_time\"\n                        @change=\"verifyData(true)\"\n                      />\n                    </td>\n                    <td>\n                      <a-select\n                        :placeholder=\"`请选择上课${$c('coach')}`\"\n                        style=\"width: 112px\"\n                        v-model=\"item.coach_id\"\n                        @change=\"verifyData(true)\"\n                      >\n                        <a-select-option\n                          v-for=\"coach in coachOptions\"\n                          :key=\"coach.id\"\n                        >\n                          {{ type === 'team' ? coach.staff_name : coach.name }}\n                        </a-select-option>\n                      </a-select>\n                    </td>\n                    <td v-if=\"type === 'team'\">\n                      <a-cascader\n                        style=\"width: 112px\"\n                        placeholder=\"请选择场地\"\n                        v-model=\"item.court_id\"\n                        :options=\"courtOptions\"\n                        :fieldNames=\"{\n                          label: 'name',\n                          value: 'id',\n                          children: 'children'\n                        }\"\n                      />\n                    </td>\n                    <td>\n                      <st-input-number\n                        style=\"width: 90px\"\n                        v-model=\"item.people_number\"\n                        @input=\"verifyData(true)\"\n                      >\n                        <span slot=\"addonAfter\">人</span>\n                      </st-input-number>\n                    </td>\n                    <td>\n                      <st-checkbox\n                        v-model=\"item.is_support_reserve_once\"\n                        @change=\"verifyData(true)\"\n                      >\n                        支持\n                      </st-checkbox>\n                      <st-input-number\n                        v-if=\"item.is_support_reserve_once\"\n                        :float=\"true\"\n                        style=\"width: 140px; margin-left: -8px\"\n                        v-model=\"item.course_fee\"\n                        @input=\"verifyData(true)\"\n                        class=\"mg-t4\"\n                      >\n                        <span slot=\"addonAfter\">元/节</span>\n                      </st-input-number>\n                    </td>\n                    <td>\n                      <template>\n                        <a @click=\"delRow(index)\">删除</a>\n                      </template>\n                    </td>\n                  </tr>\n                </template>\n              </tbody>\n            </st-form-table>\n          </div>\n        </st-form-item>\n        <st-form-item label=\"预约高级设置\" v-if=\"type === 'team'\">\n          <a-radio-group\n            v-decorator=\"decorators.reserve_limit_type\"\n            @change=\"onLimitTypeChange\"\n          >\n            <st-form-item style=\"margin-left: -24px\">\n              <a-radio :value=\"RESERVE_LIMIT_TYPE.NOT_LIMIT\">不设置</a-radio>\n            </st-form-item>\n            <st-form-item style=\"margin-left: -24px\">\n              <a-radio :value=\"RESERVE_LIMIT_TYPE.DATE\">\n                定时开放预约\n                <a-date-picker\n                  style=\"width: 180px\"\n                  placeholder=\"请选择时间\"\n                  :showTime=\"{ format: 'HH:mm' }\"\n                  format=\"YYYY-MM-DD HH:mm\"\n                  :disabled=\"\n                    form.getFieldValue('reserve_limit_type') !==\n                      RESERVE_LIMIT_TYPE.DATE\n                  \"\n                  v-decorator=\"decorators.reserve_limit_date\"\n                >\n                  <a-icon slot=\"suffixIcon\" type=\"clock-circle\" />\n                </a-date-picker>\n              </a-radio>\n            </st-form-item>\n            <st-form-item style=\"margin-left: -24px\">\n              <a-radio :value=\"RESERVE_LIMIT_TYPE.TIME\">\n                课程需提前\n                <st-input-number\n                  style=\"width: 100px\"\n                  placeholder=\"请输入\"\n                  :min=\"1\"\n                  :max=\"168\"\n                  :disabled=\"\n                    form.getFieldValue('reserve_limit_type') !==\n                      RESERVE_LIMIT_TYPE.TIME\n                  \"\n                  v-decorator=\"decorators.reserve_limit_time\"\n                />\n                小时预约\n              </a-radio>\n            </st-form-item>\n          </a-radio-group>\n        </st-form-item>\n      </st-form>\n    </div>\n  </st-modal>\n</template>\n<script>\nimport { AddEditCourseService } from './add-edit-course.service'\nimport { TeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/team/service#/common.service'\nimport { PersonalTeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/personal-team/service#/common.service'\nimport { UserService } from '@/services/user.service'\nimport { ruleOptions } from './add-edit-course.config'\nimport { RESERVE_LIMIT_TYPE } from '@/constants/course/team'\n\nexport default {\n  serviceInject() {\n    return {\n      addEditCourseService: AddEditCourseService,\n      teamScheduleCommonService: TeamScheduleCommonService,\n      personalTeamScheduleCommonService: PersonalTeamScheduleCommonService,\n      userService: UserService\n    }\n  },\n  rxState() {\n    const teamService = this.teamScheduleCommonService\n    const personalService = this.personalTeamScheduleCommonService\n    return {\n      loading: this.addEditCourseService.loading$,\n      weekDay: this.userService.getOptions$('shop.week_day'),\n      coachOptionTeam: teamService.coachOptions$,\n      courseOptionTeam: teamService.courseOptions$,\n      courtOptionTeam: teamService.courtOptions$,\n      courseOptionSmall: personalService.courseOptions$,\n      coachOptionSmall: personalService.coachOptions$\n    }\n  },\n  filters: {\n    formatDate(val) {\n      return val ? moment(val) : undefined\n    }\n  },\n  name: 'addEditCourseService',\n  bem: {\n    basic: 'modal-schedule-batch-add-edit-course'\n  },\n  props: {\n    id: {\n      type: [Number, String],\n      default: ''\n    },\n    type: {\n      type: String,\n      default: ''\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      coachOptions: [],\n      courseOptions: [],\n      courtOptions: [],\n      scheduleInfo: [],\n      show: false,\n      tableTips: '', // 表单中表格提交错误提示语\n      tableErr: false, // 表格是否有错\n      RESERVE_LIMIT_TYPE\n    }\n  },\n  created() {\n    // 弹窗开启有id为编辑\n    if (this.id) {\n      // type:team为团课获取团课列表，small为私教小团课获取私教小团课列表\n      let functionName = this.type === 'team' ? 'getTeamInfo' : 'getSmallInfo'\n      this.addEditCourseService[functionName](this.id).subscribe(res => {\n        // 显示数据回显\n        this.form.setFieldsValue({\n          templateName: res.info.template_name,\n          maxNumber: res.info.max_number\n        })\n        if (this.type === 'team' && res.info.reserve_limit_type) {\n          // 预约高级设置初始化\n          switch (res.info.reserve_limit_type) {\n            case RESERVE_LIMIT_TYPE.DATE:\n              this.form.setFieldsValue({\n                reserve_limit_type: res.info.reserve_limit_type,\n                reserve_limit_date: moment(res.info.reserve_limit_time)\n              })\n              break\n            case RESERVE_LIMIT_TYPE.TIME:\n              this.form.setFieldsValue({\n                reserve_limit_type: res.info.reserve_limit_type,\n                reserve_limit_time: res.info.reserve_limit_time\n              })\n              break\n          }\n        }\n        this.scheduleInfo = res.info.schedule_info.map(item => {\n          return {\n            course_id: item.course_id,\n            coach_id: item.coach_id,\n            court_id: [item.court_id, item.court_site_id],\n            people_number: item.people_number,\n            course_fee: item.course_fee,\n            week_day: item.week_day,\n            is_support_reserve_once: item.is_support_reserve_once,\n            start_time: item.start_time\n              ? moment(item.start_time, 'HH:mm')\n              : undefined\n          }\n        })\n      })\n    }\n    // 获取团课和私教小团课的课程和教练的选择项\n    if (this.type === 'team') {\n      this.coachOptions = this.coachOptionTeam // 教练\n      this.courseOptions = this.courseOptionTeam // 课程\n      this.courtOptions = this.courtOptionTeam // 场地\n    } else {\n      this.coachOptions = this.coachOptionSmall // 教练\n      this.courseOptions = this.courseOptionSmall // 课程\n    }\n  },\n  methods: {\n    // 新增课表\n    addCourse() {\n      this.tableTips = ''\n      this.tableErr = false\n      this.scheduleInfo.push({\n        course_id: null,\n        coach_id: null,\n        court_id: [],\n        people_number: '',\n        course_fee: '',\n        week_day: null,\n        start_time: null,\n        is_support_reserve_once: 0\n      })\n    },\n    // 排课安排删除\n    delRow(index) {\n      this.scheduleInfo.splice(index, 1)\n      this.tableTips = ''\n      this.tableErr = false\n    },\n    // 数据提交\n    save(e) {\n      let isOk = this.verifyData()\n      this.form.validate().then(values => {\n        // 对提交上课安排数据处理\n        if (isOk) {\n          return\n        }\n        let scheduleInfos = this.scheduleInfo.map(item => {\n          return {\n            week_day: item.week_day,\n            course_id: item.course_id,\n            start_time: moment(item.start_time).format('HH:mm'),\n            coach_id: item.coach_id,\n            court_id: item.court_id[0] || 0,\n            court_site_id: item.court_id[1] || 0,\n            people_number: item.people_number,\n            is_support_reserve_once: item.is_support_reserve_once,\n            course_fee: item.is_support_reserve_once\n              ? item.course_fee\n              : undefined\n          }\n        })\n        // 最终提交数据\n        let params = {\n          template_name: values.templateName,\n          max_number: values.maxNumber,\n          start_time: moment(values.dateTime[0]).format('YYYY-MM-DD HH:mm'),\n          end_time: moment(values.dateTime[1]).format('YYYY-MM-DD HH:mm'),\n          schedule_info: scheduleInfos\n        }\n        // 团课预约高级设置\n        if (this.type === 'team') {\n          switch (values.reserve_limit_type) {\n            case RESERVE_LIMIT_TYPE.DATE:\n              params.reserve_limit_time = values.reserve_limit_date.format(\n                'YYYY-MM-DD HH:mm'\n              )\n              params.reserve_limit_type = values.reserve_limit_type\n              break\n            case RESERVE_LIMIT_TYPE.TIME:\n              params.reserve_limit_time = +values.reserve_limit_time\n              params.reserve_limit_type = values.reserve_limit_type\n              break\n            default:\n              params.reserve_limit_type = RESERVE_LIMIT_TYPE.NOT_LIMIT\n              break\n          }\n        }\n        if (this.id) {\n          // 有id为编辑（team为调取团课编辑接口，small为调取私教小团课编辑接口）\n          let editName =\n            this.type === 'team' ? 'editTeamDetail' : 'editSmallDetail'\n          this.addEditCourseService[editName](this.id, params).subscribe(\n            res => {\n              this.$emit('success', res)\n              this.show = false\n            }\n          )\n        } else {\n          // 没id为新增（team为调取团课新增接口，small为调取私教小团课新增接口）\n          let addName =\n            this.type === 'team' ? 'addTeamDetail' : 'addSmallDetail'\n          this.addEditCourseService[addName](params).subscribe(res => {\n            this.$emit('success', res)\n            this.show = false\n          })\n        }\n      })\n    },\n    // 表格提交数据校验\n    verifyData(isInput) {\n      if (isInput) {\n        this.tableTips = ''\n        this.tableErr = false\n        return\n      }\n      if (!this.scheduleInfo.length) {\n        this.tableTips = '请新增上课安排'\n        this.tableErr = true\n        return true\n      }\n      for (let i = 0; i < this.scheduleInfo.length; i++) {\n        let item = this.scheduleInfo[i]\n        if (\n          !item.week_day ||\n          !item.course_id ||\n          !item.start_time ||\n          !item.coach_id ||\n          !item.people_number ||\n          (item.is_support_reserve_once && !item.course_fee)\n        ) {\n          this.tableTips = '请正确填写表格数据'\n          this.tableErr = true\n          return true\n        }\n      }\n      this.tableTips = ''\n      this.tableErr = false\n      return false\n    },\n    onLimitTypeChange() {\n      this.form.setFieldsValue({\n        reserve_limit_time: '',\n        reserve_limit_date: null\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/schedule/batch"}]}