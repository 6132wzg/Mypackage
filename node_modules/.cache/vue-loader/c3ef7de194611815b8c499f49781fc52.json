{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/member/member-search/member-search.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/member/member-search/member-search.vue","mtime":1601345390864},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { MemberSearchService } from './member-search.service'\nimport { merge } from 'lodash-es'\nimport { ruleOptions } from './member-search.config'\nimport { PatternService } from '@/services/pattern.service'\nimport InputPhone from '@/views/biz-components/account/input-phone/input-phone'\nexport default {\n  name: 'MemberSearch',\n  model: {\n    event: 'change'\n  },\n  props: {\n    value: {\n      type: String\n    },\n    id: {\n      type: String\n    },\n    label: {\n      type: String,\n      default: '购买会员'\n    },\n    /**\n     * 会员查询类型 transaction | transfer\n     */\n    type: {\n      type: String,\n      default: 'transaction'\n      // required: true\n    },\n    placeholder: {\n      type: String,\n      default: '输入手机号或会员名搜索'\n    },\n    // 外部 form 表单 必传\n    form: {\n      type: Object,\n      required: true\n    },\n    fields: {\n      type: Object,\n      default: () => ({})\n    },\n    // 回填会员填写信息\n    memberInfo: {\n      type: Object\n      // default: () => {\n      //   return {\n      //     member_id: 110676207534127,\n      //     member_name: '张飞123222',\n      //     member_mobile: 19134752085\n      //   }\n      // }\n    },\n    saleRangeType: {\n      type: Number,\n      default: 1\n    },\n    isSoldDeal: {\n      type: Boolean,\n      default: false\n    }\n  },\n  serviceInject() {\n    return {\n      memberSearchService: MemberSearchService,\n      pattern: PatternService\n    }\n  },\n  serviceProviders() {\n    return [MemberSearchService]\n  },\n  rxState() {\n    const { memberList$, loading$, id_types$ } = this.memberSearchService\n    return {\n      memberList$,\n      loading$,\n      parent_types: this.memberSearchService.parent_types$,\n      id_types: this.memberSearchService.id_types$\n    }\n  },\n\n  data() {\n    return {\n      memberSearchText: '',\n      searchMemberIsShow: true,\n      personModel: 0,\n      selectInfo: {},\n      disabledParentMobile: false,\n      idCardValidatorText: '',\n      cardNumValidatorText: '',\n      pidValidatorText: ''\n    }\n  },\n  computed: {\n    ruleOptions,\n    decorators() {\n      return this.form.addDecorators(this.ruleOptions)\n    },\n    usedFields() {\n      return merge(\n        {\n          member_id: 'member_id',\n          mobile: 'mobile',\n          member_name: 'member_name',\n          parent_name: 'parent_name',\n          is_minors: 'is_minors',\n          parent_mobile: 'parent_mobile',\n          parent_user_role: 'parent_user_role',\n          id_card: 'id_card',\n          id_card_type: 'id_card_type',\n          card_num: 'card_num',\n          physical_id: 'physical_id'\n        },\n        this.fields\n      )\n    },\n    memberId() {\n      return this.usedFields.member_id\n    },\n    memberMobile() {\n      return this.usedFields.mobile\n    },\n    memberName() {\n      return this.usedFields.member_name\n    },\n    parentName() {\n      return this.usedFields.parent_name\n    },\n    isMinors() {\n      return this.usedFields.is_minors\n    },\n    parentMobile() {\n      return this.usedFields.parent_mobile\n    },\n    parentUserRole() {\n      return this.usedFields.parent_user_role\n    },\n    idCard() {\n      return this.usedFields.id_card\n    },\n    idCardType() {\n      return this.usedFields.id_card_type\n    },\n    cardNum() {\n      return this.usedFields.card_num\n    },\n    physicalId() {\n      return this.usedFields.physical_id\n    }\n  },\n  methods: {\n    idCardValidator(e) {\n      let value = e.target.value\n      let pattern = this.pattern\n      let id_card_type = this.form.getFieldValue('id_card_type')\n      this.idCardValidatorText = ''\n      if (id_card_type === 1 && value && !pattern.ID.test(value)) {\n        this.idCardValidatorText = '请填写正确的身份证号'\n      }\n      if (id_card_type === 2 && value && !pattern.PASSPORT.test(value)) {\n        this.idCardValidatorText = '请填写正确的护照号码'\n      }\n    },\n    cardNumValidator(e) {\n      let value = e.target.value\n      if (!value || value.length > 20) {\n        this.cardNumValidatorText = '请输入正确格式的卡号'\n      } else {\n        this.cardNumValidatorText = ''\n      }\n    },\n    pidValidator(e) {\n      let value = e.target.value\n      if (!value || value.length > 10) {\n        this.pidValidatorText = '请输入正确格式的物理ID'\n      } else {\n        this.pidValidatorText = ''\n      }\n    },\n    onChangeParentMobile(val) {\n      setTimeout(() => {\n        this.form.validate(['parent_mobile']).then(values => {\n          val.mobile = val.phone\n          this.memberSearchService.getParentInfoByPhone(val).subscribe(res => {\n            if (res.exists) {\n              this.disabledParentMobile = true\n              this.form.setFieldsValue({\n                parent_name: res.info.member_name\n              })\n            } else {\n              this.disabledParentMobile = false\n              this.form.setFieldsValue({\n                parent_name: ''\n              })\n            }\n          })\n        })\n      })\n    },\n    selectItemLabel(item) {\n      if (item.is_minors === 1) {\n        return `${item.member_name}(未成年) ${item.parent_mobile}(${item.parent_user_role})`\n      }\n      return `${item.member_name} ${item.mobile}`\n    },\n    onSelectMember(val) {\n      console.log('memberList', this.memberList$)\n      this.selectInfo = val\n        ? this.memberList$.filter(item => item.id === val)[0]\n        : {}\n      this.form.setFieldsValue({\n        [this.memberId]: this.selectInfo.id || undefined,\n        [this.physicalId]: this.selectInfo.physical_id || undefined,\n        [this.idCard]: this.selectInfo.id_card || undefined,\n        [this.cardNum]: this.selectInfo.card_num || undefined,\n        [this.idCardType]: this.selectInfo.id_card_type || 1\n      })\n      console.log('this.selectInfo', this.selectInfo)\n      // setTimeout(() => {\n\n      // })\n      this.$emit('select', val)\n    },\n    onChangeMember(val) {\n      console.log('onChangeMember', val)\n      if (!val) {\n        this.onSelectMember(val)\n      } else {\n        // TODO: b254dd12 fix: 购买会员change事件 三个月前\n        this.$emit('change', val)\n      }\n    },\n    onChangeModel(val) {\n      this.personModel = val\n    },\n    // 搜索会员\n    onMemberSearch(data) {\n      this.memberSearchText = data\n      if (data === '') {\n        this.memberSearchService.RESET_LIST()\n        this.form.resetFields([this.memberId])\n        this.$emit('change:list', [])\n      } else {\n        this.memberSearchService.getMember(data, this.saleRangeType)\n        this.memberSearchService.getMemberAction$.subscribe(list => {\n          if (!list.length) {\n            this.form.resetFields([this.memberId])\n            this.onChangeMember('')\n          } else {\n            console.log('memberInfo', this.memberInfo)\n            if (this.memberInfo) {\n              this.form.setFieldsValue({\n                [this.memberId]: this.memberInfo.member_id\n              })\n              this.onChangeMember(this.memberInfo.member_id)\n            }\n          }\n        })\n      }\n    },\n    // 切换新增会员\n    onAddMember() {\n      this.selectInfo = {}\n      this.searchMemberIsShow = false\n    },\n    onCancelMember() {\n      this.searchMemberIsShow = true\n      this.selectInfo = {}\n      // 取消新增，重置为成年人模式\n      this.personModel = 0\n      this.form.resetFields([this.memberId, this.memberName, this.memberMobile])\n    }\n  },\n  mounted() {\n    this.memberSearchService.SET_TYPE(this.type)\n    console.log('member-search')\n    try {\n      if (this.memberInfo) {\n        console.log('memberInfo', this.memberInfo)\n        this.onMemberSearch(this.memberInfo.member_name)\n        if (this.isSoldDeal) {\n          this.form.setFieldsValue({\n            [this.physicalId]: this.memberInfo.physical_id,\n            [this.idCard]: this.memberInfo.id_card,\n            [this.cardNum]: this.memberInfo.card_num,\n            [this.idCardType]: this.memberInfo.id_card_type\n          })\n        }\n      } else {\n        this.memberSearchService.getMemberAction$.subscribe(list => {\n          console.log('list', list)\n          if (!list.length) {\n            this.form.resetFields([this.memberId])\n          }\n        })\n      }\n    } catch (error) {\n      console.log('error', error)\n    }\n  },\n  components: {\n    InputPhone\n  }\n}\n",{"version":3,"sources":["member-search.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"member-search.vue","sourceRoot":"src/views/biz-components/member/member-search","sourcesContent":["<template>\n  <div>\n    <div class=\"search-member__select\" v-if=\"searchMemberIsShow\">\n      <st-form-item\n        class=\"search-member__select-item\"\n        :label=\"label\"\n        required\n        v-bind=\"$attrs\"\n      >\n        <a-select\n          style=\"width:calc(100% - 85px)\"\n          showSearch\n          allowClear\n          v-decorator=\"decorators[memberId]\"\n          :placeholder=\"placeholder\"\n          :defaultActiveFirstOption=\"false\"\n          :filterOption=\"false\"\n          :showArrow=\"false\"\n          suffixIcon=\"add\"\n          @search=\"onMemberSearch\"\n          @select=\"onSelectMember\"\n          @change=\"onChangeMember\"\n        >\n          <div slot=\"notFoundContent\">\n            <a-spin size=\"small\" v-if=\"loading$.getTransactionMember\"></a-spin>\n            <div v-else-if=\"!memberSearchText\">无搜索结果</div>\n            <div v-else>\n              查无此会员，\n              <a @click=\"onAddMember\">新增新会员？</a>\n            </div>\n          </div>\n          <a-select-option\n            v-for=\"item in memberList$\"\n            :value=\"item.id\"\n            :key=\"item.id\"\n          >\n            <span\n              v-html=\"\n                `${selectItemLabel(item)}`.replace(\n                  new RegExp(memberSearchText, 'g'),\n                  `\\<span class='global-highlight-color'\\>${memberSearchText}\\<\\/span\\>`\n                )\n              \"\n            >\n              {{ selectItemLabel(item) }}\n            </span>\n          </a-select-option>\n          <span slot=\"suffixIcon\">未成年</span>\n        </a-select>\n        <a class=\"search-member__select-href\" @click=\"onAddMember\">新增会员</a>\n      </st-form-item>\n    </div>\n\n    <template v-if=\"selectInfo && selectInfo.is_minors === 1\">\n      <st-form-item label=\"家长手机号\" required v-bind=\"$attrs\">\n        <label>{{ selectInfo.parent_mobile }}</label>\n      </st-form-item>\n      <st-form-item label=\"家长姓名\" required v-bind=\"$attrs\">\n        <label>\n          {{ selectInfo.parent_name }}({{ selectInfo.parent_user_role }})\n        </label>\n      </st-form-item>\n    </template>\n\n    <template v-if=\"!searchMemberIsShow\">\n      <st-form-item label=\"姓名\" required v-bind=\"$attrs\">\n        <a-input\n          v-decorator=\"decorators[memberName]\"\n          placeholder=\"请输入会员姓名\"\n          :maxLength=\"30\"\n        >\n          <a-select\n            slot=\"addonAfter\"\n            style=\"width: 100px\"\n            v-decorator=\"decorators[isMinors]\"\n            @change=\"onChangeModel\"\n          >\n            <a-select-option :value=\"0\">成年人</a-select-option>\n            <a-select-option :value=\"1\">未成年人</a-select-option>\n          </a-select>\n        </a-input>\n      </st-form-item>\n      <st-form-item\n        label=\"手机号\"\n        required\n        v-if=\"personModel === 0\"\n        v-bind=\"$attrs\"\n      >\n        <input-phone\n          size=\"default\"\n          v-decorator=\"decorators[memberMobile]\"\n          placeholder=\"请输入手机号\"\n        ></input-phone>\n        <p class=\"mg-b0\">\n          <a @click=\"onCancelMember\">取消新增</a>\n        </p>\n      </st-form-item>\n      <st-form-item\n        label=\"家长手机号\"\n        required\n        v-if=\"personModel === 1\"\n        v-bind=\"$attrs\"\n      >\n        <input-phone\n          size=\"default\"\n          v-decorator=\"decorators[parentMobile]\"\n          placeholder=\"请输入手机号\"\n          @change=\"onChangeParentMobile\"\n        ></input-phone>\n      </st-form-item>\n      <st-form-item\n        label=\"家长姓名\"\n        required\n        v-if=\"personModel === 1\"\n        v-bind=\"$attrs\"\n      >\n        <a-input\n          v-decorator=\"decorators[parentName]\"\n          placeholder=\"请输入家长姓名\"\n          :disabled=\"disabledParentMobile\"\n          :maxLength=\"30\"\n        >\n          <a-select\n            slot=\"addonAfter\"\n            style=\"width: 80px\"\n            v-decorator=\"decorators[parentUserRole]\"\n          >\n            <a-select-option\n              :value=\"item.value\"\n              v-for=\"(item, index) in parent_types\"\n              :key=\"index\"\n            >\n              {{ item.label }}\n            </a-select-option>\n          </a-select>\n        </a-input>\n        <p class=\"mg-b0\">\n          <a @click=\"onCancelMember\">取消新增</a>\n        </p>\n      </st-form-item>\n    </template>\n    <template v-if=\"isSoldDeal\">\n      <st-form-item label=\"证件\" v-bind=\"$attrs\" :help=\"idCardValidatorText\">\n        <a-input\n          placeholder=\"请输入\"\n          v-decorator=\"decorators[idCard]\"\n          @change=\"idCardValidator\"\n        >\n          <a-select\n            v-decorator=\"decorators[idCardType]\"\n            placeholder=\"请选择\"\n            style=\"width:100px\"\n            slot=\"addonBefore\"\n          >\n            <a-select-option\n              v-for=\"(item, index) in id_types\"\n              :key=\"index\"\n              :value=\"+item.value\"\n            >\n              {{ item.label }}\n            </a-select-option>\n          </a-select>\n        </a-input>\n      </st-form-item>\n      <st-form-item label=\"卡号\" v-bind=\"$attrs\" :help=\"cardNumValidatorText\">\n        <a-input\n          placeholder=\"请输入卡号\"\n          v-decorator=\"decorators[cardNum]\"\n          @change=\"cardNumValidator\"\n        />\n      </st-form-item>\n      <st-form-item label=\"物理卡号\" v-bind=\"$attrs\" :help=\"pidValidatorText\">\n        <a-input\n          placeholder=\"请输入物理卡号\"\n          v-decorator=\"decorators[physicalId]\"\n          @change=\"pidValidator\"\n        />\n      </st-form-item>\n    </template>\n  </div>\n</template>\n\n<script>\nimport { MemberSearchService } from './member-search.service'\nimport { merge } from 'lodash-es'\nimport { ruleOptions } from './member-search.config'\nimport { PatternService } from '@/services/pattern.service'\nimport InputPhone from '@/views/biz-components/account/input-phone/input-phone'\nexport default {\n  name: 'MemberSearch',\n  model: {\n    event: 'change'\n  },\n  props: {\n    value: {\n      type: String\n    },\n    id: {\n      type: String\n    },\n    label: {\n      type: String,\n      default: '购买会员'\n    },\n    /**\n     * 会员查询类型 transaction | transfer\n     */\n    type: {\n      type: String,\n      default: 'transaction'\n      // required: true\n    },\n    placeholder: {\n      type: String,\n      default: '输入手机号或会员名搜索'\n    },\n    // 外部 form 表单 必传\n    form: {\n      type: Object,\n      required: true\n    },\n    fields: {\n      type: Object,\n      default: () => ({})\n    },\n    // 回填会员填写信息\n    memberInfo: {\n      type: Object\n      // default: () => {\n      //   return {\n      //     member_id: 110676207534127,\n      //     member_name: '张飞123222',\n      //     member_mobile: 19134752085\n      //   }\n      // }\n    },\n    saleRangeType: {\n      type: Number,\n      default: 1\n    },\n    isSoldDeal: {\n      type: Boolean,\n      default: false\n    }\n  },\n  serviceInject() {\n    return {\n      memberSearchService: MemberSearchService,\n      pattern: PatternService\n    }\n  },\n  serviceProviders() {\n    return [MemberSearchService]\n  },\n  rxState() {\n    const { memberList$, loading$, id_types$ } = this.memberSearchService\n    return {\n      memberList$,\n      loading$,\n      parent_types: this.memberSearchService.parent_types$,\n      id_types: this.memberSearchService.id_types$\n    }\n  },\n\n  data() {\n    return {\n      memberSearchText: '',\n      searchMemberIsShow: true,\n      personModel: 0,\n      selectInfo: {},\n      disabledParentMobile: false,\n      idCardValidatorText: '',\n      cardNumValidatorText: '',\n      pidValidatorText: ''\n    }\n  },\n  computed: {\n    ruleOptions,\n    decorators() {\n      return this.form.addDecorators(this.ruleOptions)\n    },\n    usedFields() {\n      return merge(\n        {\n          member_id: 'member_id',\n          mobile: 'mobile',\n          member_name: 'member_name',\n          parent_name: 'parent_name',\n          is_minors: 'is_minors',\n          parent_mobile: 'parent_mobile',\n          parent_user_role: 'parent_user_role',\n          id_card: 'id_card',\n          id_card_type: 'id_card_type',\n          card_num: 'card_num',\n          physical_id: 'physical_id'\n        },\n        this.fields\n      )\n    },\n    memberId() {\n      return this.usedFields.member_id\n    },\n    memberMobile() {\n      return this.usedFields.mobile\n    },\n    memberName() {\n      return this.usedFields.member_name\n    },\n    parentName() {\n      return this.usedFields.parent_name\n    },\n    isMinors() {\n      return this.usedFields.is_minors\n    },\n    parentMobile() {\n      return this.usedFields.parent_mobile\n    },\n    parentUserRole() {\n      return this.usedFields.parent_user_role\n    },\n    idCard() {\n      return this.usedFields.id_card\n    },\n    idCardType() {\n      return this.usedFields.id_card_type\n    },\n    cardNum() {\n      return this.usedFields.card_num\n    },\n    physicalId() {\n      return this.usedFields.physical_id\n    }\n  },\n  methods: {\n    idCardValidator(e) {\n      let value = e.target.value\n      let pattern = this.pattern\n      let id_card_type = this.form.getFieldValue('id_card_type')\n      this.idCardValidatorText = ''\n      if (id_card_type === 1 && value && !pattern.ID.test(value)) {\n        this.idCardValidatorText = '请填写正确的身份证号'\n      }\n      if (id_card_type === 2 && value && !pattern.PASSPORT.test(value)) {\n        this.idCardValidatorText = '请填写正确的护照号码'\n      }\n    },\n    cardNumValidator(e) {\n      let value = e.target.value\n      if (!value || value.length > 20) {\n        this.cardNumValidatorText = '请输入正确格式的卡号'\n      } else {\n        this.cardNumValidatorText = ''\n      }\n    },\n    pidValidator(e) {\n      let value = e.target.value\n      if (!value || value.length > 10) {\n        this.pidValidatorText = '请输入正确格式的物理ID'\n      } else {\n        this.pidValidatorText = ''\n      }\n    },\n    onChangeParentMobile(val) {\n      setTimeout(() => {\n        this.form.validate(['parent_mobile']).then(values => {\n          val.mobile = val.phone\n          this.memberSearchService.getParentInfoByPhone(val).subscribe(res => {\n            if (res.exists) {\n              this.disabledParentMobile = true\n              this.form.setFieldsValue({\n                parent_name: res.info.member_name\n              })\n            } else {\n              this.disabledParentMobile = false\n              this.form.setFieldsValue({\n                parent_name: ''\n              })\n            }\n          })\n        })\n      })\n    },\n    selectItemLabel(item) {\n      if (item.is_minors === 1) {\n        return `${item.member_name}(未成年) ${item.parent_mobile}(${item.parent_user_role})`\n      }\n      return `${item.member_name} ${item.mobile}`\n    },\n    onSelectMember(val) {\n      console.log('memberList', this.memberList$)\n      this.selectInfo = val\n        ? this.memberList$.filter(item => item.id === val)[0]\n        : {}\n      this.form.setFieldsValue({\n        [this.memberId]: this.selectInfo.id || undefined,\n        [this.physicalId]: this.selectInfo.physical_id || undefined,\n        [this.idCard]: this.selectInfo.id_card || undefined,\n        [this.cardNum]: this.selectInfo.card_num || undefined,\n        [this.idCardType]: this.selectInfo.id_card_type || 1\n      })\n      console.log('this.selectInfo', this.selectInfo)\n      // setTimeout(() => {\n\n      // })\n      this.$emit('select', val)\n    },\n    onChangeMember(val) {\n      console.log('onChangeMember', val)\n      if (!val) {\n        this.onSelectMember(val)\n      } else {\n        // TODO: b254dd12 fix: 购买会员change事件 三个月前\n        this.$emit('change', val)\n      }\n    },\n    onChangeModel(val) {\n      this.personModel = val\n    },\n    // 搜索会员\n    onMemberSearch(data) {\n      this.memberSearchText = data\n      if (data === '') {\n        this.memberSearchService.RESET_LIST()\n        this.form.resetFields([this.memberId])\n        this.$emit('change:list', [])\n      } else {\n        this.memberSearchService.getMember(data, this.saleRangeType)\n        this.memberSearchService.getMemberAction$.subscribe(list => {\n          if (!list.length) {\n            this.form.resetFields([this.memberId])\n            this.onChangeMember('')\n          } else {\n            console.log('memberInfo', this.memberInfo)\n            if (this.memberInfo) {\n              this.form.setFieldsValue({\n                [this.memberId]: this.memberInfo.member_id\n              })\n              this.onChangeMember(this.memberInfo.member_id)\n            }\n          }\n        })\n      }\n    },\n    // 切换新增会员\n    onAddMember() {\n      this.selectInfo = {}\n      this.searchMemberIsShow = false\n    },\n    onCancelMember() {\n      this.searchMemberIsShow = true\n      this.selectInfo = {}\n      // 取消新增，重置为成年人模式\n      this.personModel = 0\n      this.form.resetFields([this.memberId, this.memberName, this.memberMobile])\n    }\n  },\n  mounted() {\n    this.memberSearchService.SET_TYPE(this.type)\n    console.log('member-search')\n    try {\n      if (this.memberInfo) {\n        console.log('memberInfo', this.memberInfo)\n        this.onMemberSearch(this.memberInfo.member_name)\n        if (this.isSoldDeal) {\n          this.form.setFieldsValue({\n            [this.physicalId]: this.memberInfo.physical_id,\n            [this.idCard]: this.memberInfo.id_card,\n            [this.cardNum]: this.memberInfo.card_num,\n            [this.idCardType]: this.memberInfo.id_card_type\n          })\n        }\n      } else {\n        this.memberSearchService.getMemberAction$.subscribe(list => {\n          console.log('list', list)\n          if (!list.length) {\n            this.form.resetFields([this.memberId])\n          }\n        })\n      }\n    } catch (error) {\n      console.log('error', error)\n    }\n  },\n  components: {\n    InputPhone\n  }\n}\n</script>\n"]}]}