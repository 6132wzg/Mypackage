(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["brand-setting-shop"],{"087d":function(t,e,s){"use strict";s.r(e),s.d(e,"ListService",(function(){return j}));var i=s("d225"),a=s("b0b4"),o=s("9ab4"),n=s("0cd5"),r=s("df29"),c=(s("6b54"),s("2397"),s("308d")),p=s("6bb5"),h=s("4e2b"),d=s("de46");function l(t){return function(){var e,s=Object(p["a"])(t);if(u()){var i=Object(p["a"])(this).constructor;e=Reflect.construct(s,arguments,i)}else e=s.apply(this,arguments);return Object(c["a"])(this,e)}}function u(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var f,m,v,_,b=function(t){Object(h["a"])(s,t);var e=l(s);function s(){return Object(i["a"])(this,s),e.apply(this,arguments)}return Object(a["a"])(s,[{key:"getList",value:function(t){return this.http.get("/v1/brand/shop",{query:t})}}]),s}(d["a"]),g=s("2cbb"),y=s("ebb6"),S=s("c4cc"),O=s("2138"),j=function(){function t(e,s,a){Object(i["a"])(this,t),this.shopApi=e,this.userService=s,this.authService=a,this.loading$=new r["d"]({}),this.list$=new r["d"]([]),this.page$=new r["d"]({}),this.count$=new r["d"]({}),this.auth$=this.authService.authMap$({add:"brand_shop:shop:shop|add"}),this.shopStatusList$=this.userService.getOptions$("shop.shop_status").pipe(Object(y["a"])((function(t){return[{value:-1,label:"全部运营状态"}].concat(t)}))),this.isValidList$=this.userService.getOptions$("shop.is_valid").pipe(Object(y["a"])((function(t){return[{value:-1,label:"全部系统状态"}].concat(t)})))}return Object(a["a"])(t,[{key:"getList",value:function(t){var e=this;return this.shopApi.getList(t).pipe(Object(S["a"])((function(t){e.list$.commit((function(){return t.list})),e.page$.commit((function(){return t.page})),e.count$.commit((function(){return t.brand_shop_count}))})))}},{key:"beforeEach",value:function(t){return this.getList(t.meta.query)}}]),t}();Object(o["b"])([Object(r["c"])(),Object(o["d"])("design:type",Function),Object(o["d"])("design:paramtypes",["function"===typeof(f=!1)?f:Object]),Object(o["d"])("design:returntype",void 0)],j.prototype,"getList",null),j=Object(o["b"])([Object(n["b"])(),Object(o["d"])("design:paramtypes",["function"===typeof(m="undefined"!==typeof b&&b)?m:Object,"function"===typeof(v="undefined"!==typeof O["a"]&&O["a"])?v:Object,"function"===typeof(_="undefined"!==typeof g["a"]&&g["a"])?_:Object])],j)},"354f":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("st-panel",{staticClass:"page-brand-shop-add",attrs:{app:""}},[s("st-form",{attrs:{form:t.form}},[s("a-row",{staticClass:"page-add-shop-name-row",attrs:{gutter:8}},[s("a-col",{attrs:{lg:10,xs:22,offset:1}},[s("st-form-item",{attrs:{label:"门店名称",required:""}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["shop_name",{rules:[{validator:t.shop_name_validator}]}],expression:"[\n              'shop_name',\n              { rules: [{ validator: shop_name_validator }] }\n            ]"}],attrs:{maxlength:"20",placeholder:"支持中英文、数字,不超过20个字"}})],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{lg:10,xs:22,offset:1}},[s("st-form-item",{attrs:{label:"门店电话",required:""}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["shop_phone",{validateTrigger:"blur",rules:[{validator:t.shop_phone_validator}]}],expression:"[\n              'shop_phone',\n              {\n                validateTrigger: 'blur',\n                rules: [{ validator: shop_phone_validator }]\n              }\n            ]"}],attrs:{placeholder:"请输入门店电话"}},[s("div",{staticClass:"page-add-shop-mobile-button",class:{disabled:t.phoneAddDisabled},attrs:{slot:"addonAfter"},on:{click:t.onValidtorPhone},slot:"addonAfter"},[t._v("\n              新增\n            ")])]),s("div",{staticClass:"page-add-shop-mobile"},t._l(t.shopData.shop_phones,(function(e,i){return s("p",{key:i},[s("span",[t._v(t._s(e))]),s("st-icon",{staticStyle:{cursor:"pointer"},attrs:{type:"anticon:close"},on:{click:function(e){return t.onRemovePhone(i)}}})],1)})),0)],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{lg:10,xs:22,offset:1}},[s("st-form-item",{attrs:{validateStatus:"error",help:t.shopMapValidateText,label:"门店地址",required:""}},[s("map-button",{attrs:{lat:t.addMap.lat,lng:t.addMap.lng,address:t.addMap.address,province:t.addMap.province,city:t.addMap.city,district:t.addMap.district},on:{select:t.addMapChange}})],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{lg:10,xs:22,offset:1}},[s("st-form-item",{attrs:{label:"邮箱"}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email",{rules:[{type:"email",message:"输入的邮箱格式错误，请重新输入!"}]}],expression:"[\n              'email',\n              {\n                rules: [\n                  {\n                    type: 'email',\n                    message: '输入的邮箱格式错误，请重新输入!'\n                  }\n                ]\n              }\n            ]"}],attrs:{placeholder:"请输入门店邮箱"}})],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{offset:"1",lg:23}},[s("st-form-item",{attrs:{label:"服务设施"}},[s("checkbox-facility-group",{model:{value:t.shopData.service_ids,callback:function(e){t.$set(t.shopData,"service_ids",e)},expression:"shopData.service_ids"}},t._l(t.serviceList,(function(e){return s("checkbox-facility-item",{key:e.service_id,staticStyle:{"margin-right":"24px"},attrs:{label:e.service_name,icon:t.serviceIcon_icon_list[e.service_id],value:e.service_id}})})),1)],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{offset:"1",lg:23}},[s("st-form-item",{attrs:{label:"店招",required:"",validateStatus:"error",help:t.shopCoverImageValidateText}},[s("st-image-upload",{attrs:{sizeLimit:5,list:t.fileList,width:"240px",height:"135px",placeholder:"上传门店照片",description:"大小不超过5M，建议尺寸16:9",cropperModal:{title:"门店图片裁切",cropper:{aspectRatio:16/9}}},on:{change:t.fileChange}})],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{offset:"1",lg:23}},[s("st-form-item",[s("template",{slot:"label"},[t._v("\n            营业状态\n            "),s("st-help-tooltip",{attrs:{id:"TBCS001"}})],1),s("a-radio-group",{model:{value:t.shopData.shop_status,callback:function(e){t.$set(t.shopData,"shop_status",e)},expression:"shopData.shop_status"}},t._l(t.shop_status_add,(function(e){return s("a-radio",{key:+e.value,attrs:{value:+e.value}},[t._v("\n              "+t._s(e.label)+"\n            ")])})),1)],2)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{offset:"1",lg:22}},[s("st-form-item",{attrs:{label:"营业时间"}},[s("shop-hour-picker",{model:{value:t.shopData.business_time,callback:function(e){t.$set(t.shopData,"business_time",e)},expression:"shopData.business_time"}})],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{lg:10,xs:22,offset:1}},[s("st-form-item",{attrs:{label:"到期时间",required:""}},[s("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["buy_shop_id",{rules:[{required:!0,message:"请选择到期时间"}]}],expression:"[\n              'buy_shop_id',\n              { rules: [{ required: true, message: '请选择到期时间' }] }\n            ]"}],attrs:{placeholder:"请选择到期时间"}},t._l(t.unusedShops,(function(e,i){return s("a-select-option",{key:i,attrs:{value:e.buy_shop_id}},[t._v("\n              "+t._s(e.expire_time)+"\n            ")])})),1)],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{lg:10,xs:22,offset:1}},[s("st-form-item",{attrs:{label:" "}},[s("st-button",{attrs:{type:"primary",loading:t.addLoading.save},on:{click:t.onHandleSubmit}},[t._v("\n            提交\n          ")])],1)],1)],1)],1)],1)},a=[],o=(s("ac6a"),s("5df3"),s("4f7f"),s("75fc")),n=(s("7f7f"),s("2138")),r=s("88b4"),c=s("5c8a"),p=s("2527"),h=s("e69b"),d=s("9507"),l=s("f0ec"),u=s("99c0"),f=s("57f4"),m=s("7ce1"),v={components:{CheckboxFacilityGroup:d["a"],CheckboxFacilityItem:l["a"],MapButton:u["a"],ShopHourPicker:f["a"],StImageUpload:m["a"]},serviceInject:function(){return{pattern:p["a"],addService:r["AddService"],userService:n["a"],messageService:h["a"]}},rxState:function(){return{serviceList:this.addService.serviceList$,addLoading:this.addService.loading$,shop_status_add:this.userService.getOptions$("shop.shop_status_add"),unusedShops:this.addService.unusedShops$}},data:function(){return{shopData:{shop_name:"",province_id:null,city_id:null,district_id:null,address:"",shop_phones:[],shop_status:1,lat:"",lng:"",service_ids:[],business_time:[],email:"",shop_cover_image:"",buy_shop_id:-1},phoneValidtorType:1,addMap:{lat:"",lng:"",address:"",province:{},city:{},district:{}},shopMapValidateText:"",serviceIcon_icon_list:{1:"WIFI",2:"park",3:"shower",4:"medical",5:"heating",6:"snow",7:"nosmoking",8:"energy"},fileList:[],shopCoverImageValidateText:""}},beforeCreate:function(){this.form=this.$form.createForm(this)},computed:{phoneAddDisabled:function(){return this.shopData.shop_phones.length>2},shopCoverImageIsOk:function(){return""===this.shopCoverImageValidateText},shopMapIsOk:function(){return""===this.shopMapValidateText}},methods:{fileChange:function(t){t.length?this.shopData.shop_cover_image=t[0].image_key:this.shopData.shop_cover_image="",this.shopCoverImageValidator()},addMapChange:function(t){this.addMap=Object(c["a"])(t),this.shopData.province_id=t.province.id,this.shopData.province_name=t.province.name,this.shopData.city_id=t.city.id,this.shopData.city_name=t.city.name,this.shopData.district_id=t.district.id,this.shopData.district_name=t.district.name,this.shopData.address=t.address,this.shopData.lat=t.lat,this.shopData.lng=t.lng,this.shopMapValidator()},onValidtorPhone:function(){var t=this;this.form.getFieldValue("shop_phone")&&!this.phoneAddDisabled&&this.form.validateFields(["shop_phone"],{}).then((function(e){var s=Object(o["a"])(t.shopData.shop_phones);s.push(e.shop_phone),t.shopData.shop_phones=Object(o["a"])(new Set(s))}))},onRemovePhone:function(t){this.shopData.shop_phones.splice(t,1)},onHandleSubmit:function(t){var e=this;this.phoneValidtorType=0,this.form.resetFields(["shop_phone"]),t.preventDefault(),this.shopCoverImageValidator(),this.shopMapValidator(),this.form.validateFieldsAndScroll((function(t,s){e.phoneValidtorType=1,!t&&e.shopCoverImageIsOk&&e.shopMapIsOk&&(e.shopData.shop_name=s.shop_name,e.shopData.email=s.email,e.shopData.buy_shop_id=s.buy_shop_id,e.addService.save(e.shopData).subscribe(e.onSubmitSuccess))}))},onSubmitSuccess:function(){this.messageService.success({content:"新增成功"}),this.$router.push({name:"brand-setting-shop-list"})},shop_name_validator:function(t,e,s){void 0!==e&&e?e&&!this.pattern.CN_EN_NUM_SPACE("1-20").test(e)?s("支持中英文、数字,不超过20个字"):s():s("请填写门店名称")},shop_phone_validator:function(t,e,s){this.phoneValidtorType||this.shopData.shop_phones.length?s():s("请填写门店电话")},shopCoverImageValidator:function(){this.shopCoverImageValidateText=this.shopData.shop_cover_image?"":"请上传店招"},shopMapValidator:function(){this.shopMapValidateText=this.shopData.lat?"":"请选择门店地址"}}},_=v,b=s("2877"),g=Object(b["a"])(_,i,a,!1,null,null,null);e["default"]=g.exports},"4f7a":function(t,e,s){"use strict";s.r(e),s.d(e,"InfoService",(function(){return l}));var i,a=s("d225"),o=s("b0b4"),n=s("9ab4"),r=s("0cd5"),c=s("df29"),p=s("5afb"),h=s("c4cc"),d=s("54da"),l=function(){function t(e){Object(a["a"])(this,t),this.shopApi=e,this.info$=new c["d"]({}),this.serviceList$=new c["d"]([])}return Object(o["a"])(t,[{key:"getInfo",value:function(t){var e=this;return this.shopApi.getInfo(t).pipe(Object(h["a"])((function(t){e.info$.commit((function(){return t.info}))})))}},{key:"getServiceList",value:function(){var t=this;return this.shopApi.getServiceList().pipe(Object(h["a"])((function(e){t.serviceList$.commit((function(){return e.services}))})))}},{key:"init",value:function(t){return Object(d["a"])(this.getInfo(t),this.getServiceList())}},{key:"beforeEach",value:function(t){return this.init(t.meta.query.id)}}]),t}();l=Object(n["b"])([Object(r["b"])(),Object(n["d"])("design:paramtypes",["function"===typeof(i="undefined"!==typeof p["c"]&&p["c"])?i:Object])],l)},"80eb":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("st-panel",{staticClass:"page-brand-shop-edit",attrs:{app:""}},[s("st-form",{attrs:{form:t.form}},[s("a-row",{staticClass:"page-edit-shop-name-row",attrs:{gutter:8}},[s("a-col",{attrs:{offset:"1",lg:10}},[s("st-form-item",{attrs:{label:"门店名称",required:""}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["shop_name",{rules:[{validator:t.shop_name_validator}]}],expression:"[\n              'shop_name',\n              { rules: [{ validator: shop_name_validator }] }\n            ]"}],attrs:{maxlength:"20",placeholder:"支持中英文、数字,不超过20个字"}})],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{lg:10,xs:22,offset:1}},[s("st-form-item",{attrs:{label:"门店电话",required:""}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["shop_phone",{validateTrigger:"blur",rules:[{validator:t.shop_phone_validator}]}],expression:"[\n              'shop_phone',\n              {\n                validateTrigger: 'blur',\n                rules: [{ validator: shop_phone_validator }]\n              }\n            ]"}],attrs:{placeholder:"请输入门店电话"}},[s("div",{staticClass:"page-add-shop-mobile-button",class:{disabled:t.phoneAddDisabled},attrs:{slot:"addonAfter"},on:{click:t.onValidtorPhone},slot:"addonAfter"},[t._v("\n              新增\n            ")])]),s("div",{staticClass:"page-add-shop-mobile"},t._l(t.shopData.shop_phones,(function(e,i){return s("p",{key:i},[s("span",[t._v(t._s(e))]),s("st-icon",{staticStyle:{cursor:"pointer"},attrs:{type:"anticon:close"},on:{click:function(e){return t.onRemovePhone(i)}}})],1)})),0)],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{lg:10,xs:22,offset:1}},[s("st-form-item",{attrs:{label:"门店地址",required:""}},[s("map-button",{attrs:{lat:t.editMap.lat,lng:t.editMap.lng,address:t.editMap.address,province:t.editMap.province,city:t.editMap.city,district:t.editMap.district},on:{select:t.editMapChange}})],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{lg:10,xs:22,offset:1}},[s("st-form-item",{attrs:{label:"邮箱"}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email",{rules:[{type:"email",message:"输入的邮箱格式错误，请重新输入!"}]}],expression:"[\n              'email',\n              {\n                rules: [\n                  {\n                    type: 'email',\n                    message: '输入的邮箱格式错误，请重新输入!'\n                  }\n                ]\n              }\n            ]"}],attrs:{placeholder:"请输入门店邮箱"}})],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{offset:"1",lg:23}},[s("st-form-item",{attrs:{label:"服务设施"}},[s("checkbox-facility-group",{model:{value:t.shopData.service_ids,callback:function(e){t.$set(t.shopData,"service_ids",e)},expression:"shopData.service_ids"}},t._l(t.serviceList,(function(e){return s("checkbox-facility-item",{key:e.service_id,staticStyle:{"margin-right":"24px"},attrs:{label:e.service_name,icon:t.serviceIcon_icon_list[e.service_id],value:e.service_id}})})),1)],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{offset:"1",lg:23}},[s("st-form-item",{directives:[{name:"viewer",rawName:"v-viewer",value:{url:"data-src",toolbar:!1},expression:"{ url: 'data-src', toolbar: false }"}],attrs:{label:"店招",required:"",validateStatus:"error",help:t.shopCoverImageValidateText}},[s("st-image-upload",{attrs:{cropperModal:t.cropperModal,sizeLimit:5,list:t.fileList,width:"240px",height:"135px"},on:{change:t.fileChange}},[s("a-icon",{attrs:{type:"plus"}}),s("div",{staticClass:"page-upload-text"},[t._v("上传店招")]),s("div",{staticClass:"page-upload-text"},[t._v("大小不超过5M，建议尺寸16:9")])],1)],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{offset:"1",lg:22}},[s("st-form-item",{attrs:{label:"营业时间"}},[s("shop-hour-picker",{model:{value:t.shopData.business_time,callback:function(e){t.$set(t.shopData,"business_time",e)},expression:"shopData.business_time"}})],1)],1)],1),s("a-row",{attrs:{gutter:8}},[s("a-col",{attrs:{offset:"1",lg:22}},[s("st-form-item",{attrs:{label:" "}},[s("st-button",{attrs:{type:"primary",loading:t.editLoading.edit},on:{click:t.onHandleSubmit}},[t._v("\n            提交\n          ")])],1)],1)],1)],1)],1)},a=[],o=(s("7f7f"),s("5df3"),s("4f7f"),s("75fc")),n=(s("ac6a"),s("2138")),r=s("8161"),c=s("2527"),p=s("5c8a"),h=s("9507"),d=s("f0ec"),l=s("99c0"),u=s("57f4"),f=s("7ce1"),m={name:"EditShopSetting",components:{CheckboxFacilityGroup:h["a"],CheckboxFacilityItem:d["a"],MapButton:l["a"],ShopHourPicker:u["a"],StImageUpload:f["a"]},serviceInject:function(){return{pattern:c["a"],editService:r["EditService"],userService:n["a"]}},rxState:function(){return{serviceList:this.editService.serviceList$,shopInfo:this.editService.shopInfo$,editLoading:this.editService.loading$}},mounted:function(){this.init(this.shopInfo)},data:function(){return{editMap:{lat:"",lng:"",address:"",province:{},city:{},district:{}},fileList:[],fileListHostiry:[],cropperModal:{},phoneValidtorType:1,shopData:{shop_name:"",province_id:null,city_id:null,district_id:null,address:"",shop_phones:[],shop_status:1,lat:"",lng:"",service_ids:[],business_time:[],email:"",shop_images:[]},shopCoverImageValidateText:"",serviceIcon_icon_list:{1:"WIFI",2:"park",3:"shower",4:"medical",5:"heating",6:"snow",7:"nosmoking",8:"energy"}}},beforeCreate:function(){this.form=this.$form.createForm(this)},computed:{phoneAddDisabled:function(){return this.shopData.shop_phones.length>2},shopCoverImageIsOk:function(){return""===this.shopCoverImageValidateText}},methods:{init:function(t){var e=this;this.form.setFieldsValue({shop_name:t.shop_name,email:t.email}),this.shopData.shop_phones=Object(p["a"])(t.shop_phones),this.editMap.lat=t.lat,this.editMap.lng=t.lng,this.editMap.address=t.shop_position.address,this.editMap.province.id=t.shop_position.province_id,this.editMap.province.name=t.shop_position.province_name,this.editMap.city.id=t.shop_position.city_id,this.editMap.city.name=t.shop_position.city_name,this.editMap.district.id=t.shop_position.district_id,this.editMap.district.name=t.shop_position.district_name,t.shop_services.forEach((function(t){e.shopData.service_ids.push(t.service_id)})),this.fileListHostiry=Object(p["a"])(t.shop_images),this.fileList=Object(p["a"])(t.shop_images.filter((function(t){return t.is_cover}))),this.shopData.shop_images=Object(p["a"])(t.shop_images.filter((function(t){return t.is_cover}))),this.shopData.shop_status=t.shop_status,this.shopData.business_time=t.business_time},shopCoverImageValidator:function(){this.shopCoverImageValidateText=this.shopData.shop_images.length?"":"请上传店招"},fileChange:function(t){t.length?(this.shopData.shop_images=Object(p["a"])(t),this.shopData.shop_images[0].is_cover=1):this.shopData.shop_images=[],this.shopCoverImageValidator()},editMapChange:function(t){this.editMap=Object(p["a"])(t)},onValidtorPhone:function(){var t=this;this.form.getFieldValue("shop_phone")&&!this.phoneAddDisabled&&this.form.validateFields(["shop_phone"],{}).then((function(e){var s=Object(o["a"])(t.shopData.shop_phones);s.push(e.shop_phone),t.shopData.shop_phones=Object(o["a"])(new Set(s))}))},onRemovePhone:function(t){this.shopData.shop_phones.splice(t,1)},onHandleSubmit:function(t){var e=this;this.phoneValidtorType=0,this.form.resetFields(["shop_phone"]),t.preventDefault(),this.shopCoverImageValidator(),this.form.validateFieldsAndScroll((function(t,s){if(e.phoneValidtorType=1,!t&&e.shopCoverImageIsOk){var i;e.shopData.shop_name=s.shop_name,e.shopData.province_id=e.editMap.province.id,e.shopData.province_name=e.editMap.province.name,e.shopData.city_id=e.editMap.city.id,e.shopData.city_name=e.editMap.city.name,e.shopData.district_id=e.editMap.district.id,e.shopData.district_name=e.editMap.district.name,e.shopData.address=e.editMap.address,e.shopData.lat=e.editMap.lat,e.shopData.lng=e.editMap.lng,e.shopData.email=s.email;var a=0;e.fileListHostiry.some((function(t,e){t.is_cover&&(a=e)})),e.fileListHostiry.splice(a,1),(i=e.fileListHostiry).unshift.apply(i,Object(o["a"])(e.shopData.shop_images)),e.shopData.shop_images=Object(p["a"])(e.fileListHostiry),e.editService.edit(e.$searchQuery.id,e.shopData).subscribe((function(){e.$router.push({name:"brand-setting-shop-list"})}))}}))},shop_name_validator:function(t,e,s){void 0!==e&&e?e&&!this.pattern.CN_EN_NUM_SPACE("1-20").test(e)?s("支持中英文、数字,不超过20个字"):s():s("请填写门店名称")},shop_phone_validator:function(t,e,s){this.phoneValidtorType||this.shopData.shop_phones.length?s():s("请填写门店电话")}}},v=m,_=s("2877"),b=Object(_["a"])(v,i,a,!1,null,null,null);e["default"]=b.exports},8161:function(t,e,s){"use strict";s.r(e),s.d(e,"EditService",(function(){return u}));var i,a,o=s("d225"),n=s("b0b4"),r=s("9ab4"),c=s("0cd5"),p=s("5afb"),h=s("df29"),d=s("c4cc"),l=s("54da"),u=function(){function t(e){Object(o["a"])(this,t),this.shopApi=e,this.shopInfo$=new h["d"]({}),this.serviceList$=new h["d"]([]),this.loading$=new h["d"]({})}return Object(n["a"])(t,[{key:"edit",value:function(t,e){return this.shopApi.brandUpdate(t,e)}},{key:"getServiceList",value:function(){var t=this;return this.shopApi.getServiceList().pipe(Object(d["a"])((function(e){t.serviceList$.commit((function(){return e.services}))})))}},{key:"getShopInfo",value:function(t){var e=this;return this.shopApi.getInfo(t).pipe(Object(d["a"])((function(t){e.shopInfo$.commit((function(){return t.info}))})))}},{key:"init",value:function(t){return Object(l["a"])(this.getShopInfo(t),this.getServiceList())}},{key:"beforeEach",value:function(t){return this.init(t.meta.query.id)}}]),t}();Object(r["b"])([Object(h["c"])(),Object(r["d"])("design:type",Function),Object(r["d"])("design:paramtypes",[String,"function"===typeof(i="undefined"!==typeof p["ShopInput"]&&p["ShopInput"])?i:Object]),Object(r["d"])("design:returntype",void 0)],u.prototype,"edit",null),u=Object(r["b"])([Object(c["b"])(),Object(r["d"])("design:paramtypes",["function"===typeof(a="undefined"!==typeof p["c"]&&p["c"])?a:Object])],u)},"88b4":function(t,e,s){"use strict";s.r(e),s.d(e,"AddService",(function(){return S}));var i=s("d225"),a=s("b0b4"),o=s("9ab4"),n=s("0cd5"),r=s("5afb"),c=(s("6b54"),s("2397"),s("308d")),p=s("6bb5"),h=s("4e2b"),d=s("de46");function l(t){return function(){var e,s=Object(p["a"])(t);if(u()){var i=Object(p["a"])(this).constructor;e=Reflect.construct(s,arguments,i)}else e=s.apply(this,arguments);return Object(c["a"])(this,e)}}function u(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var f,m,v,_=function(t){Object(h["a"])(s,t);var e=l(s);function s(){return Object(i["a"])(this,s),e.apply(this,arguments)}return Object(a["a"])(s,[{key:"getBrandIndex",value:function(t){return this.http.get("/v1/brand/index",{params:t})}},{key:"getUnusedShops",value:function(){return this.http.get("/v1/brand/buy_shops_unused")}}]),s}(d["a"]),b=s("df29"),g=s("c4cc"),y=s("54da"),S=function(){function t(e,s){Object(i["a"])(this,t),this.shopApi=e,this.brandApi=s,this.serviceList$=new b["d"]([]),this.loading$=new b["d"]({}),this.unusedShops$=new b["d"]([])}return Object(a["a"])(t,[{key:"getServiceList",value:function(){var t=this;return this.shopApi.getServiceList().pipe(Object(g["a"])((function(e){t.serviceList$.commit((function(){return e.services}))})))}},{key:"getUnusedShops",value:function(){var t=this;return this.brandApi.getUnusedShops().pipe(Object(g["a"])((function(e){t.unusedShops$.commit((function(){return e.list}))})))}},{key:"save",value:function(t){return this.shopApi.add(t)}},{key:"init",value:function(){return Object(y["a"])(this.getServiceList(),this.getUnusedShops())}},{key:"beforeRouteEnter",value:function(t,e){return this.init()}}]),t}();Object(o["b"])([Object(b["c"])(),Object(o["d"])("design:type",Function),Object(o["d"])("design:paramtypes",["function"===typeof(f="undefined"!==typeof r["ShopInput"]&&r["ShopInput"])?f:Object]),Object(o["d"])("design:returntype",void 0)],S.prototype,"save",null),S=Object(o["b"])([Object(n["b"])(),Object(o["d"])("design:paramtypes",["function"===typeof(m="undefined"!==typeof r["c"]&&r["c"])?m:Object,"function"===typeof(v="undefined"!==typeof _&&_)?v:Object])],S)},ee5a:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.shopInfo()},[s("div",{class:t.shopInfo("detail")},[s("div",{directives:[{name:"viewer",rawName:"v-viewer",value:{url:"data-src",toolbar:!1},expression:"{ url: 'data-src', toolbar: false }"}],staticClass:"mg-r16 st-preview-item",class:t.shopInfo("picture")},[t._l(t.info.shop_images,(function(e,i){return s("img",{directives:[{name:"show",rawName:"v-show",value:0===i,expression:"index === 0"}],key:i,attrs:{src:t._f("imgFilter")(e.image_url,{w:404,h:227}),"data-src":t._f("imgFilter")(e.image_url,{w:1e3}),width:"404",height:"227",alt:"店招"}})})),s("st-tag",{staticClass:"status-tag",attrs:{type:t.flagList[t.info.shop_status]}}),s("p",[s("st-icon",{attrs:{type:"image-count"}}),s("span",[t._v(t._s(t.info.shop_images.length))])],1)],2),s("div",{class:t.shopInfo("info")},[s("st-t2",{staticClass:"mg-b16"},[t._v(t._s(t.info.shop_name))]),s("st-info",{staticClass:"mg-b16",attrs:{isWeakenLabel:!0}},[s("st-info-item",{attrs:{label:"门店电话"}},[t._v("\n          "+t._s(t.info.shop_phones.join(","))+"\n        ")]),s("st-info-item",{attrs:{label:"门店邮箱"}},[t._v(t._s(t.info.email||"无"))]),s("st-info-item",{attrs:{label:"门店地址"}},[t._v("\n          "+t._s(t.info.shop_position.address_detail)+"\n          "),s("a",{staticClass:"mg-l12",on:{click:t.location}},[t._v("查看定位")])])],1),s("checkbox-facility-info",{attrs:{serviceList:t.serviceListComputed}})],1)]),s("div",{staticClass:"mg-t12",class:t.shopInfo("time")},[s("st-t3",{staticClass:"mg-b16"},[t._v("营业时间")]),s("shop-hour-picker",{attrs:{isInfo:!0},model:{value:t.info.business_time,callback:function(e){t.$set(t.info,"business_time",e)},expression:"info.business_time"}})],1)])},a=[],o=(s("ac6a"),s("4f7a")),n=s("5c8a"),r=s("ad06"),c=s("f54a"),p=s("57f4"),h={name:"PageBrandSettingShopInfo",components:{CheckboxFacilityInfo:c["a"],ShopHourPicker:p["a"]},bem:{shopInfo:"page-brand-setting-shop-info"},modals:{ShopMapLocation:r["a"]},serviceInject:function(){return{infoService:o["InfoService"]}},rxState:function(){return{serviceList:this.infoService.serviceList$,info:this.infoService.info$}},computed:{serviceListComputed:function(){var t=this,e=Object(n["a"])(this.serviceList);return e.forEach((function(e){e.selected=t.info.shop_services.some((function(t){return t.service_id===e.service_id}))})),e}},data:function(){return{flagList:["","shop-trial","shop-opening","shop-stop","shop-close","shop-holiday"]}},methods:{location:function(){this.$modalRouter.push({name:"shop-map-location",props:{lat:this.info.lat,lng:this.info.lng}})},onEdit:function(){},onSet:function(){}}},d=h,l=s("2877"),u=Object(l["a"])(d,i,a,!1,null,null,null);e["default"]=u.exports},f33a:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("st-panel",{attrs:{app:""}},[s("a-row",{staticClass:"mg-b16"},[s("a-col",{attrs:{span:8}},[s("router-link",{attrs:{to:"./add"}},[t.auth.add?s("st-button",{attrs:{type:"primary",icon:"add"}},[t._v("\n          新增门店\n        ")]):t._e()],1),s("span",{staticClass:"st-des mg-l8"},[t._v("\n        （已开店"+t._s(t.count.count_opened)+"家门店/可开店"+t._s(t.count.count_can_opened)+"家门店）\n      ")])],1),s("a-col",{staticClass:"ta-r",attrs:{span:16}},[s("a-select",{staticClass:"mg-r8",staticStyle:{width:"160px"},on:{change:function(e){return t.onSingleSearch("shop_status",e)}},model:{value:t.$searchQuery.shop_status,callback:function(e){t.$set(t.$searchQuery,"shop_status",e)},expression:"$searchQuery.shop_status"}},t._l(t.shopStatusList,(function(e,i){return s("a-select-option",{key:i,attrs:{value:e.value}},[t._v("\n          "+t._s(e.label)+"\n        ")])})),1),s("a-select",{staticStyle:{width:"160px"},on:{change:function(e){return t.onSingleSearch("is_valid",e)}},model:{value:t.$searchQuery.is_valid,callback:function(e){t.$set(t.$searchQuery,"is_valid",e)},expression:"$searchQuery.is_valid"}},t._l(t.isValidList,(function(e,i){return s("a-select-option",{key:i,attrs:{value:e.value}},[t._v("\n          "+t._s(e.label)+"\n        ")])})),1)],1)],1),s("st-table",{attrs:{page:t.page,loading:t.loading.getList,columns:t.columns,dataSource:t.list,rowKey:"shop_id"},on:{change:t.onTableChange},scopedSlots:t._u([{key:"shop_status",fn:function(e,i){return[t._v("\n      "+t._s(t._f("enumFilter")(i.shop_status,"shop.shop_status"))+"\n      "),i.has_holiday_setting?s("st-help-popover",{attrs:{title:"放假时间"}},[s("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n          "+t._s(t._f("dateFilter")(i.holiday_start_time,t.appConfig.DATE_FORMAT.datetime))+"\n          "),s("br"),t._v("\n          "+t._s(t._f("dateFilter")(i.holiday_end_time,t.appConfig.DATE_FORMAT.datetime))+"\n        ")])]):t._e()]}},{key:"is_valid",fn:function(e){return[s("st-text",{attrs:{status:{success:1===e,error:0===e}}},[t._v("\n        "+t._s(t._f("enumFilter")(e,"shop.is_valid"))+"\n      ")])]}},{key:"action",fn:function(e,i){return s("div",{},[s("st-table-actions",[i.auth["brand:shop:shop|get"]?s("router-link",{attrs:{to:"./info?id="+i.shop_id}},[t._v("\n          详情\n        ")]):t._e(),i.auth["brand:shop:shop|edit"]?s("router-link",{attrs:{to:"./edit?id="+i.shop_id}},[t._v("\n          编辑\n        ")]):t._e(),i.auth["brand:shop:shop_type|edit"]?s("a",{directives:[{name:"modal-link",rawName:"v-modal-link",value:{name:"brand-setting-shop-status",props:{shopId:i.shop_id,shopName:i.shop_name,shopStatus:i.shop_status},on:{change:t.onListChange}},expression:"{\n            name: 'brand-setting-shop-status',\n            props: {\n              shopId: record.shop_id,\n              shopName: record.shop_name,\n              shopStatus: record.shop_status\n            },\n            on: {\n              change: onListChange\n            }\n          }"}]},[t._v("\n          更改运营状态\n        ")]):t._e(),i.auth["brand_shop:shop:shop_holiday|edit"]?s("a",{directives:[{name:"modal-link",rawName:"v-modal-link",value:{name:"brand-setting-shop-holiday",props:{shopId:i.shop_id,shopName:i.shop_name,shopStatus:i.shop_status,isHoliday:i.has_holiday_setting,holidayTime:{start:i.holiday_start_time,end:i.holiday_end_time}},on:{change:t.onListChange}},expression:"{\n            name: 'brand-setting-shop-holiday',\n            props: {\n              shopId: record.shop_id,\n              shopName: record.shop_name,\n              shopStatus: record.shop_status,\n              isHoliday: record.has_holiday_setting,\n              holidayTime: {\n                start: record.holiday_start_time,\n                end: record.holiday_end_time\n              }\n            },\n            on: {\n              change: onListChange\n            }\n          }"}]},[t._v("\n          "+t._s(i.has_holiday_setting?"管理":"")+"门店放假\n        ")]):t._e()],1)],1)}}])})],1)},a=[],o=s("087d"),n=function(){return[{title:"门店名称",width:175,dataIndex:"shop_name",scopedSlots:{customRender:"shop_name"}},{title:"联系电话",width:100,dataIndex:"shop_phones",scopedSlots:{customRender:"shop_phones"}},{title:"详细地址",dataIndex:"address",scopedSlots:{customRender:"address"}},{title:"运营状态",dataIndex:"shop_status",width:80,scopedSlots:{customRender:"shop_status"}},{title:"系统状态",dataIndex:"is_valid",width:80,scopedSlots:{customRender:"is_valid"}},{title:"系统使用到期时间",dataIndex:"expire_time",scopedSlots:{customRender:"expire_time"}},{title:"操作",dataIndex:"action",fixed:"right",width:140,scopedSlots:{customRender:"action"}}]},r=s("185b"),c=s("ea3e"),p=s("74d8"),h=s("7c41"),d=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("st-modal",{attrs:{title:"更改运营状态",size:"small",confirmLoading:t.loading.update},on:{ok:t.onSubmit,cancel:t.onCancel},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("div",[s("st-form",{attrs:{form:t.form}},[s("a-row",[s("a-col",{attrs:{xs:22}},[s("st-form-item",{attrs:{label:"门店名称"}},[s("div",[t._v(t._s(t.shopName))])]),s("st-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[s("input",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.id,expression:"decorators.id"}],attrs:{type:"hidden"}})]),s("st-form-item",{staticClass:"mg-t16",attrs:{label:"运营状态",required:""}},[s("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:t.decorators.shop_status,expression:"decorators.shop_status"}],staticStyle:{width:"240px"}},t._l(t.shopStatusList,(function(e,i){return s("a-select-option",{key:i,attrs:{value:+e.value}},[t._v("\n                "+t._s(e.label)+"\n              ")])})),1)],1)],1)],1)],1)],1)])},l=[],u=(s("c5f6"),s("d225")),f=s("b0b4"),m=s("9ab4"),v=s("0cd5"),_=s("df29"),b=(s("6b54"),s("2397"),s("308d")),g=s("6bb5"),y=s("4e2b"),S=s("de46");function O(t){return function(){var e,s=Object(g["a"])(t);if(j()){var i=Object(g["a"])(this).constructor;e=Reflect.construct(s,arguments,i)}else e=s.apply(this,arguments);return Object(b["a"])(this,e)}}function j(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var x,w,k,D="/v1/shop/status",I=function(t){Object(y["a"])(s,t);var e=O(s);function s(){return Object(u["a"])(this,s),e.apply(this,arguments)}return Object(f["a"])(s,[{key:"update",value:function(t){return this.http.put("".concat(D,"/").concat(t.id),{params:t})}}]),s}(S["a"]),$=s("2138"),L=function(){function t(e,s){Object(u["a"])(this,t),this.shopStatusApi=e,this.userService=s,this.loading$=new _["d"]({}),this.shopStatusList$=this.userService.getOptions$("shop.shop_status_switch"),this.isValidList$=this.userService.getOptions$("shop.is_valid")}return Object(f["a"])(t,[{key:"update",value:function(t){return this.shopStatusApi.update(t)}}]),t}();Object(m["b"])([Object(_["c"])(),Object(m["d"])("design:type",Function),Object(m["d"])("design:paramtypes",["function"===typeof(x=!1)?x:Object]),Object(m["d"])("design:returntype",void 0)],L.prototype,"update",null),L=Object(m["b"])([Object(v["b"])(),Object(m["d"])("design:paramtypes",["function"===typeof(w="undefined"!==typeof I&&I)?w:Object,"function"===typeof(k="undefined"!==typeof $["a"]&&$["a"])?k:Object])],L);var C=s("e69b"),M=function(t){return{id:{},shop_status:{rules:[{required:!0,message:"请选择运营状态"}]}}},V={serviceInject:function(){return{editService:L,messageService:C["a"]}},rxState:function(){return{loading:this.editService.loading$,shopStatusList:this.editService.shopStatusList$,isValidList:this.editService.isValidList$}},props:{shopId:{type:[Number,String],default:0},shopStatus:{type:Number,default:0},shopName:{type:String,default:""}},data:function(){var t=this.$stForm.create(),e=t.decorators(M);return{form:t,decorators:e,show:!0}},mounted:function(){this.form.setFieldsValue({id:this.shopId,shop_status:+this.shopStatus})},methods:{onSubmit:function(t){var e=this;t.preventDefault(),this.form.validate().then((function(t){var s=e.form.getFieldsValue();3===s.shop_status?e.$confirm({title:"",content:"门店暂停营业后，门店会员无法正常约课、上课、入离场；同时此门店不支持交易开单，请谨慎操作",onOk:function(){e.doSubmit(s)}}):e.doSubmit(s)}))},doSubmit:function(t){this.editService.update(t).subscribe(this.onSubmitSuccess)},onSubmitSuccess:function(){this.messageService.success({content:"更改成功"}),this.$emit("change"),this.show=!1},onCancel:function(){this.show=!1}}},A=V,F=s("2877"),T=Object(F["a"])(A,d,l,!1,null,null,null),R=T.exports,N={mixins:[c["a"]],name:"PageBrandSettingShopList",serviceInject:function(){return{appConfig:p["a"],listService:o["ListService"]}},rxState:function(){return{loading:this.listService.loading$,list:this.listService.list$,page:this.listService.page$,count:this.listService.count$,auth:this.listService.auth$,shopStatusList:this.listService.shopStatusList$,isValidList:this.listService.isValidList$}},filters:{dateFilter:r["dateFilter"]},modals:{BrandSettingShopHoliday:h["a"],BrandSettingShopStatus:R},computed:{columns:n},methods:{onListChange:function(){this.$router.push({query:this.$searchQuery})}}},E=N,q=Object(F["a"])(E,i,a,!1,null,null,null);e["default"]=q.exports}}]);