{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-2!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/sms/notice.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/sms/notice.service.ts","mtime":1591147717361},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b, _c;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { Injectable } from 'vue-service-app';\nimport { State } from 'rx-state';\nimport { tap } from 'rxjs/operators';\nimport { AuthService } from '@/services/auth.service';\nimport { NoticeApi } from '@/api/v1/setting/sms/notice';\nimport { UserService } from '@/services/user.service';\nimport { NOTIFY_TYPES } from '@/constants/setting/sms';\n\nvar NoticeService = /*#__PURE__*/function () {\n  function NoticeService(noticeApi, authService, userService) {\n    _classCallCheck(this, NoticeService);\n\n    this.noticeApi = noticeApi;\n    this.authService = authService;\n    this.userService = userService;\n    this.memberList$ = new State([]);\n    this.shopList$ = new State([]);\n    this.roleList$ = new State([]);\n    this.consumeType$ = this.userService.getOptions$('setting.consume_type');\n    this.entranceType$ = this.userService.getOptions$('setting.entrance_type');\n    this.notifyRule$ = this.userService.getOptions$('setting.notify_rule');\n    this.notifyTimeHour$ = this.userService.getOptions$('setting.notify_time_hour');\n    this.authTabs$ = this.authService.getAuthTabs$('brand-setting-sms-notice');\n  }\n\n  _createClass(NoticeService, [{\n    key: \"SET_MEMBER_LIST\",\n    value: function SET_MEMBER_LIST(list) {\n      this.memberList$.commit(function () {\n        return list.filter(function (_ref) {\n          var notify_type = _ref.notify_type;\n          return notify_type.value === NOTIFY_TYPES.MEMBER;\n        });\n      });\n    }\n  }, {\n    key: \"SET_SHOP_LIST\",\n    value: function SET_SHOP_LIST(list) {\n      this.shopList$.commit(function () {\n        return list.filter(function (_ref2) {\n          var notify_type = _ref2.notify_type;\n          return notify_type.value === NOTIFY_TYPES.SHOP;\n        });\n      });\n    }\n  }, {\n    key: \"getNoticeList\",\n    value: function getNoticeList() {\n      var _this = this;\n\n      return this.noticeApi.getNoticeList('sms').pipe(tap(function (res) {\n        _this.SET_SHOP_LIST(res.list);\n\n        _this.SET_MEMBER_LIST(res.list);\n      }));\n    }\n  }, {\n    key: \"getRoleList\",\n    value: function getRoleList() {\n      var _this2 = this;\n\n      return this.noticeApi.getRoleList().pipe(tap(function (res) {\n        _this2.roleList$.commit(function () {\n          return res.list.map(function (item) {\n            return {\n              label: item.name,\n              value: \"\".concat(item.id)\n            };\n          });\n        });\n      }));\n    }\n  }, {\n    key: \"putNotice\",\n    value: function putNotice(params) {\n      return this.noticeApi.putNotice('sms', params).pipe(tap(function (res) {}));\n    }\n  }, {\n    key: \"beforeRouteEnter\",\n    value: function beforeRouteEnter() {\n      return this.getRoleList();\n    }\n  }, {\n    key: \"beforeEach\",\n    value: function beforeEach() {\n      return this.getNoticeList();\n    }\n  }]);\n\n  return NoticeService;\n}();\n\nNoticeService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof NoticeApi !== \"undefined\" && NoticeApi) === \"function\" ? _a : Object, typeof (_b = typeof AuthService !== \"undefined\" && AuthService) === \"function\" ? _b : Object, typeof (_c = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _c : Object])], NoticeService);\nexport { NoticeService };",{"version":3,"sources":["/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/setting/sms/notice.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from 'vue-service-app'\nimport { State } from 'rx-state'\nimport { tap } from 'rxjs/operators'\nimport { AuthService } from '@/services/auth.service'\nimport { NoticeApi, PutNoticeParams } from '@/api/v1/setting/sms/notice'\nimport { UserService } from '@/services/user.service'\nimport { NOTIFY_TYPES } from '@/constants/setting/sms'\n@Injectable()\nexport class NoticeService {\n  memberList$ = new State([])\n  shopList$ = new State([])\n  roleList$ = new State([])\n  consumeType$ = this.userService.getOptions$('setting.consume_type')\n  entranceType$ = this.userService.getOptions$('setting.entrance_type')\n  notifyRule$ = this.userService.getOptions$('setting.notify_rule')\n  notifyTimeHour$ = this.userService.getOptions$('setting.notify_time_hour')\n  authTabs$ = this.authService.getAuthTabs$('brand-setting-sms-notice')\n  constructor(\n    private noticeApi: NoticeApi,\n    private authService: AuthService,\n    private userService: UserService\n  ) {}\n  SET_MEMBER_LIST(list: any) {\n    this.memberList$.commit(() =>\n      list.filter(\n        ({ notify_type }: any) => notify_type.value === NOTIFY_TYPES.MEMBER\n      )\n    )\n  }\n  SET_SHOP_LIST(list: any) {\n    this.shopList$.commit(() =>\n      list.filter(\n        ({ notify_type }: any) => notify_type.value === NOTIFY_TYPES.SHOP\n      )\n    )\n  }\n  getNoticeList() {\n    return this.noticeApi.getNoticeList('sms').pipe(\n      tap((res: any) => {\n        this.SET_SHOP_LIST(res.list)\n        this.SET_MEMBER_LIST(res.list)\n      })\n    )\n  }\n  getRoleList() {\n    return this.noticeApi.getRoleList().pipe(\n      tap(res => {\n        this.roleList$.commit(() =>\n          res.list.map((item: any) => {\n            return { label: item.name, value: `${item.id}` }\n          })\n        )\n      })\n    )\n  }\n  putNotice(params: PutNoticeParams) {\n    return this.noticeApi.putNotice('sms', params).pipe(tap((res: any) => {}))\n  }\n  beforeRouteEnter() {\n    return this.getRoleList()\n  }\n  beforeEach() {\n    return this.getNoticeList()\n  }\n}\n"],"sourceRoot":""}]}