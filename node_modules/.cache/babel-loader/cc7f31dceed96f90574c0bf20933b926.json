{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/course/manage/package/list.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/course/manage/package/list.vue","mtime":1601345845268},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport { cloneDeep } from 'lodash-es';\nimport { ListService } from \"./list.service\";\nimport { UserService } from '@/services/user.service';\nimport tableMixin from '@/mixins/table.mixin';\nimport { columns } from \"./list.config\";\nimport userPackageActions from '@/hooks/package/package-actions.hook';\nimport Synchronize from '@/views/biz-modals/package/synchronize';\nimport SoldCoursePackageUpdateRights from '@/views/biz-modals/sold/course/package/update-rights';\nimport { MessageService } from '@/services/message.service';\nimport { ruleOptions, ruleOffSaleOptions } from \"./list.config\";\nimport { PRODUCT_CHANNEL } from '@/constants/course/package.ts';\nexport default {\n  name: 'ShopPackageList',\n  mixins: [tableMixin],\n  serviceInject: function serviceInject() {\n    return {\n      userService: UserService,\n      messageService: MessageService,\n      listService: ListService\n    };\n  },\n  modals: {\n    Synchronize: Synchronize,\n    SoldCoursePackageUpdateRights: SoldCoursePackageUpdateRights\n  },\n  hooks: function hooks() {\n    return {\n      userPackageActions: userPackageActions(this)\n    };\n  },\n  rxState: function rxState() {\n    return {\n      publicChannel$: this.listService.publicChannel$,\n      supportNum$: this.listService.supportNum$,\n      list: this.listService.list$,\n      page: this.listService.page$,\n      loading: this.listService.loading$,\n      packageTypes$: this.listService.packageType$,\n      shelfStatus$: this.listService.shelfStatus$,\n      auth$: this.listService.auth$\n    };\n  },\n  bem: {\n    listClass: 'page-shop-package-list'\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      offsaleIsShow: false,\n      deleteIsShow: false,\n      onsaleIsShow: false,\n      packageId: '',\n      packageName: '',\n      start_time: null,\n      is_permanent_sale: 0,\n      end_time: null,\n      endOpen: false,\n      offSaleText: '',\n      type: ['', 'unlimit', 'range', 'fix']\n    };\n  },\n  computed: {\n    columns: columns\n  },\n  methods: {\n    // 售卖时间-start\n    start_time_change: function start_time_change(data) {\n      this.start_time = cloneDeep(data);\n    },\n    handleStartOpenChange: function handleStartOpenChange(open) {\n      if (!open) {\n        this.endOpen = true;\n      }\n    },\n    disabledStartDate: function disabledStartDate(startValue) {\n      var endValue = this.end_time;\n\n      if (!endValue) {\n        // 结束时间未选择\n        return startValue.valueOf() < moment().subtract(1, 'd').valueOf();\n      }\n\n      var start = endValue.valueOf() > moment().add(30, 'y').valueOf() ? moment(endValue).subtract(30, 'y').valueOf() : moment().subtract(1, 'd').add(1, 'ms').valueOf();\n      return startValue.valueOf() < start || startValue.valueOf() > moment(endValue).subtract(1, 'd').valueOf();\n    },\n    // 售卖时间-end\n    end_time_change: function end_time_change(data) {\n      this.end_time = cloneDeep(data);\n    },\n    handleEndOpenChange: function handleEndOpenChange(open) {\n      this.endOpen = open;\n    },\n    disabledEndDate: function disabledEndDate(endValue) {\n      var startValue = this.start_time;\n\n      if (!startValue) {\n        // 开始时间未选择\n        return endValue.valueOf() >= moment().add(30, 'y').valueOf() || endValue.valueOf() <= moment().valueOf();\n      }\n\n      return endValue.valueOf() >= moment(startValue).add(30, 'y').valueOf() || endValue.valueOf() < moment(startValue).add(1, 'd').valueOf();\n    },\n    // moment\n    moment: moment,\n    onAddPackage: function onAddPackage() {\n      this.$router.push({\n        name: 'shop-product-package-add'\n      });\n    },\n    onEdit: function onEdit(id) {\n      this.$router.push({\n        name: 'shop-product-package-edit',\n        query: {\n          id: id\n        }\n      });\n    },\n    onDetail: function onDetail(id, packageType) {\n      this.$router.push({\n        name: 'shop-product-package-info',\n        query: {\n          id: id,\n          packageType: packageType\n        }\n      });\n    },\n    batchOperate: function batchOperate(id) {\n      var _this = this;\n\n      this.$modalRouter.push({\n        name: 'Synchronize',\n        on: {\n          success: function success() {\n            _this.$confirm({\n              title: '提示',\n              content: \"\\u8BF7\\u518D\\u6B21\\u786E\\u8BA4\\u662F\\u5426\\u540C\\u6B65\\uFF0C\\u540C\\u6B65\\u540E\\u4F1A\\u8986\\u76D6\\u552E\\u51FA\\u8BFE\\u7A0B\\u5305\\uFF0C\\u5C06\\u4F1A\\u67092\\uFF5E5s\\u65E0\\u6CD5\\u6B63\\u5E38\\u4F7F\\u7528\",\n              onOk: function onOk() {\n                _this.listService.setSyncSold(id).subscribe(function (res) {\n                  _this.$modalRouter.push({\n                    name: 'success-tip'\n                  });\n\n                  _this.$router.reload();\n                });\n              },\n              onCancel: function onCancel() {}\n            });\n          }\n        }\n      });\n    },\n    onUpShelf: function onUpShelf(id, channel) {\n      this.userPackageActions.onUpShelf({\n        id: id,\n        channel: channel,\n        pageType: 'shop'\n      });\n    },\n    onDownShelf: function onDownShelf(id, name) {\n      this.userPackageActions.onDownShelf({\n        id: id,\n        pageType: 'shop',\n        shopPackageName: name\n      });\n    },\n    deletePackage: function deletePackage(id, name) {\n      var _this2 = this;\n\n      this.userPackageActions.deletePackage(id, name, this.listService.deletePackage.bind(this.listService)).then(function (res) {\n        _this2.$router.reload();\n\n        console.log(res);\n      });\n    }\n  }\n};",{"version":3,"sources":["list.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-panel app :class=\"listClass()\">\n    <div slot=\"title\">\n      <st-input-search\n        @search=\"onSingleSearch('course_name', $event, true)\"\n        v-model=\"$searchQuery.course_name\"\n        placeholder=\"搜索课程包名称\"\n      />\n    </div>\n    <div :class=\"listClass('operation')\">\n      <st-button\n        type=\"primary\"\n        v-if=\"auth$.add\"\n        @click=\"onAddPackage\"\n        icon=\"add\"\n      >\n        新增门店课程包\n      </st-button>\n      <div :class=\"listClass('select-group')\">\n        <a-select\n          v-model=\"$searchQuery.support_num\"\n          @change=\"onSingleSearch('support_num', $event)\"\n          style=\"width: 160px\"\n          class=\"mg-r16\"\n          :options=\"supportNum$\"\n        />\n        <a-select\n          v-model=\"$searchQuery.package_type\"\n          @change=\"onSingleSearch('package_type', $event)\"\n          :class=\"listClass('select')\"\n          style=\"width: 160px\"\n          :options=\"packageTypes$\"\n        />\n        <a-select\n          v-model=\"$searchQuery.publish_channel\"\n          @change=\"onSingleSearch('publish_channel', $event)\"\n          :class=\"listClass('select')\"\n          class=\"mg-l16\"\n          style=\"width: 160px\"\n          :options=\"publicChannel$\"\n        />\n        <a-select\n          v-model=\"$searchQuery.shelf_status\"\n          @change=\"onSingleSearch('shelf_status', $event)\"\n          :class=\"listClass('select')\"\n          style=\"width: 160px\"\n          :options=\"shelfStatus$\"\n        />\n      </div>\n    </div>\n    <st-table\n      :page=\"page\"\n      :columns=\"columns\"\n      @change=\"onTableChange\"\n      rowKey=\"package_course_id\"\n      :dataSource=\"list\"\n      :loading=\"loading.getList\"\n    >\n      <template slot=\"package_type\" slot-scope=\"text\">\n        {{ text | enumFilter('package_course.package_type') }}\n      </template>\n      <template slot=\"is_limit\" slot-scope=\"text\">\n        <span>{{ text | enumFilter('package_course.is_limit') }}</span>\n      </template>\n      <template slot=\"valid_time\" slot-scope=\"text, record\">\n        {{ text }}\n        {{\n          record.valid_time_unit | enumFilter('package_course.valid_time_unit')\n        }}\n      </template>\n      <template slot=\"shelf_status\" slot-scope=\"text, record\">\n        <st-text\n          :status=\"{\n            success: record.shelf_status === 1,\n            error: record.shelf_status === 2,\n            warning: record.shelf_status === 0\n          }\"\n        >\n          {{ text | enumFilter('package_course.shelf_status') }}\n        </st-text>\n        <template v-if=\"record.shelf_status === 2\">\n          <st-help-popover>\n            <span slot=\"content\">{{ record.reason }}</span>\n          </st-help-popover>\n        </template>\n      </template>\n\n      <div slot=\"action\" slot-scope=\"text, record\">\n        <st-table-actions>\n          <a\n            v-if=\"record.auth['shop:product:package_course|edit']\"\n            @click=\"onEdit(record.package_course_id, record.package_type)\"\n          >\n            编辑\n          </a>\n          <a\n            v-if=\"record.auth['shop:product:package_course|get']\"\n            @click=\"onDetail(record.package_course_id, record.package_type)\"\n          >\n            详情\n          </a>\n          <a\n            v-if=\"record.auth['shop:product:package_course|batch_operate']\"\n            @click=\"batchOperate(record.package_course_id, record.course_name)\"\n          >\n            应用至售出\n          </a>\n          <a\n            v-if=\"record.auth['shop:product:package_course|up']\"\n            @click=\"\n              onUpShelf(\n                record.package_course_id,\n                record.publish_channel,\n                record.is_permanent_sale\n              )\n            \"\n          >\n            上架\n          </a>\n          <a\n            v-if=\"record.auth['shop:product:package_course|down']\"\n            @click=\"onDownShelf(record.package_course_id, record.course_name)\"\n          >\n            下架\n          </a>\n          <a\n            v-if=\"record.auth['shop:product:package_course|del']\"\n            @click=\"deletePackage(record.package_course_id, record.course_name)\"\n          >\n            删除\n          </a>\n          <a\n            v-if=\"record.auth['shop:product:package_course|delllls']\"\n            @click=\"deletePackage(record.package_course_id, record.course_name)\"\n          >\n            批量操作\n          </a>\n          <a\n            v-if=\"record.auth['shop:product:package_course|sync_rights']\"\n            v-modal-link=\"{\n              name: 'sold-course-package-update-rights',\n              props: {\n                id: record.package_course_id,\n                isSync: true,\n                isShowLink: true\n              }\n            }\"\n          >\n            修改售出权益\n          </a>\n        </st-table-actions>\n      </div>\n    </st-table>\n  </st-panel>\n</template>\n<script>\nimport moment from 'moment'\nimport { cloneDeep } from 'lodash-es'\nimport { ListService } from './list.service'\nimport { UserService } from '@/services/user.service'\nimport tableMixin from '@/mixins/table.mixin'\nimport { columns } from './list.config'\nimport userPackageActions from '@/hooks/package/package-actions.hook'\nimport Synchronize from '@/views/biz-modals/package/synchronize'\nimport SoldCoursePackageUpdateRights from '@/views/biz-modals/sold/course/package/update-rights'\nimport { MessageService } from '@/services/message.service'\nimport { ruleOptions, ruleOffSaleOptions } from './list.config'\nimport { PRODUCT_CHANNEL } from '@/constants/course/package.ts'\n\nexport default {\n  name: 'ShopPackageList',\n  mixins: [tableMixin],\n  serviceInject() {\n    return {\n      userService: UserService,\n      messageService: MessageService,\n      listService: ListService\n    }\n  },\n  modals: {\n    Synchronize,\n    SoldCoursePackageUpdateRights\n  },\n  hooks() {\n    return {\n      userPackageActions: userPackageActions(this)\n    }\n  },\n  rxState() {\n    return {\n      publicChannel$: this.listService.publicChannel$,\n      supportNum$: this.listService.supportNum$,\n      list: this.listService.list$,\n      page: this.listService.page$,\n      loading: this.listService.loading$,\n      packageTypes$: this.listService.packageType$,\n      shelfStatus$: this.listService.shelfStatus$,\n      auth$: this.listService.auth$\n    }\n  },\n  bem: {\n    listClass: 'page-shop-package-list'\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      offsaleIsShow: false,\n      deleteIsShow: false,\n      onsaleIsShow: false,\n      packageId: '',\n      packageName: '',\n      start_time: null,\n      is_permanent_sale: 0,\n      end_time: null,\n      endOpen: false,\n      offSaleText: '',\n      type: ['', 'unlimit', 'range', 'fix']\n    }\n  },\n  computed: {\n    columns\n  },\n  methods: {\n    // 售卖时间-start\n    start_time_change(data) {\n      this.start_time = cloneDeep(data)\n    },\n    handleStartOpenChange(open) {\n      if (!open) {\n        this.endOpen = true\n      }\n    },\n    disabledStartDate(startValue) {\n      const endValue = this.end_time\n      if (!endValue) {\n        // 结束时间未选择\n        return (\n          startValue.valueOf() <\n          moment()\n            .subtract(1, 'd')\n            .valueOf()\n        )\n      }\n      let start =\n        endValue.valueOf() >\n        moment()\n          .add(30, 'y')\n          .valueOf()\n          ? moment(endValue)\n              .subtract(30, 'y')\n              .valueOf()\n          : moment()\n              .subtract(1, 'd')\n              .add(1, 'ms')\n              .valueOf()\n      return (\n        startValue.valueOf() < start ||\n        startValue.valueOf() >\n          moment(endValue)\n            .subtract(1, 'd')\n            .valueOf()\n      )\n    },\n    // 售卖时间-end\n    end_time_change(data) {\n      this.end_time = cloneDeep(data)\n    },\n    handleEndOpenChange(open) {\n      this.endOpen = open\n    },\n    disabledEndDate(endValue) {\n      const startValue = this.start_time\n      if (!startValue) {\n        // 开始时间未选择\n        return (\n          endValue.valueOf() >=\n            moment()\n              .add(30, 'y')\n              .valueOf() || endValue.valueOf() <= moment().valueOf()\n        )\n      }\n      return (\n        endValue.valueOf() >=\n          moment(startValue)\n            .add(30, 'y')\n            .valueOf() ||\n        endValue.valueOf() <\n          moment(startValue)\n            .add(1, 'd')\n            .valueOf()\n      )\n    },\n    // moment\n    moment,\n    onAddPackage() {\n      this.$router.push({ name: 'shop-product-package-add' })\n    },\n    onEdit(id) {\n      this.$router.push({\n        name: 'shop-product-package-edit',\n        query: {\n          id\n        }\n      })\n    },\n    onDetail(id, packageType) {\n      this.$router.push({\n        name: 'shop-product-package-info',\n        query: {\n          id,\n          packageType\n        }\n      })\n    },\n    batchOperate(id) {\n      this.$modalRouter.push({\n        name: 'Synchronize',\n        on: {\n          success: () => {\n            this.$confirm({\n              title: '提示',\n              content: `请再次确认是否同步，同步后会覆盖售出课程包，将会有2～5s无法正常使用`,\n              onOk: () => {\n                this.listService.setSyncSold(id).subscribe(res => {\n                  this.$modalRouter.push({\n                    name: 'success-tip'\n                  })\n                  this.$router.reload()\n                })\n              },\n              onCancel() {}\n            })\n          }\n        }\n      })\n    },\n    onUpShelf(id, channel) {\n      this.userPackageActions.onUpShelf({ id, channel, pageType: 'shop' })\n    },\n    onDownShelf(id, name) {\n      this.userPackageActions.onDownShelf({\n        id,\n        pageType: 'shop',\n        shopPackageName: name\n      })\n    },\n\n    deletePackage(id, name) {\n      this.userPackageActions\n        .deletePackage(\n          id,\n          name,\n          this.listService.deletePackage.bind(this.listService)\n        )\n        .then(res => {\n          this.$router.reload()\n          console.log(res)\n        })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/shop/product/course/manage/package"}]}