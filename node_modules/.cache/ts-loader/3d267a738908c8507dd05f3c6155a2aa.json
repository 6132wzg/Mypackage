{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-3!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/marketing/add-ticket.config.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/marketing/add-ticket.config.ts","mtime":1594718339916},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.number.is-nan\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport moment from 'moment';\nimport { ACTIVITY_STATUS } from '@/constants/brand/marketing';\nexport var ruleOptions = function ruleOptions(vm) {\n  var pattern = vm.pattern;\n  return {\n    ticket_name: {\n      rules: [{\n        required: true,\n        message: '请输入票种名称'\n      }, {\n        pattern: pattern.CN_EN_NUM('1-10'),\n        message: '请输入1~10个英文，中文字符'\n      }, {\n        validator: function validator(field, value, values) {\n          var ticketNames = vm.dataSource.map(function (item) {\n            return item.ticket_name;\n          }); // 如果编辑时编辑后的票名和之前一样不需要校验\n\n          if (vm.ticket && vm.ticket.ticket_name === value) return;\n\n          if (ticketNames.includes(value)) {\n            return '票种名称重复请重新输入';\n          }\n        }\n      }]\n    },\n    ticket_price: {\n      initialValue: 1,\n      rules: [{\n        required: true,\n        message: '请输入价格'\n      }]\n    },\n    ticket_total_num: {\n      initialValue: 1,\n      rules: [{\n        required: true,\n        message: '请输入票数'\n      }, {\n        validator: function validator(field, value, values) {\n          var ticketTotalNum = 0;\n\n          if (vm.formData && Array.isArray(vm.formData.ticket_list)) {\n            vm.formData.ticket_list.forEach(function (item) {\n              if (vm.ticket && item.ticket_id === vm.ticket.ticket_id) {\n                ticketTotalNum = item.ticket_total_num;\n              }\n            });\n          }\n\n          if (vm.ticket && vm.ticket.ticket_id && vm.formData.activity_status === 1 && value < ticketTotalNum) {\n            return '编辑票种时，票数只能增加不能减少';\n          }\n        }\n      }]\n    },\n    crowd_id: {\n      rules: [{\n        required: true,\n        message: '请选择购买用户'\n      }]\n    },\n    buy_limit_min: {\n      initialValue: 1,\n      rules: [{\n        required: true,\n        message: '请输入最少份数'\n      }, {\n        validator: function validator(field, value, values) {\n          // 票种为免费票团购优惠没有\n          if (+values.ticket_price > 0 && +value > +values.ticket_total_num) {\n            return '单次购买最低张数应小于票的总数';\n          }\n        }\n      }]\n    },\n    buy_limit_max: {\n      initialValue: 1,\n      rules: [{\n        validator: function validator(field, value, values) {\n          if (+value > +values.ticket_total_num) {\n            return '单次购买最高张数应小于票的总数';\n          }\n\n          if (+values.buy_limit_min > 0 && +value < +values.buy_limit_min) {\n            return \"\\u6700\\u5927\\u8D2D\\u4E70\\u5F20\\u6570\\u5E94\\u5927\\u4E8E\\u6700\\u4F4E\\u8D2D\\u4E70\\u5F20\\u6570\".concat(values.buy_limit_min);\n          }\n        }\n      }]\n    },\n    is_group_buy: {\n      initialValue: 1\n    },\n    group_buy_min: {\n      initialValue: 1,\n      rules: [{\n        validator: function validator(field, value, values) {\n          if (Number.isNaN(value) || Number.isNaN(values.ticket_total_num)) {\n            return;\n          } else {\n            if (value > values.ticket_total_num) {\n              return '单次购买超过张数应小于票的总数';\n            }\n          }\n\n          if (+value < +values.buy_limit_min || +value > +values.buy_limit_max) {\n            return \"\\u5355\\u6B21\\u8D2D\\u4E70\\u533A\\u95F4\\u5728\".concat(values.buy_limit_min, \" - \").concat(values.buy_limit_max);\n          }\n        }\n      }]\n    },\n    reduce_price: {\n      initialValue: 1,\n      rules: [{\n        validator: function validator(field, value, values) {\n          if (Number.isNaN(value) || Number.isNaN(values.ticket_price)) return;\n\n          if (+value > +values.ticket_price) {\n            return '每张减的价格应小于票的原价';\n          }\n        }\n      }]\n    },\n    buy_time_limit: {\n      initialValue: 0,\n      rules: [{\n        required: true,\n        message: '请选择时间'\n      }]\n    },\n    buy_time: {\n      rules: [{\n        validator: function validator(field, value, values) {\n          if (vm.formData.activity_status === ACTIVITY_STATUS.PUBLISHED) return;\n          var endTime = moment(vm.stepForm.end_time);\n\n          if (value && value.length && value[0].valueOf() > endTime.valueOf()) {\n            return \"\\u552E\\u5356\\u5F00\\u59CB\\u65F6\\u95F4\\u8981\\u65E9\\u4E8E\\u6D3B\\u52A8\\u7ED3\\u675F\\u65F6\\u95F4\".concat(endTime.format('YYYY-MM-DD  HH:mm'));\n          }\n\n          if (value && value.length && value[1].valueOf() > endTime.valueOf()) {\n            return \"\\u552E\\u5356\\u7ED3\\u675F\\u65F6\\u95F4\\u8981\\u65E9\\u4E8E\\u6D3B\\u52A8\\u7ED3\\u675F\\u65F6\\u95F4\".concat(endTime.format('YYYY-MM-DD  HH:mm'));\n          }\n        }\n      }]\n    },\n    ticket_remark: {}\n  };\n};",null]}