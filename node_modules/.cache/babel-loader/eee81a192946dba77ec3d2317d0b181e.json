{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/member-points/list/setting.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/member-points/list/setting.vue","mtime":1600926556150},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { SettingService } from \"./setting.service\";\nimport moment from 'moment';\nexport default {\n  name: 'Setting',\n  bem: {\n    b: 'brand-plagin-member-points-setting'\n  },\n  watch: {\n    setting$: {\n      handler: function handler(newVal) {\n        this.initData(newVal);\n      },\n      deep: true\n    }\n  },\n  data: function data() {\n    return {\n      isEdit: false,\n      setting: {\n        validate_num: 0,\n        validate_unit: 0\n      },\n      validateNum: 0,\n      validateUnit: 0,\n      isOpen: 1,\n      actionList: [],\n      actionCheckList: [],\n      consumeList: [],\n      consumeCheckList: [],\n      termDate: moment().endOf(this.setting$.validate_unit === 1 ? 'month' : 'year').format('YYYY年MM月DD日')\n    };\n  },\n  serviceInject: function serviceInject() {\n    return {\n      service: SettingService\n    };\n  },\n  rxState: function rxState() {\n    var _this$service = this.service,\n        loading$ = _this$service.loading$,\n        setting$ = _this$service.setting$,\n        defalutOptions$ = _this$service.defalutOptions$,\n        linkPoints$ = _this$service.linkPoints$,\n        sourceTypeOptions$ = _this$service.sourceTypeOptions$,\n        payPointsOptions$ = _this$service.payPointsOptions$,\n        actionPointsOptions$ = _this$service.actionPointsOptions$,\n        validateUnitTypeOptions$ = _this$service.validateUnitTypeOptions$,\n        validateUnitType$ = _this$service.validateUnitType$,\n        auth$ = _this$service.auth$;\n    return {\n      loading$: loading$,\n      setting$: setting$,\n      defalutOptions$: defalutOptions$,\n      linkPoints$: linkPoints$,\n      sourceTypeOptions$: sourceTypeOptions$,\n      payPointsOptions$: payPointsOptions$,\n      actionPointsOptions$: actionPointsOptions$,\n      validateUnitTypeOptions$: validateUnitTypeOptions$,\n      validateUnitType$: validateUnitType$,\n      auth$: auth$\n    };\n  },\n  computed: {\n    getRules: function getRules() {\n      var listMap = {};\n      var list = [];\n      this.actionList.map(function (item) {\n        listMap[item.id] = item;\n      });\n      this.actionCheckList.map(function (id) {\n        list.push(listMap[id]);\n      });\n      return list;\n    },\n    supportCategory: function supportCategory() {\n      var listMap = {};\n      var list = [];\n      this.consumeList.map(function (item) {\n        listMap[item.id] = item;\n      });\n      this.consumeCheckList.map(function (id) {\n        list.push(listMap[id]);\n      });\n      return list;\n    }\n  },\n  created: function created() {\n    this.initData(this.setting$);\n  },\n  methods: {\n    initData: function initData(newVal) {\n      this.setting = newVal || {\n        validate_num: 0,\n        validate_unit: 0\n      };\n      this.validateNum = newVal.validate_num;\n      this.validateUnit = newVal.validate_unit;\n      this.termDate = moment().add(newVal.validate_num, newVal.validate_unit === 1 ? 'months' : 'years').endOf(newVal.validate_unit === 1 ? 'month' : 'year').format('YYYY年MM月DD日');\n      this.isOpen = newVal.activity_status === 1 ? 1 : 0;\n      var actionObj = this.SET_ACTION(newVal.get_rules);\n      this.actionList = actionObj.list;\n      this.actionCheckList = actionObj.checkList;\n      var consumeObj = this.SET_CONSUME(newVal.support_category);\n      this.consumeList = consumeObj.list;\n      this.consumeCheckList = consumeObj.checkList;\n    },\n    onChange: function onChange() {\n      this.isEdit = true;\n    },\n    onTermChange: function onTermChange(e) {\n      var _this = this;\n\n      this.isEdit = true;\n      this.$nextTick(function () {\n        _this.termDate = moment().add(_this.validateNum, _this.validateUnit === 1 ? 'months' : 'years').endOf(_this.validateUnit === 1 ? 'month' : 'year').format('YYYY年MM月DD日');\n      });\n    },\n    onOffChange: function onOffChange() {\n      var _this2 = this;\n\n      if (!this.auth$.open) return;\n      this.isEdit = true;\n      this.$confirm({\n        title: '提示',\n        content: !this.isOpen ? '请确定以下积分规则设置无误，开启后，会员将在个人中心看到积分相关功能，并可按规则赚取积分。' : '关闭积分后会员将看不到积分入口，无法获取、消耗积分，可能会引发会员投诉，对品牌公信度带来不好的影响，请谨慎操作。',\n        onOk: function onOk() {\n          console.log('OK');\n          _this2.isOpen = _this2.isOpen === 1 ? 0 : 1;\n        },\n        onCancel: function onCancel() {\n          console.log('Cancel');\n        }\n      });\n    },\n    onSubmit: function onSubmit() {\n      var _this3 = this;\n\n      var get_rules = this.getRules.map(function (item) {\n        return _objectSpread({}, item, {\n          points: +item.points\n        });\n      });\n      var support_category = this.supportCategory.map(function (item) {\n        return _objectSpread({}, item, {\n          price: +item.price,\n          points: +item.points\n        });\n      });\n      this.service.setPoiontsSetting(_objectSpread({}, this.setting, {\n        activity_status: this.isOpen === 1 ? 1 : 2,\n        validate_num: +this.validateNum,\n        validate_unit: +this.validateUnit,\n        get_rules: get_rules,\n        support_category: support_category\n      })).subscribe(function () {\n        _this3.isEdit = false;\n\n        _this3.service.refreshUserInfo().subscribe();\n\n        _this3.$router.push({\n          path: './member-points'\n        });\n      });\n    },\n    onPush: function onPush(name) {\n      var routeUrl = this.$router.resolve({\n        name: name\n      });\n      window.open(routeUrl.href, '_blank');\n    },\n    SET_ACTION: function SET_ACTION() {\n      var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      var list = [];\n      var checkList = [];\n      var dataValusMap = {};\n      var actionOptionsMap = {};\n      var defalutActionRules = this.defalutOptions$.get_rules;\n      this.actionPointsOptions$.map(function (item) {\n        actionOptionsMap[item.id] = item;\n      });\n      data.map(function (item) {\n        dataValusMap[item.id] = item;\n        checkList.push(item.id);\n      });\n      list = defalutActionRules.map(function (item) {\n        return _objectSpread({}, item, {\n          points: dataValusMap[item.id] && dataValusMap[item.id].points || item.points,\n          label: actionOptionsMap[item.id] && actionOptionsMap[item.id].text,\n          text: actionOptionsMap[item.id] && actionOptionsMap[item.id].desc\n        });\n      });\n      this.actionList = list;\n      this.actionCheckList = checkList;\n      return {\n        list: list,\n        checkList: checkList\n      };\n    },\n    SET_CONSUME: function SET_CONSUME() {\n      var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      var list = [];\n      var checkList = [];\n      var dataValusMap = {};\n      var consumeOptionsMap = this.payPointsOptions$;\n      var defalutConsumeRules = this.defalutOptions$.support_category;\n      data.map(function (item) {\n        dataValusMap[item.id] = item;\n        checkList.push(item.id);\n      });\n      list = defalutConsumeRules.map(function (item) {\n        return _objectSpread({}, item, {\n          points: dataValusMap[item.id] && dataValusMap[item.id].points || item.points,\n          price: dataValusMap[item.id] && dataValusMap[item.id].price || item.price,\n          label: consumeOptionsMap[item.id]\n        });\n      });\n      this.consumeList = list;\n      this.consumeCheckList = checkList;\n      return {\n        list: list,\n        checkList: checkList\n      };\n    }\n  },\n  beforeRouteLeave: function beforeRouteLeave(to, from, next) {\n    var _this4 = this;\n\n    // this.targetName = to.name  // 提示框点击确认后跳转的 路由\n    if (this.isEdit) {\n      this.$confirm({\n        title: '提示',\n        content: '您的设置还未保存，是否继续离开页面？',\n        onOk: function onOk() {\n          console.log('OK');\n          _this4.isEdit = false;\n          next();\n        },\n        onCancel: function onCancel() {\n          console.log('Cancel');\n          next(false);\n        }\n      }); // next(false)\n    } else {\n      next();\n    }\n  }\n};",{"version":3,"sources":["setting.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div :class=\"b()\">\n    <st-form>\n      <st-form-item label=\"积分应用\">\n        <div :class=\"b('tip')\">\n          <div\n            :class=\"b('tip-item')\"\n            v-for=\"link in linkPoints$\"\n            :key=\"link.id\"\n            @click=\"onPush(link.link, link.query)\"\n            class=\"mg-r64\"\n          >\n            <st-icon :type=\"link.icon\" size=\"22px\" class=\"mg-r8\"></st-icon>\n            <span>{{ link.text }}</span>\n          </div>\n        </div>\n      </st-form-item>\n      <st-form-item label=\"功能开关\">\n        <st-switch v-model=\"isOpen\" :disabled=\"!auth$.open\"></st-switch>\n        <div :class=\"b('switch-btn')\" @click=\"onOffChange\"></div>\n      </st-form-item>\n      <st-form-item label=\"积分有效期\">\n        <st-input-number\n          style=\"width: 140px\"\n          placeholder=\"请输入\"\n          v-model=\"validateNum\"\n          @change=\"onTermChange\"\n        >\n          <a-select\n            slot=\"addonAfter\"\n            v-model=\"validateUnit\"\n            :default-value=\"1\"\n            :options=\"validateUnitTypeOptions$\"\n            @change=\"onTermChange\"\n          />\n        </st-input-number>\n        <span class=\"mg-l16 tip\">\n          例：本{{ validateUnitType$[validateUnit] }}获取的积分，将在{{\n            termDate\n          }}到期\n        </span>\n      </st-form-item>\n      <st-form-item label=\"积分获取规则\">\n        <div :class=\"b('rule')\">\n          <div :class=\"b('rule-item')\">\n            <div class=\"title\">按会员行为送积分</div>\n            <div :class=\"b('rule-item-action')\">\n              <a-checkbox-group\n                :class=\"b('rule-item-action')\"\n                v-model=\"actionCheckList\"\n                @change=\"onChange\"\n              >\n                <a-checkbox\n                  class=\"mg-t16\"\n                  v-for=\"item in actionList\"\n                  :key=\"item.id\"\n                  :value=\"item.id\"\n                >\n                  {{ item.label }}\n                  <st-input-number\n                    style=\"width: 141px\"\n                    placeholder=\"请输入\"\n                    v-model=\"item.points\"\n                    :min=\"0\"\n                    :max=\"99999\"\n                    @change=\"onChange\"\n                  >\n                    <template slot=\"addonAfter\">\n                      积分/次\n                    </template>\n                  </st-input-number>\n                  <span class=\"mg-l16 tip\">{{ item.text }}</span>\n                </a-checkbox>\n              </a-checkbox-group>\n            </div>\n          </div>\n          <div class=\"mg-t16\" :class=\"b('rule-item')\">\n            <div class=\"title\">\n              按会员消费送积分\n              <span class=\"tip\">发生退款时，可扣除对应积分</span>\n            </div>\n            <div>\n              <a-checkbox-group v-model=\"consumeCheckList\">\n                <a-checkbox\n                  class=\"mg-t16\"\n                  v-for=\"item in consumeList\"\n                  :key=\"item.id\"\n                  :value=\"item.id\"\n                  @change=\"onChange\"\n                >\n                  <div class=\"checkbox-content\">\n                    <span class=\"checkbox-content__text\">\n                      {{ item.label }}\n                    </span>\n                    <span class=\"mg-r8\">单次消费每满</span>\n                    <st-input-number\n                      style=\"width: 106px\"\n                      placeholder=\"请输入\"\n                      v-model=\"item.price\"\n                      :min=\"0\"\n                      :max=\"999999\"\n                      @change=\"onChange\"\n                    >\n                      <template slot=\"addonAfter\">\n                        元\n                      </template>\n                    </st-input-number>\n                    <span class=\"mg-l8\">赠送</span>\n                    <st-input-number\n                      class=\"mg-l8\"\n                      style=\"width: 120px\"\n                      placeholder=\"请输入\"\n                      v-model=\"item.points\"\n                      :min=\"0\"\n                      :max=\"99999\"\n                      @change=\"onChange\"\n                    >\n                      <template slot=\"addonAfter\">\n                        积分\n                      </template>\n                    </st-input-number>\n                  </div>\n                </a-checkbox>\n              </a-checkbox-group>\n            </div>\n          </div>\n        </div>\n      </st-form-item>\n      <!-- 每日积分上线功能暂时关闭 -->\n      <!-- <st-form-item label=\"积分上限\">\n        <span class=\"mg-r8\">每个客户每天最多获得</span>\n        <st-input-number\n          style=\"width: 120px\"\n          v-model=\"setting.points_limit\"\n          :min=\"0\"\n          @change=\"onChange\"\n        >\n          <template slot=\"addonAfter\">\n            积分\n          </template>\n        </st-input-number>\n        <span class=\"tip mg-l16\">员工录入积分不受此限制</span>\n      </st-form-item> -->\n      <st-form-item labelFix>\n        <st-button\n          type=\"primary\"\n          :disabled=\"!isEdit\"\n          :loading=\"loading$.setPoiontsSetting\"\n          @click=\"onSubmit\"\n        >\n          保存\n        </st-button>\n      </st-form-item>\n    </st-form>\n  </div>\n</template>\n\n<script>\nimport { SettingService } from './setting.service'\nimport moment from 'moment'\n\nexport default {\n  name: 'Setting',\n  bem: {\n    b: 'brand-plagin-member-points-setting'\n  },\n  watch: {\n    setting$: {\n      handler: function(newVal) {\n        this.initData(newVal)\n      },\n      deep: true\n    }\n  },\n  data() {\n    return {\n      isEdit: false,\n      setting: { validate_num: 0, validate_unit: 0 },\n      validateNum: 0,\n      validateUnit: 0,\n      isOpen: 1,\n      actionList: [],\n      actionCheckList: [],\n      consumeList: [],\n      consumeCheckList: [],\n      termDate: moment()\n        .endOf(this.setting$.validate_unit === 1 ? 'month' : 'year')\n        .format('YYYY年MM月DD日')\n    }\n  },\n  serviceInject() {\n    return {\n      service: SettingService\n    }\n  },\n  rxState() {\n    let {\n      loading$,\n      setting$,\n      defalutOptions$,\n      linkPoints$,\n      sourceTypeOptions$,\n      payPointsOptions$,\n      actionPointsOptions$,\n      validateUnitTypeOptions$,\n      validateUnitType$,\n      auth$\n    } = this.service\n    return {\n      loading$,\n      setting$,\n      defalutOptions$,\n      linkPoints$,\n      sourceTypeOptions$,\n      payPointsOptions$,\n      actionPointsOptions$,\n      validateUnitTypeOptions$,\n      validateUnitType$,\n      auth$\n    }\n  },\n  computed: {\n    getRules() {\n      let listMap = {}\n      let list = []\n      this.actionList.map(item => {\n        listMap[item.id] = item\n      })\n      this.actionCheckList.map(id => {\n        list.push(listMap[id])\n      })\n      return list\n    },\n    supportCategory() {\n      let listMap = {}\n      let list = []\n      this.consumeList.map(item => {\n        listMap[item.id] = item\n      })\n      this.consumeCheckList.map(id => {\n        list.push(listMap[id])\n      })\n      return list\n    }\n  },\n  created() {\n    this.initData(this.setting$)\n  },\n  methods: {\n    initData(newVal) {\n      this.setting = newVal || { validate_num: 0, validate_unit: 0 }\n      this.validateNum = newVal.validate_num\n      this.validateUnit = newVal.validate_unit\n      this.termDate = moment()\n        .add(\n          newVal.validate_num,\n          newVal.validate_unit === 1 ? 'months' : 'years'\n        )\n        .endOf(newVal.validate_unit === 1 ? 'month' : 'year')\n        .format('YYYY年MM月DD日')\n      this.isOpen = newVal.activity_status === 1 ? 1 : 0\n      const actionObj = this.SET_ACTION(newVal.get_rules)\n      this.actionList = actionObj.list\n      this.actionCheckList = actionObj.checkList\n      const consumeObj = this.SET_CONSUME(newVal.support_category)\n      this.consumeList = consumeObj.list\n      this.consumeCheckList = consumeObj.checkList\n    },\n    onChange() {\n      this.isEdit = true\n    },\n    onTermChange(e) {\n      this.isEdit = true\n      this.$nextTick(() => {\n        this.termDate = moment()\n          .add(this.validateNum, this.validateUnit === 1 ? 'months' : 'years')\n          .endOf(this.validateUnit === 1 ? 'month' : 'year')\n          .format('YYYY年MM月DD日')\n      })\n    },\n    onOffChange() {\n      if (!this.auth$.open) return\n      this.isEdit = true\n      this.$confirm({\n        title: '提示',\n        content: !this.isOpen\n          ? '请确定以下积分规则设置无误，开启后，会员将在个人中心看到积分相关功能，并可按规则赚取积分。'\n          : '关闭积分后会员将看不到积分入口，无法获取、消耗积分，可能会引发会员投诉，对品牌公信度带来不好的影响，请谨慎操作。',\n        onOk: () => {\n          console.log('OK')\n          this.isOpen = this.isOpen === 1 ? 0 : 1\n        },\n        onCancel: () => {\n          console.log('Cancel')\n        }\n      })\n    },\n    onSubmit() {\n      const get_rules = this.getRules.map(item => ({\n        ...item,\n        points: +item.points\n      }))\n      const support_category = this.supportCategory.map(item => ({\n        ...item,\n        price: +item.price,\n        points: +item.points\n      }))\n      this.service\n        .setPoiontsSetting({\n          ...this.setting,\n          activity_status: this.isOpen === 1 ? 1 : 2,\n          validate_num: +this.validateNum,\n          validate_unit: +this.validateUnit,\n          get_rules,\n          support_category\n        })\n        .subscribe(() => {\n          this.isEdit = false\n          this.service.refreshUserInfo().subscribe()\n          this.$router.push({\n            path: './member-points'\n          })\n        })\n    },\n    onPush(name) {\n      const routeUrl = this.$router.resolve({\n        name\n      })\n      window.open(routeUrl.href, '_blank')\n    },\n    SET_ACTION(data = []) {\n      let list = []\n      let checkList = []\n      let dataValusMap = {}\n      let actionOptionsMap = {}\n      let defalutActionRules = this.defalutOptions$.get_rules\n      this.actionPointsOptions$.map(item => {\n        actionOptionsMap[item.id] = item\n      })\n      data.map(item => {\n        dataValusMap[item.id] = item\n        checkList.push(item.id)\n      })\n      list = defalutActionRules.map(item => ({\n        ...item,\n        points:\n          (dataValusMap[item.id] && dataValusMap[item.id].points) ||\n          item.points,\n        label: actionOptionsMap[item.id] && actionOptionsMap[item.id].text,\n        text: actionOptionsMap[item.id] && actionOptionsMap[item.id].desc\n      }))\n      this.actionList = list\n      this.actionCheckList = checkList\n      return {\n        list,\n        checkList\n      }\n    },\n    SET_CONSUME(data = []) {\n      let list = []\n      let checkList = []\n      let dataValusMap = {}\n      let consumeOptionsMap = this.payPointsOptions$\n      let defalutConsumeRules = this.defalutOptions$.support_category\n\n      data.map(item => {\n        dataValusMap[item.id] = item\n        checkList.push(item.id)\n      })\n      list = defalutConsumeRules.map(item => ({\n        ...item,\n        points:\n          (dataValusMap[item.id] && dataValusMap[item.id].points) ||\n          item.points,\n        price:\n          (dataValusMap[item.id] && dataValusMap[item.id].price) || item.price,\n        label: consumeOptionsMap[item.id]\n      }))\n      this.consumeList = list\n      this.consumeCheckList = checkList\n      return {\n        list,\n        checkList\n      }\n    }\n  },\n  beforeRouteLeave(to, from, next) {\n    // this.targetName = to.name  // 提示框点击确认后跳转的 路由\n    if (this.isEdit) {\n      this.$confirm({\n        title: '提示',\n        content: '您的设置还未保存，是否继续离开页面？',\n        onOk: () => {\n          console.log('OK')\n          this.isEdit = false\n          next()\n        },\n        onCancel: () => {\n          console.log('Cancel')\n          next(false)\n        }\n      })\n      // next(false)\n    } else {\n      next()\n    }\n  }\n}\n</script>\n\n<style></style>\n"],"sourceRoot":"src/views/pages/brand/marketing/plugin/member-points/list"}]}