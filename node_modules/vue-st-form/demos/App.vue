<template>
  <div>
    <a-row>
      <a-col :span="12">
        <a-form :form="form">
          <a-form-item label="姓名">
            <a-input
              v-decorator="decorators.name"
              placeholder="请填写名称"
            ></a-input>
          </a-form-item>
          <a-form-item label="年龄">
            <a-input
              v-decorator="decorators.age"
              placeholder="请填写年龄"
            ></a-input>
          </a-form-item>
          <a-form-item label="自定义validator">
            <a-input
              v-decorator="decorators.price"
              placeholder="填写价格"
            ></a-input>
          </a-form-item>
          <a-form-item label="自定义validator">
            <a-input
              v-decorator="decorators.cardInfo.price"
              placeholder="填写嵌套价格"
            ></a-input>
          </a-form-item>
          <a-form-item label="alwaysError">
            <a-input
              v-decorator="decorators.alwaysError"
            ></a-input>
          </a-form-item>
          <child v-if="childShow" :form="form"></child>
          <a-button @click="onSubmit">提交</a-button>
          <a-button @click="handleAddDecorators">测试AddDecorators</a-button>
        </a-form>
      </a-col>
    </a-row>

    <a-row>
      <a-col>
        <a-button @click="onOpenModal">
          openModal
        </a-button>
      </a-col>
    </a-row>

    <a-modal v-model="show" @ok="onModalOk">
      <a-form :form="modalForm">
        <a-form-item>
          <a-form-item label="姓名">
            <a-input
              v-decorator="modalDecorators.name"
              placeholder="请填写名称"
            ></a-input>
          </a-form-item>
          <a-form-item label="年龄">
            <a-input
              v-decorator="modalDecorators.age"
              placeholder="请填写年龄"
            ></a-input>
          </a-form-item>
          <a-form-item label="tt1">
            <a-input placeholder="请填写年龄"></a-input>
          </a-form-item>
          <a-form-item label="tt2">
            <a-input placeholder="请填写年龄"></a-input>
          </a-form-item>
          <a-form-item label="tt3">
            <a-input placeholder="请填写年龄"></a-input>
          </a-form-item>
          <a-form-item label="tt4">
            <a-input placeholder="请填写年龄"></a-input>
          </a-form-item>
          <a-form-item label="tt5">
            <a-input placeholder="请填写年龄"></a-input>
          </a-form-item>
          <a-form-item label="tt6">
            <a-input placeholder="请填写年龄"></a-input>
          </a-form-item>
          <a-form-item label="tt7">
            <a-input placeholder="请填写年龄"></a-input>
          </a-form-item>
        </a-form-item>
      </a-form>
    </a-modal>
  </div>
</template>

<script>
import child from './child'
export default {
  data() {
    const form = this.$stForm.create({
      onValuesChange(vm, values) {
        console.log("onValuesChange", vm, values)
      }
    })

    const decorators = form.decorators({
      name: {
        initialValue: 3,
        rules: [
          {
            required: true,
            message: "请填写"
          }
        ]
      },
      age: {
        rules: [
          {
            required: true,
            message: "请填写age"
          }
        ]
      },
      price: {
        rules: [
          {
            validator: this.priceValidator
          }
        ]
      },
      "cardInfo.price": {
        rules: [
          {
            required: true,
            message: "嵌套数据"
          }
        ]
      }
      // ,
      // alwaysError:{
      //   rules:[
      //     {
      //       validator(){
      //         return false
      //       },
      //       defalutMessage: '这是一个自定义的错误'
      //     }
      //   ]
      // }
    })
    const modalForm = this.$stForm.create()
    const modalDecorators = modalForm.decorators({
      name: {
        initialValue: 3,
        rules: [
          {
            required: true,
            message: "请填写"
          }
        ]
      },
      age: {
        rules: [
          {
            required: true,
            message: "请填写age"
          }
        ]
      },
      
    })

    return {
      form,
      decorators,
      modalForm,
      modalDecorators,
      show: false,
      childShow: false
    }
  },
  methods: {
    onOpenModal() {
      this.show = true
    },
    onModalOk() {
      this.modalForm.validate().then(values => {
        console.log("modalFormValues", values)
      })
    },
    priceValidator(field, value, values) {
      if (!value) {
        return "请填写价格"
      }
      if (value < 99) {
        return "价格不能小于99"
      }
    },
    onSubmit() {
      console.log("submit")
      this.form
        .validate().then(values => {
          console.log(values)
        }).catch(err => {
          console.log(err)
        })
    },
    handleAddDecorators() {
      // 展示子组件
      this.childShow = true
    }
  },
  components: {
    child
  }
}
</script>
