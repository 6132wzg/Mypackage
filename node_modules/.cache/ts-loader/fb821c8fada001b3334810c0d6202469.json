{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js??ref--13-3!/Users/wangzhigang/Desktop/styd/web/src/services/udesk.service.ts","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/services/udesk.service.ts","mtime":1591147717089},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/ts-loader/index.js","mtime":1591062571609}],"contextDependencies":[],"result":["import \"core-js/modules/es6.string.link\";\nimport _classCallCheck from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar _a, _b;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { State } from 'rx-state';\nimport { Injectable } from 'vue-service-app';\nimport { HttpService } from \"./http.service\";\nimport { tap } from 'rxjs/operators';\nimport { AppConfig } from '@/constants/config';\n/**\n * udesk 接入信息\n */\n\nvar UdeskService = /*#__PURE__*/function () {\n  function UdeskService(http, appConfig) {\n    _classCallCheck(this, UdeskService);\n\n    this.http = http;\n    this.appConfig = appConfig;\n    this.customer$ = new State({});\n    this.isShowUdeskBtn$ = new State(true);\n    this.loading$ = new State(false);\n    this.isCreated = false;\n  }\n\n  _createClass(UdeskService, [{\n    key: \"fetchUdeskCustomerInfo\",\n    value: function fetchUdeskCustomerInfo() {\n      var _this = this;\n\n      return this.http.get('/udesk').pipe(tap(function (res) {\n        _this.customer$.commit(function () {\n          return res;\n        });\n      }));\n    }\n  }, {\n    key: \"create\",\n    value: function create() {\n      var config = this.appConfig.UDESK_CONFIG;\n      var customer = this.customer$.snapshot();\n      customer.c_name = customer.user_name + '_' + customer.brand_name;\n      customer.c_cf_品牌名称 = customer.brand_name;\n\n      (function (a, h, c, b, f, g) {\n        a['UdeskApiObject'] = f;\n\n        a[f] = a[f] || function () {\n          ;\n          (a[f].d = a[f].d || []).push(arguments);\n        };\n\n        g = h.createElement(c);\n        g.async = 1;\n        g.charset = 'utf-8';\n        g.src = b;\n        c = h.getElementsByTagName(c)[0];\n        c.parentNode.insertBefore(g, c);\n      })(window, document, 'script', \"\".concat(config.config_link), 'ud');\n\n      return new Promise(function (resolve, reject) {\n        // @ts-ignore\n        ud({\n          code: \"\".concat(config.code),\n          link: \"\".concat(config.link),\n          customer: customer,\n          onReady: function onReady() {\n            setTimeout(function () {\n              resolve();\n            }, 300);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"setIsShowUdeskBtn\",\n    value: function setIsShowUdeskBtn(val) {\n      this.isShowUdeskBtn$.commit(function () {\n        return val;\n      });\n    }\n  }, {\n    key: \"setLoading\",\n    value: function setLoading(val) {\n      this.loading$.commit(function () {\n        return val;\n      });\n    }\n    /**\n     * 打开 udesk 对话面板\n     * 如果 udesk 实例尚未创建，先创建再打开\n     * @return {promise}\n     */\n\n  }, {\n    key: \"show\",\n    value: function show() {\n      var _this2 = this;\n\n      if (this.loading$.snapshot()) {\n        return;\n      }\n\n      return new Promise(function (resolve) {\n        if (!_this2.isCreated) {\n          _this2.setLoading(true);\n          /**\n           * 获取udesk 校验参数\n           */\n\n\n          _this2.fetchUdeskCustomerInfo().subscribe(function () {\n            /**\n             * 实例化 udesk\n             */\n            _this2.create().then(function () {\n              _this2.isCreated = true;\n\n              _this2.setLoading(false); // @ts-ignore\n\n\n              ud('showPanel');\n              resolve();\n            });\n          });\n        } else {\n          // @ts-ignore\n          ud('showPanel');\n          resolve();\n        }\n      });\n    }\n    /**\n     * 隐藏 udesk 面板\n     */\n\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      // @ts-ignore\n      ud('hidePanel');\n    }\n  }]);\n\n  return UdeskService;\n}();\n\nUdeskService = __decorate([Injectable(), __metadata(\"design:paramtypes\", [typeof (_a = typeof HttpService !== \"undefined\" && HttpService) === \"function\" ? _a : Object, typeof (_b = typeof AppConfig !== \"undefined\" && AppConfig) === \"function\" ? _b : Object])], UdeskService);\nexport { UdeskService };",null]}