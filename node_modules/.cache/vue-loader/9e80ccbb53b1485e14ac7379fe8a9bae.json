{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/reception/reserve/course.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/reception/reserve/course.vue","mtime":1600926556435},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport tableMixin from '@/mixins/table.mixin'\nimport { mainColumns, childColumns } from './course.config'\nimport { CourseService } from './course.service'\nimport RecentRadioGroup from '@/views/components/recent-radio-group/recent-radio-group'\nimport moment from 'moment'\n\nexport default {\n  name: '',\n\n  bem: {\n    b: 'shop-reception-reserve-course'\n  },\n\n  components: { RecentRadioGroup },\n\n  modals: {},\n\n  serviceInject() {\n    return {\n      courseService: CourseService\n    }\n  },\n\n  rxState() {\n    const { courseService } = this\n    return {\n      list: courseService.list$,\n      page: courseService.page$,\n      loading: courseService.loading$,\n      auth: courseService.auth$,\n      courseTypeOptions: courseService.courseTypeOptions$,\n      reserveStatusOptions: courseService.reserveStatusOptions$,\n      checkinOptions: courseService.checkinOptions$\n    }\n  },\n\n  mixins: [tableMixin],\n\n  props: {},\n\n  data() {\n    return {\n      reserveQuery: {\n        end_time: '',\n        search_date: 1,\n        start_time: ''\n      },\n      customRadioDays: [\n        {\n          value: 1,\n          label: '今日'\n        },\n        {\n          value: 2,\n          label: '昨日'\n        },\n        {\n          value: 3,\n          label: '明日'\n        }\n      ]\n    }\n  },\n\n  computed: {\n    mainColumns,\n    childColumns\n  },\n\n  mounted() {},\n\n  methods: {\n    moment,\n    recentChange(data) {\n      const start_time = data.start_date ? `${data.start_date} 00:00` : ''\n      const end_time = data.end_date ? `${data.end_date} 23:59` : ''\n      let recently_day = data.recently_day\n      this.$searchQuery.search_date = recently_day || undefined\n      this.$searchQuery.start_time = start_time || undefined\n      this.$searchQuery.end_time = end_time || undefined\n      if (this.$searchQuery.start_time || this.$searchQuery.end_time) {\n        this.$searchQuery.search_date = undefined\n        recently_day = undefined\n      }\n      this.reserveQuery = {\n        start_time: start_time,\n        end_time: end_time,\n        search_date: recently_day\n      }\n      this.onMultiSearch(this.reserveQuery)\n    },\n    getCourseForm(record, index) {\n      const { id, member } = record\n      let reserve_type = this.list[index].sub_reserve_type\n      return {\n        id: member.id,\n        reserve_type: reserve_type.id,\n        reserve_id: id\n      }\n    },\n    // 取消签到\n    cancelBooking(record, index) {\n      let params = this.getCourseForm(record, index)\n      this.courseService.cancelVisitReserve(params).subscribe(res => {\n        this.$router.reload()\n      })\n    },\n    // 签到\n    booking(record, index) {\n      let params = this.getCourseForm(record, index)\n      this.courseService.confirmVisitReserve(params).subscribe(res => {\n        this.$router.reload()\n      })\n    },\n    onPrint(id) {\n      window.open('/ticket/print?id=' + id, '_blank', 'width=800,height=600')\n    },\n    onSearch() {\n      this.$router.push({ query: this.$searchQuery })\n    },\n    disabledDate(current) {\n      return current && current > moment().add(6, 'months')\n    }\n  }\n}\n",{"version":3,"sources":["course.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0HA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"course.vue","sourceRoot":"src/views/pages/shop/reception/reserve","sourcesContent":["<template>\n  <div :class=\"b()\">\n    <st-table-header-section class=\"mg-b16\" :class=\"b('nav')\">\n      <st-button\n        type=\"primary\"\n        v-if=\"auth.export\"\n        v-export-excel=\"{\n          type: 'reserve',\n          query: reserveQuery\n        }\"\n        class=\"mg-r8\"\n      >\n        全部导出\n      </st-button>\n      <div :class=\"b('actions')\" slot=\"actions\">\n        <recent-radio-group\n          _day=\"search_date\"\n          _start_date=\"start_time\"\n          _end_date=\"end_time\"\n          :showBtnRangeDate=\"false\"\n          :defaultRecent=\"1\"\n          :disabledDate=\"disabledDate\"\n          :days=\"customRadioDays\"\n          @change=\"recentChange\"\n        ></recent-radio-group>\n      </div>\n      <!-- 课程类型 -->\n      <a-select\n        class=\"mg-r8\"\n        v-model=\"$searchQuery.course_type\"\n        :options=\"courseTypeOptions\"\n        style=\"width: 140px\"\n        @change=\"onSearch\"\n      ></a-select>\n      <!-- 预约状态 -->\n      <a-select\n        class=\"mg-r8\"\n        v-model=\"$searchQuery.reserve_status\"\n        :options=\"reserveStatusOptions\"\n        style=\"width: 140px\"\n        @change=\"onSearch\"\n      ></a-select>\n      <!-- 签到状态 -->\n      <a-select\n        class=\"mg-r8\"\n        v-model=\"$searchQuery.is_checkin\"\n        :options=\"checkinOptions\"\n        style=\"width: 140px\"\n        @change=\"onSearch\"\n      ></a-select>\n    </st-table-header-section>\n    <div :class=\"b('table')\">\n      <st-table\n        :page=\"page\"\n        @change=\"onTableChange\"\n        :loading=\"loading.getList\"\n        :columns=\"mainColumns\"\n        :dataSource=\"list\"\n        :stripe=\"false\"\n        rowKey=\"id\"\n      >\n        <template slot=\"sub_reserve_type\" slot-scope=\"record\">\n          {{ record.name }}\n        </template>\n        <template slot=\"remark\" slot-scope=\"record\">\n          <st-overflow-text\n            :value=\"record.remark\"\n            maxWidth=\"200px\"\n            placement=\"bottomLeft\"\n            needOverflowTextContainer\n          ></st-overflow-text>\n        </template>\n        <st-table\n          class=\"reserve-course-child-table\"\n          slot=\"expandedRowRender\"\n          slot-scope=\"record, index\"\n          :columns=\"childColumns\"\n          :dataSource=\"record.list\"\n          :pagination=\"false\"\n          rowKey=\"id\"\n        >\n          <span slot=\"member\" slot-scope=\"record\">{{ record.name }}</span>\n          <template slot=\"reserve_status\" slot-scope=\"record\">\n            {{ record.name }}\n          </template>\n          <template slot=\"is_checkin\" slot-scope=\"record\">\n            {{ record.name }}\n          </template>\n          <template slot=\"checkin_method\" slot-scope=\"record\">\n            {{ record.name }}\n          </template>\n          <div slot=\"action\" slot-scope=\"text, record\">\n            <st-table-actions>\n              <a\n                v-if=\"record.auth['shop:reserve:course_reserve|del']\"\n                @click=\"cancelBooking(record, index)\"\n              >\n                取消预约\n              </a>\n              <a\n                v-if=\"record.auth['shop:reserve:course_reserve|checkin']\"\n                @click=\"booking(record, index)\"\n              >\n                签到\n              </a>\n              <a\n                @click=\"onPrint(record.id)\"\n                v-if=\"\n                  record.reserve_status.id === 1 && record.is_checkin.id === 1\n                \"\n              >\n                打印小票\n              </a>\n            </st-table-actions>\n          </div>\n        </st-table>\n      </st-table>\n    </div>\n  </div>\n</template>\n\n<script>\nimport tableMixin from '@/mixins/table.mixin'\nimport { mainColumns, childColumns } from './course.config'\nimport { CourseService } from './course.service'\nimport RecentRadioGroup from '@/views/components/recent-radio-group/recent-radio-group'\nimport moment from 'moment'\n\nexport default {\n  name: '',\n\n  bem: {\n    b: 'shop-reception-reserve-course'\n  },\n\n  components: { RecentRadioGroup },\n\n  modals: {},\n\n  serviceInject() {\n    return {\n      courseService: CourseService\n    }\n  },\n\n  rxState() {\n    const { courseService } = this\n    return {\n      list: courseService.list$,\n      page: courseService.page$,\n      loading: courseService.loading$,\n      auth: courseService.auth$,\n      courseTypeOptions: courseService.courseTypeOptions$,\n      reserveStatusOptions: courseService.reserveStatusOptions$,\n      checkinOptions: courseService.checkinOptions$\n    }\n  },\n\n  mixins: [tableMixin],\n\n  props: {},\n\n  data() {\n    return {\n      reserveQuery: {\n        end_time: '',\n        search_date: 1,\n        start_time: ''\n      },\n      customRadioDays: [\n        {\n          value: 1,\n          label: '今日'\n        },\n        {\n          value: 2,\n          label: '昨日'\n        },\n        {\n          value: 3,\n          label: '明日'\n        }\n      ]\n    }\n  },\n\n  computed: {\n    mainColumns,\n    childColumns\n  },\n\n  mounted() {},\n\n  methods: {\n    moment,\n    recentChange(data) {\n      const start_time = data.start_date ? `${data.start_date} 00:00` : ''\n      const end_time = data.end_date ? `${data.end_date} 23:59` : ''\n      let recently_day = data.recently_day\n      this.$searchQuery.search_date = recently_day || undefined\n      this.$searchQuery.start_time = start_time || undefined\n      this.$searchQuery.end_time = end_time || undefined\n      if (this.$searchQuery.start_time || this.$searchQuery.end_time) {\n        this.$searchQuery.search_date = undefined\n        recently_day = undefined\n      }\n      this.reserveQuery = {\n        start_time: start_time,\n        end_time: end_time,\n        search_date: recently_day\n      }\n      this.onMultiSearch(this.reserveQuery)\n    },\n    getCourseForm(record, index) {\n      const { id, member } = record\n      let reserve_type = this.list[index].sub_reserve_type\n      return {\n        id: member.id,\n        reserve_type: reserve_type.id,\n        reserve_id: id\n      }\n    },\n    // 取消签到\n    cancelBooking(record, index) {\n      let params = this.getCourseForm(record, index)\n      this.courseService.cancelVisitReserve(params).subscribe(res => {\n        this.$router.reload()\n      })\n    },\n    // 签到\n    booking(record, index) {\n      let params = this.getCourseForm(record, index)\n      this.courseService.confirmVisitReserve(params).subscribe(res => {\n        this.$router.reload()\n      })\n    },\n    onPrint(id) {\n      window.open('/ticket/print?id=' + id, '_blank', 'width=800,height=600')\n    },\n    onSearch() {\n      this.$router.push({ query: this.$searchQuery })\n    },\n    disabledDate(current) {\n      return current && current > moment().add(6, 'months')\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped></style>\n"]}]}