{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/add-card-member/add-card-member.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-components/add-card-member/add-card-member.vue","mtime":1600926382163},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { cloneDeep } from 'lodash-es';\nimport { AddCardMemberService } from \"./add-card-member.service\";\nimport { MessageService } from '@/services/message.service';\nimport { PatternService } from '@/services/pattern.service';\nexport default {\n  name: 'AddCardMember',\n  bem: {\n    b: 'page-add-card-member'\n  },\n  serviceProviders: function serviceProviders() {\n    return [AddCardMemberService];\n  },\n  serviceInject: function serviceInject() {\n    return {\n      addCardMemberService: AddCardMemberService,\n      messageService: MessageService,\n      patternService: PatternService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      memberList: this.addCardMemberService.memberList$\n    };\n  },\n  model: {\n    prop: 'list',\n    event: 'change'\n  },\n  props: {\n    type: {\n      type: Number,\n      default: 1\n    },\n    max: {\n      type: Number,\n      default: 10\n    },\n    list: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    }\n  },\n  data: function data() {\n    return {\n      visible: false,\n      memberSearchText: '',\n      searchMemberIsShow: true,\n      memberId: '',\n      searchFlag: false,\n      searchWidth: ''\n    };\n  },\n  mounted: function mounted() {\n    this.$nextTick(function () {\n      this.searchWidth = this.$refs.addMemberCardButton.$el.offsetWidth - 32 + 'px';\n    });\n  },\n  methods: {\n    selectItemLabel: function selectItemLabel(item) {\n      if (item.is_minors === 1) {\n        return \"\".concat(item.member_name, \"(\\u672A\\u6210\\u5E74) \").concat(item.parent_mobile, \"(\").concat(item.parent_user_role, \")\");\n      }\n\n      return \"\".concat(item.member_name, \" \").concat(item.mobile);\n    },\n    onConfirmItem: function onConfirmItem(data, index) {\n      if (!data.name) {\n        this.messageService.error({\n          content: '请填写正确成员姓名'\n        });\n        return;\n      }\n\n      if (!data.mobile || !this.patternService.MOBILE.test(data.mobile)) {\n        this.messageService.error({\n          content: '请填写正确手机号'\n        });\n        return;\n      }\n\n      var isExist = this.list.filter(function (item) {\n        return item.mobile === data.mobile && !item.isEdit;\n      });\n\n      if (isExist && isExist.length > 0) {\n        this.messageService.error({\n          content: '该手机号已经存在'\n        });\n        return;\n      }\n\n      data.isEdit = false;\n      this.$emit('change', this.list);\n    },\n    onCancelItem: function onCancelItem(item, index) {\n      this.list.shift();\n      this.$emit('change', this.list);\n    },\n    onDeleteItem: function onDeleteItem(item, index) {\n      this.list.splice(index, 1);\n      this.$emit('change', this.list);\n    },\n    onAddMember: function onAddMember() {\n      var isExistEdit = this.list.filter(function (item) {\n        return item.isEdit;\n      });\n\n      if (isExistEdit && isExistEdit.length > 0) {\n        this.messageService.error({\n          content: '还有没有添加完成的成员'\n        });\n        return;\n      }\n\n      this.visible = false;\n      this.list.unshift({\n        name: '',\n        mobile: '',\n        isEdit: true\n      });\n    },\n    onMemberSearch: function onMemberSearch(data) {\n      this.memberSearchText = data.target.value;\n\n      if (data) {\n        this.addCardMemberService.memberListAction$.dispatch(data.target.value, this.type);\n      }\n    },\n    onMemberChange: function onMemberChange(data) {\n      if (this.list.length >= this.max) return;\n      var isExist = this.list.filter(function (item) {\n        return item.mobile === data.mobile && !item.isEdit;\n      });\n\n      if (isExist && isExist.length > 0) {\n        this.messageService.error({\n          content: '该手机号已经存在'\n        });\n        return;\n      }\n\n      var isExistEdit = this.list.filter(function (item) {\n        return item.isEdit;\n      });\n      var insertIndex = 0;\n\n      if (isExistEdit && isExistEdit.length > 0) {\n        insertIndex = 1;\n      }\n\n      this.list.splice(insertIndex, 0, {\n        id: data.id,\n        name: data.member_name,\n        mobile: data.mobile,\n        is_minors: data.is_minors,\n        parent_mobile: data.parent_mobile,\n        parent_name: data.parent_name,\n        parent_user_role: data.parent_user_role\n      });\n      this.visible = false;\n      this.resetSearchCondition();\n      this.$emit('change', this.list);\n    },\n    resetSearchCondition: function resetSearchCondition() {\n      this.memberSearchText = '';\n      this.memberList = [];\n    }\n  }\n};",{"version":3,"sources":["add-card-member.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-container>\n    <st-form-table :class=\"b()\">\n      <colgroup>\n        <col style=\"width:40%;\" />\n        <col style=\"width:40%;\" />\n        <col style=\"width:20%;\" />\n      </colgroup>\n      <thead>\n        <tr>\n          <th>成员姓名</th>\n          <th>手机号</th>\n          <th>操作</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td colspan=\"3\" :class=\"b('search-wrapper')\">\n            <a-popover\n              trigger=\"click\"\n              v-model=\"visible\"\n              placement=\"bottom\"\n              :arrowPointAtCenter=\"true\"\n              overlayClassName=\"change-member-popover\"\n            >\n              <div\n                slot=\"content\"\n                :class=\"b('search-section')\"\n                id=\"search-section\"\n                ref=\"searchSection\"\n              >\n                <a-input-search\n                  placeholder=\"请输入手机号码或者会员姓名\"\n                  v-model=\"memberSearchText\"\n                  @change=\"onMemberSearch\"\n                  :style=\"{\n                    width: searchWidth\n                  }\"\n                  class=\"test-input\"\n                />\n                <ul :class=\"b('search-list')\">\n                  <li\n                    :class=\"b('search-text')\"\n                    v-for=\"(item, index) in memberList\"\n                    :value=\"item.id\"\n                    :key=\"index\"\n                    @click.stop=\"onMemberChange(item)\"\n                  >\n                    <span\n                      v-html=\"\n                        `${selectItemLabel(item)}`.replace(\n                          new RegExp(memberSearchText, 'g'),\n                          `\\<span class='global-highlight-color'\\>${memberSearchText}\\<\\/span\\>`\n                        )\n                      \"\n                    >\n                      {{ selectItemLabel(item) }}\n                    </span>\n                  </li>\n                  <li\n                    :class=\"[b('search-text'), b('search-tip')]\"\n                    v-if=\"\n                      memberList.length === 0 && memberSearchText && type !== 2\n                    \"\n                  >\n                    查无此会员，\n                    <a @click=\"onAddMember\">添加新会员？</a>\n                  </li>\n                </ul>\n              </div>\n              <st-button\n                :disabled=\"list.length >= max\"\n                type=\"dashed\"\n                icon=\"add\"\n                block\n                ref=\"addMemberCardButton\"\n              >\n                添加卡成员\n              </st-button>\n            </a-popover>\n          </td>\n        </tr>\n        <tr v-for=\"(item, index) in list\" :key=\"index\">\n          <td>\n            <template v-if=\"item.isEdit\">\n              <a-input placeholder=\"输入姓名\" v-model=\"item.name\"></a-input>\n            </template>\n            <template v-else>\n              {{ item.name }}\n            </template>\n          </td>\n          <td>\n            <template v-if=\"item.isEdit\">\n              <a-input placeholder=\"输入手机号\" v-model=\"item.mobile\"></a-input>\n            </template>\n            <template v-else-if=\"item.is_minors\">\n              {{ item.parent_mobile }}({{ item.parent_user_role }})\n            </template>\n            <template v-else>\n              {{ item.mobile }}\n            </template>\n          </td>\n          <td>\n            <a\n              v-if=\"item.isEdit\"\n              class=\"mg-r8\"\n              @click=\"onConfirmItem(item, index)\"\n            >\n              确认\n            </a>\n            <a v-if=\"item.isEdit\" @click=\"onCancelItem(item, index)\">取消</a>\n            <a v-if=\"!item.isEdit\" @click=\"onDeleteItem(item, index)\">删除</a>\n          </td>\n        </tr>\n        <tr v-if=\"list.length <= 0\">\n          <td colspan=\"3\">\n            <st-no-data />\n          </td>\n        </tr>\n      </tbody>\n    </st-form-table>\n  </st-container>\n</template>\n<script>\nimport { cloneDeep } from 'lodash-es'\nimport { AddCardMemberService } from './add-card-member.service'\nimport { MessageService } from '@/services/message.service'\nimport { PatternService } from '@/services/pattern.service'\nexport default {\n  name: 'AddCardMember',\n  bem: {\n    b: 'page-add-card-member'\n  },\n  serviceProviders() {\n    return [AddCardMemberService]\n  },\n  serviceInject() {\n    return {\n      addCardMemberService: AddCardMemberService,\n      messageService: MessageService,\n      patternService: PatternService\n    }\n  },\n  rxState() {\n    return {\n      memberList: this.addCardMemberService.memberList$\n    }\n  },\n  model: {\n    prop: 'list',\n    event: 'change'\n  },\n  props: {\n    type: {\n      type: Number,\n      default: 1\n    },\n    max: {\n      type: Number,\n      default: 10\n    },\n    list: {\n      type: Array,\n      default: () => []\n    }\n  },\n  data() {\n    return {\n      visible: false,\n      memberSearchText: '',\n      searchMemberIsShow: true,\n      memberId: '',\n      searchFlag: false,\n      searchWidth: ''\n    }\n  },\n  mounted() {\n    this.$nextTick(function() {\n      this.searchWidth =\n        this.$refs.addMemberCardButton.$el.offsetWidth - 32 + 'px'\n    })\n  },\n  methods: {\n    selectItemLabel(item) {\n      if (item.is_minors === 1) {\n        return `${item.member_name}(未成年) ${item.parent_mobile}(${\n          item.parent_user_role\n        })`\n      }\n      return `${item.member_name} ${item.mobile}`\n    },\n    onConfirmItem(data, index) {\n      if (!data.name) {\n        this.messageService.error({\n          content: '请填写正确成员姓名'\n        })\n        return\n      }\n      if (!data.mobile || !this.patternService.MOBILE.test(data.mobile)) {\n        this.messageService.error({\n          content: '请填写正确手机号'\n        })\n        return\n      }\n\n      const isExist = this.list.filter(\n        item => item.mobile === data.mobile && !item.isEdit\n      )\n      if (isExist && isExist.length > 0) {\n        this.messageService.error({\n          content: '该手机号已经存在'\n        })\n        return\n      }\n      data.isEdit = false\n      this.$emit('change', this.list)\n    },\n    onCancelItem(item, index) {\n      this.list.shift()\n      this.$emit('change', this.list)\n    },\n    onDeleteItem(item, index) {\n      this.list.splice(index, 1)\n      this.$emit('change', this.list)\n    },\n    onAddMember() {\n      const isExistEdit = this.list.filter(item => item.isEdit)\n      if (isExistEdit && isExistEdit.length > 0) {\n        this.messageService.error({\n          content: '还有没有添加完成的成员'\n        })\n        return\n      }\n      this.visible = false\n      this.list.unshift({\n        name: '',\n        mobile: '',\n        isEdit: true\n      })\n    },\n    onMemberSearch(data) {\n      this.memberSearchText = data.target.value\n      if (data) {\n        this.addCardMemberService.memberListAction$.dispatch(\n          data.target.value,\n          this.type\n        )\n      }\n    },\n    onMemberChange(data) {\n      if (this.list.length >= this.max) return\n      const isExist = this.list.filter(\n        item => item.mobile === data.mobile && !item.isEdit\n      )\n      if (isExist && isExist.length > 0) {\n        this.messageService.error({\n          content: '该手机号已经存在'\n        })\n        return\n      }\n      const isExistEdit = this.list.filter(item => item.isEdit)\n      let insertIndex = 0\n      if (isExistEdit && isExistEdit.length > 0) {\n        insertIndex = 1\n      }\n      this.list.splice(insertIndex, 0, {\n        id: data.id,\n        name: data.member_name,\n        mobile: data.mobile,\n        is_minors: data.is_minors,\n        parent_mobile: data.parent_mobile,\n        parent_name: data.parent_name,\n        parent_user_role: data.parent_user_role\n      })\n      this.visible = false\n      this.resetSearchCondition()\n      this.$emit('change', this.list)\n    },\n    resetSearchCondition() {\n      this.memberSearchText = ''\n      this.memberList = []\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-components/add-card-member"}]}