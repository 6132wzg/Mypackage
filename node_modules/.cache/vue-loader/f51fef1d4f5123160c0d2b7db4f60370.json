{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/app/plugin/components#/discount-add.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/app/plugin/components#/discount-add.vue","mtime":1599214879317},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport ProductSetting from './product-setting.vue'\nimport { merge } from 'lodash'\nimport moment from 'moment'\n\nexport default {\n  name: 'BrandAppPluginDiscountAdd',\n  bem: {\n    b: 'brand-app-plugin-discount-add'\n  },\n  components: {\n    ProductSetting\n  },\n  model: {\n    props: 'value',\n    event: 'change'\n  },\n  props: {\n    value: {\n      type: Object,\n      default: () => {}\n    },\n    form: {\n      type: Object,\n      default: () => {}\n    },\n    decorators: {\n      type: Object,\n      default: () => {}\n    },\n    isEdit: {\n      type: Boolean,\n      defalut: false\n    }\n  },\n  data() {\n    return {}\n  },\n  computed: {\n    info: {\n      get() {\n        return this.value\n      },\n      set(newVal) {\n        console.log('discount-add-info-change', { ...newVal })\n        this.$emit('change', { ...newVal })\n      }\n    },\n    startTime: {\n      get() {\n        return this.info.start_time ? moment(this.info.start_time) : undefined\n      },\n      set(value) {\n        this.info.start_time = value.format('YYYY-MM-DD HH') + ':00'\n      }\n    },\n    endTime: {\n      get() {\n        return this.info.end_time ? moment(this.info.end_time) : undefined\n      },\n      set(value) {\n        this.info.end_time = value.format('YYYY-MM-DD HH') + ':00'\n      }\n    },\n    dataRange: {\n      get() {\n        const start = this.info.start_time ? moment(this.info.start_time) : undefined\n        const end = this.info.end_time ? moment(this.info.end_time) : undefined\n        return [\n          start,\n          end\n        ]\n      },\n      set(value) {\n        console.log(value)\n        this.info.start_time = value[0] ? value[0].format('YYYY-MM-DD HH') + ':00' : undefined\n        this.info.end_time = value[1] ? value[1].format('YYYY-MM-DD HH') + ':00' : undefined\n      }\n    }\n  },\n  mounted() {\n    console.log(this)\n    this.$nextTick(() => {\n      setTimeout(() => {\n        // console.log('discount-add-set-info', { ...this.info })\n        // this.setFieldsValue('info.type', 3)\n      }, 5000)\n    })\n  },\n  methods: {\n    moment,\n    valueChange(key, val) {\n      console.log('discount-add-info-value-change', key, val)\n      // this.info[key] = e\n      this.setValue(key, val)\n      this.$emit('change', this.info)\n    },\n    setFieldsValue(key, value) {\n      this.setValue(key, value)\n      this.$nextTick(() => {\n        this.form.setFieldsValue({ [key]: value })\n      })\n    },\n    setValue(key, value) {\n      if (typeof key === 'string') {\n        const keyArr = key.split('.')\n        const len = keyArr.length - 1\n        keyArr.reduce((cur, key, index) => {\n          if (!cur[key] && index < len) {\n            throw `${key}不存在`\n          }\n          if (index === len) {\n            cur[key] = value\n          }\n          return cur[key]\n        }, this)\n      } else {\n        merge(this, key)\n      }\n    },\n    range(start, end) {\n      const result = [];\n      for (let i = start; i < end; i++) {\n        result.push(i);\n      }\n      return result;\n    },\n    disabledDate(current) {\n      return current && current.format('YYYY-MM-DD') < moment().format('YYYY-MM-DD')\n    },\n    disabledStartTime() {\n      let hour = 0\n      if(moment().format('YYYY-MM-DD') === moment(this.info.start_time).format('YYYY-MM-DD')) {\n        hour = moment().hours()+1\n      }\n      return {\n        disabledHours: () => this.range(0, hour),\n        disabledMinutes: () => this.range(1, 60),\n        disabledSeconds: () => this.range(1, 60),\n      };\n    },\n    disabledEndTime() {\n      let hour = 0\n      if(moment(this.info.end_time).format('YYYY-MM-DD') === moment(this.info.start_time).format('YYYY-MM-DD')) {\n        hour = moment(this.info.start_time).hours()+1\n      }\n      return {\n        disabledHours: () => this.range(0, hour),\n        disabledMinutes: () => this.range(1, 60),\n        disabledSeconds: () => this.range(1, 60),\n      };\n    },\n    disabledVirDate(current) {\n      return current.format('YYYY-MM-DD') < moment(this.info.start_time).format('YYYY-MM-DD') || current.format('YYYY-MM-DD') > moment(this.info.end_time).format('YYYY-MM-DD')\n    },\n    // 保存\n    onSubmit(e) {\n      e.preventDefault()\n      this.form.validateFieldsAndScroll((err, values) => {\n        if (!err) {\n          this.$emit('submit', values)\n          // TODO:\n        }\n      })\n    }\n  }\n}\n",{"version":3,"sources":["discount-add.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+EA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"discount-add.vue","sourceRoot":"src/views/pages/brand/app/plugin/components#","sourcesContent":["<template>\n  <div>\n    <st-form-item required label=\"活动名称\">\n      <st-input\n        v-decorator=\"decorators.info.product_name\"\n        placeholder=\"请输入活动名称\"\n        style=\"width: 470px\"\n        @change=\"valueChange('info.product_name', $event)\"\n        :maxLength=\"30\"\n      ></st-input>\n    </st-form-item>\n    <!--  -->\n    <product-setting\n      v-model=\"info\"\n      :decorators=\"decorators\"\n      :form=\"form\"\n      :isEdit=\"isEdit\"\n    ></product-setting>\n    <st-form-item required label=\"活动时间\">\n      <st-range-picker\n        v-model=\"dataRange\"\n        :options=\"{\n          start: {\n            showTime: {\n              format: 'HH:mm'\n            },\n            format: 'YYYY-MM-DD HH:mm',\n            disabledBegin: moment().format('YYYY-MM-DD'),\n            disabledDateTime: disabledStartTime\n          },\n          end: {\n            showTime: {\n              format: 'HH:mm'\n            },\n            format: 'YYYY-MM-DD HH:mm',\n            disabledDateTime: disabledEndTime\n          }\n        }\"\n      />\n    </st-form-item>\n    <st-form-item required label=\"活动库存\">\n      <a-checkbox v-model=\"info.is_limit_stock\">限制库存</a-checkbox>\n      <st-input-number\n        style=\"width: 150px\"\n        placeholder=\"\"\n        v-model=\"info.stock_num\"\n        :min=\"1\"\n        :max=\"99999\"\n        :disabled=\"!info.is_limit_stock\"\n      ></st-input-number>\n    </st-form-item>\n    <st-form-item label=\"单人购买限制\">\n      <a-checkbox v-model=\"info.is_limit_buy\">限制购买</a-checkbox>\n      <st-input-number\n        style=\"width: 150px\"\n        placeholder=\"\"\n        v-model=\"info.buy_num\"\n        :min=\"1\"\n        :max=\"999\"\n        :disabled=\"!info.is_limit_buy\"\n      >\n        <span slot=\"addonAfter\">笔订单</span>\n      </st-input-number>\n    </st-form-item>\n    <st-form-item label=\"备注\">\n      <st-textarea\n        style=\"width: 470px\"\n        placeholder=\"备注内容仅商家可见\"\n        v-model=\"info.description\"\n        :rows=\"2\"\n        :maxlength=\"200\"\n      ></st-textarea>\n    </st-form-item>\n    <st-form-item labelFix>\n      <st-button type=\"primary\" @click=\"onSubmit\">保存</st-button>\n    </st-form-item>\n  </div>\n</template>\n<script>\nimport ProductSetting from './product-setting.vue'\nimport { merge } from 'lodash'\nimport moment from 'moment'\n\nexport default {\n  name: 'BrandAppPluginDiscountAdd',\n  bem: {\n    b: 'brand-app-plugin-discount-add'\n  },\n  components: {\n    ProductSetting\n  },\n  model: {\n    props: 'value',\n    event: 'change'\n  },\n  props: {\n    value: {\n      type: Object,\n      default: () => {}\n    },\n    form: {\n      type: Object,\n      default: () => {}\n    },\n    decorators: {\n      type: Object,\n      default: () => {}\n    },\n    isEdit: {\n      type: Boolean,\n      defalut: false\n    }\n  },\n  data() {\n    return {}\n  },\n  computed: {\n    info: {\n      get() {\n        return this.value\n      },\n      set(newVal) {\n        console.log('discount-add-info-change', { ...newVal })\n        this.$emit('change', { ...newVal })\n      }\n    },\n    startTime: {\n      get() {\n        return this.info.start_time ? moment(this.info.start_time) : undefined\n      },\n      set(value) {\n        this.info.start_time = value.format('YYYY-MM-DD HH') + ':00'\n      }\n    },\n    endTime: {\n      get() {\n        return this.info.end_time ? moment(this.info.end_time) : undefined\n      },\n      set(value) {\n        this.info.end_time = value.format('YYYY-MM-DD HH') + ':00'\n      }\n    },\n    dataRange: {\n      get() {\n        const start = this.info.start_time ? moment(this.info.start_time) : undefined\n        const end = this.info.end_time ? moment(this.info.end_time) : undefined\n        return [\n          start,\n          end\n        ]\n      },\n      set(value) {\n        console.log(value)\n        this.info.start_time = value[0] ? value[0].format('YYYY-MM-DD HH') + ':00' : undefined\n        this.info.end_time = value[1] ? value[1].format('YYYY-MM-DD HH') + ':00' : undefined\n      }\n    }\n  },\n  mounted() {\n    console.log(this)\n    this.$nextTick(() => {\n      setTimeout(() => {\n        // console.log('discount-add-set-info', { ...this.info })\n        // this.setFieldsValue('info.type', 3)\n      }, 5000)\n    })\n  },\n  methods: {\n    moment,\n    valueChange(key, val) {\n      console.log('discount-add-info-value-change', key, val)\n      // this.info[key] = e\n      this.setValue(key, val)\n      this.$emit('change', this.info)\n    },\n    setFieldsValue(key, value) {\n      this.setValue(key, value)\n      this.$nextTick(() => {\n        this.form.setFieldsValue({ [key]: value })\n      })\n    },\n    setValue(key, value) {\n      if (typeof key === 'string') {\n        const keyArr = key.split('.')\n        const len = keyArr.length - 1\n        keyArr.reduce((cur, key, index) => {\n          if (!cur[key] && index < len) {\n            throw `${key}不存在`\n          }\n          if (index === len) {\n            cur[key] = value\n          }\n          return cur[key]\n        }, this)\n      } else {\n        merge(this, key)\n      }\n    },\n    range(start, end) {\n      const result = [];\n      for (let i = start; i < end; i++) {\n        result.push(i);\n      }\n      return result;\n    },\n    disabledDate(current) {\n      return current && current.format('YYYY-MM-DD') < moment().format('YYYY-MM-DD')\n    },\n    disabledStartTime() {\n      let hour = 0\n      if(moment().format('YYYY-MM-DD') === moment(this.info.start_time).format('YYYY-MM-DD')) {\n        hour = moment().hours()+1\n      }\n      return {\n        disabledHours: () => this.range(0, hour),\n        disabledMinutes: () => this.range(1, 60),\n        disabledSeconds: () => this.range(1, 60),\n      };\n    },\n    disabledEndTime() {\n      let hour = 0\n      if(moment(this.info.end_time).format('YYYY-MM-DD') === moment(this.info.start_time).format('YYYY-MM-DD')) {\n        hour = moment(this.info.start_time).hours()+1\n      }\n      return {\n        disabledHours: () => this.range(0, hour),\n        disabledMinutes: () => this.range(1, 60),\n        disabledSeconds: () => this.range(1, 60),\n      };\n    },\n    disabledVirDate(current) {\n      return current.format('YYYY-MM-DD') < moment(this.info.start_time).format('YYYY-MM-DD') || current.format('YYYY-MM-DD') > moment(this.info.end_time).format('YYYY-MM-DD')\n    },\n    // 保存\n    onSubmit(e) {\n      e.preventDefault()\n      this.form.validateFieldsAndScroll((err, values) => {\n        if (!err) {\n          this.$emit('submit', values)\n          // TODO:\n        }\n      })\n    }\n  }\n}\n</script>\n"]}]}