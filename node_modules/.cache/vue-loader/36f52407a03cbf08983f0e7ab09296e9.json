{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/store/class-manage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/store/class-manage.vue","mtime":1597396799946},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { ClassManageService } from './class-manage.service'\nimport { cloneDeep } from 'lodash-es'\nexport default {\n  serviceInject() {\n    return { classManageService: ClassManageService }\n  },\n  rxState() {\n    return {\n      loading: this.classManageService.loading$\n    }\n  },\n  data() {\n    return {\n      show: false,\n      tableData: [],\n      oldTableData: [],\n      loadingStatus: 1 // 1: 获取列表，2：新增分类，3删除分类，4编辑分类\n    }\n  },\n  mounted() {\n    this.getList()\n  },\n  methods: {\n    getList() {\n      this.loadingStatus = 1\n      this.classManageService.getList().subscribe(res => {\n        res.list.map(item => (item.isEdit = false))\n        this.tableData = res.list\n        this.oldTableData = cloneDeep(res.list)\n      })\n    },\n    onSubmit() {\n      this.show = false\n      this.$emit('success', this.tableData)\n    },\n    addClass() {\n      this.tableData.unshift({ category_name: '', isEdit: true, isNew: true })\n      this.oldTableData.unshift({\n        category_name: '',\n        isEdit: true,\n        isNew: true\n      })\n    },\n    saveHandle(item, index) {\n      // 新建分类\n      if (item.isNew) {\n        this.loadingStatus = 2\n        this.classManageService\n          .addClass({ category_name: item.category_name })\n          .subscribe(res => {\n            item.category_id = res.category_id\n            item.isEdit = false\n            this.oldTableData[index] = item\n          })\n      } else {\n        this.loadingStatus = 4\n        //  编辑分类\n        this.classManageService\n          .editClass(item.category_id, { category_name: item.category_name })\n          .subscribe(res => {\n            item.isEdit = false\n            this.oldTableData[index] = item\n          })\n      }\n    },\n    editHandle(item) {\n      item.isEdit = true\n    },\n    cancelHandle(item, index) {\n      if (!item.category_name || !item.category_id) {\n        this.tableData.splice(index, 1)\n        this.oldTableData.splice(index, 1)\n      } else {\n        item.category_name = this.oldTableData[index].category_name\n        item.isEdit = false\n      }\n    },\n    delHandle(item, index) {\n      this.loadingStatus = 3\n      this.classManageService.delClass(item.category_id).subscribe(res => {\n        this.getList()\n      })\n    }\n  }\n}\n",null]}