{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/deal/sale-cabinet.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/deal/sale-cabinet.vue","mtime":1600926555971},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { SaleCabinetService } from \"./sale-cabinet.service\";\nimport { cloneDeep, get } from 'lodash-es';\nimport { timer } from 'rxjs';\nimport { PatternService } from '@/services/pattern.service';\nimport { ruleOptions } from \"./sale-cabinet.config\";\nimport EditableContractNumber from '@/views/biz-components/contract/editable-contract-number.vue';\nimport MemberSearch from '@/views/biz-components/member/member-search/member-search';\nexport default {\n  name: 'ModalSoldDealSaleCabinet',\n  bem: {\n    sale: 'modal-sold-deal-sale'\n  },\n  components: {\n    EditableContractNumber: EditableContractNumber,\n    MemberSearch: MemberSearch\n  },\n  serviceProviders: function serviceProviders() {\n    return [SaleCabinetService];\n  },\n  serviceInject: function serviceInject() {\n    return {\n      saleCabinetService: SaleCabinetService,\n      pattern: PatternService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.saleCabinetService.loading$,\n      saleList: this.saleCabinetService.saleList$,\n      cabinetList: this.saleCabinetService.cabinetList$,\n      info: this.saleCabinetService.info$,\n      currentPrice: this.saleCabinetService.currentPrice$,\n      orderAmountPrice: this.saleCabinetService.orderAmountPrice$\n    };\n  },\n  props: {\n    id: {\n      type: String\n    },\n    areaId: {\n      type: [String, Number],\n      default: 0\n    },\n    memberInfo: {\n      type: Object\n    }\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      show: false,\n      // 租赁柜\n      cabinetFieldNames: {\n        label: 'name',\n        value: 'id',\n        children: 'cabinets'\n      },\n      cabinetId: '',\n      // 租赁天数\n      disabledCalendar: true,\n      startTime: moment(),\n      days: '',\n      // 定金\n      advanceDropdownVisible: false,\n      advanceList: [],\n      advanceText: '未选择定金',\n      advanceAmount: '',\n      selectAdvance: '',\n      reduceAmount: null,\n      description: '',\n      isFollowSalesman: 0\n    };\n  },\n  computed: {\n    // 租赁费用\n    leaseFee: function leaseFee() {\n      if (!this.cabinetId || !this.days > 0) {\n        return '无';\n      } else {\n        return \"\".concat(this.info.price_num * this.days, \"\\u5143\");\n      }\n    },\n    // 小计\n    orderAmount: function orderAmount() {\n      if (!this.cabinetId || !this.days > 0) {\n        return '无';\n      } else {\n        return \"\".concat(this.info.price_num * this.days - +this.reduceAmount - +this.advanceAmount, \"\\u5143\");\n      }\n    },\n    orderAmountText: function orderAmountText() {\n      return this.orderAmount.split('元')[0] < 0 ? '小计不能为负' : '';\n    },\n    saleRangeType: function saleRangeType() {\n      return get(this.info.sale_range, 'type', 1);\n    },\n    hasProductInfo: function hasProductInfo() {\n      return JSON.stringify(this.info) !== '{}';\n    }\n  },\n  watch: {\n    days: function days(newVal, oldVal) {\n      this.getOrderPrice();\n      this.getPrice(this.selectAdvance, +this.reduceAmount);\n    },\n    selectAdvance: {\n      deep: true,\n      handler: function handler(newVal, oldVal) {\n        this.getPrice(newVal, +this.reduceAmount);\n      }\n    },\n    reduceAmount: function reduceAmount(newVal, oldVal) {\n      this.getPrice(this.selectAdvance, +newVal);\n    }\n  },\n  created: function created() {\n    var _this = this;\n\n    this.saleCabinetService.orderAmountPrice$.commit(function () {\n      return 0;\n    });\n    this.saleCabinetService.currentPrice$.commit(function () {\n      return 0;\n    });\n    this.saleCabinetService.init().subscribe(function (res) {\n      if (_this.id) {\n        _this.saleCabinetService.getInfo(_this.id).subscribe(function (res) {\n          setTimeout(function () {\n            _this.startTime = cloneDeep(moment(res.info.start_time));\n          });\n        });\n      }\n\n      _this.saleCabinetService.getCabinetList(_this.areaId).subscribe();\n    });\n  },\n  methods: {\n    onMemberChange: function onMemberChange(data) {\n      var _this2 = this;\n\n      this.resetAdvance();\n\n      if (data) {\n        this.saleCabinetService.getAdvanceList(data).subscribe(function (res) {\n          _this2.advanceList = cloneDeep(res.list);\n        });\n      }\n    },\n    // 重置定金选择\n    resetAdvance: function resetAdvance() {\n      this.advanceList = [];\n      this.advanceText = '未选择定金';\n      this.advanceAmount = '';\n      this.selectAdvance = '';\n    },\n    onCabinetChange: function onCabinetChange(data) {\n      this.cabinetId = data[1];\n      this.saleCabinetService.getInfo(data[1]).subscribe();\n    },\n    // 租赁时间\n    disabledEndDate: function disabledEndDate(endValue) {\n      return endValue.valueOf() < this.startTime.valueOf() || endValue.valueOf() > moment().add(999, 'd').valueOf();\n    },\n    // 租赁时间-end\n    endTimeChange: function endTimeChange(data) {\n      this.form.setFieldsValue({\n        endTimeInput: Math.ceil(data.diff(this.startTime, 'minutes') / (24 * 60))\n      });\n      this.days = Math.ceil(data.diff(this.startTime, 'minutes') / (24 * 60));\n    },\n    onEndTimeInputChange: function onEndTimeInputChange(data) {\n      this.days = data;\n      var start = cloneDeep(this.startTime);\n\n      if (data > 0) {\n        // 有效天数\n        this.form.setFieldsValue({\n          endTimePicker: start.add(data, 'd')\n        });\n      } else {\n        // 无效天数\n        this.form.resetFields(['endTimePicker']);\n      }\n    },\n    onSelectAdvance: function onSelectAdvance() {\n      var _this3 = this;\n\n      timer(200).subscribe(function () {\n        _this3.advanceDropdownVisible = false;\n      });\n    },\n    onCancel: function onCancel() {\n      this.resetAdvance();\n    },\n    onSelectAdvanceChange: function onSelectAdvanceChange(data) {\n      if (!data.target.value) {\n        this.advanceAmount = 0;\n        this.advanceText = \"\\u672A\\u9009\\u62E9\\u5B9A\\u91D1\";\n        return;\n      }\n\n      var price = this.advanceList.filter(function (o) {\n        return o.id === data.target.value;\n      })[0].price;\n      this.advanceAmount = price;\n      this.advanceText = \"\".concat(price, \"\\u5143\");\n    },\n    // 获取当前价钱\n    getPrice: function getPrice(advance, reduce) {\n      var memberId = this.form.getFieldValue('member_id');\n      this.saleCabinetService.currentPriceAction$.dispatch({\n        product_id: this.cabinetId,\n        product_type: this.info.contract_type,\n        product_num: this.days,\n        advance_id: advance || undefined,\n        member_id: memberId || undefined,\n        reduce_amount: reduce || undefined\n      });\n    },\n    // 获取订单总额\n    getOrderPrice: function getOrderPrice() {\n      this.saleCabinetService.orderAmountPriceAction$.dispatch({\n        product_id: this.cabinetId,\n        product_type: this.info.contract_type,\n        product_num: this.days\n      });\n    },\n    onCreateOrder: function onCreateOrder() {\n      var _this4 = this;\n\n      this.form.validate().then(function (values) {\n        var reduce_amount = _this4.reduceAmount ? +_this4.reduceAmount : 0;\n\n        _this4.saleCabinetService.setTransaction({\n          cabinet_id: +_this4.cabinetId,\n          start_time: \"\".concat(_this4.startTime.format('YYYY-MM-DD HH:mm')),\n          end_time: \"\".concat(values.endTimePicker.format('YYYY-MM-DD HH:mm')),\n          lease_days: +_this4.days,\n          contract_number: _this4.info.contract_number,\n          advance_id: _this4.selectAdvance === -1 ? undefined : _this4.selectAdvance,\n          reduce_amount: reduce_amount,\n          order_amount: _this4.currentPrice,\n          member_id: +values.member_id,\n          member_name: values.member_name,\n          mobile: values.mobile ? values.mobile.phone : undefined,\n          sale_id: +values.saleName,\n          description: _this4.description,\n          sale_range: +_this4.info.sale_range.type,\n          is_minors: values.is_minors,\n          parent_name: values.parent_name,\n          parent_mobile: values.parent_mobile ? values.parent_mobile.phone : undefined,\n          parent_country_prefix: values.parent_mobile ? values.parent_mobile.code_id : undefined,\n          parent_user_role: values.parent_user_role,\n          physical_id: values.physical_id,\n          card_num: values.card_num,\n          id_card: values.id_card,\n          id_card_type: values.id_card_type,\n          is_follow_salesman: _this4.isFollowSalesman\n        }).subscribe(function (res) {\n          _this4.show = false;\n\n          _this4.$emit('success', {\n            type: 'create',\n            orderId: res.info.order_id\n          });\n        });\n      });\n    },\n    onPay: function onPay() {\n      var _this5 = this;\n\n      this.form.validate().then(function (values) {\n        var reduce_amount = _this5.reduceAmount ? +_this5.reduceAmount : 0;\n\n        _this5.saleCabinetService.setTransactionPay({\n          cabinet_id: +_this5.cabinetId,\n          start_time: \"\".concat(_this5.startTime.format('YYYY-MM-DD HH:mm')),\n          end_time: \"\".concat(values.endTimePicker.format('YYYY-MM-DD HH:mm')),\n          lease_days: +_this5.days,\n          contract_number: _this5.info.contract_number,\n          advance_id: _this5.selectAdvance === -1 ? undefined : _this5.selectAdvance,\n          reduce_amount: reduce_amount,\n          order_amount: _this5.currentPrice,\n          member_id: +values.member_id,\n          member_name: values.member_name,\n          mobile: values.mobile ? values.mobile.phone : undefined,\n          sale_id: +values.saleName,\n          description: _this5.description,\n          sale_range: +_this5.info.sale_range.type,\n          is_minors: values.is_minors,\n          parent_name: values.parent_name,\n          parent_mobile: values.parent_mobile ? values.parent_mobile.phone : undefined,\n          parent_country_prefix: values.parent_mobile ? values.parent_mobile.code_id : undefined,\n          parent_user_role: values.parent_user_role,\n          physical_id: values.physical_id,\n          card_num: values.card_num,\n          id_card: values.id_card,\n          id_card_type: values.id_card_type,\n          is_follow_salesman: _this5.isFollowSalesman\n        }).subscribe(function (res) {\n          _this5.show = false;\n\n          _this5.$emit('success', {\n            type: 'createPay',\n            orderId: res.info.order_id\n          });\n        });\n      });\n    }\n  }\n};",{"version":3,"sources":["sale-cabinet.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+NA,SAAA,kBAAA;AACA,SAAA,SAAA,EAAA,GAAA,QAAA,WAAA;AACA,SAAA,KAAA,QAAA,MAAA;AACA,SAAA,cAAA,QAAA,4BAAA;AACA,SAAA,WAAA;AACA,OAAA,sBAAA,MAAA,8DAAA;AACA,OAAA,YAAA,MAAA,2DAAA;AACA,eAAA;AACA,EAAA,IAAA,EAAA,0BADA;AAEA,EAAA,GAAA,EAAA;AACA,IAAA,IAAA,EAAA;AADA,GAFA;AAKA,EAAA,UAAA,EAAA;AACA,IAAA,sBAAA,EAAA,sBADA;AAEA,IAAA,YAAA,EAAA;AAFA,GALA;AASA,EAAA,gBATA,8BASA;AACA,WAAA,CAAA,kBAAA,CAAA;AACA,GAXA;AAYA,EAAA,aAZA,2BAYA;AACA,WAAA;AACA,MAAA,kBAAA,EAAA,kBADA;AAEA,MAAA,OAAA,EAAA;AAFA,KAAA;AAIA,GAjBA;AAkBA,EAAA,OAlBA,qBAkBA;AACA,WAAA;AACA,MAAA,OAAA,EAAA,KAAA,kBAAA,CAAA,QADA;AAEA,MAAA,QAAA,EAAA,KAAA,kBAAA,CAAA,SAFA;AAGA,MAAA,WAAA,EAAA,KAAA,kBAAA,CAAA,YAHA;AAIA,MAAA,IAAA,EAAA,KAAA,kBAAA,CAAA,KAJA;AAKA,MAAA,YAAA,EAAA,KAAA,kBAAA,CAAA,aALA;AAMA,MAAA,gBAAA,EAAA,KAAA,kBAAA,CAAA;AANA,KAAA;AAQA,GA3BA;AA4BA,EAAA,KAAA,EAAA;AACA,IAAA,EAAA,EAAA;AACA,MAAA,IAAA,EAAA;AADA,KADA;AAIA,IAAA,MAAA,EAAA;AACA,MAAA,IAAA,EAAA,CAAA,MAAA,EAAA,MAAA,CADA;AAEA,MAAA,OAAA,EAAA;AAFA,KAJA;AAQA,IAAA,UAAA,EAAA;AACA,MAAA,IAAA,EAAA;AADA;AARA,GA5BA;AAwCA,EAAA,IAxCA,kBAwCA;AACA,QAAA,IAAA,GAAA,KAAA,OAAA,CAAA,MAAA,EAAA;AACA,QAAA,UAAA,GAAA,IAAA,CAAA,UAAA,CAAA,WAAA,CAAA;AACA,WAAA;AACA,MAAA,IAAA,EAAA,IADA;AAEA,MAAA,UAAA,EAAA,UAFA;AAGA,MAAA,IAAA,EAAA,KAHA;AAIA;AACA,MAAA,iBAAA,EAAA;AACA,QAAA,KAAA,EAAA,MADA;AAEA,QAAA,KAAA,EAAA,IAFA;AAGA,QAAA,QAAA,EAAA;AAHA,OALA;AAUA,MAAA,SAAA,EAAA,EAVA;AAWA;AACA,MAAA,gBAAA,EAAA,IAZA;AAaA,MAAA,SAAA,EAAA,MAAA,EAbA;AAcA,MAAA,IAAA,EAAA,EAdA;AAeA;AACA,MAAA,sBAAA,EAAA,KAhBA;AAiBA,MAAA,WAAA,EAAA,EAjBA;AAkBA,MAAA,WAAA,EAAA,OAlBA;AAmBA,MAAA,aAAA,EAAA,EAnBA;AAoBA,MAAA,aAAA,EAAA,EApBA;AAqBA,MAAA,YAAA,EAAA,IArBA;AAsBA,MAAA,WAAA,EAAA,EAtBA;AAuBA,MAAA,gBAAA,EAAA;AAvBA,KAAA;AAyBA,GApEA;AAqEA,EAAA,QAAA,EAAA;AACA;AACA,IAAA,QAFA,sBAEA;AACA,UAAA,CAAA,KAAA,SAAA,IAAA,CAAA,KAAA,IAAA,GAAA,CAAA,EAAA;AACA,eAAA,GAAA;AACA,OAFA,MAEA;AACA,yBAAA,KAAA,IAAA,CAAA,SAAA,GAAA,KAAA,IAAA;AACA;AACA,KARA;AASA;AACA,IAAA,WAVA,yBAUA;AACA,UAAA,CAAA,KAAA,SAAA,IAAA,CAAA,KAAA,IAAA,GAAA,CAAA,EAAA;AACA,eAAA,GAAA;AACA,OAFA,MAEA;AACA,yBAAA,KAAA,IAAA,CAAA,SAAA,GAAA,KAAA,IAAA,GACA,CAAA,KAAA,YADA,GAEA,CAAA,KAAA,aAFA;AAGA;AACA,KAlBA;AAmBA,IAAA,eAnBA,6BAmBA;AACA,aAAA,KAAA,WAAA,CAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,CAAA,GAAA,QAAA,GAAA,EAAA;AACA,KArBA;AAsBA,IAAA,aAtBA,2BAsBA;AACA,aAAA,GAAA,CAAA,KAAA,IAAA,CAAA,UAAA,EAAA,MAAA,EAAA,CAAA,CAAA;AACA,KAxBA;AAyBA,IAAA,cAzBA,4BAyBA;AACA,aAAA,IAAA,CAAA,SAAA,CAAA,KAAA,IAAA,MAAA,IAAA;AACA;AA3BA,GArEA;AAkGA,EAAA,KAAA,EAAA;AACA,IAAA,IADA,gBACA,MADA,EACA,MADA,EACA;AACA,WAAA,aAAA;AACA,WAAA,QAAA,CAAA,KAAA,aAAA,EAAA,CAAA,KAAA,YAAA;AACA,KAJA;AAKA,IAAA,aAAA,EAAA;AACA,MAAA,IAAA,EAAA,IADA;AAEA,MAAA,OAFA,mBAEA,MAFA,EAEA,MAFA,EAEA;AACA,aAAA,QAAA,CAAA,MAAA,EAAA,CAAA,KAAA,YAAA;AACA;AAJA,KALA;AAWA,IAAA,YAXA,wBAWA,MAXA,EAWA,MAXA,EAWA;AACA,WAAA,QAAA,CAAA,KAAA,aAAA,EAAA,CAAA,MAAA;AACA;AAbA,GAlGA;AAiHA,EAAA,OAjHA,qBAiHA;AAAA;;AACA,SAAA,kBAAA,CAAA,iBAAA,CAAA,MAAA,CAAA;AAAA,aAAA,CAAA;AAAA,KAAA;AACA,SAAA,kBAAA,CAAA,aAAA,CAAA,MAAA,CAAA;AAAA,aAAA,CAAA;AAAA,KAAA;AACA,SAAA,kBAAA,CAAA,IAAA,GAAA,SAAA,CAAA,UAAA,GAAA,EAAA;AACA,UAAA,KAAA,CAAA,EAAA,EAAA;AACA,QAAA,KAAA,CAAA,kBAAA,CAAA,OAAA,CAAA,KAAA,CAAA,EAAA,EAAA,SAAA,CAAA,UAAA,GAAA,EAAA;AACA,UAAA,UAAA,CAAA,YAAA;AACA,YAAA,KAAA,CAAA,SAAA,GAAA,SAAA,CAAA,MAAA,CAAA,GAAA,CAAA,IAAA,CAAA,UAAA,CAAA,CAAA;AACA,WAFA,CAAA;AAGA,SAJA;AAKA;;AACA,MAAA,KAAA,CAAA,kBAAA,CAAA,cAAA,CAAA,KAAA,CAAA,MAAA,EAAA,SAAA;AACA,KATA;AAUA,GA9HA;AA+HA,EAAA,OAAA,EAAA;AACA,IAAA,cADA,0BACA,IADA,EACA;AAAA;;AACA,WAAA,YAAA;;AACA,UAAA,IAAA,EAAA;AACA,aAAA,kBAAA,CAAA,cAAA,CAAA,IAAA,EAAA,SAAA,CAAA,UAAA,GAAA,EAAA;AACA,UAAA,MAAA,CAAA,WAAA,GAAA,SAAA,CAAA,GAAA,CAAA,IAAA,CAAA;AACA,SAFA;AAGA;AACA,KARA;AASA;AACA,IAAA,YAVA,0BAUA;AACA,WAAA,WAAA,GAAA,EAAA;AACA,WAAA,WAAA,GAAA,OAAA;AACA,WAAA,aAAA,GAAA,EAAA;AACA,WAAA,aAAA,GAAA,EAAA;AACA,KAfA;AAgBA,IAAA,eAhBA,2BAgBA,IAhBA,EAgBA;AACA,WAAA,SAAA,GAAA,IAAA,CAAA,CAAA,CAAA;AACA,WAAA,kBAAA,CAAA,OAAA,CAAA,IAAA,CAAA,CAAA,CAAA,EAAA,SAAA;AACA,KAnBA;AAoBA;AACA,IAAA,eArBA,2BAqBA,QArBA,EAqBA;AACA,aACA,QAAA,CAAA,OAAA,KAAA,KAAA,SAAA,CAAA,OAAA,EAAA,IACA,QAAA,CAAA,OAAA,KACA,MAAA,GACA,GADA,CACA,GADA,EACA,GADA,EAEA,OAFA,EAHA;AAOA,KA7BA;AA8BA;AACA,IAAA,aA/BA,yBA+BA,IA/BA,EA+BA;AACA,WAAA,IAAA,CAAA,cAAA,CAAA;AACA,QAAA,YAAA,EAAA,IAAA,CAAA,IAAA,CACA,IAAA,CAAA,IAAA,CAAA,KAAA,SAAA,EAAA,SAAA,KAAA,KAAA,EAAA,CADA;AADA,OAAA;AAKA,WAAA,IAAA,GAAA,IAAA,CAAA,IAAA,CAAA,IAAA,CAAA,IAAA,CAAA,KAAA,SAAA,EAAA,SAAA,KAAA,KAAA,EAAA,CAAA,CAAA;AACA,KAtCA;AAuCA,IAAA,oBAvCA,gCAuCA,IAvCA,EAuCA;AACA,WAAA,IAAA,GAAA,IAAA;AACA,UAAA,KAAA,GAAA,SAAA,CAAA,KAAA,SAAA,CAAA;;AACA,UAAA,IAAA,GAAA,CAAA,EAAA;AACA;AACA,aAAA,IAAA,CAAA,cAAA,CAAA;AACA,UAAA,aAAA,EAAA,KAAA,CAAA,GAAA,CAAA,IAAA,EAAA,GAAA;AADA,SAAA;AAGA,OALA,MAKA;AACA;AACA,aAAA,IAAA,CAAA,WAAA,CAAA,CAAA,eAAA,CAAA;AACA;AACA,KAnDA;AAoDA,IAAA,eApDA,6BAoDA;AAAA;;AACA,MAAA,KAAA,CAAA,GAAA,CAAA,CAAA,SAAA,CAAA,YAAA;AACA,QAAA,MAAA,CAAA,sBAAA,GAAA,KAAA;AACA,OAFA;AAGA,KAxDA;AAyDA,IAAA,QAzDA,sBAyDA;AACA,WAAA,YAAA;AACA,KA3DA;AA4DA,IAAA,qBA5DA,iCA4DA,IA5DA,EA4DA;AACA,UAAA,CAAA,IAAA,CAAA,MAAA,CAAA,KAAA,EAAA;AACA,aAAA,aAAA,GAAA,CAAA;AACA,aAAA,WAAA;AACA;AACA;;AACA,UAAA,KAAA,GAAA,KAAA,WAAA,CAAA,MAAA,CAAA,UAAA,CAAA;AAAA,eAAA,CAAA,CAAA,EAAA,KAAA,IAAA,CAAA,MAAA,CAAA,KAAA;AAAA,OAAA,EAAA,CAAA,EACA,KADA;AAEA,WAAA,aAAA,GAAA,KAAA;AACA,WAAA,WAAA,aAAA,KAAA;AACA,KAtEA;AAuEA;AACA,IAAA,QAxEA,oBAwEA,OAxEA,EAwEA,MAxEA,EAwEA;AACA,UAAA,QAAA,GAAA,KAAA,IAAA,CAAA,aAAA,CAAA,WAAA,CAAA;AACA,WAAA,kBAAA,CAAA,mBAAA,CAAA,QAAA,CAAA;AACA,QAAA,UAAA,EAAA,KAAA,SADA;AAEA,QAAA,YAAA,EAAA,KAAA,IAAA,CAAA,aAFA;AAGA,QAAA,WAAA,EAAA,KAAA,IAHA;AAIA,QAAA,UAAA,EAAA,OAAA,IAAA,SAJA;AAKA,QAAA,SAAA,EAAA,QAAA,IAAA,SALA;AAMA,QAAA,aAAA,EAAA,MAAA,IAAA;AANA,OAAA;AAQA,KAlFA;AAmFA;AACA,IAAA,aApFA,2BAoFA;AACA,WAAA,kBAAA,CAAA,uBAAA,CAAA,QAAA,CAAA;AACA,QAAA,UAAA,EAAA,KAAA,SADA;AAEA,QAAA,YAAA,EAAA,KAAA,IAAA,CAAA,aAFA;AAGA,QAAA,WAAA,EAAA,KAAA;AAHA,OAAA;AAKA,KA1FA;AA2FA,IAAA,aA3FA,2BA2FA;AAAA;;AACA,WAAA,IAAA,CAAA,QAAA,GAAA,IAAA,CAAA,UAAA,MAAA,EAAA;AACA,YAAA,aAAA,GAAA,MAAA,CAAA,YAAA,GAAA,CAAA,MAAA,CAAA,YAAA,GAAA,CAAA;;AACA,QAAA,MAAA,CAAA,kBAAA,CACA,cADA,CACA;AACA,UAAA,UAAA,EAAA,CAAA,MAAA,CAAA,SADA;AAEA,UAAA,UAAA,YAAA,MAAA,CAAA,SAAA,CAAA,MAAA,CAAA,kBAAA,CAAA,CAFA;AAGA,UAAA,QAAA,YAAA,MAAA,CAAA,aAAA,CAAA,MAAA,CAAA,kBAAA,CAAA,CAHA;AAIA,UAAA,UAAA,EAAA,CAAA,MAAA,CAAA,IAJA;AAKA,UAAA,eAAA,EAAA,MAAA,CAAA,IAAA,CAAA,eALA;AAMA,UAAA,UAAA,EACA,MAAA,CAAA,aAAA,KAAA,CAAA,CAAA,GAAA,SAAA,GAAA,MAAA,CAAA,aAPA;AAQA,UAAA,aAAA,EAAA,aARA;AASA,UAAA,YAAA,EAAA,MAAA,CAAA,YATA;AAUA,UAAA,SAAA,EAAA,CAAA,MAAA,CAAA,SAVA;AAWA,UAAA,WAAA,EAAA,MAAA,CAAA,WAXA;AAYA,UAAA,MAAA,EAAA,MAAA,CAAA,MAAA,GAAA,MAAA,CAAA,MAAA,CAAA,KAAA,GAAA,SAZA;AAaA,UAAA,OAAA,EAAA,CAAA,MAAA,CAAA,QAbA;AAcA,UAAA,WAAA,EAAA,MAAA,CAAA,WAdA;AAeA,UAAA,UAAA,EAAA,CAAA,MAAA,CAAA,IAAA,CAAA,UAAA,CAAA,IAfA;AAgBA,UAAA,SAAA,EAAA,MAAA,CAAA,SAhBA;AAiBA,UAAA,WAAA,EAAA,MAAA,CAAA,WAjBA;AAkBA,UAAA,aAAA,EAAA,MAAA,CAAA,aAAA,GACA,MAAA,CAAA,aAAA,CAAA,KADA,GAEA,SApBA;AAqBA,UAAA,qBAAA,EAAA,MAAA,CAAA,aAAA,GACA,MAAA,CAAA,aAAA,CAAA,OADA,GAEA,SAvBA;AAwBA,UAAA,gBAAA,EAAA,MAAA,CAAA,gBAxBA;AAyBA,UAAA,WAAA,EAAA,MAAA,CAAA,WAzBA;AA0BA,UAAA,QAAA,EAAA,MAAA,CAAA,QA1BA;AA2BA,UAAA,OAAA,EAAA,MAAA,CAAA,OA3BA;AA4BA,UAAA,YAAA,EAAA,MAAA,CAAA,YA5BA;AA6BA,UAAA,kBAAA,EAAA,MAAA,CAAA;AA7BA,SADA,EAgCA,SAhCA,CAgCA,UAAA,GAAA,EAAA;AACA,UAAA,MAAA,CAAA,IAAA,GAAA,KAAA;;AACA,UAAA,MAAA,CAAA,KAAA,CAAA,SAAA,EAAA;AACA,YAAA,IAAA,EAAA,QADA;AAEA,YAAA,OAAA,EAAA,GAAA,CAAA,IAAA,CAAA;AAFA,WAAA;AAIA,SAtCA;AAuCA,OAzCA;AA0CA,KAtIA;AAuIA,IAAA,KAvIA,mBAuIA;AAAA;;AACA,WAAA,IAAA,CAAA,QAAA,GAAA,IAAA,CAAA,UAAA,MAAA,EAAA;AACA,YAAA,aAAA,GAAA,MAAA,CAAA,YAAA,GAAA,CAAA,MAAA,CAAA,YAAA,GAAA,CAAA;;AACA,QAAA,MAAA,CAAA,kBAAA,CACA,iBADA,CACA;AACA,UAAA,UAAA,EAAA,CAAA,MAAA,CAAA,SADA;AAEA,UAAA,UAAA,YAAA,MAAA,CAAA,SAAA,CAAA,MAAA,CAAA,kBAAA,CAAA,CAFA;AAGA,UAAA,QAAA,YAAA,MAAA,CAAA,aAAA,CAAA,MAAA,CAAA,kBAAA,CAAA,CAHA;AAIA,UAAA,UAAA,EAAA,CAAA,MAAA,CAAA,IAJA;AAKA,UAAA,eAAA,EAAA,MAAA,CAAA,IAAA,CAAA,eALA;AAMA,UAAA,UAAA,EACA,MAAA,CAAA,aAAA,KAAA,CAAA,CAAA,GAAA,SAAA,GAAA,MAAA,CAAA,aAPA;AAQA,UAAA,aAAA,EAAA,aARA;AASA,UAAA,YAAA,EAAA,MAAA,CAAA,YATA;AAUA,UAAA,SAAA,EAAA,CAAA,MAAA,CAAA,SAVA;AAWA,UAAA,WAAA,EAAA,MAAA,CAAA,WAXA;AAYA,UAAA,MAAA,EAAA,MAAA,CAAA,MAAA,GAAA,MAAA,CAAA,MAAA,CAAA,KAAA,GAAA,SAZA;AAaA,UAAA,OAAA,EAAA,CAAA,MAAA,CAAA,QAbA;AAcA,UAAA,WAAA,EAAA,MAAA,CAAA,WAdA;AAeA,UAAA,UAAA,EAAA,CAAA,MAAA,CAAA,IAAA,CAAA,UAAA,CAAA,IAfA;AAgBA,UAAA,SAAA,EAAA,MAAA,CAAA,SAhBA;AAiBA,UAAA,WAAA,EAAA,MAAA,CAAA,WAjBA;AAkBA,UAAA,aAAA,EAAA,MAAA,CAAA,aAAA,GACA,MAAA,CAAA,aAAA,CAAA,KADA,GAEA,SApBA;AAqBA,UAAA,qBAAA,EAAA,MAAA,CAAA,aAAA,GACA,MAAA,CAAA,aAAA,CAAA,OADA,GAEA,SAvBA;AAwBA,UAAA,gBAAA,EAAA,MAAA,CAAA,gBAxBA;AAyBA,UAAA,WAAA,EAAA,MAAA,CAAA,WAzBA;AA0BA,UAAA,QAAA,EAAA,MAAA,CAAA,QA1BA;AA2BA,UAAA,OAAA,EAAA,MAAA,CAAA,OA3BA;AA4BA,UAAA,YAAA,EAAA,MAAA,CAAA,YA5BA;AA6BA,UAAA,kBAAA,EAAA,MAAA,CAAA;AA7BA,SADA,EAgCA,SAhCA,CAgCA,UAAA,GAAA,EAAA;AACA,UAAA,MAAA,CAAA,IAAA,GAAA,KAAA;;AACA,UAAA,MAAA,CAAA,KAAA,CAAA,SAAA,EAAA;AACA,YAAA,IAAA,EAAA,WADA;AAEA,YAAA,OAAA,EAAA,GAAA,CAAA,IAAA,CAAA;AAFA,WAAA;AAIA,SAtCA;AAuCA,OAzCA;AA0CA;AAlLA;AA/HA,CAAA","sourcesContent":["<template>\n  <st-modal\n    title=\"租赁柜签单\"\n    v-model=\"show\"\n    @cancel=\"onCancel\"\n    wrapClassName=\"modal-sold-deal-sale\"\n  >\n    <div :class=\"sale('content')\">\n      <st-form :form=\"form\" labelWidth=\"88px\">\n        <member-search\n          :class=\"sale('member')\"\n          :form=\"form\"\n          :memberInfo=\"memberInfo\"\n          :saleRangeType=\"saleRangeType\"\n          isSoldDeal\n          @change=\"onMemberChange\"\n        ></member-search>\n        <div :class=\"sale('sale')\">\n          <st-form-item v-if=\"cabinetList\" label=\"租赁柜号\" required>\n            <a-cascader\n              v-decorator=\"decorators.cabinet\"\n              @change=\"onCabinetChange\"\n              :allowClear=\"false\"\n              :fieldNames=\"cabinetFieldNames\"\n              :options=\"cabinetList\"\n              placeholder=\"请选择租赁柜号\"\n            />\n            <a-row\n              :class=\"sale('info')\"\n              v-if=\"hasProductInfo\"\n              type=\"flex\"\n              justify=\"space-between\"\n            >\n              <a-col :span=\"12\">\n                <st-info>\n                  <st-info-item label=\"商品名称\">\n                    {{ info.product_name }}\n                  </st-info-item>\n                  <st-info-item label=\"商品类型\">\n                    {{ info.product_type }}\n                  </st-info-item>\n                  <st-info-item class=\"mg-b24\" label=\"租赁计费\">\n                    {{ info.price }}\n                  </st-info-item>\n                </st-info>\n              </a-col>\n              <a-col :span=\"11\">\n                <st-info>\n                  <st-info-item label=\"售卖群体\" v-if=\"info.sale_range\">\n                    {{ info.sale_range.name }}\n                  </st-info-item>\n                  <st-info-item label=\"允许转让\">\n                    {{ info.is_transfer }}\n                  </st-info-item>\n                  <st-info-item class=\"mg-b24\" label=\"转让手续费\">\n                    {{ info.transfer }}\n                  </st-info-item>\n                </st-info>\n              </a-col>\n            </a-row>\n          </st-form-item>\n          <st-form-item required class=\"mg-b0\" label=\"租赁时间\">\n            <div :class=\"sale('time')\">\n              <a-form-item class=\"page-a-form\">\n                <a-date-picker\n                  style=\"width: 100%;\"\n                  v-model=\"startTime\"\n                  disabled\n                  format=\"YYYY-MM-DD HH:mm\"\n                  placeholder=\"开始时间\"\n                  :showToday=\"false\"\n                />\n              </a-form-item>\n              <span>~</span>\n              <a-form-item class=\"page-a-form\">\n                <a-date-picker\n                  :allowClear=\"false\"\n                  :disabled=\"disabledCalendar\"\n                  v-decorator=\"decorators.endTimePicker\"\n                  @change=\"endTimeChange\"\n                  style=\"width: 100%;\"\n                  :showTime=\"{ defaultValue: startTime, format: 'HH:mm' }\"\n                  format=\"YYYY-MM-DD HH:mm\"\n                  placeholder=\"结束时间\"\n                  :showToday=\"false\"\n                />\n              </a-form-item>\n            </div>\n          </st-form-item>\n          <st-form-item required label=\"租赁天数\">\n            <st-input-number\n              :disabledDate=\"disabledCalendar\"\n              @change=\"onEndTimeInputChange\"\n              v-decorator=\"decorators.endTimeInput\"\n              :max=\"999999\"\n            >\n              <template slot=\"addonAfter\">\n                天\n              </template>\n            </st-input-number>\n          </st-form-item>\n          <editable-contract-number\n            v-model=\"info.contract_number\"\n            :form=\"form\"\n          />\n          <st-form-item class=\"mg-b12\" label=\"租赁费用\">\n            {{ orderAmountPrice }}\n          </st-form-item>\n          <st-form-item :class=\"sale('discounts')\" label=\"定金抵扣\">\n            <div>\n              <div :class=\"sale('discounts-total')\">\n                <span>{{ advanceText }}</span>\n                <a-dropdown\n                  v-model=\"advanceDropdownVisible\"\n                  :disabled=\"advanceList.length === 0\"\n                  :class=\"sale({ disabled: advanceList.length === 0 })\"\n                  placement=\"bottomRight\"\n                  :getPopupContainer=\"trigger => trigger.parentNode\"\n                  :trigger=\"['click']\"\n                >\n                  <div :class=\"sale('discounts-promotion')\">\n                    <span>\n                      {{ advanceList.length === 0 ? '无定金' : '定金选择' }}\n                    </span>\n                    <a-icon type=\"right\" />\n                  </div>\n                  <a-radio-group\n                    v-model=\"selectAdvance\"\n                    @change=\"onSelectAdvanceChange\"\n                    :class=\"sale('dropdown')\"\n                    slot=\"overlay\"\n                  >\n                    <a-menu>\n                      <a-menu-item @click=\"onSelectAdvance\">\n                        <a-radio :value=\"undefined\">不使用</a-radio>\n                      </a-menu-item>\n                      <a-menu-item\n                        @click=\"onSelectAdvance\"\n                        :key=\"index\"\n                        v-for=\"(item, index) in advanceList\"\n                      >\n                        <a-radio :value=\"item.id\">\n                          定金 {{ item.price }}\n                        </a-radio>\n                      </a-menu-item>\n                    </a-menu>\n                  </a-radio-group>\n                </a-dropdown>\n              </div>\n            </div>\n          </st-form-item>\n          <st-form-item label=\"减免金额\">\n            <st-input-number\n              v-model=\"reduceAmount\"\n              :float=\"true\"\n              placeholder=\"请输入\"\n            >\n              <span slot=\"addonAfter\">元</span>\n            </st-input-number>\n          </st-form-item>\n          <st-form-item\n            validateStatus=\"error\"\n            :help=\"orderAmountText\"\n            class=\"mg-b0\"\n            label=\"小计\"\n          >\n            <span class=\"total\">{{ currentPrice }}</span>\n          </st-form-item>\n        </div>\n        <div :class=\"sale('remarks')\">\n          <st-form-item label=\"销售人员\" required>\n            <a-select\n              v-decorator=\"decorators.saleName\"\n              placeholder=\"选择签单的工作人员\"\n            >\n              <a-select-option\n                v-for=\"(item, index) in saleList\"\n                :key=\"index\"\n                :value=\"item.id\"\n              >\n                {{ item.staff_name }}\n              </a-select-option>\n            </a-select>\n            <div>\n              <st-checkbox v-model=\"isFollowSalesman\">\n                作为用户跟进销售\n              </st-checkbox>\n            </div>\n          </st-form-item>\n          <st-form-item label=\"备注\" class=\"mg-b0\">\n            <st-textarea\n              v-model=\"description\"\n              :autosize=\"{ minRows: 4, maxRows: 6 }\"\n              :maxlength=\"200\"\n            />\n          </st-form-item>\n        </div>\n      </st-form>\n    </div>\n    <template slot=\"footer\">\n      <div :class=\"sale('footer')\">\n        <div class=\"price\">\n          <span>{{ currentPrice }}</span>\n          <span>订单总额：{{ orderAmountPrice }}</span>\n        </div>\n        <div class=\"button\">\n          <st-button @click=\"onCreateOrder\" :loading=\"loading.setTransaction\">\n            创建订单\n          </st-button>\n          <st-button\n            @click=\"onPay\"\n            :loading=\"loading.setTransactionPay\"\n            type=\"primary\"\n          >\n            立即支付\n          </st-button>\n        </div>\n      </div>\n    </template>\n  </st-modal>\n</template>\n\n<script>\nimport { SaleCabinetService } from './sale-cabinet.service'\nimport { cloneDeep, get } from 'lodash-es'\nimport { timer } from 'rxjs'\nimport { PatternService } from '@/services/pattern.service'\nimport { ruleOptions } from './sale-cabinet.config'\nimport EditableContractNumber from '@/views/biz-components/contract/editable-contract-number.vue'\nimport MemberSearch from '@/views/biz-components/member/member-search/member-search'\nexport default {\n  name: 'ModalSoldDealSaleCabinet',\n  bem: {\n    sale: 'modal-sold-deal-sale'\n  },\n  components: {\n    EditableContractNumber,\n    MemberSearch\n  },\n  serviceProviders() {\n    return [SaleCabinetService]\n  },\n  serviceInject() {\n    return {\n      saleCabinetService: SaleCabinetService,\n      pattern: PatternService\n    }\n  },\n  rxState() {\n    return {\n      loading: this.saleCabinetService.loading$,\n      saleList: this.saleCabinetService.saleList$,\n      cabinetList: this.saleCabinetService.cabinetList$,\n      info: this.saleCabinetService.info$,\n      currentPrice: this.saleCabinetService.currentPrice$,\n      orderAmountPrice: this.saleCabinetService.orderAmountPrice$\n    }\n  },\n  props: {\n    id: {\n      type: String\n    },\n    areaId: {\n      type: [String, Number],\n      default: 0\n    },\n    memberInfo: {\n      type: Object\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      show: false,\n      // 租赁柜\n      cabinetFieldNames: {\n        label: 'name',\n        value: 'id',\n        children: 'cabinets'\n      },\n      cabinetId: '',\n      // 租赁天数\n      disabledCalendar: true,\n      startTime: moment(),\n      days: '',\n      // 定金\n      advanceDropdownVisible: false,\n      advanceList: [],\n      advanceText: '未选择定金',\n      advanceAmount: '',\n      selectAdvance: '',\n      reduceAmount: null,\n      description: '',\n      isFollowSalesman: 0\n    }\n  },\n  computed: {\n    // 租赁费用\n    leaseFee() {\n      if (!this.cabinetId || !this.days > 0) {\n        return '无'\n      } else {\n        return `${this.info.price_num * this.days}元`\n      }\n    },\n    // 小计\n    orderAmount() {\n      if (!this.cabinetId || !this.days > 0) {\n        return '无'\n      } else {\n        return `${this.info.price_num * this.days -\n          +this.reduceAmount -\n          +this.advanceAmount}元`\n      }\n    },\n    orderAmountText() {\n      return this.orderAmount.split('元')[0] < 0 ? '小计不能为负' : ''\n    },\n    saleRangeType() {\n      return get(this.info.sale_range, 'type', 1)\n    },\n    hasProductInfo() {\n      return JSON.stringify(this.info) !== '{}'\n    }\n  },\n  watch: {\n    days(newVal, oldVal) {\n      this.getOrderPrice()\n      this.getPrice(this.selectAdvance, +this.reduceAmount)\n    },\n    selectAdvance: {\n      deep: true,\n      handler(newVal, oldVal) {\n        this.getPrice(newVal, +this.reduceAmount)\n      }\n    },\n    reduceAmount(newVal, oldVal) {\n      this.getPrice(this.selectAdvance, +newVal)\n    }\n  },\n  created() {\n    this.saleCabinetService.orderAmountPrice$.commit(() => 0)\n    this.saleCabinetService.currentPrice$.commit(() => 0)\n    this.saleCabinetService.init().subscribe(res => {\n      if (this.id) {\n        this.saleCabinetService.getInfo(this.id).subscribe(res => {\n          setTimeout(() => {\n            this.startTime = cloneDeep(moment(res.info.start_time))\n          })\n        })\n      }\n      this.saleCabinetService.getCabinetList(this.areaId).subscribe()\n    })\n  },\n  methods: {\n    onMemberChange(data) {\n      this.resetAdvance()\n      if (data) {\n        this.saleCabinetService.getAdvanceList(data).subscribe(res => {\n          this.advanceList = cloneDeep(res.list)\n        })\n      }\n    },\n    // 重置定金选择\n    resetAdvance() {\n      this.advanceList = []\n      this.advanceText = '未选择定金'\n      this.advanceAmount = ''\n      this.selectAdvance = ''\n    },\n    onCabinetChange(data) {\n      this.cabinetId = data[1]\n      this.saleCabinetService.getInfo(data[1]).subscribe()\n    },\n    // 租赁时间\n    disabledEndDate(endValue) {\n      return (\n        endValue.valueOf() < this.startTime.valueOf() ||\n        endValue.valueOf() >\n          moment()\n            .add(999, 'd')\n            .valueOf()\n      )\n    },\n    // 租赁时间-end\n    endTimeChange(data) {\n      this.form.setFieldsValue({\n        endTimeInput: Math.ceil(\n          data.diff(this.startTime, 'minutes') / (24 * 60)\n        )\n      })\n      this.days = Math.ceil(data.diff(this.startTime, 'minutes') / (24 * 60))\n    },\n    onEndTimeInputChange(data) {\n      this.days = data\n      let start = cloneDeep(this.startTime)\n      if (data > 0) {\n        // 有效天数\n        this.form.setFieldsValue({\n          endTimePicker: start.add(data, 'd')\n        })\n      } else {\n        // 无效天数\n        this.form.resetFields(['endTimePicker'])\n      }\n    },\n    onSelectAdvance() {\n      timer(200).subscribe(() => {\n        this.advanceDropdownVisible = false\n      })\n    },\n    onCancel() {\n      this.resetAdvance()\n    },\n    onSelectAdvanceChange(data) {\n      if (!data.target.value) {\n        this.advanceAmount = 0\n        this.advanceText = `未选择定金`\n        return\n      }\n      let price = this.advanceList.filter(o => o.id === data.target.value)[0]\n        .price\n      this.advanceAmount = price\n      this.advanceText = `${price}元`\n    },\n    // 获取当前价钱\n    getPrice(advance, reduce) {\n      const memberId = this.form.getFieldValue('member_id')\n      this.saleCabinetService.currentPriceAction$.dispatch({\n        product_id: this.cabinetId,\n        product_type: this.info.contract_type,\n        product_num: this.days,\n        advance_id: advance || undefined,\n        member_id: memberId || undefined,\n        reduce_amount: reduce || undefined\n      })\n    },\n    // 获取订单总额\n    getOrderPrice() {\n      this.saleCabinetService.orderAmountPriceAction$.dispatch({\n        product_id: this.cabinetId,\n        product_type: this.info.contract_type,\n        product_num: this.days\n      })\n    },\n    onCreateOrder() {\n      this.form.validate().then(values => {\n        let reduce_amount = this.reduceAmount ? +this.reduceAmount : 0\n        this.saleCabinetService\n          .setTransaction({\n            cabinet_id: +this.cabinetId,\n            start_time: `${this.startTime.format('YYYY-MM-DD HH:mm')}`,\n            end_time: `${values.endTimePicker.format('YYYY-MM-DD HH:mm')}`,\n            lease_days: +this.days,\n            contract_number: this.info.contract_number,\n            advance_id:\n              this.selectAdvance === -1 ? undefined : this.selectAdvance,\n            reduce_amount,\n            order_amount: this.currentPrice,\n            member_id: +values.member_id,\n            member_name: values.member_name,\n            mobile: values.mobile ? values.mobile.phone : undefined,\n            sale_id: +values.saleName,\n            description: this.description,\n            sale_range: +this.info.sale_range.type,\n            is_minors: values.is_minors,\n            parent_name: values.parent_name,\n            parent_mobile: values.parent_mobile\n              ? values.parent_mobile.phone\n              : undefined,\n            parent_country_prefix: values.parent_mobile\n              ? values.parent_mobile.code_id\n              : undefined,\n            parent_user_role: values.parent_user_role,\n            physical_id: values.physical_id,\n            card_num: values.card_num,\n            id_card: values.id_card,\n            id_card_type: values.id_card_type,\n            is_follow_salesman: this.isFollowSalesman\n          })\n          .subscribe(res => {\n            this.show = false\n            this.$emit('success', {\n              type: 'create',\n              orderId: res.info.order_id\n            })\n          })\n      })\n    },\n    onPay() {\n      this.form.validate().then(values => {\n        let reduce_amount = this.reduceAmount ? +this.reduceAmount : 0\n        this.saleCabinetService\n          .setTransactionPay({\n            cabinet_id: +this.cabinetId,\n            start_time: `${this.startTime.format('YYYY-MM-DD HH:mm')}`,\n            end_time: `${values.endTimePicker.format('YYYY-MM-DD HH:mm')}`,\n            lease_days: +this.days,\n            contract_number: this.info.contract_number,\n            advance_id:\n              this.selectAdvance === -1 ? undefined : this.selectAdvance,\n            reduce_amount,\n            order_amount: this.currentPrice,\n            member_id: +values.member_id,\n            member_name: values.member_name,\n            mobile: values.mobile ? values.mobile.phone : undefined,\n            sale_id: +values.saleName,\n            description: this.description,\n            sale_range: +this.info.sale_range.type,\n            is_minors: values.is_minors,\n            parent_name: values.parent_name,\n            parent_mobile: values.parent_mobile\n              ? values.parent_mobile.phone\n              : undefined,\n            parent_country_prefix: values.parent_mobile\n              ? values.parent_mobile.code_id\n              : undefined,\n            parent_user_role: values.parent_user_role,\n            physical_id: values.physical_id,\n            card_num: values.card_num,\n            id_card: values.id_card,\n            id_card_type: values.id_card_type,\n            is_follow_salesman: this.isFollowSalesman\n          })\n          .subscribe(res => {\n            this.show = false\n            this.$emit('success', {\n              type: 'createPay',\n              orderId: res.info.order_id\n            })\n          })\n      })\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/sold/deal"}]}