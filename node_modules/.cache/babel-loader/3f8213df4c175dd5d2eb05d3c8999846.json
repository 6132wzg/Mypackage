{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/course/manage/package/add-unlimit-package.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/course/manage/package/add-unlimit-package.vue","mtime":1596188219725},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport ReserveIsLimit from \"./components#/reserveIsLimit\";\nimport { cloneDeep, remove } from 'lodash-es';\nimport { AddUnlimitPackageService } from \"./add-unlimit-package.service\";\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue';\nexport default {\n  name: 'ShopUnlimitPackageAdd',\n  serviceInject: function serviceInject() {\n    return {\n      addPackageService: AddUnlimitPackageService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      transferUnitList: this.addPackageService.transferUnitList$,\n      sellTypeList: this.addPackageService.sellTypeList$,\n      unitList: this.addPackageService.unitList$,\n      addLoading: this.addPackageService.loading$\n    };\n  },\n  components: {\n    StImageUpload: StImageUpload,\n    ReserveIsLimit: ReserveIsLimit\n  },\n  bem: {\n    add: 'page-shop-add-unlimit-package',\n    basic: 'page-shop-add-basic-package'\n  },\n  data: function data() {\n    return {\n      packageData: {\n        // 课程包名称\n        course_name: '',\n        // 是否支持团体课 0为不支持 1为支持\n        is_team: 0,\n        // 团体课总节数\n        team_times: undefined,\n        // 团体课单价\n        team_unit_price: undefined,\n        // 是否支持私教课 0为不支持 1为支持\n        is_personal: 0,\n        // 私教课总节数\n        personal_times: undefined,\n        // 私教课单价\n        personal_unit_price: undefined,\n        // 售价\n        price: undefined,\n        // 售卖开始时间\n        start_time: '',\n        // 售卖截止时间\n        end_time: '',\n        // 有效时间值\n        valid_time: undefined,\n        // 有效时间单位 1:天 2:月 3:年\n        valid_time_unit: 1,\n        // 允许冻结天数\n        frozen_days: undefined,\n        // 是否可以转让: 0 不可以 1 可以\n        is_allow_transfer: 0,\n        // 转让费率\n        transfer_rate: undefined,\n        // 转让单位 1:百分比 2:元\n        transfer_unit: 1,\n        // 售卖方式\n        sale_mode: [2],\n        // 封面对象\n        image: {\n          image_id: undefined,\n          image_key: ''\n        },\n        // 课程包介绍\n        intro: '',\n        // 备注\n        remarks: ''\n      },\n      form: this.$form.createForm(this),\n      start_time: null,\n      end_time: null,\n      endOpen: false,\n      // 课程范围是否未输入过\n      courseIsFirstInput: true,\n      // 课程范围是否未配置\n      courseIsNone: false,\n      courseErrorText: '',\n      // 是否未传了封面\n      imageIsNone: false,\n      imageErrorText: '',\n      fileList: [],\n      cropperModal: {}\n    };\n  },\n  methods: {\n    // 保存\n    save: function save() {\n      var _this = this;\n\n      this.course_validator();\n      this.image_validator();\n      this.form.validateFieldsAndScroll(function (err, values) {\n        if (!err && !_this.courseIsNone && !_this.imageIsNone) {\n          _this.packageData.course_name = values.course_name;\n          _this.packageData.price = values.price;\n          _this.packageData.valid_time = values.valid_time;\n          _this.packageData.support_num = values.support_num;\n          _this.packageData.frozen_days = values.frozen_days;\n          _this.packageData.transfer_rate = _this.packageData.is_allow_transfer ? +values.transfer_rate : undefined;\n          _this.packageData.start_time = typeof _this.start_time === 'string' ? _this.start_time : \"\".concat(_this.start_time.format('YYYY-MM-DD'));\n          _this.packageData.end_time = typeof _this.end_time === 'string' ? _this.end_time : \"\".concat(_this.end_time.format('YYYY-MM-DD')); // 约课限制 5.22 start\n\n          _this.packageData.reserve_is_limit = values.reserve_is_limit;\n          _this.packageData.reserve_limit_day = values.reserve_limit_day;\n          _this.packageData.reserve_limit_times = +values.reserve_limit_times; // 约课限制 5.22 end\n\n          _this.addPackageService.add(_this.packageData).subscribe(function (res) {\n            _this.$router.push({\n              path: '/shop/product/course/manage/package/list'\n            });\n          });\n        }\n      });\n    },\n    // 保存并上架\n    onsale: function onsale() {\n      var _this2 = this;\n\n      this.course_validator();\n      this.image_validator();\n      this.form.validateFieldsAndScroll(function (err, values) {\n        if (!err && !_this2.courseIsNone && !_this2.imageIsNone) {\n          _this2.packageData.course_name = values.course_name;\n          _this2.packageData.price = values.price;\n          _this2.packageData.valid_time = values.valid_time;\n          _this2.packageData.support_num = values.support_num;\n          _this2.packageData.frozen_days = values.frozen_days;\n          _this2.packageData.transfer_rate = _this2.packageData.is_allow_transfer ? +values.transfer_rate : undefined; // 约课限制 5.22 start\n\n          _this2.packageData.reserve_is_limit = values.reserve_is_limit;\n          _this2.packageData.reserve_limit_day = values.reserve_limit_day;\n          _this2.packageData.reserve_limit_times = +values.reserve_limit_times; // 约课限制 5.22 end\n\n          _this2.packageData.start_time = \"\".concat(_this2.start_time.format('YYYY-MM-DD'));\n          _this2.packageData.end_time = \"\".concat(_this2.end_time.format('YYYY-MM-DD'));\n\n          _this2.addPackageService.addAndOnsale(_this2.packageData).subscribe(function (res) {\n            _this2.$router.push({\n              path: '/shop/product/course/manage/package/list'\n            });\n          });\n        }\n      });\n    },\n    // course validatorFn\n    course_validator: function course_validator() {\n      this.courseIsFirstInput = false;\n      var teamIsOk = this.packageData.is_team ? !!this.team_total : true;\n      var personalIsOk = this.packageData.is_personal ? !!this.personal_total : true;\n\n      if (teamIsOk && personalIsOk && !(!this.packageData.is_team && !this.packageData.is_personal)) {\n        // 校验通过\n        this.courseIsNone = false;\n        this.courseErrorText = '';\n      } else {\n        // 校验未通过\n        this.courseIsNone = true;\n        this.courseErrorText = '请输入上课范围';\n      }\n    },\n    // image validatorFn\n    image_validator: function image_validator() {\n      if (this.packageData.image.image_key !== '') {\n        // 校验通过\n        this.imageIsNone = false;\n        this.imageErrorText = '';\n      } else {\n        // 校验未通过\n        this.imageIsNone = true;\n        this.imageErrorText = '请上传封面';\n      }\n    },\n    // checkboxChange\n    teamCheckboxChange: function teamCheckboxChange(e) {\n      this.packageData.is_team = +e.target.checked;\n      this.courseIsFirstInput = false;\n    },\n    personalCheckboxChange: function personalCheckboxChange(e) {\n      this.packageData.is_personal = +e.target.checked;\n      this.courseIsFirstInput = false;\n    },\n    // 转让\n    transfer: function transfer(e) {\n      this.packageData.is_allow_transfer = +e.target.checked; // 重置转让费用的校验\n\n      this.packageData.transfer_rate = undefined;\n      this.form.resetFields(['transfer_rate']);\n    },\n    fileChange: function fileChange(data) {\n      if (data.length) {\n        // 上传\n        this.packageData.image.image_id = data[0].image_id;\n        this.packageData.image.image_key = data[0].image_key;\n        this.imageIsNone = false;\n        this.imageErrorText = '';\n      } else {\n        // 删除\n        this.packageData.image.image_id = null;\n        this.packageData.image.image_key = '';\n        this.imageIsNone = true;\n        this.imageErrorText = '请上传封面';\n      }\n    },\n    transferUnitChange: function transferUnitChange() {\n      this.packageData.transfer_rate = undefined;\n      this.form.setFieldsValue({\n        transfer_rate: undefined\n      });\n    },\n    // start_time validatorFn\n    start_time_validator: function start_time_validator(rule, value, callback) {\n      if (!value) {\n        // eslint-disable-next-line\n        callback('请选择开始售卖时间');\n      } else {\n        // eslint-disable-next-line\n        callback();\n      }\n    },\n    // end_time validatorFn\n    end_time_validator: function end_time_validator(rule, value, callback) {\n      if (!value) {\n        // eslint-disable-next-line\n        callback('请选择结束售卖时间');\n      } else {\n        // eslint-disable-next-line\n        callback();\n      }\n    },\n    // 售卖时间-start\n    start_time_change: function start_time_change(data) {\n      this.start_time = cloneDeep(data);\n    },\n    handleStartOpenChange: function handleStartOpenChange(open) {\n      if (!open) {\n        this.endOpen = true;\n      }\n    },\n    disabledStartDate: function disabledStartDate(startValue) {\n      var endValue = this.end_time;\n\n      if (!endValue) {\n        // 结束时间未选择\n        return startValue.valueOf() < moment().startOf('day').valueOf();\n      }\n\n      var start = endValue.valueOf() > moment().add(30, 'y').valueOf() ? moment(endValue).subtract(30, 'y').valueOf() : moment().startOf('day').valueOf();\n      return startValue.valueOf() < start || startValue.valueOf() > moment(endValue).valueOf();\n    },\n    // 售卖时间-end\n    end_time_change: function end_time_change(data) {\n      this.end_time = cloneDeep(data);\n    },\n    handleEndOpenChange: function handleEndOpenChange(open) {\n      this.endOpen = open;\n    },\n    disabledEndDate: function disabledEndDate(endValue) {\n      var startValue = this.start_time;\n\n      if (!startValue) {\n        // 开始时间未选择\n        return endValue.valueOf() < moment().startOf('day').valueOf();\n      }\n\n      return endValue.valueOf() >= moment(startValue).add(30, 'y').valueOf() || endValue.valueOf() < moment(startValue).valueOf() || endValue.valueOf() < moment().startOf('day').valueOf();\n    },\n    // moment\n    moment: moment\n  },\n  computed: {\n    // 团课小计\n    team_total: function team_total() {\n      if (+this.packageData.team_times && +this.packageData.team_unit_price) {\n        return this.packageData.team_times * (this.packageData.team_unit_price * 10) / 10;\n      } else {\n        return 0;\n      }\n    },\n    // 私教小计\n    personal_total: function personal_total() {\n      if (+this.packageData.personal_times && +this.packageData.personal_unit_price) {\n        return this.packageData.personal_times * (this.packageData.personal_unit_price * 10) / 10;\n      } else {\n        return 0;\n      }\n    },\n    // 总价\n    all_total: function all_total() {\n      var teamTotal = this.packageData.is_team ? this.team_total : 0;\n      var personalTotal = this.packageData.is_personal ? this.personal_total : 0;\n      return teamTotal + personalTotal;\n    }\n  }\n};",null]}