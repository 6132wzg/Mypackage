{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/brand/marketing/plugin/add-prize.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/brand/marketing/plugin/add-prize.vue","mtime":1598250255727},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { AddPrizeService } from './add-prize.service'\nimport { ruleOptions } from './add-prize.config.ts'\nimport { PatternService } from '@/services/pattern.service'\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue'\nimport { cloneDeep } from 'lodash-es'\nimport SelectShop from '@/views/fragments/shop/select-shop.vue'\nimport { IMG_TYPE, SHOP_TYPE, PRIZE_TYPE } from '@/constants/marketing/lottery'\nimport { MessageService } from '@/services/message.service'\nexport default {\n  name: 'BrandMarketingPoster',\n  bem: {\n    basic: 'brand-marketing-poster'\n  },\n  serviceInject() {\n    return {\n      addPrizeService: AddPrizeService,\n      pattern: PatternService,\n      messageService: MessageService\n    }\n  },\n\n  rxState() {\n    return {\n      shops: this.addPrizeService.shops$,\n      prizeType: this.addPrizeService.prizeType$,\n      imgType: this.addPrizeService.imgType$,\n      prize: this.addPrizeService.prize$\n    }\n  },\n  props: {\n    info: {\n      type: Object\n    },\n    id: {\n      type: String\n    },\n    status: {\n      type: Number\n    }\n  },\n  data(vm) {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      IMG_TYPE,\n      PRIZE_TYPE,\n      SHOP_TYPE,\n      show: false,\n      shopIds: [],\n      shopNum: 0,\n      fileList: [],\n      couponList: [],\n      curPrizeType: PRIZE_TYPE.CUSTOM,\n      curImgType: IMG_TYPE.DEFAULT,\n      curShopType: SHOP_TYPE.CUSTOM\n    }\n  },\n  mounted() {\n    if (this.info) {\n      this.form.setFieldsValue({\n        prize_name: this.info.prize_name,\n        prize_type: this.info.prize_type,\n        coupon_id: this.info.coupon_id,\n        prize_id: this.info.prize_id,\n        activity_prize_id: this.info.activity_prize_id,\n        is_shop_range: this.info.is_shop_range,\n        support_shop_ids: this.info.support_shop_ids,\n        rate: this.info.rate,\n        number: this.info.number,\n        image: this.info.image,\n        image_default: this.info.image_default\n      })\n    }\n  },\n  created() {\n    this.getCouponList()\n    if (this.info) {\n      this.curImgType = this.info.image_default\n      this.curPrizeType = this.info.prize_type\n      this.fileList[0] = this.info.prize\n      this.shopIds = this.info.support_shop_ids\n    }\n  },\n  components: { SelectShop, StImageUpload },\n  methods: {\n    getCurCouponShops(e) {\n      this.couponList.filter(item => {\n        if (item.id === e) {\n          this.shopNum = item.shop_num\n        }\n      })\n    },\n    onChangeShopSetting(val) {\n      this.shopIds = val\n    },\n    getCouponList() {\n      let coupon_id = this.info ? this.info.coupon_id : 0\n      return this.addPrizeService.getCouponList(coupon_id).subscribe(res => {\n        this.couponList = res.list\n      })\n    },\n    onChangeGetAvatar(imageFiles) {\n      this.fileList = cloneDeep(imageFiles)\n    },\n    getCurPrizeType(e) {\n      this.curPrizeType = e.target.value\n    },\n    getCurShopType(e) {\n      this.curShopType = e.target.value\n    },\n    getCurImgType(e) {\n      this.curImgType = e.target.value\n    },\n    onSubmit() {\n      if (\n        this.curPrizeType === this.PRIZE_TYPE.CUSTOM &&\n        this.shopIds.length === 0\n      ) {\n        this.messageService.warn({\n          content: '请选择门店'\n        })\n        return\n      }\n      this.form.validate().then(value => {\n        value.prize =\n          this.curImgType === this.IMG_TYPE.CUSTOM\n            ? this.fileList[0] || this.prize[0]\n            : this.prize[0]\n        value.support_shop_ids = this.shopIds\n        value.shop_num = this.shopNum\n        value.prize_id = this.info ? this.info.prize_id : 0\n        value.activity_prize_id = this.info ? this.info.activity_prize_id : 0\n        if (this.curPrizeType === this.PRIZE_TYPE.DEFAULT && !value.coupon_id) {\n          this.messageService.warn({\n            content: '请选择优惠券'\n          })\n          return\n        }\n        this.$emit('change', value)\n        this.show = false\n      })\n    }\n  }\n}\n",null]}