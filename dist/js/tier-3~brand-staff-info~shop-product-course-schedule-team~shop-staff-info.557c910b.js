(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["tier-3~brand-staff-info~shop-product-course-schedule-team~shop-staff-info"],{ff31:function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("st-modal",{staticClass:"modal-reserved",attrs:{title:"预约详情",width:"878px"},on:{ok:e.save},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[s("a-row",{attrs:{gutter:24}},[s("a-col",{attrs:{lg:8}},[s("st-info",[s("st-info-item",{attrs:{label:"上课"+e.$c("coach")}},[e._v("\n          "+e._s(e.info.coach_name)+"\n        ")]),s("st-info-item",{attrs:{label:"上课时间"}},[e._v(e._s(e.info.start_time))])],1)],1),s("a-col",{attrs:{lg:8}},[s("st-info",[s("st-info-item",{attrs:{label:"课程名称"}},[e._v(e._s(e.info.course_name))]),s("st-info-item",{attrs:{label:"预约人数"}},[e._v("\n          "+e._s(e.info.reserved_num)+" / "+e._s(e.info.limit_num)+"\n        ")])],1)],1),s("a-col",{attrs:{lg:8}},[s("st-info",[s("st-info-item",{attrs:{label:"上课场地"}},[e._v("\n          "+e._s(e.info.court_name)+"\n          "),e.info.court_site_name?s("span",[e._v("\n            • "+e._s(e.info.court_site_name)+"\n          ")]):e._e()]),s("st-info-item",{attrs:{label:"课时费"}},[e._v(e._s(e.info.course_fee)+"元")])],1)],1)],1),s("a-row",{attrs:{gutter:24}},[s("a-col",{attrs:{lg:24}},[s("st-info",[s("st-info-item",{attrs:{label:"说明"}},[e._v("\n          "+e._s(e.info.description)+"\n          "),+e.info.is_show_description?s("span",{staticClass:"color-text-light"},[e._v("\n            （显示在小程序）\n          ")]):e._e()])],1)],1)],1),s("st-container",{staticClass:"modal-reserved-info__table"},[s("st-form-table",{attrs:{hoverable:""}},[s("thead",[s("tr",e._l(e.columns,(function(t){return s("th",{key:t.dataIndex},[e._v("\n            "+e._s(t.title)+"\n            "),"site_num_list"==t.dataIndex?s("st-help-tooltip",{attrs:{id:"TSGC002"}}):e._e()],1)})),0)]),e.isAdd?s("tbody",[e.list.length<e.info.limit_num?s("tr",[s("td",{staticClass:"mg-l0 st-form-table__add-td",attrs:{width:"140px"}},[s("a-select",{staticStyle:{width:"120px"},attrs:{slot:"member",showSearch:"",placeholder:"搜索会员名",defaultActiveFirstOption:!1,dropdownMatchSelectWidth:!1,showArrow:!1,filterOption:!1,notFoundContent:"无搜索结果"},on:{search:e.onSearch,change:e.onChange},slot:"member"},e._l(e.memberOptions,(function(t){return s("a-select-option",{key:t.id},[s("div",{staticClass:"st-form-table__add-option"},[s("span",{staticClass:"item-name",domProps:{innerHTML:e._s(e.keywordFilter(t))}})])])})),1)],1),s("td",{staticClass:"mg-l0 st-form-table__add-td",attrs:{width:"240px"}},[s("a-select",{staticStyle:{width:"200px"},attrs:{slot:"consume_type",placeholder:"选择消费方式",dropdownMatchSelectWidth:!1},on:{change:e.onChangeConsumeType},slot:"consume_type",model:{value:e.showConsumeType,callback:function(t){e.showConsumeType=t},expression:"showConsumeType"}},e._l(e.consumeOptions,(function(t){return s("a-select-opt-group",{key:t.id},[s("span",{attrs:{slot:"label"},slot:"label"},[s("a-icon",{attrs:{type:"snippets"}}),e._v("\n                  "+e._s(t.name)+"\n                ")],1),e._l(t.children,(function(t){return s("a-select-option",{key:t.id,attrs:{value:JSON.stringify(t)}},[e._v("\n                  "+e._s(t.name)+"\n                ")])}))],2)})),1)],1),s("td",{staticClass:"mg-l0 st-form-table__add-td",attrs:{width:"120px"}},[s("a-select",{staticStyle:{width:"100px"},attrs:{slot:"site_num_list",mode:"multiple",placeholder:"选择座位",maxTagCount:e.brandLimitNum},on:{change:e.onChangeSiteNumList},slot:"site_num_list",model:{value:e.showSite,callback:function(t){e.showSite=t},expression:"showSite"}},e._l(e.unUsedSeatOptions,(function(t){return s("a-select-option",{key:t.id},[e._v("\n                "+e._s(t.name)+"\n              ")])})),1)],1),s("td",{attrs:{width:"120px"}},[s("span",{attrs:{slot:"current_reservation_num"},slot:"current_reservation_num"},[e._v("\n              "+e._s(e.currentReservationNum)+"人\n            ")])]),s("td",{attrs:{width:"120px"}},[e._v("未预约")]),s("td",{attrs:{width:"120px"}},[e._v("未签到")]),s("td",{attrs:{width:"120px"}},[e.infoAuth["shop:reserve:team_course_reserve|add"]?s("a",{attrs:{href:"javascript:;"},on:{click:e.onClickReserve}},[e._v("\n              新增预约\n            ")]):e._e()])]):s("tr",[s("td",{staticClass:"ta-c st-form-table__add-td--disabled",attrs:{colspan:"7"}},[e._v("\n            预约人数已满\n          ")])]),e._l(e.list,(function(t,n){return s("tr",{key:n},[s("td",[e._v(e._s(t.member))]),s("td",[e._v(e._s(t.consume_name))]),s("td",[e._v(e._s(e._f("siteNumListFilter")(t.site_num_list)))]),s("td",[e._v(e._s(t.current_reservation_num)+"人")]),s("td",[e._v(e._s(t.reserve_status_name))]),s("td",[e._v(e._s(t.is_checkin_name))]),s("td",[s("div",[t.auth["shop:reserve:team_course_reserve|del"]?s("st-popconfirm",{attrs:{title:"确认取消预约？"},on:{confirm:function(s){return e.onClickCancel(t.reserve_id)}}},[s("a",{staticClass:"operation"},[e._v("取消预约")])]):e._e(),t.auth["shop:reserve:team_course_reserve|checkin"]?s("st-popconfirm",{attrs:{title:"确认签到消费？"},on:{confirm:function(s){return e.onClickCheckIn(t.reserve_id)}}},[s("a",{staticClass:"operation"},[e._v("签到消费")])]):e._e()],1)])])}))],2):e._e()])],1),s("div",{staticClass:"ta-r",attrs:{slot:"footer"},slot:"footer"},[e.infoAuth["shop:schedule:team_course_schedule|del"]?s("st-button",{staticClass:"mg-r8",on:{click:e.onClickCancelCourse}},[e._v("\n      取消课程\n    ")]):e._e(),e.infoAuth["shop:schedule:team_course_schedule|edit"]?s("st-button",{attrs:{type:"primary"},on:{click:e.onClickEditCourse}},[e._v("\n      修改课程\n    ")]):e._e()],1)],1)},i=[],r=(s("8e6e"),s("456d"),s("bd86")),o=s("75fc"),c=(s("6762"),s("2fdb"),s("7f7f"),s("ac6a"),s("3b2b"),s("a481"),s("28a5"),s("c5f6"),s("d792")),a=s("e69b"),u=s("0ed9"),d=s("d225"),l=s("b0b4"),m=s("9ab4"),h=s("0cd5"),f=s("df29"),p=s("c4cc"),_=(s("6b54"),s("2397"),s("308d")),v=s("6bb5"),b=s("4e2b"),y=s("de46");function S(e){return function(){var t,s=Object(v["a"])(e);if(w()){var n=Object(v["a"])(this).constructor;t=Reflect.construct(s,arguments,n)}else t=s.apply(this,arguments);return Object(_["a"])(this,t)}}function w(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var C,g,O,k=function(e){Object(b["a"])(s,e);var t=S(s);function s(){return Object(d["a"])(this,s),t.apply(this,arguments)}return Object(l["a"])(s,[{key:"add",value:function(e){return this.http.post("/v1/schedule/team/shop/reserve",{params:e})}},{key:"check",value:function(e){return this.http.put("/v1/schedule/team/shop/check",{params:e})}},{key:"getInfo",value:function(e){return this.http.get("/v1/schedule/team/shop/".concat(e))}},{key:"del",value:function(e){return this.http.put("/v1/schedule/team/shop/cancel/".concat(e))}}]),s}(y["a"]),j=s("2cbb"),I=function(){function e(t,s,n){Object(d["a"])(this,e),this.reserveApi=t,this.authService=s,this.msg=n,this.infoAuth$=new f["d"]([]),this.reserveInfo$=new f["d"]({}),this.reserveList$=new f["d"]([]),this.auth$=this.authService.authMap$({add:"shop:reserve:team_course_reserve|add",cancel:"shop:reserve:team_course_reserve|del",checkIn:"shop:reserve:team_course_reserve|checkin"})}return Object(l["a"])(e,[{key:"add",value:function(e){var t=this;return this.reserveApi.add(e).pipe(Object(p["a"])((function(e){t.msg.success({content:"新增预约成功！！！"})})))}},{key:"check",value:function(e){var t=this;return this.reserveApi.check(e).pipe(Object(p["a"])((function(e){t.msg.success({content:"签到消费成功"})})))}},{key:"getInfo",value:function(e){var t=this;return this.reserveApi.getInfo(e).pipe(Object(p["a"])((function(e){t.infoAuth$.commit((function(){return e.auth})),t.reserveInfo$.commit((function(){return e.info})),t.reserveList$.commit((function(){return e.list}))})))}},{key:"del",value:function(e){var t=this;return this.reserveApi.del(e).pipe(Object(p["a"])((function(e){t.msg.success({content:"取消预约成功"})})))}}]),e}();Object(m["b"])([Object(f["c"])(),Object(m["d"])("design:type",Function),Object(m["d"])("design:paramtypes",[String]),Object(m["d"])("design:returntype",void 0)],I.prototype,"getInfo",null),I=Object(m["b"])([Object(h["b"])(),Object(m["d"])("design:paramtypes",["function"===typeof(C="undefined"!==typeof k&&k)?C:Object,"function"===typeof(g="undefined"!==typeof j["a"]&&j["a"])?g:Object,"function"===typeof(O="undefined"!==typeof a["a"]&&a["a"])?O:Object])],I);var x=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("st-modal",{attrs:{title:"预约详情",width:"848px"},on:{ok:e.save},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[s("div",{staticClass:"modal-cancel-course"},[s("st-t3",{staticClass:"mg-b16"},[e._v("是否取消课程?")]),s("p",{staticClass:"tip"},[e._v("将发送消息通知已报名用户并发起自动退款")])],1)])},R=[],N=s("82f5"),$={name:"CancelCourse",serviceInject:function(){return{teamScheduleService:N["a"]}},rxState:function(){return{}},data:function(){return{show:!1}},props:{id:{type:Number,defalut:-1}},methods:{save:function(){var e=this;this.teamScheduleService.del(this.id).subscribe((function(t){e.$router.push({query:e.$searchQuery}),e.show=!1}))}}},T=$,A=s("2877"),L=Object(A["a"])(T,x,R,!1,null,null,null),E=L.exports,P=s("335e");function D(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function F(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?D(Object(s),!0).forEach((function(t){Object(r["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):D(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var M={name:"ReserveInfo",modals:{ScheduleTeamCancelCourse:E,ScheduleTeamEditCourse:P["a"]},serviceInject:function(){return{teamScheduleCommonService:u["a"],teamScheduleReserveService:I,messageService:a["a"]}},rxState:function(){var e=this.teamScheduleCommonService;return{infoAuth:this.teamScheduleReserveService.infoAuth$,memberOptions:e.memberOptions$,consumeOptions:e.consumeOptions$,unUsedSeatOptions:e.unUsedSeatOptions$}},props:{id:Number},filters:{siteNumListFilter:function(e){return e.split(",").map((function(e){return"0"===e?"无座位":e})).join(",")}},data:function(){return{isAdd:!0,showConsumeType:"",memberId:"",showSite:[],consumeType:"",keyword:"",effectiveState:1,consumeName:"",consumeId:"",consumeTypeId:"",siteNumIds:[],currentReservationNum:0,columns:[{title:"会员姓名",dataIndex:"member",width:10,scopedSlots:{customRender:"member"}},{title:"消费方式",dataIndex:"consume_type",scopedSlots:{customRender:"consume_type"}},{title:"座位号",dataIndex:"site_num_list",scopedSlots:{customRender:"site_num_list"}},{title:"预约人数",dataIndex:"current_reservation_num",scopedSlots:{customRender:"current_reservation_num"}},{title:"预约状态",dataIndex:"reserve_status",scopedSlots:{customRender:"reserve_status"}},{title:"签到状态",dataIndex:"is_checkin"},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],dataSource:[],show:!1,info:{},list:[]}},computed:{courseId:function(){return this.info.course_id},scheduleId:function(){return this.info.id},courtSiteId:function(){return this.info.court_site_id},brandLimitNum:function(){return this.info.brand_limit_num}},methods:{keywordFilter:function(e){var t;return t=1===e.is_minors?"".concat(e.member_name,"(未成年) ").concat(e.parent_mobile,"(").concat(e.parent_user_role,")").replace(new RegExp(this.keyword),'<span class="color-primary">'.concat(this.keyword,"</span>")):"".concat(e.member_name," ").concat(e.mobile).replace(new RegExp(this.keyword),'<span class="color-primary">'.concat(this.keyword,"</span>")),t},onClickCancelCourse:function(){this.$modalRouter.push({name:"schedule-team-cancel-course",props:{id:this.info.id}}),this.show=!1},onClickEditCourse:function(){var e=this;this.$modalRouter.push({name:"schedule-team-edit-course",props:{id:this.info.id},on:{ok:function(){e.$router.reload()}}}),this.show=!1},onSearch:function(e){this.keyword=e,this.teamScheduleCommonService.getMemberList({member:e}).subscribe()},onClickCancel:function(e){var t=this;this.teamScheduleReserveService.del(e).subscribe((function(){t.getReserve()}))},onClickCheckIn:function(e){var t=this;this.teamScheduleReserveService.check({id:e,checkin_method:2}).subscribe((function(){t.getReserve()}))},getMemberName:function(e){var t="";return this.memberOptions.forEach((function(s){s.id===e&&(t=s.member_name)})),t},onChange:function(e){this.memberId=e,this.showConsumeType="",this.memberName=this.getMemberName(e),this.teamScheduleCommonService.getConsumeList({schedule_id:this.scheduleId,course_id:this.courseId,member_id:e}).subscribe()},onChangeConsumeType:function(e){var t=JSON.parse(e);this.consumeType=t.consume_type,this.effectiveState=0===t.effective_state?0:1,this.consumeName=t.name,this.consumeId=t.id},onChangeSiteNumList:function(e){var t=this;if(e.length>this.brandLimitNum){this.messageService.error({content:"最多预约".concat(this.brandLimitNum,"个座位")});var s=this.showSite.length;this.showSite=this.showSite.slice(0,s-1)}else{var n=this.unUsedSeatOptions.map((function(e){return"无座位"===e.name?e.id:-1})).filter((function(e){return-1!==e}));this.siteNumIds=e.map((function(e){var s;return t.unUsedSeatOptions.forEach((function(t){e===t.id&&"无座位"!==t.name&&(s=t.name)})),n.includes(e)?-1:s})),this.currentReservationNum=this.showSite.length}},add:function(){var e=this,t={schedule_id:this.id,member_id:this.memberId,seat:this.siteNumIds,consume_type:this.consumeType,consume_id:this.consumeId};this.currentReservationNum=0,this.isAdd=!1,this.teamScheduleReserveService.add(t).subscribe((function(){e.isAdd=!0,e.showSite=[],e.siteNumIds=[],e.consumeType="",e.showConsumeType="",e.memberId="",e.getReserve()}),(function(t){e.isAdd=!0,e.showSite=[],e.siteNumIds=[],e.consumeType="",e.showConsumeType="",e.memberId=""}))},onClickReserve:function(){var e=this;this.effectiveState?this.add():this.$confirm({title:"",content:"新增预约后, ".concat(this.memberName,"的课程包").concat(this.consumeName.split("(")[0],"会立即生效，确认新增?"),onOk:function(){e.add(),e.effectiveState=1},onCancel:function(){},class:"test"})},edit:function(e){var t=Object(o["a"])(this.data),s=t.filter((function(t){return e===t.key}))[0];s&&(s.editable=!0,this.data=t),s.editable=!0,this.data=t},save:function(e){var t=Object(o["a"])(this.data),s=t.filter((function(t){return e===t.key}))[0];s&&(delete s.editable,this.data=t,this.cacheData=t.map((function(e){return F({},e)})))},getReserve:function(){var e=this,t=this.teamScheduleReserveService;t.getInfo(this.id).pipe(Object(c["a"])((function(t){return e.info=t.info,e.list=t.list,e.teamScheduleCommonService.getUnusedSeatList({schedule_id:t.info.id,court_site_id:t.info.court_site_id})}))).subscribe()}},mounted:function(){this.getReserve()}},U=M,J=Object(A["a"])(U,n,i,!1,null,null,null);t["a"]=J.exports}}]);