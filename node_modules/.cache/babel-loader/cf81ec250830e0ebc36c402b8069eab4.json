{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/course/manage/package/edit-unlimit-package.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/product/course/manage/package/edit-unlimit-package.vue","mtime":1600926382466},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport { cloneDeep, remove } from 'lodash-es';\nimport { EditUnlimitPackageService } from \"./edit-unlimit-package.service\";\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue';\nexport default {\n  name: 'ShopUnlimitPackageEdit',\n  serviceInject: function serviceInject() {\n    return {\n      editPackageService: EditUnlimitPackageService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      transferUnitList: this.editPackageService.transferUnitList$,\n      sellTypeList: this.editPackageService.sellTypeList$,\n      unitList: this.editPackageService.unitList$,\n      editLoading: this.editPackageService.loading$,\n      packageInfo: this.editPackageService.packageInfo$\n    };\n  },\n  components: {\n    StImageUpload: StImageUpload\n  },\n  bem: {\n    add: 'page-shop-add-unlimit-package',\n    basic: 'page-shop-add-basic-package'\n  },\n  data: function data() {\n    return {\n      packageData: {\n        // 是否支持团体课 0为不支持 1为支持\n        is_team: 0,\n        // 团体课总节数\n        team_times: undefined,\n        // 团体课单价\n        team_unit_price: undefined,\n        // 是否支持私教课 0为不支持 1为支持\n        is_personal: 0,\n        // 私教课总节数\n        personal_times: undefined,\n        // 私教课单价\n        personal_unit_price: undefined,\n        // 售价\n        price: undefined,\n        // 售卖开始时间\n        start_time: '',\n        // 售卖截止时间\n        end_time: '',\n        // 有效时间值\n        valid_time: undefined,\n        // 有效时间单位 1:天 2:月 3:年\n        valid_time_unit: 1,\n        // 允许冻结天数\n        frozen_days: undefined,\n        // 是否可以转让: 0 不可以 1 可以\n        is_allow_transfer: 0,\n        // 转让费率\n        transfer_rate: undefined,\n        // 转让单位 1:百分比 2:元\n        transfer_unit: 1,\n        // 售卖方式\n        sale_mode: [2],\n        // 封面对象\n        image: {\n          image_id: null,\n          image_key: ''\n        },\n        // 课程包介绍\n        intro: '',\n        // 备注\n        remarks: ''\n      },\n      form: this.$form.createForm(this),\n      start_time: null,\n      end_time: null,\n      endOpen: false,\n      // 课程范围是否未输入过\n      courseIsFirstInput: true,\n      // 课程范围是否未配置\n      courseIsNone: false,\n      courseErrorText: '',\n      // 是否未传了封面\n      imageIsNone: false,\n      imageErrorText: '',\n      fileList: [],\n      cropperModal: {}\n    };\n  },\n  mounted: function mounted() {\n    this.init();\n  },\n  methods: {\n    init: function init() {\n      if (!this.packageInfo.is_allow_transfer) {\n        this.packageInfo.transfer_rate = undefined;\n      }\n\n      if (!this.packageInfo.is_team) {\n        this.packageInfo.team_times = undefined;\n        this.packageInfo.team_unit_price = undefined;\n      }\n\n      if (!this.packageInfo.is_personal) {\n        this.packageInfo.personal_times = undefined;\n        this.packageInfo.personal_unit_price = undefined;\n      }\n\n      this.form.setFieldsValue({\n        price: this.packageInfo.price,\n        start_time: moment(this.packageInfo.start_time * 1000),\n        end_time: moment(this.packageInfo.end_time * 1000),\n        valid_time: this.packageInfo.valid_time,\n        frozen_days: this.packageInfo.frozen_days,\n        transfer_rate: this.packageInfo.transfer_rate\n      }); // 课程范围\n\n      this.packageData.is_team = this.packageInfo.is_team;\n      this.packageData.team_times = this.packageInfo.team_times;\n      this.packageData.team_unit_price = this.packageInfo.team_unit_price;\n      this.packageData.is_personal = this.packageInfo.is_personal;\n      this.packageData.personal_times = this.packageInfo.personal_times;\n      this.packageData.personal_unit_price = this.packageInfo.personal_unit_price; // 售卖时间\n\n      this.start_time = moment(this.packageInfo.start_time * 1000);\n      this.end_time = moment(this.packageInfo.end_time * 1000); // 有效时间单位\n\n      this.packageData.valid_time_unit = this.packageInfo.valid_time_unit; // 转让设置\n\n      this.packageData.is_allow_transfer = this.packageInfo.is_allow_transfer;\n      this.packageData.transfer_unit = this.packageInfo.transfer_unit; // 售卖方式\n\n      this.packageData.sale_mode = this.packageInfo.sale_mode; // 封面\n\n      this.fileList = [this.packageInfo.image];\n      this.packageData.image.image_id = this.fileList[0].image_id;\n      this.packageData.image.image_key = this.fileList[0].image_key;\n      this.imageIsNone = false;\n      this.imageErrorText = ''; // 介绍\n\n      this.packageData.intro = this.packageInfo.intro; // 备注\n\n      this.packageData.remarks = this.packageInfo.remarks;\n    },\n    // 保存\n    save: function save() {\n      var _this = this;\n\n      this.course_validator();\n      this.image_validator();\n      this.form.validateFieldsAndScroll(function (err, values) {\n        if (!err && !_this.courseIsNone && !_this.imageIsNone) {\n          _this.packageData.price = values.price;\n          _this.packageData.valid_time = values.valid_time;\n          _this.packageData.frozen_days = values.frozen_days;\n          _this.packageData.transfer_rate = _this.packageData.is_allow_transfer ? +values.transfer_rate : undefined;\n          _this.packageData.start_time = \"\".concat(_this.start_time.format('YYYY-MM-DD'));\n          _this.packageData.end_time = \"\".concat(_this.end_time.format('YYYY-MM-DD'));\n          _this.packageData.album_id = _this.packageInfo.album_id;\n          _this.packageData.team_unit_price = +_this.packageData.team_unit_price;\n          _this.packageData.personal_unit_price = +_this.packageData.personal_unit_price;\n\n          _this.editPackageService.editPackage(_this.packageData).subscribe(function (res) {\n            _this.$router.push({\n              path: '/shop/product/course/manage/package/list'\n            });\n          });\n        }\n      });\n    },\n    // course validatorFn\n    course_validator: function course_validator() {\n      this.courseIsFirstInput = false;\n      var teamIsOk = this.packageData.is_team ? !!this.team_total : true;\n      var personalIsOk = this.packageData.is_personal ? !!this.personal_total : true;\n\n      if (teamIsOk && personalIsOk && !(!this.packageData.is_team && !this.packageData.is_personal)) {\n        // 校验通过\n        this.courseIsNone = false;\n        this.courseErrorText = '';\n      } else {\n        // 校验未通过\n        this.courseIsNone = true;\n        this.courseErrorText = '请输入上课范围';\n      }\n    },\n    // image validatorFn\n    image_validator: function image_validator() {\n      if (this.packageData.image.image_key !== '') {\n        // 校验通过\n        this.imageIsNone = false;\n        this.imageErrorText = '';\n      } else {\n        // 校验未通过\n        this.imageIsNone = true;\n        this.imageErrorText = '请上传封面';\n      }\n    },\n    // checkboxChange\n    teamCheckboxChange: function teamCheckboxChange(e) {\n      this.packageData.is_team = +e.target.checked;\n      this.courseIsFirstInput = false;\n    },\n    personalCheckboxChange: function personalCheckboxChange(e) {\n      this.packageData.is_personal = +e.target.checked;\n      this.courseIsFirstInput = false;\n    },\n    // 转让\n    transfer: function transfer(e) {\n      this.packageData.is_allow_transfer = +e.target.checked; // 重置转让费用的校验\n\n      this.packageData.transfer_rate = undefined;\n      this.form.resetFields(['transfer_rate']);\n    },\n    fileChange: function fileChange(data) {\n      if (data.length) {\n        // 上传\n        this.packageData.image.image_id = data[0].image_id;\n        this.packageData.image.image_key = data[0].image_key;\n        this.imageIsNone = false;\n        this.imageErrorText = '';\n      } else {\n        // 删除\n        this.packageData.image.image_id = null;\n        this.packageData.image.image_key = '';\n        this.imageIsNone = true;\n        this.imageErrorText = '请上传封面';\n      }\n    },\n    transferUnitChange: function transferUnitChange() {\n      this.packageData.transfer_rate = undefined;\n      this.form.setFieldsValue({\n        transfer_rate: undefined\n      });\n    },\n    // start_time validatorFn\n    start_time_validator: function start_time_validator(rule, value, callback) {\n      if (!value) {\n        // eslint-disable-next-line\n        callback('请选择开始售卖时间');\n      } else {\n        // eslint-disable-next-line\n        callback();\n      }\n    },\n    // end_time validatorFn\n    end_time_validator: function end_time_validator(rule, value, callback) {\n      if (!value) {\n        // eslint-disable-next-line\n        callback('请选择结束售卖时间');\n      } else {\n        // eslint-disable-next-line\n        callback();\n      }\n    },\n    // 售卖时间-start\n    start_time_change: function start_time_change(data) {\n      this.start_time = cloneDeep(data);\n    },\n    handleStartOpenChange: function handleStartOpenChange(open) {\n      if (!open) {\n        this.endOpen = true;\n      }\n    },\n    disabledStartDate: function disabledStartDate(startValue) {\n      var endValue = this.end_time;\n\n      if (!endValue) {\n        // 结束时间未选择\n        return startValue.valueOf() < moment().startOf('day').valueOf();\n      }\n\n      var start = endValue.valueOf() > moment().add(30, 'y').valueOf() ? moment(endValue).subtract(30, 'y').valueOf() : moment().startOf('day').valueOf();\n      return startValue.valueOf() < start || startValue.valueOf() > moment(endValue).valueOf();\n    },\n    // 售卖时间-end\n    end_time_change: function end_time_change(data) {\n      this.end_time = cloneDeep(data);\n    },\n    handleEndOpenChange: function handleEndOpenChange(open) {\n      this.endOpen = open;\n    },\n    disabledEndDate: function disabledEndDate(endValue) {\n      var startValue = this.start_time;\n\n      if (!startValue) {\n        // 开始时间未选择\n        return endValue.valueOf() < moment().startOf('day').valueOf();\n      }\n\n      return endValue.valueOf() >= moment(startValue).add(30, 'y').valueOf() || endValue.valueOf() < moment(startValue).valueOf() || endValue.valueOf() < moment().startOf('day').valueOf();\n    },\n    // moment\n    moment: moment\n  },\n  computed: {\n    // 团课小计\n    team_total: function team_total() {\n      if (+this.packageData.team_times && +this.packageData.team_unit_price) {\n        return this.packageData.team_times * (this.packageData.team_unit_price * 10) / 10;\n      } else {\n        return 0;\n      }\n    },\n    // 私教小计\n    personal_total: function personal_total() {\n      if (+this.packageData.personal_times && +this.packageData.personal_unit_price) {\n        return this.packageData.personal_times * (this.packageData.personal_unit_price * 10) / 10;\n      } else {\n        return 0;\n      }\n    },\n    // 总价\n    all_total: function all_total() {\n      var teamTotal = this.packageData.is_team ? this.team_total : 0;\n      var personalTotal = this.packageData.is_personal ? this.personal_total : 0;\n      return teamTotal + personalTotal;\n    }\n  }\n};",{"version":3,"sources":["edit-unlimit-package.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-panel app :class=\"basic()\" class=\"page-shop-add-unlimit-package\">\n    <st-form :form=\"form\" labelWidth=\"96px\">\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"课程包名称\" required>\n            {{ packageInfo.course_name }}\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"18\" :xs=\"22\" :offset=\"1\">\n          <st-form-item\n            :class=\"{ 'st-has-error': !courseIsFirstInput && courseIsNone }\"\n            :help=\"courseErrorText\"\n            required\n          >\n            <template slot=\"label\">\n              上课范围\n              <st-help-tooltip id=\"TSCPCF001\" />\n            </template>\n            <div :class=\"add('course')\">\n              <st-form-table>\n                <colgroup>\n                  <col style=\"width:8%;\" />\n                  <col style=\"width:16%;\" />\n                  <col style=\"width:27%;\" />\n                  <col style=\"width:28%;\" />\n                  <col style=\"width:21%;\" />\n                </colgroup>\n                <tr class=\"bg-thead table-header\">\n                  <th></th>\n                  <th>课程类型</th>\n                  <th>节数</th>\n                  <th>课时费</th>\n                  <th>小计</th>\n                </tr>\n                <tbody>\n                  <tr class=\"bg-row-team\">\n                    <td class=\"tg-c\">\n                      <a-checkbox\n                        :defaultChecked=\"!!packageInfo.is_team\"\n                        @change=\"teamCheckboxChange\"\n                      />\n                    </td>\n                    <td>团体课程</td>\n                    <td class=\"pr-32\">\n                      <st-input-number\n                        :min=\"1\"\n                        :max=\"99999\"\n                        @change=\"courseIsFirstInput = false\"\n                        v-model=\"packageData.team_times\"\n                        :disabled=\"packageData.is_team === 0\"\n                      >\n                        <template slot=\"addonAfter\">\n                          节\n                        </template>\n                      </st-input-number>\n                    </td>\n                    <td class=\"pr-32\">\n                      <st-input-number\n                        :min=\"0\"\n                        :max=\"99999.9\"\n                        @change=\"courseIsFirstInput = false\"\n                        v-model=\"packageData.team_unit_price\"\n                        :float=\"true\"\n                        :disabled=\"packageData.is_team === 0\"\n                      >\n                        <template slot=\"addonAfter\">\n                          元\n                        </template>\n                      </st-input-number>\n                    </td>\n                    <td>{{ team_total }}</td>\n                  </tr>\n                  <tr class=\"bg-row-personal\">\n                    <td class=\"tg-c\">\n                      <a-checkbox\n                        :defaultChecked=\"!!packageInfo.is_personal\"\n                        @change=\"personalCheckboxChange\"\n                      />\n                    </td>\n                    <td>私教课程</td>\n                    <td class=\"pr-32\">\n                      <st-input-number\n                        :min=\"1\"\n                        :max=\"99999\"\n                        @change=\"courseIsFirstInput = false\"\n                        v-model=\"packageData.personal_times\"\n                        :disabled=\"packageData.is_personal === 0\"\n                      >\n                        <template slot=\"addonAfter\">\n                          节\n                        </template>\n                      </st-input-number>\n                    </td>\n                    <td class=\"pr-32\">\n                      <st-input-number\n                        :min=\"0\"\n                        :max=\"99999.9\"\n                        @change=\"courseIsFirstInput = false\"\n                        v-model=\"packageData.personal_unit_price\"\n                        :float=\"true\"\n                        :disabled=\"packageData.is_personal === 0\"\n                      >\n                        <template slot=\"addonAfter\">\n                          元\n                        </template>\n                      </st-input-number>\n                    </td>\n                    <td>{{ personal_total }}</td>\n                  </tr>\n                </tbody>\n              </st-form-table>\n            </div>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"总价\">{{ all_total }}元</st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"售卖价格\" required>\n            <st-input-number\n              placeholder=\"请输入售卖价格\"\n              :min=\"0\"\n              :max=\"99999.9\"\n              v-decorator=\"[\n                'price',\n                { rules: [{ required: true, message: '请输入售卖价格' }] }\n              ]\"\n              :float=\"true\"\n            >\n              <template slot=\"addonAfter\">\n                元\n              </template>\n            </st-input-number>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item class=\"mg-b0\" label=\"支持售卖时间\" required>\n            <div :class=\"basic('saletime')\">\n              <a-form-item class=\"page-a-form\">\n                <a-date-picker\n                  style=\"width: 100%;\"\n                  :disabledDate=\"disabledStartDate\"\n                  v-decorator=\"[\n                    'start_time',\n                    { rules: [{ validator: start_time_validator }] }\n                  ]\"\n                  format=\"YYYY-MM-DD\"\n                  placeholder=\"开始时间\"\n                  :showToday=\"false\"\n                  @openChange=\"handleStartOpenChange\"\n                  @change=\"start_time_change\"\n                />\n              </a-form-item>\n              <span>~</span>\n              <a-form-item class=\"page-a-form\">\n                <a-date-picker\n                  :disabledDate=\"disabledEndDate\"\n                  v-decorator=\"[\n                    'end_time',\n                    { rules: [{ validator: end_time_validator }] }\n                  ]\"\n                  format=\"YYYY-MM-DD\"\n                  placeholder=\"结束时间\"\n                  :showToday=\"false\"\n                  :open=\"endOpen\"\n                  @openChange=\"handleEndOpenChange\"\n                  @change=\"end_time_change\"\n                />\n              </a-form-item>\n            </div>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"有效时间\" required>\n            <st-input-number\n              placeholder=\"请输入有效时间\"\n              :min=\"1\"\n              :max=\"99999\"\n              v-decorator=\"[\n                'valid_time',\n                {\n                  initialValue: null,\n                  rules: [{ required: true, message: '请输入有效时间' }]\n                }\n              ]\"\n            >\n              <a-select\n                v-model=\"packageData.valid_time_unit\"\n                slot=\"addonAfter\"\n                style=\"width: 60px\"\n              >\n                <a-select-option\n                  v-for=\"(item, index) in unitList\"\n                  :value=\"item.value\"\n                  :key=\"index\"\n                >\n                  {{ item.label }}\n                </a-select-option>\n              </a-select>\n            </st-input-number>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"允许冻结天数\" required>\n            <st-input-number\n              placeholder=\"请输入允许冻结天数\"\n              :min=\"1\"\n              :max=\"99999\"\n              v-decorator=\"[\n                'frozen_days',\n                {\n                  initialValue: null,\n                  rules: [{ required: true, message: '请输入允许冻结天数' }]\n                }\n              ]\"\n            >\n              <template slot=\"addonAfter\">\n                天\n              </template>\n            </st-input-number>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"转让设置\">\n            <div :class=\"basic('transfer')\">\n              <a-checkbox\n                :class=\"basic('transfer-checkbox')\"\n                :defaultChecked=\"!!packageInfo.is_allow_transfer\"\n                @change=\"transfer\"\n              >\n                支持转让\n              </a-checkbox>\n              <st-input-number\n                :min=\"0\"\n                :max=\"packageData.transfer_unit === 1 ? 100 : 99999.9\"\n                v-decorator=\"[\n                  'transfer_rate',\n                  {\n                    rules: [\n                      {\n                        initialValue: null,\n                        required: packageData.is_allow_transfer !== 0,\n                        message: '请输入转让值数值'\n                      }\n                    ]\n                  }\n                ]\"\n                :disabled=\"packageData.is_allow_transfer === 0\"\n                :float=\"packageData.transfer_unit === 2\"\n                :class=\"basic('transfer-input')\"\n                style=\"padding-right:0;\"\n              >\n                <a-select\n                  :disabled=\"packageData.is_allow_transfer === 0\"\n                  slot=\"addonAfter\"\n                  @change=\"transferUnitChange\"\n                  v-model=\"packageData.transfer_unit\"\n                  style=\"width: 60px\"\n                >\n                  <a-select-option\n                    v-for=\"item in transferUnitList\"\n                    :key=\"item.value\"\n                    :value=\"+item.value\"\n                  >\n                    {{ item.label }}\n                  </a-select-option>\n                </a-select>\n              </st-input-number>\n            </div>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"售卖方式\" required>\n            <a-checkbox-group v-model=\"packageData.sale_mode\">\n              <a-checkbox\n                v-for=\"item in sellTypeList\"\n                :key=\"item.value\"\n                :disabled=\"item.value === 2\"\n                :value=\"item.value\"\n              >\n                {{ item.label }}\n              </a-checkbox>\n            </a-checkbox-group>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"22\" :xs=\"22\" :offset=\"1\">\n          <st-form-item\n            validate-status=\"error\"\n            :help=\"imageErrorText\"\n            label=\"封面\"\n            required\n          >\n            <div :class=\"basic('upload')\">\n              <st-image-upload\n                :class=\"basic('st-upload')\"\n                :cropperModal=\"cropperModal\"\n                :sizeLimit=\"5\"\n                :list=\"fileList\"\n                @change=\"fileChange\"\n              >\n                <i :class=\"basic('st-upload-icon')\"></i>\n                <div :class=\"basic('st-upload-text')\">上传封面</div>\n              </st-image-upload>\n              <div :class=\"basic('upload-describe')\">\n                <p>\n                  图片格式必须为:png,bmp,jpeg,jpg,gif,建议使用png格式图片,以保存最佳效果\n                </p>\n                <p>建议尺寸为750像素X422像素,不可大于2m</p>\n              </div>\n            </div>\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"课程包介绍\">\n            <st-textarea\n              v-model=\"packageData.intro\"\n              :maxlength=\"500\"\n              class=\"page-content-card-textarea\"\n              placeholder=\"请输入课程包介绍\"\n            />\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\"备注\">\n            <st-textarea\n              v-model=\"packageData.remarks\"\n              :maxlength=\"500\"\n              class=\"page-content-card-textarea\"\n              placeholder=\"请输入备注\"\n            />\n          </st-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"8\">\n        <a-col :lg=\"10\" :xs=\"22\" :offset=\"1\">\n          <st-form-item label=\" \">\n            <st-button\n              type=\"primary\"\n              class=\"mr-8\"\n              @click=\"save\"\n              :loading=\"editLoading.editPackage\"\n            >\n              保存\n            </st-button>\n          </st-form-item>\n        </a-col>\n      </a-row>\n    </st-form>\n  </st-panel>\n</template>\n<script>\nimport moment from 'moment'\nimport { cloneDeep, remove } from 'lodash-es'\nimport { EditUnlimitPackageService } from './edit-unlimit-package.service'\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue'\nexport default {\n  name: 'ShopUnlimitPackageEdit',\n  serviceInject() {\n    return {\n      editPackageService: EditUnlimitPackageService\n    }\n  },\n  rxState() {\n    return {\n      transferUnitList: this.editPackageService.transferUnitList$,\n      sellTypeList: this.editPackageService.sellTypeList$,\n      unitList: this.editPackageService.unitList$,\n      editLoading: this.editPackageService.loading$,\n      packageInfo: this.editPackageService.packageInfo$\n    }\n  },\n  components: {\n    StImageUpload\n  },\n  bem: {\n    add: 'page-shop-add-unlimit-package',\n    basic: 'page-shop-add-basic-package'\n  },\n  data() {\n    return {\n      packageData: {\n        // 是否支持团体课 0为不支持 1为支持\n        is_team: 0,\n        // 团体课总节数\n        team_times: undefined,\n        // 团体课单价\n        team_unit_price: undefined,\n        // 是否支持私教课 0为不支持 1为支持\n        is_personal: 0,\n        // 私教课总节数\n        personal_times: undefined,\n        // 私教课单价\n        personal_unit_price: undefined,\n        // 售价\n        price: undefined,\n        // 售卖开始时间\n        start_time: '',\n        // 售卖截止时间\n        end_time: '',\n        // 有效时间值\n        valid_time: undefined,\n        // 有效时间单位 1:天 2:月 3:年\n        valid_time_unit: 1,\n        // 允许冻结天数\n        frozen_days: undefined,\n        // 是否可以转让: 0 不可以 1 可以\n        is_allow_transfer: 0,\n        // 转让费率\n        transfer_rate: undefined,\n        // 转让单位 1:百分比 2:元\n        transfer_unit: 1,\n        // 售卖方式\n        sale_mode: [2],\n        // 封面对象\n        image: {\n          image_id: null,\n          image_key: ''\n        },\n        // 课程包介绍\n        intro: '',\n        // 备注\n        remarks: ''\n      },\n      form: this.$form.createForm(this),\n      start_time: null,\n      end_time: null,\n      endOpen: false,\n      // 课程范围是否未输入过\n      courseIsFirstInput: true,\n      // 课程范围是否未配置\n      courseIsNone: false,\n      courseErrorText: '',\n      // 是否未传了封面\n      imageIsNone: false,\n      imageErrorText: '',\n      fileList: [],\n      cropperModal: {}\n    }\n  },\n  mounted() {\n    this.init()\n  },\n  methods: {\n    init() {\n      if (!this.packageInfo.is_allow_transfer) {\n        this.packageInfo.transfer_rate = undefined\n      }\n      if (!this.packageInfo.is_team) {\n        this.packageInfo.team_times = undefined\n        this.packageInfo.team_unit_price = undefined\n      }\n      if (!this.packageInfo.is_personal) {\n        this.packageInfo.personal_times = undefined\n        this.packageInfo.personal_unit_price = undefined\n      }\n      this.form.setFieldsValue({\n        price: this.packageInfo.price,\n        start_time: moment(this.packageInfo.start_time * 1000),\n        end_time: moment(this.packageInfo.end_time * 1000),\n        valid_time: this.packageInfo.valid_time,\n        frozen_days: this.packageInfo.frozen_days,\n        transfer_rate: this.packageInfo.transfer_rate\n      })\n      // 课程范围\n      this.packageData.is_team = this.packageInfo.is_team\n      this.packageData.team_times = this.packageInfo.team_times\n      this.packageData.team_unit_price = this.packageInfo.team_unit_price\n      this.packageData.is_personal = this.packageInfo.is_personal\n      this.packageData.personal_times = this.packageInfo.personal_times\n      this.packageData.personal_unit_price = this.packageInfo.personal_unit_price\n      // 售卖时间\n      this.start_time = moment(this.packageInfo.start_time * 1000)\n      this.end_time = moment(this.packageInfo.end_time * 1000)\n      // 有效时间单位\n      this.packageData.valid_time_unit = this.packageInfo.valid_time_unit\n      // 转让设置\n      this.packageData.is_allow_transfer = this.packageInfo.is_allow_transfer\n      this.packageData.transfer_unit = this.packageInfo.transfer_unit\n      // 售卖方式\n      this.packageData.sale_mode = this.packageInfo.sale_mode\n      // 封面\n      this.fileList = [this.packageInfo.image]\n      this.packageData.image.image_id = this.fileList[0].image_id\n      this.packageData.image.image_key = this.fileList[0].image_key\n      this.imageIsNone = false\n      this.imageErrorText = ''\n      // 介绍\n      this.packageData.intro = this.packageInfo.intro\n      // 备注\n      this.packageData.remarks = this.packageInfo.remarks\n    },\n    // 保存\n    save() {\n      this.course_validator()\n      this.image_validator()\n      this.form.validateFieldsAndScroll((err, values) => {\n        if (!err && !this.courseIsNone && !this.imageIsNone) {\n          this.packageData.price = values.price\n          this.packageData.valid_time = values.valid_time\n          this.packageData.frozen_days = values.frozen_days\n          this.packageData.transfer_rate = this.packageData.is_allow_transfer\n            ? +values.transfer_rate\n            : undefined\n          this.packageData.start_time = `${this.start_time.format(\n            'YYYY-MM-DD'\n          )}`\n          this.packageData.end_time = `${this.end_time.format('YYYY-MM-DD')}`\n          this.packageData.album_id = this.packageInfo.album_id\n          this.packageData.team_unit_price = +this.packageData.team_unit_price\n          this.packageData.personal_unit_price = +this.packageData\n            .personal_unit_price\n          this.editPackageService\n            .editPackage(this.packageData)\n            .subscribe(res => {\n              this.$router.push({\n                path: '/shop/product/course/manage/package/list'\n              })\n            })\n        }\n      })\n    },\n    // course validatorFn\n    course_validator() {\n      this.courseIsFirstInput = false\n      let teamIsOk = this.packageData.is_team ? !!this.team_total : true\n      let personalIsOk = this.packageData.is_personal\n        ? !!this.personal_total\n        : true\n      if (\n        teamIsOk &&\n        personalIsOk &&\n        !(!this.packageData.is_team && !this.packageData.is_personal)\n      ) {\n        // 校验通过\n        this.courseIsNone = false\n        this.courseErrorText = ''\n      } else {\n        // 校验未通过\n        this.courseIsNone = true\n        this.courseErrorText = '请输入上课范围'\n      }\n    },\n    // image validatorFn\n    image_validator() {\n      if (this.packageData.image.image_key !== '') {\n        // 校验通过\n        this.imageIsNone = false\n        this.imageErrorText = ''\n      } else {\n        // 校验未通过\n        this.imageIsNone = true\n        this.imageErrorText = '请上传封面'\n      }\n    },\n    // checkboxChange\n    teamCheckboxChange(e) {\n      this.packageData.is_team = +e.target.checked\n      this.courseIsFirstInput = false\n    },\n    personalCheckboxChange(e) {\n      this.packageData.is_personal = +e.target.checked\n      this.courseIsFirstInput = false\n    },\n    // 转让\n    transfer(e) {\n      this.packageData.is_allow_transfer = +e.target.checked\n      // 重置转让费用的校验\n      this.packageData.transfer_rate = undefined\n      this.form.resetFields(['transfer_rate'])\n    },\n    fileChange(data) {\n      if (data.length) {\n        // 上传\n        this.packageData.image.image_id = data[0].image_id\n        this.packageData.image.image_key = data[0].image_key\n        this.imageIsNone = false\n        this.imageErrorText = ''\n      } else {\n        // 删除\n        this.packageData.image.image_id = null\n        this.packageData.image.image_key = ''\n        this.imageIsNone = true\n        this.imageErrorText = '请上传封面'\n      }\n    },\n    transferUnitChange() {\n      this.packageData.transfer_rate = undefined\n      this.form.setFieldsValue({\n        transfer_rate: undefined\n      })\n    },\n    // start_time validatorFn\n    start_time_validator(rule, value, callback) {\n      if (!value) {\n        // eslint-disable-next-line\n        callback('请选择开始售卖时间')\n      } else {\n        // eslint-disable-next-line\n        callback()\n      }\n    },\n    // end_time validatorFn\n    end_time_validator(rule, value, callback) {\n      if (!value) {\n        // eslint-disable-next-line\n        callback('请选择结束售卖时间')\n      } else {\n        // eslint-disable-next-line\n        callback()\n      }\n    },\n    // 售卖时间-start\n    start_time_change(data) {\n      this.start_time = cloneDeep(data)\n    },\n    handleStartOpenChange(open) {\n      if (!open) {\n        this.endOpen = true\n      }\n    },\n    disabledStartDate(startValue) {\n      const endValue = this.end_time\n      if (!endValue) {\n        // 结束时间未选择\n        return (\n          startValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n        )\n      }\n      let start =\n        endValue.valueOf() >\n        moment()\n          .add(30, 'y')\n          .valueOf()\n          ? moment(endValue)\n              .subtract(30, 'y')\n              .valueOf()\n          : moment()\n              .startOf('day')\n              .valueOf()\n      return (\n        startValue.valueOf() < start ||\n        startValue.valueOf() > moment(endValue).valueOf()\n      )\n    },\n    // 售卖时间-end\n    end_time_change(data) {\n      this.end_time = cloneDeep(data)\n    },\n    handleEndOpenChange(open) {\n      this.endOpen = open\n    },\n    disabledEndDate(endValue) {\n      const startValue = this.start_time\n      if (!startValue) {\n        // 开始时间未选择\n        return (\n          endValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n        )\n      }\n      return (\n        endValue.valueOf() >=\n          moment(startValue)\n            .add(30, 'y')\n            .valueOf() ||\n        endValue.valueOf() < moment(startValue).valueOf() ||\n        endValue.valueOf() <\n          moment()\n            .startOf('day')\n            .valueOf()\n      )\n    },\n    // moment\n    moment\n  },\n  computed: {\n    // 团课小计\n    team_total() {\n      if (+this.packageData.team_times && +this.packageData.team_unit_price) {\n        return (\n          (this.packageData.team_times *\n            (this.packageData.team_unit_price * 10)) /\n          10\n        )\n      } else {\n        return 0\n      }\n    },\n    // 私教小计\n    personal_total() {\n      if (\n        +this.packageData.personal_times &&\n        +this.packageData.personal_unit_price\n      ) {\n        return (\n          (this.packageData.personal_times *\n            (this.packageData.personal_unit_price * 10)) /\n          10\n        )\n      } else {\n        return 0\n      }\n    },\n    // 总价\n    all_total() {\n      let teamTotal = this.packageData.is_team ? this.team_total : 0\n      let personalTotal = this.packageData.is_personal ? this.personal_total : 0\n      return teamTotal + personalTotal\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/pages/shop/product/course/manage/package"}]}