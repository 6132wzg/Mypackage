{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/lottery/add.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/plugin/lottery/add.vue","mtime":1598250255831},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { MessageService } from '@/services/message.service';\nimport { AddService } from \"./add.service\";\nimport H5Container from '@/views/biz-components/h5/h5-container';\nimport Steps from \"./components#/step\";\nimport { ruleOptions } from \"./form.config.ts\";\nimport { PatternService } from '@/services/pattern.service';\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue';\nimport BrandMarketingPluginAddPrize from '@/views/biz-modals/brand/marketing/plugin/add-prize';\nimport { cloneDeep } from 'lodash-es';\nimport 'swiper/dist/css/swiper.css';\nimport { swiper, swiperSlide } from 'vue-awesome-swiper';\nimport { TIMES_TYPE, CROWD_TYPE, SHARE_TYPE, STOP_SWIPER, ACTIVITY_STATUS, NOT_PRIZE_IMG_TYPE } from '@/constants/marketing/lottery';\nexport default {\n  name: 'PluginLotteryAdd',\n  data: function data(vm) {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      TIMES_TYPE: TIMES_TYPE,\n      CROWD_TYPE: CROWD_TYPE,\n      SHARE_TYPE: SHARE_TYPE,\n      STOP_SWIPER: STOP_SWIPER,\n      ACTIVITY_STATUS: ACTIVITY_STATUS,\n      NOT_PRIZE_IMG_TYPE: NOT_PRIZE_IMG_TYPE,\n      columsTitlelist: ['奖品名称', '奖品类型', '可用门店（家）', '奖品数量（个）', '中奖概率 (%)', '操作'],\n      info: {},\n      preview: {\n        title: '',\n        startTime: '',\n        endTime: '',\n        perTimes: 0,\n        totalTimes: 0,\n        description: ''\n      },\n      shareTitle: '',\n      fileList: [],\n      fileShareList: [],\n      prizeList: [],\n      timesType: TIMES_TYPE.DEFAULT,\n      crowdType: CROWD_TYPE.DEFAULT,\n      shareType: SHARE_TYPE.DEFAULT,\n      isStopSwiper: STOP_SWIPER.DEFAULT,\n      stepArr: [{\n        title: '基础信息',\n        key: 1\n      }, {\n        title: '抽奖规则',\n        key: 2\n      }, {\n        title: '奖项设置',\n        key: 3\n      }],\n      currentIndex: 0,\n      curPrizeIndex: -1,\n      notPrizeImgType: NOT_PRIZE_IMG_TYPE.DEFAULT,\n      dateRangeVal: [],\n      notPrize: {\n        prize_name: '未中奖',\n        prize: {\n          image_url: ''\n        }\n      },\n      sliderOptions: {\n        autoplay: {\n          delay: 3000,\n          disableOnInteraction: false\n        }\n      },\n      swiperOption: {\n        spaceBetween: 6,\n        slidesPerView: 1.05\n      },\n      defaultValue: [moment().format('HH:mm'), moment('11:59', 'HH:mm')],\n      isShowEditTable: -1,\n      prizeRate: [],\n      prizeNum: [],\n      // 奖品顺序\n      prizeSort: [[], [], [0, 1, 2, -1, 0, 1, 2, -1], [0, -1, 1, -1, 2, -1, 3, -1], [0, -1, 1, -1, 2, 3, 4, -1], [0, 1, 2, -1, 3, 4, 5, -1], [0, 1, 2, 3, 4, 5, 6, -1]]\n    };\n  },\n  bem: {\n    bPage: 'page-brand-marketing-plugin-lottery-add'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      addService: AddService,\n      pattern: PatternService,\n      messageService: MessageService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      drawCondition: this.addService.drawCondition$,\n      drawTimesType: this.addService.drawTimesType$,\n      invitePoster: this.addService.invitePoster$,\n      wheelDefault: this.addService.wheelDefault$,\n      wheelTurnAround: this.addService.wheelTurnAround$,\n      joinCrowdAll: this.addService.joinCrowdAll$,\n      crowd: this.addService.crowd$,\n      imgType: this.addService.imgType$,\n      prizeInfoList: this.addService.prizeInfoList$,\n      lucky: this.addService.lucky$,\n      prize: this.addService.prize$,\n      share: this.addService.share$\n    };\n  },\n  modals: {\n    BrandMarketingPluginAddPrize: BrandMarketingPluginAddPrize\n  },\n  components: {\n    H5Container: H5Container,\n    Steps: Steps,\n    swiper: swiper,\n    swiperSlide: swiperSlide,\n    StImageUpload: StImageUpload\n  },\n  mounted: function mounted() {\n    // this.notPrize.prize = this.lucky[0]\n    if (this.$searchQuery.activity_id) {\n      this.editVIew(this.$searchQuery.activity_id);\n    }\n  },\n  computed: {\n    deleteBtnStatus: function deleteBtnStatus() {\n      return this.$searchQuery.activity_id && this.$searchQuery.status === 1;\n    },\n    prizeListFilters: function prizeListFilters(value) {\n      var _this = this;\n\n      if (this.prizeList.length <= 2) {\n        return this.prizeList;\n      }\n\n      return this.prizeSort[this.prizeList.length - 1].map(function (item, index) {\n        if (item > -1) {\n          return _this.prizeList[item];\n        } else {\n          return {\n            prize: {\n              image_url: _this.notPrizeImgType === _this.NOT_PRIZE_IMG_TYPE.CUSTOM ? _this.notPrize.prize.image_url : _this.lucky[0].image_url\n            },\n            prize_name: _this.notPrize.prize_name\n          };\n        }\n      });\n    }\n  },\n  methods: {\n    showEditTable: function showEditTable(index) {\n      if (this.isShowEditTable === index) {\n        this.prizeList[index].number = this.prizeNum[index];\n        this.prizeList[index].rate = this.prizeRate[index];\n        this.isShowEditTable = -1;\n      } else {\n        this.isShowEditTable = index;\n      }\n    },\n    next: function next(para) {\n      var _this2 = this;\n\n      if (para.index) {\n        para = para.index - 1;\n      }\n\n      if (para === 0) {\n        this.currentIndex = 0;\n      }\n\n      if (para === 1) {\n        this.form.validate(['activity_base.activity_name', 'activity_base.activity_description', 'activity_base.wheel_turn_around', 'activity_base.wheel_share_default', 'activity_base.share_title', 'activity_base.activity_sub_name']).then(function () {\n          _this2.currentIndex = para;\n        });\n      }\n\n      if (para === 2) {\n        this.form.validate(['activity_base.activity_name', 'activity_base.activity_description', 'activity_base.wheel_turn_around', 'activity_base.wheel_share_default', 'activity_base.share_title', 'activity_base.activity_sub_name', 'activity_rule.join_crowd_all', 'activity_rule.draw_condition', 'activity_rule.draw_times_type', 'activity_rule.per_times', 'activity_rule.total_times']).then(function () {\n          _this2.currentIndex = para;\n        });\n      }\n    },\n    onChangeGetAvatar: function onChangeGetAvatar(imageFiles) {\n      this.fileList = cloneDeep(imageFiles);\n      this.notPrize.prize = this.fileList[0];\n    },\n    onShareChangeGetAvatar: function onShareChangeGetAvatar(imageFiles) {\n      this.fileShareList = cloneDeep(imageFiles);\n    },\n    onSubmit: function onSubmit() {\n      var _this3 = this;\n\n      this.form.validate().then(function (value) {\n        value.activity_base.start_time = _this3.preview.startTime;\n        value.activity_base.end_time = _this3.preview.endTime;\n        value.activity_base.share_title = _this3.shareTitle; // 选择自定义却不传图片\n\n        value.activity_base.share_bg = _this3.shareType === SHARE_TYPE.CUSTOM ? _this3.fileShareList[0] || _this3.share[0] : _this3.share[0];\n        value.activity_prizes = _this3.prizeList;\n        value.activity_lucky.lucky = _this3.notPrizeImgType === NOT_PRIZE_IMG_TYPE.CUSTOM ? _this3.fileList[0] || _this3.prize[0] : _this3.lucky[0];\n\n        if (_this3.timesType === 1 && !value.activity_rule.per_times) {\n          _this3.messageService.warn({\n            content: '请填写抽奖次数'\n          });\n\n          return;\n        }\n\n        if (_this3.timesType === 2 && !value.activity_rule.total_times) {\n          _this3.messageService.warn({\n            content: '请填写抽奖次数'\n          });\n\n          return;\n        }\n\n        value.activity_rule.prize_sort = _this3.prizeSort[_this3.prizeList.length - 1];\n\n        if (_this3.$searchQuery.activity_id) {\n          value.activity_id = _this3.$searchQuery.activity_id;\n\n          _this3.addService.edit(value).subscribe(function (res) {\n            _this3.$router.push('./success?id=' + res.id);\n          });\n        } else {\n          _this3.addService.add(value).subscribe(function (res) {\n            _this3.$router.push('./success?id=' + res.id);\n          });\n        }\n      });\n    },\n    getTitle: function getTitle(e) {\n      this.preview.title = e.target.value;\n    },\n    getName: function getName(e) {\n      this.notPrize.prize_name = e.target.value;\n    },\n    getPerTimes: function getPerTimes(val) {\n      this.preview.perTimes = val;\n    },\n    getTotalTimes: function getTotalTimes(val) {\n      this.preview.totalTimes = val;\n    },\n    getDescription: function getDescription(val) {\n      this.preview.description = val;\n    },\n    // 抽奖次数类型\n    getCurTimesType: function getCurTimesType(e) {\n      this.timesType = e.target.value;\n    },\n    // 人群类型\n    getCurCrowdType: function getCurCrowdType(e) {\n      this.crowdType = e.target.value;\n    },\n    // 分享类型\n    getCurShareType: function getCurShareType(e) {\n      this.shareType = e.target.value;\n    },\n    // 轮播开关\n    stopSwiper: function stopSwiper(e) {\n      this.isStopSwiper = e.target.value;\n    },\n    onDateChange: function onDateChange(data, str) {\n      this.preview.startTime = str[0];\n      this.preview.endTime = str[1];\n    },\n    getNotImgType: function getNotImgType(e) {\n      this.notPrizeImgType = e.target.value;\n    },\n    getPrizeInfo: function getPrizeInfo(val) {\n      if (this.curPrizeIndex > -1) {\n        this.prizeList.splice(this.curPrizeIndex, 1, val);\n      } else {\n        this.prizeList.push(val);\n        this.prizeRate.push(val.rate);\n        this.prizeNum.push(val.number);\n      }\n    },\n    getCurPrizeIndex: function getCurPrizeIndex(index) {\n      this.curPrizeIndex = index;\n    },\n    disabledDate: function disabledDate(current) {\n      return current && current.format('YYYY-MM-DD') < moment().format('YYYY-MM-DD');\n    },\n    onDelete: function onDelete(para) {\n      if (this.isShowEditTable === para) {\n        this.isShowEditTable = -1;\n        return false;\n      } else {\n        this.prizeRate.splice(para, 1);\n        this.prizeNum.splice(para, 1);\n      }\n\n      this.prizeList = this.prizeList.filter(function (item, index) {\n        return index !== para;\n      });\n    },\n    editTableNum: function editTableNum(val, index) {\n      this.prizeNum[index] = val;\n    },\n    editTableRate: function editTableRate(val, index) {\n      this.prizeRate[index] = val;\n    },\n    editVIew: function editVIew(id) {\n      var _this4 = this;\n\n      return this.addService.editVIew(id).subscribe(function (res) {\n        _this4.info = res;\n\n        _this4.form.setFieldsValue({\n          activity_base: res.activity_base,\n          activity_lucky: res.activity_lucky,\n          activity_prizes: res.activity_prizes,\n          activity_rule: res.activity_rule\n        });\n\n        _this4.dateRangeVal = [moment(res.activity_base.start_time.trim()), moment(res.activity_base.end_time.trim())];\n        _this4.prizeList = res.activity_prizes;\n        res.activity_prizes.forEach(function (item, index) {\n          _this4.prizeNum[index] = item.number;\n          _this4.prizeRate[index] = item.rate;\n        });\n        _this4.preview.startTime = res.activity_base.start_time;\n        _this4.preview.endTime = res.activity_base.end_time;\n        _this4.preview.perTimes = res.activity_rule.per_times;\n        _this4.preview.totalTimes = res.activity_rule.total_times;\n        _this4.preview.description = res.activity_base.activity_description;\n        _this4.preview.title = res.activity_base.activity_sub_name;\n        _this4.notPrize.prize_name = res.activity_lucky.lucky_name;\n        _this4.shareType = res.activity_base.wheel_share_default;\n        _this4.timesType = res.activity_rule.draw_times_type;\n        _this4.isStopSwiper = res.activity_base.wheel_turn_around;\n        _this4.notPrizeImgType = res.activity_lucky.image_default;\n        _this4.shareTitle = res.activity_base.share_title;\n        _this4.share[0].image_id = res.activity_base.share_bg.image_id;\n        res.activity_lucky.lucky && (_this4.fileList[0] = res.activity_lucky.lucky);\n        _this4.fileShareList[0] = res.activity_base.share_bg;\n        _this4.prize[0] = res.activity_lucky.lucky;\n\n        if (_this4.notPrizeImgType === _this4.NOT_PRIZE_IMG_TYPE.CUSTOM) {\n          _this4.notPrize.prize = res.activity_lucky.lucky;\n        } else {\n          _this4.notPrize.prize = _this4.lucky[0];\n        }\n      });\n    }\n  }\n};",null]}