{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"tier-2~shop-sold-card-info-deposit~shop-sold-card-list\"],{\"2b1e\":function(t,e,n){\"use strict\";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"st-modal\",{attrs:{title:\"修改售出权益\"},model:{value:t.show,callback:function(e){t.show=e},expression:\"show\"}},[n(\"st-form\",{attrs:{form:t.form}},[n(\"st-form-item\",{staticClass:\"mg-b12\",attrs:{labelWidth:\"120px\"}},[n(\"template\",{slot:\"label\"},[n(\"st-checkbox\",{model:{value:t.switches.consumeType,callback:function(e){t.$set(t.switches,\"consumeType\",e)},expression:\"switches.consumeType\"}},[t._v(\"\\n          支持消费类型\\n        \")])],1),n(\"a-checkbox-group\",{attrs:{disabled:!t.switches.consumeType},model:{value:t.info.support_consumers,callback:function(e){t.$set(t.info,\"support_consumers\",e)},expression:\"info.support_consumers\"}},[n(\"a-row\",t._l(t.consumeTypeOptions,(function(e){return n(\"a-col\",{key:e.value,staticClass:\"mg-b12\",attrs:{span:12}},[n(\"a-checkbox\",{attrs:{value:e.value}},[t._v(t._s(e.label))])],1)})),1)],1)],2),t.info.transfer?n(\"st-form-item\",{attrs:{labelWidth:\"88px\"}},[n(\"template\",{slot:\"label\"},[n(\"st-checkbox\",{on:{change:t.onSwitchChange},model:{value:t.switches.transferSetting,callback:function(e){t.$set(t.switches,\"transferSetting\",e)},expression:\"switches.transferSetting\"}},[t._v(\"\\n          转让设置\\n        \")])],1),n(\"st-checkbox\",{attrs:{disabled:!t.switches.transferSetting},model:{value:t.info.transfer.is_transferable,callback:function(e){t.$set(t.info.transfer,\"is_transferable\",e)},expression:\"info.transfer.is_transferable\"}},[t._v(\"\\n        支持转让\\n      \")]),n(\"st-input-number\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.info.transfer.is_transferable,expression:\"info.transfer.is_transferable\"},{name:\"decorator\",rawName:\"v-decorator\",value:t.decorators.transfer_num,expression:\"decorators.transfer_num\"}],staticStyle:{width:\"140px\"},attrs:{min:0,disabled:!t.switches.transferSetting}},[n(\"span\",{attrs:{slot:\"addonAfter\"},slot:\"addonAfter\"},[n(\"a-select\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:t.decorators.transfer_unit,expression:\"decorators.transfer_unit\"}],attrs:{options:t.transferUnitOptions,disabled:!t.switches.transferSetting}})],1)])],2):t._e(),t.info.consumption_range?n(\"assign-shop\",{attrs:{form:t.form,labelWidth:\"120px\",type:t.info.consumption_range.consumption_range_type,shopIds:t.info.consumption_range.select_shops,required:!1,disabled:!t.switches.consumeShop},on:{change:t.onShopChange}},[n(\"template\",{slot:\"label\"},[n(\"st-checkbox\",{model:{value:t.switches.consumeShop,callback:function(e){t.$set(t.switches,\"consumeShop\",e)},expression:\"switches.consumeShop\"}},[t._v(\"\\n          支持消费门店\\n        \")])],1)],2):t._e()],1),n(\"template\",{slot:\"footer\"},[n(\"st-button\",{attrs:{type:\"primary\",loading:t.loading.updateRights},on:{click:t.onSubmit}},[t._v(\"\\n      确认提交\\n    \")])],1)],2)},r=[],i=(n(\"c5f6\"),n(\"d225\")),o=n(\"b0b4\"),a=n(\"9ab4\"),c=n(\"0cd5\"),u=n(\"df29\"),f=(n(\"6b54\"),n(\"2397\"),n(\"308d\")),p=n(\"6bb5\"),l=n(\"4e2b\"),h=n(\"de46\");function d(t){return function(){var e,n=Object(p[\"a\"])(t);if(m()){var s=Object(p[\"a\"])(this).constructor;e=Reflect.construct(n,arguments,s)}else e=n.apply(this,arguments);return Object(f[\"a\"])(this,e)}}function m(){if(\"undefined\"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var b,g,_,v=function(t){Object(l[\"a\"])(n,t);var e=d(n);function n(){return Object(i[\"a\"])(this,n),e.apply(this,arguments)}return Object(o[\"a\"])(n,[{key:\"getRightsInfo\",value:function(t){return this.http.get(\"/v1/sold/cards/deposit/rights/\".concat(t))}},{key:\"updateRights\",value:function(t,e){return this.http.put(\"/v1/sold/cards/deposit/rights/\".concat(t),{params:e})}}]),n}(h[\"a\"]),y=n(\"c4cc\"),w=n(\"2138\"),S=function(){function t(e,n){Object(i[\"a\"])(this,t),this.cardApi=e,this.userService=n,this.info$=new u[\"d\"]({}),this.infoItems$=new u[\"d\"]([]),this.loading$=new u[\"d\"]({}),this.consumeTypeOptions$=this.userService.getOptions$(\"deposit_card.consumer_type\"),this.transferUnitOptions$=this.userService.getOptions$(\"deposit_card.transfer_unit\")}return Object(o[\"a\"])(t,[{key:\"getInfo\",value:function(t){var e=this;return this.cardApi.getRightsInfo(t).pipe(Object(y[\"a\"])((function(t){e.info$.commit((function(){return t.info}))})))}},{key:\"updateRights\",value:function(t,e){return this.cardApi.updateRights(t,e)}}]),t}();Object(a[\"b\"])([Object(u[\"c\"])(),Object(a[\"d\"])(\"design:type\",Function),Object(a[\"d\"])(\"design:paramtypes\",[Number]),Object(a[\"d\"])(\"design:returntype\",void 0)],S.prototype,\"getInfo\",null),Object(a[\"b\"])([Object(u[\"c\"])(),Object(a[\"d\"])(\"design:type\",Function),Object(a[\"d\"])(\"design:paramtypes\",[Number,\"function\"===typeof(b=!1)?b:Object]),Object(a[\"d\"])(\"design:returntype\",void 0)],S.prototype,\"updateRights\",null),S=Object(a[\"b\"])([Object(c[\"b\"])(),Object(a[\"d\"])(\"design:paramtypes\",[\"function\"===typeof(g=\"undefined\"!==typeof v&&v)?g:Object,\"function\"===typeof(_=\"undefined\"!==typeof w[\"a\"]&&w[\"a\"])?_:Object])],S);var O=function(t){return{transfer_num:{rules:[{validator:function(e,n){if(t.switches.transferSetting&&t.info.transfer.is_transferable&&!n.toString().length)return\"请输入转让手续费\"}}]},transfer_unit:{initialValue:1,rules:[{validator:function(e,n){if(t.switches.transferSetting&&t.info.transfer.is_transferable&&!+n)return\"请选择转让手续费单位\"}}]}}},j=n(\"e69b\"),k=n(\"9b2f\"),x={components:{AssignShop:k[\"a\"]},serviceInject:function(){return{messageService:j[\"a\"],updateRightsService:S}},rxState:function(){var t=this.updateRightsService,e=t.info$,n=t.loading$,s=t.consumeTypeOptions$,r=t.transferUnitOptions$;return{info:e,loading:n,consumeTypeOptions:s,transferUnitOptions:r}},props:{id:{type:Number,default:0}},data:function(){var t=this.$stForm.create(),e=t.decorators(O);return{form:t,decorators:e,show:!1,switches:{consumeType:0,transferSetting:0,consumeShop:0}}},created:function(){var t=this;this.updateRightsService.getInfo(this.id).subscribe((function(e){t.$nextTick((function(){t.setFieldsValue(e.info)}))}))},methods:{onShopChange:function(t,e){this.info.consumption_range.consumption_range_type=t,this.info.consumption_range.select_shops=e},setFieldsValue:function(t){var e=t.transfer,n=e.transfer_num,s=e.transfer_unit;this.form.setFieldsValue({transfer_num:n,transfer_unit:s||1})},onSwitchChange:function(){this.form.validateFields([\"transfer_num\",\"transfer_unit\"],{force:!0})},checkIsChanged:function(){var t=!1,e=this.switches;for(var n in e)if(e[n])return t=!0,!0;return t},onSubmit:function(){var t=this;if(!this.checkIsChanged())return this.messageService.error({content:\"未进行任何修改，无法确认\"});this.form.validate().then((function(e){var n=t.info,s=n.transfer,r=n.consumption_range,i=n.support_consumers,o=t.switches,a={is_change_consumers:o.consumeType,consumption_range_type:r.consumption_range_type,support_consumers:i,is_change_transferable:o.transferSetting,transfer_num:e.transfer_num,transfer_unit:e.transfer_unit,is_transferable:s.is_transferable,is_change_consumption_range:o.consumeShop,select_shops:r.select_shops};t.updateRightsService.updateRights(t.id,a).subscribe(t.onSubmitSuccess)}))},onSubmitSuccess:function(){this.messageService.success({content:\"提交成功\"}),this.show=!1,this.$emit(\"success\")}}},$=x,R=n(\"2877\"),T=Object(R[\"a\"])($,s,r,!1,null,null,null),I=T.exports,C=function(t){return{modals:{SoldCardDepositUpdateRights:I},methods:{onUpdateRights:function(t){var e=this;this.$modalRouter.push({name:\"sold-card-deposit-update-rights\",props:{id:t},on:{success:function(){e.$router.reload()}}})}}}};e[\"a\"]=C}}]);","extractedComments":[]}