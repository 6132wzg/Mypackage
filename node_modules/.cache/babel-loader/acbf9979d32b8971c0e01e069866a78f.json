{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/activity.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/brand/marketing/activity.vue","mtime":1597895242001},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { H5WrapperService } from '@/views/pages/brand/setting/mina/components#/h5/h5-wrapper.service';\nimport RowContainerComponent from '@/views/pages/brand/setting/mina/components#/h5/row-container.component';\nimport H5Component from '@/views/pages/brand/setting/mina/components#/h5/h5.component';\nimport SliderComponent from \"./components#/slider.component\";\nimport EventComponent from \"./components#/event.component\";\nimport { NotificationService } from '@/services/notification.service';\nimport { ActivityService } from \"./activity.service\";\nimport { cloneDeep } from 'lodash-es';\nexport default {\n  name: 'H5WrapperComponent',\n  components: {\n    RowContainerComponent: RowContainerComponent,\n    H5Component: H5Component,\n    SliderComponent: SliderComponent,\n    EventComponent: EventComponent\n  },\n  props: {},\n  bem: {\n    activity: 'brand-marketing-activity'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      h5WrapperService: H5WrapperService,\n      notificationService: NotificationService,\n      activityService: ActivityService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      sliderInfo: this.h5WrapperService.sliderInfo$,\n      eventInfo: this.h5WrapperService.eventInfo$,\n      loading: this.h5WrapperService.loading$,\n      actList: this.activityService.actList$,\n      info: this.activityService.info$\n    };\n  },\n  data: function data() {\n    return {\n      sliderLoaded: false,\n      openStatus: 0,\n      openMiniFlag: false,\n      isFixed: false,\n      offsetTop: 0\n    };\n  },\n  created: function created() {\n    var that = this;\n    var title = '';\n    var content = '';\n    var okText = '确定';\n\n    if (this.info.is_auth === 0) {\n      title = '提示';\n      content = '请先开通小程序后使用此功能';\n      okText = '去绑定小程序';\n    } else {\n      this.getH5Info();\n      title = '温馨提示';\n      content = '活动广告配置功能已迁移至“小程序配置”菜单，点击下方按钮去配置活动吧！';\n      okText = '去配置';\n    }\n\n    this.$confirm({\n      title: title,\n      content: content,\n      okText: okText,\n      cancelText: '返回',\n      keyboard: false,\n      onOk: function onOk() {\n        that.$router.push({\n          path: '/brand/setting/mina/index'\n        });\n      },\n      onCancel: function onCancel() {\n        that.$router.back();\n      }\n    }); // this.getActList()\n  },\n  mounted: function mounted() {\n    this.offsetTop = document.querySelector('#h5').offsetTop;\n    window.addEventListener('scroll', this.handleScroll);\n  },\n  destroyed: function destroyed() {\n    window.removeEventListener('scroll', this.handleScroll);\n  },\n  watch: {\n    openStatus: function openStatus(newVal) {\n      newVal ? this.openMiniFlag = true : this.openMiniFlag = false;\n    }\n  },\n  methods: {\n    handleScroll: function handleScroll() {\n      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;\n      var offsetTop = this.offsetTop;\n\n      if (scrollTop > offsetTop) {\n        this.isFixed = true;\n      } else {\n        this.isFixed = false;\n      }\n    },\n    onOpenStatusChange: function onOpenStatusChange(data) {\n      var _this = this;\n\n      if (!data) {\n        this.$confirm({\n          title: '提示',\n          content: \"\\u4E00\\u65E6\\u5173\\u95ED\\uFF0C\\u5C0F\\u7A0B\\u5E8F\\u4F1A\\u5173\\u95ED\\u9996\\u9875\\u8425\\u9500\\u4F4D\\uFF0C\\u8BF7\\u8C28\\u614E\\u64CD\\u4F5C\\u3002\",\n          onCancel: function onCancel() {\n            _this.openStatus = 1;\n          },\n          onOk: function onOk() {//this.openStatus === 3\n          }\n        });\n      }\n    },\n    saveConfirm: function saveConfirm(is_status) {\n      var _this2 = this;\n\n      var content = '';\n      if (is_status === 1) content = '是否确认将当前配置信息发布到小程序？';\n      if (is_status === 2) content = '是否确认将当前配置信息发布到小程序？';\n      this.$confirm({\n        content: content,\n        onOk: function onOk() {\n          _this2.save(is_status);\n        }\n      });\n    },\n    save: function save(is_status) {\n      var _this3 = this;\n\n      var saveForm = {\n        info: []\n      };\n\n      for (var i = 0; i < this.sliderInfo.length; i++) {\n        this.sliderInfo[i].activity_id = this.sliderInfo[i].activity_id[1] || this.sliderInfo[i].activity_id;\n      }\n\n      for (var _i = 0; _i < this.eventInfo.length; _i++) {\n        this.eventInfo[_i].activity_id = this.eventInfo[_i].activity_id[1] || this.eventInfo[_i].activity_id;\n      }\n\n      saveForm.info.push({\n        category: 1,\n        content: this.sliderInfo,\n        status: is_status\n      });\n      saveForm.info.push({\n        category: 3,\n        content: this.eventInfo,\n        status: this.openStatus ? 2 : 3\n      });\n      this.h5WrapperService.save(saveForm).subscribe(function (res) {\n        if (res.is_success === 1) {\n          _this3.notificationService.success({\n            title: '保存成功',\n            content: '成功'\n          });\n        } else if (res.is_success === 0) {\n          _this3.notificationService.error({\n            title: '保存失败',\n            content: res.message\n          });\n        }\n      });\n    },\n    setCoashIDs: function setCoashIDs() {\n      var coach = cloneDeep(this.coach);\n      coach.staff_id_list = [];\n      this.coachInfo.forEach(function (item) {\n        coach.staff_id_list.push(item.id);\n      });\n      return coach;\n    },\n    getActList: function getActList() {\n      this.activityService.getInfo().subscribe();\n    },\n    getH5Info: function getH5Info() {\n      var _this4 = this;\n\n      var that = this;\n      this.h5WrapperService.getH5Info({\n        category: 1\n      }).subscribe(function () {\n        _this4.sliderLoaded = true;\n      });\n      this.h5WrapperService.getH5Info({\n        category: 2\n      }).subscribe();\n      this.h5WrapperService.getH5Info({\n        category: 3\n      }).subscribe(function (res) {\n        _this4.openStatus = res.status;\n      });\n      this.h5WrapperService.getH5Info({\n        category: 4\n      }).subscribe(function (res) {\n        var staff_id = [];\n\n        if (res.content) {\n          staff_id = res.content.staff_id_list;\n        }\n\n        that.h5WrapperService.getCoachInfo({\n          staff_id: staff_id\n        }).subscribe();\n      });\n      this.h5WrapperService.getH5Info({\n        category: 5\n      }).subscribe();\n      this.h5WrapperService.getMenu().subscribe();\n    }\n  }\n};",null]}