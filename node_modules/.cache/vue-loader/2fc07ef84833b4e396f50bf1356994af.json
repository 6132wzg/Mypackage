{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/member/info/reserve.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/member/info/reserve.vue","mtime":1600926556363},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { ReserveService } from './reserve.service'\nimport tableMixin from '@/mixins/table.mixin'\nimport UserRange from './sold#/user-range'\nimport EntryData from './sold#/entry-data'\nimport {\n  memberCard,\n  depositCard,\n  personalCourse,\n  packageColumns,\n  smallCourse\n} from './reserve.config'\nimport { UserService } from '@/services/user.service'\n\nexport default {\n  mixins: [tableMixin],\n  bem: {\n    b: 'member-reserve'\n  },\n  name: 'InfoReserve',\n  serviceInject() {\n    return {\n      reserveService: ReserveService,\n      userService: UserService\n    }\n  },\n  rxState() {\n    const {\n      memberCardList$,\n      depositCardList$,\n      personalCourseList$,\n      packageList$,\n      smallCourseList$,\n      memberCardPage$,\n      depositCardPage$,\n      personalCoursePage$,\n      packagePage$,\n      smallCoursePage$\n    } = this.reserveService\n    return {\n      memberCardList$,\n      depositCardList$,\n      personalCourseList$,\n      packageList$,\n      smallCourseList$,\n      memberCardPage$,\n      depositCardPage$,\n      personalCoursePage$,\n      packagePage$,\n      smallCoursePage$,\n      cardConsumeList: this.userService.getOptions$('member.card_consume_type'),\n      courseConsumeList: this.userService.getOptions$(\n        'member.course_consume_type'\n      )\n    }\n  },\n  data() {\n    return {\n      cardquery: {\n        start_time: '',\n        card_type: 1,\n        keyword: ''\n      },\n      coursequery: {\n        buy_time: '',\n        course_type: 1,\n        keyword: ''\n      },\n      id: ''\n    }\n  },\n  components: {\n    UserRange,\n    EntryData\n  },\n  computed: {\n    memberCard,\n    depositCard,\n    personalCourse,\n    packageColumns,\n    smallCourse\n  },\n  methods: {\n    getSoldDetail(type, subType, id) {\n      window.open(\n        `${window.location.origin}/shop/sold/${type}/info/${subType}/info/operation-record?id=${id}`\n      )\n    },\n    onTableMemberChange(type, e) {\n      this.$searchQuery.type = type\n      this.reserveService\n        .changePage({\n          id: this.id,\n          type,\n          page: e.current,\n          size: e.pageSize\n        })\n        .subscribe()\n    },\n    memberInfo(record) {\n      const arr = record.members || []\n      let familyInfo = ''\n      if (record.card_number_type === 2) {\n        familyInfo = `卡成员：${arr\n          .filter(item => item.is_purchaser !== 1)\n          .map(item => item.member_info)\n          .join(',')}`\n      }\n      return `购卡人：${arr\n        .filter(item => item.is_purchaser === 1)\n        .map(item => item.member_info)\n        .join('')}${familyInfo}`\n    },\n    /**\n     * 设置页码\n     * cardOrCourse 卡或课\n     * current 当前页\n     * pageSize 每页条数\n     */\n    initPage(cardOrCourse, current_page, size) {\n      if (cardOrCourse === 1) {\n        this.cardPage.size = size\n        this.cardPage.current_page = current_page\n      } else if (cardOrCourse === 2) {\n        this.coursePage.current_page = current_page\n        this.coursePage.size = size\n      }\n    },\n    // 拼接入参\n    assignObj(cardOrCourse) {\n      if (cardOrCourse === 1) {\n        return Object.assign(this.cardPage, this.cardquery)\n      } else if (cardOrCourse === 2) {\n        return Object.assign(this.coursePage, this.coursequery)\n      }\n    },\n    // 选择日期\n    onChooseDate(date, str) {\n      console.log('======', date, str)\n      this.initPage(1, 1, 10)\n      this.cardquery.start_time = str\n      this.reserveService\n        .getCardInfo(this.id, this.assignObj(1))\n        .subscribe(res => {})\n    },\n    // 选择卡类型\n    onChooseCardType(e) {\n      console.log('选择卡', e)\n      this.initPage(1, 1, 10)\n      this.reserveService\n        .getCardInfo(this.id, this.assignObj(1))\n        .subscribe(res => {})\n    },\n    // 卡分页\n    cardPageChange(e) {\n      this.initPage(1, e.current, e.pageSize)\n      this.reserveService\n        .getCardInfo(this.id, this.assignObj(1))\n        .subscribe(res => {})\n    },\n    // 卡查询\n    searchMemberCard(e) {\n      this.initPage(1, 1, 10)\n      this.cardquery.keyword = e\n      this.reserveService\n        .getCardInfo(this.id, this.assignObj(1))\n        .subscribe(res => {})\n    },\n    // 课项选择时间\n    onChooseDateCourse(date, str) {\n      this.initPage(2, 1, 10)\n      this.coursequery.buy_time = str\n      this.reserveService\n        .getCourseInfo(this.id, this.assignObj(2))\n        .subscribe(res => {})\n    },\n    // 课项选择类型\n    onChooseCourseType(e) {\n      this.initPage(2, 1, 10)\n      this.reserveService\n        .getCourseInfo(this.id, this.assignObj(2))\n        .subscribe(res => {})\n    },\n    // 课查询\n    searchCourseName(e) {\n      this.initPage(2, 1, 10)\n      this.coursequery.keyword = e\n      this.reserveService\n        .getCourseInfo(this.id, this.assignObj(2))\n        .subscribe(res => {})\n    },\n    // 课分页\n    coursePageChange(e) {\n      this.initPage(2, e.current, e.pageSize)\n      this.reserveService\n        .getCourseInfo(this.id, this.assignObj(2))\n        .subscribe(res => {})\n    }\n  },\n  mounted() {\n    this.id = this.$searchQuery.id\n  }\n}\n",{"version":3,"sources":["reserve.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"reserve.vue","sourceRoot":"src/views/pages/shop/member/info","sourcesContent":["<template>\n  <div :class=\"b()\">\n    <div :class=\"b('member-card')\">\n      <st-t3>已购会员卡</st-t3>\n      <st-table\n        v-if=\"memberCardList$.length\"\n        class=\"mg-t16\"\n        rowKey=\"id\"\n        :columns=\"memberCard\"\n        :dataSource=\"memberCardList$\"\n        :scroll=\"{ x: 1150 }\"\n        @change=\"onTableMemberChange('member', $event)\"\n        :page=\"memberCardPage$\"\n      >\n        <template slot=\"memberList\" slot-scope=\"text\">\n          <st-overflow-text :value=\"text\" max-width=\"120px\"></st-overflow-text>\n        </template>\n        <template slot=\"contract_number\" slot-scope=\"text, record\">\n          <a @click=\"getSoldDetail('card', 'member', record.id)\">{{ text }}</a>\n        </template>\n        <template slot=\"use_range\" slot-scope=\"text, record\">\n          <user-range :userRange=\"text\" :record=\"record\"></user-range>\n        </template>\n        <template slot=\"card_status\" slot-scope=\"text\">\n          <st-text\n            :status=\"{\n              success: text.id === 1,\n              error: text.id === 3,\n              default: text.id === 2\n            }\"\n          >\n            {{ text.name }}\n          </st-text>\n        </template>\n      </st-table>\n      <entry-data v-else tip=\"您还未购买会员卡^o^\"></entry-data>\n    </div>\n    <div :class=\"b('deposit-card')\" class=\"mg-t32\">\n      <st-t3>已购储值卡</st-t3>\n      <st-table\n        v-if=\"depositCardList$.length\"\n        class=\"mg-t16\"\n        rowKey=\"id\"\n        :columns=\"depositCard\"\n        :dataSource=\"depositCardList$\"\n        :scroll=\"{ x: 1150 }\"\n        @change=\"onTableMemberChange('deposit', $event)\"\n        :page=\"depositCardPage$\"\n      >\n        <template slot=\"contract_number\" slot-scope=\"text, record\">\n          <a @click=\"getSoldDetail('card', 'deposit', record.id)\">{{ text }}</a>\n        </template>\n        <template slot=\"use_range\" slot-scope=\"text, record\">\n          <user-range :userRange=\"text\" :record=\"record\"></user-range>\n        </template>\n        <template slot=\"card_status\" slot-scope=\"text\">\n          <st-text\n            :status=\"{\n              success: text.id === 1,\n              error: text.id === 3,\n              default: text.id === 2\n            }\"\n          >\n            {{ text.name }}\n          </st-text>\n        </template>\n      </st-table>\n      <entry-data v-else tip=\"您还未购买储值卡^o^\"></entry-data>\n    </div>\n    <div :class=\"b('personal-course')\" class=\"mg-t32\">\n      <st-t3>已购私教课</st-t3>\n      <st-table\n        class=\"mg-t16\"\n        v-if=\"personalCourseList$.length\"\n        rowKey=\"id\"\n        :columns=\"personalCourse\"\n        :dataSource=\"personalCourseList$\"\n        :scroll=\"{ x: 1150 }\"\n        @change=\"onTableMemberChange('personal', $event)\"\n        :page=\"personalCoursePage$\"\n      >\n        <template slot=\"contract_number\" slot-scope=\"text, record\">\n          <a @click=\"getSoldDetail('course', 'personal', record.id)\">\n            {{ text }}\n          </a>\n        </template>\n        <template slot=\"coach_name\" slot-scope=\"text\">\n          <st-overflow-text max-width=\"180px\" :value=\"text\"></st-overflow-text>\n        </template>\n        <template slot=\"use_range\" slot-scope=\"text, record\">\n          <user-range :userRange=\"text\" :record=\"record\"></user-range>\n        </template>\n        <template slot=\"course_status\" slot-scope=\"text\">\n          <st-text\n            :status=\"{\n              success: text.id === 1,\n              error: text.id === 3,\n              default: text.id === 2\n            }\"\n          >\n            {{ text.name }}\n          </st-text>\n        </template>\n      </st-table>\n      <entry-data v-else tip=\"您还未购买私教课^o^\"></entry-data>\n    </div>\n    <div :class=\"b('package')\" class=\"mg-t32\">\n      <st-t3>已购课程包</st-t3>\n      <st-table\n        class=\"mg-t16\"\n        rowKey=\"id\"\n        v-if=\"packageList$.length\"\n        :columns=\"packageColumns\"\n        :dataSource=\"packageList$\"\n        :scroll=\"{ x: 1150 }\"\n        @change=\"onTableMemberChange('package', $event)\"\n        :page=\"packagePage$\"\n      >\n        <template slot=\"memberList\" slot-scope=\"text\">\n          <st-overflow-text :value=\"text\" max-width=\"120px\"></st-overflow-text>\n        </template>\n        <template slot=\"contract_number\" slot-scope=\"text, record\">\n          <a @click=\"getSoldDetail('course', 'package', record.id)\">\n            {{ text }}\n          </a>\n        </template>\n        <template slot=\"use_range\" slot-scope=\"text, record\">\n          <user-range :userRange=\"text\" :record=\"record\"></user-range>\n        </template>\n        <template slot=\"course_status\" slot-scope=\"text\">\n          <st-text\n            :status=\"{\n              success: text.id === 1,\n              error: text.id === 3,\n              default: text.id === 2\n            }\"\n          >\n            {{ text.name }}\n          </st-text>\n        </template>\n      </st-table>\n      <entry-data v-else tip=\"您还未购买课程包^o^\"></entry-data>\n    </div>\n    <div :class=\"b('small-course')\" class=\"mg-t32\">\n      <st-t3>已购小班课</st-t3>\n      <st-table\n        class=\"mg-t16\"\n        rowKey=\"id\"\n        :columns=\"smallCourse\"\n        v-if=\"smallCourseList$.length\"\n        :dataSource=\"smallCourseList$\"\n        :scroll=\"{ x: 1150 }\"\n        @change=\"onTableMemberChange('small', $event)\"\n        :page=\"smallCoursePage$\"\n      >\n        <template slot=\"contract_number\" slot-scope=\"text, record\">\n          <a @click=\"getSoldDetail('course', 'small-course', record.id)\">\n            {{ text }}\n          </a>\n        </template>\n        <template slot=\"course_status\" slot-scope=\"text\">\n          <st-text\n            :status=\"{\n              success: text.id === 1,\n              error: text.id === 3,\n              default: text.id === 2\n            }\"\n          >\n            {{ text.name }}\n          </st-text>\n        </template>\n      </st-table>\n      <entry-data v-else tip=\"您还未购买小班课^o^\"></entry-data>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ReserveService } from './reserve.service'\nimport tableMixin from '@/mixins/table.mixin'\nimport UserRange from './sold#/user-range'\nimport EntryData from './sold#/entry-data'\nimport {\n  memberCard,\n  depositCard,\n  personalCourse,\n  packageColumns,\n  smallCourse\n} from './reserve.config'\nimport { UserService } from '@/services/user.service'\n\nexport default {\n  mixins: [tableMixin],\n  bem: {\n    b: 'member-reserve'\n  },\n  name: 'InfoReserve',\n  serviceInject() {\n    return {\n      reserveService: ReserveService,\n      userService: UserService\n    }\n  },\n  rxState() {\n    const {\n      memberCardList$,\n      depositCardList$,\n      personalCourseList$,\n      packageList$,\n      smallCourseList$,\n      memberCardPage$,\n      depositCardPage$,\n      personalCoursePage$,\n      packagePage$,\n      smallCoursePage$\n    } = this.reserveService\n    return {\n      memberCardList$,\n      depositCardList$,\n      personalCourseList$,\n      packageList$,\n      smallCourseList$,\n      memberCardPage$,\n      depositCardPage$,\n      personalCoursePage$,\n      packagePage$,\n      smallCoursePage$,\n      cardConsumeList: this.userService.getOptions$('member.card_consume_type'),\n      courseConsumeList: this.userService.getOptions$(\n        'member.course_consume_type'\n      )\n    }\n  },\n  data() {\n    return {\n      cardquery: {\n        start_time: '',\n        card_type: 1,\n        keyword: ''\n      },\n      coursequery: {\n        buy_time: '',\n        course_type: 1,\n        keyword: ''\n      },\n      id: ''\n    }\n  },\n  components: {\n    UserRange,\n    EntryData\n  },\n  computed: {\n    memberCard,\n    depositCard,\n    personalCourse,\n    packageColumns,\n    smallCourse\n  },\n  methods: {\n    getSoldDetail(type, subType, id) {\n      window.open(\n        `${window.location.origin}/shop/sold/${type}/info/${subType}/info/operation-record?id=${id}`\n      )\n    },\n    onTableMemberChange(type, e) {\n      this.$searchQuery.type = type\n      this.reserveService\n        .changePage({\n          id: this.id,\n          type,\n          page: e.current,\n          size: e.pageSize\n        })\n        .subscribe()\n    },\n    memberInfo(record) {\n      const arr = record.members || []\n      let familyInfo = ''\n      if (record.card_number_type === 2) {\n        familyInfo = `卡成员：${arr\n          .filter(item => item.is_purchaser !== 1)\n          .map(item => item.member_info)\n          .join(',')}`\n      }\n      return `购卡人：${arr\n        .filter(item => item.is_purchaser === 1)\n        .map(item => item.member_info)\n        .join('')}${familyInfo}`\n    },\n    /**\n     * 设置页码\n     * cardOrCourse 卡或课\n     * current 当前页\n     * pageSize 每页条数\n     */\n    initPage(cardOrCourse, current_page, size) {\n      if (cardOrCourse === 1) {\n        this.cardPage.size = size\n        this.cardPage.current_page = current_page\n      } else if (cardOrCourse === 2) {\n        this.coursePage.current_page = current_page\n        this.coursePage.size = size\n      }\n    },\n    // 拼接入参\n    assignObj(cardOrCourse) {\n      if (cardOrCourse === 1) {\n        return Object.assign(this.cardPage, this.cardquery)\n      } else if (cardOrCourse === 2) {\n        return Object.assign(this.coursePage, this.coursequery)\n      }\n    },\n    // 选择日期\n    onChooseDate(date, str) {\n      console.log('======', date, str)\n      this.initPage(1, 1, 10)\n      this.cardquery.start_time = str\n      this.reserveService\n        .getCardInfo(this.id, this.assignObj(1))\n        .subscribe(res => {})\n    },\n    // 选择卡类型\n    onChooseCardType(e) {\n      console.log('选择卡', e)\n      this.initPage(1, 1, 10)\n      this.reserveService\n        .getCardInfo(this.id, this.assignObj(1))\n        .subscribe(res => {})\n    },\n    // 卡分页\n    cardPageChange(e) {\n      this.initPage(1, e.current, e.pageSize)\n      this.reserveService\n        .getCardInfo(this.id, this.assignObj(1))\n        .subscribe(res => {})\n    },\n    // 卡查询\n    searchMemberCard(e) {\n      this.initPage(1, 1, 10)\n      this.cardquery.keyword = e\n      this.reserveService\n        .getCardInfo(this.id, this.assignObj(1))\n        .subscribe(res => {})\n    },\n    // 课项选择时间\n    onChooseDateCourse(date, str) {\n      this.initPage(2, 1, 10)\n      this.coursequery.buy_time = str\n      this.reserveService\n        .getCourseInfo(this.id, this.assignObj(2))\n        .subscribe(res => {})\n    },\n    // 课项选择类型\n    onChooseCourseType(e) {\n      this.initPage(2, 1, 10)\n      this.reserveService\n        .getCourseInfo(this.id, this.assignObj(2))\n        .subscribe(res => {})\n    },\n    // 课查询\n    searchCourseName(e) {\n      this.initPage(2, 1, 10)\n      this.coursequery.keyword = e\n      this.reserveService\n        .getCourseInfo(this.id, this.assignObj(2))\n        .subscribe(res => {})\n    },\n    // 课分页\n    coursePageChange(e) {\n      this.initPage(2, e.current, e.pageSize)\n      this.reserveService\n        .getCourseInfo(this.id, this.assignObj(2))\n        .subscribe(res => {})\n    }\n  },\n  mounted() {\n    this.id = this.$searchQuery.id\n  }\n}\n</script>\n"]}]}