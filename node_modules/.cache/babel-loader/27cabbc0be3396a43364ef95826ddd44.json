{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/card/deposit/update-rights.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/card/deposit/update-rights.vue","mtime":1600926555934},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { UpdateRightsService } from \"./update-rights.service.ts\";\nimport { ruleOptions } from \"./update-rights.config\";\nimport { MessageService } from '@/services/message.service';\nimport AssignShop from '@/views/biz-components/shop/assign-shop/assign-shop';\nexport default {\n  components: {\n    AssignShop: AssignShop\n  },\n  serviceInject: function serviceInject() {\n    return {\n      messageService: MessageService,\n      updateRightsService: UpdateRightsService\n    };\n  },\n  rxState: function rxState() {\n    var _this$updateRightsSer = this.updateRightsService,\n        info$ = _this$updateRightsSer.info$,\n        loading$ = _this$updateRightsSer.loading$,\n        consumeTypeOptions$ = _this$updateRightsSer.consumeTypeOptions$,\n        transferUnitOptions$ = _this$updateRightsSer.transferUnitOptions$;\n    return {\n      info: info$,\n      loading: loading$,\n      consumeTypeOptions: consumeTypeOptions$,\n      transferUnitOptions: transferUnitOptions$\n    };\n  },\n  props: {\n    id: {\n      type: Number,\n      default: 0\n    }\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      show: false,\n      switches: {\n        consumeType: 0,\n        transferSetting: 0,\n        consumeShop: 0\n      }\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    this.updateRightsService.getInfo(this.id).subscribe(function (res) {\n      _this.$nextTick(function () {\n        _this.setFieldsValue(res.info);\n      });\n    });\n  },\n  methods: {\n    onShopChange: function onShopChange(type, shopIds) {\n      this.info.consumption_range.consumption_range_type = type;\n      this.info.consumption_range.select_shops = shopIds;\n    },\n    setFieldsValue: function setFieldsValue(info) {\n      var _info$transfer = info.transfer,\n          transfer_num = _info$transfer.transfer_num,\n          transfer_unit = _info$transfer.transfer_unit;\n      this.form.setFieldsValue({\n        transfer_num: transfer_num,\n        transfer_unit: transfer_unit || 1\n      });\n    },\n    onSwitchChange: function onSwitchChange() {\n      this.form.validateFields(['transfer_num', 'transfer_unit'], {\n        force: true\n      });\n    },\n    checkIsChanged: function checkIsChanged() {\n      var isChanged = false;\n      var switches = this.switches;\n\n      for (var i in switches) {\n        if (switches[i]) {\n          isChanged = true;\n          return true;\n        }\n      }\n\n      return isChanged;\n    },\n    onSubmit: function onSubmit() {\n      var _this2 = this;\n\n      if (!this.checkIsChanged()) {\n        return this.messageService.error({\n          content: '未进行任何修改，无法确认'\n        });\n      }\n\n      this.form.validate().then(function (values) {\n        var _this2$info = _this2.info,\n            transfer = _this2$info.transfer,\n            consumption_range = _this2$info.consumption_range,\n            support_consumers = _this2$info.support_consumers;\n        var switches = _this2.switches;\n        var params = {\n          is_change_consumers: switches.consumeType,\n          consumption_range_type: consumption_range.consumption_range_type,\n          support_consumers: support_consumers,\n          is_change_transferable: switches.transferSetting,\n          transfer_num: values.transfer_num,\n          transfer_unit: values.transfer_unit,\n          is_transferable: transfer.is_transferable,\n          is_change_consumption_range: switches.consumeShop,\n          select_shops: consumption_range.select_shops\n        };\n\n        _this2.updateRightsService.updateRights(_this2.id, params).subscribe(_this2.onSubmitSuccess);\n      });\n    },\n    onSubmitSuccess: function onSubmitSuccess() {\n      this.messageService.success({\n        content: '提交成功'\n      });\n      this.show = false;\n      this.$emit('success');\n    }\n  }\n};",{"version":3,"sources":["update-rights.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal title=\"修改售出权益\" v-model=\"show\">\n    <st-form :form=\"form\">\n      <st-form-item labelWidth=\"120px\" class=\"mg-b12\">\n        <template slot=\"label\">\n          <st-checkbox v-model=\"switches.consumeType\">\n            支持消费类型\n          </st-checkbox>\n        </template>\n        <a-checkbox-group\n          v-model=\"info.support_consumers\"\n          :disabled=\"!switches.consumeType\"\n        >\n          <a-row>\n            <a-col\n              :span=\"12\"\n              v-for=\"item in consumeTypeOptions\"\n              :key=\"item.value\"\n              class=\"mg-b12\"\n            >\n              <a-checkbox :value=\"item.value\">{{ item.label }}</a-checkbox>\n            </a-col>\n          </a-row>\n        </a-checkbox-group>\n      </st-form-item>\n      <st-form-item v-if=\"info.transfer\" labelWidth=\"88px\">\n        <template slot=\"label\">\n          <st-checkbox\n            v-model=\"switches.transferSetting\"\n            @change=\"onSwitchChange\"\n          >\n            转让设置\n          </st-checkbox>\n        </template>\n        <st-checkbox\n          :disabled=\"!switches.transferSetting\"\n          v-model=\"info.transfer.is_transferable\"\n        >\n          支持转让\n        </st-checkbox>\n        <st-input-number\n          v-show=\"info.transfer.is_transferable\"\n          v-decorator=\"decorators.transfer_num\"\n          style=\"width: 140px\"\n          :min=\"0\"\n          :max=\"form.getFieldValue('transfer_unit') === 1 ? 100 : 9999999.9\"\n          :disabled=\"!switches.transferSetting\"\n        >\n          <span slot=\"addonAfter\">\n            <a-select\n              v-decorator=\"decorators.transfer_unit\"\n              :options=\"transferUnitOptions\"\n              :disabled=\"!switches.transferSetting\"\n            ></a-select>\n          </span>\n        </st-input-number>\n      </st-form-item>\n      <assign-shop\n        v-if=\"info.consumption_range\"\n        :form=\"form\"\n        labelWidth=\"120px\"\n        :type=\"info.consumption_range.consumption_range_type\"\n        :shopIds=\"info.consumption_range.select_shops\"\n        :required=\"false\"\n        :disabled=\"!switches.consumeShop\"\n        @change=\"onShopChange\"\n      >\n        <template slot=\"label\">\n          <st-checkbox v-model=\"switches.consumeShop\">\n            支持消费门店\n          </st-checkbox>\n        </template>\n      </assign-shop>\n    </st-form>\n    <template slot=\"footer\">\n      <st-button\n        @click=\"onSubmit\"\n        type=\"primary\"\n        :loading=\"loading.updateRights\"\n      >\n        确认提交\n      </st-button>\n    </template>\n  </st-modal>\n</template>\n\n<script>\nimport { UpdateRightsService } from './update-rights.service.ts'\nimport { ruleOptions } from './update-rights.config'\nimport { MessageService } from '@/services/message.service'\nimport AssignShop from '@/views/biz-components/shop/assign-shop/assign-shop'\nexport default {\n  components: {\n    AssignShop\n  },\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      updateRightsService: UpdateRightsService\n    }\n  },\n  rxState() {\n    const {\n      info$,\n      loading$,\n      consumeTypeOptions$,\n      transferUnitOptions$\n    } = this.updateRightsService\n    return {\n      info: info$,\n      loading: loading$,\n      consumeTypeOptions: consumeTypeOptions$,\n      transferUnitOptions: transferUnitOptions$\n    }\n  },\n  props: {\n    id: {\n      type: Number,\n      default: 0\n    }\n  },\n  data() {\n    const form = this.$stForm.create()\n    const decorators = form.decorators(ruleOptions)\n    return {\n      form,\n      decorators,\n      show: false,\n      switches: {\n        consumeType: 0,\n        transferSetting: 0,\n        consumeShop: 0\n      }\n    }\n  },\n  created() {\n    this.updateRightsService.getInfo(this.id).subscribe(res => {\n      this.$nextTick(() => {\n        this.setFieldsValue(res.info)\n      })\n    })\n  },\n  methods: {\n    onShopChange(type, shopIds) {\n      this.info.consumption_range.consumption_range_type = type\n      this.info.consumption_range.select_shops = shopIds\n    },\n    setFieldsValue(info) {\n      const { transfer_num, transfer_unit } = info.transfer\n      this.form.setFieldsValue({\n        transfer_num,\n        transfer_unit: transfer_unit || 1\n      })\n    },\n    onSwitchChange() {\n      this.form.validateFields(['transfer_num', 'transfer_unit'], {\n        force: true\n      })\n    },\n    checkIsChanged() {\n      let isChanged = false\n      const { switches } = this\n      for (let i in switches) {\n        if (switches[i]) {\n          isChanged = true\n          return true\n        }\n      }\n      return isChanged\n    },\n    onSubmit() {\n      if (!this.checkIsChanged()) {\n        return this.messageService.error({\n          content: '未进行任何修改，无法确认'\n        })\n      }\n      this.form.validate().then(values => {\n        const { transfer, consumption_range, support_consumers } = this.info\n        const { switches } = this\n        const params = {\n          is_change_consumers: switches.consumeType,\n          consumption_range_type: consumption_range.consumption_range_type,\n          support_consumers,\n          is_change_transferable: switches.transferSetting,\n          transfer_num: values.transfer_num,\n          transfer_unit: values.transfer_unit,\n          is_transferable: transfer.is_transferable,\n          is_change_consumption_range: switches.consumeShop,\n          select_shops: consumption_range.select_shops\n        }\n        this.updateRightsService\n          .updateRights(this.id, params)\n          .subscribe(this.onSubmitSuccess)\n      })\n    },\n    onSubmitSuccess() {\n      this.messageService.success({\n        content: '提交成功'\n      })\n      this.show = false\n      this.$emit('success')\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/sold/card/deposit"}]}