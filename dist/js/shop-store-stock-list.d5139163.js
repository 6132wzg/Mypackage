(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["shop-store-stock-list"],{"2e52":function(t,e,n){"use strict";n.r(e),n.d(e,"SearchService",(function(){return f}));var o,s,c,a=n("d225"),r=n("b0b4"),i=n("9ab4"),u=n("0cd5"),l=n("df29"),d=n("c4cc"),p=n("d7a7"),h=n("2cbb"),f=function(){function t(e,n){Object(a["a"])(this,t),this.stockApi=e,this.authService=n,this.list$=new l["d"]([]),this.page$=new l["d"]({}),this.loading$=new l["d"]({}),this.auth$=this.authService.authMap$({warehousing:"shop:cloud_store:stock|batch_warehousing",retrieval:"shop:cloud_store:stock|batch_retrieval"})}return Object(r["a"])(t,[{key:"getList",value:function(t){var e=this;return this.stockApi.stockList(t).pipe(Object(d["a"])((function(t){e.list$.commit((function(){return t.list})),e.page$.commit((function(){return t.page}))})))}},{key:"beforeEach",value:function(t,e){return this.getList(t.meta.query)}}]),t}();Object(i["b"])([Object(l["c"])(),Object(i["d"])("design:type",Function),Object(i["d"])("design:paramtypes",["function"===typeof(o="undefined"!==typeof p["ListParams"]&&p["ListParams"])?o:Object]),Object(i["d"])("design:returntype",void 0)],f.prototype,"getList",null),f=Object(i["b"])([Object(u["b"])(),Object(i["d"])("design:paramtypes",["function"===typeof(s="undefined"!==typeof p["c"]&&p["c"])?s:Object,"function"===typeof(c="undefined"!==typeof h["a"]&&h["a"])?c:Object])],f)},7703:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.detail()},[n("div",{class:t.detail("search")},[n("a-select",{class:t.detail("search-select"),attrs:{dropdownMatchSelectWidth:!1,placeholder:"请选择商品"},on:{change:function(e){return t.onSingleSearch("product_id",e)}},model:{value:t.chooseGood,callback:function(e){t.chooseGood=e},expression:"chooseGood"}},t._l(t.productList,(function(e){return n("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v("\n        "+t._s(e.product_name)+"\n      ")])})),1),n("a-select",{class:t.detail("search-select"),attrs:{dropdownMatchSelectWidth:!1,placeholder:"出入库类型"},on:{change:function(e){return t.onSingleSearch("stock_flow",e)}},model:{value:t.stockType,callback:function(e){t.stockType=e},expression:"stockType"}},t._l(t.stockFlow,(function(e){return n("a-select-option",{key:e.value,attrs:{value:e.value}},[t._v("\n        "+t._s(e.label)+"\n      ")])})),1),n("a-range-picker",{class:t.detail("search-time"),attrs:{format:"YYYY-MM-DD"},on:{change:t.onChooseDate}})],1),n("div",[n("st-table",{attrs:{columns:t.detailColumns,dataSource:t.tableData,page:t.page,rowKey:"id"},on:{change:t.onTableChange},scopedSlots:t._u([{key:"remark",fn:function(t){return n("st-overflow-text",{attrs:{value:t}})}},{key:"stock_flow",fn:function(e,o){return[n("div",[t._v(t._s(o.stock_flow.doc))])]}},{key:"product_name",fn:function(e,o){return[t._v("\n        "+t._s(o.product_name)+"\n        "),o.sku_name?n("span",[t._v("（"+t._s(o.sku_name)+"）")]):t._e()]}}])})],1)])},s=[],c=[{title:"商品名称",dataIndex:"product_name",scopedSlots:{customRender:"product_name"}},{title:"商品分类",dataIndex:"category_name"},{title:"出入库类型",dataIndex:"stock_flow",scopedSlots:{customRender:"stock_flow"}},{title:"出入库",dataIndex:"change_amount"},{title:"剩余量",dataIndex:"surplus_amount"},{title:"操作时间",dataIndex:"operator_time"},{title:"操作人",dataIndex:"operator_name"},{title:"备注",dataIndex:"remark",slots:{title:"remark"},scopedSlots:{customRender:"remark"}}],a=n("c591"),r=n("ea3e"),i=n("c32d"),u=n.n(i),l={bem:{detail:"page-shop-store-stock-list-detail"},serviceInject:function(){return{detailService:a["DetailService"]}},rxState:function(){return{tableData:this.detailService.list$,loading:this.detailService.loading$,page:this.detailService.page$,productList:this.detailService.productList$,stockFlow:this.detailService.stockFlow$}},mixins:[r["a"]],data:function(){return{detailColumns:c,chooseGood:-1,stockType:-1}},methods:{onChooseDate:function(t){this.$router.push({query:{product_id:this.$searchQuery.product_id,stock_flow:this.$searchQuery.stock_flow,page:this.$searchQuery.page,size:this.$searchQuery.size,start_time:u()(t[0]).format("YYYY-MM-DD"),end_time:u()(t[1]).format("YYYY-MM-DD")}})}}},d=l,p=n("2877"),h=Object(p["a"])(d,o,s,!1,null,null,null);e["default"]=h.exports},a1c9:function(t,e,n){"use strict";n.r(e);var o,s,c,a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.search()},[n("portal",{attrs:{to:"SHOP_STORE_STOCK_KEYWORDS_SEARCH"}},[n("st-input-search",{attrs:{placeholder:"请输入商品名称",maxlength:"30"},on:{search:function(e){return t.onKeywordsSearch("product_name",e)}},model:{value:t.$searchQuery.product_name,callback:function(e){t.$set(t.$searchQuery,"product_name",e)},expression:"$searchQuery.product_name"}})],1),n("div",{class:t.search("btn")},[t.auth.warehousing?n("st-button",{class:t.search("btn--in"),attrs:{type:"primary",disabled:!t.selectedRowKeys.length},on:{click:function(e){return t.moreIn()}}},[t._v("\n      批量入库\n    ")]):t._e(),t.auth.retrieval?n("st-button",{attrs:{type:"primary",disabled:!t.selectedRowKeys.length},on:{click:function(e){return t.moreOut()}}},[t._v("\n      批量出库\n    ")]):t._e()],1),n("st-table",{attrs:{columns:t.searchColumns,dataSource:t.tableData,page:t.page,rowSelection:{onChange:t.onChange,selectedRowKeys:t.selectedRowKeys},rowKey:"sku_id"},on:{change:t.onTableChange},scopedSlots:t._u([{key:"product_name",fn:function(e,o){return[t._v("\n      "+t._s(o.product_name)+"\n      "),o.sku_name?n("span",[t._v("（"+t._s(o.sku_name)+"）")]):t._e()]}},{key:"action",fn:function(e,o){return[n("st-table-actions",[o.auth["shop:cloud_store:stock|warehousing"]?n("a",{on:{click:function(e){return t.moreIn(o)}}},[t._v("\n          入库\n        ")]):t._e(),o.auth["shop:cloud_store:stock|retrieval"]?n("a",{on:{click:function(e){return t.moreOut(o)}}},[t._v("\n          出库\n        ")]):t._e(),o.auth["shop:cloud_store:stock|one_goods_obvious"]?n("a",{on:{click:function(e){return t.goDetail(o)}}},[t._v("\n          明细\n        ")]):t._e()])]}}])})],1)},r=[],i=(n("ac6a"),[{title:"商品名称",dataIndex:"product_name",scopedSlots:{customRender:"product_name"}},{title:"商品分类",dataIndex:"category_name"},{title:"实际库存",dataIndex:"amount"},{title:"可用库存",dataIndex:"use_amount"},{title:"操作",dataIndex:"action",width:140,scopedSlots:{customRender:"action"}}]),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("st-modal",{attrs:{title:"入库",loading:t.loading.stockWarehouse},on:{ok:t.onSubmit},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[n("st-table",{attrs:{columns:t.columns,dataSource:t.skuList,rowKey:"sku_id",page:!1},scopedSlots:t._u([{key:"stock_amount",fn:function(e,o){return[n("st-input-number",{staticStyle:{width:"110px"},attrs:{float:!0},model:{value:o.stock_amount,callback:function(e){t.$set(o,"stock_amount",e)},expression:"record.stock_amount"}})]}},{key:"remark",fn:function(e,o){return[n("a-input",{staticStyle:{width:"110px"},attrs:{float:!0},model:{value:o.remark,callback:function(e){t.$set(o,"remark",e)},expression:"record.remark"}})]}}])})],1)},l=[],d=[{title:"商品名称",dataIndex:"product_name"},{title:"可用库存",dataIndex:"use_amount"},{title:"入库数",dataIndex:"stock_amount",slots:{title:"stock_amount"},scopedSlots:{customRender:"stock_amount"}},{title:"备注",dataIndex:"remark",slots:{title:"remark"},scopedSlots:{customRender:"remark"}}],p=n("d225"),h=n("b0b4"),f=n("9ab4"),m=n("0cd5"),b=n("df29"),k=n("d7a7"),y=function(){function t(e){Object(p["a"])(this,t),this.stockApi=e,this.loading$=new b["d"]({})}return Object(h["a"])(t,[{key:"stockWarehouse",value:function(t){return this.stockApi.stockWarehouse(t)}},{key:"stockOutbound",value:function(t){return this.stockApi.stockOutbound(t)}}]),t}();Object(f["b"])([Object(b["c"])(),Object(f["d"])("design:type",Function),Object(f["d"])("design:paramtypes",["function"===typeof(o="undefined"!==typeof k["WarehouseParams"]&&k["WarehouseParams"])?o:Object]),Object(f["d"])("design:returntype",void 0)],y.prototype,"stockWarehouse",null),Object(f["b"])([Object(b["c"])(),Object(f["d"])("design:type",Function),Object(f["d"])("design:paramtypes",["function"===typeof(s="undefined"!==typeof k["WarehouseParams"]&&k["WarehouseParams"])?s:Object]),Object(f["d"])("design:returntype",void 0)],y.prototype,"stockOutbound",null),y=Object(f["b"])([Object(m["b"])(),Object(f["d"])("design:paramtypes",["function"===typeof(c="undefined"!==typeof k["c"]&&k["c"])?c:Object])],y);var v,_,O=n("5c8a"),g=n("2a5b"),S={serviceInject:function(){return{putInService:y,notificationService:g["a"]}},rxState:function(){return{loading:this.putInService.loading$}},data:function(){return{show:!1,columns:d,skuList:[]}},props:{list:{type:Array,default:function(){return[]}}},mounted:function(){this.skuList=Object(O["a"])(this.list)},methods:{onSubmit:function(){var t=this,e=this.skuList.some((function(t){return!t.stock_amount})),n=this.skuList.some((function(t){return"0"===t.stock_amount}));e?this.notificationService.error({title:"保存失败",content:"入库数不能为空"}):n?this.notificationService.error({title:"保存失败",content:"入库数不能为0"}):this.putInService.stockWarehouse({stock:this.skuList}).subscribe((function(e){t.$emit("success"),t.show=!1}))}}},j=S,w=n("2877"),$=Object(w["a"])(j,u,l,!1,null,null,null),x=$.exports,L=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("st-modal",{attrs:{title:"出库",loading:t.loading.stockOutbound},on:{ok:t.onSubmit},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[n("st-table",{attrs:{columns:t.columns,dataSource:t.skuList,rowKey:"sku_id",page:!1},scopedSlots:t._u([{key:"stock_amount",fn:function(e,o){return[n("st-input-number",{staticStyle:{width:"110px"},attrs:{float:!0},model:{value:o.stock_amount,callback:function(e){t.$set(o,"stock_amount",e)},expression:"record.stock_amount"}})]}},{key:"remark",fn:function(e,o){return[n("a-input",{staticStyle:{width:"110px"},attrs:{float:!0},model:{value:o.remark,callback:function(e){t.$set(o,"remark",e)},expression:"record.remark"}})]}}])})],1)},I=[],R=[{title:"商品名称",dataIndex:"product_name"},{title:"可用库存",dataIndex:"use_amount"},{title:"出库数",dataIndex:"stock_amount",slots:{title:"stock_amount"},scopedSlots:{customRender:"stock_amount"}},{title:"备注",dataIndex:"remark",slots:{title:"remark"},scopedSlots:{customRender:"remark"}}],D=function(){function t(e){Object(p["a"])(this,t),this.stockApi=e,this.loading$=new b["d"]({})}return Object(h["a"])(t,[{key:"stockOutbound",value:function(t){return this.stockApi.stockOutbound(t)}}]),t}();Object(f["b"])([Object(b["c"])(),Object(f["d"])("design:type",Function),Object(f["d"])("design:paramtypes",["function"===typeof(v="undefined"!==typeof k["WarehouseParams"]&&k["WarehouseParams"])?v:Object]),Object(f["d"])("design:returntype",void 0)],D.prototype,"stockOutbound",null),D=Object(f["b"])([Object(m["b"])(),Object(f["d"])("design:paramtypes",["function"===typeof(_="undefined"!==typeof k["c"]&&k["c"])?_:Object])],D);var K={serviceInject:function(){return{putOutService:D,notificationService:g["a"]}},rxState:function(){return{loading:this.putOutService.loading$}},data:function(){return{show:!1,columns:R,skuList:[]}},props:{list:{type:Array,default:function(){return[]}}},mounted:function(){this.skuList=Object(O["a"])(this.list)},methods:{onSubmit:function(){var t=this,e=this.skuList.some((function(t){return!t.stock_amount})),n=this.skuList.some((function(t){return"0"===t.stock_amount}));e?this.notificationService.error({title:"保存失败",content:"出库数不能为空"}):n?this.notificationService.error({title:"保存失败",content:"出库数不能为0"}):this.putOutService.stockOutbound({stock:this.skuList}).subscribe((function(e){t.$emit("success"),t.show=!1}))}}},W=K,A=Object(w["a"])(W,L,I,!1,null,null,null),P=A.exports,C=n("ea3e"),E=n("2e52"),Y=n("0a94"),F={bem:{search:"page-shop-store-stock-list-search"},serviceInject:function(){return{searchService:E["SearchService"]}},rxState:function(){return{tableData:this.searchService.list$,loading:this.searchService.loading$,page:this.searchService.page$,auth:this.searchService.auth$}},mixins:[C["a"]],data:function(){return{searchColumns:i,name:"",selectedRowKeys:[]}},modals:{StorePutIn:x,StorePutOut:P},methods:{onChange:function(t){this.selectedRowKeys=t},moreIn:function(t){var e=this,n=[];t?n=[t]:this.selectedRowKeys.forEach((function(t){var o=Object(Y["a"])(e.tableData,(function(e){return e.sku_id===t}));n.push(o)})),n.forEach((function(t){t.remark=""})),this.$modalRouter.push({name:"store-put-in",props:{list:n},on:{success:function(){e.selectedRowKeys=[],e.$router.reload()}}})},moreOut:function(t){var e=this,n=[];t?n=[t]:this.selectedRowKeys.forEach((function(t){var o=e.tableData.filter((function(e){return e.sku_id===t}))[0];n.push(o)})),n.forEach((function(t){t.remark=""})),this.$modalRouter.push({name:"store-put-out",props:{list:n},on:{success:function(){e.selectedRowKeys=[],e.$router.reload()}}})},goDetail:function(t){this.$router.push({path:"./detail",query:{product_id:t.product_id,page:1}})}}},M=F,T=Object(w["a"])(M,a,r,!1,null,null,null);e["default"]=T.exports},c591:function(t,e,n){"use strict";n.r(e),n.d(e,"DetailService",(function(){return m}));var o,s,c,a=n("d225"),r=n("b0b4"),i=n("9ab4"),u=n("0cd5"),l=n("df29"),d=n("c4cc"),p=n("d7a7"),h=n("c170"),f=n("2138"),m=function(){function t(e,n){Object(a["a"])(this,t),this.stockApi=e,this.userService=n,this.list$=new l["d"]([]),this.productList$=new l["d"]([]),this.page$=new l["d"]({}),this.loading$=new l["d"]({}),this.stockFlow$=this.userService.getOptions$("cloud_store.stock_flow",{addAll:"全部类型"})}return Object(r["a"])(t,[{key:"getList",value:function(t){var e=this;return this.stockApi.stockDetailList(t).pipe(Object(d["a"])((function(t){e.list$.commit((function(){return t.list})),e.page$.commit((function(){return t.page}))})))}},{key:"productList",value:function(){var t=this;return this.stockApi.productList().pipe(Object(d["a"])((function(e){e.list.unshift({id:-1,product_name:"全部商品"}),t.productList$.commit((function(){return e.list}))})))}},{key:"init",value:function(t){return Object(h["a"])(this.getList(t),this.productList())}},{key:"beforeEach",value:function(t,e){return this.init(t.meta.query)}}]),t}();Object(i["b"])([Object(l["c"])(),Object(i["d"])("design:type",Function),Object(i["d"])("design:paramtypes",["function"===typeof(o="undefined"!==typeof p["DetailParams"]&&p["DetailParams"])?o:Object]),Object(i["d"])("design:returntype",void 0)],m.prototype,"getList",null),m=Object(i["b"])([Object(u["b"])(),Object(i["d"])("design:paramtypes",["function"===typeof(s="undefined"!==typeof p["c"]&&p["c"])?s:Object,"function"===typeof(c="undefined"!==typeof f["a"]&&f["a"])?c:Object])],m)},d7a7:function(t,e,n){"use strict";n.d(e,"c",(function(){return d}));n("6b54"),n("2397");var o=n("d225"),s=n("b0b4"),c=n("308d"),a=n("6bb5"),r=n("4e2b"),i=n("de46");function u(t){return function(){var e,n=Object(a["a"])(t);if(l()){var o=Object(a["a"])(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return Object(c["a"])(this,e)}}function l(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var d=function(t){Object(r["a"])(n,t);var e=u(n);function n(){return Object(o["a"])(this,n),e.apply(this,arguments)}return Object(s["a"])(n,[{key:"stockList",value:function(t){return this.http.get("/v1/store/stock/list",{query:t})}},{key:"stockDetailList",value:function(t){return this.http.get("/v1/store/stock/turnover",{query:t})}},{key:"stockWarehouse",value:function(t){return this.http.post("/v1/store/stock/warehouse",{params:t})}},{key:"stockOutbound",value:function(t){return this.http.post("/v1/store/stock/outbound",{params:t})}},{key:"productList",value:function(){return this.http.get("/v1/store/product/search/list")}}]),n}(i["a"])}}]);