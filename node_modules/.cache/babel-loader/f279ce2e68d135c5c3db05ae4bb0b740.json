{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/batch/course-rank-preview.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/schedule/batch/course-rank-preview.vue","mtime":1600926555895},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport _defineProperty from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { CourseRankPreviewService } from \"./course-rank-preview.service\";\nimport { UserService } from '@/services/user.service';\nimport { columns } from \"./course-rank-preview.config\";\nimport { TeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/team/service#/common.service';\nimport { PersonalTeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/personal-team/service#/common.service';\nimport { cloneDeep } from 'lodash-es';\nimport { MessageService } from '@/services/message.service';\nexport default {\n  serviceInject: function serviceInject() {\n    return {\n      courseRankPreviewService: CourseRankPreviewService,\n      teamScheduleCommonService: TeamScheduleCommonService,\n      personalTeamScheduleCommonService: PersonalTeamScheduleCommonService,\n      userService: UserService,\n      messageService: MessageService\n    };\n  },\n  rxState: function rxState() {\n    var tss = this.teamScheduleCommonService;\n    var sms = this.personalTeamScheduleCommonService;\n    return {\n      loading: this.courseRankPreviewService.loading$,\n      coachOptionTeam: tss.coachOptions$,\n      courseOptionTeam: tss.courseOptions$,\n      courtOptionTeam: tss.courtOptions$,\n      courseOptionSmall: sms.courseOptions$,\n      coachOptionSmall: sms.coachOptions$,\n      weekDay: this.userService.enums$\n    };\n  },\n  bem: {\n    basic: 'modal-schedule-batch-course-rank-preview'\n  },\n  name: 'courseRankPreviewService',\n  props: {\n    dataTable: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    type: {\n      type: String,\n      default: ''\n    }\n  },\n  filters: {\n    formatDate: function formatDate(val) {\n      return val ? moment(val) : undefined;\n    }\n  },\n  data: function data() {\n    return {\n      courseType: 'all',\n      // 课程状态：全部课程all  部分课程part\n      show: false,\n      amountValid: 0,\n      courseSchedule: [],\n      weekDays: {},\n      coachOptions: [],\n      courseOptions: [],\n      courtOptions: [],\n      courseScheduleOld: []\n    };\n  },\n  methods: {\n    // 课程标签切换触发\n    handleSizeChange: function handleSizeChange(e) {\n      this.courseType = e.target.value;\n      var partData = this.courseScheduleOld.filter(function (item, index) {\n        if (item.is_valid) {\n          return _objectSpread({}, item);\n        }\n      });\n\n      if (this.courseScheduleOld.length === partData.length) {\n        return;\n      }\n\n      if (e.target.value === 'part') {\n        this.courseSchedule = partData;\n      } else {\n        this.courseSchedule = cloneDeep(this.courseScheduleOld);\n      }\n    },\n    // 确定排期，开始验证\n    save: function save() {\n      var _this = this;\n\n      var params = [];\n      params = this.courseScheduleOld.map(function (item) {\n        return {\n          course_id: item.course_id.data,\n          coach_id: item.coach_id.data,\n          court_id: item.site_id[0] || 0,\n          court_site_id: item.site_id[1] || 0,\n          limit_num: item.limit_num.data,\n          is_support_reserve_once: item.is_support_reserve_once.data,\n          course_fee: item.course_fee.data,\n          start_time: item.start_time.data,\n          reserve_limit_time: item.reserve_limit_time,\n          reserve_limit_type: item.reserve_limit_type\n        };\n      });\n      var functionName = this.type === 'team' ? 'validTeamBatch' : 'validSmallBatch';\n      this.courseRankPreviewService[functionName](params).subscribe(function (res) {\n        if (res.is_commit) {\n          _this.teamBatch(params);\n        } else {\n          var data = res.course_schedule.map(function (item) {\n            return _objectSpread({}, item, {\n              week_day: {\n                valid: 0,\n                data: item.week\n              }\n            });\n          });\n\n          _this.messageService.warn({\n            content: '存在冲突无法提交'\n          });\n\n          _this.dataTable.amount = res.amount;\n          res.course_schedule = data;\n\n          _this.processing(res);\n        }\n      });\n    },\n    // 确定排期\n    teamBatch: function teamBatch(data) {\n      var _this2 = this;\n\n      var functionName = this.type === 'team' ? 'teamBatch' : 'smallBatch';\n      this.courseRankPreviewService[functionName](data).subscribe(function (res) {\n        _this2.$emit('success', res);\n\n        _this2.messageService.success({\n          content: '排课成功'\n        });\n\n        _this2.show = false;\n      });\n    },\n    // 排期课程删除\n    onDelCourse: function onDelCourse(data, item) {\n      this.courseSchedule.splice(data, 1);\n      this.courseScheduleOld = this.courseScheduleOld.filter(function (res) {\n        if (res.index !== item.index) {\n          return _objectSpread({}, res);\n        }\n      });\n      console.log(this.courseSchedule, 'show');\n      console.log(this.courseScheduleOld, 'old');\n    },\n    onEditCourse: function onEditCourse(data, index) {\n      this.courseSchedule[index].isEdit = !data;\n    },\n    // 改变选择教练与课程后的数据\n    handleChange: function handleChange(e, index, type, item) {\n      this.courseSchedule[index][type].name = e.label.replace(/[\\r\\n]/g, '');\n      this.courseSchedule[index][type].data = e.key;\n      this.changeRed(index, item);\n    },\n    // 改变场地数据\n    courtChange: function courtChange(e, i, item) {\n      var _this3 = this;\n\n      var id = e[0];\n      var childrenId = e[1];\n      this.courtOptions.forEach(function (item) {\n        if (item.id === id) {\n          _this3.courseSchedule[i].court_id.name = item.name;\n          _this3.courseSchedule[i].court_site_id.data = 0;\n          _this3.courseSchedule[i].court_site_id.name = '';\n\n          if (item.children && item.children.length && childrenId) {\n            item.children.forEach(function (ele) {\n              if (ele.id === childrenId) {\n                _this3.courseSchedule[i].court_site_id.data = ele.id;\n                _this3.courseSchedule[i].court_site_id.name = ele.name;\n              }\n            });\n          }\n        }\n      });\n      this.changeRed(i, item);\n    },\n    // 改变时间数据\n    handleChangeTime: function handleChangeTime(e, i, type, item) {\n      var d = moment(e).format('d') == 0 ? 7 : moment(e).format('d');\n      this.courseSchedule[i].week_day.data = d;\n      this.courseSchedule[i][type].data = moment(e).format('YYYY-MM-DD HH:mm');\n      this.changeRed(i, item);\n    },\n    changeRed: function changeRed(i, item) {\n      this.courseSchedule[i].court_id.valid = 0;\n      this.courseSchedule[i].court_site_id.valid = 0;\n      this.courseSchedule[i].start_time.valid = 0;\n      this.courseSchedule[i].week_day.valid = 0;\n      this.courseSchedule[i].coach_id.valid = 0;\n      this.courseSchedule[i].limit_num.valid = 0;\n      this.courseSchedule[i].course_fee.valid = 0;\n\n      for (var x = 0; x < this.courseScheduleOld.length; x++) {\n        var res = this.courseScheduleOld[x];\n\n        if (res.index === item.index) {\n          this.courseScheduleOld[x] = item;\n          return;\n        }\n      }\n    },\n    // 显示数据处理\n    processing: function processing(data) {\n      this.amountValid = data.amount_valid;\n      this.courseSchedule = data.course_schedule.map(function (item, index) {\n        return _objectSpread({\n          id: index,\n          isEdit: false\n        }, item, {\n          site_id: [item.court_id.data, item.court_site_id.data],\n          course_id_label: {\n            key: item.course_id.data,\n            label: item.course_id.name\n          },\n          coach_id_label: {\n            key: item.coach_id.data,\n            label: item.coach_id.name\n          },\n          index: index\n        });\n      });\n      this.courseScheduleOld = cloneDeep(this.courseSchedule);\n    },\n    onSingleReserveChange: function onSingleReserveChange(index) {\n      this.courseSchedule[index].is_support_reserve_once.data = val;\n    }\n  },\n  created: function created() {\n    // 获取团课和私教小团课的课程和教练的选择项\n    if (this.type === 'team') {\n      this.coachOptions = this.coachOptionTeam; // 教练\n\n      this.courseOptions = this.courseOptionTeam; // 课程\n\n      this.courtOptions = this.courtOptionTeam; // 场地\n    } else {\n      this.coachOptions = this.coachOptionSmall; // 教练\n\n      this.courseOptions = this.courseOptionSmall; // 课程\n    }\n\n    if (this.type === 'small') {\n      this.columns.splice(4, 1);\n    }\n\n    this.weekDays = this.weekDay.shop.week_day.value;\n    this.processing(this.dataTable);\n  },\n  computed: {\n    columns: columns\n  }\n};",{"version":3,"sources":["course-rank-preview.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <st-modal\n    :title=\"`${type === 'small' ? '私教小' : ''}团课批量排期预览`\"\n    v-model=\"show\"\n    width=\"1160px\"\n  >\n    <template slot=\"footer\">\n      <a-tooltip\n        placement=\"topRight\"\n        title=\"关闭后课程排期不再保留\"\n        overlayClassName=\"modal-schedule-batch-course-rank-preview-tooltip\"\n      >\n        <st-button @click=\"show = false\">关闭</st-button>\n      </a-tooltip>\n      <st-button\n        type=\"primary\"\n        @click=\"save\"\n        :loading=\"\n          type === 'team' ? loading.validTeamBatch : loading.validSmallBatch\n        \"\n      >\n        确认\n      </st-button>\n    </template>\n    <div :class=\"basic()\">\n      <div :class=\"basic('title')\">\n        <p :class=\"basic('title--show')\">\n          <span class=\"mg-r16\">\n            总排课数：{{\n              dataTable.amount ? dataTable.amount : 0\n            }}节&nbsp;&nbsp;&nbsp;\n          </span>\n          冲突节数：\n          <span :class=\"basic('title--high')\">{{ amountValid }}节</span>\n        </p>\n        <a-radio-group :value=\"courseType\" @change=\"handleSizeChange\">\n          <a-radio-button value=\"all\">全部课程</a-radio-button>\n          <a-radio-button value=\"part\">冲突课程</a-radio-button>\n        </a-radio-group>\n      </div>\n      <div :class=\"basic('table-box')\" class=\"mg-t16\">\n        <st-table\n          rowKey=\"id\"\n          :pagination=\"false\"\n          :columns=\"columns\"\n          :dataSource=\"courseSchedule\"\n        >\n          <template slot=\"week_day\" slot-scope=\"customRender\">\n            <div :class=\"customRender.valid ? 'color_red' : ''\">\n              {{ weekDays[customRender.data] }}\n            </div>\n          </template>\n          <template slot=\"course_id\" slot-scope=\"customRender, record, index\">\n            <!-- 选择课程 -->\n            <a-select\n              v-if=\"record.isEdit\"\n              placeholder=\"请选择课程\"\n              v-model=\"record.course_id_label\"\n              style=\"width: 100px\"\n              labelInValue\n              @change=\"e => handleChange(e, index, 'course_id', record)\"\n            >\n              <a-select-option v-for=\"course in courseOptions\" :key=\"course.id\">\n                {{ type === 'team' ? course.course_name : course.name }}\n              </a-select-option>\n            </a-select>\n            <div :class=\"customRender.valid ? 'color_red' : ''\" v-else>\n              {{ customRender.name }}\n            </div>\n          </template>\n          <!-- 选择时间 -->\n          <template slot=\"start_time\" slot-scope=\"customRender, record, index\">\n            <a-date-picker\n              v-if=\"record.isEdit\"\n              :showTime=\"{ format: 'HH:mm' }\"\n              format=\"YYYY-MM-DD HH:mm\"\n              placeholder=\"请选择时间\"\n              style=\"width: 156px\"\n              :allowClear=\"false\"\n              :value=\"customRender.data | formatDate\"\n              @change=\"e => handleChangeTime(e, index, 'start_time', record)\"\n            />\n            <div :class=\"customRender.valid ? 'color_red' : ''\" v-else>\n              {{ customRender.data }}\n            </div>\n          </template>\n          <!-- 选择教练 -->\n          <template slot=\"coach_id\" slot-scope=\"customRender, record, index\">\n            <a-select\n              v-if=\"record.isEdit\"\n              :placeholder=\"`请选择${$c('coach')}`\"\n              v-model=\"record.coach_id_label\"\n              labelInValue\n              @change=\"e => handleChange(e, index, 'coach_id', record)\"\n              style=\"width: 100px\"\n            >\n              <a-select-option v-for=\"coach in coachOptions\" :key=\"coach.id\">\n                {{ type === 'team' ? coach.staff_name : coach.name }}\n              </a-select-option>\n            </a-select>\n            <div :class=\"customRender.valid ? 'color_red' : ''\" v-else>\n              {{ customRender.name }}\n            </div>\n          </template>\n          <!-- 选择场地 -->\n          <template\n            slot=\"court_id\"\n            v-if=\"type === 'team'\"\n            slot-scope=\"customRender, record, index\"\n          >\n            <a-cascader\n              v-if=\"record.isEdit\"\n              placeholder=\"请选择场地\"\n              v-model=\"record.site_id\"\n              :options=\"courtOptions\"\n              labelInValue\n              @change=\"e => courtChange(e, index, record)\"\n              :fieldNames=\"{ label: 'name', value: 'id', children: 'children' }\"\n            />\n            <div\n              :class=\"\n                record.court_id.valid || record.court_site_id.valid\n                  ? 'color_red'\n                  : ''\n              \"\n              v-else\n            >\n              {{ record.court_id.name\n              }}{{\n                record.court_site_id.data ? `-${record.court_site_id.name}` : ''\n              }}\n            </div>\n          </template>\n          <template slot=\"limit_num\" slot-scope=\"customRender, record, index\">\n            <st-input-number\n              v-if=\"record.isEdit\"\n              v-model=\"customRender.data\"\n              style=\"width:100px\"\n              @change=\"changeRed(index, record)\"\n            ></st-input-number>\n            <div :class=\"customRender.valid ? 'color_red' : ''\" v-else>\n              {{ customRender.data }}\n            </div>\n          </template>\n          <template slot=\"course_fee\" slot-scope=\"customRender, record, index\">\n            <div v-if=\"record.isEdit\">\n              <st-checkbox\n                v-model=\"record.is_support_reserve_once.data\"\n                @change=\"onSingleReserveChange(index)\"\n              >\n                支持单节付费预约\n              </st-checkbox>\n              <st-input-number\n                v-if=\"record.is_support_reserve_once.data\"\n                v-model=\"customRender.data\"\n                :float=\"true\"\n                @change=\"changeRed(index, record)\"\n                style=\"width: 150px\"\n                class=\"mg-t4\"\n              >\n                <span slot=\"addonAfter\" class=\"addon-width\">元/节</span>\n              </st-input-number>\n            </div>\n            <div :class=\"customRender.valid ? 'color_red' : ''\" v-else>\n              {{\n                record.is_support_reserve_once.data ? customRender.data : '--'\n              }}\n            </div>\n          </template>\n          <template slot=\"action\" slot-scope=\"customRender, record, index\">\n            <a @click=\"onEditCourse(record.isEdit, index)\" class=\"mg-r16\">\n              {{ record.isEdit ? '保存' : '修改' }}\n            </a>\n            <a @click=\"onDelCourse(index, record)\">删除</a>\n          </template>\n        </st-table>\n      </div>\n      <div :class=\"basic('prompt')\">注：标红部分即为课程冲突信息</div>\n    </div>\n  </st-modal>\n</template>\n<script>\nimport { CourseRankPreviewService } from './course-rank-preview.service'\nimport { UserService } from '@/services/user.service'\nimport { columns } from './course-rank-preview.config'\nimport { TeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/team/service#/common.service'\nimport { PersonalTeamScheduleCommonService } from '@/views/pages/shop/product/course/schedule/personal-team/service#/common.service'\nimport { cloneDeep } from 'lodash-es'\nimport { MessageService } from '@/services/message.service'\nexport default {\n  serviceInject() {\n    return {\n      courseRankPreviewService: CourseRankPreviewService,\n      teamScheduleCommonService: TeamScheduleCommonService,\n      personalTeamScheduleCommonService: PersonalTeamScheduleCommonService,\n      userService: UserService,\n      messageService: MessageService\n    }\n  },\n  rxState() {\n    const tss = this.teamScheduleCommonService\n    const sms = this.personalTeamScheduleCommonService\n    return {\n      loading: this.courseRankPreviewService.loading$,\n      coachOptionTeam: tss.coachOptions$,\n      courseOptionTeam: tss.courseOptions$,\n      courtOptionTeam: tss.courtOptions$,\n      courseOptionSmall: sms.courseOptions$,\n      coachOptionSmall: sms.coachOptions$,\n      weekDay: this.userService.enums$\n    }\n  },\n  bem: {\n    basic: 'modal-schedule-batch-course-rank-preview'\n  },\n  name: 'courseRankPreviewService',\n  props: {\n    dataTable: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    },\n    type: {\n      type: String,\n      default: ''\n    }\n  },\n  filters: {\n    formatDate(val) {\n      return val ? moment(val) : undefined\n    }\n  },\n  data() {\n    return {\n      courseType: 'all', // 课程状态：全部课程all  部分课程part\n      show: false,\n      amountValid: 0,\n      courseSchedule: [],\n      weekDays: {},\n      coachOptions: [],\n      courseOptions: [],\n      courtOptions: [],\n      courseScheduleOld: []\n    }\n  },\n  methods: {\n    // 课程标签切换触发\n    handleSizeChange(e) {\n      this.courseType = e.target.value\n      let partData = this.courseScheduleOld.filter((item, index) => {\n        if (item.is_valid) {\n          return {\n            ...item\n          }\n        }\n      })\n      if (this.courseScheduleOld.length === partData.length) {\n        return\n      }\n      if (e.target.value === 'part') {\n        this.courseSchedule = partData\n      } else {\n        this.courseSchedule = cloneDeep(this.courseScheduleOld)\n      }\n    },\n    // 确定排期，开始验证\n    save() {\n      let params = []\n      params = this.courseScheduleOld.map(item => {\n        return {\n          course_id: item.course_id.data,\n          coach_id: item.coach_id.data,\n          court_id: item.site_id[0] || 0,\n          court_site_id: item.site_id[1] || 0,\n          limit_num: item.limit_num.data,\n          is_support_reserve_once: item.is_support_reserve_once.data,\n          course_fee: item.course_fee.data,\n          start_time: item.start_time.data,\n          reserve_limit_time: item.reserve_limit_time,\n          reserve_limit_type: item.reserve_limit_type\n        }\n      })\n      let functionName =\n        this.type === 'team' ? 'validTeamBatch' : 'validSmallBatch'\n      this.courseRankPreviewService[functionName](params).subscribe(res => {\n        if (res.is_commit) {\n          this.teamBatch(params)\n        } else {\n          let data = res.course_schedule.map(item => {\n            return {\n              ...item,\n              week_day: {\n                valid: 0,\n                data: item.week\n              }\n            }\n          })\n          this.messageService.warn({ content: '存在冲突无法提交' })\n          this.dataTable.amount = res.amount\n          res.course_schedule = data\n          this.processing(res)\n        }\n      })\n    },\n    // 确定排期\n    teamBatch(data) {\n      let functionName = this.type === 'team' ? 'teamBatch' : 'smallBatch'\n      this.courseRankPreviewService[functionName](data).subscribe(res => {\n        this.$emit('success', res)\n        this.messageService.success({ content: '排课成功' })\n        this.show = false\n      })\n    },\n    // 排期课程删除\n    onDelCourse(data, item) {\n      this.courseSchedule.splice(data, 1)\n      this.courseScheduleOld = this.courseScheduleOld.filter(res => {\n        if (res.index !== item.index) {\n          return {\n            ...res\n          }\n        }\n      })\n      console.log(this.courseSchedule, 'show')\n      console.log(this.courseScheduleOld, 'old')\n    },\n    onEditCourse(data, index) {\n      this.courseSchedule[index].isEdit = !data\n    },\n    // 改变选择教练与课程后的数据\n    handleChange(e, index, type, item) {\n      this.courseSchedule[index][type].name = e.label.replace(/[\\r\\n]/g, '')\n      this.courseSchedule[index][type].data = e.key\n      this.changeRed(index, item)\n    },\n    // 改变场地数据\n    courtChange(e, i, item) {\n      const id = e[0]\n      const childrenId = e[1]\n      this.courtOptions.forEach(item => {\n        if (item.id === id) {\n          this.courseSchedule[i].court_id.name = item.name\n          this.courseSchedule[i].court_site_id.data = 0\n          this.courseSchedule[i].court_site_id.name = ''\n          if (item.children && item.children.length && childrenId) {\n            item.children.forEach(ele => {\n              if (ele.id === childrenId) {\n                this.courseSchedule[i].court_site_id.data = ele.id\n                this.courseSchedule[i].court_site_id.name = ele.name\n              }\n            })\n          }\n        }\n      })\n      this.changeRed(i, item)\n    },\n    // 改变时间数据\n    handleChangeTime(e, i, type, item) {\n      let d = moment(e).format('d') == 0 ? 7 : moment(e).format('d')\n      this.courseSchedule[i].week_day.data = d\n      this.courseSchedule[i][type].data = moment(e).format('YYYY-MM-DD HH:mm')\n      this.changeRed(i, item)\n    },\n    changeRed(i, item) {\n      this.courseSchedule[i].court_id.valid = 0\n      this.courseSchedule[i].court_site_id.valid = 0\n      this.courseSchedule[i].start_time.valid = 0\n      this.courseSchedule[i].week_day.valid = 0\n      this.courseSchedule[i].coach_id.valid = 0\n      this.courseSchedule[i].limit_num.valid = 0\n      this.courseSchedule[i].course_fee.valid = 0\n      for (let x = 0; x < this.courseScheduleOld.length; x++) {\n        let res = this.courseScheduleOld[x]\n        if (res.index === item.index) {\n          this.courseScheduleOld[x] = item\n          return\n        }\n      }\n    },\n    // 显示数据处理\n    processing(data) {\n      this.amountValid = data.amount_valid\n      this.courseSchedule = data.course_schedule.map((item, index) => {\n        return {\n          id: index,\n          isEdit: false,\n          ...item,\n          site_id: [item.court_id.data, item.court_site_id.data],\n          course_id_label: {\n            key: item.course_id.data,\n            label: item.course_id.name\n          },\n          coach_id_label: {\n            key: item.coach_id.data,\n            label: item.coach_id.name\n          },\n          index\n        }\n      })\n      this.courseScheduleOld = cloneDeep(this.courseSchedule)\n    },\n    onSingleReserveChange(index) {\n      this.courseSchedule[index].is_support_reserve_once.data = val\n    }\n  },\n  created() {\n    // 获取团课和私教小团课的课程和教练的选择项\n    if (this.type === 'team') {\n      this.coachOptions = this.coachOptionTeam // 教练\n      this.courseOptions = this.courseOptionTeam // 课程\n      this.courtOptions = this.courtOptionTeam // 场地\n    } else {\n      this.coachOptions = this.coachOptionSmall // 教练\n      this.courseOptions = this.courseOptionSmall // 课程\n    }\n    if (this.type === 'small') {\n      this.columns.splice(4, 1)\n    }\n    this.weekDays = this.weekDay.shop.week_day.value\n    this.processing(this.dataTable)\n  },\n  computed: {\n    columns\n  }\n}\n</script>\n"],"sourceRoot":"src/views/biz-modals/schedule/batch"}]}