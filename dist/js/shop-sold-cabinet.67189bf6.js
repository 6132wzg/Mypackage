(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["shop-sold-cabinet"],{"1fd0":function(e,t,n){"use strict";n.r(t);var a,i,r,s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("st-panel",{class:e.basic(),attrs:{app:"",initial:""}},[n("st-input-search",{staticStyle:{width:"400px"},attrs:{slot:"title",placeholder:"请输入租赁柜号、合同编号、会员姓名或手机号查找"},on:{search:function(t){return e.onKeywordsSearch("search",t)}},slot:"title",model:{value:e.$searchQuery.search,callback:function(t){e.$set(e.$searchQuery,"search",t)},expression:"$searchQuery.search"}}),n("st-search-panel",{on:{search:e.onSearchNative,reset:e.onSearchReset}},[n("st-search-panel-item",{attrs:{label:"租赁状态："}},[n("st-search-radio",{attrs:{options:e.leaseList},model:{value:e.$searchQuery.lease_status,callback:function(t){e.$set(e.$searchQuery,"lease_status",t)},expression:"$searchQuery.lease_status"}})],1),n("st-search-panel-item",{attrs:{label:"起租时间："}},[n("st-range-picker",{attrs:{disabledDays:180},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1)],1),n("div",{class:e.basic("content")},[n("div",{class:e.basic("content-batch")}),n("st-table",{attrs:{page:e.page,loading:e.loading.getList,rowKey:"id",columns:e.columns,dataSource:e.list},on:{change:e.onTableChange},scopedSlots:e._u([{key:"lease_status",fn:function(t){return[n("st-text",{staticClass:"white-nowrap",attrs:{status:{success:1===t.id,error:2===t.id,warning:3===t.id}}},[e._v("\n          "+e._s(t.name)+"\n        ")])]}},{key:"member_name",fn:function(t,a){return[a.is_minors?[n("span",{staticClass:"word-break"},[e._v(e._s(a.member_name)+"(未成年)")])]:[n("span",{staticClass:"word-break"},[e._v(e._s(a.member_name))])]]}},{key:"member_mobile",fn:function(t,n){return[n.is_minors?[e._v("\n          "+e._s(n.parent_mobile)+"("+e._s(n.parent_user_role)+")\n        ")]:[e._v("\n          "+e._s(n.member_mobile)+"\n        ")]]}},{key:"sell_time",fn:function(t,a){return[n("span",{staticClass:"word-break"},[e._v("\n          "+e._s(a.start_time)+" ~ "+e._s(a.end_time)+"\n        ")])]}},{key:"action",fn:function(t,a){return n("div",{},[n("st-table-actions",[a.auth["shop:sold:sold_cabinet|renew"]?n("a",{on:{click:function(t){return e.onRelet(a)}}},[e._v("\n            续租\n          ")]):e._e(),a.auth["shop:sold:sold_cabinet|export_contract"]?n("a",{on:{click:function(t){return e.toContract(a)}}},[e._v("\n            查看合同\n          ")]):e._e(),a.auth["shop:sold:sold_cabinet|transfer"]?n("a",{on:{click:function(t){return e.onTransfer(a)}}},[e._v("\n            转让\n          ")]):e._e(),a.auth["brand_shop:order:order|refund"]?n("a",{on:{click:function(t){return e.onRefund(a)}}},[e._v("\n            退款\n          ")]):e._e(),a.auth["shop:sold:sold_cabinet|internal_description"]?n("a",{on:{click:function(t){return e.internalNoteActions.onOpenModal(a)}}},[e._v("\n            对内备注\n          ")]):e._e()])],1)}}])})],1)],1)},o=[],c=(n("ac6a"),n("c32d")),d=n.n(c),l=n("5c8a"),u=n("2138"),m=n("f068"),f=n("ea3e"),p=function(){return[{title:"柜号",dataIndex:"serial_num",scopedSlots:{customRender:"serial_num"}},{title:"状态",dataIndex:"lease_status",width:70,scopedSlots:{customRender:"lease_status"}},{title:"姓名",dataIndex:"member_name",width:90,scopedSlots:{customRender:"member_name"}},{title:"手机号",dataIndex:"member_mobile",scopedSlots:{customRender:"member_mobile"}},{title:"余额(天)",dataIndex:"remain_days",scopedSlots:{customRender:"remain_days"}},{title:"租赁(天)",dataIndex:"lease_days",scopedSlots:{customRender:"lease_days"}},{title:"有效期",dataIndex:"sell_time",width:120,scopedSlots:{customRender:"sell_time"}},{title:"销售",dataIndex:"sale_name",width:90,scopedSlots:{customRender:"sale_name"}},{title:"合同编号",dataIndex:"contract_number",scopedSlots:{customRender:"contract_number"}},{title:"订单号",dataIndex:"order_id",scopedSlots:{customRender:"order_id"}},{title:"操作",dataIndex:"action",width:140,scopedSlots:{customRender:"action"}}]},b=n("3bdc"),h=n("f555"),_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("st-modal",{attrs:{title:"退款",wrapClassName:"modal-sold-lease-refund"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[n("div",{class:e.refund("content")},[n("a-row",{class:e.refund("info")},[n("a-col",{staticClass:"mg-b36",attrs:{span:13}},[n("st-info",[n("st-info-item",{attrs:{label:"订单号"}},[e._v(e._s(e.info.order_id))]),n("st-info-item",{staticClass:"mg-b0",attrs:{label:"下单时间"}},[e._v("\n            "+e._s(e.info.created_time)+"\n          ")])],1)],1),n("a-col",{staticClass:"mg-b36",attrs:{span:11}},[n("st-info",[n("st-info-item",{attrs:{label:"下单人"}},[e._v(e._s(e.info.operator_name))]),n("st-info-item",{staticClass:"mg-b0",attrs:{label:"销售"}},[e._v("\n            "+e._s(e.info.staff_name)+"\n          ")])],1)],1),n("a-col",{staticClass:"mg-b36",attrs:{span:13}},[n("st-info",[e.info.order_type?n("st-info-item",{attrs:{label:"订单类型"}},[e._v("\n            "+e._s(e._f("enumFilter")(e.info.order_type,"sold_common.order_type"))+"\n          ")]):e._e(),n("st-info-item",{staticClass:"mg-b0",attrs:{label:"订单来源"}},[e._v("\n            "+e._s(e.info.order_source)+" "+e._s(e.info.mobile)+"\n          ")])],1)],1),n("a-col",{staticClass:"mg-b36",attrs:{span:11}},[n("st-info",[n("st-info-item",{attrs:{label:"场馆"}},[e._v(e._s(e.info.shop_name))]),n("st-info-item",{staticClass:"mg-b0",attrs:{label:"用户"}},[e._v("\n            "+e._s(e.info.member_name)+"\n          ")])],1)],1),n("a-col",{staticClass:"mg-b36",attrs:{span:13}},[n("st-info",[n("st-info-item",{attrs:{label:"购买"}},[e._v(e._s(e.info.product_name))]),n("st-info-item",{attrs:{label:"订单总额"}},[e._v("\n            "+e._s(e.info.total_price)+"元\n          ")]),n("st-info-item",{attrs:{label:"实收金额"}},[e._v(e._s(e.info.pay_price)+"元")])],1)],1),n("a-col",{staticClass:"mg-b36",attrs:{span:11}},[n("st-info",[n("st-info-item",{attrs:{label:"赠送"}},[e._v(e._s(e.info.gift_amount))]),n("st-info-item",{attrs:{label:"应收金额"}},[e._v("\n            "+e._s(e.info.should_price)+"元\n          ")])],1)],1),n("a-col",{staticClass:"mg-b36",attrs:{span:24}},[n("st-info",[n("st-info-item",{attrs:{label:"备注"}},[e._v("\n            "+e._s(e.info.description||"")+"\n          ")])],1)],1)],1),n("st-form",{attrs:{form:e.form,labelWidth:"88px"}},[n("div",{class:e.refund("refund")},[n("st-form-item",{staticClass:"mg-b16",attrs:{required:""}},[n("template",{slot:"label"},[e._v("\n            退款原因\n            "),n("st-help-tooltip",{attrs:{id:"TSMC005"}})],1),n("a-radio-group",{model:{value:e.refundReason,callback:function(t){e.refundReason=t},expression:"refundReason"}},e._l(e.refundReasons,(function(t){return n("a-radio",{key:t.value,attrs:{value:+t.value}},[e._v("\n              "+e._s(t.label)+"\n            ")])})),1)],2),n("st-form-item",{attrs:{label:"退款金额",required:""}},[n("st-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorators.refundPrice,expression:"decorators.refundPrice"}],attrs:{max:+e.info.pay_price,float:!0,placeholder:"请输入本次退款的实际金额"}},[n("template",{slot:"addonAfter"},[e._v("\n              元\n            ")])],2)],1),n("st-form-item",{staticClass:"mg-b16",attrs:{label:"退款方式",required:""}},[n("a-radio-group",{model:{value:e.frozenPayType,callback:function(t){e.frozenPayType=t},expression:"frozenPayType"}},e._l(e.refundChannelSaas,(function(t){return n("a-radio",{key:t.value,attrs:{value:+t.value}},[e._v("\n              "+e._s(t.label)+"\n            ")])})),1)],1),n("st-form-item",{staticClass:"mg-b0",attrs:{label:"备注"}},[n("a-textarea",{attrs:{autosize:{minRows:4,maxRows:6}},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1)],1)])],1),n("template",{slot:"footer"},[n("span",{staticClass:"info"},[e._v("\n      提交后无法修改 \n      "),n("st-icon",{attrs:{type:"help"}})],1),n("st-button",{attrs:{loading:e.loading.refund,type:"primary"},on:{click:e.onSubmit}},[e._v("\n      确认提交\n    ")])],1)],2)},v=[],g=n("d225"),y=n("b0b4"),O=n("9ab4"),S=n("0cd5"),j=n("df29"),w=n("dd5c"),$=n("c4cc"),k=function(){function e(t,n){Object(g["a"])(this,e),this.cabinetApi=t,this.userService=n,this.info$=new j["d"]({}),this.loading$=new j["d"]({}),this.refundChannelSaas$=this.userService.getOptions$("sold_common.refund_channel_saas"),this.refundReasons$=this.userService.getOptions$("sold_common.refund_reason")}return Object(y["a"])(e,[{key:"getDetail",value:function(e){var t=this;return this.cabinetApi.getDetail(e,"refund").pipe(Object($["a"])((function(e){t.info$.commit((function(){return e.info}))})))}},{key:"refund",value:function(e){return this.cabinetApi.refund(e)}}]),e}();Object(O["b"])([Object(j["c"])(),Object(O["d"])("design:type",Function),Object(O["d"])("design:paramtypes",["function"===typeof(a="undefined"!==typeof w["RefundParams"]&&w["RefundParams"])?a:Object]),Object(O["d"])("design:returntype",void 0)],k.prototype,"refund",null),k=Object(O["b"])([Object(S["b"])(),Object(O["d"])("design:paramtypes",["function"===typeof(i="undefined"!==typeof w["a"]&&w["a"])?i:Object,"function"===typeof(r="undefined"!==typeof u["a"]&&u["a"])?r:Object])],k);var P,A,x,C,L=function(e){return{refundPrice:{rules:[{required:!0,message:"请输入退款金额"}]}}},R={name:"ModalSoldLeaseRefund",bem:{refund:"modal-sold-lease-refund"},serviceProviders:function(){return[k]},serviceInject:function(){return{userService:u["a"],refundService:k}},rxState:function(){return{info:this.refundService.info$,refundReasons:this.refundService.refundReasons$,refundChannelSaas:this.refundService.refundChannelSaas$,loading:this.refundService.loading$}},props:["id"],data:function(){var e=this.$stForm.create(),t=e.decorators(L);return{form:e,decorators:t,show:!1,description:"",frozenPayType:2,refundReason:2}},computed:{},created:function(){this.refundService.getDetail(this.id).subscribe()},methods:{onSubmit:function(){var e=this;this.form.validate().then((function(t){e.refundService.refund({sold_id:e.id,sub_order_id:e.info.sub_order_id,product_type:10,refund_price:+t.refundPrice||0,refund_reason:+e.refundReason,refund_channel:+e.frozenPayType,description:e.description},e.id,e.type).subscribe((function(t){e.$emit("success"),e.show=!1}))}))}}},T=R,D=n("2877"),N=Object(D["a"])(T,_,v,!1,null,null,null),I=N.exports,M=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("st-modal",{attrs:{title:"续租",size:"small",wrapClassName:"modal-sold-lease-relet"},on:{ok:e.onOk},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[n("div",{class:e.relet("content")},[n("a-row",{class:e.relet("info")},[n("a-col",{attrs:{span:13}},[n("st-info",[n("st-info-item",{attrs:{label:"商品名称"}},[e._v("\n            "+e._s(e.info.product_name)+"\n          ")]),n("st-info-item",{attrs:{label:"商品类型"}},[e._v("\n            "+e._s(e.info.product_type)+"\n          ")]),n("st-info-item",{staticClass:"mg-b24",attrs:{label:"租赁计费"}},[e._v("\n            "+e._s(e.info.price)+"\n          ")])],1)],1),n("a-col",{attrs:{span:11}},[n("st-info",[e.info.sale_range?n("st-info-item",{attrs:{label:"售卖群体"}},[e._v("\n            "+e._s(e.info.sale_range.name)+"\n          ")]):e._e(),n("st-info-item",{attrs:{label:"允许转让"}},[e._v(e._s(e.info.is_transfer))]),n("st-info-item",{staticClass:"mg-b24",attrs:{label:"转让手续费"}},[e._v("\n            "+e._s(e.info.transfer)+"\n          ")])],1)],1)],1),n("st-form",{attrs:{labelWidth:"88px",form:e.form}},[n("div",{class:e.relet("relet")},[n("st-form-item",{staticClass:"mg-b16",attrs:{label:"租赁会员"}},[e._v("\n          "+e._s(e.info.member_name)+"\n        ")]),n("st-form-item",{attrs:{label:"租赁柜号",required:""}},[e._v("\n          "+e._s(e.info.serial_num)+"\n          ")]),n("st-form-item",{attrs:{label:"续租时间",required:""}},[n("div",{class:e.relet("time")},[n("a-form-item",{staticClass:"page-a-form mg-b0"},[e._v("\n              "+e._s(e.info.start_time)+"\n            ")]),n("span",[e._v("~")]),n("a-form-item",{staticClass:"page-a-form mg-b0"},[n("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorators.end_time,expression:"decorators.end_time"}],attrs:{format:"YYYY-MM-DD HH:mm",placeholder:"结束时间",showToday:!1,showTime:"",disabledDate:e.disabledStartDate},on:{change:e.end_time_change}})],1)],1)]),n("st-form-item",{attrs:{label:"租赁天数",required:""}},[n("st-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorators.lease_num,expression:"decorators.lease_num"}],attrs:{placeholder:"请输入天数",min:1,max:999},on:{change:e.changeLeaseNum}},[n("template",{slot:"addonAfter"},[e._v("\n              天\n            ")])],2)],1),n("editable-contract-number",{attrs:{form:e.form},model:{value:e.info.contract_number,callback:function(t){e.$set(e.info,"contract_number",t)},expression:"info.contract_number"}}),n("st-form-item",{staticClass:"mg-b16",attrs:{label:"租赁费用"}},[e._v("\n          "+e._s(e.orderAmountPrice)+"元\n        ")]),n("st-form-item",{class:e.sale("discounts"),attrs:{label:"定金抵扣"}},[n("div",[n("div",{class:e.sale("discounts-total")},[n("span",[e._v(e._s(e.advanceText))]),n("a-dropdown",{class:e.sale({disabled:0===e.advanceList.length}),attrs:{disabled:0===e.advanceList.length,placement:"bottomRight",getPopupContainer:function(e){return e.parentNode},trigger:["click"]},model:{value:e.advanceDropdownVisible,callback:function(t){e.advanceDropdownVisible=t},expression:"advanceDropdownVisible"}},[n("div",{class:e.sale("discounts-promotion")},[n("span",[e._v("定金选择")]),n("a-icon",{attrs:{type:"right"}})],1),n("a-radio-group",{class:e.sale("dropdown"),attrs:{slot:"overlay"},on:{change:e.onSelectAdvanceChange},slot:"overlay",model:{value:e.selectAdvance,callback:function(t){e.selectAdvance=t},expression:"selectAdvance"}},[n("a-menu",[n("a-menu-item",{on:{click:e.onSelectAdvance}},[n("a-radio",{attrs:{value:-1}},[e._v("不使用")])],1),e._l(e.advanceList,(function(t,a){return n("a-menu-item",{key:a,on:{click:e.onSelectAdvance}},[n("a-radio",{attrs:{value:t.id}},[e._v("\n                        定金 "+e._s(t.price)+"\n                      ")])],1)}))],2)],1)],1)],1)])]),n("st-form-item",{staticClass:"mg-b16",attrs:{label:"减免金额"}},[n("st-input-number",{attrs:{placeholder:"请输入金额"},model:{value:e.reduceAmount,callback:function(t){e.reduceAmount=t},expression:"reduceAmount"}},[n("template",{slot:"addonAfter"},[e._v("\n              元\n            ")])],2)],1),n("st-form-item",{staticClass:"mg-b0",attrs:{label:"小计",help:e.orderAmountText}},[n("span",{staticClass:"total"},[e._v(e._s(e.currentPrice)+"元")])])],1),n("div",{class:e.relet("remarks")},[n("st-form-item",{attrs:{label:"销售人员",required:""}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorators.saleName,expression:"decorators.saleName"}],attrs:{placeholder:"选择签单的工作人员"}},e._l(e.saleList,(function(t,a){return n("a-select-option",{key:a,attrs:{value:t.id}},[e._v("\n              "+e._s(t.staff_name)+"\n            ")])})),1)],1),n("st-form-item",{staticClass:"mg-b0",attrs:{label:"备注"}},[n("a-textarea",{attrs:{autosize:{minRows:4,maxRows:6}},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1)],1)])],1),n("template",{slot:"footer"},[n("div",{class:e.relet("footer")},[n("div",{staticClass:"price"},[n("span",[e._v(e._s(e.currentPrice)+"元")]),n("span",[e._v("订单总额："+e._s(e.orderAmountPrice)+"元")])]),n("div",{staticClass:"button"},[n("st-button",{attrs:{loading:e.loading.setTransactionOrder},on:{click:e.onCreateOrder}},[e._v("\n          创建订单\n        ")]),n("st-button",{attrs:{type:"primary",loading:e.loading.setTransactionPay},on:{click:e.onPay}},[e._v("\n          立即支付\n        ")])],1)])])],2)},Y=[],F=(n("c5f6"),n("75ca")),q=n("1a2d"),V=n("d792"),Q=n("f59d"),z=n("af6c"),B=n("1b92"),E=n("54da"),H=function(){function e(t,n,a){var i=this;Object(g["a"])(this,e),this.contractApi=t,this.transactionApi=n,this.cabinetApi=a,this.loading$=new j["d"]({}),this.info$=new j["d"]({}),this.memberList$=new j["d"]({}),this.saleList$=new j["d"]({}),this.advanceList$=new j["d"]({}),this.currentPrice$=new j["d"]("0"),this.orderAmountPrice$=new j["d"]("0"),this.currentPriceAction$=new j["a"]((function(e){return e.pipe(i.debounceMap(),Object($["a"])((function(e){i.currentPrice$.commit((function(){return e.info.price}))})))})),this.orderAmountPriceAction$=new j["a"]((function(e){return e.pipe(i.debounceMap(),Object($["a"])((function(e){i.orderAmountPrice$.commit((function(){return e.info.price}))})))}))}return Object(y["a"])(e,[{key:"debounceMap",value:function(){var e=this;return function(t){return t.pipe(Object(q["a"])(200),Object(V["a"])((function(t){return e.getPrice(t).pipe(Object(Q["a"])((function(){return B["a"]})))})))}}},{key:"getInfo",value:function(e){var t=this;return this.cabinetApi.getDetail(e,"lease").pipe(Object($["a"])((function(e){t.info$.commit((function(){return e.info}))})))}},{key:"getMember",value:function(e,t){var n=this;return this.transactionApi.getMemberList(e,t).pipe(Object($["a"])((function(e){n.memberList$.commit((function(){return e.list}))})))}},{key:"getAdvanceList",value:function(e){var t=this;return this.transactionApi.getTransactionAdvanceList(e).pipe(Object($["a"])((function(e){t.advanceList$.commit((function(){return e.list}))})))}},{key:"getSaleList",value:function(){var e=this;return this.transactionApi.getTransactionSaleList().pipe(Object($["a"])((function(t){e.saleList$.commit((function(){return t.list}))})))}},{key:"serviceInit",value:function(e){return Object(E["a"])(this.getInfo(e),this.getSaleList())}},{key:"setTransactionOrder",value:function(e,t){return this.cabinetApi.setTransaction(e,"",t)}},{key:"setTransactionPay",value:function(e,t){return this.cabinetApi.setTransaction(e,"",t)}},{key:"getPrice",value:function(e){return this.transactionApi.getTransactionSoldPrice(e)}}]),e}();Object(O["b"])([Object(j["c"])(),Object(O["d"])("design:type",Function),Object(O["d"])("design:paramtypes",[String,Number]),Object(O["d"])("design:returntype",void 0)],H.prototype,"getMember",null),Object(O["b"])([Object(j["c"])(),Object(O["d"])("design:type",Function),Object(O["d"])("design:paramtypes",[Object]),Object(O["d"])("design:returntype",void 0)],H.prototype,"getAdvanceList",null),Object(O["b"])([Object(j["c"])(),Object(O["d"])("design:type",Function),Object(O["d"])("design:paramtypes",[Number]),Object(O["d"])("design:returntype",void 0)],H.prototype,"serviceInit",null),Object(O["b"])([Object(j["c"])(),Object(O["d"])("design:type",Function),Object(O["d"])("design:paramtypes",[Object,Number]),Object(O["d"])("design:returntype",void 0)],H.prototype,"setTransactionOrder",null),Object(O["b"])([Object(j["c"])(),Object(O["d"])("design:type",Function),Object(O["d"])("design:paramtypes",[Object,Number]),Object(O["d"])("design:returntype",void 0)],H.prototype,"setTransactionPay",null),Object(O["b"])([Object(j["c"])(),Object(O["d"])("design:type",Function),Object(O["d"])("design:paramtypes",["function"===typeof(P="undefined"!==typeof F["TransactionPriceInput"]&&F["TransactionPriceInput"])?P:Object]),Object(O["d"])("design:returntype",void 0)],H.prototype,"getPrice",null),H=Object(O["b"])([Object(S["b"])(),Object(O["d"])("design:paramtypes",["function"===typeof(A="undefined"!==typeof z["a"]&&z["a"])?A:Object,"function"===typeof(x="undefined"!==typeof F["c"]&&F["c"])?x:Object,"function"===typeof(C="undefined"!==typeof w["a"]&&w["a"])?C:Object])],H);var G=n("808d"),J=n("2527"),K=function(e){return{end_time:{rules:[{required:!0,message:"请选择租赁时间"}]},lease_num:{rules:[{required:!0,message:"请填租赁天数"}]},saleName:{rules:[{required:!0,message:"请选择销售人员"}]}}},W=n("464d"),U={name:"ModalSoldLeaseRelet",bem:{relet:"modal-sold-lease-relet",sale:"modal-sold-deal-sale"},components:{EditableContractNumber:W["a"]},serviceProviders:function(){return[H]},serviceInject:function(){return{reletService:H,pattern:J["a"]}},rxState:function(){return{loading:this.reletService.loading$,info:this.reletService.info$,saleList:this.reletService.saleList$,advanceList:this.reletService.advanceList$,currentPrice:this.reletService.currentPrice$,orderAmountPrice:this.reletService.orderAmountPrice$}},props:["id"],data:function(){var e=this.$stForm.create(),t=e.decorators(K);return{form:e,decorators:t,show:!1,endTimeValue:null,advanceDropdownVisible:!1,advanceText:"未选择定金",selectAdvance:"",reduceAmount:"",description:""}},created:function(){var e=this;this.reletService.serviceInit(this.id).subscribe((function(t){e.reletService.getAdvanceList(e.info.member_id).subscribe()}))},computed:{orderAmountText:function(){return this.currentPrice<0?"小计不能为负":""}},watch:{selectAdvance:{deep:!0,handler:function(e,t){this.getPrice(e,+this.reduceAmount)}},reduceAmount:function(e,t){this.getPrice(this.selectAdvance,+e)}},methods:{disabledStartDate:function(e){var t=moment(this.info.start_time);return!(!e||!t)&&e.valueOf()<t.valueOf()},changeLeaseNum:function(e){this.form.setFieldsValue({end_time:moment(this.info.start_time).add(e,"days")}),this.getOrderPrice(),this.getPrice()},onSelectAdvance:function(){var e=this;Object(G["a"])(200).subscribe((function(){e.advanceDropdownVisible=!1}))},resetAdvance:function(){this.advanceList=[],this.advanceText="未选择定金"},onSelectAdvanceChange:function(e){if(this.advanceText="未选择定金",-1!==e.target.value){var t=this.advanceList.filter((function(t){return t.id===e.target.value}))[0].price;this.advanceText="".concat(t,"元")}},getPrice:function(e,t){this.reletService.currentPriceAction$.dispatch({id:this.id,product_id:this.info.cabinet_id,product_type:this.info.contract_type,product_num:this.form.getFieldValue("lease_num")||0,member_id:this.info.member_id,advance_id:-1===e?"":e,reduce_amount:t||void 0})},getOrderPrice:function(){this.reletService.orderAmountPriceAction$.dispatch({id:this.id,product_id:this.info.cabinet_id,product_type:this.info.contract_type,product_num:this.form.getFieldValue("lease_num")||0})},onOk:function(){this.$emit("ok"),this.show=!1},end_time_change:function(e){this.form.setFieldsValue({lease_num:e.diff(moment(this.info.start_time),"days")+1}),this.getOrderPrice(),this.getPrice()},onCreateOrder:function(){var e=this;this.form.validate().then((function(t){e.reletService.setTransactionOrder({id:e.id,start_time:e.info.start_time,end_time:moment(t.end_time).format("YYYY-MM-DD HH:mm"),contract_number:e.info.contract_number,advance_id:-1===e.selectAdvance?"":e.selectAdvance,reduce_amount:e.reduceAmount||0,description:e.description,order_amount:e.currentPrice,lease_days:t.lease_num,sale_id:t.saleName,member_id:e.info.member_id},e.id).subscribe((function(t){e.$emit("success",{type:"create",order_id:t.info.order_id}),e.show=!1}))}))},onPay:function(){var e=this;this.form.validate().then((function(t){e.reletService.setTransactionPay({id:e.id,start_time:e.info.start_time,end_time:moment(t.end_time).format("YYYY-MM-DD HH:mm"),contract_number:e.info.contract_number,advance_id:-1===e.selectAdvance?"":e.selectAdvance,reduce_amount:e.reduceAmount||0,description:e.description,order_amount:e.currentPrice,lease_days:t.lease_num,sale_id:t.saleName,member_id:e.info.member_id},e.id).subscribe((function(t){e.$emit("success",{type:"createPay",order_id:t.info.order_id}),e.show=!1}))}))}}},X=U,Z=Object(D["a"])(X,M,Y,!1,null,null,null),ee=Z.exports,te=n("c201"),ne=n("c262"),ae={name:"PageShopSoldLease",mixins:[f["a"]],bem:{basic:"page-shop-sold"},modals:{SoldDealGatheringTip:b["a"],SoldDealGathering:h["a"],SoldLeaseRefund:I,SoldLeaseRelet:ee,SoldLeaseTransfer:te["a"]},serviceInject:function(){return{userService:u["a"],listService:m["ListService"]}},rxState:function(){return{loading:this.listService.loading$,cabinetStatus:this.listService.cabinetStatus$,page:this.listService.page$,list:this.listService.list$,auth:this.listService.auth$}},computed:{columns:p,leaseList:function(){var e=[{value:-1,label:"全部"}];return this.cabinetStatus.length?(this.cabinetStatus.forEach((function(t){e.push({value:+t.value,label:t.label})})),e):e}},hooks:function(){return{internalNoteActions:Object(ne["a"])()}},data:function(){return{date:[]}},mounted:function(){this.setSearchData()},watch:{query:function(e){this.setSearchData()}},methods:{onSearchNative:function(){this.$searchQuery.start_time=this.date[0]?"".concat(this.date[0].format("YYYY-MM-DD")," 00:00:00"):"",this.$searchQuery.end_time=this.date[1]?"".concat(this.date[1].format("YYYY-MM-DD")," 23:59:59"):"",this.onSearch()},setSearchData:function(){var e=this.$searchQuery.start_time?Object(l["a"])(d()(this.$searchQuery.start_time)):null,t=this.$searchQuery.end_time?Object(l["a"])(d()(this.$searchQuery.end_time)):null;this.date=[e,t]},toContract:function(e){var t=e.order_id,n="".concat(window.location.origin,"/common/contract-preview?id=").concat(t);window.open(n)},createdOrderViewOrder:function(e){this.$router.push({name:"shop-finance-order-info-collection-details",query:{id:e}})},onRelet:function(e){var t=this;this.$modalRouter.push({name:"sold-lease-relet",props:{id:e.id},on:{success:function(e){"create"===e.type?t.$modalRouter.push({name:"sold-deal-gathering-tip",props:{order_id:e.order_id,type:"cabinet_order",message:"订单创建成功",needPay:!0},on:{success:function(e){t.$router.reload(),t.tipCallBack(e.orderId,"cabinet_order",e.type)}}}):"createPay"===e.type&&t.$modalRouter.push({name:"sold-deal-gathering",props:{order_id:e.order_id,type:"cabinet_order"},on:{success:function(){t.$modalRouter.push({name:"sold-deal-gathering-tip",props:{orderId:e.order_id,type:"cabinet_order",message:"收款成功"},on:{success:function(n){t.$router.reload(),t.tipCallBack(e.order_id,"cabinet_order",n.type)}}})}}})}}})},createdOrderPay:function(e){var t=this;return new Promise((function(n,a){t.$modalRouter.push({name:"sold-deal-gathering",props:e,on:{success:n}})}))},payCallBack:function(e,t,n){var a=this;switch(n){case"cancel":this.onSearch();break;case"pay":this.createdGatheringTip({message:"收款成功",order_id:e}).then((function(n){a.tipCallBack(e,t,n.type)}));break}},tipCallBack:function(e,t,n){var a=this;switch(n){case"cancel":this.$router.reload();break;case"Print":this.toContract({order_id:e});break;case"PrintOrder":this.printOrder(e);break;case"ViewOrder":this.createdOrderViewOrder(e);break;case"Pay":this.createdOrderPay({order_id:e,type:t}).then((function(n){a.payCallBack(e,t,n.type)}));break}},printOrder:function(e){window.open("/ticket/gathering-print?id="+e,"_blank","width=800,height=600")},onTransfer:function(e){var t=this;this.$modalRouter.push({name:"sold-lease-transfer",props:{id:e.id},on:{success:function(e){t.$router.reload()}}})},onRefund:function(e){var t=this;this.$modalRouter.push({name:"sold-lease-refund",props:{id:e.id},on:{success:function(e){t.$router.reload()}}})}}},ie=ae,re=Object(D["a"])(ie,s,o,!1,null,null,null);t["default"]=re.exports},"808d":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n("e9b9"),i=n("4f50"),r=n("8ac6");function s(e){return!Object(r["a"])(e)&&e-parseFloat(e)+1>=0}var o=n("9e46");function c(e,t,n){void 0===e&&(e=0);var r=-1;return s(t)?r=Number(t)<1?1:Number(t):Object(o["a"])(t)&&(n=t),Object(o["a"])(n)||(n=i["a"]),new a["a"]((function(t){var a=s(e)?e:+e-n.now();return n.schedule(d,a,{index:0,period:r,subscriber:t})}))}function d(e){var t=e.index,n=e.period,a=e.subscriber;if(a.next(t),!a.closed){if(-1===n)return a.complete();e.index=t+1,this.schedule(e,n)}}},f068:function(e,t,n){"use strict";n.r(t),n.d(t,"ListService",(function(){return h}));var a,i,r,s,o=n("d225"),c=n("b0b4"),d=n("9ab4"),l=n("0cd5"),u=n("df29"),m=n("c4cc"),f=n("dd5c"),p=n("2cbb"),b=n("2138"),h=function(){function e(t,n,a){Object(o["a"])(this,e),this.cabinetApi=t,this.authService=n,this.userService=a,this.list$=new u["d"]([]),this.page$=new u["d"]({}),this.loading$=new u["d"]({}),this.cabinetStatus$=this.userService.getOptions$("cabinet.cabinet_status"),this.auth$=this.authService.authMap$({export:"shop:sold:sold_cabinet|export"})}return Object(c["a"])(e,[{key:"getList",value:function(e){var t=this;return this.cabinetApi.getLeaseList(e).pipe(Object(m["a"])((function(e){t.list$.commit((function(){return e.list})),t.page$.commit((function(){return e.page}))})))}},{key:"beforeEach",value:function(e,t){return this.getList(e.meta.query)}}]),e}();Object(d["b"])([Object(u["c"])(),Object(d["d"])("design:type",Function),Object(d["d"])("design:paramtypes",["function"===typeof(a="undefined"!==typeof f["LeaseParams"]&&f["LeaseParams"])?a:Object]),Object(d["d"])("design:returntype",void 0)],h.prototype,"getList",null),h=Object(d["b"])([Object(l["b"])(),Object(d["d"])("design:paramtypes",["function"===typeof(i="undefined"!==typeof f["a"]&&f["a"])?i:Object,"function"===typeof(r="undefined"!==typeof p["a"]&&p["a"])?r:Object,"function"===typeof(s="undefined"!==typeof b["a"]&&b["a"])?s:Object])],h)}}]);