{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/lease/relet.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/sold/lease/relet.vue","mtime":1594718340155},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { ReletService } from \"./relet.service\";\nimport { cloneDeep } from 'lodash-es';\nimport { timer } from 'rxjs';\nimport { PatternService } from '@/services/pattern.service';\nimport { ruleOptions } from \"./relet.config\";\nimport EditableContractNumber from '@/views/biz-components/contract/editable-contract-number.vue';\nexport default {\n  name: 'ModalSoldLeaseRelet',\n  bem: {\n    relet: 'modal-sold-lease-relet',\n    sale: 'modal-sold-deal-sale'\n  },\n  components: {\n    EditableContractNumber: EditableContractNumber\n  },\n  serviceProviders: function serviceProviders() {\n    return [ReletService];\n  },\n  serviceInject: function serviceInject() {\n    return {\n      reletService: ReletService,\n      pattern: PatternService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.reletService.loading$,\n      info: this.reletService.info$,\n      saleList: this.reletService.saleList$,\n      advanceList: this.reletService.advanceList$,\n      currentPrice: this.reletService.currentPrice$,\n      orderAmountPrice: this.reletService.orderAmountPrice$\n    };\n  },\n  props: ['id'],\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      show: false,\n      endTimeValue: null,\n      // 定金\n      advanceDropdownVisible: false,\n      advanceText: '未选择定金',\n      selectAdvance: '',\n      reduceAmount: '',\n      description: ''\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    this.reletService.serviceInit(this.id).subscribe(function (res) {\n      _this.reletService.getAdvanceList(_this.info.member_id).subscribe();\n    });\n  },\n  computed: {\n    orderAmountText: function orderAmountText() {\n      return this.currentPrice < 0 ? '小计不能为负' : '';\n    }\n  },\n  watch: {\n    selectAdvance: {\n      deep: true,\n      handler: function handler(newVal, oldVal) {\n        this.getPrice(newVal, +this.reduceAmount);\n      }\n    },\n    reduceAmount: function reduceAmount(newVal, oldVal) {\n      this.getPrice(this.selectAdvance, +newVal);\n    }\n  },\n  methods: {\n    disabledStartDate: function disabledStartDate(endTime) {\n      var startTime = moment(this.info.start_time);\n\n      if (!endTime || !startTime) {\n        return false;\n      }\n\n      return endTime.valueOf() < startTime.valueOf();\n    },\n    changeLeaseNum: function changeLeaseNum(event) {\n      this.form.setFieldsValue({\n        end_time: moment(this.info.start_time).add(event, 'days')\n      });\n      this.getOrderPrice();\n      this.getPrice();\n    },\n    onSelectAdvance: function onSelectAdvance() {\n      var _this2 = this;\n\n      timer(200).subscribe(function () {\n        _this2.advanceDropdownVisible = false;\n      });\n    },\n    // 重置定金选择\n    resetAdvance: function resetAdvance() {\n      this.advanceList = [];\n      this.advanceText = '未选择定金';\n    },\n    onSelectAdvanceChange: function onSelectAdvanceChange(data) {\n      this.advanceText = \"\\u672A\\u9009\\u62E9\\u5B9A\\u91D1\";\n\n      if (data.target.value !== -1) {\n        var price = this.advanceList.filter(function (o) {\n          return o.id === data.target.value;\n        })[0].price;\n        this.advanceText = \"\".concat(price, \"\\u5143\");\n      }\n    },\n    // 计算实付金额\n    getPrice: function getPrice(advance, reduce) {\n      this.reletService.currentPriceAction$.dispatch({\n        id: this.id,\n        product_id: this.info.cabinet_id,\n        product_type: this.info.contract_type,\n        product_num: this.form.getFieldValue('lease_num') || 0,\n        member_id: this.info.member_id,\n        advance_id: advance === -1 ? '' : advance,\n        reduce_amount: reduce || undefined\n      });\n    },\n    // 获取订单总额\n    getOrderPrice: function getOrderPrice() {\n      this.reletService.orderAmountPriceAction$.dispatch({\n        id: this.id,\n        product_id: this.info.cabinet_id,\n        product_type: this.info.contract_type,\n        product_num: this.form.getFieldValue('lease_num') || 0\n      });\n    },\n    onOk: function onOk() {\n      this.$emit('ok');\n      this.show = false;\n    },\n    // 租赁时间-end\n    end_time_change: function end_time_change(data) {\n      this.form.setFieldsValue({\n        lease_num: data.diff(moment(this.info.start_time), 'days') + 1\n      });\n      this.getOrderPrice();\n      this.getPrice();\n    },\n    onCreateOrder: function onCreateOrder() {\n      var _this3 = this;\n\n      this.form.validate().then(function (values) {\n        _this3.reletService.setTransactionOrder({\n          id: _this3.id,\n          start_time: _this3.info.start_time,\n          end_time: moment(values.end_time).format('YYYY-MM-DD HH:mm'),\n          contract_number: _this3.info.contract_number,\n          advance_id: _this3.selectAdvance === -1 ? '' : _this3.selectAdvance,\n          reduce_amount: _this3.reduceAmount || 0,\n          description: _this3.description,\n          order_amount: _this3.currentPrice,\n          lease_days: values.lease_num,\n          sale_id: values.saleName,\n          member_id: _this3.info.member_id\n        }, _this3.id).subscribe(function (result) {\n          _this3.$emit('success', {\n            type: 'create',\n            order_id: result.info.order_id\n          });\n\n          _this3.show = false;\n        });\n      });\n    },\n    onPay: function onPay() {\n      var _this4 = this;\n\n      this.form.validate().then(function (values) {\n        _this4.reletService.setTransactionPay({\n          id: _this4.id,\n          start_time: _this4.info.start_time,\n          end_time: moment(values.end_time).format('YYYY-MM-DD HH:mm'),\n          contract_number: _this4.info.contract_number,\n          advance_id: _this4.selectAdvance === -1 ? '' : _this4.selectAdvance,\n          reduce_amount: _this4.reduceAmount || 0,\n          description: _this4.description,\n          order_amount: _this4.currentPrice,\n          lease_days: values.lease_num,\n          sale_id: values.saleName,\n          member_id: _this4.info.member_id\n        }, _this4.id).subscribe(function (result) {\n          _this4.$emit('success', {\n            type: 'createPay',\n            order_id: result.info.order_id\n          });\n\n          _this4.show = false;\n        });\n      });\n    }\n  }\n};",null]}