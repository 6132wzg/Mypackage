{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"shop-setting-shop\"],{\"1bbb9\":function(t,e,i){\"use strict\";i.r(e),i.d(e,\"EditService\",(function(){return u}));var s,o,n=i(\"d225\"),a=i(\"b0b4\"),r=i(\"9ab4\"),c=i(\"0cd5\"),l=i(\"df29\"),h=i(\"5afb\"),p=i(\"c4cc\"),d=i(\"54da\"),u=function(){function t(e){Object(n[\"a\"])(this,t),this.shopApi=e,this.loading$=new l[\"d\"]({}),this.info$=new l[\"d\"]({}),this.serviceList$=new l[\"d\"]([]),this.auth$=new l[\"d\"]({})}return Object(a[\"a\"])(t,[{key:\"getInfo\",value:function(){var t=this;return this.shopApi.getShopSettingInfo().pipe(Object(p[\"a\"])((function(e){t.info$.commit((function(){return e.info}))})))}},{key:\"getServiceList\",value:function(){var t=this;return this.shopApi.getServiceList().pipe(Object(p[\"a\"])((function(e){t.serviceList$.commit((function(){return e.services}))})))}},{key:\"edit\",value:function(t){return this.shopApi.updateShop(t)}},{key:\"init\",value:function(){return Object(d[\"a\"])(this.getServiceList(),this.getInfo())}},{key:\"beforeEach\",value:function(){return this.init()}}]),t}();Object(r[\"b\"])([Object(l[\"c\"])(),Object(r[\"d\"])(\"design:type\",Function),Object(r[\"d\"])(\"design:paramtypes\",[]),Object(r[\"d\"])(\"design:returntype\",void 0)],u.prototype,\"getInfo\",null),Object(r[\"b\"])([Object(l[\"c\"])(),Object(r[\"d\"])(\"design:type\",Function),Object(r[\"d\"])(\"design:paramtypes\",[]),Object(r[\"d\"])(\"design:returntype\",void 0)],u.prototype,\"getServiceList\",null),Object(r[\"b\"])([Object(l[\"c\"])(),Object(r[\"d\"])(\"design:type\",Function),Object(r[\"d\"])(\"design:paramtypes\",[\"function\"===typeof(s=\"undefined\"!==typeof h[\"ShopEditShopInput\"]&&h[\"ShopEditShopInput\"])?s:Object]),Object(r[\"d\"])(\"design:returntype\",void 0)],u.prototype,\"edit\",null),u=Object(r[\"b\"])([Object(c[\"b\"])(),Object(r[\"d\"])(\"design:paramtypes\",[\"function\"===typeof(o=\"undefined\"!==typeof h[\"c\"]&&h[\"c\"])?o:Object])],u)},\"644b\":function(t,e,i){\"use strict\";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i(\"st-panel-layout\",{class:t.shopInfo()},[i(\"div\",{class:t.shopInfo(\"detail\")},[i(\"div\",{directives:[{name:\"viewer\",rawName:\"v-viewer\",value:{url:\"data-src\",toolbar:!1},expression:\"{ url: 'data-src', toolbar: false }\"}],staticClass:\"mg-r16 st-preview-item\",class:t.shopInfo(\"picture\")},[t._l(t.info.shop_images,(function(e,s){return i(\"img\",{directives:[{name:\"show\",rawName:\"v-show\",value:0===s,expression:\"index === 0\"}],key:s,attrs:{src:t._f(\"imgFilter\")(e.image_url,{w:404,h:227}),\"data-src\":t._f(\"imgFilter\")(e.image_url,{w:1e3}),width:\"404\",height:\"227\",alt:\"店招\"}})})),i(\"st-tag\",{staticClass:\"status-tag\",attrs:{type:t.flagList[t.info.shop_status]}}),i(\"p\",[i(\"st-icon\",{attrs:{type:\"image-count\"}}),i(\"span\",[t._v(t._s(t.info.shop_images.length))])],1)],2),i(\"div\",{class:t.shopInfo(\"info\")},[i(\"st-t2\",{staticClass:\"mg-b16\"},[t._v(t._s(t.info.shop_name))]),i(\"st-info\",{staticClass:\"mg-b16\",attrs:{isWeakenLabel:!0}},[i(\"st-info-item\",{attrs:{label:\"门店电话\"}},[t._v(\"\\n          \"+t._s(t.info.shop_phones.join(\",\"))+\"\\n        \")]),i(\"st-info-item\",{attrs:{label:\"门店邮箱\"}},[t._v(t._s(t.info.email||\"无\"))]),i(\"st-info-item\",{attrs:{label:\"门店地址\"}},[t._v(\"\\n          \"+t._s(t.info.shop_position.address_detail)+\"\\n          \"),i(\"a\",{staticClass:\"mg-l12\",on:{click:t.location}},[t._v(\"查看定位\")])])],1),i(\"checkbox-facility-info\",{attrs:{serviceList:t.serviceListComputed}}),i(\"div\",{class:t.shopInfo(\"button\")},[t.auth.edit?i(\"st-button\",{staticClass:\"mg-r8\",attrs:{type:\"primary\"},on:{click:t.onEdit}},[t._v(\"\\n          编辑\\n        \")]):t._e(),i(\"st-button\",{directives:[{name:\"modal-link\",rawName:\"v-modal-link\",value:{name:\"brand-setting-shop-holiday\",props:{shopId:t.info.id,shopName:t.info.shop_name,shopStatus:t.info.shop_status,isHoliday:t.info.has_holiday_setting,holidayTime:{start:1e3*(t.info.holiday_start_time||0),end:1e3*(t.info.holiday_end_time||0)}},on:{change:t.onSetChange}},expression:\"{\\n            name: 'brand-setting-shop-holiday',\\n            props: {\\n              shopId: info.id,\\n              shopName: info.shop_name,\\n              shopStatus: info.shop_status,\\n              isHoliday: info.has_holiday_setting,\\n              holidayTime: {\\n                start: (info.holiday_start_time || 0) * 1000,\\n                end: (info.holiday_end_time || 0) * 1000\\n              }\\n            },\\n            on: {\\n              change: onSetChange\\n            }\\n          }\"}]},[t._v(\"\\n          \"+t._s(1===t.info.has_holiday_setting?\"管理门店放假\":\"设置放假\")+\"\\n        \")])],1)],1)]),i(\"st-panel\",{staticClass:\"mg-t12\",class:t.shopInfo(\"time\"),attrs:{app:\"\"}},[i(\"st-t3\",{staticClass:\"mg-b16\"},[t._v(\"营业时间\")]),i(\"shop-hour-picker\",{attrs:{isInfo:!0},model:{value:t.info.business_time,callback:function(e){t.$set(t.info,\"business_time\",e)},expression:\"info.business_time\"}})],1)],1)},o=[],n=(i(\"ac6a\"),i(\"aa2d\")),a=i(\"5c8a\"),r=i(\"ad06\"),c=i(\"f54a\"),l=i(\"57f4\"),h=i(\"7c41\"),p={name:\"PageShopSettingShopInfo\",bem:{shopInfo:\"page-shop-setting-shop-info\"},components:{CheckboxFacilityInfo:c[\"a\"],ShopHourPicker:l[\"a\"]},modals:{ShopMapLocation:r[\"a\"],BrandSettingShopHoliday:h[\"a\"]},serviceInject:function(){return{infoService:n[\"InfoService\"]}},rxState:function(){return{serviceList:this.infoService.serviceList$,info:this.infoService.info$,auth:this.infoService.auth$}},computed:{serviceListComputed:function(){var t=this,e=Object(a[\"a\"])(this.serviceList);return e.forEach((function(e){e.selected=t.info.shop_services.some((function(t){return t.service_id===e.service_id}))})),e}},data:function(){return{flagList:[\"\",\"shop-trial\",\"shop-opening\",\"shop-stop\",\"shop-close\",\"shop-holiday\"]}},methods:{location:function(){this.$modalRouter.push({name:\"shop-map-location\",props:{lat:this.info.lat,lng:this.info.lng}})},onEdit:function(){this.$router.push({path:\"/shop/setting/shop/edit\"})},onSetChange:function(){this.$router.reload()}}},d=p,u=i(\"2877\"),f=Object(u[\"a\"])(d,s,o,!1,null,null,null);e[\"default\"]=f.exports},aa2d:function(t,e,i){\"use strict\";i.r(e),i.d(e,\"InfoService\",(function(){return f}));var s,o,n=i(\"d225\"),a=i(\"b0b4\"),r=i(\"9ab4\"),c=i(\"0cd5\"),l=i(\"df29\"),h=i(\"5afb\"),p=i(\"c4cc\"),d=i(\"54da\"),u=i(\"2cbb\"),f=function(){function t(e,i){Object(n[\"a\"])(this,t),this.shopApi=e,this.authService=i,this.info$=new l[\"d\"]({}),this.serviceList$=new l[\"d\"]([]),this.loading$=new l[\"d\"]({}),this.auth$=this.authService.authMap$({edit:\"shop:shop:shop|edit\"})}return Object(a[\"a\"])(t,[{key:\"getInfo\",value:function(){var t=this;return this.shopApi.getShopSettingInfo().pipe(Object(p[\"a\"])((function(e){t.info$.commit((function(){return e.info}))})))}},{key:\"getServiceList\",value:function(){var t=this;return this.shopApi.getServiceList().pipe(Object(p[\"a\"])((function(e){t.serviceList$.commit((function(){return e.services}))})))}},{key:\"init\",value:function(){return Object(d[\"a\"])(this.getInfo(),this.getServiceList())}},{key:\"beforeEach\",value:function(){return this.init()}}]),t}();f=Object(r[\"b\"])([Object(c[\"b\"])(),Object(r[\"d\"])(\"design:paramtypes\",[\"function\"===typeof(s=\"undefined\"!==typeof h[\"c\"]&&h[\"c\"])?s:Object,\"function\"===typeof(o=\"undefined\"!==typeof u[\"a\"]&&u[\"a\"])?o:Object])],f)},e915:function(t,e,i){\"use strict\";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i(\"st-panel\",{class:t.edit(),attrs:{app:\"\",initial:\"\"}},[i(\"div\",{class:t.edit(\"head\")},[i(\"p\",[i(\"st-tag\",{staticClass:\"mg-r8\",attrs:{type:t.flagList[t.info.shop_status]}}),i(\"st-t2\",[t._v(t._s(t.info.shop_name))])],1),i(\"p\",[t._v(\"\\n      \"+t._s(t.info.shop_position.address_detail)+\"\\n      \"),i(\"a\",{staticClass:\"mg-l12\",on:{click:t.location}},[t._v(\"查看定位\")])])]),i(\"st-form\",{class:t.edit(\"body\"),attrs:{labelWidth:\"117px\",form:t.form}},[i(\"a-row\",{attrs:{gutter:8}},[i(\"a-col\",{attrs:{lg:10,xs:22,offset:1}},[i(\"st-form-item\",{attrs:{label:\"门店电话\",required:\"\"}},[i(\"a-input\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:t.decorators.shopPhone,expression:\"decorators.shopPhone\"}],attrs:{placeholder:\"请输入门店电话\"}},[i(\"div\",{staticClass:\"page-shop-setting-shop-edit__mobile-add\",class:{disabled:t.phoneAddDisabled},attrs:{slot:\"addonAfter\"},on:{click:t.onValidtorPhone},slot:\"addonAfter\"},[t._v(\"\\n              新增\\n            \")])]),i(\"div\",{class:t.edit(\"mobile\")},t._l(t.shopPhones,(function(e,s){return i(\"p\",{key:s},[i(\"span\",[t._v(t._s(e))]),i(\"st-icon\",{staticClass:\"cursor-pointer\",attrs:{type:\"anticon:close\"},on:{click:function(e){return t.onRemovePhone(s)}}})],1)})),0)],1)],1)],1),i(\"a-row\",{attrs:{gutter:8}},[i(\"a-col\",{attrs:{lg:10,xs:22,offset:1}},[i(\"st-form-item\",{attrs:{label:\"邮箱\"}},[i(\"a-input\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:t.decorators.email,expression:\"decorators.email\"}],attrs:{placeholder:\"请输入门店邮箱\"}})],1)],1)],1),i(\"a-row\",{attrs:{gutter:8}},[i(\"a-col\",{attrs:{offset:\"1\",lg:23}},[i(\"st-form-item\",{staticClass:\"mg-b0\",attrs:{label:\"服务设施\"}},[i(\"checkbox-facility-group\",{model:{value:t.serviceIds,callback:function(e){t.serviceIds=e},expression:\"serviceIds\"}},t._l(t.serviceList,(function(e){return i(\"checkbox-facility-item\",{key:e.service_id,staticStyle:{\"margin-right\":\"24px\"},attrs:{label:e.service_name,icon:t.serviceIconIconList[e.service_id],value:e.service_id}})})),1)],1)],1)],1),i(\"a-row\",{attrs:{gutter:8}},[i(\"a-col\",{attrs:{offset:\"1\",lg:23}},[i(\"st-form-item\",{directives:[{name:\"viewer\",rawName:\"v-viewer\",value:{url:\"data-src\",toolbar:!1},expression:\"{ url: 'data-src', toolbar: false }\"}],staticClass:\"st-preview-item\",attrs:{label:\"门店图片\",required:\"\"}},[i(\"ul\",{class:t.edit(\"img-box\")},[t._l(t.imgList,(function(e,s){return i(\"li\",{key:s,staticClass:\"mg-r12 mg-t12\",class:t.edit(\"img\")},[i(\"img\",{attrs:{\"data-src\":t._f(\"imgFilter\")(e.image_url,{w:1e3}),src:t._f(\"imgFilter\")(e.image_url,{w:240,h:135}),width:\"240\",height:\"135\",alt:\"门店图片\"}}),e.is_cover?i(\"st-tag\",{staticClass:\"shop-edit-img-tag\",attrs:{type:\"shop-sign\"}}):i(\"p\",{staticClass:\"shop-edit-img-button mg-b0\"},[i(\"span\",{staticClass:\"cursor-pointer\",on:{click:function(e){return t.onSetCover(s)}}},[t._v(\"\\n                  设为店招\\n                \")]),i(\"span\",{staticClass:\"cursor-pointer\",on:{click:function(e){return t.onDelete(s)}}},[t._v(\"\\n                  删除\\n                \")])])],1)})),t.imgList.length<20?i(\"li\",{staticClass:\"mg-t12\"},[i(\"st-image-upload\",{attrs:{cropperModal:t.cropperModal,sizeLimit:5,list:t.fileList,width:\"240px\",height:\"135px\"},on:{change:t.fileChange}},[i(\"a-icon\",{style:{fontSize:\"32px\",verticalAlign:\"super\",marginRight:\"8px\",color:\"#9BACB9\"},attrs:{type:\"plus-circle\",theme:\"filled\"}}),i(\"div\",{staticClass:\"page-upload-text\"},[t._v(\"上传门店图片\")]),i(\"div\",{staticClass:\"page-upload-text\"},[t._v(\"大小不超过5M，建议尺寸16:9\")])],1),i(\"p\",{staticClass:\"st-des ta-c\"},[t._v(\"可新增20张门店图片\")])],1):t._e()],2)])],1)],1),i(\"a-row\",{attrs:{gutter:8}},[i(\"a-col\",{attrs:{offset:\"1\",lg:22}},[i(\"st-form-item\",{attrs:{label:\"营业时间\"}},[i(\"shop-hour-picker\",{model:{value:t.weekTime,callback:function(e){t.weekTime=e},expression:\"weekTime\"}})],1)],1)],1),i(\"a-row\",{attrs:{gutter:8}},[i(\"a-col\",{attrs:{offset:\"1\",lg:22}},[i(\"st-form-item\",{attrs:{label:\" \"}},[i(\"st-button\",{attrs:{type:\"primary\",loading:t.loading.edit},on:{click:t.onSubmit}},[t._v(\"\\n            提交\\n          \")])],1)],1)],1)],1)],1)},o=[],n=(i(\"5df3\"),i(\"4f7f\"),i(\"75fc\")),a=(i(\"ac6a\"),i(\"2527\")),r=i(\"1bbb9\"),c=i(\"5c8a\"),l=i(\"ad06\"),h=i(\"9507\"),p=i(\"f0ec\"),d=i(\"57f4\"),u=i(\"7ce1\"),f=function(t){t.pattern;return{shopPhone:{validateTrigger:\"blur\",rules:[{validator:function(e,i,s){if(t.phoneValidtorType){if(i&&!t.pattern.TEL.test(i))return\"输入的门店电话格式错误，请重新输入\"}else if(!t.shopPhones.length)return\"请填写门店电话\"}}]},email:{rules:[{type:\"email\",message:\"输入的邮箱格式错误，请重新输入!\"}]}}},m={name:\"PageShopSettingShopEdit\",components:{CheckboxFacilityGroup:h[\"a\"],CheckboxFacilityItem:p[\"a\"],ShopHourPicker:d[\"a\"],StImageUpload:u[\"a\"]},bem:{edit:\"page-shop-setting-shop-edit\"},modals:{ShopMapLocation:l[\"a\"]},serviceInject:function(){return{pattern:a[\"a\"],editService:r[\"EditService\"]}},rxState:function(){return{loading:this.editService.loading$,serviceList:this.editService.serviceList$,info:this.editService.info$}},data:function(){var t=this.$stForm.create(),e=t.decorators(f);return{form:t,decorators:e,flagList:[\"\",\"shop-trial\",\"shop-opening\",\"shop-stop\",\"shop-close\",\"shop-holiday\"],phoneValidtorType:1,shopPhones:[],serviceIds:[],serviceIconIconList:{1:\"WIFI\",2:\"park\",3:\"shower\",4:\"medical\",5:\"heating\",6:\"snow\",7:\"nosmoking\",8:\"energy\"},fileList:[],imgList:[],cropperModal:{},weekTime:[]}},computed:{phoneAddDisabled:function(){return this.shopPhones.length>2}},mounted:function(){this.init()},methods:{init:function(){var t=this;this.form.setFieldsValue({email:this.info.email}),this.shopPhones=Object(c[\"a\"])(this.info.shop_phones),this.info.shop_services.forEach((function(e){t.serviceIds.push(e.service_id)})),this.imgList=Object(c[\"a\"])(this.info.shop_images),this.weekTime=Object(c[\"a\"])(this.info.business_time)},location:function(){this.$modalRouter.push({name:\"shop-map-location\",props:{lat:this.info.lat,lng:this.info.lng}})},onValidtorPhone:function(){var t=this;this.phoneValidtorType=1,this.form.getFieldValue(\"shopPhone\")&&!this.phoneAddDisabled&&this.form.validate([\"shopPhone\"]).then((function(e){var i=Object(n[\"a\"])(t.shopPhones);i.push(e.shopPhone),t.shopPhones=Object(n[\"a\"])(new Set(i))}))},onRemovePhone:function(t){this.shopPhones.splice(t,1)},fileChange:function(t){this.imgList.push({image_id:t[0].image_id,image_key:t[0].image_key,image_url:t[0].image_url,is_cover:0}),this.fileList=[]},onSetCover:function(t){var e;this.imgList.forEach((function(t){t.is_cover=0})),this.imgList[t].is_cover=1,(e=this.imgList).unshift.apply(e,Object(n[\"a\"])(this.imgList.splice(t,1)))},onDelete:function(t){this.imgList.splice(t,1)},onSubmit:function(){var t=this;this.phoneValidtorType=0,this.form.resetFields([\"shopPhone\"]),this.form.validate().then((function(e){t.phoneValidtorType=1,t.editService.edit({shop_phones:t.shopPhones,service_ids:t.serviceIds,business_time:t.weekTime,email:e.email,shop_images:t.imgList}).subscribe((function(){t.$router.push({path:\"/shop/setting/shop/info\"})}))}))}}},g=m,v=i(\"2877\"),b=Object(v[\"a\"])(g,s,o,!1,null,null,null);e[\"default\"]=b.exports}}]);","extractedComments":[]}