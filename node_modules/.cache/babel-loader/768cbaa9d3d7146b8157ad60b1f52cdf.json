{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/finance/split.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/biz-modals/shop/finance/split.vue","mtime":1591147717217},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport { SplitService } from \"./split.service\";\nimport { cloneDeep } from 'lodash-es';\nimport { columns } from \"./split.config\";\nimport { SPLIT } from '@/constants/finance/split';\nimport { MessageService } from '@/services/message.service';\nexport default {\n  name: 'ModalShopFinanceOrderSplit',\n  bem: {\n    basic: 'modal-shop-finance-split'\n  },\n  serviceInject: function serviceInject() {\n    return {\n      splitService: SplitService,\n      messageService: MessageService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      info: this.splitService.info$,\n      loading: this.splitService.loading$,\n      saleList: this.splitService.saleList$\n    };\n  },\n  props: ['id'],\n  data: function data() {\n    return {\n      SPLIT: SPLIT,\n      form: this.$form.createForm(this),\n      show: false,\n      description: '',\n      rate: 0,\n      saleMan: ''\n    };\n  },\n  computed: {\n    columns: columns\n  },\n  created: function created() {\n    var _this = this;\n\n    this.splitService.serviceInit(this.id).subscribe(function (result) {\n      _this.description = _this.info.description || '';\n      var item = {\n        edit: _this.SPLIT.EDIT_TYPE_3,\n        // 1 主销售编辑 2 协助销售编辑 3协助销售新增\n        staff_id: undefined,\n        staff_name: '',\n        staff_type: _this.SPLIT.STAFF_TYPE_2,\n        staff_type_name: '协助销售',\n        split_ratio: '',\n        split_money: ''\n      };\n      return _this.info.split_items.unshift(item);\n    });\n  },\n  methods: {\n    changeSaleMan: function changeSaleMan(saler, index) {\n      this.info.split_items[index].staff_id = saler.staff_id;\n      this.info.split_items[index].staff_name = saler.staff_name;\n    },\n    validSaleMan: function validSaleMan(record) {\n      if (!this.info.split_items || this.info.split_items.length >= 7) {\n        return false;\n      }\n\n      var percent = 0;\n\n      for (var i = 1; i < this.info.split_items.length; i++) {\n        percent += parseInt(this.info.split_items[i].split_ratio || 0, 10);\n\n        if (this.info.split_items[i].staff_id === record.staff_id) {\n          this.messageService.error({\n            content: '销售人员不能重复'\n          });\n          return false;\n        }\n      }\n\n      percent += parseInt(record.split_ratio, 10);\n\n      if (percent > 100) {\n        this.messageService.error({\n          content: '拆分比例总和不能超过100%'\n        });\n        return false;\n      }\n\n      return true;\n    },\n    addSaleMan: function addSaleMan(record) {\n      if (!record.staff_id || !record.split_ratio) {\n        return;\n      }\n\n      if (!this.validSaleMan(record)) {\n        return;\n      }\n\n      delete record.edit;\n      var split_money = +record.split_ratio / 100 * +this.info.actual_price;\n      split_money = Math.floor(split_money * 10) / 10;\n      record.split_money = split_money;\n      this.info.split_items.splice(0, 1, record);\n      var newRecord = {\n        edit: this.SPLIT.EDIT_TYPE_3,\n        staff_id: undefined,\n        staff_name: '',\n        staff_type: this.SPLIT.STAFF_TYPE_2,\n        staff_type_name: '协助销售',\n        split_ratio: '',\n        split_money: ''\n      };\n      this.info.split_items.unshift(newRecord);\n    },\n    onSave: function onSave(record, index) {\n      var percent = 0;\n      var arr = cloneDeep(this.info.split_items);\n      arr.shift();\n      arr.map(function (item) {\n        percent += parseInt(item.split_ratio || 0, 10);\n      }); // percent += parseInt(record.split_ratio, 10)\n\n      if (percent > 100) {\n        this.messageService.error({\n          content: '拆分比例总和不能超过100%'\n        });\n        return;\n      }\n\n      delete record.edit;\n      var split_money = +record.split_ratio / 100 * +this.info.actual_price;\n      split_money = Math.floor(split_money * 10) / 10;\n      record.split_money = split_money;\n      this.info.split_items.splice(index, 1, record);\n      this.info.split_items[0].staff_id = undefined;\n      this.info.split_items[0].split_ratio = '';\n    },\n    onEidt: function onEidt(record, index) {\n      record.meta = cloneDeep(record);\n      record.edit = record.staff_type;\n      this.info.split_items.splice(index, 1, record);\n    },\n    onCanel: function onCanel(record, index) {\n      record = record.meta;\n      this.info.split_items.splice(index, 1, record);\n    },\n    onDelete: function onDelete(index) {\n      this.info.split_items.splice(index, 1);\n    },\n    moment: moment,\n    onSubmit: function onSubmit() {\n      var _this2 = this;\n\n      var list = this.info.split_items.map(function (item) {\n        var params = {};\n\n        if (item.staff_id !== -1) {\n          params.staff_id = item.staff_id;\n          params.staff_rate = item.split_ratio;\n        }\n\n        return params;\n      });\n      list.shift();\n      var params = {\n        order_id: this.id,\n        description: this.description,\n        split_data: list\n      };\n      this.splitService.split(params).subscribe(function (result) {\n        _this2.show = false;\n\n        _this2.$emit('success');\n      });\n    }\n  }\n};",null]}