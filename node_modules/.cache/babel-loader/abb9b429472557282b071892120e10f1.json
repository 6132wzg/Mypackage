{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js!/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js!/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/setting/shop/edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/setting/shop/edit.vue","mtime":1597396800005},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/thread-loader/dist/cjs.js","mtime":1591062572352},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["import \"core-js/modules/es6.string.iterator\";\nimport \"core-js/modules/es6.set\";\nimport _toConsumableArray from \"/Users/wangzhigang/Desktop/styd/web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { PatternService } from '@/services/pattern.service';\nimport { EditService } from \"./edit.service\";\nimport { cloneDeep } from 'lodash-es';\nimport ShopMapLocation from '@/views/biz-modals/shop/map-location';\nimport CheckboxFacilityGroup from '@/views/biz-components/checkbox-facility/checkbox-facility-group';\nimport CheckboxFacilityItem from '@/views/biz-components/checkbox-facility/checkbox-facility-item';\nimport ShopHourPicker from '@/views/biz-components/shop-hour-picker/shop-hour-picker';\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload';\nimport { ruleOptions } from \"./edit.config\";\nexport default {\n  name: 'PageShopSettingShopEdit',\n  components: {\n    CheckboxFacilityGroup: CheckboxFacilityGroup,\n    CheckboxFacilityItem: CheckboxFacilityItem,\n    ShopHourPicker: ShopHourPicker,\n    StImageUpload: StImageUpload\n  },\n  bem: {\n    edit: 'page-shop-setting-shop-edit'\n  },\n  modals: {\n    ShopMapLocation: ShopMapLocation\n  },\n  serviceInject: function serviceInject() {\n    return {\n      pattern: PatternService,\n      editService: EditService\n    };\n  },\n  rxState: function rxState() {\n    return {\n      loading: this.editService.loading$,\n      serviceList: this.editService.serviceList$,\n      info: this.editService.info$\n    };\n  },\n  data: function data() {\n    var form = this.$stForm.create();\n    var decorators = form.decorators(ruleOptions);\n    return {\n      form: form,\n      decorators: decorators,\n      flagList: ['', 'shop-trial', 'shop-opening', 'shop-stop', 'shop-close', 'shop-holiday'],\n      // 电话校验方式 1为点击新增校验，0为点击提交校验\n      phoneValidtorType: 1,\n      shopPhones: [],\n      // 服务设施\n      serviceIds: [],\n      serviceIconIconList: {\n        1: 'WIFI',\n        2: 'park',\n        3: 'shower',\n        4: 'medical',\n        5: 'heating',\n        6: 'snow',\n        7: 'nosmoking',\n        8: 'energy'\n      },\n      // 图片\n      fileList: [],\n      imgList: [],\n      cropperModal: {},\n      weekTime: []\n    };\n  },\n  computed: {\n    phoneAddDisabled: function phoneAddDisabled() {\n      return this.shopPhones.length > 2;\n    }\n  },\n  mounted: function mounted() {\n    this.init();\n  },\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      this.form.setFieldsValue({\n        email: this.info.email\n      }); // 电话\n\n      this.shopPhones = cloneDeep(this.info.shop_phones); // 服务设施\n\n      this.info.shop_services.forEach(function (i) {\n        _this.serviceIds.push(i.service_id);\n      }); // 图片\n\n      this.imgList = cloneDeep(this.info.shop_images); // 营业时间\n\n      this.weekTime = cloneDeep(this.info.business_time);\n    },\n    // 查看定位\n    location: function location() {\n      this.$modalRouter.push({\n        name: 'shop-map-location',\n        props: {\n          lat: this.info.lat,\n          lng: this.info.lng\n        }\n      });\n    },\n    // 新增电话\n    onValidtorPhone: function onValidtorPhone() {\n      var _this2 = this;\n\n      this.phoneValidtorType = 1;\n\n      if (this.form.getFieldValue('shopPhone') && !this.phoneAddDisabled) {\n        // input框里有值才新增\n        this.form.validate(['shopPhone']).then(function (res) {\n          var arr = _toConsumableArray(_this2.shopPhones);\n\n          arr.push(res.shopPhone);\n          _this2.shopPhones = _toConsumableArray(new Set(arr));\n        });\n      }\n    },\n    // 移除电话\n    onRemovePhone: function onRemovePhone(index) {\n      this.shopPhones.splice(index, 1);\n    },\n    // 图片\n    fileChange: function fileChange(data) {\n      this.imgList.push({\n        image_id: data[0].image_id,\n        image_key: data[0].image_key,\n        image_url: data[0].image_url,\n        is_cover: 0\n      });\n      this.fileList = [];\n    },\n    // 设为店招\n    onSetCover: function onSetCover(index) {\n      var _this$imgList;\n\n      this.imgList.forEach(function (i) {\n        i.is_cover = 0;\n      });\n      this.imgList[index].is_cover = 1;\n\n      (_this$imgList = this.imgList).unshift.apply(_this$imgList, _toConsumableArray(this.imgList.splice(index, 1)));\n    },\n    // 删除图片\n    onDelete: function onDelete(index) {\n      this.imgList.splice(index, 1);\n    },\n    // 提交\n    onSubmit: function onSubmit() {\n      var _this3 = this;\n\n      // 确认为提交表单校验\n      this.phoneValidtorType = 0;\n      this.form.resetFields(['shopPhone']);\n      this.form.validate().then(function (values) {\n        _this3.phoneValidtorType = 1;\n\n        _this3.editService.edit({\n          shop_phones: _this3.shopPhones,\n          service_ids: _this3.serviceIds,\n          business_time: _this3.weekTime,\n          email: values.email,\n          shop_images: _this3.imgList\n        }).subscribe(function () {\n          _this3.$router.push({\n            path: '/shop/setting/shop/info'\n          });\n        });\n      });\n    }\n  }\n};",null]}