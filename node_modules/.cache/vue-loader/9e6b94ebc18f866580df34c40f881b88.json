{"remainingRequest":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/setting/court/site.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangzhigang/Desktop/styd/web/src/views/pages/shop/setting/court/site.vue","mtime":1597396800004},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/babel-loader/lib/index.js","mtime":1591062567418},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/cache-loader/dist/cjs.js","mtime":1591062571898},{"path":"/Users/wangzhigang/Desktop/styd/web/node_modules/vue-loader/lib/index.js","mtime":1591062572376}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { cloneDeep } from 'lodash-es'\nimport { imgFilter } from '@/filters/resource.filters'\nimport { MessageService } from '@/services/message.service'\nimport { SiteService } from './site.service'\nimport StImageUpload from '@/views/biz-components/st/image-upload/image-upload.vue'\nexport default {\n  serviceInject() {\n    return {\n      messageService: MessageService,\n      siteService: SiteService\n    }\n  },\n  rxState() {\n    const siteService = this.siteService\n    return {\n      resData: siteService.resData$,\n      loading: siteService.loading$\n    }\n  },\n  components: {\n    StImageUpload\n  },\n  bem: {\n    bPage: 'page-shop-setting-court-site'\n  },\n  filters: {\n    imgFilter\n  },\n  data() {\n    return {\n      isAdd: false,\n      addInfo: {},\n      editInfo: {}\n    }\n  },\n  computed: {\n    canShowAddBtn() {\n      /**\n       * 单个场地最多可以新增20个座位模板\n       */\n      return this.list.length < 20 && !this.isAdd && !this.editInfo.id\n    },\n    list() {\n      return this.resData.list\n    }\n  },\n  methods: {\n    onAdd() {\n      this.isAdd = true\n      this.editInfo = {}\n      this.addInfo = {\n        shop_area_id: this.$searchQuery.id,\n        seat_img: {},\n        seat_name: '',\n        seat_num: ''\n      }\n    },\n    onAddSubmit() {\n      if (!this.inputCheck(this.addInfo)) {\n        return\n      }\n      this.siteService.add(this.addInfo).subscribe(() => {\n        this.onActionSuccess('add')\n      })\n    },\n    onAddCancel() {\n      this.isAdd = false\n    },\n    onEdit(record) {\n      this.isAdd = false\n      this.editInfo = cloneDeep(record)\n    },\n    onEditSubmit() {\n      if (!this.inputCheck(this.editInfo)) {\n        return\n      }\n      this.siteService.update(this.editInfo).subscribe(() => {\n        this.onActionSuccess('edit')\n      })\n    },\n    onEditCancel() {\n      this.editInfo = {}\n    },\n    onDelete(id) {\n      this.siteService.del(id).subscribe(() => {\n        this.onActionSuccess('del')\n      })\n    },\n    onActionSuccess(type) {\n      const msg = {\n        add: '新增成功',\n        edit: '编辑成功',\n        del: '删除成功'\n      }[type]\n      this.messageService.success({\n        content: msg\n      })\n      this.onListChange()\n    },\n    onListChange() {\n      this.isAdd = false\n      this.editInfo = {}\n      this.$router.push({\n        query: this.$searchQuery\n      })\n    },\n    onAddImgChange(fileList) {\n      this.addInfo.seat_img = fileList[0]\n    },\n    onEditImgChange(fileList) {\n      this.editInfo.seat_img = fileList[0]\n    },\n    inputCheck(data = {}) {\n      const seatImg = data.seat_img\n      const seatName = data.seat_name\n      const seatNum = data.seat_num.toString()\n      if (!seatImg.image_key) {\n        this.onErrorTip('请上传座位图片')\n        return false\n      }\n      if (!seatName.length) {\n        this.onErrorTip('请输入座位模板名称')\n        return false\n      }\n      if (!seatNum.length) {\n        this.onErrorTip('请输入座位数量')\n        return false\n      }\n      if (seatNum > this.resData.contain_number) {\n        this.onErrorTip('座位数量不能超过场地的最大容纳人数')\n        return false\n      }\n      return true\n    },\n    onErrorTip(msg) {\n      this.messageService.error({\n        content: msg\n      })\n    }\n  }\n}\n",null]}